Make action processor work with async functions