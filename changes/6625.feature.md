Migrate commit session to retriable background task pattern