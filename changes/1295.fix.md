Fix doubling of agent's occupied resources when the transaction in `recalculate_usage()` is retried due to database contention
