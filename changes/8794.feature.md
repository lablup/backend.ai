Convert ResourceSlot reads to list[SlotQuantity] and fix allocation atomicity