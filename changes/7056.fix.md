Replace assert statements with proper exceptions (Phase 3)