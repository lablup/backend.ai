Refactor GQL Agent resolver functions by applying repository pattern
