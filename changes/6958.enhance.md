Refactor Agent's kernel registry recovery by separating loader and writer
