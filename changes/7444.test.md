Refactor `bgtask` test to use mocking instead of full app, improving code readability and test speed
