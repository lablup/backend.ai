Introduce Service, Repository layer pattern when handling Agent Heartbeat
