Convert JSONB reads to normalized tables and fix resource freeing