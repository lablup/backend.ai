Refactor `AgentRepository` list methods to use source-based structure, decoupling database access for easier testing
