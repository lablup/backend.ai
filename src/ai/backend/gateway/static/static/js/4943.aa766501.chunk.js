"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[4943],{99231:(e,s,n)=>{n.d(s,{A:()=>u});var t=n(25344),r=n(82156),o=n(50840),l=n(6932),i=n(29475),a=n(45901),c=n.n(a),d=(n(76998),n(23446));const u=e=>{let{status:s="default",extraButtonTitle:n,onClickExtraButton:a,extra:u,style:m,...h}=e;const{token:g}=o.A.useToken(),p=u||n&&(0,d.jsx)(l.Ay,{type:"link",icon:"error"===s?(0,d.jsx)(t.A,{twoToneColor:g.colorError}):"warning"===s?(0,d.jsx)(r.A,{twoToneColor:g.colorWarning}):void 0,onClick:a,children:n})||void 0;return(0,d.jsx)(i.A,{className:"error"===s?"bai-card-error":"",style:c().extend(m,{borderColor:"error"===s?g.colorError:"warning"===s?g.colorWarning:"success"===s?g.colorSuccess:null===m||void 0===m?void 0:m.borderColor}),extra:p,...h})}},23623:(e,s,n)=>{n.d(s,{A:()=>o});var t=n(76998);const r=(e,s,n)=>{const[r,o]=(0,t.useState)(e());return(0,t.useEffect)((()=>{n&&o(e())}),[n]),function(e,s){const n=(0,t.useRef)();(0,t.useEffect)((()=>{n.current=e})),(0,t.useEffect)((()=>{if(null!==s){let e=setInterval((function(){var e;null===(e=n.current)||void 0===e||e.call(n)}),s);return()=>clearInterval(e)}}),[s])}((()=>{const s=e();s!==r&&o(s)}),s),r},o=e=>{let{callback:s,delay:n,triggerKey:t}=e;return r(s,n,t)}},42989:(e,s,n)=>{n.d(s,{A:()=>d});var t=n(66464),r=n(8067),o=n(14455),l=n.n(o),i=n(45901),a=n.n(i),c=(n(76998),n(23446));const d=e=>{let{value:s,onChange:n,localFormat:o,...i}=e;const[,d]=(0,t.A)({value:s,onChange:n});return(0,c.jsx)(r.A,{value:s?l()(s):void 0,onChange:e=>{var s,n,t;a().isArray(e)&&(e=e[0]);const r=o?null===(s=e)||void 0===s?void 0:s.format():null===(n=e)||void 0===n||null===(t=n.tz())||void 0===t?void 0:t.toISOString();d(r)},...i})}},55256:(e,s,n)=>{n.d(s,{Ay:()=>A,Kk:()=>p,p3:()=>x,sT:()=>h,vB:()=>m});var t=n(83468),r=n(5621),o=n(29871),l=n(48713),i=n(45901),a=n.n(i),c=n(76998),d=n(23446);const u=e=>{let{image:s,...n}=e;s=s||"";const[,{getImageAliasName:o,getBaseVersion:l,tagAlias:i}]=(0,t.Gj)();return(0,d.jsx)(r.A,{values:[{label:i(o(s)),color:"blue"},{label:l(s),color:"green"}],...n})},m=e=>{let{image:s,...n}=e;s=s||"";const[,{getBaseVersion:r,tagAlias:o}]=(0,t.Gj)();return(0,d.jsx)(l.A,{color:"green",...n,children:o(r(s))})},h=e=>{let{image:s,...n}=e;s=s||"";const[,{getBaseImage:r,tagAlias:o}]=(0,t.Gj)();return(0,d.jsx)(l.A,{color:"green",...n,children:o(r(s))})},g=e=>{let{image:s,...n}=e;s=s||"";const[,{getArchitecture:r,tagAlias:o}]=(0,t.Gj)();return(0,d.jsx)(l.A,{color:"green",...n,children:o(r(s))})},p=e=>{let{image:s,...n}=e;s=s||"";const[,{getImageLang:r,tagAlias:o}]=(0,t.Gj)();return(0,d.jsx)(l.A,{color:"green",...n,children:o(r(s))})},x=e=>{let{image:s,labels:n,...i}=e;s=s||"",n=n||[];const[,{getFilteredRequirementsTags:c,getCustomTag:u,tagAlias:m}]=(0,t.Gj)();return(0,d.jsxs)(o.A,{children:[a().map(c(s),((e,s)=>(0,d.jsx)(l.A,{color:"blue",...i,children:m(e||"")},s))),(0,d.jsx)(r.A,{color:"cyan",values:[{label:"Customized",color:"cyan"},{label:u(n),color:"cyan"}],...i})]})},v=(e,s)=>{let{image:n,style:t={}}=e;return n=n||"",(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u,{image:n}),(0,d.jsx)(h,{image:n}),(0,d.jsx)(g,{image:n})]})},A=c.memo(v)},84943:(e,s,n)=>{n.r(s),n.d(s,{default:()=>Fe});var t=n(99231),r=n(23623),o=n(42989),l=n(5621),i=n(5516),a=n(29871),c=n(85676),d=n(35051),u=n(55256),m=n(27751),h=n(83468),g=n(7121),p=n(78074),x=n(48713),v=n(45901),A=n.n(v),j=n(76998),y=n(77678),b=n(23446);const f=1024,F=65535,T=e=>{let{inValid:s,value:n,...t}=e;return(0,b.jsx)(x.A,{color:!s&&S(n)?void 0:"red",...t})},S=e=>{if(k(e)){const s=e.split(":"),[n,t]=s.map((e=>parseInt(e)));return n>=f&&t<=F}return e===parseInt(e).toString()&&parseInt(e)>=f&&parseInt(e)<=F},k=e=>{const s=e.split(":");if(2===s.length){const[e,n]=s.map((e=>parseInt(e)));return e<=n}return!1},w=e=>A().flatten(A().map(e,(e=>k(e)?(e=>{const[s,n]=e.split(":").map((e=>parseInt(e)));return A().range(s,n+1)})(e):parseInt(e)))),E=e=>{let{name:s="ports",...n}=e;const{t:t}=(0,y.Bd)(),r=(0,h.CX)(),o=g.A.useFormInstance();return(0,b.jsx)(g.A.Item,{label:t("session.launcher.PreOpenPortTitle"),name:s,tooltip:(0,b.jsx)(y.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:t("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,s)=>w(s).length<=r._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortMaxCountLimit",{count:r._config.maxCountForPreopenPorts})))}),()=>({validator:(e,s)=>A().every(s,(e=>parseInt(e).toString()===e||k(e)))?Promise.resolve():Promise.reject(new Error(t("session.launcher.InvalidPortFormat")))}),()=>({validator(e,s){const n=w(s);return A().every(n,(e=>e>=f&&e<=F))?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,s){const n=w(s);return A().uniq(n).length===n.length?Promise.resolve():Promise.reject(new Error(t("session.launcher.DuplicatedPort")))}})],...n,children:(0,b.jsx)(p.A,{mode:"tags",tagRender:e=>{const n=A().filter(w(o.getFieldValue(s)),(s=>s===parseInt(e.value))).length>1;return(0,b.jsx)(T,{inValid:n,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})};var V=n(44183),I=n(8469),P=n(44453),C=n(14246);const N=e=>{let{open:s,onClose:n,...t}=e;const{t:r}=(0,y.Bd)(),[o,l]=(0,P.q)("has_opened_tour_neo_session_validation"),i=[{title:r("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:r("tourguide.NeoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:r("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:r("tourguide.NeoSessionLauncher.FixErrorFieldbyModifyButton"),target:()=>{var e;return(null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]).querySelector(".ant-card-extra")}},{title:r("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:r("tourguide.NeoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,b.jsx)(C.A,{steps:i,onClose:e=>{null===n||void 0===n||n(e),l(!0)},open:!o&&s,...t})};var _=n(63284);const M=e=>{let{...s}=e;const{t:n}=(0,y.Bd)();return(0,b.jsx)(g.A.Item,{label:n("session.launcher.SessionName"),name:"sessionName",rules:[{min:4,message:n("session.Validation.SessionNameTooShort")},{max:64,message:n("session.Validation.SessionNameTooLong64")},{validator:(e,s)=>A().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/^[\w.-]*$/.test(s)?!/\w$/.test(s)&&s.length>=4?Promise.reject(n("session.Validation.SessionNameShouldEndWith")):Promise.resolve():Promise.reject(n("session.Validation.SessionNameInvalidCharacter")):Promise.reject(n("session.Validation.SessionNameShouldStartWith"))}],...s,children:(0,b.jsx)(_.A,{allowClear:!0,autoComplete:"off"})})};var D=n(80838),O=n(22089),z=n(30032),B=n(21454),L=n(96495),R=n(90660);var q=n(21186),G=n(18590),W=n(31959),U=n(78474),H=n(43110),K=n(15213),J=n(76108),X=n(78969),Z=n(50840),Q=n(33554),Y=n(29475),$=n(17480),ee=n(97080),se=n(87627),ne=n(82745),te=n(7518),re=n(9788),oe=n(66742),le=n(22307),ie=n(41856),ae=n(94120),ce=n(59065),de=n(6932),ue=n(20307),me=n(31687),he=n(14455),ge=n.n(he),pe=n(60269),xe=n(34515),ve=n(81365),Ae=n(6592),je=n(52276),ye=n(58346);const be=e=>{let{form:s,containerCount:n=1}=e;return(0,b.jsxs)(b.Fragment,{children:[A().map(A().omit(s.getFieldsValue().resource,"shmem","accelerator","acceleratorType"),((e,t)=>{var r,o;return(0,b.jsx)(I.Ay,{type:t,value:"mem"===t?((null===(r=(0,z.Js)(e,"b"))||void 0===r?void 0:r.number)||0)*n+"":A().toNumber(e)*n+"",opts:{shmem:s.getFieldValue("resource").shmem?((null===(o=(0,z.Js)(s.getFieldValue("resource").shmem,"b"))||void 0===o?void 0:o.number)||0)*n:void 0}},t)})),A().isNumber(s.getFieldValue(["resource","accelerator"]))&&s.getFieldValue(["resource","acceleratorType"])&&(0,b.jsx)(I.Ay,{type:s.getFieldValue(["resource","acceleratorType"]),value:A().toString(s.getFieldValue(["resource","accelerator"])*n)})]})},fe=()=>{let e="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<8;n++)e+=s.charAt(Math.floor(62*Math.random()));return e+"-session"},Fe=()=>{var e,s,n,v,f,F,S,k,I,P,C,he,Fe,Te,Se,ke,we;const Ee=X.A.useApp();let Ve="normal";const Ie=(0,pe.md)(m.i7),Pe=(0,h.CX)(),[Ce,Ne]=(0,j.useState)(!1),_e=(0,j.useMemo)((()=>{var e,s;return{sessionType:"interactive",allocationPreset:"auto-preset",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0},envvars:[],...(null===(e=Pe._config)||void 0===e?void 0:e.default_session_environment)&&{environments:{environment:null===(s=Pe._config)||void 0===s?void 0:s.default_session_environment}},...V.jh}}),[null===(e=Pe._config)||void 0===e?void 0:e.default_session_environment]),Me=(0,ye.withDefault)(ye.NumberParam,0),De=(0,ye.withDefault)(ye.JsonParam,_e),Oe=(0,ye.withDefault)(ye.JsonParam,{}),[{step:ze,formValues:Be,redirectTo:Le,appOption:Re},qe]=(0,ye.useQueryParams)({step:Me,formValues:De,redirectTo:ye.StringParam,appOption:Oe}),{isDarkMode:Ge}=(0,R.e)(),We=(0,ve.Zp)(),Ue=(0,h.f0)(),He=(0,L.hd)(),{upsertNotification:Ke}=(0,B.js)(),{run:Je}=(0,J.A)((()=>{qe({formValues:A().omit($e.getFieldsValue(),["environments.image"],["environments.customizedTag"],["autoMountedFolderNames"])},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),Xe=e=>{qe({step:e},"pushIn")},{token:Ze}=Z.A.useToken(),{t:Qe}=(0,y.Bd)(),Ye=Q.Ay.useBreakpoint(),[$e]=g.A.useForm();(0,j.useEffect)((()=>{A().isEmpty(Be)||$e.validateFields().catch((e=>{}))}),[]);const es=(0,j.useMemo)((()=>A().merge(_e,Be)),[_e,Be]);(0,j.useEffect)((()=>{var e;null===(e=Ie.current)||void 0===e||e.scrollTo(0,0)}),[ze]);const ss=g.A.useWatch("sessionType",{form:$e,preserve:!0})||$e.getFieldValue("sessionType")||Be.sessionType,ns=A().filter([{title:Qe("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(Qe("session.launcher.Environments")," & ").concat(Qe("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==ss&&{title:Qe("webui.menu.Data&Storage"),key:"storage"},{title:Qe("session.launcher.Network"),key:"network"},{title:Qe("session.launcher.ConfirmAndLaunch"),icon:(0,b.jsx)(q.A,{}),key:"review"}],(e=>!!e)),ts=null===(s=ns[ze])||void 0===s?void 0:s.key,rs=A().some($e.getFieldsError(),(e=>e.errors.length>0)),[os,ls]=(0,h.Tw)("first");(0,j.useEffect)((()=>{ze===ns.length-1&&$e.validateFields().catch((e=>{})).finally((()=>ls()))}),[ze,$e,ls,ns.length]),(0,j.useEffect)((()=>{"first"!==os&&as(!!rs)}),[os,rs]);const[is,as]=(0,j.useState)(!1);return(0,b.jsxs)(a.A,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,b.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,b.jsxs)(a.A,{direction:"row",gap:"md",align:"start",children:[(0,b.jsx)(a.A,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:(0,b.jsx)(g.A.Provider,{onFormChange:(e,s)=>{Je()},children:(0,b.jsx)(g.A,{form:$e,layout:"vertical",requiredMark:"optional",initialValues:es,children:(0,b.jsxs)(a.A,{direction:"column",align:"stretch",gap:"md",children:[(0,b.jsxs)(Y.A,{title:Qe("session.launcher.SessionType"),style:{display:"sessionType"===ts?"block":"none"},children:[(0,b.jsx)(g.A.Item,{name:"sessionType",children:(0,b.jsx)($.Ay.Group,{options:[{label:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ee.A.Text,{code:!0,children:Qe("session.launcher.InteractiveMode")})," ",(0,b.jsx)(ee.A.Text,{type:"secondary",children:Qe("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ee.A.Text,{code:!0,children:Qe("session.launcher.BatchMode")})," ",(0,b.jsx)(ee.A.Text,{type:"secondary",children:Qe("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,b.jsx)(M,{}),(0,b.jsx)(g.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,b.jsx)(_.A,{})})]}),"batch"===ss&&(0,b.jsxs)(Y.A,{title:Qe("session.launcher.BatchModeConfig"),style:{display:"sessionType"===ts?"block":"none"},children:[(0,b.jsx)(g.A.Item,{label:Qe("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,b.jsx)(_.A.TextArea,{autoSize:!0})}),(0,b.jsx)(g.A.Item,{label:Qe("session.launcher.SessionStartTime"),extra:(0,b.jsx)(g.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>e.batch.scheduleDate!==s.batch.scheduleDate,children:()=>{const e=$e.getFieldValue(["batch","scheduleDate"]);return(0,b.jsx)(r.A,{delay:1e3,callback:()=>{const e=$e.getFieldValue(["batch","scheduleDate"]);return e?ge()(e).isBefore(ge()())?void(0===$e.getFieldError(["batch","scheduleDate"]).length&&$e.validateFields([["batch","scheduleDate"]])):ge()(e).fromNow():void 0},triggerKey:e||"none"})}}),children:(0,b.jsxs)(a.A,{direction:"row",gap:"xs",children:[(0,b.jsx)(g.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,b.jsx)(se.A,{onChange:e=>{e.target.checked&&A().isEmpty($e.getFieldValue(["batch","scheduleDate"]))?$e.setFieldValue(["batch","scheduleDate"],ge()().add(2,"minutes").toISOString()):!1===e.target.checked&&$e.setFieldValue(["batch","scheduleDate"],void 0),$e.validateFields([["batch","scheduleDate"]])},children:Qe("session.launcher.Enable")})}),(0,b.jsx)(g.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.batch)||void 0===n?void 0:n.enabled)!==(null===(t=s.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const s=!0!==(null===(e=$e.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(g.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,s)=>s&&ge()(s).isBefore(ge()())?Promise.reject(Qe("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,b.jsx)(o.A,{disabled:s,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(ge()().startOf("day"))})})})}})]})})]}),"inference"===ss&&(0,b.jsx)(Y.A,{title:"Inference Mode Configuration",children:(0,b.jsx)(g.A.Item,{name:["inference","vFolderName"],label:Qe("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,b.jsx)(p.A,{})})}),(0,b.jsxs)(Y.A,{title:Qe("session.launcher.Environments"),style:{display:"environment"===ts?"block":"none"},children:[(0,b.jsx)(xe.tH,{fallbackRender:e=>(console.log(e),null),children:(0,b.jsx)(c.A,{})}),(0,b.jsx)(g.A.Item,{label:Qe("session.launcher.EnvironmentVariable"),children:(0,b.jsx)(i.A,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,b.jsx)(Y.A,{title:Qe("session.launcher.ResourceAllocation"),style:{display:"environment"===ts?"block":"none"},children:(0,b.jsx)(V.Ay,{enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,b.jsxs)(Y.A,{title:Qe("session.launcher.HPCOptimization"),style:{display:"environment"===ts?"block":"none"},children:[(0,b.jsx)(g.A.Item,{noStyle:!0,children:(0,b.jsxs)(a.A,{direction:"row",gap:"sm",children:[(0,b.jsx)(ee.A.Text,{children:Qe("session.launcher.SwitchOpenMPoptimization")}),(0,b.jsx)(g.A.Item,{label:Qe("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,b.jsx)(ne.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e&&$e.setFieldsValue(A().pick(_e,["hpcOptimization"]))}})})]})}),(0,b.jsx)(g.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.hpcOptimization)||void 0===n?void 0:n.autoEnabled)!==(null===(t=s.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=$e.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,b.jsxs)(te.A,{gutter:Ze.marginMD,style:{display:e?"none":void 0,marginTop:Ze.marginMD},children:[(0,b.jsx)(re.A,{xs:24,sm:12,children:(0,b.jsx)(g.A.Item,{style:{flex:1},label:Qe("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,b.jsxs)(b.Fragment,{children:[Qe("session.launcher.OpenMPOptimization"),(0,b.jsx)(y.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,b.jsx)(oe.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,b.jsx)(re.A,{xs:24,sm:12,children:(0,b.jsx)(g.A.Item,{style:{flex:1},label:Qe("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,b.jsxs)(b.Fragment,{children:[Qe("session.launcher.OpenMPOptimization"),(0,b.jsx)(y.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,b.jsx)(oe.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,b.jsx)(Y.A,{title:Qe("webui.menu.Data&Storage"),style:{display:"storage"===ts?"block":"none"},children:(0,b.jsx)(O.A,{filter:e=>{var s;return"ready"===e.status&&!(null!==(s=e.name)&&void 0!==s&&s.startsWith("."))}})}),(0,b.jsx)(Y.A,{title:Qe("session.launcher.Network"),style:{display:"network"===ts?"block":"none"},children:(0,b.jsx)(E,{})}),"review"===ts&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.A,{title:Qe("session.launcher.SessionType"),size:"small",status:$e.getFieldError("sessionName").length>0||$e.getFieldError(["batch","command"]).length>0||$e.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:Qe("button.Edit"),onClickExtraButton:()=>{Xe(ns.findIndex((e=>"sessionType"===e.key)))},children:(0,b.jsxs)(le.A,{size:"small",column:1,children:[(0,b.jsx)(le.A.Item,{label:Qe("session.SessionType"),children:$e.getFieldValue("sessionType")}),!A().isEmpty($e.getFieldValue("sessionName"))&&(0,b.jsx)(le.A.Item,{label:Qe("session.launcher.SessionName"),children:$e.getFieldValue("sessionName")}),"batch"===ss&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(le.A.Item,{label:Qe("session.launcher.StartUpCommand"),labelStyle:{whiteSpace:"nowrap"},contentStyle:{overflow:"auto"},children:$e.getFieldValue(["batch","command"])?(0,b.jsx)(D.A,{language:"shell",children:$e.getFieldValue(["batch","command"])}):(0,b.jsx)(ee.A.Text,{type:"secondary",children:Qe("general.None")})}),(0,b.jsx)(le.A.Item,{label:Qe("session.launcher.ScheduleTimeSimple"),children:$e.getFieldValue(["batch","scheduleDate"])?ge()($e.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,b.jsx)(ee.A.Text,{type:"secondary",children:Qe("general.None")})})]})]})}),(0,b.jsx)(t.A,{title:Qe("session.launcher.Environments"),size:"small",status:A().some($e.getFieldValue("envvars"),((e,s)=>$e.getFieldError(["envvars",s,"variable"]).length>0||$e.getFieldError(["envvars",s,"value"]).length>0))?"error":void 0,extraButtonTitle:Qe("button.Edit"),onClickExtraButton:()=>{Xe(ns.findIndex((e=>"environment"===e.key)))},children:(0,b.jsxs)(le.A,{size:"small",column:1,children:[(0,b.jsx)(le.A.Item,{label:Qe("session.launcher.Project"),children:He.name}),(0,b.jsx)(le.A.Item,{label:Qe("general.Image"),children:(0,b.jsxs)(te.A,{style:{flexFlow:"nowrap",gap:Ze.sizeXS},children:[(0,b.jsx)(re.A,{children:(0,b.jsx)(d.A,{image:(null===(n=$e.getFieldValue("environments"))||void 0===n?void 0:n.version)||(null===(v=$e.getFieldValue("environments"))||void 0===v?void 0:v.manual)})}),(0,b.jsx)(re.A,{children:(0,b.jsx)(a.A,{direction:"row",children:null!==(f=$e.getFieldValue("environments"))&&void 0!==f&&f.manual?(0,b.jsx)(ee.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(F=$e.getFieldValue("environments"))||void 0===F?void 0:F.manual},children:null===(S=$e.getFieldValue("environments"))||void 0===S?void 0:S.manual}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.Ay,{image:null===(k=$e.getFieldValue("environments"))||void 0===k?void 0:k.version}),null!==(I=$e.getFieldValue("environments"))&&void 0!==I&&I.customizedTag?(0,b.jsx)(l.A,{values:[{label:"Customized",color:"cyan"},{label:null===(P=$e.getFieldValue("environments"))||void 0===P?void 0:P.customizedTag,color:"cyan"}]}):null,(0,b.jsx)(ee.A.Text,{copyable:{text:null===(C=$e.getFieldValue("environments"))||void 0===C?void 0:C.version}})]})})})]})}),(null===(he=$e.getFieldValue("envvars"))||void 0===he?void 0:he.length)>0&&(0,b.jsx)(le.A.Item,{label:Qe("session.launcher.EnvironmentVariable"),children:null!==(Fe=$e.getFieldValue("envvars"))&&void 0!==Fe&&Fe.length?(0,b.jsx)(Ae.A,{style:Ge?je.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:A().map($e.getFieldValue("envvars"),(e=>"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"'))).join("\n")}):(0,b.jsx)(ee.A.Text,{type:"secondary",children:"-"})})]})}),(0,b.jsx)(t.A,{title:Qe("session.launcher.ResourceAllocation"),status:A().some($e.getFieldValue("resource"),((e,s)=>$e.getFieldError(["resource",s]).length>0))||$e.getFieldError(["num_of_sessions"]).length>0||$e.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:Qe("button.Edit"),onClickExtraButton:()=>{Xe(ns.findIndex((e=>"environment"===e.key)))},children:(0,b.jsxs)(a.A,{direction:"column",align:"stretch",children:[A().some(null===(Te=$e.getFieldValue("resource"))||void 0===Te?void 0:Te.resource,((e,s)=>$e.getFieldWarning(["resource",s]).length>0))&&(0,b.jsx)(ie.A,{type:"warning",showIcon:!0,message:Qe("session.launcher.EnqueueComputeSessionWarning")}),(0,b.jsxs)(le.A,{column:2,children:[(0,b.jsx)(le.A.Item,{label:Qe("general.ResourceGroup"),span:2,children:$e.getFieldValue("resourceGroup")||(0,b.jsx)(ee.A.Text,{type:"secondary",children:Qe("general.None")})}),(0,b.jsx)(le.A.Item,{label:Qe("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,b.jsxs)(a.A,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===$e.getFieldValue("allocationPreset")?"":(0,b.jsx)(x.A,{children:$e.getFieldValue("allocationPreset")}),(0,b.jsx)(be,{form:$e})]})}),(0,b.jsx)(le.A.Item,{label:Qe("session.launcher.NumberOfContainer"),children:1===$e.getFieldValue("cluster_size")?$e.getFieldValue("num_of_sessions"):$e.getFieldValue("cluster_size")}),(0,b.jsx)(le.A.Item,{label:Qe("session.launcher.ClusterMode"),children:"single-node"===$e.getFieldValue("cluster_mode")?Qe("session.launcher.SingleNode"):Qe("session.launcher.MultiNode")})]}),(0,b.jsx)(Y.A,{size:"small",type:"inner",title:Qe("session.launcher.TotalAllocation"),children:(0,b.jsx)(a.A,{direction:"row",gap:"xxs",children:(0,b.jsx)(be,{form:$e,containerCount:1===$e.getFieldValue("cluster_size")?$e.getFieldValue("num_of_sessions"):$e.getFieldValue("cluster_size")})})})]})}),(0,b.jsx)(t.A,{title:Qe("webui.menu.Data&Storage"),size:"small",status:$e.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:Qe("button.Edit"),onClickExtraButton:()=>{Xe(ns.findIndex((e=>"storage"===e.key)))},children:(0,b.jsxs)(a.A,{direction:"column",align:"stretch",gap:"xs",children:[(null===(Se=$e.getFieldValue("mounts"))||void 0===Se?void 0:Se.length)>0?(0,b.jsx)(ae.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:Qe("data.folders.Name")},{dataIndex:"alias",title:Qe("session.launcher.FolderAlias"),render:(e,s)=>A().isEmpty(e)?(0,b.jsx)(ee.A.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(s.name)}):e}],dataSource:A().map($e.getFieldValue("mounts"),(e=>{var s;return{name:e,alias:null===(s=$e.getFieldValue("vfoldersAliasMap"))||void 0===s?void 0:s[e]}}))}):(0,b.jsx)(ie.A,{type:"warning",showIcon:!0,message:Qe("session.launcher.NoFolderMounted")}),(null===(ke=$e.getFieldValue("autoMountedFolderNames"))||void 0===ke?void 0:ke.length)>0?(0,b.jsx)(le.A,{size:"small",children:(0,b.jsx)(le.A.Item,{label:Qe("data.AutomountFolders"),children:A().map($e.getFieldValue("autoMountedFolderNames"),(e=>(0,b.jsx)(x.A,{children:e})))})}):null]})}),(0,b.jsx)(t.A,{title:"Network",size:"small",status:$e.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:Qe("button.Edit"),onClickExtraButton:()=>{Xe(ns.findIndex((e=>"network"===e.key)))},children:(0,b.jsx)(le.A,{size:"small",children:(0,b.jsx)(le.A.Item,{label:Qe("session.launcher.PreOpenPortTitle"),children:(0,b.jsxs)(a.A,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[A().sortBy($e.getFieldValue("ports"),(e=>parseInt(e))).map((e=>(0,b.jsx)(T,{value:e,style:{margin:0},children:e}))),A().isArray($e.getFieldValue("ports"))&&0!==(null===(we=$e.getFieldValue("ports"))||void 0===we?void 0:we.length)?null:(0,b.jsx)(ee.A.Text,{type:"secondary",children:Qe("general.None")})]})})})})]}),(0,b.jsxs)(a.A,{direction:"row",justify:"between",children:[(0,b.jsx)(a.A,{gap:"sm",children:(0,b.jsx)(ce.A,{title:Qe("button.Reset"),description:Qe("session.launcher.ResetFormConfirm"),onConfirm:()=>{$e.resetFields(),We("/session/start")},icon:(0,b.jsx)(G.A,{style:{color:Ze.colorError}}),okText:Qe("button.Reset"),okButtonProps:{danger:!0},children:(0,b.jsx)(de.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:Qe("button.Reset")})})}),(0,b.jsxs)(a.A,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[ze>0&&(0,b.jsx)(de.Ay,{onClick:()=>{Xe(ze-1)},icon:(0,b.jsx)(W.A,{}),disabled:Ce,children:Qe("button.Previous")}),ze===ns.length-1?(0,b.jsx)(ue.A,{title:rs?Qe("session.launcher.PleaseCompleteForm"):void 0,children:(0,b.jsx)(de.Ay,{type:"primary",icon:(0,b.jsx)(U.A,{}),disabled:rs,onClick:()=>{Ne(!0),$e.validateFields().then((async e=>{if(A().isEmpty(e.mounts)||0===e.mounts.length){if(!await new Promise((e=>{Ee.modal.confirm({title:Qe("session.launcher.NoFolderMounted"),content:(0,b.jsxs)(b.Fragment,{children:[Qe("session.launcher.HomeDirectoryDeletionDialog"),(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),Qe("session.launcher.LaunchConfirmationDialog"),(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),Qe("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:Qe("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const s=e.environments.manual||e.environments.version;let[n,t]=s?s.split("@"):["",""];const r=A().isEmpty(e.sessionName)?fe():e.sessionName,o={kernelName:n,architecture:t,sessionName:r,config:{type:e.sessionType,...A().isEmpty(e.bootstrap_script)?{}:{bootstrap_script:e.bootstrap_script},..."batch"===e.sessionType?{startsAt:e.batch.enabled?e.batch.scheduleDate:void 0,startupCommand:e.batch.command}:{},group_name:He.name,domain:Pe._config.domainName,scaling_group:e.resourceGroup,cluster_mode:e.cluster_mode,cluster_size:e.cluster_size,maxWaitSeconds:15,cpu:e.resource.cpu,mem:e.resource.mem,shmem:(0,z.Mh)(e.resource.mem,"4g")>0&&(0,z.Mh)(e.resource.shmem,"1g")<0?"1g":e.resource.shmem,...e.resource.accelerator>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0,mounts:e.mounts,mount_map:e.vfoldersAliasMap,env:{...A().fromPairs(e.envvars.map((e=>[e.variable,e.value]))),...A().omit(e.hpcOptimization,"autoEnabled")},preopen_ports:w(e.ports)}},l=A().map(A().range(e.num_of_sessions||1),(s=>{const n=(e.num_of_sessions||1)>1?"".concat(o.sessionName,"-").concat((0,z.kX)(),"-").concat(s):o.sessionName;return Pe.createIfNotExists(o.kernelName,n,o.config,2e4,o.architecture).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(Qe("session.launcher.SessionAlreadyExists"));if("CANCELLED"===(null===e||void 0===e?void 0:e.status))throw new Error(Qe("session.launcher.FailedToStartNewSession"));return e})).catch((e=>{throw e}))}));Ue(Le||"/job"),Ke({key:"session-launcher:"+r,backgroundTask:{promise:Promise.all(l),status:"pending",statusDescriptions:{pending:Qe("session.PreparingSession"),resolved:Qe("eduapi.ComputeSessionPrepared")}},duration:0,message:Qe("general.Session")+": "+r,open:!0}),await Promise.all(l).then((s=>{let[n]=s;if(1===e.num_of_sessions&&"batch"!==e.sessionType){const e=n;let s=A().cloneDeep(Re);s="kernelId"in e?A().extend(s,{"session-name":e.kernelId,"access-key":"",mode:Ve}):A().extend(s,{"session-uuid":e.sessionId,"session-name":e.sessionName,"access-key":"",mode:Ve});const t=e.servicePorts;!0===Array.isArray(t)?s["app-services"]=t.map((e=>e.name)):s["app-services"]=[],t.length>0&&globalThis.appLauncher.showLauncher(s)}})).catch((()=>{}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{Ne(!1)}))},loading:Ce,children:Qe("session.launcher.Launch")})}):(0,b.jsxs)(de.Ay,{type:"primary",ghost:!0,onClick:()=>{Xe(ze+1)},children:[Qe("button.Next")," ",(0,b.jsx)(H.A,{})]}),ze!==ns.length-1&&(0,b.jsxs)(de.Ay,{onClick:()=>{Xe(ns.length-1)},children:[Qe("session.launcher.SkipToConfirmAndLaunch"),(0,b.jsx)(K.A,{})]})]})]})]})})})}),Ye.lg&&(0,b.jsx)(a.A,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,b.jsx)(me.A,{size:"small",direction:"vertical",current:ze,onChange:e=>{Xe(e)},items:A().map(ns,((e,s)=>({...e,status:s===ze?"process":"wait"})))})})]}),(0,b.jsx)(N,{open:is,onClose:()=>{as(!1)},scrollIntoViewOptions:!0})]})}}}]);
//# sourceMappingURL=4943.aa766501.chunk.js.map