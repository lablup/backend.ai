python_sources(
    name="src",
    dependencies=[
        ":resources",
        "stubs/trafaret:stubs",
    ],
)

visibility_private_component(
    allowed_dependents=[
        "//src/ai/backend/**",
    ],
    allowed_dependencies=[
        "//src/ai/backend/**",
        "!//src/ai/backend/account_manager/**",
        "!//src/ai/backend/web/**",
        "!//src/ai/backend/manager/**",
        "!//src/ai/backend/agent/**",
        "!//src/ai/backend/storage/**",
        "!//src/ai/backend/wsproxy/**",
    ],
)

python_distribution(
    name="dist",
    dependencies=[
        ":src",
        "src/ai/backend/common/auth:src",
        "src/ai/backend/common/bgtask:src",
        "src/ai/backend/common/clients/valkey_client:src",
        "src/ai/backend/common/clients/valkey_client/valkey_image:src",
        "src/ai/backend/common/clients/valkey_client/valkey_live:src",
        "src/ai/backend/common/clients/valkey_client/valkey_rate_limit:src",
        "src/ai/backend/common/clients/valkey_client/valkey_stat:src",
        "src/ai/backend/common/clients/valkey_client/valkey_stream:src",
        "src/ai/backend/common/configs:src",
        "src/ai/backend/common/contexts:src",
        "src/ai/backend/common/data/session:src",
        "src/ai/backend/common/data/vfolder:src",
        "src/ai/backend/common/dto/agent:src",
        "src/ai/backend/common/dto/manager:src",
        "src/ai/backend/common/dto/manager/auth:src",
        "src/ai/backend/common/dto/storage:src",
        "src/ai/backend/common/events:src",
        "src/ai/backend/common/events/event_types:src",
        "src/ai/backend/common/events/event_types/agent:src",
        "src/ai/backend/common/events/event_types/bgtask:src",
        "src/ai/backend/common/events/event_types/idle:src",
        "src/ai/backend/common/events/event_types/image:src",
        "src/ai/backend/common/events/event_types/kernel:src",
        "src/ai/backend/common/events/event_types/log:src",
        "src/ai/backend/common/events/event_types/model_serving:src",
        "src/ai/backend/common/events/event_types/schedule:src",
        "src/ai/backend/common/events/event_types/session:src",
        "src/ai/backend/common/events/event_types/vfolder:src",
        "src/ai/backend/common/events/event_types/volume:src",
        "src/ai/backend/common/events/hub:src",
        "src/ai/backend/common/events/hub/propagators:src",
        "src/ai/backend/common/events/user_event:src",
        "src/ai/backend/common/message_queue:src",
        "src/ai/backend/common/middlewares:src",
        "src/ai/backend/common/metrics:src",
        "src/ai/backend/common/plugin:src",
        "src/ai/backend/common/service_discovery:src",
        "src/ai/backend/common/service_discovery/etcd_discovery:src",
        "src/ai/backend/common/service_discovery/redis_discovery:src",
        "src/ai/backend/common/stage:src",
        "src/ai/backend/common/observer:src",
        "src/ai/backend/common/resource:src",
        "src/ai/backend/common/runner:src",
        "src/ai/backend/common/web/session:src",  # not auto-inferred
        "!!stubs/trafaret:stubs",
    ],
    provides=python_artifact(
        name="backend.ai-common",
        description="Backend.AI commons library",
        license="LGPLv3",
    ),
    generate_setup=True,
    tags=["wheel"],
)

resource(name="version", source="VERSION")

resources(
    name="resources",
    dependencies=[
        ":version",
    ],
    sources=[
        "**/py.typed",
    ],
)
