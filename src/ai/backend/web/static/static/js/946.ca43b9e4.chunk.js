"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[946],{7007:function(e,n,i){var t=i(5870),r=i(9277),l=i(2048),o=i.n(l),a=i(4519),s=i(2556);n.Z=function(e){var n,i=e.values,l=void 0===i?[]:i;return 0===l.length?null:(n=l[0]&&("string"===typeof l[0]||a.isValidElement(l[0]))?l.map((function(e){return{label:e,color:"blue"}})):l,(0,s.jsx)(r.Z,{direction:"row",children:o().map(n,(function(e,i){return(0,s.jsx)(t.Z,{style:o().last(n)===e?void 0:{margin:0,marginRight:-1,zIndex:1},children:e.label},i)}))}))}},6451:function(e,n,i){var t,r=i(5870),l=(i(4519),i(6980)),o=i(2556);n.Z=function(e){var n,a=e.endpointFrgmt,s=(0,l.useFragment)(void 0!==t?t:t=i(8393),a),u="default";if("RUNNING"===(null===s||void 0===s||null===(n=s.status)||void 0===n?void 0:n.toUpperCase()))u="success";return(0,o.jsx)(r.Z,{color:u,children:null===s||void 0===s?void 0:s.status})}},9277:function(e,n,i){var t=i(1413),r=i(4925),l=i(4036),o=(i(4519),i(2556)),a=["direction","wrap","justify","align","gap","style","children"];n.Z=function(e){var n=e.direction,i=void 0===n?"row":n,s=e.wrap,u=void 0===s?"nowrap":s,d=e.justify,c=void 0===d?"flex-start":d,m=e.align,g=void 0===m?"center":m,v=e.gap,f=void 0===v?0:v,p=e.style,h=e.children,y=(0,r.Z)(e,a),x=l.Z.useToken().token,j=[c,g],S=null===j||void 0===j?void 0:j.map((function(e){var n;switch(e){case"start":n="flex-start";break;case"end":n="flex-end";break;case"between":n="space-between";break;case"around":n="space-around";break;default:n=e}return n})),Z=(0,t.Z)({display:"flex",flexDirection:i,flexWrap:u,justifyContent:S[0],alignItems:S[1]},p);return(0,o.jsx)("div",(0,t.Z)((0,t.Z)({style:(0,t.Z)({alignItems:"stretch",backgroundColor:"transparent",border:"0 solid black",boxSizing:"border-box",display:"flex",flexBasis:"auto",flexDirection:"column",flexShrink:0,listStyle:"none",margin:0,minHeight:0,minWidth:0,padding:0,position:"relative",textDecoration:"none",gap:"string"===typeof f?x["padding"+f.toUpperCase()]:f},Z)},y),{},{children:h}))}},6228:function(e,n,i){var t=i(1413),r=i(9277),l=i(2064),o=i(7171),a=(i(4519),i(2556));n.Z=function(e){var n=e.style,i=e.children;return(0,a.jsxs)(r.Z,{direction:"row",justify:"center",align:"center",style:(0,t.Z)({width:"100%",height:"100%"},n),children:[(0,a.jsx)(o.Z,{indicator:(0,a.jsx)(l.Z,{spin:!0})}),i]})}},4001:function(e,n,i){var t=i(1413),r=i(9439),l=i(4519),o=i(7760),a=i(2556),s=function(e,n){var i=e.image,l=e.style,s=void 0===l?{}:l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=(0,o.dS)(),c=(0,r.Z)(d,2)[1].getImageIcon;return(0,a.jsx)("img",{src:c(i),style:(0,t.Z)({width:"1.5em",height:"1.5em"},s),alt:u})};n.Z=l.memo(s)},6587:function(e,n,i){var t,r=i(1413),l=i(9439),o=i(4925),a=(i(4519),i(4036)),s=i(3572),u=i(3842),d=i(6653),c=i(1748),m=i(7760),g=i(3255),v=i(164),f=i(9277),p=i(6980),h=i(2556),y=["onRequestClose","endpointFrgmt"];n.Z=function(e){var n=e.onRequestClose,x=e.endpointFrgmt,j=(0,o.Z)(e,y),S=a.Z.useToken().token,Z=(0,m.Dj)(),k=(0,c.$G)().t,b=s.Z.useForm(),F=(0,l.Z)(b,1)[0],_=(0,p.useFragment)(void 0!==t?t:t=i(6326),x),I=(0,v.Y)({mutationFn:function(e){var n={to:e.desired_session_count};return(0,g.Lc)({method:"POST",url:"/services/".concat(null===_||void 0===_?void 0:_.endpoint_id,"/scale"),body:n,client:Z})}});return(0,h.jsx)(u.Z,(0,r.Z)((0,r.Z)({},j),{},{style:{zIndex:1e4},destroyOnClose:!0,onOk:function(e){F.validateFields().then((function(e){I.mutate(e,{onSuccess:function(){console.log("service updated"),n(!0)},onError:function(e){console.log(e)}})})).catch((function(e){console.log(e)}))},onCancel:function(){n()},okButtonProps:{loading:I.isLoading},title:k("modelService.EditModelService"),children:(0,h.jsx)(f.Z,{direction:"row",align:"stretch",justify:"around",children:(0,h.jsx)(s.Z,{form:F,preserve:!1,validateTrigger:["onChange","onBlur"],initialValues:{desired_session_count:null===_||void 0===_?void 0:_.desired_session_count},style:{marginBottom:S.marginLG,marginTop:S.margin},children:(0,h.jsx)(s.Z.Item,{name:"desired_session_count",label:k("modelService.DesiredSessionCount"),rules:[{pattern:/^[0-9]+$/,message:k("modelService.OnlyAllowsNonNegativeIntegers")}],children:(0,h.jsx)(d.Z,{type:"number",min:0})})})})}))}},8393:function(e,n,i){i.r(n);var t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointStatusTagFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"3b31efa50b55edddcb210b59003dc479"};n.default=t},1947:function(e,n,i){i.r(n);var t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},i=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:i,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:i},params:{cacheID:"ea71f4a3948d4742dd6bb11ef80a8300",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:"query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    name\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n  }\n}\n"}}}();t.hash="33367bd6e1532b42b61629ef9d3dc46b",n.default=t},6326:function(e,n,i){i.r(n);var t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ModelServiceSettingModal_endpoint",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"881f18324b27eba6ff0fcfb83ae241d2"};n.default=t},3255:function(e,n,i){i.d(n,{Hz:function(){return u},Lc:function(){return o},Uz:function(){return d},VQ:function(){return c},We:function(){return l},en:function(){return s},lA:function(){return m},y3:function(){return a}});var t=i(7760),r=i(2556),l=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/(<br\s*\/?>|\n)/;return e.split(n).map((function(e,i){return e.match(n)?(0,r.jsx)("br",{},i):e}))},o=function(e){var n=e.method,i=e.url,t=e.body,r=void 0===t?null:t,l=e.client,o=null===l||void 0===l?void 0:l.newSignedRequest(n,i,r,null);return null===l||void 0===l?void 0:l._wrapWithPromise(o)},a=function(){var e=(0,t.Dj)();return function(n){var i=n.method,t=n.url,r=n.body;return o({method:i,url:t,body:void 0===r?null:r,client:e})}},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var i=Math.pow(10,3);n=n<0?0:n;var t=Math.floor(Math.log(Math.round(e))/Math.log(i));return t=t<0?0:t,parseFloat((e/Math.pow(i,t)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB"][t]},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=Math.pow(10,9);return Math.round(n*e)},d=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null===e||void 0===e?arguments.length>2&&void 0!==arguments[2]?arguments[2]:"-":e?(e/Math.pow(10,9)).toFixed(n):e},c=function(e,n){return""===n||void 0===n?"":n.startsWith("".concat(e,":"))?n:"".concat(e,":").concat(n)},m=function(e){return e<70?"rgba(58, 178, 97, 1)":e<90?"rgb(223, 179, 23)":"#ef5350"}},7760:function(e,n,i){i.d(n,{Dj:function(){return d},Kr:function(){return o},M:function(){return u},dS:function(){return c},qh:function(){return s},tQ:function(){return a}});var t=i(9439),r=i(4519),l=i(7112),o=function(e){return function(e){var n=(0,r.useState)(e||(new Date).toISOString()),i=(0,t.Z)(n,2),l=i[0],o=i[1];return[l,function(e){o(e||(new Date).toISOString())}]}(e)},a=function(){return d()._config.domainName},s=function(){var e=d(),n=(0,r.useState)({name:e.current_group,id:e.groupIds[e.current_group]}),i=(0,t.Z)(n,2),l=i[0],o=i[1];return(0,r.useEffect)((function(){var n=function(n){var i=n.detail;o({name:i,id:e.groupIds[i]})};return document.addEventListener("backend-ai-group-changed",n),function(){document.removeEventListener("backend-ai-group-changed",n)}})),l},u=function(e){var n=e.api_endpoint;return(0,r.useMemo)((function(){var e=new globalThis.BackendAIClientConfig("","",n,"SESSION");return new globalThis.BackendAIClient(e,"Backend.AI Console.")}),[n])},d=function(){return(0,l.useQuery)({queryKey:"backendai-client-for-suspense",queryFn:function(){return new Promise((function(e){if("undefined"!==typeof globalThis.backendaiclient&&null!==globalThis.backendaiclient&&!1!==globalThis.backendaiclient.ready)return e(globalThis.backendaiclient);document.addEventListener("backend-ai-connected",(function n(){e(globalThis.backendaiclient),document.removeEventListener("backend-ai-connected",n)}))}))},retry:!1,suspense:!0}).data},c=function(){var e=(0,l.useQuery)({queryKey:"backendai-metadata-for-suspense",queryFn:function(){return fetch("resources/image_metadata.json").then((function(e){return e.json()})).then((function(e){return e}))},suspense:!0,retry:!1}).data,n=function(e){if(!e)return{key:"",tags:[]};var n=e.split("/"),i=(n[2]||n[1]).split(":"),r=(0,t.Z)(i,2);return{key:r[0],tags:r[1].split("-")}};return[e,{getImageAliasName:function(i){var t=n(i).key;return(null===e||void 0===e?void 0:e.imageInfo[t].name)||t},getImageIcon:function(i){var t,r,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resources/icons/";if(!i)return"default.png";var o=n(i).key;return l+(void 0!==(null===e||void 0===e||null===(t=e.imageInfo[o])||void 0===t?void 0:t.icon)?null===e||void 0===e||null===(r=e.imageInfo[o])||void 0===r?void 0:r.icon:"default.png")},getImageTags:function(e){},getBaseVersion:function(e){return n(e).tags[0]},getBaseImage:function(e){return n(e).tags[1]},getImageMeta:n}]}},164:function(e,n,i){i.d(n,{Y:function(){return l},h:function(){return r}});var t=i(7112),r=t.useQuery,l=t.useMutation},1946:function(e,n,i){i.r(n),i.d(n,{default:function(){return te}});var t,r=i(9439),l=i(4036),o=i(7600),a=i(2513),s=i(3510),u=i(8499),d=i(3842),c=i(4519),m=i(9277),g=i(1748),v=i(1413),f=i(4925),p=i(3572),h=i(4787),y=i(8818),x=i(2708),j=i(3066),S=i(7760),Z=i(1603),k=i(6653),b=i(2556),F=["name","min","max","step","rules","required","inputNumberProps","sliderProps"],_=function(e){var n=e.name,i=e.min,t=e.max,r=e.step,l=e.rules,o=e.required,a=e.inputNumberProps,s=e.sliderProps,u=(0,f.Z)(e,F);return(0,b.jsx)(p.Z.Item,(0,v.Z)((0,v.Z)({required:o},u),{},{children:(0,b.jsxs)(m.Z,{direction:"row",gap:"md",children:[(0,b.jsx)(m.Z,{direction:"column",align:"stretch",style:{flex:3},children:(0,b.jsx)(p.Z.Item,{name:n,noStyle:!0,rules:l,children:(0,b.jsx)(Z.Z,(0,v.Z)({max:t,min:i,step:r},s))})}),(0,b.jsx)(m.Z,{style:{flex:2},children:(0,b.jsx)(p.Z.Item,{name:n,noStyle:!0,children:(0,b.jsx)(k.Z,(0,v.Z)({max:t,min:i,step:r},a))})})]})}))},I=i(4506),K=i(6980),w=i(2048),T=i.n(w),C=i(1312),L=i(5870),q=i(3799),N=i(4001),E=function(e){var n=e.children,i=e.keyword,t=e.style;if(!n)return null;var r=n.toLowerCase().indexOf(null===i||void 0===i?void 0:i.toLowerCase()),o=(l.Z.useToken()||"#F1A239").token;return r>=0?(0,b.jsxs)("span",{children:[n.substring(0,r),(0,b.jsx)("span",{style:(0,v.Z)({backgroundColor:o.colorWarningHover},t),children:n.substring(r,r+i.length)}),n.substring(r+i.length)]}):(0,b.jsx)("span",{children:n})},D=i(7007),P=function(e){return e?"".concat(e.registry,"/").concat(e.name,":").concat(e.tag,"@").concat(e.architecture):void 0};var M,R=function(e){var n=e.filter,o=p.Z.useFormInstance(),a=p.Z.useWatch("environments",o),s=(0,c.useState)(""),u=(0,r.Z)(s,2),d=u[0],v=u[1],f=(0,c.useState)(""),h=(0,r.Z)(f,2),x=h[0],j=h[1],Z=(0,g.$G)().t,k=(0,S.dS)(),F=(0,r.Z)(k,2),_=F[0],w=F[1].getImageMeta,M=l.Z.useToken().token,R=(0,c.useRef)(null),B=(0,K.useLazyLoadQuery)(void 0!==t?t:t=i(1947),{installed:!0},{fetchPolicy:"store-and-network"}).images;(0,c.useEffect)((function(){var e,n,i,t,r=(null===a||void 0===a?void 0:a.environment)||(null===(e=V[0])||void 0===e||null===(n=e.environmentGroups[0])||void 0===n?void 0:n.environmentName);if(T().find(V,(function(e){return T().find(e.environmentGroups,(function(e){return e.environmentName===r&&(t=e,!0)}))})),!T().find(null===(i=t)||void 0===i?void 0:i.images,(function(e){return(null===a||void 0===a?void 0:a.version)===P(e)}))){var l,s=null===(l=t)||void 0===l?void 0:l.images[0];s&&o.setFieldsValue({environments:{environment:r,version:P(s),image:s}})}}),[null===a||void 0===a?void 0:a.environment]);var V=(0,c.useMemo)((function(){return T().chain(B).filter(n||function(){return!0}).groupBy((function(e){var n;return(null===_||void 0===_||null===(n=_.imageInfo[w(P(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map((function(e,n){return{groupName:n,environmentGroups:T().chain(e).groupBy((function(e){return null===e||void 0===e?void 0:e.name})).map((function(e,n){var i,t,r;return{environmentName:n,displayName:(null===_||void 0===_||null===(i=_.imageInfo[null===(t=n.split("/"))||void 0===t?void 0:t[1]])||void 0===i?void 0:i.name)||n,prefix:null===(r=n.split("/"))||void 0===r?void 0:r[0],images:e.sort((function(e,n){var i,t,r,l,o,a;return function(e,n){for(var i=e.split(".").map(Number),t=n.split(".").map(Number),r=0;r<Math.max(i.length,t.length);r++){var l=i[r]||0,o=t[r]||0;if(l>o)return 1;if(l<o)return-1}return 0}(null!==(i=null===n||void 0===n||null===(t=n.tag)||void 0===t||null===(r=t.split("-"))||void 0===r?void 0:r[0])&&void 0!==i?i:"",null!==(l=null===e||void 0===e||null===(o=e.tag)||void 0===o||null===(a=o.split("-"))||void 0===a?void 0:a[0])&&void 0!==l?l:"")}))}})).sortBy((function(e){return e.displayName})).value()}})).sortBy((function(e){return e.groupName})).value()}),[B,_,n]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.Z.Item,{name:["environments","environment"],label:"".concat(Z("session.launcher.Environments")," / ").concat(Z("session.launcher.Version")),rules:[{required:!0}],style:{marginBottom:10},children:(0,b.jsx)(C.Z,{showSearch:!0,labelInValue:!1,searchValue:d,onSearch:v,defaultActiveFirstOption:!0,optionLabelProp:"label",optionFilterProp:"filterValue",onSelect:function(){},children:T().map(V,(function(e){return(0,b.jsx)(C.Z.OptGroup,{label:e.groupName,children:T().map(e.environmentGroups,(function(e){var n,i=e.images[0],t=null===_||void 0===_?void 0:_.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[1]],r=[],l=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(r.push(e.prefix),l=(0,b.jsx)(L.Z,{color:"purple",children:e.prefix}));var o=T().map(null===t||void 0===t?void 0:t.label,(function(e){return T().isUndefined(e.category)&&e.tag&&e.color?(r.push(e.tag),(0,b.jsx)(L.Z,{color:e.color,children:(0,b.jsx)(E,{keyword:d,children:e.tag})})):null}));return(0,b.jsx)(C.Z.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+r.join("\t"),label:(0,b.jsx)(m.Z,{direction:"row",children:(0,b.jsxs)(m.Z,{direction:"row",align:"center",gap:"xs",children:[(0,b.jsx)(N.Z,{image:P(i)||"",style:{width:15,height:15}}),e.displayName]})}),children:(0,b.jsxs)(m.Z,{direction:"row",justify:"between",children:[(0,b.jsxs)(m.Z,{direction:"row",align:"center",gap:"xs",children:[(0,b.jsx)(N.Z,{image:P(i)||"",style:{width:15,height:15}}),(0,b.jsx)(E,{keyword:d,children:e.displayName})]}),l,o]})},e.environmentName)}))},e.groupName)}))})}),(0,b.jsx)(p.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,t;return(null===(i=e.environments)||void 0===i?void 0:i.environments)!==(null===(t=n.environments)||void 0===t?void 0:t.environment)},children:function(e){var n,i,t=e.getFieldValue;return T().find(V,(function(e){return T().find(e.environmentGroups,(function(e){var n;return e.environmentName===(null===(n=t("environments"))||void 0===n?void 0:n.environment)&&(i=e,!0)}))})),(0,b.jsx)(p.Z.Item,{name:["environments","version"],rules:[{required:!0}],children:(0,b.jsx)(C.Z,{ref:R,onChange:function(){},showSearch:!0,searchValue:x,onSearch:j,optionFilterProp:"filterValue",optionLabelProp:"label",dropdownRender:function(e){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(m.Z,{style:{fontWeight:M.fontWeightStrong,paddingLeft:M.paddingSM},children:[Z("session.launcher.Version"),(0,b.jsx)(q.Z,{type:"vertical"}),Z("session.launcher.Base"),(0,b.jsx)(q.Z,{type:"vertical"}),Z("session.launcher.Architecture"),(0,b.jsx)(q.Z,{type:"vertical"}),Z("session.launcher.Requirements")]}),(0,b.jsx)(q.Z,{style:{margin:"8px 0"}}),e]})},children:T().map(T().uniqBy(null===(n=i)||void 0===n?void 0:n.images,"digest"),(function(e){var n,i=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""],t=(0,I.Z)(i),l=t[0],o=t[1],a=t.slice(2),s=null===_||void 0===_?void 0:_.tagAlias[o];if(!s){for(var u=0,d=Object.entries((null===_||void 0===_?void 0:_.tagReplace)||{});u<d.length;u++){var c=(0,r.Z)(d[u],2),g=c[0],v=c[1],f=new RegExp(g);f.test(o)&&(s=null===o||void 0===o?void 0:o.replace(f,v))}s||(s=o)}var p=[],h=a.length>0?(0,b.jsx)(m.Z,{direction:"row",wrap:"wrap",style:{flex:1},gap:"xxs",children:T().map(a,(function(e,n){var i;return(0,b.jsx)(D.Z,{values:(null===_||void 0===_||null===(i=_.tagAlias[e])||void 0===i?void 0:i.split(":").map((function(e){return p.push(e),(0,b.jsx)(E,{keyword:x,children:e})})))||a},n)}))}):"-";return(0,b.jsx)(C.Z.Option,{value:P(e),filterValue:[l,s,null===e||void 0===e?void 0:e.architecture].concat(p).join("\t"),label:[l,s,null===e||void 0===e?void 0:e.architecture,a.length>0?a.join(", "):"-"].join(" | "),children:(0,b.jsxs)(m.Z,{direction:"row",children:[(0,b.jsx)(E,{keyword:x,children:l}),(0,b.jsx)(q.Z,{type:"vertical"}),(0,b.jsx)(E,{keyword:x,children:s}),(0,b.jsx)(q.Z,{type:"vertical"}),(0,b.jsx)(E,{keyword:x,children:null===e||void 0===e?void 0:e.architecture}),(0,b.jsx)(q.Z,{type:"vertical"}),h]})},null===e||void 0===e?void 0:e.digest)}))})})}}),(0,b.jsx)(p.Z.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,b.jsx)(y.Z,{})})]})},B=i(6228),V=i(3255),A=i(164),G=["projectId","autoSelectDefault","filter"],O=function(e){e.projectId;var n=e.autoSelectDefault,i=(e.filter,(0,f.Z)(e,G)),t=(0,V.y3)(),l=(0,S.qh)(),o=(0,S.Kr)("first"),a=(0,r.Z)(o,2),s=a[0],u=a[1],d=(0,A.h)({queryKey:["ResourceGroupSelectorQuery",s],queryFn:function(){return t({method:"GET",url:"/scaling-groups?group=".concat(l.name)})},staleTime:0}).data,m=(null===d||void 0===d?void 0:d.scaling_groups)||[],g=m[0]?{label:m[0].name,value:m[0].name}:void 0;return(0,c.useEffect)((function(){var e;n&&g&&(null===(e=i.onChange)||void 0===e||e.call(i,g.value,g))}),[n]),(0,b.jsx)(C.Z,(0,v.Z)((0,v.Z)({defaultActiveFirstOption:!0,defaultValue:n?g:void 0,onDropdownVisibleChange:function(e){e&&(0,c.startTransition)((function(){u()}))}},i),{},{children:T().map(m,(function(e,n){return(0,b.jsx)(C.Z.Option,{value:e.name,children:e.name},e.name)}))}))},Q=["filter","autoSelectDefault"],z=function(e){var n,i,t=e.filter,l=e.autoSelectDefault,o=(0,f.Z)(e,Q),a=(0,S.qh)(),s=(0,V.y3)(),u=(0,S.Kr)("first"),d=(0,r.Z)(u,2),m=d[0],g=d[1],p=(0,A.h)({queryKey:["VFolderSelectQuery",m],queryFn:function(){return s({method:"GET",url:"/folders?group_id=".concat(a.id)})},staleTime:0}).data,h=t?T().filter(p,t):p,y=T().first(h)?{label:null===(n=T().first(h))||void 0===n?void 0:n.name,value:null===(i=T().first(h))||void 0===i?void 0:i.name}:void 0;return(0,c.useEffect)((function(){var e;l&&y&&(null===(e=o.onChange)||void 0===e||e.call(o,y.value,y))}),[l]),(0,b.jsx)(C.Z,(0,v.Z)((0,v.Z)({showSearch:!0},o),{},{onDropdownVisibleChange:function(e){e&&(0,c.startTransition)((function(){g()}))},children:T().map(h,(function(e){return(0,b.jsx)(C.Z.Option,{value:null===e||void 0===e?void 0:e.name,children:null===e||void 0===e?void 0:e.name},null===e||void 0===e?void 0:e.id)}))}))},U=["extraP","onRequestClose"],$=function(e){e.extraP;var n=e.onRequestClose,i=(0,f.Z)(e,U),t=(0,g.$G)().t,o=l.Z.useToken().token,a=(0,S.Dj)(),s=(0,S.tQ)(),u=p.Z.useForm(),m=(0,r.Z)(u,1)[0],Z=function(){var e=(0,S.Kr)("first"),n=(0,r.Z)(e,2),i=n[0],t=n[1],l=(0,V.y3)();return[(0,A.h)({queryKey:["useResourceSlots",i],queryFn:function(){return l({method:"GET",url:"/config/resource-slots"})},staleTime:0}).data,{refresh:function(){return t()}}]}(),k=(0,r.Z)(Z,1)[0],F=(0,A.Y)({mutationFn:function(e){var n,i,t,r,l="".concat(null===(n=e.environments.image)||void 0===n?void 0:n.registry,"/").concat(null===(i=e.environments.image)||void 0===i?void 0:i.name,":").concat(null===(t=e.environments.image)||void 0===t?void 0:t.tag),o={name:e.serviceName,desired_session_count:e.desiredRoutingCount,image:l,arch:null===(r=e.environments.image)||void 0===r?void 0:r.architecture,group:a.current_group,domain:s,cluster_size:1,cluster_mode:"single-node",open_to_public:e.openToPublic,config:{model:e.vFolderName,model_mount_destination:"/models",environ:{},scaling_group:e.resourceGroup,resources:{cpu:e.cpu,mem:e.mem+"G"}}};return"shares"===(null===k||void 0===k?void 0:k.cuda)&&(o.config.resources["cuda.shares"]=e.gpu),"device"===(null===k||void 0===k?void 0:k.cuda)&&(o.config.resources["cuda.device"]=e.gpu),e.shmem&&e.shmem>0&&(o.config.resource_opts={shmem:e.shmem}),(0,V.Lc)({method:"POST",url:"/services",body:o,client:a})}});return(0,b.jsx)(d.Z,(0,v.Z)((0,v.Z)({title:t("modelService.StartNewServing"),onOk:function(){m.validateFields().then((function(e){F.mutate(e,{onSuccess:function(){n(!0)},onError:function(e){h.ZP.error(t("modelService.FailedToStartService"))}}),new Promise((function(e,n){})).then((function(){n(!0)}))}))},onCancel:function(){n()},destroyOnClose:!0,maskClosable:!1,confirmLoading:F.isLoading},i),{},{children:(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)(B.Z,{}),children:(0,b.jsxs)(p.Z,{disabled:F.isLoading,form:m,preserve:!1,layout:"vertical",labelCol:{span:12},initialValues:{cpu:1,gpu:0,mem:.25,shmem:0,desiredRoutingCount:1},children:[(0,b.jsx)(p.Z.Item,{label:t("modelService.ServiceName"),name:"serviceName",rules:[{max:20}],children:(0,b.jsx)(y.Z,{})}),(0,b.jsx)(p.Z.Item,{name:"resourceGroup",label:t("session.ResourceGroup"),rules:[{required:!0}],children:(0,b.jsx)(O,{autoSelectDefault:!0})}),(0,b.jsx)(p.Z.Item,{name:"openToPublic",label:t("modelService.OpenToPublic"),valuePropName:"checked",children:(0,b.jsx)(x.Z,{})}),(0,b.jsx)(p.Z.Item,{name:"vFolderName",label:t("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,b.jsx)(z,{filter:function(e){return"model"===e.usage_mode},autoSelectDefault:!0})}),(0,b.jsx)(_,{label:t("modelService.DesiredRoutingCount"),name:"desiredRoutingCount",rules:[{required:!0}],inputNumberProps:{addonAfter:"#"},required:!0}),(0,b.jsxs)(j.Z,{style:{marginBottom:o.margin},children:[(0,b.jsx)(R,{}),(0,b.jsx)(p.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,t,r,l;return(null===(i=e.environments)||void 0===i||null===(t=i.image)||void 0===t?void 0:t.digest)!==(null===(r=n.environments)||void 0===r||null===(l=r.image)||void 0===l?void 0:l.digest)},children:function(e){var n,i,r,l=null===(n=(0,e.getFieldValue)("environments"))||void 0===n?void 0:n.image;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(_,{name:"cpu",label:t("session.launcher.CPU"),tooltip:(0,b.jsx)(g.cC,{i18nKey:"session.launcher.DescCPU"}),min:parseInt((null===(i=T().find(null===l||void 0===l?void 0:l.resource_limits,(function(e){return"cpu"===(null===e||void 0===e?void 0:e.key)})))||void 0===i?void 0:i.min)||"0"),max:parseInt((null===(r=T().find(null===l||void 0===l?void 0:l.resource_limits,(function(e){return"cpu"===(null===e||void 0===e?void 0:e.key)})))||void 0===r?void 0:r.max)||"100"),inputNumberProps:{addonAfter:t("session.launcher.Core")},required:!0,rules:[{required:!0}]}),(0,b.jsx)(_,{name:"mem",label:t("session.launcher.Memory"),tooltip:(0,b.jsx)(g.cC,{i18nKey:"session.launcher.DescMemory"}),max:30,inputNumberProps:{addonAfter:"GB"},step:.05,required:!0,rules:[{required:!0}]}),(0,b.jsx)(_,{name:"shmem",label:t("session.launcher.SharedMemory"),tooltip:(0,b.jsx)(g.cC,{i18nKey:"session.launcher.DescSharedMemory"}),max:30,step:.1,inputNumberProps:{addonAfter:"GB"},required:!0,rules:[{required:!0}]}),void 0!==k.cuda?(0,b.jsx)(_,{style:{marginBottom:0},name:"gpu",label:t("session.launcher.AIAccelerator"),tooltip:(0,b.jsx)(g.cC,{i18nKey:"session.launcher.DescAIAccelerator"}),max:30,step:.1,inputNumberProps:{addonAfter:"GPU"},required:!0,rules:[{required:!0}]}):(0,b.jsx)(b.Fragment,{})]})}})]})]})})}))},W=i(6587),Y=i(7477),H=i(3596),J=i(8501),X=i(3861),ee=i(1662),ne=i(1843),ie=i(6451),te=function(e){e.children;var n=(0,g.$G)().t,t=(0,S.Dj)(),v=l.Z.useToken().token,f=(0,S.qh)(),p=(0,c.useState)(!1),h=(0,r.Z)(p,2),y=h[0],x=h[1],j=(0,c.useState)(),Z=(0,r.Z)(j,2),k=Z[0],F=Z[1],_=(0,c.useState)(!1),I=(0,r.Z)(_,2),w=I[0],C=I[1],L=(0,c.useState)({current:1,pageSize:100}),q=(0,r.Z)(L,1)[0],N=(0,c.useTransition)(),E=(0,r.Z)(N,2),D=E[0],P=E[1],R=(0,c.useState)(!1),B=(0,r.Z)(R,2),G=B[0],O=B[1],Q=(0,S.Kr)("initial-fetch"),z=(0,r.Z)(Q,2),U=z[0],te=z[1],re=(0,c.useState)("services"),le=(0,r.Z)(re,2),oe=le[0],ae=le[1];(0,Y.Z)((function(){(0,c.startTransition)((function(){te()}))}),7e3);var se=(0,K.useLazyLoadQuery)(void 0!==M?M:M=i(6142),{offset:(q.current-1)*q.pageSize,limit:q.pageSize,projectID:f.id},{fetchPolicy:"initial-fetch"===U?"store-and-network":"network-only",fetchKey:U}).endpoint_list,ue=T().sortBy(null===se||void 0===se?void 0:se.items,"name"),de=(0,A.Y)({mutationFn:function(){return(0,V.Lc)({method:"DELETE",url:"/services/"+(null===k||void 0===k?void 0:k.endpoint_id),client:t})}});return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.Z,{direction:"column",align:"stretch",style:{padding:v.padding,gap:v.margin},children:(0,b.jsxs)(m.Z,{direction:"column",align:"stretch",children:[(0,b.jsx)(m.Z,{style:{flex:1},children:(0,b.jsx)(o.Z,{activeKey:oe,onChange:function(e){return ae(e)},tabBarStyle:{marginBottom:0},style:{width:"100%",paddingLeft:v.paddingMD,paddingRight:v.paddingMD,borderTopLeftRadius:v.borderRadius,borderTopRightRadius:v.borderRadius},items:[{key:"services",label:n("modelService.Services")}],tabBarExtraContent:{right:(0,b.jsx)(a.ZP,{type:"primary",onClick:function(){x(!0)},children:n("modelService.StartService")})}})}),(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{children:"loading.."}),children:(0,b.jsx)(s.Z,{loading:D,scroll:{x:"max-content"},dataSource:ue||[],columns:[{title:n("modelService.EndpointName"),dataIndex:"endpoint_id",fixed:"left",render:function(e,n){return(0,b.jsx)(ne.rU,{to:"/serving/"+e,children:n.name})}},{title:n("modelService.EndpointId"),dataIndex:"endpoint_id",width:310,render:function(e){return(0,b.jsx)(u.Z.Text,{code:!0,children:e})}},{title:n("modelService.Controls"),dataIndex:"controls",render:function(e,n){return(0,b.jsxs)(m.Z,{direction:"row",align:"stretch",children:[(0,b.jsx)(a.ZP,{type:"text",icon:(0,b.jsx)(H.Z,{}),style:n.desired_session_count>0?{color:"#29b6f6"}:void 0,disabled:n.desired_session_count<0,onClick:function(){C(!0),F(n)}}),(0,b.jsx)(a.ZP,{type:"text",icon:(0,b.jsx)(J.Z,{style:n.desired_session_count>0?{color:v.colorError}:void 0}),disabled:n.desired_session_count<0,onClick:function(){O(!0),F(n)}})]})}},{title:n("modelService.Status"),render:function(e,n){return(0,b.jsx)(ie.Z,{endpointFrgmt:n})}},{title:n("modelService.DesiredSessionCount"),dataIndex:"desired_session_count",render:function(e){return e<0?"-":e}},{title:(0,b.jsxs)(m.Z,{direction:"column",align:"start",children:[n("modelService.RoutingsCount"),(0,b.jsx)("br",{}),(0,b.jsxs)(u.Z.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",n("modelService.Active/Total"),")"]})]}),render:function(e,n){var i;return T().filter(n.routings,(function(e){return"HEALTHY"===(null===e||void 0===e?void 0:e.status)})).length+" / "+(null===(i=n.routings)||void 0===i?void 0:i.length)}},{title:n("modelService.Public"),render:function(e,n){return n.open_to_public?(0,b.jsx)(X.Z,{style:{color:v.colorSuccess}}):(0,b.jsx)(ee.Z,{style:{color:v.colorTextSecondary}})}}],pagination:!1})})]})}),(0,b.jsx)(d.Z,{open:G,title:n("dialog.title.LetsDouble-Check"),okButtonProps:{loading:de.isLoading},onOk:function(){de.mutate(void 0,{onSuccess:function(e){P((function(){te()})),O(!1)},onError:function(e){console.log("terminateModelServiceMutation Error",e)}})},onCancel:function(){O(!1)},children:(0,b.jsxs)(m.Z,{direction:"column",align:"stretch",justify:"center",children:[(0,b.jsx)("p",{children:n("modelService.YouAreAboutToTerminate")+((null===k||void 0===k?void 0:k.name)||"")+"."}),(0,b.jsx)("p",{children:n("dialog.ask.DoYouWantToProceed")})]})}),(0,b.jsx)(W.Z,{open:w,onRequestClose:function(e){C(!1),e&&P((function(){te()}))},endpointFrgmt:k||null}),(0,b.jsx)($,{open:y,onRequestClose:function(e){x(!y),e&&P((function(){te()}))}})]})}},6142:function(e,n,i){i.r(n);var t=function(){var e={defaultValue:null,kind:"LocalArgument",name:"limit"},n={defaultValue:null,kind:"LocalArgument",name:"offset"},i={defaultValue:null,kind:"LocalArgument",name:"projectID"},t=[{kind:"Literal",name:"filter",value:"name != 'koalpaca-test'"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],r={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"model",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"domain",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"project",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"routing_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"endpoint",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"session",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"traffic_ratio",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[e,n,i],kind:"Fragment",metadata:null,name:"ServingListPageQuery",selections:[{alias:null,args:t,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[r,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[l,o,a,s,u,d,c,m,g,v,{kind:"RequiredField",field:f,action:"NONE",path:"endpoint_list.items.desired_session_count"},{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[p,h,y,x,j],storageKey:null},{args:null,kind:"FragmentSpread",name:"ModelServiceSettingModal_endpoint"},{args:null,kind:"FragmentSpread",name:"EndpointStatusTagFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e,i],kind:"Operation",name:"ServingListPageQuery",selections:[{alias:null,args:t,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[r,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[l,o,a,s,u,d,c,m,g,v,f,{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[p,h,y,x,j,S],storageKey:null},S,j],storageKey:null}],storageKey:null}]},params:{cacheID:"53cec1819c3f5f5936159f3d452557f1",id:null,metadata:{},name:"ServingListPageQuery",operationKind:"query",text:"query ServingListPageQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: \"name != 'koalpaca-test'\") {\n    total_count\n    items {\n      name\n      endpoint_id\n      image\n      model\n      domain\n      project\n      resource_group\n      resource_slots\n      url\n      open_to_public\n      desired_session_count\n      routings {\n        routing_id\n        endpoint\n        session\n        traffic_ratio\n        status\n        id\n      }\n      ...ModelServiceSettingModal_endpoint\n      ...EndpointStatusTagFragment\n      id\n    }\n  }\n}\n\nfragment EndpointStatusTagFragment on Endpoint {\n  id\n  status\n}\n\nfragment ModelServiceSettingModal_endpoint on Endpoint {\n  endpoint_id\n  desired_session_count\n}\n"}}}();t.hash="15ae6559c4d26c1eff859e5f35324d69",n.default=t}}]);
//# sourceMappingURL=946.ca43b9e4.chunk.js.map