/*! For license information please see 5665.78454c04.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[5665,6019],{16019:(e,n,r)=>{r.r(n),r.d(n,{default:()=>x,passwordPattern:()=>j});var s=r(48880),t=r(40690),a=r(62378),o=r(59682),i=r(17534);const d={icon:function(e,n){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z",fill:e}},{tag:"path",attrs:{d:"M172.2 828.1h679.6L512 239.9 172.2 828.1zM560 720a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm-16-304v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8z",fill:n}},{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z",fill:e}}]}},name:"warning",theme:"twotone"};var l=r(91101);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},u.apply(this,arguments)}const c=(e,n)=>i.createElement(l.A,u({},e,{ref:n,icon:d}));const w=i.forwardRef(c);var m=r(20353),p=r(284),v=r(10477),P=r(7957),g=r(87621),h=r(15121),f=r(67631),b=r(62962),A=r(89374);const j=/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,x=()=>{const{value:e,dispatchEvent:n}=(0,o.useWebComponentInfo)();let r;try{r=JSON.parse(e||"")}catch(M){r={open:!1,currentPassword:"",username:"",api_endpoint:""}}const{open:d,currentPassword:l,username:u,api_endpoint:c}=r,{token:x}=m.A.useToken(),[_]=p.A.useForm(),{t:y}=(0,b.Bd)();(0,i.useEffect)((()=>{d&&_.resetFields()}),[d,_]);const C=(0,t.oM)({api_endpoint:c}),k=(0,a.ET)({mutationFn:e=>(0,s.hu)({method:"POST",url:"/server/update-password-no-auth",body:e,client:C})}),F=()=>{_.validateFields().then((e=>{k.mutate({username:u,current_password:l,new_password:e.newPassword},{onSuccess(){n("ok",null)},onError(){}})}))};return(0,A.jsx)(v.A,{open:d,centered:!0,mask:!1,onCancel:()=>{n("cancel",null)},keyboard:!1,maskClosable:!1,footer:null,width:450,destroyOnHidden:!0,forceRender:!0,children:(0,A.jsxs)(f.OO,{direction:"column",justify:"start",align:"stretch",gap:"md",style:{alignSelf:"stretch",paddingTop:x.paddingMD,paddingBottom:x.paddingMD},children:[(0,A.jsxs)(P.A.Title,{level:3,style:{margin:0},children:[(0,A.jsx)(w,{twoToneColor:x.colorWarning})," ",y("webui.menu.PleaseChangeYourPassword")]}),y("webui.menu.YouMushChangeYourPassword"),(0,A.jsxs)(p.A,{form:_,layout:"vertical",initialValues:{currentPassword:l},disabled:k.isPending,children:[(0,A.jsx)(p.A.Item,{name:"newPassword",label:y("webui.menu.NewPassword"),rules:[{required:!0},{pattern:j,message:y("webui.menu.InvalidPasswordMessage").toString()},()=>({validator:(e,n)=>l===n?Promise.reject(new Error(y("webui.menu.NewPasswordCannotBeSame").toString())):Promise.resolve()})],hasFeedback:!0,children:(0,A.jsx)(g.A.Password,{})}),(0,A.jsx)(p.A.Item,{name:"confirm",label:y("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0},e=>{let{getFieldValue:n}=e;return{validator:(e,r)=>r&&n("newPassword")!==r?Promise.reject(new Error(y("environment.PasswordsDoNotMatch").toString())):Promise.resolve()}}],children:(0,A.jsx)(g.A.Password,{onPressEnter:F})})]}),(0,A.jsx)(h.Ay,{type:"primary",onClick:F,loading:k.isPending,children:y("webui.menu.Update")})]})})}},25665:(e,n,r)=>{r.r(n),r.d(n,{default:()=>y});var s=r(56276),t=r(11863),a=r(40690),o=r(72828),i=r(62378),d=r(16019),l=r(55857),u=r(97674),c=r(45711),w=r(13368),m=r(84423),p=r(74031),v=r(284),P=r(87621),g=r(40554),h=r(61471),f=r(67631),b=r(17534),A=r(62962),j=r(46336),x=r(89374);const _=["onRequestClose","onRequestRefresh","isRefreshModalPending","totpSupported","queryRef"],y=e=>{var n;let{onRequestClose:r,onRequestRefresh:y,isRefreshModalPending:C,totpSupported:k,queryRef:F}=e,M=(0,t.A)(e,_);const{t:T}=(0,A.Bd)(),E=(0,b.useRef)(null),{message:R,modal:O}=p.A.useApp(),[I,{toggle:N}]=(0,m.A)(!1),S=(0,a.CX)(),V=(0,o.Am)(),[q,z]=(0,o.U6)(),{getErrorMessage:B}=(0,f.B7)(),{user:U}=(0,j.usePreloadedQuery)(u.j,F),Y=(0,i.ET)({mutationFn:()=>S.remove_totp()});return(0,x.jsx)(x.Fragment,{children:(0,x.jsxs)(f.Ib,(0,s.A)((0,s.A)({},M),{},{okText:T("webui.menu.Update"),cancelText:T("webui.menu.Cancel"),onCancel:()=>{r()},confirmLoading:q.isPendingMutation,onOk:()=>(()=>{var e;null===(e=E.current)||void 0===e||e.validateFields().then((e=>{z.updateFullName(e.full_name,{onSuccess:()=>{R.open({type:"success",content:T("webui.menu.FullNameUpdated")}),e.newPassword&&e.newPasswordConfirm&&e.originalPassword?z.updatePassword({new_password:e.newPassword,new_password2:e.newPasswordConfirm,old_password:e.originalPassword},{onSuccess:()=>{R.open({type:"success",content:T("webui.menu.PasswordUpdated")}),r(!0)},onError:e=>{R.open({type:"error",content:e.message})}}):r(!0)},onError:e=>{R.open({type:"error",content:e.message})}})})).catch((()=>{}))})(),centered:!0,destroyOnHidden:!0,title:T("webui.menu.MyAccountInformation"),children:[(0,x.jsx)(g.A,{spinning:C,indicator:(0,x.jsx)(w.A,{}),children:(0,x.jsxs)(v.A,{ref:E,layout:"vertical",initialValues:{full_name:null!==(n=null===U||void 0===U?void 0:U.full_name)&&void 0!==n?n:q.full_name,totp_activated:(null===U||void 0===U?void 0:U.totp_activated)||!1},preserve:!1,children:[(0,x.jsx)(v.A.Item,{name:"full_name",label:T("webui.menu.FullName"),rules:[()=>({validator:(e,n)=>n&&n.length<65?Promise.resolve():Promise.reject(new Error(T("webui.menu.FullNameInvalid")))})],children:(0,x.jsx)(P.A,{})}),(0,x.jsx)(v.A.Item,{name:"originalPassword",label:T("webui.menu.OriginalPassword"),rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,r)=>r||!n("newPassword")&&!n("newPasswordConfirm")?Promise.resolve():Promise.reject(new Error(T("webui.menu.InputOriginalPassword")))}}],dependencies:["newPassword","newPasswordConfirm"],children:(0,x.jsx)(P.A.Password,{})}),(0,x.jsx)(v.A.Item,{name:"newPassword",label:T("webui.menu.NewPassword"),rules:[{pattern:"superadmin"===V?void 0:d.passwordPattern,message:T("webui.menu.InvalidPasswordMessage")}],children:(0,x.jsx)(P.A.Password,{})}),(0,x.jsx)(v.A.Item,{name:"newPasswordConfirm",label:T("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,r)=>r&&n("newPassword")!==r?Promise.reject(new Error(T("webui.menu.NewPasswordMismatch"))):Promise.resolve()}}],children:(0,x.jsx)(P.A.Password,{})}),!!k&&(0,x.jsx)(v.A.Item,{name:"totp_activated",label:T("webui.menu.TotpActivated"),valuePropName:"checked",children:(0,x.jsx)(h.A,{loading:Y.isPending,onChange:e=>{var n;e?N():null!==U&&void 0!==U&&U.totp_activated&&(null===(n=E.current)||void 0===n||n.setFieldValue("totp_activated",!0),O.confirm({title:T("totp.TurnOffTotp"),icon:(0,x.jsx)(c.A,{}),content:T("totp.ConfirmTotpRemovalBody"),okText:T("button.Yes"),okType:"danger",cancelText:T("button.No"),onOk(){Y.mutate(void 0,{onSuccess:()=>{var e;R.success(T("totp.RemoveTotpSetupCompleted")),y(),null===(e=E.current)||void 0===e||e.setFieldValue("totp_activated",!1)},onError:e=>{R.error(B(e))}})},onCancel(){var e;null===(e=E.current)||void 0===e||e.setFieldValue("totp_activated",!0)}}))}})})]})}),!!k&&(0,x.jsx)(l.A,{userFrgmt:U,open:I,onRequestClose:e=>{var n;e?y():null===(n=E.current)||void 0===n||n.setFieldValue("totp_activated",!1);N()}})]}))})}}}]);
//# sourceMappingURL=5665.78454c04.chunk.js.map