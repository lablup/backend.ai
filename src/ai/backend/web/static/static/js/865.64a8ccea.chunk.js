"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[865],{5621:(e,n,i)=>{i.d(n,{A:()=>t});var o=i(29871),l=i(48713),r=i(45901),s=i.n(r),a=i(76998),u=i(23446);const t=e=>{let n,{values:i=[]}=e;return 0===i.length?null:(n=i[0]&&("string"===typeof i[0]||a.isValidElement(i[0]))?i.map((e=>({label:e,color:"blue"}))):i,(0,u.jsx)(o.A,{direction:"row",children:s().map(n,((e,i)=>(0,u.jsx)(l.A,{style:s().last(n)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:e.label},i)))}))}},35051:(e,n,i)=>{i.d(n,{A:()=>a});var o=i(83468),l=i(76998),r=i(23446);const s=function(e,n){let{image:i,style:l={}}=e,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const[,{getImageIcon:a}]=(0,o.Gj)();return(0,r.jsx)("img",{src:a(i),style:{width:"1em",height:"1em",...l},alt:s})},a=l.memo(s)},35832:(e,n,i)=>{i.d(n,{A:()=>d});var o=i(29871),l=i(66464),r=i(91409),s=i(51182),a=i(45901),u=i.n(a),t=i(76998),c=i(23446);const d=e=>{let{min:n,max:i,step:a,disabled:d,inputNumberProps:m,sliderProps:v,...g}=e;const[p,h]=(0,l.A)(g),y=t.useRef(null);return(0,t.useEffect)((()=>{1===a&&p%1!==0&&h(u().max([Math.round(p),n]))}),[a]),(0,c.jsxs)(o.A,{direction:"row",gap:"md",children:[(0,c.jsx)(o.A,{style:{flex:2,minWidth:190},align:"stretch",direction:"column",children:(0,c.jsx)(r.A,{ref:y,max:i,min:n,step:a,disabled:d,value:p,onChange:h,onBlur:()=>{if(u().isNumber(a)&&a>0){var e,i;const o=(null===(e=a.toString().split(".")[1])||void 0===e?void 0:e.length)||0;h(u().max([u().toNumber((Math.round(u().toNumber((null===(i=y.current)||void 0===i?void 0:i.value)||"0")/a)*a).toFixed(o)),n]))}},...m})}),(0,c.jsx)(o.A,{direction:"column",align:"stretch",style:{flex:3},children:(0,c.jsx)(s.A,{max:i,min:0,step:a,disabled:d,value:p,onChange:e=>{void 0!==n&&e<n||h(e)},...v,marks:u().omitBy(null===v||void 0===v?void 0:v.marks,((e,n)=>!!u().isNumber(i)&&u().parseInt(n)>i))})})]})}},97443:(e,n,i)=>{i.d(n,{t2:()=>B,jh:()=>J,Ay:()=>W});var o=i(30032),l=i(83468),r=i(16162),s=i(18611),a=i(73987),u=i(22189),t=i(66464),c=i(83642),d=i(91409),m=i(30217),v=i(13279),g=i(45901),p=i.n(g),h=i(76998),y=i(23446);const x=e=>{let{dynamicSteps:n=[1,2,4,8,16,32,64,128,256,512],units:i=["m","g","t","p"],disableAutoUnit:l=!1,min:r="0m",max:s="300p",roundStep:a,...u}=e;const[g,x]=(0,t.A)(u,{defaultValue:"0g"}),[b,_]=null===g||void 0===g?[null,null]:(0,o.E8)(g),f=(0,c.A)(_),A=_||f||i[0],[k,j]=(0,o.E8)(r),[P,S]=(0,o.E8)(s),F=(0,h.useRef)(null);return(0,h.useEffect)((()=>{if(F.current){const e=e=>{var n;const i=null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value;/^\d+(g|m)$/.test(i)&&x(i)},n=F.current;return null===n||void 0===n||n.addEventListener("input",e),()=>{null===n||void 0===n||n.removeEventListener("input",e)}}}),[F,b,_,x]),(0,y.jsx)(d.A,{ref:F,...u,onBlur:()=>{if(p().isNumber(a)&&a>0){var e,n,i;const o=(null===(e=a.toString().split(".")[1])||void 0===e?void 0:e.length)||0;if(isNaN(Math.round(p().toNumber((null===(n=F.current)||void 0===n?void 0:n.value)||"0")/a)*a))return;x("".concat((Math.round(p().toNumber((null===(i=F.current)||void 0===i?void 0:i.value)||"0")/a)*a).toFixed(o)).concat(A))}},value:b,onChange:e=>{x(null===e||void 0===e?e:"".concat(e).concat(A))},max:S===A?P:(0,o.Js)(s,A).number,min:j===A?k:(0,o.Js)(r,A).number,addonAfter:(0,y.jsx)(m.A,{tabIndex:-1,value:A,onChange:e=>{x("".concat(b).concat(e))},onDropdownVisibleChange:e=>{(e&&null===g||void 0===g)&&x("0".concat(A))},options:p().map(i,(e=>({value:e,label:(0,y.jsx)(v.A.Text,{style:{fontFamily:"'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace"},children:e.toUpperCase()+"iB"})}))),suffixIcon:i.length>1?void 0:null,open:i.length>1&&void 0,style:{cursor:i.length>1?void 0:"default"}}),step:0,onStep:(e,o)=>{const r=p().isNull(b)||p().isUndefined(b)?0:b,s=p().sortedIndex(p().sortBy(n),r);let a;a="up"===o.type?r===n[s]?s+1:s:s-1;const u=i.indexOf(A);if(!l&&a<0)if(0===u)x("0".concat(A));else{const e=n[n.length-1],o=i[u-1];x("".concat(e).concat(o))}else if(!l&&a>n.length-1)if(u===i.length-1)x("".concat(r+("up"===o.type?1:-1)).concat(S));else{const e=n[0],o=i[u+1];x("".concat(e).concat(o))}else if(a>=0&&a<n.length){let e=n[a];j===A&&e<k?e=k:S===A&&e>P&&(e=P),x("".concat(e).concat(A))}}})};var b=i(29871),_=i(50840),f=i(51182);const A=e=>{let{min:n="0m",max:i="32g",warn:l,units:r=["m","g"],extraMarks:s,hideSlider:a,step:u=.05,...c}=e;const[d,m]=(0,t.A)(c,{defaultValue:"0g"}),{token:v}=_.A.useToken(),g=(0,h.useMemo)((()=>(0,o.Js)(n,"g",2)),[n]),A=(0,h.useMemo)((()=>(0,o.Js)(i,"g",2)),[i]),k=(0,h.useMemo)((()=>(0,o.Js)(d||"0g","g",2)),[d]);return(0,y.jsxs)(b.A,{direction:"row",gap:"md",children:[(0,y.jsx)(b.A,{style:{flex:2,minWidth:190},direction:"column",align:"stretch",children:(0,y.jsx)(x,{...c,min:n,max:i,units:r,value:d,onChange:e=>{m(e)},style:{minWidth:130},roundStep:u})}),(0,y.jsx)(b.A,{direction:"column",align:"stretch",style:{flex:3,...a&&{visibility:"hidden",height:0}},children:(0,y.jsx)(b.A,{direction:"column",align:"stretch",children:(0,y.jsx)(f.A,{max:null===A||void 0===A?void 0:A.number,styles:{track:l&&{backgroundColor:(0,o.Mh)(l,d||"0b")<0?v.colorWarning:void 0}||void 0,rail:{}},step:u,value:null===k||void 0===k?void 0:k.number,tooltip:{formatter:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<1?"".concat((1024*e).toFixed(2)," MiB"):"".concat(e.toFixed(2)," GiB")}},onChange:e=>{null!==g&&void 0!==g&&g.number&&g.number>e?m(n):m(e<1?"".concat(1024*e,"m"):"".concat(e,"g"))},marks:{...g&&p().isNumber(null===g||void 0===g?void 0:g.number)&&{[g.number]:{style:{color:v.colorTextSecondary},label:0===g.number?g.number:g.number>=1?g.number+"g":1024*g.number+"m"}},...p().omitBy(s,((e,n)=>!!p().isNumber(null===A||void 0===A?void 0:A.number)&&p().parseInt(n)>(null===A||void 0===A?void 0:A.number))),...(null===A||void 0===A?void 0:A.number)&&{[A.number]:{style:{color:v.colorTextSecondary},label:0===A.number?A.number:A.number>=1?A.number+"g":1024*A.number+"m"}}}})})})]})};var k,j=i(35832),P=i(12581),S=i(8469),F=i(81579),N=i(2292),C=i(20039),M=i(20307),w=i(77678),E=i(3606);const I=e=>{let{allocatablePresetNames:n,showCustom:o,showMiniumRequired:s,...a}=e;const[u,c]=(0,l.Tw)("first"),{run:d}=(0,C.A)(c,{wait:3e3,trailing:!1,leading:!0}),[v]=(0,r.bL)(),{t:g}=(0,w.Bd)(),{token:x}=_.A.useToken(),[f,A]=(0,h.useTransition)(),[j,P]=(0,t.A)(a),{resource_presets:I}=(0,E.useLazyLoadQuery)(void 0!==k?k:k=i(73104),{},{fetchKey:u,fetchPolicy:"first"===u?"store-and-network":"network-only"});return(0,y.jsx)(m.A,{loading:f,options:[...o?[{value:"custom",label:(0,y.jsxs)(b.A,{gap:"xs",style:{display:"inline-flex"},children:[(0,y.jsx)(F.A,{})," ",g("session.launcher.CustomAllocation")]}),selectedLabel:g("session.launcher.CustomAllocation")}]:[],...s?[{value:"minimum-required",label:(0,y.jsxs)(b.A,{gap:"xs",children:[g("session.launcher.MiniumAllocation"),(0,y.jsx)(M.A,{title:g("session.launcher.MiniumAllocationTooltip"),children:(0,y.jsx)(N.A,{style:{color:x.colorTextSecondary}})})]}),selectedLabel:g("session.launcher.MiniumAllocation")}]:[],{label:"Preset",options:p().map(I,((e,i)=>{const o=JSON.parse(null===e||void 0===e?void 0:e.resource_slots),l=n?!n.includes((null===e||void 0===e?void 0:e.name)||""):void 0;return{value:null===e||void 0===e?void 0:e.name,label:(0,y.jsxs)(b.A,{direction:"row",justify:"between",gap:"xs",children:[null===e||void 0===e?void 0:e.name,(0,y.jsx)(b.A,{direction:"row",gap:"xxs",style:{},children:p().map(p().omitBy(o,((e,n)=>p().isEmpty(v[n]))),((e,n)=>(0,y.jsx)(S.Ay,{type:n,value:e,hideTooltip:!0},n)))})]}),preset:e,disabled:l}})).sort(((e,n)=>e.disabled===n.disabled?0:e.disabled?1:-1))}],showSearch:!0,...a,value:j,onChange:P,optionLabelProp:p().includes(["custom","minimum-required"],j)?"selectedLabel":"label",onDropdownVisibleChange:e=>{a.onDropdownVisibleChange&&a.onDropdownVisibleChange(e),e&&A((()=>{d()}))}})};var V=i(77170),K=i(65080),R=i(29475),q=i(82745),T=i(64283),D=i(7518),U=i(9788),L=i(17480);const B="64m",J={resource:{cpu:0,mem:"0g",shmem:"0g",accelerator:0},num_of_sessions:1,cluster_mode:"single-node",cluster_size:1,enabledAutomaticShmem:!0},z=e=>{var n,i,t;let{enableNumOfSessions:c,enableResourcePresets:d,forceImageMinValues:v=!1}=e;const g=K.A.useFormInstance(),{t:x}=(0,w.Bd)(),{token:f}=_.A.useToken(),k=(0,l.CX)(),[F]=(0,r.bL)(),[{keypairResourcePolicy:N,sessionLimitAndRemaining:C}]=(0,s.y)(),M=(0,l.hd)(),[E,V]=(0,h.useTransition)(),J=K.A.useWatch(["environments","image"],{form:g,preserve:!0}),z=K.A.useWatch("resourceGroup",{form:g,preserve:!0}),[{currentImageMinM:W,remaining:G,resourceLimits:O,checkPresetInfo:X}]=(0,u.y)({currentProjectName:M.name,currentResourceGroup:z,currentImage:J}),$=p().omitBy(F,((e,n)=>{var i,o;return!!["cpu","mem","shmem"].includes(n)||(null===(i=O.accelerators[n])||void 0===i||!i.max||0===(null===(o=O.accelerators[n])||void 0===o?void 0:o.max))})),H=p().filter(null===J||void 0===J?void 0:J.resource_limits,(e=>!!e&&!p().includes(["cpu","mem","shmem"],e.key))),Y={min:1,max:C.max,remaining:C.remaining},Z=(0,h.useMemo)((()=>{var e,n;const i=p().filter(null===X||void 0===X?void 0:X.presets,(e=>e.allocatable)).map((e=>e.name)),l=p().filter(null===X||void 0===X?void 0:X.presets,(e=>{var n,i,l,r;if("string"===typeof e.resource_slots.mem&&"string"===typeof(null===(n=O.mem)||void 0===n?void 0:n.max)&&(0,o.Mh)(e.resource_slots.mem,null===(i=O.mem)||void 0===i?void 0:i.max)>0)return!1;if("number"===typeof e.resource_slots.cpu&&"number"===typeof(null===(l=O.cpu)||void 0===l?void 0:l.max)&&e.resource_slots.cpu>(null===(r=O.cpu)||void 0===r?void 0:r.max))return!1;const s=p().keys(p().omit(e.resource_slots,["mem","cpu","shmem"]));return p().every(s,(n=>{var i,o;return!(n&&"string"===typeof e.resource_slots[n]&&"number"===typeof(null===(i=O.accelerators[n])||void 0===i?void 0:i.max)&&p().toNumber(e.resource_slots[n])>p().toNumber(null===(o=O.accelerators[n])||void 0===o?void 0:o.max))}))})).map((e=>e.name)),r=p().filter(null===X||void 0===X?void 0:X.presets,(e=>{const n=p().omitBy(e.resource_slots,((e,n)=>{if(["mem","cpu","shmem"].includes(n)||"0"===e)return!0}));return 0===H.length?!!p().isEmpty(n):p().some(H,(e=>p().some(n,((n,i)=>(null===e||void 0===e?void 0:e.key)===i&&p().toNumber(n)>=p().toNumber(null===e||void 0===e?void 0:e.min)))))})).map((e=>e.name));return H.length>0?null!==(e=k._config)&&void 0!==e&&e.always_enqueue_compute_session?l:i:p().intersection(null!==(n=k._config)&&void 0!==n&&n.always_enqueue_compute_session?l:i,r)}),[null===(n=k._config)||void 0===n?void 0:n.always_enqueue_compute_session,null===X||void 0===X?void 0:X.presets,O.accelerators,null===(i=O.cpu)||void 0===i?void 0:i.max,null===(t=O.mem)||void 0===t?void 0:t.max,H]),ee=(0,a.E)((()=>{if(p().includes(["custom","minimum-required"],g.getFieldValue("allocationPreset")));else if(Z[0]){const e=p().sortBy(Z,"name")[0];g.setFieldsValue({allocationPreset:e}),ie(e)}else g.setFieldsValue({allocationPreset:"custom"});setTimeout((()=>{g.validateFields().catch((()=>{}))}),200)}));(0,h.useEffect)((()=>{z&&ee()}),[z,ee,J]);const ne=e=>{var n,i,l,r,s,a;const u={cpu:null===(n=O.cpu)||void 0===n?void 0:n.min,mem:(null===(i=(0,o.Js)(((null===(l=(0,o.Js)(null===(r=O.shmem)||void 0===r?void 0:r.min,"m"))||void 0===l?void 0:l.number)||0)+((null===(s=(0,o.Js)(null===(a=O.mem)||void 0===a?void 0:a.min,"m"))||void 0===s?void 0:s.number)||0)+"m","g"))||void 0===i?void 0:i.number)+"g"};if(H.length>0)if(p().find(H,(e=>(null===e||void 0===e?void 0:e.key)===g.getFieldValue(["resource","acceleratorType"])))){var t;u.acceleratorType=g.getFieldValue(["resource","acceleratorType"]),u.accelerator=null===(t=O.accelerators[g.getFieldValue(["resource","acceleratorType"])])||void 0===t?void 0:t.min}else{var c;const e=null===(c=p().filter(H,(e=>p().keys(F).includes(null===e||void 0===e?void 0:e.key)))[0])||void 0===c?void 0:c.key;var d;if(e)u.accelerator=null===(d=O.accelerators[e])||void 0===d?void 0:d.min,u.acceleratorType=e}else u.accelerator=0;v||e||(["cpu","accelerator"].forEach((e=>{const n=u[e];p().isNumber(n)&&n<g.getFieldValue(["resource",e])&&delete u[e]})),["mem","shmem"].forEach((e=>{const n=u[e];p().isString(n)&&(0,o.Mh)(n,g.getFieldValue(["resource",e]))<0&&delete u[e]}))),g.setFieldsValue({resource:{...u}}),J&&0===H.length&&g.setFieldValue(["resource","accelerator"],0),g.getFieldValue("enabledAutomaticShmem")&&oe(g.getFieldValue(["resource","mem"])||"0g"),g.validateFields(["resource"]).catch((()=>{}))};(0,h.useEffect)((()=>{ne()}),[J]);const ie=e=>{var n,i;const l=p().find(null===X||void 0===X?void 0:X.presets,(n=>n.name===e)),r=p().pick(null===l||void 0===l?void 0:l.resource_slots,p().keys(F)),s=null===(n=(0,o.Js)(((null===r||void 0===r?void 0:r.mem)||0)+"b","g",2))||void 0===n?void 0:n.numberUnit,a=p().omit(r,["cpu","mem","shmem"]),u=p().find(p().keys($),(e=>void 0!==a[e]));let t={accelerator:0};u&&(t={acceleratorType:u,accelerator:Number(a[u]||0)}),g.setFieldsValue({resource:{...t,mem:s,shmem:null===(i=(0,o.Js)(((null===l||void 0===l?void 0:l.shared_memory)||0)+"b","g",2))||void 0===i?void 0:i.numberUnit,cpu:parseInt((null===r||void 0===r?void 0:r.cpu)||"0")||0}}),oe(s||"0g")},oe=e=>{(0,o.Mh)(e,"4g")>=0&&(0,o.Mh)(e,(0,o.sL)(W,"1g")||"0b")>=0&&(0,o.Mh)("1g",B)>0?g.setFieldValue(["resource","shmem"],"1g"):g.setFieldValue(["resource","shmem"],B)};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(K.A.Item,{name:"resourceGroup",label:x("session.ResourceGroup"),rules:[{required:!0}],trigger:"onSubmit",children:(0,y.jsx)(P.A,{showSearch:!0,loading:E,onChange:e=>{V((()=>{g.setFieldValue("resourceGroup",e),g.validateFields(["resourceGroup"]).catch((()=>{}))}))}})}),d?(0,y.jsx)(K.A.Item,{label:x("resourcePreset.ResourcePresets"),name:"allocationPreset",required:!0,style:{marginBottom:f.marginXS},children:(0,y.jsx)(I,{showCustom:!0,showMiniumRequired:!0,onChange:(e,n)=>{switch(e){case"custom":break;case"minimum-required":g.setFieldValue("enabledAutomaticShmem",!0),ne(!0);break;default:g.setFieldValue("enabledAutomaticShmem",!0),ie(e)}},allocatablePresetNames:Z})}):null,(0,y.jsx)(R.A,{style:{marginBottom:f.margin},children:(0,y.jsx)(K.A.Item,{shouldUpdate:(e,n)=>e.allocationPreset!==n.allocationPreset,noStyle:!0,children:e=>{var n,i,l,r,s,a,u,t,c,d;let{getFieldValue:v}=e;return(0,y.jsxs)(y.Fragment,{children:[(null===F||void 0===F?void 0:F.cpu)&&(0,y.jsx)(K.A.Item,{name:["resource","cpu"],label:x("session.launcher.CPU"),tooltip:{placement:"right",title:(0,y.jsx)(w.x6,{i18nKey:"session.launcher.DescCPU"})},required:!0,rules:[{required:!0},{type:"number",min:null===(n=O.cpu)||void 0===n?void 0:n.min},{warningOnly:null===(i=k._config)||void 0===i?void 0:i.always_enqueue_compute_session,validator:async(e,n)=>{var i;return p().isNumber(G.cpu)&&n>G.cpu?Promise.reject(null!==(i=k._config)&&void 0!==i&&i.always_enqueue_compute_session?x("session.launcher.EnqueueComputeSessionWarning",{amount:G.cpu}):x("session.launcher.ErrorCanNotExceedRemaining",{amount:G.cpu})):Promise.resolve()}}],children:(0,y.jsx)(j.A,{inputNumberProps:{addonAfter:x("session.launcher.Core")},sliderProps:{marks:{...G.cpu?{[G.cpu]:{label:(0,y.jsx)(Q,{})}}:{},...null!==(l=O.cpu)&&void 0!==l&&l.min?{[null===(r=O.cpu)||void 0===r?void 0:r.min]:null===(s=O.cpu)||void 0===s?void 0:s.min}:{},...null!==(a=O.cpu)&&void 0!==a&&a.max?{[null===(u=O.cpu)||void 0===u?void 0:u.max]:{style:{color:f.colorTextSecondary},label:null===(t=O.cpu)||void 0===t?void 0:t.max}}:{}}},min:null===(c=O.cpu)||void 0===c?void 0:c.min,max:null===(d=O.cpu)||void 0===d?void 0:d.max,step:1,onChange:()=>{g.setFieldValue("allocationPreset","custom")}})}),(null===F||void 0===F?void 0:F.mem)&&(0,y.jsxs)(K.A.Item,{label:x("session.launcher.Memory"),tooltip:{placement:"right",props:{onClick:e=>e.preventDefault()},title:(0,y.jsx)(b.A,{direction:"column",onClick:e=>e.preventDefault(),children:(0,y.jsx)(w.x6,{i18nKey:"session.launcher.DescMemory"})})},required:!0,children:[(0,y.jsx)(K.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.resource.shmem!==n.resource.shmem,children:()=>{var e,n,i,l;return(0,y.jsx)(K.A.Item,{name:["resource","mem"],noStyle:!0,rules:[{required:!0},{validator:async(e,n)=>{var i,l,r;return!p().isElement(n)&&null!==(i=O.mem)&&void 0!==i&&i.min&&(0,o.Mh)(n,(null===(l=O.mem)||void 0===l?void 0:l.min)||"0g")<0?Promise.reject(x("session.launcher.MinMemory",{size:p().toUpper((null===(r=O.mem)||void 0===r?void 0:r.min)||"0g")})):Promise.resolve()}},{warningOnly:null===(e=k._config)||void 0===e?void 0:e.always_enqueue_compute_session,validator:async(e,n)=>{var i,l,r;return!p().isElement(n)&&O.mem&&(0,o.Mh)(n,G.mem+"b")>0?Promise.reject(null!==(i=k._config)&&void 0!==i&&i.always_enqueue_compute_session?x("session.launcher.EnqueueComputeSessionWarning",{amount:(null===(l=(0,o.Js)(G.mem+"b","g",3))||void 0===l?void 0:l.numberUnit)+"iB"}):x("session.launcher.ErrorCanNotExceedRemaining",{amount:(null===(r=(0,o.Js)(G.mem+"b","g",3))||void 0===r?void 0:r.numberUnit)+"iB"})):Promise.resolve()}}],children:(0,y.jsx)(A,{max:null===(n=O.mem)||void 0===n?void 0:n.max,min:null===(i=O.mem)||void 0===i?void 0:i.min,addonBefore:"MEM",extraMarks:{...G.mem?{[null===(l=(0,o.Js)(G.mem+"b","g",3))||void 0===l?void 0:l.numberFixed]:{label:(0,y.jsx)(Q,{})}}:{}},onChange:e=>{e&&g.getFieldValue("enabledAutomaticShmem")&&(oe(e),g.setFieldValue("allocationPreset","custom"))}})})}}),(0,y.jsxs)(b.A,{direction:"column",gap:"xxs",align:"start",children:[(0,y.jsxs)(b.A,{direction:"row",gap:"xs",children:[x("session.launcher.EnableAutomaticMiniumShmem")," ",(0,y.jsx)(K.A.Item,{noStyle:!0,name:"enabledAutomaticShmem",valuePropName:"checked",children:(0,y.jsx)(q.A,{size:"small",onChange:e=>{e&&oe(g.getFieldValue(["resource","mem"])||"0g"),g.setFieldValue("allocationPreset","custom")}})})]}),(0,y.jsx)(K.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.resource.mem!==n.resource.mem||e.enabledAutomaticShmem!==n.enabledAutomaticShmem,children:()=>{var e;return(0,y.jsx)(K.A.Item,{noStyle:!0,name:["resource","shmem"],hidden:g.getFieldValue("enabledAutomaticShmem"),tooltip:(0,y.jsx)(w.x6,{i18nKey:"session.launcher.DescSharedMemory"}),dependencies:[["resource","mem"]],rules:[{required:!0},{},{validator:async(e,n)=>{var i,l;if(p().isEmpty(null===(i=v("resource"))||void 0===i?void 0:i.mem)||p().isEmpty(n)||(0,o.Mh)(null===(l=v("resource"))||void 0===l?void 0:l.mem,n)>=0)return Promise.resolve();throw x("resourcePreset.SHMEMShouldBeSmallerThanMemory")}}],children:(0,y.jsx)(A,{min:null===(e=O.shmem)||void 0===e?void 0:e.min,addonBefore:"SHM",max:g.getFieldValue(["resource","mem"])||"0g",hideSlider:!0,onChange:()=>{g.setFieldValue("allocationPreset","custom")}})})}})]})]}),(0,y.jsx)(K.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var i,o;return(null===(i=e.resource)||void 0===i?void 0:i.acceleratorType)!==(null===(o=n.resource)||void 0===o?void 0:o.acceleratorType)||e.cluster_size!==n.cluster_size},children:e=>{var n,i,o,l,r,s,a;let{getFieldValue:u}=e;const t=u(["resource","acceleratorType"]);return(0,y.jsx)(K.A.Item,{name:["resource","accelerator"],label:x("session.launcher.AIAccelerator"),tooltip:{placement:"right",title:(0,y.jsx)(w.x6,{i18nKey:"session.launcher.DescAIAccelerator"})},rules:[{required:H.length>0},{type:"number",min:(null===(n=O.accelerators[t])||void 0===n?void 0:n.min)||0,max:null===(i=O.accelerators[t])||void 0===i?void 0:i.max},{validator:async(e,n)=>p().endsWith(t,"shares")&&g.getFieldValue("cluster_size")>=2&&n%1!==0?Promise.reject(x("session.launcher.OnlyAllowsDiscreteNumberByClusterSize")):Promise.resolve()},{warningOnly:null===(o=k._config)||void 0===o?void 0:o.always_enqueue_compute_session,validator:async(e,n)=>{var i;return p().isNumber(G.accelerators[t])&&n>G.accelerators[t]?Promise.reject(null!==(i=k._config)&&void 0!==i&&i.always_enqueue_compute_session?x("session.launcher.EnqueueComputeSessionWarning",{amount:G.accelerators[t]}):x("session.launcher.ErrorCanNotExceedRemaining",{amount:G.accelerators[t]})):Promise.resolve()}}],children:(0,y.jsx)(j.A,{sliderProps:{marks:{0:0,...G.accelerators[t]?{[G.accelerators[t]]:{label:(0,y.jsx)(Q,{})}}:{},...p().isNumber(null===(l=O.accelerators[t])||void 0===l?void 0:l.max)?{[null===(r=O.accelerators[t])||void 0===r?void 0:r.max]:null===(s=O.accelerators[t])||void 0===s?void 0:s.max}:{}},tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(S.uJ[t])},open:!(H.length<=0)&&void 0}},disabled:0===H.length&&p().isEmpty(g.getFieldValue(["environments","manual"])),min:0,max:null===(a=O.accelerators[t])||void 0===a?void 0:a.max,step:p().endsWith(t,"shares")&&g.getFieldValue("cluster_size")<2?.1:1,onChange:()=>{g.setFieldValue("allocationPreset","custom")},inputNumberProps:{addonAfter:(0,y.jsx)(K.A.Item,{noStyle:!0,name:["resource","acceleratorType"],initialValue:p().keys($)[0],children:(0,y.jsx)(m.A,{tabIndex:-1,disabled:0===H.length&&p().isEmpty(g.getFieldValue(["environments","manual"])),suffixIcon:p().size($)>1?void 0:null,popupMatchSelectWidth:!1,options:p().map($,((e,n)=>({value:n,label:S.uJ[n]||"UNIT",disabled:H.length>0&&!p().find(H,(e=>(null===e||void 0===e?void 0:e.key)===n))})))})})}})})}})]})}})}),c?(0,y.jsx)(R.A,{style:{marginBottom:f.margin},children:(0,y.jsx)(K.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.cluster_size!==n.cluster_size,children:()=>(0,y.jsx)(K.A.Item,{name:["num_of_sessions"],label:x("webui.menu.Sessions"),tooltip:(0,y.jsx)(w.x6,{i18nKey:"session.launcher.DescSession"}),required:!0,rules:[{required:!0},{warningOnly:!0,validator:async(e,n)=>Y&&n>Y.remaining?Promise.reject(x("session.launcher.EnqueueComputeSessionWarning",{amount:Y.remaining})):Promise.resolve()}],children:(0,y.jsx)(j.A,{inputNumberProps:{addonAfter:"#"},disabled:g.getFieldValue("cluster_size")>1,sliderProps:{marks:{[null===Y||void 0===Y?void 0:Y.min]:null===Y||void 0===Y?void 0:Y.min,...null!==Y&&void 0!==Y&&Y.remaining?{[null===Y||void 0===Y?void 0:Y.remaining]:{label:(0,y.jsx)(Q,{})}}:{},[null===Y||void 0===Y?void 0:Y.max]:null===Y||void 0===Y?void 0:Y.max}},min:null===Y||void 0===Y?void 0:Y.min,max:null===Y||void 0===Y?void 0:Y.max})})})}):null,k.supports("multi-container")&&(0,y.jsx)(K.A.Item,{label:x("session.launcher.ClusterMode"),tooltip:(0,y.jsxs)(b.A,{direction:"column",align:"start",children:[x("session.launcher.SingleNode"),(0,y.jsx)(w.x6,{i18nKey:"session.launcher.DescSingleNode"}),(0,y.jsx)(T.A,{style:{backgroundColor:f.colorBorder}}),x("session.launcher.MultiNode"),(0,y.jsx)(w.x6,{i18nKey:"session.launcher.DescMultiNode"})]}),required:!0,children:(0,y.jsx)(R.A,{style:{marginBottom:f.margin},children:(0,y.jsxs)(D.A,{gutter:f.marginMD,children:[(0,y.jsx)(U.A,{xs:24,children:(0,y.jsx)(K.A.Item,{name:"cluster_mode",required:!0,children:(0,y.jsxs)(L.Ay.Group,{onChange:e=>{g.validateFields().catch((()=>{}))},children:[(0,y.jsx)(L.Ay.Button,{value:"single-node",children:x("session.launcher.SingleNode")}),(0,y.jsx)(L.Ay.Button,{value:"multi-node",children:x("session.launcher.MultiNode")})]})})}),(0,y.jsx)(U.A,{xs:24,children:(0,y.jsx)(K.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.cluster_mode!==n.cluster_mode,children:()=>{var e,n;const i=p().min([null===(e=O.cpu)||void 0===e?void 0:e.max,N.max_containers_per_session]),o="single-node"===g.getFieldValue("cluster_mode")?x("session.launcher.Container"):x("session.launcher.Node");return(0,y.jsx)(K.A.Item,{name:"cluster_size",label:x("session.launcher.ClusterSize"),required:!0,rules:[{warningOnly:null===(n=k._config)||void 0===n?void 0:n.always_enqueue_compute_session,validator:async(e,n)=>{const i=p().min([G.cpu,N.max_containers_per_session]);return p().isNumber(i)&&n>i?Promise.reject(x("session.launcher.EnqueueComputeSessionWarning",{amount:i})):Promise.resolve()}}],children:(0,y.jsx)(j.A,{min:1,step:1,max:p().isNumber(i)?i:void 0,disabled:1===i,sliderProps:{marks:{1:"1",...G.cpu?{[G.cpu]:{label:(0,y.jsx)(Q,{})}}:{},...p().isNumber(i)?{[i]:i}:{}},tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(o)}}},inputNumberProps:{addonAfter:o},onChange:e=>{e>1&&g.setFieldValue("num_of_sessions",1)}})})}})})]})})})]})},Q=()=>{const{token:e}=_.A.useToken();return(0,y.jsx)(b.A,{style:{position:"absolute",top:-24,transform:"translateX(-50%)",color:e.colorSuccess,opacity:.5},children:(0,y.jsx)(V.A,{})})},W=h.memo(z)},73104:(e,n,i)=>{i.r(n),i.d(n,{default:()=>l});const o=function(){var e=[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetSelectQuery",selections:e,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ResourcePresetSelectQuery",selections:e},params:{cacheID:"bd89430b9924d926a1b8e91191746b4f",id:null,metadata:{},name:"ResourcePresetSelectQuery",operationKind:"query",text:"query ResourcePresetSelectQuery {\n  resource_presets {\n    name\n    resource_slots\n    shared_memory\n  }\n}\n"}}}();o.hash="9841642e96d89476c2848bfb093ed9c5";const l=o},53740:(e,n,i)=>{i.r(n),i.d(n,{default:()=>l});const o=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"accessKey"}],n=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"accessKey"}],concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"concurrency_used",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairQuery",selections:n},params:{cacheID:"1f8fc324e9907111de581f5cd2dc3640",id:null,metadata:{},name:"hooksUsingRelay_KeyPairQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairQuery(\n  $accessKey: String!\n) {\n  keypair(access_key: $accessKey) {\n    id\n    resource_policy\n    concurrency_used\n  }\n}\n"}}}();o.hash="d8f5c91f0fc46a3366f57566ab688d81";const l=o},35242:(e,n,i)=>{i.r(n),i.d(n,{default:()=>l});const o=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n},params:{cacheID:"ad7039c1935637fe3f3841f0ea8bf347",id:null,metadata:{},name:"hooksUsingRelay_KeyPairResourcePolicyQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairResourcePolicyQuery(\n  $name: String!\n) {\n  keypair_resource_policy(name: $name) {\n    max_containers_per_session\n    max_concurrent_sessions\n  }\n}\n"}}}();o.hash="f3f7364c63aefe9b03111b584c48c103";const l=o},18611:(e,n,i)=>{i.d(n,{y:()=>c});var o,l,r=i(83468),s=i(45901),a=i.n(s),u=i(76998),t=i(3606);const c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fetchPolicy:"store-and-network"};const[n,s]=(0,r.Tw)("first"),c=(0,r.CX)(),[d]=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchPolicy:"store-and-network"};const[l,s]=(0,r.Tw)("first"),{keypair:a}=(0,t.useLazyLoadQuery)(void 0!==o?o:o=i(53740),{accessKey:e},{...n,fetchKey:l+n.fetchKey});return[a,{refresh:(0,u.useCallback)((()=>{s()}),[s])}]}(null===c||void 0===c?void 0:c._config.accessKey),{keypair_resource_policy:m}=(0,t.useLazyLoadQuery)(void 0!==l?l:l=i(35242),{name:(null===d||void 0===d?void 0:d.resource_policy)||""},{...e,fetchKey:n+e.fetchKey}),v=(0,u.useCallback)((()=>{s()}),[s]);return[{keypairResourcePolicy:m||{},keypair:d||{},sessionLimitAndRemaining:{max:a().min([(m||{}).max_concurrent_sessions,3]),remaining:((m||{}).max_concurrent_sessions||3)-((d||{}).concurrency_used||0)}},{refresh:v}]}},22189:(e,n,i)=>{i.d(n,{y:()=>c});var o=i(83468),l=i(97443),r=i(30032),s=i(16162),a=i(57857),u=i(45901),t=i.n(u);const c=e=>{var n,i,u,c,m,v,g,p,h,y,x,b,_,f,A,k,j,P,S,F,N,C;let{currentImage:M,currentResourceGroup:w,currentProjectName:E}=e;const I=(0,o.CX)(),[V]=(0,s.bL)(),K=t().omit(V,["cpu","mem","shmem"]),{data:R,refetch:q,isRefetching:T}=(0,a.n)({queryKey:["check-resets",E,w],queryFn:()=>w?I.resourcePreset.check({group:E,scaling_group:w}).catch((()=>{})):void 0,staleTime:0,suspense:!0}),D=(null===(n=t().find(null===M||void 0===M?void 0:M.resource_limits,(e=>"mem"===(null===e||void 0===e?void 0:e.key))))||void 0===n?void 0:n.min)||"0g",U={cpu:t().isEmpty(null===R||void 0===R||null===(i=R.scaling_groups[w])||void 0===i||null===(u=i.using)||void 0===u?void 0:u.cpu)||t().isEmpty(null===R||void 0===R||null===(c=R.scaling_groups[w])||void 0===c||null===(m=c.remaining)||void 0===m?void 0:m.cpu)?void 0:t().toNumber(null===R||void 0===R||null===(v=R.scaling_groups[w])||void 0===v?void 0:v.using.cpu)+t().toNumber(null===R||void 0===R||null===(g=R.scaling_groups[w])||void 0===g?void 0:g.remaining.cpu),mem:t().isEmpty(null===R||void 0===R||null===(p=R.scaling_groups[w])||void 0===p||null===(h=p.using)||void 0===h?void 0:h.mem)||t().isEmpty(null===R||void 0===R||null===(y=R.scaling_groups[w])||void 0===y||null===(x=y.remaining)||void 0===x?void 0:x.mem)?void 0:(null===(b=(0,r.Js)(t().toNumber(null===R||void 0===R||null===(_=R.scaling_groups[w])||void 0===_?void 0:_.using.mem)+t().toNumber(null===R||void 0===R||null===(f=R.scaling_groups[w])||void 0===f?void 0:f.remaining.mem)+"b","g",2))||void 0===b?void 0:b.numberFixed)+"g",accelerators:t().reduce(K,((e,n,i)=>{var o,l,r,s,a,u;return e[i]=t().isEmpty(null===R||void 0===R||null===(o=R.scaling_groups[w])||void 0===o||null===(l=o.using)||void 0===l?void 0:l[i])||t().isEmpty(null===R||void 0===R||null===(r=R.scaling_groups[w])||void 0===r||null===(s=r.remaining)||void 0===s?void 0:s[i])?void 0:t().toNumber(null===R||void 0===R||null===(a=R.scaling_groups[w])||void 0===a?void 0:a.using[i])+t().toNumber(null===R||void 0===R||null===(u=R.scaling_groups[w])||void 0===u?void 0:u.remaining[i]),e}),{})},L={cpu:void 0===(null===V||void 0===V?void 0:V.cpu)?void 0:{min:t().max([t().toNumber((null===(A=t().find(null===M||void 0===M?void 0:M.resource_limits,(e=>"cpu"===(null===e||void 0===e?void 0:e.key))))||void 0===A?void 0:A.min)||"0")]),max:t().min([I._config.maxCPUCoresPerContainer,d(null===R||void 0===R?void 0:R.keypair_limits.cpu),d(null===R||void 0===R?void 0:R.group_limits.cpu),null===U||void 0===U?void 0:U.cpu])},mem:void 0===(null===V||void 0===V?void 0:V.mem)?void 0:{min:(0,r.sL)(t().max([null===(k=(0,r.Js)(D,"b"))||void 0===k?void 0:k.number,null===(j=(0,r.Js)(l.t2,"b"))||void 0===j?void 0:j.number,0])+"b",l.t2),max:t().min([I._config.maxMemoryPerContainer,d(null===R||void 0===R?void 0:R.keypair_limits.mem)&&(null===(P=(0,r.Js)(d(null===R||void 0===R?void 0:R.keypair_limits.mem)+"","g"))||void 0===P?void 0:P.number),d(null===R||void 0===R?void 0:R.group_limits.mem)&&(null===(S=(0,r.Js)(d(null===R||void 0===R?void 0:R.group_limits.mem)+"","g"))||void 0===S?void 0:S.number),(null===U||void 0===U?void 0:U.mem)&&(null===(F=(0,r.Js)((null===U||void 0===U?void 0:U.mem)+"","g"))||void 0===F?void 0:F.number)])+"g"},accelerators:t().reduce(K,((e,n,i)=>{var o,l;const r={"cuda.device":"maxCUDADevicesPerContainer","cuda.shares":"maxCUDASharesPerContainer","rocm.device":"maxROCMDevicesPerContainer","tpu.device":"maxTPUDevicesPerContainer","ipu.device":"maxIPUDevicesPerContainer","atom.device":"maxATOMDevicesPerContainer","warboy.device":"maxWarboyDevicesPerContainer","hyperaccel-lpu.device":"maxHyperaccelLPUDevicesPerContainer"}[i]||"cuda.device";return e[i]={min:parseInt((null===(o=t().filter(null===M||void 0===M?void 0:M.resource_limits,(e=>(null===e||void 0===e?void 0:e.key)===i)))||void 0===o||null===(l=o[0])||void 0===l?void 0:l.min)||"0"),max:t().min([I._config[r]||8,U.accelerators[i]])},e}),{})},B={accelerators:t().reduce(K,((e,n,i)=>{var o;return e[i]=null!==(o=t().min([t().toNumber(null===R||void 0===R?void 0:R.keypair_remaining[i]),t().toNumber(null===R||void 0===R?void 0:R.group_remaining[i]),t().toNumber(null===R||void 0===R?void 0:R.scaling_group_remaining[i])]))&&void 0!==o?o:Number.MAX_SAFE_INTEGER,e}),{}),cpu:null!==(N=t().min([d(null===R||void 0===R?void 0:R.keypair_remaining.cpu),d(null===R||void 0===R?void 0:R.group_remaining.cpu),d(null===R||void 0===R?void 0:R.scaling_group_remaining.cpu)]))&&void 0!==N?N:Number.MAX_SAFE_INTEGER,mem:null!==(C=t().min([d(null===R||void 0===R?void 0:R.keypair_remaining.mem),d(null===R||void 0===R?void 0:R.group_remaining.mem),d(null===R||void 0===R?void 0:R.scaling_group_remaining.mem)]))&&void 0!==C?C:Number.MAX_SAFE_INTEGER};return[{resourceGroupResourceSize:U,resourceLimits:L,remaining:B,currentImageMinM:D,isRefetching:T,checkPresetInfo:R},{refetch:q}]},d=e=>void 0===e||"Infinity"===e||"NaN"===e?void 0:t().toNumber(e)}}]);
//# sourceMappingURL=865.64a8ccea.chunk.js.map