"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[436],{91996:function(e,n,t){var r=t(1413),s=t(29439),i=t(44925),o=t(99821),a=t(91063),l=t(99517),c=t.n(l),u=(t(4519),t(2556)),d=["value","onChange","localFormat"];n.Z=function(e){var n=e.value,t=e.onChange,l=e.localFormat,m=(0,i.Z)(e,d),h=(0,o.Z)({value:n,onChange:t}),p=(0,s.Z)(h,2)[1];return(0,u.jsx)(a.Z,(0,r.Z)({value:n?c()(n):void 0,onChange:function(e){var n,t=l?null===e||void 0===e?void 0:e.format():null===e||void 0===e||null===(n=e.tz())||void 0===n?void 0:n.toISOString();p(t)}},m))}},750:function(e,n,t){t.r(n);var r={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"};n.default=r},50436:function(e,n,t){t.r(n),t.d(n,{default:function(){return Ke}});var r,s=t(74165),i=t(4942),o=t(15861),a=t(29439),l=t(1413),c=t(44925),u=t(83249),d=t(69080),m=t(44036),h=t(38812),p=t(86199),g=t(32048),f=t.n(g),x=t(4519),v=t(2556),Z=["status","extraButtonTitle","onClickExtraButton","extra","style"],j=function(e){var n=e.status,t=void 0===n?"default":n,r=e.extraButtonTitle,s=e.onClickExtraButton,i=e.extra,o=e.style,a=(0,c.Z)(e,Z),g=m.Z.useToken().token,x=i||r&&(0,v.jsx)(h.ZP,{type:"link",icon:"error"===t?(0,v.jsx)(u.Z,{twoToneColor:g.colorError}):"warning"===t?(0,v.jsx)(d.Z,{twoToneColor:g.colorWarning}):void 0,onClick:s,children:r})||void 0;return(0,v.jsx)(p.Z,(0,l.Z)({style:f().extend(o,{borderColor:"error"===t?g.colorError:"warning"===t?g.colorWarning:"success"===t?g.colorSuccess:null===o||void 0===o?void 0:o.borderColor}),extra:x},a))},y=t(91996),b=t(85911),F=t(99277),w=t(74860),k=t(20558),C=t(57054),P=t(38818),S=t(81748),T=["formItemProps"],I=["key","name"],V=function(e){var n=e.formItemProps,t=(0,c.Z)(e,T),r=(0,x.useRef)(null),s=(0,S.$G)().t,i=C.Z.useFormInstance();return(0,v.jsx)(C.Z.List,(0,l.Z)((0,l.Z)({},t),{},{children:function(e,o){var a=o.add,u=o.remove;return(0,v.jsxs)(F.Z,{direction:"column",gap:"xs",align:"stretch",children:[e.map((function(o,a){var d=o.key,m=o.name,h=(0,c.Z)(o,I);return(0,v.jsxs)(F.Z,{direction:"row",align:"baseline",gap:"xs",children:[(0,v.jsx)(C.Z.Item,(0,l.Z)((0,l.Z)((0,l.Z)({},h),{},{style:{marginBottom:0,flex:1},name:[m,"variable"],rules:[{required:!0,message:s("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:s("session.launcher.EnvironmentVariableNamePatternError")},function(e){var n=e.getFieldValue;return{validator:function(e,r){var i=f().map(n(t.name),(function(e){return null===e||void 0===e?void 0:e.variable}));return!f().isEmpty(r)&&i.length>0&&f().filter(i,(function(e){return e===r})).length>1?Promise.reject(s("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}]},n),{},{children:(0,v.jsx)(P.Z,{ref:a===e.length-1?r:null,placeholder:"Variable",onChange:function(){var n=e.map((function(e,n){return[t.name,n,"variable"]}));i.validateFields(n)}})})),(0,v.jsx)(C.Z.Item,(0,l.Z)((0,l.Z)({},h),{},{name:[m,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:"Enter value"}],children:(0,v.jsx)(P.Z,{placeholder:"Value"})})),(0,v.jsx)(w.Z,{onClick:function(){return u(m)}})]},d)})),(0,v.jsx)(C.Z.Item,{noStyle:!0,children:(0,v.jsx)(h.ZP,{type:"dashed",onClick:function(){a(),setTimeout((function(){r.current&&r.current.focus()}),0)},icon:(0,v.jsx)(k.Z,{}),block:!0,children:"Add variable"})})]})}}))},E=t(15008),_=t(14001),M=t(36459),A=t(40406),N=t(72887),O=t(82548),z=["value"],B=function(e){var n=e.value,t=(0,c.Z)(e,z),r=parseInt(n),s=r>=1024&&r<=65535;return(0,v.jsx)(O.Z,(0,l.Z)({color:s?void 0:"red"},t))},D=function(e){var n=Object.assign({},((0,M.Z)(e),e)),t=(0,S.$G)().t,r=(0,A.Dj)();return(0,v.jsx)(C.Z.Item,(0,l.Z)((0,l.Z)({label:t("session.launcher.PreOpenPortTitle"),name:"ports",tooltip:(0,v.jsx)(S.cC,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:t("session.launcher.PreOpenPortRangeGuide"),rules:[{max:r._config.maxCountForPreopenPorts,type:"array",message:t("session.launcher.PreOpenPortMaxCountLimit",{count:r._config.maxCountForPreopenPorts})},function(e){e.getFieldValue;return{validator:function(e,n){return f().every(n,(function(e){var n=parseInt(e);return n>=1024&&n<=65535}))?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortRange")))}}}]},n),{},{children:(0,v.jsx)(N.Z,{mode:"tags",tagRender:function(e){return(0,v.jsx)(B,{closable:e.closable,onClose:e.onClose,onMouseDown:function(e){e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})}))},R=t(20328),K=t(96732),L=function(e){var n=Object.assign({},((0,M.Z)(e),e)),t=(0,S.$G)().t;return(0,v.jsx)(C.Z.Item,(0,l.Z)((0,l.Z)({label:t("session.launcher.SessionName"),name:"name",rules:[{max:64,message:t("session.Validation.SessionNameTooLong64")},{pattern:/^(?:[a-zA-Z0-9][-a-zA-Z0-9._]{2,}[a-zA-Z0-9])?$/,message:t("session.Validation.PleaseFollowSessionNameRule").toString()}]},n),{},{children:(0,v.jsx)(P.Z,{allowClear:!0})}))},q=t(93433),G=t(43255),U=t(50164),W=t(91278),$=t(37007),H=t(16980),J=function(e){var n=e.vFolderFrgmt,s=void 0===n?null:n,i=e.permission,o=(0,H.useFragment)(void 0!==r?r:r=t(750),s),a=f().chain({r:"green",w:"blue",d:"red"}).map((function(e,n){if(function(e,n){return!(null===e||void 0===e||!e.includes(n))||!(null===e||void 0===e||!e.includes("w")||"r"!==n)}((null===o||void 0===o?void 0:o.permission)||i,n))return{label:n.toUpperCase(),color:e}})).compact().value();return(0,v.jsx)($.Z,{values:a})},Q=t(56713),X=t(50708),Y=t(72842),ee=t(99821),ne=t(70389),te=t(227),re=t(3597),se=t(99517),ie=t.n(se),oe=["filter","showAliasInput","selectedRowKeys","onChangeSelectedRowKeys","aliasBasePath","aliasMap","onChangeAliasMap","rowKey"],ae=function(e){var n=e.filter,t=e.showAliasInput,r=void 0!==t&&t,i=e.selectedRowKeys,u=void 0===i?[]:i,d=e.onChangeSelectedRowKeys,m=e.aliasBasePath,p=void 0===m?"/home/work/":m,g=e.aliasMap,Z=e.onChangeAliasMap,j=e.rowKey,y=void 0===j?"name":j,w=(0,c.Z)(e,oe),k=x.useMemo((function(){return function(e){return e&&e[y]}}),[y]),T=(0,ee.Z)({value:u,onChange:d},{defaultValue:[]}),I=(0,a.Z)(T,2),V=I[0],E=I[1],_=(0,ee.Z)({value:g,onChange:Z},{defaultValue:{}}),M=(0,a.Z)(_,2),N=M[0],O=M[1],z=C.Z.useForm(),B=(0,a.Z)(z,1)[0];(0,x.useEffect)((function(){N&&(B.setFieldsValue(f().mapValues(N,(function(e){return e.startsWith(p)?e.slice(p.length):e}))),B.validateFields())}),[N,B,p]);var D=(0,S.$G)().t,R=(0,G.y3)(),K=(0,A.qh)(),L=(0,A.Kr)("first"),$=(0,a.Z)(L,2),H=$[0],se=$[1],ae=(0,x.useTransition)(),le=(0,a.Z)(ae,2),ce=le[0],ue=le[1],de=(0,U.h)({queryKey:["VFolderSelectQuery",H,K.id],queryFn:function(){return R({method:"GET",url:"/folders?group_id=".concat(K.id)})},staleTime:0}).data,me=(0,x.useState)(""),he=(0,a.Z)(me,2),pe=he[0],ge=he[1],fe=f().filter(de,(function(e){return!!V.includes(k(e))||(!n||n(e))&&(!pe||e.name.includes(pe))})),xe=function(e){null===e||void 0===e||e.preventDefault(),B.validateFields().then((function(e){})).catch((function(){})).finally((function(){O(f().mapValues(f().pickBy(B.getFieldsValue(),(function(e){return!!e})),(function(e,n){return ve(n,e)})))}))},ve=function(e,n){return f().isEmpty(n)?"".concat(p).concat(e):null!==n&&void 0!==n&&n.startsWith("/")?n:"".concat(p).concat(n)},Ze=(0,b.useShadowRoot)(),je=[{title:(0,v.jsxs)(F.Z,{direction:"row",gap:"xxs",children:[(0,v.jsx)(ne.Z.Text,{children:D("data.folders.Name")}),r&&(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(ne.Z.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",D("session.launcher.FolderAlias")," ",(0,v.jsx)(te.Z,{title:(0,v.jsx)(S.cC,{i18nKey:"session.launcher.DescFolderAlias"}),getPopupContainer:function(){return Ze},children:(0,v.jsx)(Q.Z,{})}),")"]})})]}),dataIndex:"name",sorter:function(e,n){return e.name.localeCompare(n.name)},render:function(e,n){var t=V.includes(k(n));return(0,v.jsxs)(F.Z,{direction:"column",align:"stretch",gap:"xxs",style:r&&t?{display:"inline-flex",height:70,width:"100%"}:void 0,children:[(0,v.jsx)(W.Z,{keyword:pe,children:e}),r&&t&&(0,v.jsx)(C.Z.Item,{noStyle:!0,shouldUpdate:function(e,t){return e[k(n)]!==t[k(n)]},children:function(){var e=f()(V).reduce((function(e,n){return e[n]=(null===N||void 0===N?void 0:N[n])||ve(n,void 0),e}),{});return(0,v.jsx)(C.Z.Item,{name:k(n),rules:[{type:"string",pattern:/^[a-zA-Z0-9_/-]*$/,message:D("session.launcher.FolderAliasInvalid")},{type:"string",validator:function(){var t=(0,o.Z)((0,s.Z)().mark((function t(r,i){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i||!f().some(e,(function(e,t){return t!==k(n)&&e===ve(k(n),i)}))){t.next=2;break}return t.abrupt("return",Promise.reject(D("session.launcher.FolderAliasOverlapping")));case 2:return t.abrupt("return",Promise.resolve());case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}],extra:ve(n.name,B.getFieldValue(k(n))),children:(0,v.jsx)(P.Z,{onClick:function(e){e.stopPropagation()},placeholder:D("session.launcher.FolderAlias"),onChange:xe,allowClear:!0})})}})]})}},{title:D("data.UsageMode"),dataIndex:"usage_mode",sorter:function(e,n){return e.usage_mode.localeCompare(n.usage_mode)}},{title:D("data.Host"),dataIndex:"host"},{title:D("data.Type"),dataIndex:"type",sorter:function(e,n){return e.type.localeCompare(n.type)},render:function(e,n){return(0,v.jsxs)(F.Z,{direction:"column",children:["user"===n.type?(0,v.jsx)(X.Z,{title:"User"}):(0,v.jsx)("div",{children:"Group"}),"group"===n.type&&"(".concat(n.group_name,")")]})}},{title:D("data.Permission"),dataIndex:"permission",sorter:function(e,n){return e.permission.localeCompare(n.permission)},render:function(e,n){return(0,v.jsx)(J,{permission:n.permission})}},{title:D("data.Created"),dataIndex:"created_at",sorter:function(e,n){return e.created_at.localeCompare(n.created_at)},render:function(e,n){return ie()(e).format("L")}}];return(0,v.jsxs)(F.Z,{direction:"column",align:"stretch",gap:"xs",children:[(0,v.jsxs)(F.Z,{direction:"row",gap:"xs",justify:"between",children:[(0,v.jsx)(P.Z,{value:pe,onChange:function(e){return ge(e.target.value)},allowClear:!0,placeholder:D("data.SearchByName")}),(0,v.jsx)(h.ZP,{loading:ce,icon:(0,v.jsx)(Y.Z,{}),onClick:function(){ue((function(){se()}))}})]}),(0,v.jsx)(C.Z,{form:B,children:(0,v.jsx)(re.Z,(0,l.Z)({scroll:{x:"max-content"},rowKey:k,rowSelection:{selectedRowKeys:V,onChange:function(e){E(e),xe()}},showSorterTooltip:!1,columns:je,dataSource:fe,onRow:function(e,n){return{onClick:function(n){var t,r=n.target;null!==r&&void 0!==r&&null!==(t=r.classList)&&void 0!==t&&t.contains("ant-table-selection-column")&&(n.stopPropagation(),V.includes(k(e))?E(V.filter((function(n){return n!==k(e)}))):E([].concat((0,q.Z)(V),[k(e)])))}}}},w))})]})},le=["filter"],ce=function(e){var n=e.filter,t=(0,c.Z)(e,le),r=C.Z.useFormInstance(),s=(0,S.$G)().t;return C.Z.useWatch("vfoldersAliasMap",r),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(C.Z.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator:function(e,n){var t=f().chain(r.getFieldValue("mounts")).reduce((function(e,t){return e[t]=n[t]||"/home/work/"+t,e}),{}).values().value();return f().uniq(t).length!==t.length?Promise.reject(s("session.launcher.FolderAliasOverlapping")):Promise.resolve()}}],children:(0,v.jsx)(P.Z,{})}),(0,v.jsx)(C.Z.Item,(0,l.Z)((0,l.Z)({name:"mounts"},t),{},{valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,v.jsx)(ae,{rowKey:"name",showAliasInput:!0,aliasMap:r.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:function(e){r.setFieldValue("vfoldersAliasMap",e),r.validateFields(["vfoldersAliasMap"])},pagination:!1,filter:n})}))]})},ue=t(92331),de=t(91428),me=t(70442),he=t(84239),pe=t(89898),ge=t(99269),fe=t(90632),xe=t(46734),ve=t(88464),Ze=t(60284),je=t(41366),ye=t(22733),be=t(14634),Fe=t(62708),we=t(35492),ke=t(2704),Ce=t(80558),Pe=t(93448),Se=t(52176),Te=t(32461),Ie=t(48196),Ve=t(17490),Ee=t(12674),_e=t(4996),Me=t(5936),Ae=t(55144),Ne=(0,l.Z)({sessionType:"interactive",allocationPreset:"custom",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0},envvars:[]},R.ds),Oe=(0,Ae.withDefault)(Ae.NumberParam,0),ze=(0,Ae.withDefault)(Ae.JsonParam,Ne),Be=function(e){var n=e.form,t=e.containerCount,r=void 0===t?1:t;return(0,v.jsxs)(v.Fragment,{children:[f().map(f().omit(n.getFieldValue("resource"),"shmem","accelerator","acceleratorType"),(function(e,t){var s,i;return(0,v.jsx)(K.ZP,{type:t,value:"mem"===t?((null===(s=(0,G.PZ)(e,"b"))||void 0===s?void 0:s.number)||0)*r+"":f().toNumber(e)*r+"",opts:{shmem:n.getFieldValue("resource").shmem?((null===(i=(0,G.PZ)(n.getFieldValue("resource").shmem,"b"))||void 0===i?void 0:i.number)||0)*r:void 0}},t)})),f().isNumber(n.getFieldValue(["resource","accelerator"]))&&(0,v.jsx)(K.ZP,{type:n.getFieldValue(["resource","acceleratorType"]),value:f().toString(n.getFieldValue(["resource","accelerator"])*r)})]})},De=function(){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=0;t<8;t++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},Re=function(){for(var e,n=Math.floor(52*Math.random()*52*52),t="",r=0;r<3;r++)t+=(e=n%52)<26?String.fromCharCode(65+e):String.fromCharCode(97+e-26),n=Math.floor(n/52);return t},Ke=function(){var e,n,t,r,c,u,d,g="normal",Z=(0,x.useState)(!1),w=(0,a.Z)(Z,2),k=w[0],T=w[1],I=(0,Ae.useQueryParams)({step:Oe,formValues:ze,redirectTo:Ae.StringParam}),M=(0,a.Z)(I,2),z=M[0],K=z.step,q=z.formValues,U=z.redirectTo,W=M[1],$=(0,Ee.s0)(),H=(0,b.useWebComponentInfo)().moveTo,J=(0,A.Dj)(),X=(0,A.qh)(),Y=(0,fe.Z)((function(){console.log("syncFormToURLWithDebounce",le.getFieldsValue()),W({formValues:f().omit(le.getFieldsValue(),["environments.image"])},"replaceIn")}),{leading:!1,wait:500,trailing:!0}).run,ee=function(e){W({step:e},"pushIn")},te=m.Z.useToken().token,se=(0,S.$G)().t,oe=xe.ZP.useBreakpoint(),ae=C.Z.useForm(),le=(0,a.Z)(ae,1)[0];(0,x.useEffect)((function(){JSON.stringify(Ne)!==JSON.stringify(q)&&(le.setFieldsValue(q),le.validateFields().catch((function(e){})))}),[]),(0,x.useEffect)((function(){}),[K]);var Ke=C.Z.useWatch("sessionType",{form:le,preserve:!0})||le.getFieldValue("sessionType")||q.sessionType,Le=f().filter([{title:se("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(se("session.launcher.Environments")," & ").concat(se("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==Ke&&{title:se("webui.menu.Data&Storage"),key:"storage"},{title:se("session.launcher.Network"),key:"network"},{title:se("session.launcher.ConfirmAndLaunch"),icon:(0,v.jsx)(ue.Z,{}),key:"review"}],(function(e){return!!e})),qe=null===(e=Le[K])||void 0===e?void 0:e.key,Ge=f().some(le.getFieldsError(),(function(e){return e.errors.length>0})),Ue=function(){le.validateFields().catch((function(e){})).finally((function(){ee(Le.length-1)}))};return(0,v.jsxs)(F.Z,{direction:"column",align:"stretch",style:{padding:te.paddingSM,width:"100%",justifyContent:"revert"},children:[(0,v.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),U&&(0,v.jsx)(Ze.Z,{items:[{title:se("webui.menu.Sessions"),onClick:function(e){e.preventDefault(),H(U)},href:U},{title:se("session.launcher.StartNewSession")}]}),(0,v.jsxs)(F.Z,{direction:"row",gap:"md",align:"start",children:[(0,v.jsxs)(F.Z,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,v.jsxs)(F.Z,{direction:"row",justify:"between",children:[(0,v.jsx)(ne.Z.Title,{level:3,style:{marginTop:0},children:se("session.launcher.StartNewSession")}),(0,v.jsxs)(F.Z,{direction:"row",gap:"sm",children:[(0,v.jsx)(je.Z,{title:se("button.Reset"),description:se("session.launcher.ResetFormConfirm"),onConfirm:function(){le.resetFields(),$("/session/start")},icon:(0,v.jsx)(Q.Z,{style:{color:te.colorError}}),okText:se("button.Reset"),okButtonProps:{danger:!0},children:(0,v.jsx)(h.ZP,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:se("button.Reset")})}),(0,v.jsx)(h.ZP,{type:"link",icon:(0,v.jsx)(de.Z,{}),disabled:!0,style:{paddingRight:0,paddingLeft:0},children:se("session.launcher.TemplateAndHistory")})]})]}),(0,v.jsx)(C.Z.Provider,{onFormChange:function(e,n){Y()},children:(0,v.jsx)(C.Z,{form:le,layout:"vertical",requiredMark:"optional",initialValues:Ne,children:(0,v.jsxs)(F.Z,{direction:"column",align:"stretch",gap:"md",children:[(0,v.jsxs)(p.Z,{title:se("session.launcher.SessionType"),style:{display:"sessionType"===qe?"block":"none"},children:[(0,v.jsx)(C.Z.Item,{name:"sessionType",children:(0,v.jsx)(ye.ZP.Group,{className:"session-type-radio-group",options:[{label:(0,v.jsxs)(F.Z,{direction:"column",align:"start",style:{marginBottom:te.marginXS},children:[(0,v.jsx)(ne.Z.Text,{strong:!0,children:"\ud83c\udfc3\u200d\u2640\ufe0f Make, test and run"}),(0,v.jsxs)(ne.Z.Text,{type:"secondary",children:[(0,v.jsx)(ne.Z.Text,{code:!0,children:"Interactive mode"})," ","allows you to create, test and run code interactively via jupyter notebook, visual studio code, etc."]})]}),value:"interactive"},{label:(0,v.jsxs)(F.Z,{direction:"column",align:"start",children:[(0,v.jsx)(ne.Z.Text,{strong:!0,children:"\u231a\ufe0f Start an long-running task"}),(0,v.jsxs)(ne.Z.Text,{type:"secondary",children:[(0,v.jsx)(ne.Z.Text,{code:!0,children:"Batch mode"})," ","runs your code with multiple node & clusters to scale your idea"]})]}),value:"batch"}]})}),(0,v.jsx)(L,{})]}),"batch"===Ke&&(0,v.jsxs)(p.Z,{title:se("session.launcher.BatchModeConfig"),style:{display:"sessionType"===qe?"block":"none"},children:[(0,v.jsx)(C.Z.Item,{label:se("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,v.jsx)(P.Z.TextArea,{autoSize:!0})}),(0,v.jsx)(C.Z.Item,{label:se("session.launcher.SessionStartTime"),children:(0,v.jsxs)(F.Z,{direction:"row",gap:"xs",children:[(0,v.jsx)(C.Z.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,v.jsx)(be.Z,{onChange:function(e){e.target.checked&&f().isEmpty(le.getFieldValue(["batch","scheduleDate"]))?le.setFieldValue(["batch","scheduleDate"],ie()().add(2,"minutes").toISOString()):!1===e.target.checked&&le.setFieldValue(["batch","scheduleDate"],void 0)},children:se("session.launcher.Enable")})}),(0,v.jsx)(C.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var t,r;return(null===(t=e.batch)||void 0===t?void 0:t.enabled)!==(null===(r=n.batch)||void 0===r?void 0:r.enabled)},children:function(){var e,n=!0!==(null===(e=le.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(C.Z.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:function(){var e=(0,o.Z)((0,s.Z)().mark((function e(n,t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!ie()(t).isBefore(ie()())){e.next=2;break}return e.abrupt("return",Promise.reject(se("session.launcher.StartTimeMustBeInTheFuture")));case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}()}],children:(0,v.jsx)(y.Z,{disabled:n,showTime:!0,localFormat:!0,disabledDate:function(e){return e.isBefore(ie()().startOf("day"))}})})})}})]})})]}),"inference"===Ke&&(0,v.jsx)(p.Z,{title:"Inference Mode Configuration",children:(0,v.jsx)(C.Z.Item,{name:["inference","vFolderName"],label:se("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,v.jsx)(N.Z,{})})}),(0,v.jsxs)(p.Z,{title:se("session.launcher.Environments"),style:{display:"environment"===qe?"block":"none"},children:[(0,v.jsx)(Ve.SV,{fallbackRender:function(e){return console.log(e),null},children:(0,v.jsx)(E.Z,{})}),(0,v.jsx)(C.Z.Item,{label:"Environment Variables",children:(0,v.jsx)(V,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,v.jsx)(p.Z,{title:se("session.launcher.ResourceAllocation"),style:{display:"environment"===qe?"block":"none"},children:(0,v.jsx)(R.ZP,{enableNumOfSessions:!0})}),(0,v.jsxs)(p.Z,{title:se("session.launcher.HPCOptimization"),style:{display:"environment"===qe?"block":"none"},children:[(0,v.jsx)(C.Z.Item,{noStyle:!0,children:(0,v.jsxs)(F.Z,{direction:"row",gap:"sm",children:[(0,v.jsx)(ne.Z.Text,{children:se("session.launcher.SwitchOpenMPoptimization")}),(0,v.jsx)(C.Z.Item,{label:se("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,v.jsx)(Fe.Z,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:function(e){e&&le.setFieldsValue(f().pick(Ne,["hpcOptimization"]))}})})]})}),(0,v.jsx)(C.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var t,r;return(null===(t=e.hpcOptimization)||void 0===t?void 0:t.autoEnabled)!==(null===(r=n.hpcOptimization)||void 0===r?void 0:r.autoEnabled)},children:function(){var e=le.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,v.jsxs)(we.Z,{gutter:te.marginMD,style:{display:e?"none":void 0,marginTop:te.marginMD},children:[(0,v.jsx)(ke.Z,{xs:24,sm:12,children:(0,v.jsx)(C.Z.Item,{style:{flex:1},label:se("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,v.jsxs)(v.Fragment,{children:[se("session.launcher.OpenMPOptimization"),(0,v.jsx)(S.cC,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,v.jsx)(Ce.Z,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,v.jsx)(ke.Z,{xs:24,sm:12,children:(0,v.jsx)(C.Z.Item,{style:{flex:1},label:se("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,v.jsxs)(v.Fragment,{children:[se("session.launcher.OpenMPOptimization"),(0,v.jsx)(S.cC,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,v.jsx)(Ce.Z,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,v.jsx)(p.Z,{title:se("webui.menu.Data&Storage"),style:{display:"storage"===qe?"block":"none"},children:(0,v.jsx)(ce,{filter:function(e){return"ready"===e.status}})}),(0,v.jsx)(p.Z,{title:se("session.launcher.Network"),style:{display:"network"===qe?"block":"none"},children:(0,v.jsx)(D,{})}),"review"===qe&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(j,{title:se("session.launcher.SessionType"),size:"small",status:le.getFieldError("name").length>0||le.getFieldError(["batch","command"]).length>0||le.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:se("button.Edit"),onClickExtraButton:function(){ee(Le.findIndex((function(e){return"sessionType"===e.key})))},children:(0,v.jsxs)(Pe.Z,{size:"small",children:[(0,v.jsx)(Pe.Z.Item,{label:se("session.SessionType"),span:24,children:le.getFieldValue("sessionType")}),!f().isEmpty(le.getFieldValue("name"))&&(0,v.jsx)(Pe.Z.Item,{label:se("session.launcher.SessionName"),span:24,children:le.getFieldValue("name")}),"batch"===Ke&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(Pe.Z.Item,{label:se("session.launcher.StartUpCommand"),span:24,children:(0,v.jsx)(P.Z.TextArea,{readOnly:!0,autoSize:!0,value:le.getFieldValue(["batch","command"])})}),(0,v.jsx)(Pe.Z.Item,{label:se("session.launcher.ScheduleTimeSimple"),span:24,children:ie()(le.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)")})]})]})}),(0,v.jsx)(j,{title:se("session.launcher.Environments"),size:"small",status:f().some(le.getFieldValue("envvars"),(function(e,n){return le.getFieldError(["envvars",n,"variable"]).length>0||le.getFieldError(["envvars",n,"value"]).length>0}))?"error":void 0,extraButtonTitle:se("button.Edit"),onClickExtraButton:function(){ee(Le.findIndex((function(e){return"environment"===e.key})))},children:(0,v.jsxs)(Pe.Z,{size:"small",column:2,children:[(0,v.jsx)(Pe.Z.Item,{label:se("session.launcher.Project"),children:X.name}),(0,v.jsx)(Pe.Z.Item,{label:se("general.ResourceGroup"),children:le.getFieldValue("resourceGroup")}),(0,v.jsx)(Pe.Z.Item,{label:se("general.Image"),span:2,children:(0,v.jsxs)(F.Z,{direction:"row",gap:"xs",style:{flex:1},children:[(0,v.jsx)(_.Z,{image:null===(n=le.getFieldValue("environments"))||void 0===n?void 0:n.version}),(0,v.jsx)(ne.Z.Text,{copyable:!0,code:!0,children:null===(t=le.getFieldValue("environments"))||void 0===t?void 0:t.version})]})}),(null===(r=le.getFieldValue("envvars"))||void 0===r?void 0:r.length)>0&&(0,v.jsx)(Pe.Z.Item,{label:se("session.launcher.EnvironmentVariable"),children:null!==(c=le.getFieldValue("envvars"))&&void 0!==c&&c.length?(0,v.jsx)(_e.Z,{style:Me.Z,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:f().map(le.getFieldValue("envvars"),(function(e){return"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"')})).join("\n")}):(0,v.jsx)(ne.Z.Text,{type:"secondary",children:"-"})})]})}),(0,v.jsx)(j,{title:se("session.launcher.ResourceAllocation"),status:f().some(le.getFieldValue("resource"),(function(e,n){return le.getFieldError(["resource",n]).length>0}))?"error":void 0,size:"small",extraButtonTitle:se("button.Edit"),onClickExtraButton:function(){ee(Le.findIndex((function(e){return"environment"===e.key})))},children:(0,v.jsxs)(F.Z,{direction:"column",align:"stretch",children:[f().some(le.getFieldValue("resource"),(function(e,n){return le.getFieldWarning(["resource",n]).length>0}))&&(0,v.jsx)(Se.Z,{type:"warning",showIcon:!0,message:se("session.launcher.EnqueueComputeSessionWarning")}),(0,v.jsxs)(Pe.Z,{column:2,children:[(0,v.jsx)(Pe.Z.Item,{label:se("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,v.jsxs)(F.Z,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===le.getFieldValue("allocationPreset")?"":(0,v.jsx)(O.Z,{children:le.getFieldValue("allocationPreset")}),(0,v.jsx)(Be,{form:le})]})}),(0,v.jsx)(Pe.Z.Item,{label:se("session.launcher.NumberOfContainer"),children:1===le.getFieldValue("cluster_size")?le.getFieldValue("num_of_sessions"):le.getFieldValue("cluster_size")}),(0,v.jsx)(Pe.Z.Item,{label:se("session.launcher.ClusterMode"),children:"single-node"===le.getFieldValue("cluster_mode")?se("session.launcher.SingleNode"):se("session.launcher.MultiNode")})]}),(0,v.jsx)(p.Z,{size:"small",type:"inner",title:se("session.launcher.TotalAllocation"),children:(0,v.jsx)(F.Z,{direction:"row",gap:"xxs",children:(0,v.jsx)(Be,{form:le,containerCount:1===le.getFieldValue("cluster_size")?le.getFieldValue("num_of_sessions"):le.getFieldValue("cluster_size")})})})]})}),(0,v.jsx)(j,{title:se("webui.menu.Data&Storage"),size:"small",status:le.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:se("button.Edit"),onClickExtraButton:function(){ee(Le.findIndex((function(e){return"storage"===e.key})))},children:(null===(u=le.getFieldValue("mounts"))||void 0===u?void 0:u.length)>0?(0,v.jsx)(re.Z,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:se("data.folders.Name")},{dataIndex:"alias",title:se("session.launcher.FolderAlias"),render:function(e,n){return f().isEmpty(e)?(0,v.jsx)(ne.Z.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(n.name)}):e}}],dataSource:f().map(le.getFieldValue("mounts"),(function(e){var n;return{name:e,alias:null===(n=le.getFieldValue("vfoldersAliasMap"))||void 0===n?void 0:n[e]}}))}):(0,v.jsx)(Se.Z,{type:"warning",showIcon:!0,message:se("session.launcher.NoFolderMounted")})}),(0,v.jsx)(j,{title:"Network",size:"small",status:le.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:se("button.Edit"),onClickExtraButton:function(){ee(Le.findIndex((function(e){return"network"===e.key})))},children:(0,v.jsx)(Pe.Z,{size:"small",children:(0,v.jsx)(Pe.Z.Item,{label:se("session.launcher.PreOpenPortTitle"),children:(0,v.jsxs)(F.Z,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[f().sortBy(le.getFieldValue("ports"),(function(e){return parseInt(e)})).map((function(e){return(0,v.jsx)(B,{value:e,style:{margin:0},children:e})})),f().isArray(le.getFieldValue("ports"))&&0!==(null===(d=le.getFieldValue("ports"))||void 0===d?void 0:d.length)?null:(0,v.jsx)(ne.Z.Text,{type:"secondary",children:se("general.None")})]})})})})]}),(0,v.jsxs)(F.Z,{direction:"row",justify:"between",children:[(0,v.jsx)(F.Z,{gap:"sm",children:K===Le.length-1&&(0,v.jsx)(h.ZP,{icon:(0,v.jsx)(me.Z,{}),disabled:!0,onClick:function(){ve.ZP.info("Not implemented yet: Template edit modal")},children:"Save as a template"})}),(0,v.jsxs)(F.Z,{direction:"row",gap:"sm",children:[K!==Le.length-1&&(0,v.jsx)(h.ZP,{onClick:Ue,children:"Skip to Review"}),K>0&&(0,v.jsx)(h.ZP,{onClick:function(){ee(K-1)},icon:(0,v.jsx)(he.Z,{}),disabled:k,children:"Previous"}),K===Le.length-1?(0,v.jsx)(h.ZP,{type:"primary",icon:(0,v.jsx)(pe.Z,{}),disabled:Ge,onClick:function(){T(!0),le.validateFields().then(function(){var e=(0,o.Z)((0,s.Z)().mark((function e(n){var t,r,o,c,u,d;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.environments.version.split("@"),r=(0,a.Z)(t,2),o=r[0],c=r[1],u={kernelName:o,architecture:c,sessionName:f().isEmpty(n.name)?De():n.name,config:(0,l.Z)((0,l.Z)((0,l.Z)({type:n.sessionType},"batch"===n.sessionType?{startsAt:n.batch.enabled?n.batch.scheduleDate:void 0,startupCommand:n.batch.command}:{}),{},{group_name:X.name,domain:J._config.domainName,scaling_group:n.resourceGroup,cluster_mode:n.cluster_mode,cluster_size:n.cluster_size,maxWaitSeconds:15,cpu:n.resource.cpu,mem:n.resource.mem,shmem:(0,G.p)(n.resource.mem,"4g")>0&&(0,G.p)(n.resource.shmem,"1g")<0?"1g":n.resource.shmem},n.resource.accelerator>0?(0,i.Z)({},n.resource.acceleratorType,n.resource.accelerator):void 0),{},{mounts:n.mounts,mount_map:n.vfoldersAliasMap,env:(0,l.Z)((0,l.Z)({},f().fromPairs(n.envvars.map((function(e){return[e.variable,e.value]})))),f().omit(n.hpcOptimization,"autoEnabled")),preopen_ports:f().map(n.ports,(function(e){return parseInt(e)}))})},d=f().map(f().range(n.num_of_sessions||1),(function(e){var t=(n.num_of_sessions||1)>1?"".concat(u.sessionName,"-").concat(Re(),"-").concat(e):u.sessionName;return J.createIfNotExists(u.kernelName,t,u.config,2e4,u.architecture).then((function(e){return null!==e&&void 0!==e&&e.created||ve.ZP.warning(se("session.launcher.SessionAlreadyExists")),e})).catch((function(e){throw console.log(e),e}))})),e.next=5,Promise.all(d).then((function(e){var t=(0,a.Z)(e,1)[0];if(1===n.num_of_sessions&&"batch"!==n.sessionType){var r,s=t;r="kernelId"in s?{"session-name":s.kernelId,"access-key":"",mode:g}:{"session-uuid":s.sessionId,"session-name":s.sessionName,"access-key":"",mode:g};var i=s.servicePorts;!0===Array.isArray(i)?r["app-services"]=i.map((function(e){return e.name})):r["app-services"]=[],i.length>0&&globalThis.appLauncher.showLauncher(r)}$("/job",{}),H("/job")})).catch((function(){}));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("validation errors",e)})).finally((function(){T(!1)}))},loading:k,children:se("session.launcher.Launch")}):(0,v.jsxs)(h.ZP,{type:"primary",ghost:!0,onClick:function(){ee(K+1)},children:["Next ",(0,v.jsx)(ge.Z,{})]})]})]})]})})})]}),oe.lg&&(0,v.jsx)(Te.Z,{offsetTop:150,style:{zIndex:2},children:(0,v.jsx)(Ie.Z,{size:"small",direction:"vertical",current:K,onChange:function(e){e===Le.length-1?Ue():ee(e)},items:f().map(Le,(function(e,n){return(0,l.Z)((0,l.Z)({},e),{},{status:n===K?"process":"wait"})}))})})]})]})}}}]);
//# sourceMappingURL=436.a74e3d4e.chunk.js.map