/*! For license information please see 3775.bf6c0061.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[3775],{83775:(e,a,l)=>{l.r(a),l.d(a,{default:()=>$e});const n=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"access_key"}],a=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"access_key"}],concreteType:"DeleteKeyPair",kind:"LinkedField",name:"delete_keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserCredentialListDeleteMutation",selections:a,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserCredentialListDeleteMutation",selections:a},params:{cacheID:"00d579de4db39e2f3e48067fb19aaf72",id:null,metadata:{},name:"UserCredentialListDeleteMutation",operationKind:"mutation",text:"mutation UserCredentialListDeleteMutation(\n  $access_key: String!\n) {\n  delete_keypair(access_key: $access_key) {\n    ok\n    msg\n  }\n}\n"}}}();n.hash="b955bc28ed14b19b153f202b0f1e6e22";const i=n,r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"access_key"},{defaultValue:null,kind:"LocalArgument",name:"props"}],a=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"access_key"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"ModifyKeyPair",kind:"LinkedField",name:"modify_keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserCredentialListModifyMutation",selections:a,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserCredentialListModifyMutation",selections:a},params:{cacheID:"49292a75a914ad1eeb6f8e2667974b95",id:null,metadata:{},name:"UserCredentialListModifyMutation",operationKind:"mutation",text:"mutation UserCredentialListModifyMutation(\n  $access_key: String!\n  $props: ModifyKeyPairInput!\n) {\n  modify_keypair(access_key: $access_key, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();r.hash="b3504d39bac9dd8ac749460ba5e510c0";const t=r,s=function(){var e={defaultValue:null,kind:"LocalArgument",name:"domain_name"},a={defaultValue:null,kind:"LocalArgument",name:"email"},l={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"is_active"},i={defaultValue:null,kind:"LocalArgument",name:"limit"},r={defaultValue:null,kind:"LocalArgument",name:"offset"},t={defaultValue:null,kind:"LocalArgument",name:"order"},s=[{kind:"Variable",name:"domain_name",variableName:"domain_name"},{kind:"Variable",name:"email",variableName:"email"},{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"is_active",variableName:"is_active"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"order",variableName:"order"}],o={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"is_admin",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"rate_limit",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"num_queries",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"concurrency_used",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null};return{fragment:{argumentDefinitions:[e,a,l,n,i,r,t],kind:"Fragment",metadata:null,name:"UserCredentialListQuery",selections:[{alias:null,args:s,concreteType:"KeyPairList",kind:"LinkedField",name:"keypair_list",plural:!1,selections:[{alias:null,args:null,concreteType:"KeyPair",kind:"LinkedField",name:"items",plural:!0,selections:[o,d,u,c,m,g,p,y,k,{args:null,kind:"FragmentSpread",name:"KeypairSettingModalFragment"},{args:null,kind:"FragmentSpread",name:"KeypairInfoModalFragment"}],storageKey:null},f],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[i,r,l,t,e,a,n],kind:"Operation",name:"UserCredentialListQuery",selections:[{alias:null,args:s,concreteType:"KeyPairList",kind:"LinkedField",name:"keypair_list",plural:!1,selections:[{alias:null,args:null,concreteType:"KeyPair",kind:"LinkedField",name:"items",plural:!0,selections:[o,d,u,c,m,g,p,y,k,{alias:null,args:null,kind:"ScalarField",name:"secret_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null}],storageKey:null},f],storageKey:null}]},params:{cacheID:"3318983898774e0fa0110bbe3a8f1ad5",id:null,metadata:{},name:"UserCredentialListQuery",operationKind:"query",text:'query UserCredentialListQuery(\n  $limit: Int!\n  $offset: Int!\n  $filter: String\n  $order: String\n  $domain_name: String\n  $email: String\n  $is_active: Boolean\n) {\n  keypair_list(limit: $limit, offset: $offset, filter: $filter, order: $order, domain_name: $domain_name, email: $email, is_active: $is_active) {\n    items {\n      id\n      user_id\n      access_key\n      is_admin\n      resource_policy\n      created_at\n      rate_limit\n      num_queries\n      concurrency_used @since(version: "24.09.0")\n      ...KeypairSettingModalFragment\n      ...KeypairInfoModalFragment\n    }\n    total_count\n  }\n}\n\nfragment KeypairInfoModalFragment on KeyPair {\n  user_id\n  access_key\n  secret_key\n  is_admin\n  created_at\n  last_used\n  resource_policy\n  num_queries\n  rate_limit\n  concurrency_used @since(version: "24.09.0")\n}\n\nfragment KeypairSettingModalFragment on KeyPair {\n  rate_limit\n  access_key\n  resource_policy\n}\n'}}}();s.hash="591117e6f6a9853325076522a5e68177";const o=s;var d=l(43224),u=l(90615),c=l(87246);const m=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domain_name"},{defaultValue:null,kind:"LocalArgument",name:"email"}],a=[{kind:"Variable",name:"domain_name",variableName:"domain_name"},{kind:"Variable",name:"email",variableName:"email"}],l={alias:null,args:null,kind:"ScalarField",name:"main_access_key",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"KeypairInfoModalQuery",selections:[{alias:null,args:a,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"KeypairInfoModalQuery",selections:[{alias:null,args:a,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"ae75c283d1803be0e160390a438f1ef0",id:null,metadata:{},name:"KeypairInfoModalQuery",operationKind:"query",text:'query KeypairInfoModalQuery(\n  $domain_name: String\n  $email: String\n) {\n  user(domain_name: $domain_name, email: $email) {\n    main_access_key @since(version: "24.03.0")\n    id\n  }\n}\n'}}}();m.hash="4e1858d8f369f238aa329976b4678e7b";const g=m,p={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"KeypairInfoModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"secret_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_admin",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_queries",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"rate_limit",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"concurrency_used",storageKey:null}],type:"KeyPair",abstractKey:null,hash:"11d6baebc6283f59151dab410a2a80d2"},y=p;var k=l(234),f=l(8334),v=l(85829),_=l(77419),b=l(45045),S=l(70127),x=l.n(S),h=l(93039),A=l(69775),K=l(66845);const F=e=>{var a;let{keypairInfoModalFrgmt:l=null,onRequestClose:n,...i}=e;const{token:r}=k.A.useToken(),t=(0,A.useFragment)(y,l),{user:s}=(0,A.useLazyLoadQuery)(g,{email:null===t||void 0===t?void 0:t.user_id},{fetchPolicy:i.open&&null!==t&&void 0!==t&&t.user_id?"network-only":"store-only"});return(0,K.jsxs)(b.Ib,{title:(0,K.jsxs)(b.OO,{gap:"xs",children:[(0,K.jsx)(f.A.Text,{style:{fontSize:r.fontSizeHeading5},children:(0,h.t)("credential.KeypairDetail")}),(null===s||void 0===s?void 0:s.main_access_key)===(null===t||void 0===t?void 0:t.access_key)&&(0,K.jsx)(v.A,{color:"red",children:(0,h.t)("credential.MainAccessKey")})]}),onCancel:()=>n(),footer:null,...i,children:[(0,K.jsxs)(_.A,{title:(0,h.t)("credential.Information"),size:"small",column:1,labelStyle:{width:"40%"},children:[(0,K.jsx)(_.A.Item,{label:(0,h.t)("credential.UserID"),children:null===t||void 0===t?void 0:t.user_id}),(0,K.jsx)(_.A.Item,{label:(0,h.t)("credential.AccessKey"),children:null===t||void 0===t?void 0:t.access_key}),(0,K.jsx)(_.A.Item,{label:(0,h.t)("credential.SecretKey"),children:(0,K.jsx)(f.A.Text,{copyable:{text:null!==(a=null===t||void 0===t?void 0:t.secret_key)&&void 0!==a?a:""},children:null!==t&&void 0!==t&&t.secret_key?"********":""})}),(0,K.jsx)(_.A.Item,{label:(0,h.t)("credential.Permission"),children:null!==t&&void 0!==t&&t.is_admin?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(v.A,{color:"red",children:"admin"}),(0,K.jsx)(v.A,{color:"green",children:"user"})]}):(0,K.jsx)(v.A,{color:"green",children:"user"})}),(0,K.jsx)(_.A.Item,{label:(0,h.t)("credential.CreatedAt"),children:x()(null===t||void 0===t?void 0:t.created_at).format("lll")}),(0,K.jsx)(_.A.Item,{label:(0,h.t)("credential.LastUsed"),children:null!==t&&void 0!==t&&t.last_used?x()(null===t||void 0===t?void 0:t.last_used).format("lll"):"-"})]}),(0,K.jsx)("br",{}),(0,K.jsxs)(_.A,{title:(0,h.t)("credential.Allocation"),size:"small",column:1,labelStyle:{width:"40%"},children:[(0,K.jsx)(_.A.Item,{label:(0,h.t)("credential.ResourcePolicy"),children:null===t||void 0===t?void 0:t.resource_policy}),(0,K.jsx)(_.A.Item,{label:(0,h.t)("credential.NumberOfQueries"),children:null===t||void 0===t?void 0:t.num_queries}),(0,K.jsx)(_.A.Item,{label:(0,h.t)("credential.ConcurrentSessions"),children:null===t||void 0===t?void 0:t.concurrency_used}),(0,K.jsx)(_.A.Item,{label:`${(0,h.t)("credential.RateLimit")} ${(0,h.t)("credential.For900Seconds")}`,children:null===t||void 0===t?void 0:t.rate_limit})]})]})},j=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"access_key"},{defaultValue:null,kind:"LocalArgument",name:"props"}],a=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"access_key"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"ModifyKeyPair",kind:"LinkedField",name:"modify_keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"KeypairSettingModalModifyMutation",selections:a,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"KeypairSettingModalModifyMutation",selections:a},params:{cacheID:"0bf2a12bbaaabcbf7577479149266c0b",id:null,metadata:{},name:"KeypairSettingModalModifyMutation",operationKind:"mutation",text:"mutation KeypairSettingModalModifyMutation(\n  $access_key: String!\n  $props: ModifyKeyPairInput!\n) {\n  modify_keypair(access_key: $access_key, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();j.hash="59732bd851a981ce0e4bd3bda1b4c602";const M=j,T=function(){var e={defaultValue:null,kind:"LocalArgument",name:"props"},a={defaultValue:null,kind:"LocalArgument",name:"user_id"},l=[{alias:null,args:[{kind:"Variable",name:"props",variableName:"props"},{kind:"Variable",name:"user_id",variableName:"user_id"}],concreteType:"CreateKeyPair",kind:"LinkedField",name:"create_keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,a],kind:"Fragment",metadata:null,name:"KeypairSettingModalCreateMutation",selections:l,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,e],kind:"Operation",name:"KeypairSettingModalCreateMutation",selections:l},params:{cacheID:"2911946ae5cad21bdff21cc88cf64c74",id:null,metadata:{},name:"KeypairSettingModalCreateMutation",operationKind:"mutation",text:"mutation KeypairSettingModalCreateMutation(\n  $user_id: String!\n  $props: KeyPairInput!\n) {\n  create_keypair(user_id: $user_id, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();T.hash="a81bb2d7d4e5a095deaf58a442f4211d";const L=T,I={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"KeypairSettingModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"rate_limit",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null}],type:"KeyPair",abstractKey:null,hash:"a453330249f3d6cb4a241e19f2314614"},P=I,C=function(){var e=[{alias:null,args:null,concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policies",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"KeypairResourcePolicySelectorQuery",selections:e,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"KeypairResourcePolicySelectorQuery",selections:e},params:{cacheID:"98cc9e7ac02916e772401f1672dc324f",id:null,metadata:{},name:"KeypairResourcePolicySelectorQuery",operationKind:"query",text:"query KeypairResourcePolicySelectorQuery {\n  keypair_resource_policies {\n    name\n  }\n}\n"}}}();C.hash="3052deb294da5fb0ec7a981d8fade18f";const U=C;var D=l(92882),O=l(19995),w=l(89881),N=l(43749),$=l.n(N),V=l(51569);const R=e=>{let{...a}=e;const{t:l}=(0,V.Bd)(),[n,i]=(0,O.A)({value:a.value,onChange:a.onChange}),{keypair_resource_policies:r}=(0,A.useLazyLoadQuery)(U,{},{fetchPolicy:"store-and-network"});return(0,K.jsx)(w.A,{showSearch:!0,placeholder:l("credential.SelectPolicy"),options:$().map(r,(e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name}))).sort(((e,a)=>(0,D._f)(null===e||void 0===e?void 0:e.label,null===a||void 0===a?void 0:a.label))),...a,value:n,onChange:(e,a)=>{i(e,a)}})};var q=l(52688),Q=l(40370),z=l(73017),E=l(84928),B=l(57442),X=l(26918),Y=l(21481);const G=e=>{let{keypairSettingModalFrgmt:a=null,onRequestClose:l,...n}=e;const{t:i}=(0,V.Bd)(),{message:r}=q.A.useApp(),t=(0,Y.useRef)(null),s=(0,A.useFragment)(P,a),[o,d]=(0,A.useMutation)(L),[u,c]=(0,A.useMutation)(M);return(0,K.jsx)(b.Ib,{title:i(s?"credential.ModifyKeypairResourcePolicy":"credential.AddCredential"),width:500,destroyOnHidden:!0,onOk:()=>{var e;null===(e=t.current)||void 0===e||e.validateFields().then((e=>{var a,n;s?u({variables:{access_key:null!==(a=s.access_key)&&void 0!==a?a:"",props:{rate_limit:e.rate_limit,resource_policy:e.resource_policy}},onCompleted:(e,a)=>{var n,t;if(null===(n=e.modify_keypair)||void 0===n||!n.ok||a)return r.error(null===e||void 0===e||null===(t=e.modify_keypair)||void 0===t?void 0:t.msg),void l(!1);r.success(i("notification.SuccessfullyUpdated")),l(!0)},onError:e=>{r.error(e.message),l(!1)}}):o({variables:{user_id:null!==(n=e.user_id)&&void 0!==n?n:"",props:{rate_limit:e.rate_limit,resource_policy:e.resource_policy}},onCompleted:(e,a)=>{var n,t;if(null===(n=e.create_keypair)||void 0===n||!n.ok||a)return r.error(null===e||void 0===e||null===(t=e.create_keypair)||void 0===t?void 0:t.msg),void l(!1);r.success(i("credential.KeypairCreated")),l(!0)},onError:e=>{r.error(e.message),l(!1)}})})).catch((()=>{}))},okButtonProps:{loading:d||c},onCancel:()=>l(!1),...n,children:(0,K.jsxs)(Q.A,{ref:t,layout:"vertical",initialValues:s?{...s}:{},children:[!s&&(0,K.jsx)(Q.A.Item,{name:"user_id",label:i("credential.UserIDAsEmail"),rules:[{required:!0},{type:"email"}],children:(0,K.jsx)(z.A,{})}),(0,K.jsxs)(E.A,{gutter:16,children:[(0,K.jsx)(B.A,{span:12,children:(0,K.jsx)(Q.A.Item,{name:"resource_policy",label:i("credential.ResourcePolicy"),rules:[{required:!0}],children:(0,K.jsx)(R,{})})}),(0,K.jsx)(B.A,{span:12,children:(0,K.jsx)(Q.A.Item,{name:"rate_limit",label:i("credential.RateLimitFor15min"),rules:[{required:!0},{type:"number",min:0,max:5e4},{validator:(e,a)=>a<=100?Promise.reject(i("credential.WarningLessRateLimit")):Promise.resolve(),warningOnly:!0}],children:(0,K.jsx)(X.A,{min:0,max:5e4,style:{width:"100%"}})})})]})]})})};var Z=l(37679),H=l(39544),W=l(78125),J=l(4978),ee=l(91454),ae=l(93685),le=l(33112),ne=l(74803),ie=l(25133),re=l(7326),te=l(7927);const se=()=>{const{t:e}=(0,V.Bd)(),{token:a}=k.A.useToken(),{message:l,modal:n}=q.A.useApp(),[r,s]=(0,te.useQueryParam)("action",te.StringParam),[m,g]=(0,d.Tw)("first"),[p,y]=(0,te.useQueryParams)({activeType:(0,te.withDefault)(te.StringParam,"active"),order:(0,te.withDefault)(te.StringParam,void 0),filter:(0,te.withDefault)(te.StringParam,void 0)}),[_,S]=(0,Y.useState)(null),[h,j]=(0,Y.useState)(!1),[M,T]=(0,Y.useState)(null),[L,I]=(0,Y.useTransition)(),[P,C]=(0,Y.useTransition)(),{baiPaginationOption:U,tablePaginationOption:D,setTablePaginationOption:O}=(0,u.L0)({current:1,pageSize:20}),w={limit:U.limit,offset:U.offset,is_active:"active"===p.activeType,filter:p.filter,order:p.order},N=(0,Y.useDeferredValue)(w),R=(0,Y.useDeferredValue)(m),{keypair_list:Q}=(0,A.useLazyLoadQuery)(o,N,{fetchKey:R,fetchPolicy:R===d.eI?"store-and-network":"network-only"}),[z,E]=(0,A.useMutation)(t),[B,X]=(0,A.useMutation)(i);return(0,Y.useEffect)((()=>{"add"===r&&(j(!0),s(void 0))}),[r,s]),(0,K.jsxs)(b.OO,{direction:"column",align:"stretch",gap:"sm",children:[(0,K.jsxs)(b.OO,{justify:"between",align:"start",gap:"xs",wrap:"wrap",children:[(0,K.jsxs)(b.OO,{gap:"sm",align:"start",children:[(0,K.jsx)(c.A,{value:p.activeType,onChange:e=>{y({activeType:e.target.value},"replaceIn"),O({current:1,pageSize:D.pageSize})},optionType:"button",options:[{label:e("general.Active"),value:"active"},{label:e("general.Inactive"),value:"inactive"}]}),(0,K.jsx)(b.Af,{filterProperties:[{key:"email",propertyLabel:e("credential.UserID"),type:"string"},{key:"access_key",propertyLabel:e("credential.AccessKey"),type:"string"},{key:"is_admin",propertyLabel:e("credential.Permission"),type:"boolean",strictSelection:!0,defaultOperator:"==",options:[{label:"admin",value:"true"},{label:"user",value:"false"}]},{key:"resource_policy",propertyLabel:e("credential.ResourcePolicy"),type:"string"}],value:p.filter,onChange:e=>{y({filter:e},"replaceIn")}})]}),(0,K.jsxs)(b.OO,{gap:"xs",children:[(0,K.jsx)(ee.A,{title:e("button.Refresh"),children:(0,K.jsx)(ae.Ay,{loading:R!==m,onClick:()=>{g()},icon:(0,K.jsx)(Z.A,{})})}),(0,K.jsx)(ae.Ay,{type:"primary",icon:(0,K.jsx)(ne.A,{}),onClick:()=>{j(!0)},children:e("credential.AddCredential")})]})]}),(0,K.jsx)(b.zx,{rowKey:"id",scroll:{x:"max-content"},loading:N!==w,dataSource:(0,b.f)(null===Q||void 0===Q?void 0:Q.items),columns:(0,b.YM)([{key:"userID",title:e("credential.UserID"),dataIndex:"email",fixed:"left",sorter:!0,render:(e,a)=>a.user_id},{key:"accessKey",title:e("credential.AccessKey"),dataIndex:"access_key",sorter:!0},{key:"permission",title:e("credential.Permission"),dataIndex:"is_admin",render:e=>e?(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(v.A,{color:"red",children:"admin"}),(0,K.jsx)(v.A,{color:"green",children:"user"})]}):(0,K.jsx)(v.A,{color:"green",children:"user"}),sorter:!0},{key:"keyAge",title:e("credential.KeyAge"),dataIndex:"created_at",render:a=>`${x()().diff(a,"day")}${e("credential.Days")}`,sorter:!0},{key:"createdAt",title:e("credential.CreatedAt"),dataIndex:"created_at",render:e=>x()(e).format("lll"),sorter:!0},{key:"resourcePolicy",title:e("credential.ResourcePolicy"),dataIndex:"resource_policy",sorter:!0},{key:"allocation",title:e("credential.Allocation"),render:l=>(0,K.jsxs)(b.OO,{direction:"column",align:"start",children:[(0,K.jsxs)(f.A.Text,{children:[l.concurrency_used,(0,K.jsx)(f.A.Text,{type:"secondary",style:{marginLeft:a.marginXXS,fontSize:a.fontSizeSM},children:e("credential.Sessions")})]}),(0,K.jsxs)(f.A.Text,{style:{fontSize:a.fontSizeSM},children:[l.rate_limit,(0,K.jsx)(f.A.Text,{type:"secondary",style:{marginLeft:a.marginXXS,fontSize:a.fontSizeSM},children:e("credential.ReqPer15Min")})]}),(0,K.jsxs)(f.A.Text,{style:{fontSize:a.fontSizeSM},children:[l.num_queries,(0,K.jsx)(f.A.Text,{type:"secondary",style:{marginLeft:a.marginXXS,fontSize:a.fontSizeSM},children:e("credential.Queries")})]})]})},{key:"control",title:e("general.Control"),fixed:"right",render:(i,r)=>(0,K.jsxs)(b.OO,{gap:a.marginXS,children:[(0,K.jsx)(ae.Ay,{type:"text",icon:(0,K.jsx)(H.A,{style:{color:a.colorSuccess}}),onClick:()=>{I((()=>{T(r)}))}}),(0,K.jsx)(ae.Ay,{type:"text",icon:(0,K.jsx)(W.A,{style:{color:a.colorInfo}}),onClick:()=>{C((()=>{S(r)}))}}),"inactive"===p.activeType&&(0,K.jsx)(ee.A,{title:e("credential.Activate"),children:(0,K.jsx)(le.A,{title:e("credential.ActivateCredential"),description:r.user_id,okText:e("credential.Activate"),placement:"left",onConfirm:()=>{var a;z({variables:{access_key:null!==(a=r.access_key)&&void 0!==a?a:"",props:{is_active:!0}},onCompleted:(a,n)=>{var i,r;null!==a&&void 0!==a&&null!==(i=a.modify_keypair)&&void 0!==i&&i.ok&&!n?(l.success(e("credential.KeypairStatusUpdatedSuccessfully")),g()):l.error(null===a||void 0===a||null===(r=a.modify_keypair)||void 0===r?void 0:r.msg)},onError:e=>{l.error(null===e||void 0===e?void 0:e.message),console.error(e)}})},children:(0,K.jsx)(ae.Ay,{type:"text",icon:(0,K.jsx)(ie.A,{})})})}),"active"===p.activeType?(0,K.jsx)(ee.A,{title:e("credential.Deactivate"),children:(0,K.jsx)(le.A,{title:e("credential.DeactivateCredential"),description:r.user_id,okButtonProps:{loading:E},okType:"danger",okText:e("credential.Deactivate"),placement:"left",onConfirm:()=>{var a;z({variables:{access_key:null!==(a=r.access_key)&&void 0!==a?a:"",props:{is_active:!1}},onCompleted:(a,n)=>{var i,r;null!==a&&void 0!==a&&null!==(i=a.modify_keypair)&&void 0!==i&&i.ok&&!n?(l.success(e("credential.KeypairStatusUpdatedSuccessfully")),g()):l.error(null===a||void 0===a||null===(r=a.modify_keypair)||void 0===r?void 0:r.msg)},onError:e=>{l.error(null===e||void 0===e?void 0:e.message),console.error(e)}})},children:(0,K.jsx)(ae.Ay,{type:"text",danger:!0,icon:(0,K.jsx)(re.A,{})})})}):(0,K.jsx)(ae.Ay,{type:"text",danger:!0,icon:(0,K.jsx)(J.A,{}),loading:X,onClick:()=>{n.confirm({title:e("credential.DeleteCredential"),content:(0,K.jsxs)(b.OO,{direction:"column",align:"stretch",children:[(0,K.jsx)(f.A.Text,{children:e("credential.YouAreAboutToDeleteCredential")}),(0,K.jsx)(f.A.Text,{strong:!0,children:r.user_id}),(0,K.jsx)("br",{}),(0,K.jsx)(f.A.Text,{type:"danger",children:e("dialog.warning.CannotBeUndone")})]}),onOk:()=>{var a;B({variables:{access_key:null!==(a=r.access_key)&&void 0!==a?a:""},onCompleted:(a,n)=>{var i,r;null!==a&&void 0!==a&&null!==(i=a.delete_keypair)&&void 0!==i&&i.ok&&!n?(l.success(e("credential.KeypairSuccessfullyDeleted")),g()):l.error(null===a||void 0===a||null===(r=a.delete_keypair)||void 0===r?void 0:r.msg)},onError:e=>{l.error(null===e||void 0===e?void 0:e.message),console.error(e)}})},okButtonProps:{danger:!0},okText:e("button.Delete")})}})]})}]),showSorterTooltip:!1,pagination:{pageSize:D.pageSize,total:(null===Q||void 0===Q?void 0:Q.total_count)||0,current:D.current,onChange(e,a){$().isNumber(e)&&$().isNumber(a)&&O({current:e,pageSize:a})}},onChangeOrder:e=>{y({order:e},"replaceIn")}}),(0,K.jsx)(F,{keypairInfoModalFrgmt:M,open:!!M||L,loading:L,onRequestClose:()=>{T(null)}}),(0,K.jsx)(G,{keypairSettingModalFrgmt:_,loading:P,open:!!_||P||h,onRequestClose:e=>{S(null),j(!1),e&&g()}})]})},oe=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"props"}],a=[{alias:null,args:[{kind:"Variable",name:"email",variableName:"email"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserNodeListModifyMutation",selections:a,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserNodeListModifyMutation",selections:a},params:{cacheID:"e5b806ab045f58761fda6a600a152b09",id:null,metadata:{},name:"UserNodeListModifyMutation",operationKind:"mutation",text:"mutation UserNodeListModifyMutation(\n  $email: String!\n  $props: ModifyUserInput!\n) {\n  modify_user(email: $email, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();oe.hash="c6c04b9b22e9843ff5f39bdc7f7ddcef";const de=oe,ue=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},a={defaultValue:null,kind:"LocalArgument",name:"first"},l={defaultValue:null,kind:"LocalArgument",name:"offset"},n={defaultValue:null,kind:"LocalArgument",name:"order"},i=[{alias:null,args:[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"first",variableName:"first"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"order",variableName:"order"}],concreteType:"UserConnection",kind:"LinkedField",name:"user_nodes",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"count",storageKey:null},{alias:null,args:null,concreteType:"UserEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"UserNode",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,a,l,n],kind:"Fragment",metadata:null,name:"UserNodeListQuery",selections:i,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,l,e,n],kind:"Operation",name:"UserNodeListQuery",selections:i},params:{cacheID:"e53b339922da0ca6ffbff07957c0e01f",id:null,metadata:{},name:"UserNodeListQuery",operationKind:"query",text:"query UserNodeListQuery(\n  $first: Int\n  $offset: Int\n  $filter: String\n  $order: String\n) {\n  user_nodes(first: $first, offset: $offset, filter: $filter, order: $order) {\n    count\n    edges {\n      node {\n        id\n        full_name\n        role\n        description\n        email\n        username\n        created_at\n        status\n      }\n    }\n  }\n}\n"}}}();ue.hash="42a6195e0bec81c661b19a540789b1fd";const ce=ue,me=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportSudoSessionEnabled"},{defaultValue:null,kind:"LocalArgument",name:"isTOTPSupported"}],a=[{kind:"Variable",name:"email",variableName:"email"}],l={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},c={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[u,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},p={condition:"isTOTPSupported",kind:"Condition",passingValue:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null}]},y={alias:null,args:null,kind:"ScalarField",name:"main_access_key",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserInfoModalQuery",selections:[{alias:null,args:a,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,n,i,r,t,s,o,d,c,m,g,p,y],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserInfoModalQuery",selections:[{alias:null,args:a,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,n,i,r,t,s,o,d,c,m,g,p,y,u],storageKey:null}]},params:{cacheID:"d675c49fbcf67cc926cd8f0f3f7a0a93",id:null,metadata:{},name:"UserInfoModalQuery",operationKind:"query",text:'query UserInfoModalQuery(\n  $email: String\n  $isNotSupportSudoSessionEnabled: Boolean!\n  $isTOTPSupported: Boolean!\n) {\n  user(email: $email) {\n    email\n    username\n    need_password_change\n    full_name\n    description\n    status\n    domain_name\n    role\n    groups {\n      id\n      name\n    }\n    resource_policy\n    sudo_session_enabled @skipOnClient(if: $isNotSupportSudoSessionEnabled)\n    totp_activated @include(if: $isTOTPSupported)\n    main_access_key @since(version: "23.09.7")\n    id\n  }\n}\n'}}}();me.hash="4c1eaa080e82b723c9491072604e8925";const ge=me;var pe=l(23054),ye=l(69313);const ke=e=>{let{userEmail:a,onRequestClose:l,...n}=e;const{t:i}=(0,V.Bd)(),{isTOTPSupported:r,isLoading:t}=(0,pe.F4)(),{user:s}=(0,A.useLazyLoadQuery)(ge,{email:a,isNotSupportSudoSessionEnabled:!1,isTOTPSupported:null!==r&&void 0!==r&&r}),o={xxl:1,xl:1,lg:1,md:1,sm:1,xs:1};return(0,K.jsxs)(b.Ib,{centered:!0,title:i("credential.UserDetail"),footer:null,onCancel:l,...n,children:[(0,K.jsxs)(_.A,{size:"small",column:o,title:i("credential.Information"),labelStyle:{width:"50%"},children:[(0,K.jsx)(_.A.Item,{label:i("credential.UserID"),children:null===s||void 0===s?void 0:s.email}),(0,K.jsx)(_.A.Item,{label:i("credential.Description"),children:null===s||void 0===s?void 0:s.description}),(0,K.jsx)(_.A.Item,{label:i("credential.UserName"),children:null===s||void 0===s?void 0:s.username}),(0,K.jsx)(_.A.Item,{label:i("credential.FullName"),children:null===s||void 0===s?void 0:s.full_name}),(0,K.jsx)(_.A.Item,{label:i("credential.MainAccessKey"),children:null===s||void 0===s?void 0:s.main_access_key}),(0,K.jsx)(_.A.Item,{label:i("credential.DescActiveUser"),children:"active"===(null===s||void 0===s?void 0:s.status)?i("button.Yes"):i("button.No")}),(0,K.jsx)(_.A.Item,{label:i("credential.DescRequirePasswordChange"),children:null!==s&&void 0!==s&&s.need_password_change?i("button.Yes"):i("button.No")}),(0,K.jsx)(_.A.Item,{label:i("credential.EnableSudoSession"),children:null!==s&&void 0!==s&&s.sudo_session_enabled?i("button.Yes"):i("button.No")}),r&&(0,K.jsx)(_.A.Item,{label:i("webui.menu.TotpActivated"),children:(0,K.jsx)(ye.A,{spinning:t,children:null!==s&&void 0!==s&&s.totp_activated?i("button.Yes"):i("button.No")})})]}),(0,K.jsx)("br",{}),(0,K.jsxs)(_.A,{size:"small",column:o,title:i("credential.Association"),labelStyle:{width:"50%"},children:[(0,K.jsx)(_.A.Item,{label:i("credential.Role"),children:null===s||void 0===s?void 0:s.role}),(0,K.jsx)(_.A.Item,{label:i("credential.Domain"),children:null===s||void 0===s?void 0:s.domain_name}),(0,K.jsx)(_.A.Item,{label:i("credential.ResourcePolicy"),children:null===s||void 0===s?void 0:s.resource_policy})]}),(0,K.jsx)("br",{}),(0,K.jsx)(_.A,{title:i("credential.ProjectAndGroup"),labelStyle:{width:"50%"},children:(0,K.jsx)(_.A.Item,{children:$().map(null===s||void 0===s?void 0:s.groups,(e=>(0,K.jsx)(v.A,{children:null===e||void 0===e?void 0:e.name},null===e||void 0===e?void 0:e.id)))})})]})},fe=function(){var e={defaultValue:null,kind:"LocalArgument",name:"email"},a={defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},l={defaultValue:null,kind:"LocalArgument",name:"props"},n=[{kind:"Variable",name:"email",variableName:"email"},{kind:"Variable",name:"props",variableName:"props"}],i={alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},y={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:[e,a,l],kind:"Fragment",metadata:null,name:"UserSettingModalCreateMutation",selections:[{alias:null,args:n,concreteType:"CreateUser",kind:"LinkedField",name:"create_user",plural:!1,selections:[i,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,s,o,d,u,c,m,g,p,y,k,f,v,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,l,a],kind:"Operation",name:"UserSettingModalCreateMutation",selections:[{alias:null,args:n,concreteType:"CreateUser",kind:"LinkedField",name:"create_user",plural:!1,selections:[i,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,s,o,d,u,c,m,g,p,y,k,f,v],storageKey:null}],storageKey:null}]},params:{cacheID:"d46028cf24e7cb741e7a985d1c91b9f0",id:null,metadata:{},name:"UserSettingModalCreateMutation",operationKind:"mutation",text:"mutation UserSettingModalCreateMutation(\n  $email: String!\n  $props: UserInput!\n  $isNotSupportTotp: Boolean!\n) {\n  create_user(email: $email, props: $props) {\n    ok\n    msg\n    user {\n      id\n      email\n      username\n      need_password_change\n      full_name\n      description\n      status\n      domain_name\n      role\n      groups {\n        id\n        name\n      }\n      resource_policy\n      sudo_session_enabled\n      totp_activated @skipOnClient(if: $isNotSupportTotp)\n      ...TOTPActivateModalFragment\n    }\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();fe.hash="ad0ad263f7dcce6cc8744e0c1fff743e";const ve=fe,_e=function(){var e={defaultValue:null,kind:"LocalArgument",name:"email"},a={defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},l={defaultValue:null,kind:"LocalArgument",name:"props"},n=[{kind:"Variable",name:"email",variableName:"email"},{kind:"Variable",name:"props",variableName:"props"}],i={alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},y={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:[e,a,l],kind:"Fragment",metadata:null,name:"UserSettingModalModifyMutation",selections:[{alias:null,args:n,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[i,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,s,o,d,u,c,m,g,p,y,k,f,v,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,l,a],kind:"Operation",name:"UserSettingModalModifyMutation",selections:[{alias:null,args:n,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[i,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,s,o,d,u,c,m,g,p,y,k,f,v],storageKey:null}],storageKey:null}]},params:{cacheID:"14dcf19b4b0d91d9b2e198e9be83cbb5",id:null,metadata:{},name:"UserSettingModalModifyMutation",operationKind:"mutation",text:"mutation UserSettingModalModifyMutation(\n  $email: String!\n  $props: ModifyUserInput!\n  $isNotSupportTotp: Boolean!\n) {\n  modify_user(email: $email, props: $props) {\n    ok\n    msg\n    user {\n      id\n      email\n      username\n      need_password_change\n      full_name\n      description\n      status\n      domain_name\n      role\n      groups {\n        id\n        name\n      }\n      resource_policy\n      sudo_session_enabled\n      totp_activated @skipOnClient(if: $isNotSupportTotp)\n      ...TOTPActivateModalFragment\n    }\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();_e.hash="3317b5381a04d0c696b6ff62d41fd6b8";const be=_e,Se=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"}],a=[{kind:"Variable",name:"email",variableName:"email"}],l={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},c={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[u,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserSettingModalQuery",selections:[{alias:null,args:a,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,n,i,r,t,s,o,d,c,m,g,p,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserSettingModalQuery",selections:[{alias:null,args:a,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,n,i,r,t,s,o,d,c,m,g,p,u],storageKey:null}]},params:{cacheID:"e6452192bb065c337444741a1c87279b",id:null,metadata:{},name:"UserSettingModalQuery",operationKind:"query",text:"query UserSettingModalQuery(\n  $email: String\n  $isNotSupportTotp: Boolean!\n) {\n  user(email: $email) {\n    email\n    username\n    need_password_change\n    full_name\n    description\n    status\n    domain_name\n    role\n    groups {\n      id\n      name\n    }\n    resource_policy\n    sudo_session_enabled\n    totp_activated @skipOnClient(if: $isNotSupportTotp)\n    ...TOTPActivateModalFragment\n    id\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();Se.hash="f43b0cf0bdc3c674b57f8caa67093067";const xe=Se;var he=l(28380),Ae=l(4202);const Ke=function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"max_vfolder_count",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"max_session_count_per_model_session",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"max_quota_scope_size",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"max_customized_image_count",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UserResourcePolicySelectorQuery",selections:[{alias:null,args:null,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policies",plural:!0,selections:[e,a,l,n,i,r,t,{args:null,kind:"FragmentSpread",name:"UserResourcePolicySettingModalFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"UserResourcePolicySelectorQuery",selections:[{alias:null,args:null,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policies",plural:!0,selections:[e,a,l,n,i,r,t],storageKey:null}]},params:{cacheID:"5c0bb0244594feb3fc33aadcac7ffb2f",id:null,metadata:{},name:"UserResourcePolicySelectorQuery",operationKind:"query",text:'query UserResourcePolicySelectorQuery {\n  user_resource_policies {\n    id\n    name\n    created_at\n    max_vfolder_count @since(version: "23.09.6")\n    max_session_count_per_model_session @since(version: "23.09.10")\n    max_quota_scope_size @since(version: "23.09.2")\n    max_customized_image_count @since(version: "24.03.0")\n    ...UserResourcePolicySettingModalFragment\n  }\n}\n\nfragment UserResourcePolicySettingModalFragment on UserResourcePolicy {\n  id\n  name\n  max_vfolder_count @since(version: "23.09.6")\n  max_session_count_per_model_session @since(version: "23.09.10")\n  max_quota_scope_size @since(version: "23.09.2")\n  max_customized_image_count @since(version: "24.03.0")\n}\n'}}}();Ke.hash="df2a28e16edd8e8b4791053a89f9917f";const Fe=Ke,je=e=>{let{...a}=e;const{t:l}=(0,V.Bd)(),{user_resource_policies:n}=(0,A.useLazyLoadQuery)(Fe,{},{fetchPolicy:"store-and-network"});return(0,K.jsx)(w.A,{showSearch:!0,placeholder:l("credential.SelectPolicy"),options:$().map(n,(e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name}))).sort(((e,a)=>(0,D._f)(null===e||void 0===e?void 0:e.label,null===a||void 0===a?void 0:a.label))),...a})};var Me=l(86829),Te=l(60854),Le=l(83143),Ie=l(50069);const Pe={superadmin:["superadmin","user"],admin:["user"]},Ce=e=>{let{userEmail:a=null,onRequestClose:l,...n}=e;const{t:i}=(0,V.Bd)(),{token:r}=k.A.useToken(),{modal:t}=q.A.useApp(),s=(0,Y.useRef)(null),o=(0,pe.Am)(),u=(0,d.eZ)(),c=(0,d.CX)(),{isTOTPSupported:m,isLoading:g}=(0,pe.F4)(),[p,{toggle:y}]=(0,Te.A)(!1),[v,_]=(0,d.Tw)("initial-fetch"),S=(0,Y.useDeferredValue)(n.open),{user:x}=(0,A.useLazyLoadQuery)(xe,{email:null!==a&&void 0!==a?a:"",isNotSupportTotp:!m},{fetchPolicy:S&&a?"network-only":"store-only",fetchKey:v}),[h,F]=(0,A.useMutation)(be),[j,M]=(0,A.useMutation)(ve),T=(0,he.ET)({mutationFn:e=>c.remove_totp(e)}),L={email:"",username:"",need_password_change:!1,full_name:"",description:"",status:"active",domain_name:u,role:"user",is_active:!0,resource_policy:"default"};return(0,K.jsxs)(b.Ib,{centered:!0,title:i(x?"credential.ModifyUserDetail":"credential.CreateUser"),destroyOnHidden:!0,onOk:()=>{var e;null===(e=s.current)||void 0===e||e.validateFields().then((async e=>{if(x){const a=$().omitBy($().omit(e,["email","password_confirm"]),$().isNil);h({variables:{email:(null===e||void 0===e?void 0:e.email)||"",props:a,isNotSupportTotp:!m},onCompleted:(e,a)=>{var n,r;if(null===e||void 0===e||null===(n=e.modify_user)||void 0===n||!n.ok)return Le.Ay.error(i("dialog.ErrorOccurred")),console.error(null===e||void 0===e||null===(r=e.modify_user)||void 0===r?void 0:r.msg),void l(!1);if(a&&a.length>0){const e=$().map(a,(e=>e.message));for(const a of e)Le.Ay.error(a);l(!1)}Le.Ay.success(i("environment.SuccessfullyModified")),l(!0)},onError:e=>{Le.Ay.error(i("dialog.ErrorOccurred")),console.error(e)}})}else{const a=[await c.group.list().then((e=>{var a;return null===(a=$().find(e.groups,{name:"default"}))||void 0===a?void 0:a.id}))],n={...$().omit(e,["email","password_confirm"]),password:e.password,need_password_change:e.need_password_change,username:(null===e||void 0===e?void 0:e.username)||$().split(e.email,"@")[0],full_name:(null===e||void 0===e?void 0:e.full_name)||$().split(e.email,"@")[0],description:(null===e||void 0===e?void 0:e.description)||`${$().split(e.email,"@")[0]}'s Account`,group_ids:a};j({variables:{email:(null===e||void 0===e?void 0:e.email)||"",props:n,isNotSupportTotp:!m},onCompleted:(e,a)=>{var n,r,t,s;if(null===e||void 0===e||null===(n=e.create_user)||void 0===n||!n.ok)return Le.Ay.error(null!==(r=e.create_user)&&void 0!==r&&null!==(t=r.msg)&&void 0!==t&&t.includes("already exists")?i("credential.UserAccountCreatedError"):i("dialog.ErrorOccurred")),console.error(null===e||void 0===e||null===(s=e.create_user)||void 0===s?void 0:s.msg),void l(!1);if(a&&a.length>0){const e=$().map(a,(e=>e.message));for(const a of e)Le.Ay.error(a);l(!1)}Le.Ay.success(i("environment.SuccessfullyCreated")),l(!0)},onError:e=>{Le.Ay.error(i("dialog.ErrorOccurred")),console.error(e)}})}})).catch((e=>console.error(e)))},confirmLoading:F||M,onCancel:()=>l(!1),loading:S!==n.open,...n,children:[(0,K.jsxs)(Q.A,{ref:s,preserve:!1,validateTrigger:["onChange","onBlur"],initialValues:x?{...x}:L,layout:"vertical",children:[(0,K.jsx)(Q.A.Item,{name:"email",label:i("credential.UserID"),rules:[{required:!x},{type:"email"}],children:(0,K.jsx)(z.A,{disabled:!!x})}),(0,K.jsx)(Q.A.Item,{name:"username",label:i("credential.UserName"),rules:[{max:64}],children:(0,K.jsx)(z.A,{placeholder:i("maxLength.64chars")})}),(0,K.jsx)(Q.A.Item,{name:"full_name",label:i("credential.FullName"),rules:[{max:64}],children:(0,K.jsx)(z.A,{placeholder:i("maxLength.64chars")})}),(0,K.jsx)(Q.A.Item,{name:"password",label:i(x?"general.NewPassword":"general.Password"),rules:[{required:!x},{pattern:/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,message:i("webui.menu.InvalidPasswordMessage")}],children:(0,K.jsx)(z.A.Password,{})}),(0,K.jsx)(Q.A.Item,{name:"password_confirm",dependencies:["password"],label:i(x?"webui.menu.NewPasswordAgain":"general.ConfirmPassword"),rules:[{required:!x,message:""},e=>{let{getFieldValue:a}=e;return{validator:(e,l)=>!l&&a("password")?Promise.reject(new Error(i("webui.menu.PleaseConfirmYourPassword"))):l&&a("password")!==l?Promise.reject(new Error(i("environment.PasswordsDoNotMatch"))):Promise.resolve()}}],children:(0,K.jsx)(z.A.Password,{})}),(0,K.jsx)(Q.A.Item,{name:"description",label:i("credential.Description"),rules:[{max:500}],children:(0,K.jsx)(z.A.TextArea,{placeholder:i("maxLength.500chars")})}),(0,K.jsx)(Q.A.Item,{name:"status",label:i("credential.UserStatus"),children:(0,K.jsx)(w.A,{options:[{value:"active",label:i("general.Active")},{value:"inactive",label:i("general.Inactive")},{value:"before-verification",label:i("credential.BeforeVerification")},{value:"deleted",label:i("credential.Deleted")}]})}),!!o&&o in Pe&&(0,K.jsx)(Q.A.Item,{name:"role",label:i("credential.Role"),children:(0,K.jsx)(w.A,{options:$().map(Pe[o],(e=>({value:e,label:e})))})}),(0,K.jsx)(Q.A.Item,{name:"need_password_change",label:i("credential.DescRequirePasswordChange"),valuePropName:"checked",children:(0,K.jsx)(Ie.A,{})}),(0,K.jsx)(Q.A.Item,{name:"sudo_session_enabled",label:i("credential.EnableSudoSession"),valuePropName:"checked",children:(0,K.jsx)(Ie.A,{})}),!!m&&(0,K.jsx)(Q.A.Item,{name:"totp_activated",label:i("webui.menu.TotpActivated"),valuePropName:"checked",extra:(null===x||void 0===x?void 0:x.email)!==(null===c||void 0===c?void 0:c.email)&&(0,K.jsx)(f.A.Text,{type:"secondary",style:{fontSize:r.fontSizeSM},children:i("credential.AdminCanOnlyRemoveTotp")}),children:(0,K.jsx)(Ie.A,{loading:g||T.isPending,disabled:(null===x||void 0===x?void 0:x.email)!==(null===c||void 0===c?void 0:c.email)&&!(null!==x&&void 0!==x&&x.totp_activated),onChange:e=>{var a;e?y():null!==x&&void 0!==x&&x.totp_activated&&(null===(a=s.current)||void 0===a||a.setFieldValue("totp_activated",!0),t.confirm({title:i("totp.TurnOffTotp"),icon:(0,K.jsx)(Me.A,{}),content:i("totp.ConfirmTotpRemovalBody"),okText:i("button.Yes"),okType:"danger",cancelText:i("button.No"),onOk(){T.mutate((null===x||void 0===x?void 0:x.email)||"",{onSuccess:()=>{var e;Le.Ay.success(i("totp.RemoveTotpSetupCompleted")),_(),null===(e=s.current)||void 0===e||e.setFieldValue("totp_activated",!1)},onError:e=>{console.log(e)}})},onCancel(){var e;null===(e=s.current)||void 0===e||e.setFieldValue("totp_activated",!0)}}))}})}),(0,K.jsx)(Q.A.Item,{name:"resource_policy",label:i("resourcePolicy.ResourcePolicy"),rules:[{required:!x}],children:(0,K.jsx)(je,{})})]}),!!m&&(0,K.jsx)(Ae.A,{userFrgmt:x,open:p,onRequestClose:e=>{var a;e?_():null===(a=s.current)||void 0===a||a.setFieldValue("totp_activated",!1);y()}})]})},Ue=()=>{const{t:e}=(0,V.Bd)(),{token:a}=k.A.useToken(),[l,n]=(0,d.zu)(),[i,r]=(0,te.useQueryParams)({filter:(0,te.withDefault)(te.StringParam,void 0),order:(0,te.withDefault)(te.StringParam,"-created_at"),status:(0,te.withDefault)(te.StringParam,"active")}),{message:t}=q.A.useApp(),[s,o]=(0,Y.useState)(null),[m,g]=(0,Y.useTransition)(),[p,y]=(0,Y.useTransition)(),[f,v]=(0,Y.useState)(null),[_,S]=(0,Y.useState)(!1),{baiPaginationOption:h,tablePaginationOption:F,setTablePaginationOption:j}=(0,u.L0)({current:1,pageSize:10}),[M,T]=(0,Y.useState)(),L=(0,Y.useMemo)((()=>{const e="active"===i.status?'status == "active"':'status != "active"';return{first:h.limit,offset:h.offset,filter:(0,b.r2)([i.filter,e]),order:i.order}}),[h.limit,h.offset,i.filter,i.status,i.order]),I=(0,Y.useDeferredValue)(L),P=(0,Y.useDeferredValue)(l),{user_nodes:C}=(0,A.useLazyLoadQuery)(ce,I,{fetchKey:P,fetchPolicy:P===d.eI?"store-and-network":"network-only"}),[U,D]=(0,A.useMutation)(de);return(0,K.jsxs)(b.OO,{direction:"column",align:"stretch",gap:"sm",children:[(0,K.jsxs)(b.OO,{justify:"between",align:"start",gap:"xs",wrap:"wrap",children:[(0,K.jsxs)(b.OO,{direction:"row",gap:"sm",align:"start",wrap:"wrap",children:[(0,K.jsx)(c.A,{value:i.status,onChange:e=>{r({status:e.target.value},"replaceIn"),j({current:1})},optionType:"button",options:[{label:e("general.Active"),value:"active"},{label:e("general.Inactive"),value:"inactive"}]}),(0,K.jsx)(b.Af,{filterProperties:[{key:"email",propertyLabel:e("credential.UserID"),type:"string"},{key:"username",propertyLabel:e("credential.Name"),type:"string"},{key:"role",propertyLabel:e("credential.Role"),type:"string",strictSelection:!0,defaultOperator:"==",options:[{label:"superadmin",value:"superadmin"},{label:"user",value:"user"}]},{key:"description",propertyLabel:e("credential.Description"),type:"string"}],value:i.filter,onChange:e=>{r({filter:e},"replaceIn")}})]}),(0,K.jsxs)(b.OO,{gap:"xs",children:[(0,K.jsx)(ee.A,{title:e("button.Refresh"),children:(0,K.jsx)(ae.Ay,{loading:P!==l,onClick:()=>{n()},icon:(0,K.jsx)(Z.A,{})})}),(0,K.jsx)(ae.Ay,{type:"primary",icon:(0,K.jsx)(ne.A,{}),onClick:()=>{S(!0)},children:e("credential.CreateUser")})]})]}),(0,K.jsx)(b.zx,{scroll:{x:"max-content"},rowKey:"id",dataSource:(0,b.f)($().map(null===C||void 0===C?void 0:C.edges,"node")),columns:(0,b.YM)([{key:"email",title:e("credential.UserID"),dataIndex:"email",sorter:!0},{key:"username",title:e("credential.Name"),dataIndex:"username",sorter:!0},{key:"role",title:e("credential.Role"),dataIndex:"role",sorter:!0},{key:"description",title:e("credential.Description"),dataIndex:"description"},{title:e("credential.CreatedAt"),dataIndex:"created_at",render:e=>x()(e).format("lll"),sorter:!0,defaultSortOrder:"descend"},"active"!==i.status&&{key:"status",title:e("credential.Status"),dataIndex:"status",sorter:!0},{title:e("general.Control"),render:l=>{const i="active"===(null===l||void 0===l?void 0:l.status);return(0,K.jsxs)(b.OO,{gap:a.marginXS,children:[(0,K.jsx)(ae.Ay,{type:"text",icon:(0,K.jsx)(H.A,{style:{color:a.colorSuccess}}),onClick:()=>{g((()=>{o((null===l||void 0===l?void 0:l.email)||null)}))}}),(0,K.jsx)(ae.Ay,{type:"text",icon:(0,K.jsx)(W.A,{style:{color:a.colorInfo}}),onClick:()=>{y((()=>{v((null===l||void 0===l?void 0:l.email)||null)}))}}),(0,K.jsx)(ee.A,{title:e(i?"credential.Deactivate":"credential.Activate"),children:(0,K.jsx)(le.A,{title:e(i?"credential.DeactivateUser":"credential.ActivateUser"),placement:"left",okType:i?"danger":"primary",okText:e(i?"credential.Deactivate":"credential.Activate"),description:null===l||void 0===l?void 0:l.email,onConfirm:()=>{T((null===l||void 0===l?void 0:l.id)||""),U({variables:{email:(null===l||void 0===l?void 0:l.email)||"",props:{status:i?"inactive":"active"}},onCompleted:()=>{t.success(e("credential.StatusUpdatedSuccessfully")),n()},onError:e=>{t.error(null===e||void 0===e?void 0:e.message),console.error(e)}})},children:(0,K.jsx)(ae.Ay,{type:"text",danger:i,icon:i?(0,K.jsx)(re.A,{}):(0,K.jsx)(ie.A,{}),disabled:D&&M!==(null===l||void 0===l?void 0:l.id),loading:D&&M===(null===l||void 0===l?void 0:l.id)})})})]})}}]),pagination:{pageSize:F.pageSize,total:(null===C||void 0===C?void 0:C.count)||0,current:F.current,style:{marginRight:a.marginXS},onChange:(e,a)=>{$().isNumber(e)&&$().isNumber(a)&&j({current:e,pageSize:a})}},onChangeOrder:e=>{r({order:e},"replaceIn")},loading:I!==L||P!==l}),(0,K.jsx)(ke,{userEmail:s||"",open:!!s||m,loading:m,onRequestClose:()=>{o(null)}}),(0,K.jsx)(Ce,{userEmail:f,open:!!f||p||_,loading:p,onRequestClose:e=>{v(null),S(!1),e&&n()}})]})};var De=l(78890),Oe=l(81658),we=l(46746),Ne=l(75182);const $e=()=>{const{t:e}=(0,V.Bd)(),[a]=(0,Oe.ok)(),l=a.get("tab")||"users",n=(0,we.Zp)(),i=[{key:"users",label:e("credential.Users")},{key:"credentials",label:e("credential.Credentials")}];return(0,K.jsx)(b.Zu,{activeTabKey:l,onTabChange:e=>n({pathname:"/credential",search:`?tab=${e}`}),tabList:i,children:(0,K.jsxs)(Y.Suspense,{fallback:(0,K.jsx)(De.A,{active:!0}),children:["users"===l&&(0,K.jsx)(Ne.A,{children:(0,K.jsx)(b.OO,{direction:"column",align:"stretch",children:(0,K.jsx)(Ue,{})})}),"credentials"===l&&(0,K.jsx)(Ne.A,{children:(0,K.jsx)(b.OO,{direction:"column",align:"stretch",children:(0,K.jsx)(se,{})})})]})})}},7326:(e,a,l)=>{l.d(a,{A:()=>n});const n=(0,l(64579).A)("ban",[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},25133:(e,a,l)=>{l.d(a,{A:()=>n});const n=(0,l(64579).A)("undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]])}}]);
//# sourceMappingURL=3775.bf6c0061.chunk.js.map