"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[944],{23623:(e,n,l)=>{l.d(n,{A:()=>a});var t=l(76998);const i=(e,n,l)=>{const[i,a]=(0,t.useState)(e());return(0,t.useEffect)((()=>{l&&a(e())}),[l]),function(e,n){const l=(0,t.useRef)();(0,t.useEffect)((()=>{l.current=e})),(0,t.useEffect)((()=>{if(null!==n){let e=setInterval((function(){var e;null===(e=l.current)||void 0===e||e.call(l)}),n);return()=>clearInterval(e)}}),[n])}((()=>{const n=e();n!==i&&a(n)}),n),i},a=e=>{let{callback:n,delay:l,triggerKey:t}=e;return i(n,l,t)}},7075:(e,n,l)=>{l.d(n,{A:()=>u});var t=l(29871),i=l(50840),a=l(24128),r=l(45901),o=l.n(r),s=(l(76998),l(23446));const u=e=>{let{title:n,valueLabel:l,percent:r=0,width:u,strokeColor:c,labelStyle:d,size:g="small"}=e;const{token:p}=i.A.useToken(),m="small"===g?p.fontSizeSM:"middle"===g?p.fontSize:p.fontSizeLG;return(0,s.jsxs)(t.A,{style:{padding:1,border:"1px solid ".concat(p.colorBorder),borderRadius:3,backgroundColor:p.colorBgContainerDisabled,...o().isNumber(u)||o().isString(u)?{width:u}:{flex:1}},direction:"column",align:"stretch",children:[(0,s.jsx)(t.A,{style:{height:"100%",width:"".concat(r,"%"),position:"absolute",left:0,top:0,backgroundColor:null!==c&&void 0!==c?c:p.colorSuccess,opacity:.7,zIndex:0,overflow:"hidden"}}),(0,s.jsxs)(t.A,{direction:"row",justify:"between",children:[(0,s.jsx)(a.A.Text,{style:{fontSize:m,...d},children:n}),(0,s.jsx)(a.A.Text,{style:{fontSize:m,...d},children:l})]})]})}},5621:(e,n,l)=>{l.d(n,{A:()=>u});var t=l(29871),i=l(48713),a=l(45901),r=l.n(a),o=l(76998),s=l(23446);const u=e=>{let n,{values:l=[]}=e;return 0===l.length?null:(n=l[0]&&("string"===typeof l[0]||o.isValidElement(l[0]))?l.map((e=>({label:e,color:"blue"}))):l,(0,s.jsx)(t.A,{direction:"row",children:r().map(n,((e,l)=>(0,s.jsx)(i.A,{style:r().last(n)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:e.label},l)))}))}},34680:(e,n,l)=>{l.d(n,{A:()=>m});var t=l(25339),i=l(62863),a=l(50840),r=l(65080),o=l(36209),s=l(87627),u=l(45901),c=l.n(u),d=l(76998),g=l(77678),p=l(23446);const m=e=>{let{open:n,onRequestClose:l,columns:u,displayedColumnKeys:m,...v}=e;const y=(0,d.useRef)(null),{t:x}=(0,g.Bd)(),{token:h}=a.A.useToken(),f=u.map((e=>{return"string"===typeof e.title?{label:e.title,value:c().toString(e.key)}:"object"===typeof e.title&&"props"in e.title?{label:(n=e.title,d.Children.map(n.props.children,(e=>{if("string"===typeof e)return e}))),value:c().toString(e.key)}:{label:void 0,value:c().toString(e.key)};var n}));return(0,p.jsx)(t.A,{title:x("table.SettingTable"),open:n,destroyOnClose:!0,centered:!0,onOk:()=>{var e;null===(e=y.current)||void 0===e||e.validateFields().then((e=>{l(e)})).catch((()=>{}))},onCancel:()=>{l()},...v,children:(0,p.jsxs)(r.A,{ref:y,preserve:!1,initialValues:{selectedColumnKeys:m||f.map((e=>e.value))},layout:"vertical",children:[(0,p.jsx)(r.A.Item,{name:"searchInput",label:x("table.SelectColumnToDisplay"),style:{marginBottom:0},children:(0,p.jsx)(o.A,{prefix:(0,p.jsx)(i.A,{}),style:{marginBottom:h.marginSM},placeholder:x("table.SearchTableColumn")})}),(0,p.jsx)(r.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.searchInput!==n.searchInput,children:e=>{let{getFieldValue:n}=e;const l=n("searchInput")?c().toLower(n("searchInput")):void 0,t=f.map((e=>c().toLower(c().toString(e.label)).includes(l||"")?e:{...e,style:{display:"none"}}));return(0,p.jsx)(r.A.Item,{name:"selectedColumnKeys",style:{height:220,overflowY:"auto"},children:(0,p.jsx)(s.A.Group,{options:t,style:{flexDirection:"column"}})})}})]})})}},53234:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"AgentDetailModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"live_stat",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"available_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cpu_cur_pct",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mem_cur_bytes",storageKey:null}],type:"Agent",abstractKey:null,hash:"cb343a0290034803cca4c2b82a1c1b68"},i=t},80508:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const t=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"limit"},l={defaultValue:null,kind:"LocalArgument",name:"offset"},t={defaultValue:null,kind:"LocalArgument",name:"order"},i={defaultValue:null,kind:"LocalArgument",name:"status"},a=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"order",variableName:"order"},{kind:"Variable",name:"status",variableName:"status"}],r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"version",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"addr",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"region",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"compute_plugins",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"first_contact",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"lost_at",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"status_changed",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"live_stat",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"cpu_cur_pct",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"mem_cur_bytes",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"available_slots",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},A={alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"schedulable",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null};return{fragment:{argumentDefinitions:[e,n,l,t,i],kind:"Fragment",metadata:null,name:"AgentListQuery",selections:[{alias:null,args:a,concreteType:"AgentList",kind:"LinkedField",name:"agent_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Agent",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,s,u,c,d,g,p,m,v,y,x,h,f,b,A,k,{args:null,kind:"FragmentSpread",name:"AgentDetailModalFragment"},{args:null,kind:"FragmentSpread",name:"AgentSettingModalFragment"}],storageKey:null},j],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,l,e,i,t],kind:"Operation",name:"AgentListQuery",selections:[{alias:null,args:a,concreteType:"AgentList",kind:"LinkedField",name:"agent_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Agent",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,s,u,c,d,g,p,m,v,y,x,h,f,b,A,k],storageKey:null},j],storageKey:null}]},params:{cacheID:"e1a551c0261ce59a4b187a3bbb29b86b",id:null,metadata:{},name:"AgentListQuery",operationKind:"query",text:"query AgentListQuery(\n  $limit: Int!\n  $offset: Int!\n  $filter: String\n  $status: String\n  $order: String\n) {\n  agent_list(limit: $limit, offset: $offset, filter: $filter, status: $status, order: $order) {\n    items {\n      id\n      status\n      version\n      addr\n      architecture\n      region\n      compute_plugins\n      first_contact\n      lost_at\n      status_changed\n      live_stat\n      cpu_cur_pct\n      mem_cur_bytes\n      available_slots\n      occupied_slots\n      scaling_group\n      schedulable\n      ...AgentDetailModalFragment\n      ...AgentSettingModalFragment\n    }\n    total_count\n  }\n}\n\nfragment AgentDetailModalFragment on Agent {\n  id\n  live_stat\n  available_slots\n  occupied_slots\n  cpu_cur_pct\n  mem_cur_bytes\n}\n\nfragment AgentSettingModalFragment on Agent {\n  id\n  schedulable\n}\n"}}}();t.hash="1d6c6a390aad71e4b7815a623ca61d86";const i=t},81157:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"AgentSettingModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"schedulable",storageKey:null}],type:"Agent",abstractKey:null,hash:"303f8ee06508c3b28511ab1a24a305d5"},i=t},69130:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"},{defaultValue:null,kind:"LocalArgument",name:"props"}],n=[{alias:null,args:[{kind:"Variable",name:"id",variableName:"id"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"ModifyAgent",kind:"LinkedField",name:"modify_agent",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"AgentSettingModalMutation",selections:n,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"AgentSettingModalMutation",selections:n},params:{cacheID:"1a9e43d4bc6e78f3949d1a2a397ff00e",id:null,metadata:{},name:"AgentSettingModalMutation",operationKind:"mutation",text:"mutation AgentSettingModalMutation(\n  $id: String!\n  $props: ModifyAgentInput!\n) {\n  modify_agent(id: $id, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();t.hash="13b2a6a91c7f08bbced5fde155ded60e";const i=t},43944:(e,n,l)=>{l.r(n),l.d(n,{default:()=>ae});var t=l(30032),i=l(83468),a=l(16162),r=l(45901),o=l.n(r),s=l(76998),u=l(3606),c=l(58346);var d,g=l(90660),p=l(25339),m=l(7075),v=l(29871),y=l(50840),x=l(7518),h=l(9788),f=l(24128),b=l(77678),A=l(23446);const k=e=>{var n,i,r,s,c,g,k,j,S,_,F,C,w,T,L,K,z;let{agentDetailModalFrgmt:I=null,onRequestClose:M,...D}=e;const{t:R}=(0,b.Bd)(),{token:E}=y.A.useToken(),[V]=(0,a.Hv)(),N=(0,u.useFragment)(void 0!==d?d:d=l(53234),I),O=JSON.parse((null===N||void 0===N?void 0:N.live_stat)||"{}"),B=JSON.parse((null===N||void 0===N?void 0:N.available_slots)||"{}");return(0,A.jsx)(p.A,{...D,styles:{body:{padding:0}},centered:!0,title:"".concat(R("agent.DetailedInformation"),": ").concat(null===N||void 0===N?void 0:N.id),onCancel:M,destroyOnClose:!0,footer:null,children:(0,A.jsxs)(v.A,{direction:"column",align:"stretch",gap:"md",children:[(0,A.jsxs)(x.A,{gutter:[24,24],children:[(0,A.jsx)(h.A,{xs:24,sm:12,children:null!==O&&void 0!==O&&null!==(n=O.devices)&&void 0!==n&&n.cpu_util?(0,A.jsxs)(v.A,{direction:"column",gap:"xxs",align:"stretch",children:[(0,A.jsx)(f.A.Title,{level:5,style:{marginTop:0},children:null===V||void 0===V||null===(i=V.cpu)||void 0===i?void 0:i.human_readable_name}),o().map(null===O||void 0===O||null===(r=O.devices)||void 0===r?void 0:r.cpu_util,((e,n)=>{var l;return(0,A.jsxs)(v.A,{justify:"between",children:[(0,A.jsxs)(f.A.Text,{type:"secondary",style:{flex:.5},children:[null===V||void 0===V||null===(l=V.cpu)||void 0===l?void 0:l.human_readable_name,n]},n),(0,A.jsx)(m.A,{percent:null===e||void 0===e?void 0:e.pct,valueLabel:(null===e||void 0===e?void 0:e.pct)+"%"})]})}))]}):null}),(0,A.jsxs)(h.A,{xs:24,sm:12,children:[null!==B&&void 0!==B&&B.mem?(0,A.jsxs)(v.A,{direction:"column",gap:"xxs",align:"stretch",children:[(0,A.jsx)(f.A.Title,{level:5,style:{marginTop:0},children:null===V||void 0===V||null===(s=V.mem)||void 0===s?void 0:s.human_readable_name}),(0,A.jsx)(m.A,{percent:null!==(c=(null!==(g=null===(k=(0,t.Js)(o().toString(null===N||void 0===N?void 0:N.mem_cur_bytes),"g"))||void 0===k?void 0:k.number)&&void 0!==g?g:0)/(null!==(j=null===(S=(0,t.Js)(null===B||void 0===B?void 0:B.mem,"g"))||void 0===S?void 0:S.number)&&void 0!==j?j:0)*100)&&void 0!==c?c:0,valueLabel:"".concat(null===(_=(0,t.Js)(o().toString(null===N||void 0===N?void 0:N.mem_cur_bytes),"g"))||void 0===_?void 0:_.numberUnit,"iB / ").concat(null===(F=(0,t.Js)(null===B||void 0===B?void 0:B.mem,"g"))||void 0===F?void 0:F.numberUnit,"iB")})]}):null,null!==O&&void 0!==O&&O.node?(0,A.jsxs)(v.A,{direction:"column",gap:"xxs",align:"start",children:[(0,A.jsx)(f.A.Title,{level:5,style:{marginTop:0},children:R("session.launcher.Network")}),(0,A.jsxs)(v.A,{gap:"xl",children:[(0,A.jsx)(f.A.Text,{children:"TX:"}),(0,A.jsxs)(f.A.Text,{children:[null===(C=(0,t.Js)(null===O||void 0===O||null===(w=O.node)||void 0===w||null===(T=w.net_tx)||void 0===T?void 0:T.current,"m",1))||void 0===C?void 0:C.numberUnit,"iB"]})]}),(0,A.jsxs)(v.A,{gap:"xl",children:[(0,A.jsx)(f.A.Text,{children:"RX:"}),(0,A.jsxs)(f.A.Text,{children:[null===(L=(0,t.Js)(null===O||void 0===O||null===(K=O.node)||void 0===K||null===(z=K.net_rx)||void 0===z?void 0:z.current,"m",1))||void 0===L?void 0:L.numberUnit,"iB"]})]})]}):null]})]}),(0,A.jsx)(x.A,{gutter:[24,24],style:{marginBottom:E.marginSM},children:o().map(o().keys(null===O||void 0===O?void 0:O.devices),(e=>{if(["cpu_util","mem","disk","net_rx","net_tx"].includes(e))return null;if(o().includes(e,"_util")){var n;const l=o().split(e,"_")[0]+".device";return(0,A.jsx)(h.A,{xs:24,sm:12,children:(0,A.jsxs)(v.A,{direction:"column",gap:"xxs",align:"stretch",children:[(0,A.jsxs)(f.A.Title,{level:5,style:{marginTop:0},children:[null===V||void 0===V||null===(n=V[l])||void 0===n?void 0:n.human_readable_name," ",R("session.Utilization")]}),o().map(o().toPairs(null===O||void 0===O?void 0:O.devices[e]),((e,n)=>{var t,i,a;return(0,A.jsxs)(v.A,{justify:"between",children:[(0,A.jsxs)(f.A.Text,{type:"secondary",style:{flex:.5},children:[null===V||void 0===V||null===(t=V[l])||void 0===t?void 0:t.human_readable_name,n]},n),(0,A.jsx)(m.A,{percent:o().toFinite(null===e||void 0===e||null===(i=e[1])||void 0===i?void 0:i.pct),valueLabel:(null===e||void 0===e||null===(a=e[1])||void 0===a?void 0:a.pct)+"%"})]})}))]})})}if(o().includes(e,"_mem")){var l;const n=o().split(e,"_")[0]+".device";return(0,A.jsx)(h.A,{xs:24,sm:12,children:(0,A.jsxs)(v.A,{direction:"column",gap:"xxs",align:"stretch",children:[(0,A.jsxs)(f.A.Title,{level:5,style:{marginTop:0},children:[null===V||void 0===V||null===(l=V[n])||void 0===l?void 0:l.human_readable_name," ",R("session.launcher.Memory")]}),o().map(o().toPairs(null===O||void 0===O?void 0:O.devices[e]),((e,l)=>{var t,i,a;return(0,A.jsxs)(v.A,{justify:"between",children:[(0,A.jsxs)(f.A.Text,{type:"secondary",style:{flex:.5},children:[null===V||void 0===V||null===(t=V[n])||void 0===t?void 0:t.human_readable_name,l]},l),(0,A.jsx)(m.A,{percent:o().toFinite(null===e||void 0===e||null===(i=e[1])||void 0===i?void 0:i.pct),valueLabel:(null===e||void 0===e||null===(a=e[1])||void 0===a?void 0:a.pct)+"%"})]})}))]})})}}))})]})})};var j,S,_=l(12620),F=l(65080),C=l(82745);const w=e=>{let{agentSettingModalFrgmt:n=null,onRequestClose:t,...i}=e;const{t:a}=(0,b.Bd)(),{message:r}=_.A.useApp(),o=(0,s.useRef)(null),c=(0,u.useFragment)(void 0!==j?j:j=l(81157),n),[d,g]=(0,u.useMutation)(void 0!==S?S:S=l(69130));return(0,A.jsx)(p.A,{...i,title:"".concat(a("agent.AgentSetting"),": ").concat(null===c||void 0===c?void 0:c.id),onCancel:()=>t(),destroyOnClose:!0,width:300,confirmLoading:g,onOk:()=>{var e;null===(e=o.current)||void 0===e||e.validateFields().then((e=>{d({variables:{id:(null===c||void 0===c?void 0:c.id)||"",props:{schedulable:e.schedulable}},onCompleted(e,n){var l,i;null===e||void 0===e||null===(l=e.modify_agent)||void 0===l||!l.ok||n?(r.error(null===e||void 0===e||null===(i=e.modify_agent)||void 0===i?void 0:i.msg),t()):(r.success(a("agent.AgentSettingUpdated")),t(!0))},onError(e){r.error(null===e||void 0===e?void 0:e.message)}})})).catch((()=>{}))},children:(0,A.jsx)(F.A,{ref:o,preserve:!1,initialValues:{...c},children:(0,A.jsx)(F.A.Item,{name:"schedulable",label:a("agent.Schedulable"),valuePropName:"checked",children:(0,A.jsx)(C.A,{})})})})};var T=l(23623),L=l(91353),K=l(66464),z=l(13353),I=l(22226);const M=function(e){void 0===e&&(e=[]);var n=(0,s.useRef)(-1),l=(0,s.useRef)([]),t=(0,s.useCallback)((function(e){n.current+=1,l.current.splice(e,0,n.current)}),[]),i=(0,z.zs)((0,s.useState)((function(){return e.forEach((function(e,n){t(n)})),e})),2),a=i[0],r=i[1],o=(0,s.useCallback)((function(e){l.current=[],r((function(){return e.forEach((function(e,n){t(n)})),e}))}),[]),u=(0,s.useCallback)((function(e,n){r((function(l){var i=(0,z.fX)([],(0,z.zs)(l),!1);return i.splice(e,0,n),t(e),i}))}),[]),c=(0,s.useCallback)((function(e){return l.current[e]}),[]),d=(0,s.useCallback)((function(e){return l.current.findIndex((function(n){return n===e}))}),[]),g=(0,s.useCallback)((function(e,n){r((function(l){var i=(0,z.fX)([],(0,z.zs)(l),!1);return n.forEach((function(n,l){t(e+l)})),i.splice.apply(i,(0,z.fX)([e,0],(0,z.zs)(n),!1)),i}))}),[]),p=(0,s.useCallback)((function(e,n){r((function(l){var t=(0,z.fX)([],(0,z.zs)(l),!1);return t[e]=n,t}))}),[]),m=(0,s.useCallback)((function(e){r((function(n){var t=(0,z.fX)([],(0,z.zs)(n),!1);t.splice(e,1);try{l.current.splice(e,1)}catch(i){console.error(i)}return t}))}),[]),v=(0,s.useCallback)((function(e){Array.isArray(e)?e.length&&r((function(n){var t=[],i=n.filter((function(n,l){var i=!e.includes(l);return i&&t.push(c(l)),i}));return l.current=t,i})):I.A&&console.error('`indexes` parameter of `batchRemove` function expected to be an array, but got "'.concat(typeof e,'".'))}),[]),y=(0,s.useCallback)((function(e,n){e!==n&&r((function(t){var i=(0,z.fX)([],(0,z.zs)(t),!1),a=i.filter((function(n,l){return l!==e}));a.splice(n,0,i[e]);try{var r=l.current.filter((function(n,l){return l!==e}));r.splice(n,0,l.current[e]),l.current=r}catch(o){console.error(o)}return a}))}),[]),x=(0,s.useCallback)((function(e){r((function(n){return t(n.length),n.concat([e])}))}),[]),h=(0,s.useCallback)((function(){try{l.current=l.current.slice(0,l.current.length-1)}catch(e){console.error(e)}r((function(e){return e.slice(0,e.length-1)}))}),[]),f=(0,s.useCallback)((function(e){r((function(n){return t(0),[e].concat(n)}))}),[]),b=(0,s.useCallback)((function(){try{l.current=l.current.slice(1,l.current.length)}catch(e){console.error(e)}r((function(e){return e.slice(1,e.length)}))}),[]),A=(0,s.useCallback)((function(e){return e.map((function(e,n){return{key:n,item:e}})).sort((function(e,n){return d(e.key)-d(n.key)})).filter((function(e){return!!e.item})).map((function(e){return e.item}))}),[]);return{list:a,insert:u,merge:g,replace:p,remove:m,batchRemove:v,getKey:c,getIndex:d,move:y,push:x,pop:h,unshift:f,shift:b,sortList:A,resetList:o}};var D=l(36209),R=l(78074),E=l(48713),V=l(20307),N=l(6932);const O=e=>{let{filterProperties:n,value:l,onChange:t,defaultValue:i,...a}=e;const[r,u]=(0,K.A)({}),[c,d]=(0,K.A)({value:l,defaultValue:i,onChange:t}),g=(0,s.useMemo)((()=>{if(void 0===c)return[];return c.split("&").map((e=>e.trim())).map((e=>{var l;const{property:t,operator:i,value:a}=function(e){const[n,...l]=e.split(/\s+(?=(?:(?:[^"]*"){2})*[^"]*$)/),[t,...i]=l.join(" ").split(/\s+(?=(?:(?:[^"]*"){2})*[^"]*$)/);return{property:n,operator:t,value:i.join(" ").replace(/^"|"$/g,"")}}(e);return{property:t,operator:i,value:a,propertyLabel:(null===(l=o().find(n,(e=>e.key===t)))||void 0===l?void 0:l.propertyLabel)||t}}))}),[c,n]),{t:p}=(0,b.Bd)(),m=o().map(n,(e=>({label:e.propertyLabel,value:e.key,filter:e}))),[x,h]=(0,s.useState)(m[0].filter),{list:f,remove:k,push:j,resetList:S,getKey:_}=M(g),{token:F}=y.A.useToken();return(0,s.useEffect)((()=>{0===f.length?d(void 0):d(o().map(f,(e=>"".concat(e.property," ").concat(e.operator,' "').concat(e.value,'"'))).join(" & "))}),[f,d]),(0,A.jsxs)(v.A,{direction:"column",gap:"xs",style:{flex:1},align:"start",children:[(0,A.jsx)(v.A,{children:(0,A.jsx)(D.A.Search,{addonBefore:(0,A.jsx)(R.A,{popupMatchSelectWidth:!1,options:m,value:x.key,onChange:(e,n)=>{h(o().castArray(n)[0].filter)}}),style:{minWidth:250},onSearch:e=>{if(o().isEmpty(e))return;u("");const n=x.defaultOperator||"ilike",l="ilike"===n||"like"===n?"%".concat(e,"%"):"".concat(e);j({property:x.key,propertyLabel:x.propertyLabel,operator:n,value:l})},allowClear:!0,placeholder:p("propertyFilter.placeHolder"),value:r,onChange:e=>u(e.target.value),...a})}),f.length>0&&(0,A.jsxs)(v.A,{direction:"row",gap:"xs",wrap:"wrap",style:{alignSelf:"stretch"},children:[o().map(f,((e,n)=>{return(0,A.jsxs)(E.A,{closable:!0,onClose:()=>{k(n)},style:{margin:0},children:[e.propertyLabel,": ",(l=e.value,l.replace(/^%|%$/g,""))]},_(n));var l})),f.length>1&&(0,A.jsx)(V.A,{title:p("propertyFilter.ResetFilter"),children:(0,A.jsx)(N.Ay,{size:"small",icon:(0,A.jsx)(L.A,{style:{color:F.colorTextSecondary}}),type:"text",onClick:()=>{S([])}})})]})]})};var B,J=l(5621),P=l(8469),X=l(34680),$=l(8461),G=l(94080),U=l(2292),q=l(63718),W=l(93792),Q=l(2381),H=l(44355),Y=l(99641),Z=l(14862),ee=l(14455),ne=l.n(ee);const le=e=>{let{containerStyle:n,tableProps:r}=e;const{t:c}=(0,b.Bd)(),{token:d}=y.A.useToken(),{isDarkMode:p}=(0,g.e)(),[x]=(0,a.Hv)(),[h,j]=(0,s.useState)(),[S,_]=(0,s.useState)(),[F,C]=(0,s.useState)(!1),L=(0,i.CX)(),[K,z]=(0,s.useTransition)(),[I,M]=(0,s.useTransition)(),[D,R]=(0,s.useTransition)(),[ee,le]=(0,s.useState)("ALIVE"),[te,ie]=(0,s.useState)(ee),[ae,re]=(0,s.useTransition)(),[oe,se]=(0,s.useState)(),{baiPaginationOption:ue,tablePaginationOption:ce,setTablePaginationOption:de}=(e=>{const[n,l]=(0,s.useState)(e);return{baiPaginationOption:{limit:n.pageSize,offset:n.current>1?(n.current-1)*n.pageSize:0},tablePaginationOption:{pageSize:n.pageSize,current:n.current},setTablePaginationOption:e=>{l((n=>({...n,...e})))}}})({current:1,pageSize:20}),[ge,pe]=(0,s.useState)(),[me,ve]=(0,i.Tw)("first"),[ye]=(0,s.useState)("network-only"),xe=()=>M((()=>{ve()})),{agent_list:he}=(0,u.useLazyLoadQuery)(void 0!==B?B:B=l(80508),{limit:ue.limit,offset:ue.offset,filter:oe,order:ge,status:ee},{fetchKey:me,fetchPolicy:ye}),fe=[{title:"#",fixed:"left",render:(e,n,l)=>l+1+(ce.current-1)*ce.pageSize,showSorterTooltip:!1,rowScope:"row"},{title:"ID / ".concat(c("agent.Endpoint")),key:"id",dataIndex:"id",fixed:"left",render:(e,n)=>(0,A.jsxs)(v.A,{direction:"column",align:"start",children:[(0,A.jsx)(f.A.Text,{children:e}),(0,A.jsx)(f.A.Text,{type:"secondary",children:null===n||void 0===n?void 0:n.addr})]}),sorter:!0},{title:c("agent.Region"),key:"region",dataIndex:"region",render:e=>{const n=o().split(e,"/"),l=null===n||void 0===n?void 0:n[0],t=(null===n||void 0===n?void 0:n.length)>1?n[1]:"",{color:i,icon:a}={aws:{color:"orange",icon:"aws"},amazon:{color:"orange",icon:"aws"},azure:{color:"blue",icon:"azure"},gcp:{color:"lightblue",icon:"gcp"},google:{color:"lightblue",icon:"gcp"},nbp:{color:"green",icon:"nbp"},naver:{color:"green",icon:"nbp"},openstack:{color:"red",icon:"openstack"},dgx:{color:"green",icon:"local"},local:{color:"yellow",icon:"local"}}[l]||{color:"yellow",icon:"local"};return(0,A.jsxs)(v.A,{gap:"xxs",children:[(0,A.jsx)("img",{alt:e,src:"/resources/icons/".concat(a,".png"),style:{width:"32px",height:"32px",filter:p&&"local"===a?"invert(1)":""}}),""!==t?(0,A.jsx)(J.A,{values:[{label:t,color:i},{label:l,color:i}]}):(0,A.jsx)(E.A,{color:i,children:l})]})}},{title:c("agent.Architecture"),key:"architecture",dataIndex:"architecture"},{title:c("agent.Starts"),key:"first_contact",dataIndex:"first_contact",render:e=>(0,A.jsxs)(v.A,{direction:"column",children:[(0,A.jsx)(f.A.Text,{children:ne()(e).format("ll LTS")}),(0,A.jsx)(J.A,{values:[c("agent.Running"),(0,A.jsx)(T.A,{callback:()=>L.utils.elapsedTime(e,Date.now()),delay:1e3})]})]}),sorter:!0},{title:c("agent.Allocation"),key:"allocation",render:(e,n)=>{const l=JSON.parse((null===n||void 0===n?void 0:n.occupied_slots)||"{}"),i=JSON.parse((null===n||void 0===n?void 0:n.available_slots)||"{}");return(0,A.jsx)(v.A,{direction:"column",gap:"xxs",children:o().map(o().keys(i),(e=>{var n,a,r,s,u,c,g,p,y,h;return"cpu"===e?(0,A.jsxs)(v.A,{justify:"between",style:{minWidth:220},children:[(0,A.jsxs)(v.A,{gap:"xxs",children:[(0,A.jsx)(P.s5,{type:e},e),(0,A.jsxs)(f.A.Text,{children:[null!==(n=l[e])&&void 0!==n?n:0,"/",null!==(a=i[e])&&void 0!==a?a:0]}),(0,A.jsx)(f.A.Text,{type:"secondary",style:{fontSize:d.sizeXS},children:null===x||void 0===x||null===(r=x.cpu)||void 0===r?void 0:r.display_unit})]}),(0,A.jsx)(m.A,{percent:l[e]/i[e]*100,strokeColor:l[e]/i[e]*100>80?d.colorError:d.colorSuccess,width:120,valueLabel:o().toFinite(l[e]/i[e]*100).toFixed(2)+" %"})]},e):"mem"===e?(0,A.jsxs)(v.A,{justify:"between",style:{minWidth:220},children:[(0,A.jsxs)(v.A,{gap:"xxs",children:[(0,A.jsx)(P.s5,{type:e},e),(0,A.jsxs)(f.A.Text,{children:[null!==(s=null===(u=(0,t.Js)(l[e],"g",0))||void 0===u?void 0:u.numberFixed)&&void 0!==s?s:0,"/",null!==(c=null===(g=(0,t.Js)(i[e],"g",0))||void 0===g?void 0:g.numberFixed)&&void 0!==c?c:0]}),(0,A.jsx)(f.A.Text,{type:"secondary",style:{fontSize:d.sizeXS},children:"GiB"})]}),(0,A.jsx)(m.A,{percent:l[e]/i[e]*100,strokeColor:l[e]/i[e]*100>80?d.colorError:d.colorSuccess,width:120,valueLabel:o().toFinite(l[e]/i[e]*100).toFixed(2)+" %"})]},e):l[e]&&i[e]?(0,A.jsxs)(v.A,{justify:"between",style:{minWidth:220},children:[(0,A.jsxs)(v.A,{gap:"xxs",children:[(0,A.jsx)(P.s5,{type:e},e),(0,A.jsxs)(f.A.Text,{children:[null!==(p=l[e])&&void 0!==p?p:0,"/",null!==(y=i[e])&&void 0!==y?y:0]}),(0,A.jsx)(f.A.Text,{type:"secondary",style:{fontSize:d.sizeXS},children:null===x||void 0===x||null===(h=x[e])||void 0===h?void 0:h.display_unit})]}),(0,A.jsx)(m.A,{percent:l[e]/i[e]*100,strokeColor:l[e]/i[e]*100>80?d.colorError:d.colorSuccess,width:120,valueLabel:o().toFinite(l[e]/i[e]*100).toFixed(2)+" %"})]},e):void 0}))})}},{title:c("agent.Utilization"),key:"live_stat",dataIndex:"live_stat",render:(e,n)=>{const l=JSON.parse(e||"{}");if("ALIVE"===(null===n||void 0===n?void 0:n.status)){var i,a,r,s;const e={cpu_util:{capacity:0,current:0,ratio:0},mem_util:{capacity:0,current:0,ratio:0}};if(l&&l.node&&l.devices){const n=o().keys(l.devices.cpu_util).length;e.cpu_util.capacity=o().toFinite(l.node.cpu_util.capacity),e.cpu_util.current=o().toFinite(l.node.cpu_util.current),e.cpu_util.ratio=e.cpu_util.current/e.cpu_util.capacity/n*100||0,e.mem_util.capacity=o().toInteger(l.node.mem.capacity),e.mem_util.current=o().toInteger(l.node.mem.current),e.mem_util.ratio=e.mem_util.current/e.mem_util.capacity*100||0}return o().forEach(o().keys(null===l||void 0===l?void 0:l.node),(n=>{["cpu_util","mem","disk","net_rx","net_tx"].includes(n)||(o().includes(n,"_util")?e[n]={capacity:"cuda_util"===n?o().toFinite(l.node[n]["stats.max"]):o().toFinite(l.node[n].capacity),current:o().toFinite(l.node[n].current),ratio:o().toFinite(l.node[n].current)/100||0}:n.includes("_mem")&&(e[n]={capacity:o().toFinite(l.node[n].capacity),current:o().toFinite(l.node[n].current),ratio:o().toFinite(l.node[n].pct)/100||0}))})),(0,A.jsxs)(v.A,{direction:"column",gap:"xxs",children:[(0,A.jsxs)(v.A,{justify:"between",style:{minWidth:200},children:[(0,A.jsx)(f.A.Text,{children:null===x||void 0===x||null===(i=x.cpu)||void 0===i?void 0:i.human_readable_name}),(0,A.jsx)(m.A,{percent:e.cpu_util.ratio,width:120,valueLabel:o().toFinite(e.cpu_util.ratio.toFixed(1))+" %"})]}),(0,A.jsxs)(v.A,{justify:"between",style:{minWidth:200},children:[(0,A.jsx)(f.A.Text,{children:null===x||void 0===x||null===(a=x.mem)||void 0===a?void 0:a.human_readable_name}),(0,A.jsx)(m.A,{percent:e.mem_util.ratio,width:120,valueLabel:(null===(r=(0,t.Js)(o().toString(e.mem_util.current),"g"))||void 0===r?void 0:r.numberFixed)+"/"+(null===(s=(0,t.Js)(o().toString(e.mem_util.capacity),"g"))||void 0===s?void 0:s.numberFixed)+" GiB"})]}),o().map(o().keys(null===l||void 0===l?void 0:l.node),(n=>{if(!["cpu_util","mem"].includes(n)){if(o().includes(n,"_util")){var l;const t=o().split(n,"_")[0]+".device";return(0,A.jsxs)(v.A,{justify:"between",style:{minWidth:200,width:"min-content"},gap:"xxs",children:[(0,A.jsxs)(f.A.Text,{children:[null===x||void 0===x||null===(l=x[t])||void 0===l?void 0:l.human_readable_name,"(util)"]}),(0,A.jsx)(m.A,{width:120,percent:e[n].ratio,valueLabel:o().toFinite(e[n].ratio.toFixed(1))+" %"})]})}if(o().includes(n,"_mem")){var i,a,r;const l=o().split(n,"_")[0]+".device";return(0,A.jsxs)(v.A,{justify:"between",style:{minWidth:200,width:"min-content"},gap:"xxs",children:[(0,A.jsxs)(f.A.Text,{children:[null===x||void 0===x||null===(i=x[l])||void 0===i?void 0:i.human_readable_name,"(mem)"]}),(0,A.jsx)(m.A,{width:120,percent:e[n].ratio,valueLabel:(null===(a=(0,t.Js)(o().toString(e[n].current),"g"))||void 0===a?void 0:a.numberFixed)+"/"+(null===(r=(0,t.Js)(o().toString(e[n].capacity),"g"))||void 0===r?void 0:r.numberFixed)+" GiB"})]})}}}))]})}return c("agent.NoAvailableLiveStat")}},{title:c("agent.DiskPerc"),key:"disk_perc",render:(e,n)=>{var l,i,a;const r=null!==(l=null===(i=JSON.parse((null===n||void 0===n?void 0:n.live_stat)||"{}"))||void 0===i||null===(a=i.node)||void 0===a?void 0:a.disk)&&void 0!==l?l:{},o=parseFloat(r.pct)||0,s=parseFloat(o.toFixed(1)),u=s>80?d.colorError:d.colorSuccess;return(0,A.jsxs)(v.A,{direction:"column",children:[(0,A.jsx)(m.A,{valueLabel:s+" %",percent:s,strokeColor:u,width:120}),(0,A.jsxs)(f.A.Text,{style:{fontSize:d.fontSizeSM},children:[(0,t.wb)(null===r||void 0===r?void 0:r.current),"GB /"," ",(0,t.wb)(null===r||void 0===r?void 0:r.capacity),"GB"]})]})}},{title:c("general.ResourceGroup"),key:"resource_group",dataIndex:"scaling_group",sorter:!0},{title:c("agent.Status"),key:"status",dataIndex:"status",render:(e,n)=>{var l,t,i;const a=JSON.parse((null===n||void 0===n?void 0:n.compute_plugins)||"{}"),r=JSON.parse((null===n||void 0===n?void 0:n.available_slots)||"{}");return(0,A.jsxs)(v.A,{direction:"column",gap:"xxs",align:"start",children:[(0,A.jsx)(J.A,{values:[{label:"Agent"},{label:null===n||void 0===n?void 0:n.version,color:"ALIVE"===e?"green":"TERMINATED"===e?"red":"blue"}]}),null!==a&&void 0!==a&&a.cuda?(0,A.jsxs)(A.Fragment,{children:[null!==a&&void 0!==a&&null!==(l=a.cuda)&&void 0!==l&&l.cuda_version?(0,A.jsx)(J.A,{values:[{label:"CUDA"},{label:null===a||void 0===a||null===(t=a.cuda)||void 0===t?void 0:t.cuda_version,color:"green"}]}):(0,A.jsx)(E.A,{color:"green",children:"CUDA Disabled"}),(0,A.jsx)(J.A,{values:[{label:"CUDA Plugin"},{label:null===a||void 0===a||null===(i=a.cuda)||void 0===i?void 0:i.version,color:"blue"}]}),o().includes(o().keys(r),"cuda.shares")?(0,A.jsx)(E.A,{color:"blue",children:"Fractional GPU\u2122"}):null]}):null]})}},{title:c("agent.Schedulable"),key:"schedulable",dataIndex:"schedulable",render:e=>(0,A.jsx)(v.A,{justify:"center",children:!0===e?(0,A.jsx)($.A,{style:{color:d.colorPrimary,fontSize:d.fontSizeXL}}):(0,A.jsx)(G.A,{style:{color:d.colorError,fontSize:d.fontSizeXL}})}),sorter:!0},{title:c("general.Control"),key:"control",fixed:"right",render:(e,n)=>(0,A.jsxs)(v.A,{children:[(0,A.jsx)(N.Ay,{size:"large",style:{color:d.colorSuccess},type:"text",icon:(0,A.jsx)(U.A,{}),onClick:()=>j(n)}),(0,A.jsx)(N.Ay,{size:"large",style:{color:d.colorInfo},type:"text",icon:(0,A.jsx)(q.A,{}),onClick:()=>_(n)})]})}],[be,Ae]=(0,H.A)("backendaiwebui.AgentList.displayedColumnKeys",{defaultValue:fe.map((e=>o().toString(e.key)))});return(0,A.jsxs)(v.A,{direction:"column",align:"stretch",style:n,children:[(0,A.jsxs)(v.A,{justify:"between",align:"start",gap:"xs",style:{padding:d.paddingXS},wrap:"wrap",children:[(0,A.jsxs)(v.A,{direction:"row",gap:"sm",align:"start",style:{flex:1},wrap:"wrap",children:[(0,A.jsx)(Y.A,{options:[{label:c("agent.Connected"),value:"ALIVE"},{label:c("agent.Terminated"),value:"TERMINATED"}],value:K?te:ee,onChange:e=>{ie(e),z((()=>{le(e)}))}}),(0,A.jsx)(O,{filterProperties:[{key:"id",propertyLabel:"ID"},{key:"addr",propertyLabel:c("agent.Endpoint")}],value:oe,onChange:e=>{re((()=>{se(e)}))}})]}),(0,A.jsx)(v.A,{gap:"xs",children:(0,A.jsx)(V.A,{title:c("button.Refresh"),children:(0,A.jsx)(N.Ay,{loading:I,onClick:()=>xe(),icon:(0,A.jsx)(W.A,{})})})})]}),(0,A.jsx)(Z.A,{bordered:!0,scroll:{x:"max-content"},rowKey:"id",dataSource:null===he||void 0===he?void 0:he.items,showSorterTooltip:!1,columns:o().filter(fe,(e=>null===be||void 0===be?void 0:be.includes(o().toString(e.key)))),pagination:{pageSize:ce.pageSize,showSizeChanger:!0,total:null===he||void 0===he?void 0:he.total_count,current:ce.current,showTotal:(e,n)=>"".concat(n[0],"-").concat(n[1]," of ").concat(e," items"),pageSizeOptions:["10","20","50"],style:{marginRight:d.marginXS}},onChange:(e,n,l)=>{let{pageSize:i,current:a}=e;R((()=>{o().isNumber(a)&&o().isNumber(i)&&i!==ce.pageSize&&a!==ce.current&&de({current:a,pageSize:i}),pe((0,t.Wh)(l))}))},loading:{spinning:D||K||ae,indicator:(0,A.jsx)(Q.A,{})},...r}),(0,A.jsx)(v.A,{justify:"end",style:{padding:d.paddingXXS},children:(0,A.jsx)(N.Ay,{type:"text",icon:(0,A.jsx)(q.A,{}),onClick:()=>{C(!0)}})}),(0,A.jsx)(k,{agentDetailModalFrgmt:h,open:!!h,onRequestClose:()=>j(null)}),(0,A.jsx)(w,{agentSettingModalFrgmt:S,open:!!S,onRequestClose:e=>{e&&xe(),_(null)}}),(0,A.jsx)(X.A,{open:F,onRequestClose:e=>{(null===e||void 0===e?void 0:e.selectedColumnKeys)&&Ae(null===e||void 0===e?void 0:e.selectedColumnKeys),C(!1)},columns:fe,displayedColumnKeys:be||[]})]})};var te=l(29475);const ie=(0,c.withDefault)(c.StringParam,"agents"),ae=e=>{const{t:n}=(0,b.Bd)(),[l,t]=(0,c.useQueryParam)("tab",ie,{updateType:"replace"});return(0,A.jsxs)(te.A,{activeTabKey:l,onTabChange:e=>t(e),tabList:[{key:"agents",tab:n("agent.Agent")},{key:"storages",tab:n("general.StorageProxies")},{key:"resourceGroup",tab:n("general.ResourceGroup")}],styles:{body:{padding:0,paddingTop:1,overflow:"hidden"}},children:["agents"===l?(0,A.jsx)(le,{containerStyle:{marginLeft:-1,marginRight:-1}}):null,"storages"===l?(0,A.jsx)("backend-ai-storage-proxy-list",{active:!0}):null,"resourceGroup"===l?(0,A.jsx)("backend-ai-resource-group-list",{active:!0}):null]})}},94080:(e,n,l)=>{l.d(n,{A:()=>s});var t=l(58168),i=l(76998);const a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};var r=l(76228),o=function(e,n){return i.createElement(r.A,(0,t.A)({},e,{ref:n,icon:a}))};const s=i.forwardRef(o)}}]);
//# sourceMappingURL=944.f2b4e709.chunk.js.map