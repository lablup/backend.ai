"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[618],{76639:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});const a=function(){var e={defaultValue:null,kind:"LocalArgument",name:"capacityProps"},t={defaultValue:null,kind:"LocalArgument",name:"currentProps"},i={defaultValue:null,kind:"LocalArgument",name:"user_id"},a={kind:"Variable",name:"user_id",variableName:"user_id"},s=[{alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},{alias:null,args:null,concreteType:"ContainerUtilizationMetric",kind:"LinkedField",name:"metrics",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"metric_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value_type",storageKey:null},{alias:null,args:null,concreteType:"MetircResultValue",kind:"LinkedField",name:"values",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"timestamp",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_value",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"avg_value",storageKey:null}],storageKey:null}],r=[{alias:"capacity_metric",args:[{kind:"Variable",name:"props",variableName:"capacityProps"},a],concreteType:"UserUtilizationMetric",kind:"LinkedField",name:"user_utilization_metric",plural:!1,selections:s,storageKey:null},{alias:"current_metric",args:[{kind:"Variable",name:"props",variableName:"currentProps"},a],concreteType:"UserUtilizationMetric",kind:"LinkedField",name:"user_utilization_metric",plural:!1,selections:s,storageKey:null}];return{fragment:{argumentDefinitions:[e,t,i],kind:"Fragment",metadata:null,name:"SessionMetricGraphQuery",selections:r,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[i,e,t],kind:"Operation",name:"SessionMetricGraphQuery",selections:r},params:{cacheID:"aa2a1000ef4410eaa2da853eabbdf0d6",id:null,metadata:{},name:"SessionMetricGraphQuery",operationKind:"query",text:"query SessionMetricGraphQuery(\n  $user_id: UUID!\n  $capacityProps: UserUtilizationMetricQueryInput!\n  $currentProps: UserUtilizationMetricQueryInput!\n) {\n  capacity_metric: user_utilization_metric(user_id: $user_id, props: $capacityProps) {\n    user_id\n    metrics {\n      metric_name\n      value_type\n      values {\n        timestamp\n        value\n      }\n      max_value\n      avg_value\n    }\n  }\n  current_metric: user_utilization_metric(user_id: $user_id, props: $currentProps) {\n    user_id\n    metrics {\n      metric_name\n      value_type\n      values {\n        timestamp\n        value\n      }\n      max_value\n      avg_value\n    }\n  }\n}\n"}}}();a.hash="88c8725f744a307e05f63cff149489f0";const s=a},31320:(e,t,i)=>{i.r(t),i.d(t,{default:()=>s});const a=function(){var e=[{alias:null,args:null,concreteType:"ContainerUtilizationMetricMetadata",kind:"LinkedField",name:"container_utilization_metric_metadata",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"metric_names",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UserSessionsMetricsQuery",selections:e,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"UserSessionsMetricsQuery",selections:e},params:{cacheID:"21560ceabb06c90e8704f9796db735f7",id:null,metadata:{},name:"UserSessionsMetricsQuery",operationKind:"query",text:"query UserSessionsMetricsQuery {\n  container_utilization_metric_metadata {\n    metric_names\n  }\n}\n"}}}();a.hash="9d7023ac80a345ed8f9823d881a345a4";const s=a},10618:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ae});var a=i(81751),s=i(65079),r=i(6871),n=i(7885);const l=e=>{const t=(0,a.CX)();return(0,n.nj)({queryKey:["UsageHistory",t._config._userId,null===e||void 0===e?void 0:e.fetchKey],queryFn:()=>t.resources.user_stats()})};var o=i(96520),u=i(81081),c=i(50458),d=i(70554),m=i(77397),p=i(52530),y=i.n(p),v=i(90635),g=i(52426);const h=(0,m.rU)((e=>{let{css:t,token:i}=e;return{graphCard:t`
    .g2-tooltip {
      background-color: ${i.colorBgSpotlight} !important;
      border: none !important;
    }
    .g2-tooltip-title {
      color: ${i.colorTextLightSolid} !important;
    }
    .g2-tooltip-list-item-name {
      color: ${i.colorTextLightSolid} !important;
    }
    .g2-tooltip-list-item-value {
      color: ${i.colorTextLightSolid} !important;
    }
  `}})),x=e=>{let{title:t,tooltipText:i,children:a}=e;return(0,g.jsx)(d.A,{type:"inner",title:(0,g.jsxs)(o.A,{gap:"xxs",children:[t,i?(0,g.jsx)(u.A,{title:i}):null]}),style:{width:"100%"},children:a})},_=e=>{let{data:t,key:i,period:a,targetUnit:r,displayUnit:n,unitType:l,isDarkMode:o}=e;const u=e=>{return"count"===l?e:"byte"===l?null!==(t=null===(i=(0,s.mv)(e,r))||void 0===i?void 0:i.number)&&void 0!==t?t:0:"decimal"===l?null!==(a=null===(n=(0,s.Gh)(e,r))||void 0===n?void 0:n.number)&&void 0!==a?a:0:e;var t,i,a,n};return{data:t.filter(((e,i)=>t.length-("1D"===a?96:672)<=i)).map((e=>({date:y()(1e3*e.date).format("MMM DD HH:mm"),value:u(e[i].value)}))),xField:"date",yField:"value",axis:{x:{labelAutoHide:!0,tickFilter:(e,t)=>t%("1D"===a?12:48)===0},y:{title:n}},animate:{enter:{type:"growInY"}},theme:o?"dark":"light"}},k=e=>{let{period:t,fetchKey:i}=e;const{t:s}=(0,v.Bd)(),{data:n}=l({fetchKey:i}),{isDarkMode:u}=(0,r.e)(),{styles:d}=h(),m=(0,a.CX)();return(0,g.jsxs)(o.A,{className:d.graphCard,direction:"column",align:"start",gap:"md",children:[(0,g.jsx)(x,{title:"Sessions",tooltipText:s("statistics.SessionsDesc"),children:(0,g.jsx)(c.A,{height:200,..._({data:n,key:"num_sessions",period:t,targetUnit:"count",displayUnit:"count",unitType:"count",isDarkMode:u})})}),(0,g.jsx)(x,{title:"CPU",tooltipText:s("statistics.CPUDesc"),children:(0,g.jsx)(c.A,{height:200,..._({data:n,key:"cpu_allocated",period:t,targetUnit:"count",displayUnit:"count",unitType:"count",isDarkMode:u})})}),(0,g.jsx)(x,{title:"Memory",tooltipText:s("statistics.MemoryDesc"),children:(0,g.jsx)(c.A,{height:200,..._({data:n,key:"mem_allocated",period:t,targetUnit:"g",displayUnit:"GiB",unitType:"byte",isDarkMode:u})})}),(0,g.jsx)(x,{title:"GPU",tooltipText:s("statistics.GPUDesc"),children:(0,g.jsx)(c.A,{height:200,..._({data:n,key:"gpu_allocated",period:t,targetUnit:"count",displayUnit:"count",unitType:"count",isDarkMode:u})})}),null!==m&&void 0!==m&&m.supports("user-metrics")?null:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(x,{title:"IO-Read",tooltipText:s("statistics.IOReadDesc"),children:(0,g.jsx)(c.A,{height:200,..._({data:n,key:"io_read_bytes",period:t,targetUnit:"m",displayUnit:"MiB",unitType:"decimal",isDarkMode:u})})}),(0,g.jsx)(x,{title:"IO-Write",tooltipText:s("statistics.IOWriteDesc"),children:(0,g.jsx)(c.A,{height:200,..._({data:n,key:"io_write_bytes",period:t,targetUnit:"m",displayUnit:"MiB",unitType:"decimal",isDarkMode:u})})})]})]})};var b=i(55288),f=i(37090),D=i(43299),j=i(79837),M=i(49965),U=i(60073),A=i(55202),S=i(47174);const T=(0,S.withDefault)((0,S.createEnumParam)(["1D","1W"]),"1D"),L=()=>{const[e,t]=(0,S.useQueryParam)("period",T),{t:i}=(0,v.Bd)(),{token:s}=f.A.useToken(),[r,n]=(0,a.Tw)("first"),[l,u]=(0,A.useTransition)();let c=[{label:i("statistics.1Day"),value:"1D"},{label:i("statistics.1Week"),value:"1W"}];return(0,g.jsxs)(o.A,{direction:"column",align:"stretch",gap:"md",style:{padding:s.paddingMD},children:[(0,g.jsx)(D.A,{showIcon:!0,message:i("statistics.UsageHistoryNote"),type:"info"}),(0,g.jsxs)(o.A,{gap:"sm",justify:"between",children:[(0,g.jsx)(j.A.Item,{label:i("statistics.SelectPeriod"),style:{marginBottom:0},children:(0,g.jsx)(M.A,{popupMatchSelectWidth:!1,options:c,value:e,onChange:e=>t(e)})}),(0,g.jsx)(b.A,{loading:l,value:r,onChange:()=>{u((()=>{n()}))}})]}),(0,g.jsx)(A.Suspense,{fallback:(0,g.jsx)(U.A,{active:!0}),children:(0,g.jsx)(k,{period:e||"1D",fetchKey:r})})]})};var P,w=i(4335),K=i(78909),$=i(5668),C=i(64428),F=i.n(C),I=i(18139),G=i(70691),N=i(45131),Q=i(54481),z=i(47370),B=i(9337),W=i(58051),R=i(12180),E=i(42508),H=i(97173);const q=(0,m.rU)((e=>{let{css:t,token:i}=e;return{recharts:t`
    .recharts-label {
      fill: ${i.colorTextDescription};
    }
    .recharts-cartesian-axis-line {
      stroke: ${i.colorBorder};
    }
    .recharts-cartesian-axis-tick-line {
      stroke: ${i.colorBorder};
    }
    .recharts-cartesian-axis-tick-value {
      fill: ${i.colorTextDescription};
    }
    .recharts-default-tooltip {
      background-color: ${i.colorBgSpotlight} !important;
      border: none !important;
      color: ${i.colorTextLightSolid} !important;
    }
  `}})),V=e=>{var t,a,s,r,n,l,o;let{queryProps:{startDate:u,endDate:c,metricName:d,userId:m,dayDiff:p},fetchKey:y}=e;const{token:v}=f.A.useToken(),{styles:h}=q(),{mergedResourceSlots:x}=(0,K.Hv)(),{capacity_metric:_,current_metric:k}=(0,I.useLazyLoadQuery)(void 0!==P?P:P=i(76639),{user_id:m,capacityProps:{metric_name:d,start:u,end:c,step:p<7?"5m":p<30?"1h":"1d",value_type:"capacity"},currentProps:{metric_name:d,start:u,end:c,step:p<7?"5m":p<30?"1h":"1d",value_type:"current"}},{fetchPolicy:"store-and-network",fetchKey:y}),b=Y(null!==(t=null===_||void 0===_?void 0:_.metrics)&&void 0!==t?t:[],null!==(a=null===k||void 0===k?void 0:k.metrics)&&void 0!==a?a:[],u,c,p<7?"5m":p<30?"1h":"1d"),D=(0,A.useMemo)((()=>{var e;const[t]=F().split(d,"_");return null!==(e=F().find(F().keys(x),(e=>F().startsWith(e,t))))&&void 0!==e?e:""}),[x,d]),j=null===(s=x[D])||void 0===s?void 0:s.description;return(0,g.jsx)(w.A,{title:(()=>{const[,...e]=F().split(d,"_"),t=F().startCase(e.join(" "));return j?`${j} ${t}`:F().includes(d.toLowerCase(),"io")?`${F().startCase(d.replaceAll("io","IO").replaceAll("_"," "))}`:`${F().startCase(d.replaceAll("_"," "))}`})(),type:"inner",styles:{body:{padding:`${v.marginMD}px ${v.marginMD}px ${v.marginXS}px ${v.marginMD}px`}},children:F().isEmpty(null===_||void 0===_?void 0:_.metrics)&&F().isEmpty(null===k||void 0===k?void 0:k.metrics)?(0,g.jsx)($.A,{image:$.A.PRESENTED_IMAGE_SIMPLE}):(0,g.jsx)(G.u,{width:"100%",height:350,children:(0,g.jsxs)(N.b,{data:b,className:h.recharts,children:[(0,g.jsx)(Q.d,{strokeDasharray:"3 3"}),(0,g.jsx)(z.W,{dataKey:"timestamp",minTickGap:v.marginMD}),(0,g.jsx)(B.h,{domain:[0,"dataMax"]}),(0,g.jsx)(W.m,{formatter:e=>`${e}${O(void 0,d).numberUnit}`}),(0,g.jsx)(R.s,{}),(0,g.jsx)(E.e,{y:O(null===k||void 0===k||null===(r=k.metrics)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.avg_value,null===k||void 0===k||null===(l=k.metrics)||void 0===l||null===(o=l[0])||void 0===o?void 0:o.metric_name).number,label:"Avg Used",stroke:v.red,strokeWidth:.6,strokeDasharray:"6 6"}),(0,g.jsx)(H.N,{type:"monotone",dataKey:"capacity",stroke:v.colorSuccess,dot:{r:0},strokeWidth:2}),(0,g.jsx)(H.N,{type:"monotone",dataKey:"used",stroke:v.colorPrimary,strokeWidth:2,dot:{r:0}})]})})})},Y=(e,t,i,a,s)=>{var r,n,l,o;const u=F().zip((null===(r=e[0])||void 0===r?void 0:r.values)||Array(null===(n=t[0])||void 0===n||null===(l=n.values)||void 0===l?void 0:l.length).fill(0),null===(o=t[0])||void 0===o?void 0:o.values).map((e=>{let[t,i]=e;return{timestamp:null===i||void 0===i?void 0:i.timestamp,capacity:null===t||void 0===t?void 0:t.value,used:null===i||void 0===i?void 0:i.value}})),c=s.slice(-1),d=parseInt(s.slice(0,-1),10)*{s:1,m:60,h:3600,d:86400}[c],m=[];for(let g=Number(i);g<Number(a);g+=d){var p,v;const e=g,i=F().find(u,(t=>t.timestamp===e));m.push({timestamp:y()(1e3*e).format("lll"),capacity:O(null===i||void 0===i?void 0:i.capacity,null===(p=t[0])||void 0===p?void 0:p.metric_name).number,used:O(null===i||void 0===i?void 0:i.used,null===(v=t[0])||void 0===v?void 0:v.metric_name).number})}return m},O=(e,t)=>{let i,a;if(!t)return{number:i,numberUnit:a};if(F().includes(t.toLowerCase(),"util"))i=Number((0,s.Z1)(null!==e&&void 0!==e?e:0,1)),a="%";else if(F().includes(t.toLowerCase(),"used"))i=Number((Number(e)/1e3).toFixed(1)),a="s";else{var r,n;const l=["io","net"],o=F().some(l,(e=>F().includes(F().toLower(t),e)));i=F().toNumber(o?null===(r=(0,s.Gh)(null!==e&&void 0!==e?e:"0","g"))||void 0===r?void 0:r.numberFixed:null===(n=(0,s.mv)(null!==e&&void 0!==e?e:"0","g"))||void 0===n?void 0:n.numberFixed),a=o?"GB":"GiB"}return F().includes(F().toLower(t),"net")&&(a="GB/s"),i=e?i:void 0,{number:i,numberUnit:a}};var X,Z=i(72079),J=i(4828),ee=i(56222);const te=()=>{const{t:e}=(0,v.Bd)(),{token:t}=f.A.useToken(),{RangePicker:s}=Z.A,[r,n]=(0,a.Tw)("first"),[l,u]=(0,A.useTransition)(),[c,d]=(0,S.useQueryParam)("startDate",(0,S.withDefault)(S.StringParam,y()().format("YYYY-MM-DD 00:00:00"))),[m,p]=(0,S.useQueryParam)("endDate",(0,S.withDefault)(S.StringParam,y()().format("YYYY-MM-DD 23:59:59"))),h=(0,K.U6)(),x=y()(m).diff(y()(c),"day"),{container_utilization_metric_metadata:_}=(0,I.useLazyLoadQuery)(void 0!==X?X:X=i(31320),{},{fetchKey:r,fetchPolicy:"store-and-network"}),k=(()=>{const e=(null===_||void 0===_?void 0:_.metric_names)||[],{cpuUtil:t,memory:i,acceleratorGroups:a,rest:s}=F().reduce(e,((e,t)=>{if(!t||"cpu_used"===t)return e;if("cpu_util"===t)e.cpuUtil.push(t);else if("mem"===t)e.memory.push(t);else if(!t.endsWith("_util")&&!t.endsWith("_mem")||F().startsWith(t,"cpu")||F().startsWith(t,"mem"))e.rest.push(t);else{const i=t.split("_").slice(0,-1).join("_");e.acceleratorGroups[i]||(e.acceleratorGroups[i]=[]),e.acceleratorGroups[i].push(t)}return e}),{cpuUtil:[],memory:[],acceleratorGroups:{},rest:[]});return[...t,...i,...F().flatMap(F().values(a),(e=>F().sortBy(e,(e=>e.endsWith("_util")?0:1)))),...s]})();return(0,g.jsxs)(o.A,{direction:"column",align:"stretch",gap:"md",style:{padding:t.paddingMD},children:[(0,g.jsxs)(o.A,{align:"stretch",justify:"between",children:[(0,g.jsx)(s,{allowClear:!1,showTime:{format:"HH:mm"},maxDate:y()(),onChange:(e,t)=>{let[i,a]=t;d(i),p(a)},defaultValue:[y()(c),y()(m)],presets:[{label:e("statistics.timeRange.Today"),value:[y()().startOf("day"),y()().endOf("day")]},{label:e("statistics.timeRange.LastHour"),value:[y()().subtract(1,"hour"),y()().subtract(1,"second")]},{label:e("statistics.timeRange.Last3Hours"),value:[y()().subtract(3,"hours"),y()().subtract(1,"second")]},{label:e("statistics.timeRange.Last12Hours"),value:[y()().subtract(12,"hours"),y()().subtract(1,"second")]},{label:e("statistics.timeRange.LastDay"),value:[y()().subtract(1,"day"),y()().subtract(1,"second")]},{label:e("statistics.timeRange.Last7Days"),value:[y()().subtract(7,"days"),y()().subtract(1,"second")]}]}),(0,g.jsx)(b.A,{loading:l,value:r,onChange:()=>{u((()=>{n()}))}})]}),x>30&&(0,g.jsx)(D.A,{showIcon:!0,message:e("statistics.prometheus.DataMissingInLowUsageDesc")}),(0,g.jsx)(A.Suspense,{fallback:(0,g.jsx)(U.A,{active:!0}),children:F().isEmpty(k)?(0,g.jsx)($.A,{image:$.A.PRESENTED_IMAGE_SIMPLE,description:e("statistics.prometheus.NoMetricsToDisplay")}):(0,g.jsx)(J.A,{gutter:[16,16],children:F().map(k,(e=>{var t,i;return(0,g.jsx)(ee.A,{xs:24,md:24,xl:12,xxl:12,children:(0,g.jsx)(V,{queryProps:{startDate:y()(c).unix().toString(),endDate:y()(m).unix().toString(),metricName:e,userId:null!==(t=null===(i=h[0])||void 0===i?void 0:i.uuid)&&void 0!==t?t:"",dayDiff:x},fetchKey:r})},e)}))})})]})},ie=(0,S.withDefault)(S.StringParam,"allocation-history"),ae=e=>{const{t:t}=(0,v.Bd)(),{token:i}=f.A.useToken(),r=(0,a.CX)(),[n,l]=(0,S.useQueryParam)("tab",ie,{updateType:"replace"});return(0,g.jsxs)(w.A,{activeTabKey:n,onTabChange:e=>l(e),tabList:(0,s.LY)([{key:"allocation-history",tab:t("webui.menu.UsageHistory")},(null===r||void 0===r?void 0:r.supports("user-metrics"))&&{key:"user-session-history",tab:t("webui.menu.UserSessionHistory")}]),styles:{body:{padding:0,paddingTop:1,overflow:"hidden"}},children:["allocation-history"===n?(0,g.jsx)(A.Suspense,{fallback:(0,g.jsx)(U.A,{active:!0,style:{padding:i.paddingContentVerticalLG}}),children:(0,g.jsx)(L,{})}):null,"user-session-history"===n?(0,g.jsx)(A.Suspense,{fallback:(0,g.jsx)(U.A,{active:!0,style:{padding:i.paddingContentVerticalLG}}),children:(0,g.jsx)(te,{})}):null]})}}}]);
//# sourceMappingURL=618.13234301.chunk.js.map