"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[9312],{90139:(e,a,l)=>{l.d(a,{A:()=>k});var n=l(30032),o=l(83468),i=l(41679),t=l(59723),s=l(29871),r=l(81638),u=l(78074),d=l(20307),c=l(89146),p=l(45901),m=l.n(p),_=l(76998),g=l(77678),y=l(91560),v=l(23446);const k=e=>{let{autoSelectType:a,showUsageStatus:l,value:p,onChange:k,defaultValue:h,searchValue:f,onSearch:x,...S}=e;const{t:b}=(0,g.Bd)(),j=(0,t.useShadowRoot)(),A=(0,o.CX)(),{data:F,isLoading:w}=(0,y.useQuery)("vhostInfo",(()=>A.vfolder.list_hosts())),[q,P]=(0,i.A)({value:p,onChange:k,defaultValue:h}),[K,Q]=(0,i.A)({value:f,onChange:x});return(0,_.useEffect)((()=>{var e,l,n;if(!a)return;let o=null!==(e=null!==(l=null===F||void 0===F?void 0:F.default)&&void 0!==l?l:null===F||void 0===F?void 0:F.allowed[0])&&void 0!==e?e:"";if("usage"===a){var i;o=(null===(i=m().minBy(m().map(null===F||void 0===F?void 0:F.allowed,(e=>{var a;return{host:e,volume_info:null===F||void 0===F||null===(a=F.volume_info)||void 0===a?void 0:a[e]}})),"volume_info.usage.percentage"))||void 0===i?void 0:i.host)||o}P(o,{id:o,...(null===F||void 0===F||null===(n=F.volume_info)||void 0===n?void 0:n[o])||{}})}),[F]),(0,v.jsx)(u.A,{filterOption:!0,placeholder:b("data.SelectStorageHost"),loading:w,style:{minWidth:165},value:q,onChange:e=>{var a;P(e,{id:e,...(null===F||void 0===F||null===(a=F.volume_info)||void 0===a?void 0:a[e])||{}})},searchValue:K,onSearch:Q,optionLabelProp:"value",options:m().map(null===F||void 0===F?void 0:F.allowed,(e=>{var a,o,i,t,u,p,m,_;return{label:l?(0,v.jsxs)(s.A,{align:"center",gap:"xs",children:[(null===F||void 0===F||null===(a=F.volume_info)||void 0===a||null===(o=a[e])||void 0===o?void 0:o.usage)&&(0,v.jsx)(d.A,{title:"".concat(b("data.Host")," ").concat(b("data.usage.Status"),":\n                ").concat((null===F||void 0===F||null===(i=F.volume_info[e])||void 0===i||null===(t=i.usage)||void 0===t?void 0:t.percentage)<70?b("data.usage.Adequate"):(null===F||void 0===F||null===(u=F.volume_info[e])||void 0===u||null===(p=u.usage)||void 0===p?void 0:p.percentage)<90?b("data.usage.Caution"):b("data.usage.Insufficient")),getPopupContainer:()=>j,children:(0,v.jsx)(c.A,{color:(0,n.yc)(null===F||void 0===F||null===(m=F.volume_info[e])||void 0===m||null===(_=m.usage)||void 0===_?void 0:_.percentage)})}),(0,v.jsx)(r.A,{keyword:K,children:e})]}):e,value:e}})),...S})}},99312:(e,a,l)=>{l.r(a),l.d(a,{StorageStatusPanelFallback:()=>Q,default:()=>L});var n,o=l(30032),i=l(83468),t=l(96495),s=l(29871),r=l(36009),u=l(90139),d=l(50840),c=l(34626),p=l(97080),m=l(76998),_=l(77678),g=l(3606),y=l(23446);const v=e=>{var a,i,t,r,u;let{usageProgressFrgmt:m}=e;const{t:v}=(0,_.Bd)(),{token:k}=d.A.useToken(),h=(0,g.useFragment)(void 0!==n?n:n=l(32895),m),f=parseFloat(null===h||void 0===h||null===(a=h.details)||void 0===a?void 0:a.usage_bytes)||0,x=parseFloat(null===h||void 0===h||null===(i=h.details)||void 0===i?void 0:i.hard_limit_bytes)||0,S=x>0?null===(t=f/x*100)||void 0===t?void 0:t.toFixed(2):0;return(0,y.jsxs)(s.A,{direction:"column",children:[(0,y.jsx)(c.A,{size:[180,15],percent:S,strokeColor:(0,o.yc)(S),status:S>=100?"exception":"normal"}),(0,y.jsxs)(s.A,{direction:"row",gap:k.marginXXS,style:{fontSize:12},children:[(0,y.jsxs)(p.A.Text,{type:"secondary",style:{fontSize:12},children:[v("data.Used"),":"]}),(0,o.wb)(null===h||void 0===h||null===(r=h.details)||void 0===r?void 0:r.usage_bytes)," GB",(0,y.jsx)(p.A.Text,{type:"secondary",style:{fontSize:12},children:" / "}),(0,y.jsxs)(p.A.Text,{type:"secondary",style:{fontSize:12},children:[v("data.Limit"),":"]}),(0,o.wb)(null===h||void 0===h||null===(u=h.details)||void 0===u?void 0:u.hard_limit_bytes)," GB"]})]})};var k,h,f=l(2292),x=l(64283),S=l(20307),b=l(6932),j=l(63214),A=l(29475),F=l(22307),w=l(35184),q=l(45901),P=l.n(q),K=l(91560);const Q=()=>{const{t:e}=(0,_.Bd)();return(0,y.jsx)(A.A,{size:"small",title:e("data.StorageStatus"),children:(0,y.jsx)(w.A,{active:!0})})},L=e=>{var a,n;let{fetchKey:w}=e;const{t:q}=(0,_.Bd)(),{token:Q}=d.A.useToken(),L=(0,i.CX)(),T=(0,t.hd)(),[V,$]=(0,m.useState)(),C=(0,m.useDeferredValue)(V),D=(0,m.useDeferredValue)(w),R=e=>P().includes(["delete-ongoing","delete-complete","delete-error"],e),{data:U}=(0,K.useQuery)(["vfolders",{deferredFetchKey:D}],(()=>L.vfolder.list(null===T||void 0===T?void 0:T.id))),z=null===U||void 0===U?void 0:U.filter((e=>e.is_owner&&"user"===e.ownership_type&&!R(e.status))).length,N=null===U||void 0===U?void 0:U.filter((e=>"group"===e.ownership_type&&!R(e.status))).length,B=null===U||void 0===U?void 0:U.filter((e=>!e.is_owner&&"user"===e.ownership_type&&!R(e.status))).length,{keypair:X,user:I}=(0,g.useLazyLoadQuery)(void 0!==k?k:k=l(69689),{domain_name:(0,i.eZ)(),email:null===L||void 0===L?void 0:L.email,access_key:null===L||void 0===L?void 0:L._config.accessKey}),{user_resource_policy:E,keypair_resource_policy:H,project_quota_scope:O,user_quota_scope:W}=(0,g.useLazyLoadQuery)(void 0!==h?h:h=l(80648),{user_RP_name:null===I||void 0===I?void 0:I.resource_policy,keypair_resource_policy_name:null===X||void 0===X?void 0:X.resource_policy,project_quota_scope_id:(0,o.sZ)("project",null===T||void 0===T?void 0:T.id),user_quota_scope_id:(0,o.sZ)("user",(null===I||void 0===I?void 0:I.id)||""),storage_host_name:(null===C||void 0===C?void 0:C.id)||"",skipQuotaScope:void 0===(null===T||void 0===T?void 0:T.id)||void 0===(null===I||void 0===I?void 0:I.id)||!(null!==C&&void 0!==C&&C.id)});let Z;Z=null!==L&&void 0!==L&&L.supports("max-vfolder-count-in-user-and-project-resource-policy")?(null===E||void 0===E?void 0:E.max_vfolder_count)||0:(null===H||void 0===H?void 0:H.max_vfolder_count)||0;const G=Z||0===Z?Z>0?null===(a=z/Z*100)||void 0===a?void 0:a.toFixed(2):0:null,M=[{key:"totalFolders",label:q("data.NumberOfFolders"),children:(0,y.jsxs)(y.Fragment,{children:[G||0===G?(0,y.jsx)(c.A,{size:[200,15],percent:G,strokeColor:(0,o.yc)(G),style:{width:"95%"},status:G>=100?"exception":"normal"}):null,(0,y.jsxs)(s.A,{direction:"row",gap:Q.marginXXS,wrap:"wrap",children:[(0,y.jsxs)(p.A.Text,{type:"secondary",children:[q("data.Created"),":"]}),z,Z||0===Z?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(p.A.Text,{type:"secondary",children:" / "}),(0,y.jsxs)(p.A.Text,{type:"secondary",children:[q("data.Limit"),":"]}),0===Z?"\u221e":Z]}):null]}),(0,y.jsx)(x.A,{style:{margin:"12px auto"}}),(0,y.jsxs)(s.A,{direction:"row",wrap:"wrap",justify:"between",children:[(0,y.jsxs)(s.A,{gap:Q.marginXXS,children:[(0,y.jsxs)(p.A.Text,{type:"secondary",children:[q("data.ProjectFolder"),":"]}),N]}),(0,y.jsxs)(s.A,{gap:Q.marginXXS,style:{marginRight:30},children:[(0,y.jsxs)(p.A.Text,{type:"secondary",children:[q("data.Invited"),":"]}),B]})]})]})},{key:"quotaPerStorageVolume",label:(0,y.jsxs)("div",{children:[q("data.QuotaPerStorageVolume"),(0,y.jsx)(S.A,{title:q("data.HostDetails"),children:(0,y.jsx)(b.Ay,{type:"link",icon:(0,y.jsx)(f.A,{})})})]}),children:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(s.A,{wrap:"wrap",justify:"between",direction:"row",style:{minWidth:"25vw"},children:[(0,y.jsx)(p.A.Text,{type:"secondary",children:q("data.Host")}),(0,y.jsx)(u.A,{value:null===V||void 0===V?void 0:V.id,onChange:(e,a)=>{$(a)},autoSelectType:"usage",showUsageStatus:!0,showSearch:!0,allowClear:!0})]}),V!==C?(0,y.jsx)(r.A,{style:{minHeight:120}}):null!==V&&void 0!==V&&null!==(n=V.capabilities)&&void 0!==n&&n.includes("quota")?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(s.A,{style:{margin:"15px auto"},justify:"between",wrap:"wrap",children:[(0,y.jsxs)(p.A.Text,{type:"secondary",style:{wordBreak:"keep-all",wordWrap:"break-word"},children:[q("data.Project"),(0,y.jsx)("br",{}),"(",null===T||void 0===T?void 0:T.name,")"]}),(0,y.jsx)(v,{usageProgressFrgmt:O||null})]}),(0,y.jsxs)(s.A,{justify:"between",wrap:"wrap",children:[(0,y.jsxs)(p.A.Text,{type:"secondary",style:{wordBreak:"keep-all",wordWrap:"break-word"},children:[q("data.User"),(0,y.jsx)("br",{}),"(",null===L||void 0===L?void 0:L.email,")"]}),(0,y.jsx)(v,{usageProgressFrgmt:W||null})]})]}):(0,y.jsx)(j.A,{image:j.A.PRESENTED_IMAGE_SIMPLE,description:q("storageHost.QuotaDoesNotSupported"),style:{margin:"25px auto"}})]})},{key:"userQuotaScopeId",label:q("data.userQuotaScopeId"),children:(0,y.jsx)(p.A.Text,{copyable:!0,children:(0,o.sZ)("user",(null===I||void 0===I?void 0:I.id)||"")})}];return(0,y.jsx)(A.A,{size:"small",title:q("data.StorageStatus"),children:(0,y.jsx)(F.A,{bordered:!0,column:{xxl:2,xl:2,lg:2,md:1,sm:1,xs:1},size:"small",items:M})})}},69689:(e,a,l)=>{l.r(a),l.d(a,{default:()=>o});const n=function(){var e={defaultValue:null,kind:"LocalArgument",name:"access_key"},a={defaultValue:null,kind:"LocalArgument",name:"domain_name"},l={defaultValue:null,kind:"LocalArgument",name:"email"},n={kind:"Variable",name:"domain_name",variableName:"domain_name"},o=[{kind:"Variable",name:"access_key",variableName:"access_key"},n],i={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:[n,{kind:"Variable",name:"email",variableName:"email"}],concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,i],storageKey:null};return{fragment:{argumentDefinitions:[e,a,l],kind:"Fragment",metadata:null,name:"StorageStatusPanelKeypairQuery",selections:[{alias:null,args:o,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[i],storageKey:null},s],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,l,e],kind:"Operation",name:"StorageStatusPanelKeypairQuery",selections:[{alias:null,args:o,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[i,t],storageKey:null},s]},params:{cacheID:"95e9a2aff9ba76edfc0781be14e9263f",id:null,metadata:{},name:"StorageStatusPanelKeypairQuery",operationKind:"query",text:'query StorageStatusPanelKeypairQuery(\n  $domain_name: String\n  $email: String\n  $access_key: String\n) {\n  keypair(domain_name: $domain_name, access_key: $access_key) {\n    resource_policy\n    id\n  }\n  user(domain_name: $domain_name, email: $email) {\n    id\n    resource_policy @since(version: "23.09.0")\n  }\n}\n'}}}();n.hash="356fec51b64103fba9f667dba1713774";const o=n},80648:(e,a,l)=>{l.r(a),l.d(a,{default:()=>o});const n=function(){var e={defaultValue:null,kind:"LocalArgument",name:"keypair_resource_policy_name"},a={defaultValue:null,kind:"LocalArgument",name:"project_quota_scope_id"},l={defaultValue:null,kind:"LocalArgument",name:"skipQuotaScope"},n={defaultValue:null,kind:"LocalArgument",name:"storage_host_name"},o={defaultValue:null,kind:"LocalArgument",name:"user_RP_name"},i={defaultValue:null,kind:"LocalArgument",name:"user_quota_scope_id"},t=[{kind:"Variable",name:"name",variableName:"user_RP_name"}],s={alias:null,args:null,kind:"ScalarField",name:"max_vfolder_count",storageKey:null},r=[s],u={alias:null,args:[{kind:"Variable",name:"name",variableName:"keypair_resource_policy_name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:r,storageKey:null},d={kind:"Variable",name:"storage_host_name",variableName:"storage_host_name"},c=[{kind:"Variable",name:"quota_scope_id",variableName:"project_quota_scope_id"},d],p=[{args:null,kind:"FragmentSpread",name:"UsageProgressFragment_usageFrgmt"}],m=[{kind:"Variable",name:"quota_scope_id",variableName:"user_quota_scope_id"},d],_={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},g=[{alias:null,args:null,concreteType:"QuotaDetails",kind:"LinkedField",name:"details",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"usage_bytes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hard_limit_bytes",storageKey:null}],storageKey:null},_];return{fragment:{argumentDefinitions:[e,a,l,n,o,i],kind:"Fragment",metadata:null,name:"StorageStatusPanelQuery",selections:[{alias:null,args:t,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policy",plural:!1,selections:r,storageKey:null},u,{condition:"skipQuotaScope",kind:"Condition",passingValue:!1,selections:[{alias:"project_quota_scope",args:c,concreteType:"QuotaScope",kind:"LinkedField",name:"quota_scope",plural:!1,selections:p,storageKey:null},{alias:"user_quota_scope",args:m,concreteType:"QuotaScope",kind:"LinkedField",name:"quota_scope",plural:!1,selections:p,storageKey:null}]}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[o,e,a,i,n,l],kind:"Operation",name:"StorageStatusPanelQuery",selections:[{alias:null,args:t,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policy",plural:!1,selections:[s,_],storageKey:null},u,{condition:"skipQuotaScope",kind:"Condition",passingValue:!1,selections:[{alias:"project_quota_scope",args:c,concreteType:"QuotaScope",kind:"LinkedField",name:"quota_scope",plural:!1,selections:g,storageKey:null},{alias:"user_quota_scope",args:m,concreteType:"QuotaScope",kind:"LinkedField",name:"quota_scope",plural:!1,selections:g,storageKey:null}]}]},params:{cacheID:"05f25e3d87206ea4625cbb9710803f87",id:null,metadata:{},name:"StorageStatusPanelQuery",operationKind:"query",text:'query StorageStatusPanelQuery(\n  $user_RP_name: String\n  $keypair_resource_policy_name: String\n  $project_quota_scope_id: String!\n  $user_quota_scope_id: String!\n  $storage_host_name: String!\n  $skipQuotaScope: Boolean!\n) {\n  user_resource_policy(name: $user_RP_name) @since(version: "23.09.6") {\n    max_vfolder_count\n    id\n  }\n  keypair_resource_policy(name: $keypair_resource_policy_name) @deprecatedSince(version: "23.09.4") {\n    max_vfolder_count\n  }\n  project_quota_scope: quota_scope(quota_scope_id: $project_quota_scope_id, storage_host_name: $storage_host_name) @skip(if: $skipQuotaScope) {\n    ...UsageProgressFragment_usageFrgmt\n    id\n  }\n  user_quota_scope: quota_scope(quota_scope_id: $user_quota_scope_id, storage_host_name: $storage_host_name) @skip(if: $skipQuotaScope) {\n    ...UsageProgressFragment_usageFrgmt\n    id\n  }\n}\n\nfragment UsageProgressFragment_usageFrgmt on QuotaScope {\n  details {\n    usage_bytes\n    hard_limit_bytes\n  }\n}\n'}}}();n.hash="d68618805bf1551f1c28d57c12276539";const o=n},32895:(e,a,l)=>{l.r(a),l.d(a,{default:()=>o});const n={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UsageProgressFragment_usageFrgmt",selections:[{alias:null,args:null,concreteType:"QuotaDetails",kind:"LinkedField",name:"details",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"usage_bytes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hard_limit_bytes",storageKey:null}],storageKey:null}],type:"QuotaScope",abstractKey:null,hash:"1ba87b250f2a0161ecee7ba88d54c85c"},o=n}}]);
//# sourceMappingURL=9312.bc639c81.chunk.js.map