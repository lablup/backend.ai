"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[217],{37007:function(e,n,i){var l=i(99277),r=i(82548),t=i(32048),o=i.n(t),a=i(4519),s=i(2556);n.Z=function(e){var n,i=e.values,t=void 0===i?[]:i;return 0===t.length?null:(n=t[0]&&("string"===typeof t[0]||a.isValidElement(t[0]))?t.map((function(e){return{label:e,color:"blue"}})):t,(0,s.jsx)(l.Z,{direction:"row",children:o().map(n,(function(e,i){return(0,s.jsx)(r.Z,{style:o().last(n)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:e.label},i)}))}))}},34341:function(e,n,i){var l,r=i(84506),t=i(29439),o=i(87760),a=i(37007),s=i(99277),u=i(14001),d=i(91278),c=i(57054),m=i(44036),v=i(19427),g=i(82548),f=i(83799),p=i(38818),h=i(32048),y=i.n(h),x=i(4519),Z=i(81748),j=i(16980),b=i(2556),w=function(e){return e?"".concat(e.registry,"/").concat(e.name,":").concat(e.tag,"@").concat(e.architecture):void 0};n.Z=function(e){var n,h=e.filter,k=e.showPrivate;(0,o.Dj)();var F=c.Z.useFormInstance();c.Z.useWatch("environments",{form:F,preserve:!0});var S=(0,x.useState)(""),_=(0,t.Z)(S,2),I=_[0],P=_[1],N=(0,x.useState)(""),V=(0,t.Z)(N,2),E=V[0],G=V[1],K=(0,Z.$G)().t,T=(0,o.dS)(),z=(0,t.Z)(T,2),L=z[0],U=z[1].getImageMeta,M=m.Z.useToken().token,q=(0,x.useRef)(null),B=(0,x.useRef)(null),C=(0,j.useLazyLoadQuery)(void 0!==l?l:l=i(71947),{installed:!0},{fetchPolicy:"store-and-network"}).images;(0,x.useEffect)((function(){var e,n,i,l,r,t=(null===(e=F.getFieldValue("environments"))||void 0===e?void 0:e.environment)||(null===(n=A[0])||void 0===n||null===(i=n.environmentGroups[0])||void 0===i?void 0:i.environmentName);if(y().find(A,(function(e){return y().find(e.environmentGroups,(function(e){return e.environmentName===t&&(r=e,!0)}))})),!y().find(null===(l=r)||void 0===l?void 0:l.images,(function(e){var n;return(null===(n=F.getFieldValue("environments"))||void 0===n?void 0:n.version)===w(e)}))){var o,a=null===(o=r)||void 0===o?void 0:o.images[0];a&&F.setFieldsValue({environments:{environment:t,version:w(a),image:a}})}}),[null===(n=F.getFieldValue("environments"))||void 0===n?void 0:n.environment]);var A=(0,x.useMemo)((function(){return y().chain(C).filter((function(e){return(!!k||!function(e){return y().some(null===e||void 0===e?void 0:e.labels,(function(e){var n;return"ai.backend.features"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.split(" ").includes("private"))}))}(e))&&(!h||h(e))})).groupBy((function(e){var n;return(null===L||void 0===L||null===(n=L.imageInfo[U(w(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map((function(e,n){return{groupName:n,environmentGroups:y().chain(e).groupBy((function(e){return null===e||void 0===e?void 0:e.name})).map((function(e,n){var i,l,r;return{environmentName:n,displayName:(null===L||void 0===L||null===(i=L.imageInfo[null===(l=n.split("/"))||void 0===l?void 0:l[1]])||void 0===i?void 0:i.name)||n,prefix:null===(r=n.split("/"))||void 0===r?void 0:r[0],images:e.sort((function(e,n){var i,l,r,t,o,a;return function(e,n){for(var i=e.split(".").map(Number),l=n.split(".").map(Number),r=0;r<Math.max(i.length,l.length);r++){var t=i[r]||0,o=l[r]||0;if(t>o)return 1;if(t<o)return-1}return 0}(null!==(i=null===n||void 0===n||null===(l=n.tag)||void 0===l||null===(r=l.split("-"))||void 0===r?void 0:r[0])&&void 0!==i?i:"",null!==(t=null===e||void 0===e||null===(o=e.tag)||void 0===o||null===(a=o.split("-"))||void 0===a?void 0:a[0])&&void 0!==t?t:"")}))}})).sortBy((function(e){return e.displayName})).value()}})).sortBy((function(e){return e.groupName})).value()}),[C,L,h,k]),O=(0,x.useMemo)((function(){var e,n;return I.length&&y().chain(A.flatMap((function(e){return e.environmentGroups})).find((function(i){return n=i,!!(e=y().find(i.images,(function(e){return w(e)===I})))}))).value(),{fullNameMatchedImage:e,fullNameMatchedImageGroup:n}}),[I,A]),R=O.fullNameMatchedImage;return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(c.Z.Item,{name:["environments","environment"],label:"".concat(K("session.launcher.Environments")," / ").concat(K("session.launcher.Version")),rules:[{required:!0}],style:{marginBottom:10},children:(0,b.jsx)(v.Z,{ref:q,showSearch:!0,labelInValue:!1,searchValue:I,onSearch:P,defaultActiveFirstOption:!0,optionLabelProp:"label",optionFilterProp:"filterValue",onChange:function(e){R&&F.setFieldsValue({environments:{environment:(null===R||void 0===R?void 0:R.name)||"",version:w(R),image:R}})},children:R?(0,b.jsx)(v.Z.Option,{value:null===R||void 0===R?void 0:R.name,filterValue:w(R),children:(0,b.jsxs)(s.Z,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,b.jsx)(u.Z,{image:w(R)||"",style:{width:15,height:15}}),w(R)]})}):y().map(A,(function(e){return(0,b.jsx)(v.Z.OptGroup,{label:e.groupName,children:y().map(e.environmentGroups,(function(e){var n,i=e.images[0],l=null===L||void 0===L?void 0:L.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[1]],r=[],t=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(r.push(e.prefix),t=(0,b.jsx)(g.Z,{color:"purple",children:(0,b.jsx)(d.Z,{keyword:I,children:e.prefix})}));var o=y().map(null===l||void 0===l?void 0:l.label,(function(e){return y().isUndefined(e.category)&&e.tag&&e.color?(r.push(e.tag),(0,b.jsx)(g.Z,{color:e.color,children:(0,b.jsx)(d.Z,{keyword:I,children:e.tag},e.tag)},e.tag)):null}));return(0,b.jsx)(v.Z.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+r.join("\t"),label:(0,b.jsxs)(s.Z,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,b.jsx)(u.Z,{image:w(i)||"",style:{width:15,height:15}}),e.displayName]}),children:(0,b.jsxs)(s.Z,{direction:"row",justify:"between",children:[(0,b.jsxs)(s.Z,{direction:"row",align:"center",gap:"xs",children:[(0,b.jsx)(u.Z,{image:w(i)||"",style:{width:15,height:15}}),(0,b.jsx)(d.Z,{keyword:I,children:e.displayName})]}),t,o]})},e.environmentName)}))},e.groupName)}))})}),(0,b.jsx)(c.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,l;return(null===(i=e.environments)||void 0===i?void 0:i.environment)!==(null===(l=n.environments)||void 0===l?void 0:l.environment)},children:function(e){var n,i,l=e.getFieldValue;return y().find(A,(function(e){return y().find(e.environmentGroups,(function(e){var n;return e.environmentName===(null===(n=l("environments"))||void 0===n?void 0:n.environment)&&(i=e,!0)}))})),(0,b.jsx)(c.Z.Item,{name:["environments","version"],rules:[{required:!0}],children:(0,b.jsx)(v.Z,{ref:B,onChange:function(e){var n=y().find(C,(function(n){return w(n)===e}));F.setFieldValue(["environments","image"],n)},showSearch:!0,searchValue:E,onSearch:G,optionFilterProp:"filterValue",optionLabelProp:"label",dropdownRender:function(e){return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(s.Z,{style:{fontWeight:M.fontWeightStrong,paddingLeft:M.paddingSM},children:[K("session.launcher.Version"),(0,b.jsx)(f.Z,{type:"vertical"}),K("session.launcher.Base"),(0,b.jsx)(f.Z,{type:"vertical"}),K("session.launcher.Architecture"),(0,b.jsx)(f.Z,{type:"vertical"}),K("session.launcher.Requirements")]}),(0,b.jsx)(f.Z,{style:{margin:"8px 0"}}),e]})},children:y().map(y().uniqBy(null===(n=i)||void 0===n?void 0:n.images,"digest"),(function(e){var n,i=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""],l=(0,r.Z)(i),o=l[0],u=l[1],c=l.slice(2),m=null===L||void 0===L?void 0:L.tagAlias[u];if(!m){for(var g=0,p=Object.entries((null===L||void 0===L?void 0:L.tagReplace)||{});g<p.length;g++){var h=(0,t.Z)(p[g],2),x=h[0],Z=h[1],j=new RegExp(x);j.test(u)&&(m=null===u||void 0===u?void 0:u.replace(j,Z))}m||(m=u)}var k=[],F=c.length>0?(0,b.jsx)(s.Z,{direction:"row",wrap:"wrap",style:{flex:1},gap:"xxs",children:y().map(c,(function(e,n){var i;return(0,b.jsx)(a.Z,{values:(null===L||void 0===L||null===(i=L.tagAlias[e])||void 0===i?void 0:i.split(":").map((function(e){return k.push(e),(0,b.jsx)(d.Z,{keyword:E,children:e},e)})))||c},n)}))}):"-";return(0,b.jsx)(v.Z.Option,{value:w(e),filterValue:[o,m,null===e||void 0===e?void 0:e.architecture].concat(k).join("\t"),label:[o,m,null===e||void 0===e?void 0:e.architecture,c.length>0?c.join(", "):"-"].join(" | "),children:(0,b.jsxs)(s.Z,{direction:"row",children:[(0,b.jsx)(d.Z,{keyword:E,children:o}),(0,b.jsx)(f.Z,{type:"vertical"}),(0,b.jsx)(d.Z,{keyword:E,children:m}),(0,b.jsx)(f.Z,{type:"vertical"}),(0,b.jsx)(d.Z,{keyword:E,children:null===e||void 0===e?void 0:e.architecture}),(0,b.jsx)(f.Z,{type:"vertical"}),F]})},null===e||void 0===e?void 0:e.digest)}))})})}}),(0,b.jsx)(c.Z.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,b.jsx)(p.Z,{})})]})}},14001:function(e,n,i){var l=i(1413),r=i(29439),t=i(87760),o=i(4519),a=i(2556),s=function(e,n){var i=e.image,o=e.style,s=void 0===o?{}:o,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=(0,t.dS)(),c=(0,r.Z)(d,2)[1].getImageIcon;return(0,a.jsx)("img",{src:c(i),style:(0,l.Z)({width:"1em",height:"1em"},s),alt:u})};n.Z=o.memo(s)},96732:function(e,n,i){i.d(n,{Ec:function(){return v}});var l=i(44925),r=i(1413),t=i(43255),o=i(99277),a=i(44036),s=i(28499),u=i(227),d=(i(4519),i(81748)),c=i(2556),m=["type","size","showIcon","showUnit","showTooltip"],v={"cuda.device":"GPU","cuda.shares":"FGPU","rocm.device":"GPU","tpu.device":"TPU","ipu.device":"IPU","atom.device":"ATOM","warboy.device":"Warboy"},g=function(e){var n=e.size,i=void 0===n?16:n,l=e.children;return(0,c.jsx)("mwc-icon",{style:{"--mdc-icon-size":"".concat(i+2,"px"),width:i,height:i},children:l})},f=function(e){var n,i,t,a=e.type,s=e.size,v=void 0===s?16:s,f=(e.showIcon,e.showUnit,e.showTooltip),p=void 0===f||f,h=(0,l.Z)(e,m),y=(0,d.$G)().t,x={cpu:[(0,c.jsx)(g,{size:v,children:"developer_board"}),y("session.core")],mem:[(0,c.jsx)(g,{size:v,children:"memory"}),"GiB"],"cuda.device":["/resources/icons/file_type_cuda.svg","GPU"],"cuda.shares":["/resources/icons/file_type_cuda.svg","FGPU"],"rocm.device":["/resources/icons/ROCm.png","GPU"],"tpu.device":[(0,c.jsx)(g,{size:v,children:"view_module"}),"TPU"],"ipu.device":[(0,c.jsx)(g,{size:v,children:"view_module"}),"IPU"],"atom.device":["/resources/icons/rebel.svg","ATOM"],"warboy.device":["/resources/icons/furiosa.svg","Warboy"]},Z="string"===typeof(null===(n=x[a])||void 0===n?void 0:n[0])?(0,c.jsx)("img",(0,r.Z)((0,r.Z)({},h),{},{style:(0,r.Z)({height:v,alignSelf:"center"},h.style||{}),src:(null===(i=x[a])||void 0===i?void 0:i[0])||"",alt:a})):(0,c.jsx)(o.Z,{style:{width:16,height:16},children:(null===(t=x[a])||void 0===t?void 0:t[0])||a});return p?(0,c.jsx)(u.Z,{title:a,children:Z}):(0,c.jsx)(o.Z,{style:{pointerEvents:"none"},children:Z})};n.ZP=function(e){var n,i,l=e.type,u=e.value,m=e.extra,g=e.opts,p=e.hideTooltip,h=void 0!==p&&p,y=(0,d.$G)().t,x=a.Z.useToken().token,Z=(0,r.Z)({cpu:y("session.core"),mem:"GiB"},v);return(0,c.jsxs)(o.Z,{direction:"row",gap:"xxs",children:[(0,c.jsx)(f,{type:l,showTooltip:!h}),(0,c.jsx)(s.Z.Text,{children:"GiB"===Z[l]?Number(null===(n=(0,t.PZ)(u+"b","g",3))||void 0===n?void 0:n.numberFixed).toString():"FGPU"===Z[l]?parseFloat(u).toFixed(2):u}),(0,c.jsx)(s.Z.Text,{type:"secondary",children:Z[l]}),"mem"===l&&null!==g&&void 0!==g&&g.shmem&&(null===g||void 0===g?void 0:g.shmem)>0?(0,c.jsxs)(s.Z.Text,{type:"secondary",style:{fontSize:x.fontSizeSM},children:["(SHM: ",null===(i=(0,t.PZ)(g.shmem+"b","g",2))||void 0===i?void 0:i.numberFixed,"GiB)"]}):null,m]})}},99695:function(e,n,i){var l=i(1413),r=i(44925),t=i(99277),o=i(57054),a=i(31603),s=i(66653),u=(i(4519),i(2556)),d=["name","min","max","step","rules","required","inputNumberProps","sliderProps","initialValue","disabled"];n.Z=function(e){var n=e.name,i=e.min,c=e.max,m=e.step,v=e.rules,g=e.required,f=e.inputNumberProps,p=e.sliderProps,h=e.initialValue,y=e.disabled,x=(0,r.Z)(e,d);return(0,u.jsx)(o.Z.Item,(0,l.Z)((0,l.Z)({required:g},x),{},{children:(0,u.jsxs)(t.Z,{direction:"row",gap:"md",children:[(0,u.jsx)(t.Z,{direction:"column",align:"stretch",style:{flex:3},children:(0,u.jsx)(o.Z.Item,{name:n,noStyle:!0,rules:v,initialValue:h,label:x.label,children:(0,u.jsx)(a.Z,(0,l.Z)({max:c,min:i,step:m,disabled:y},p))})}),(0,u.jsx)(t.Z,{style:{flex:2,minWidth:130},align:"stretch",direction:"column",children:(0,u.jsx)(o.Z.Item,{name:n,noStyle:!0,rules:v,initialValue:h,label:x.label,children:(0,u.jsx)(s.Z,(0,l.Z)({max:c,min:i,step:m,onStep:function(e,n){console.log(e,n)},disabled:y},f))})})]})}))}},91278:function(e,n,i){var l=i(1413),r=i(44036),t=(i(4519),i(2556));n.Z=function(e){var n=e.children,i=e.keyword,o=e.style;if(!n)return null;var a=n.toLowerCase().indexOf(null===i||void 0===i?void 0:i.toLowerCase()),s=(r.Z.useToken()||"#F1A239").token;return a>=0?(0,t.jsxs)("span",{children:[n.substring(0,a),(0,t.jsx)("span",{style:(0,l.Z)({backgroundColor:s.colorWarningHover},o),children:n.substring(a,a+i.length)}),n.substring(a+i.length)]}):(0,t.jsx)("span",{children:n})}},71947:function(e,n,i){i.r(n);var l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},i=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:i,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:i},params:{cacheID:"ea71f4a3948d4742dd6bb11ef80a8300",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:"query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    name\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n  }\n}\n"}}}();l.hash="33367bd6e1532b42b61629ef9d3dc46b",n.default=l},1839:function(e,n,i){i.d(n,{T6:function(){return c},jC:function(){return m}});var l=i(1413),r=i(29439),t=i(87760),o=i(43255),a=i(50164),s=i(32048),u=i.n(s),d=i(4519),c=function(){var e=(0,t.Kr)("first"),n=(0,r.Z)(e,2),i=n[0],l=n[1],o=(0,t.Dj)();return[(0,a.h)({queryKey:["useResourceSlots",i],queryFn:function(){return o.get_resource_slots()},staleTime:0}).data,{refresh:function(){return l()}}]},m=function(){var e=(0,t.Dj)(),n=(0,d.useState)({full_name:e.full_name,email:e.email}),i=(0,r.Z)(n,2),s=i[0],c=i[1];(0,d.useEffect)((function(){var n=function(n){if(e.supports("change-user-name")){var i=n.detail;c((function(e){return(0,l.Z)((0,l.Z)({},e),{},{full_name:i})}))}};return document.addEventListener("current-user-info-changed",n),function(){document.removeEventListener("current-user-info-changed",n)}}),[e]);var m=(0,a.Y)({mutationFn:function(n){return e.update_full_name(n.email,n.full_name)}}),v=(0,a.Y)({mutationFn:function(n){return e.update_password(n.old_password,n.new_password,n.new_password2)}});return[(0,l.Z)((0,l.Z)({},s),{},{username:function(){var n=u().trim(s.full_name).length>0?s.full_name:s.email;if(e._config.maskUserInfo){var i=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(n)?n.split("@")[0].length-2:n.length-2;n=(0,o.Cd)(n,"*",2,i)}return n}(),isPendingMutation:m.isLoading||v.isLoading}),{updateFullName:function(n,i){m.mutate({full_name:n,email:e.email},{onSuccess:function(){(null===i||void 0===i?void 0:i.onSuccess)&&i.onSuccess(n),document.dispatchEvent(new CustomEvent("current-user-info-changed",{detail:n})),c((function(e){return(0,l.Z)((0,l.Z)({},e),{},{full_name:n})}))},onError:function(e){(null===i||void 0===i?void 0:i.onError)&&i.onError(e)}})},updatePassword:function(e,n){v.mutate(e,{onSuccess:function(){(null===n||void 0===n?void 0:n.onSuccess)&&n.onSuccess(void 0)},onError:function(e){(null===n||void 0===n?void 0:n.onError)&&n.onError(e)}})}}]}}}]);
//# sourceMappingURL=217.28d85faf.chunk.js.map