"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[1521,4251],{54251(e,l,n){n.r(l),n.d(l,{default:()=>qe});var a=n(56276),r=n(11863),i=n(7871);const o=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"vfolderGlobalId"}],l=[{kind:"Variable",name:"id",variableName:"vfolderGlobalId"}],n={alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"FolderExplorerModalQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a,r,i,o,t,s,{args:null,kind:"FragmentSpread",name:"FolderExplorerHeaderFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeDescriptionFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"FolderExplorerModalQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a,r,i,o,t,s,{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},i],storageKey:null}]},params:{cacheID:"37f1c759f1e7dddf7b1c090eca2e8860",id:null,metadata:{},name:"FolderExplorerModalQuery",operationKind:"query",text:'query FolderExplorerModalQuery(\n  $vfolderGlobalId: String!\n) {\n  vfolder_node(id: $vfolderGlobalId) {\n    group\n    group_name\n    unmanaged_path @since(version: "25.04.0")\n    permissions\n    host\n    id\n    name\n    ...FolderExplorerHeaderFragment\n    ...VFolderNodeDescriptionFragment\n    ...VFolderNameTitleNodeFragment\n  }\n}\n\nfragment EditableVFolderNameFragment on VirtualFolderNode {\n  id\n  name\n  user\n  group\n  status\n}\n\nfragment FileBrowserButtonFragment on VirtualFolderNode {\n  id\n  host\n}\n\nfragment FolderExplorerHeaderFragment on VirtualFolderNode {\n  id\n  user\n  permission\n  row_id\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderNameTitleNodeFragment\n  ...VFolderNodeIdenticonFragment\n  ...EditableVFolderNameFragment\n  ...FileBrowserButtonFragment\n  ...SFTPServerButtonFragment\n}\n\nfragment SFTPServerButtonFragment on VirtualFolderNode {\n  id\n  row_id\n  host\n}\n\nfragment VFolderNameTitleNodeFragment on VirtualFolderNode {\n  name\n}\n\nfragment VFolderNodeDescriptionFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderPermissionCellFragment\n  ...useVirtualFolderNodePathFragment\n}\n\nfragment VFolderNodeIdenticonFragment on VirtualFolderNode {\n  id\n}\n\nfragment VFolderPermissionCellFragment on VirtualFolderNode {\n  permissions\n}\n\nfragment useVirtualFolderNodePathFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n}\n'}}}();o.hash="bc8ed85ec64ce6416231f71a40388f03";const t=o;var s=n(91521);const d={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FolderExplorerHeaderFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},action:"THROW"},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeIdenticonFragment"},{args:null,kind:"FragmentSpread",name:"EditableVFolderNameFragment"},{args:null,kind:"FragmentSpread",name:"FileBrowserButtonFragment"},{args:null,kind:"FragmentSpread",name:"SFTPServerButtonFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"8c6e3cf5a92c8f51f54f315622c8bb75"},u=d;var c=n(23177),m=n(86752),g=n(20282);const p={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FileBrowserButtonFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"b96df1a5289fd1330848207e43880ddd"},y=p;var v=n(18249),f=n(6836),F=n(81262),h=n(68796),k=n(19847),S=n(55638),x=n(94668),_=n(96337),b=n(47476),K=n.n(b),w=n(32397),j=n(94109),A=n(19869),N=n(45682);const P=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],l={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},n=[l,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:n,storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:n,storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useDefaultImagesWithFallbackQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useDefaultImagesWithFallbackQuery",selections:a},params:{cacheID:"50986f0b2ceaf84de4cd397a2d793329",id:null,metadata:{},name:"useDefaultImagesWithFallbackQuery",operationKind:"query",text:'query useDefaultImagesWithFallbackQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    tag\n    registry\n    architecture\n    name @deprecatedSince(version: "24.12.0")\n    namespace @since(version: "24.12.0")\n    labels {\n      key\n      value\n    }\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    resource_limits {\n      key\n      min\n      max\n    }\n  }\n}\n'}}}();P.hash="10405daea8947c9eb138ed58ff364fe0";const V=P;var T=n(44011),I=n(21507),z=n(86617),E=n(48648);const B=V,O=(0,z.t_)((async()=>{var e,l;const n=await v.VV;return K().isEmpty(null===(e=n._config)||void 0===e?void 0:e.defaultFileBrowserImage)||null===(l=n._config)||void 0===l?void 0:l.defaultFileBrowserImage})),D=(0,z.t_)((async()=>{var e,l;const n=await v.VV;return K().isEmpty(null===(e=n._config)||void 0===e?void 0:e.systemSSHImage)||null===(l=n._config)||void 0===l?void 0:l.systemSSHImage})),C=(0,T.eU)();function R(e){var l;return"ai.backend.service-ports"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l.toLowerCase().includes("filebrowser"))}function H(e){var l;return null===e||void 0===e||null===(l=e.labels)||void 0===l?void 0:l.find(R)}function Q(e){var l;return null===e||void 0===e||null===(l=e.images)||void 0===l?void 0:l.filter(H)}function M(e){var l;return"ai.backend.role"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l.toLowerCase().includes("system"))}function L(e){var l;return null===e||void 0===e||null===(l=e.labels)||void 0===l?void 0:l.find(M)}function q(e){var l;return null===e||void 0===e||null===(l=e.images)||void 0===l?void 0:l.filter(L)}const W=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domainName"},{defaultValue:null,kind:"LocalArgument",name:"projectId"},{defaultValue:null,kind:"LocalArgument",name:"resourcePolicyName"}],l=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domainName"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domainName"},{kind:"Variable",name:"id",variableName:"projectId"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"resourcePolicyName"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:l,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:n,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:n},params:{cacheID:"f7d16150a7d77cb465733a2933a08261",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery(\n  $domainName: String\n  $projectId: UUID!\n  $resourcePolicyName: String\n) {\n  domain(name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  group(id: $projectId, domain_name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $resourcePolicyName) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();W.hash="616594ca9d6c787458c32688c1a25b1f";const U=W,$=function(){var e={defaultValue:null,kind:"LocalArgument",name:"accessKey"},l={defaultValue:null,kind:"LocalArgument",name:"domainName"},n=[{kind:"Variable",name:"access_key",variableName:"accessKey"},{kind:"Variable",name:"domain_name",variableName:"domainName"}],a={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null};return{fragment:{argumentDefinitions:[e,l],kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{kind:"RequiredField",field:{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{kind:"RequiredField",field:a,action:"THROW"}],storageKey:null},action:"THROW"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,e],kind:"Operation",name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"05bd7db7ab185940108fba3f2cadc989",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_KeypairQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_KeypairQuery(\n  $domainName: String\n  $accessKey: String\n) {\n  keypair(domain_name: $domainName, access_key: $accessKey) {\n    resource_policy\n    id\n  }\n}\n"}}}();$.hash="bca5af88ccf1508389ec648bf31c4965";const G=$;var X=n(87272);const Z=(e,l,n)=>{var a,r,i;const o=(0,v.CX)(),{keypair:t}=(0,A.useLazyLoadQuery)(G,{domainName:e,accessKey:n},{fetchPolicy:"store-or-network"}),s=(0,A.useLazyLoadQuery)(U,{domainName:e,projectId:l,resourcePolicyName:null===t||void 0===t?void 0:t.resource_policy},{fetchPolicy:"store-or-network"}),d=JSON.parse((null===s||void 0===s||null===(a=s.domain)||void 0===a?void 0:a.allowed_vfolder_hosts)||"{}"),u=JSON.parse((null===s||void 0===s||null===(r=s.group)||void 0===r?void 0:r.allowed_vfolder_hosts)||"{}"),c=JSON.parse((null===s||void 0===s||null===(i=s.keypair_resource_policy)||void 0===i?void 0:i.allowed_vfolder_hosts)||"{}"),{data:m}=(0,X.U)({queryKey:["vhostInfo"],queryFn:async()=>await o.vfolder.list_hosts(),staleTime:3e5,gcTime:0}),g=Object.assign({},...m.allowed.map((e=>{return{[e]:(l=[d[e],u[e],c[e]],[...new Set([].concat(...l.filter(Boolean)))])};var l})));return{StorageHostPermissionByDomain:d,StorageHostPermissionByGroup:u,StorageHostPermissionByResourcePolicy:c,unitedAllowedPermissionByVolume:g}};var J=n(56496),Y=n(33337);const ee=["showTitle","vfolderFrgmt"],le=e=>{var l;const n=(0,c.c)(61);let i,o,t;if(n[0]!==e){var s=e;({showTitle:o,vfolderFrgmt:t}=s),i=(0,r.A)(s,ee),n[0]=e,n[1]=i,n[2]=o,n[3]=t}else i=n[1],o=n[2],t=n[3];const d=void 0===o||o,{t:u}=(0,j.Bd)(),{message:m,modal:g}=F.A.useApp(),{logger:p}=(0,_.Q7t)(),b=(0,v.f0)(),P=(0,v.CX)(),V=(0,v.eZ)(),T=(0,N.hd)(),z=null===P||void 0===P||null===(l=P._config)||void 0===l?void 0:l.accessKey,{unitedAllowedPermissionByVolume:D}=Z(V,T.id,z),{getErrorMessage:C}=(0,_.B78)(),{startSessionWithDefault:R,upsertSessionNotification:H}=(0,J.G)(),M=(()=>{const e=(0,c.c)(7),[l,n]=(0,I.fp)(O),a=(0,A.useRelayEnvironment)();let r;e[0]!==l||e[1]!==a||e[2]!==n?(r=()=>{void 0===l&&(0,A.fetchQuery)(a,B,{installed:!0},{fetchPolicy:"store-or-network"}).toPromise().then(Q).then((async e=>{const l=K().first(e);n(l?(0,E.A_)(l):null)})).catch((()=>{n(null)}))},e[0]=l,e[1]=a,e[2]=n,e[3]=r):r=e[3];const i=(0,w.useEffectEvent)(r);let o,t;return e[4]!==i?(o=()=>{i()},e[4]=i,e[5]=o):o=e[5],e[6]===Symbol.for("react.memo_cache_sentinel")?(t=[],e[6]=t):t=e[6],(0,w.useEffect)(o,t),l})();let L;n[4]===Symbol.for("react.memo_cache_sentinel")?(L=y,n[4]=L):L=n[4];const q=(0,A.useFragment)(L,t);let W;var U;n[5]!==D||n[6]!==q.host?(W=K().includes(D[null!==(U=null===q||void 0===q?void 0:q.host)&&void 0!==U?U:""],"mount-in-session"),n[5]=D,n[6]=q.host,n[7]=W):W=n[7];const $=W;let G;n[8]!==M||n[9]!==$||n[10]!==d||n[11]!==u?(G=()=>$?null===M?u("data.explorer.NoImagesSupportingFileBrowser"):!d&&M?u("data.explorer.ExecuteFileBrowser"):"":u("data.explorer.NoPermissionToMountFolder"),n[8]=M,n[9]=$,n[10]=d,n[11]=u,n[12]=G):G=n[12];const X=G;let le;n[13]!==M||n[14]!==q.id?(le=()=>({sessionName:"filebrowser-".concat((0,_.omW)(q.id||"")),sessionType:"interactive",environments:{version:M||""},allocationPreset:"minimum-required",cluster_mode:"single-node",cluster_size:1,mount_ids:[(0,_.omW)(q.id||"").replaceAll("-","")]}),n[13]=M,n[14]=q.id,n[15]=le):le=n[15];const ne=le;let ae,re,ie;n[16]!==X?(ae=X(),n[16]=X,n[17]=ae):ae=n[17],n[18]!==M?(re=M?void 0:{filter:"grayscale(100%)"},n[18]=M,n[19]=re):re=n[19],n[20]!==re?(ie=(0,Y.jsx)(h.A,{width:"18px",src:"/resources/icons/filebrowser.svg",alt:"File Browser",preview:!1,style:re}),n[20]=re,n[21]=ie):ie=n[21];const oe=!M||!$;let te,se,de;n[22]!==ne||n[23]!==M||n[24]!==C||n[25]!==p||n[26]!==m||n[27]!==g||n[28]!==R||n[29]!==u||n[30]!==H||n[31]!==q.id?(te=async()=>{if(!M)return;const e=ne();await R(e).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&H(e.fulfilled,[{key:"filebrowser-".concat((0,_.omW)(q.id||"")),extraData:{appName:"filebrowser"}}]),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const l=e.rejected[0].reason;g.error({title:null===l||void 0===l?void 0:l.title,content:C(l)})}})).catch((e=>{p.error("Unexpected error during session creation:",e),m.error(u("error.UnexpectedError"))}))},n[22]=ne,n[23]=M,n[24]=C,n[25]=p,n[26]=m,n[27]=g,n[28]=R,n[29]=u,n[30]=H,n[31]=q.id,n[32]=te):te=n[32],n[33]!==d||n[34]!==u?(se=d&&u("data.explorer.ExecuteFileBrowser"),n[33]=d,n[34]=u,n[35]=se):se=n[35],n[36]!==i||n[37]!==te||n[38]!==se||n[39]!==ie||n[40]!==oe?(de=(0,Y.jsx)(_.Fvl,(0,a.A)((0,a.A)({icon:ie,disabled:oe,action:te},i),{},{children:se})),n[36]=i,n[37]=te,n[38]=se,n[39]=ie,n[40]=oe,n[41]=de):de=n[41];const ue=!M||!$;let ce,me,ge,pe,ye,ve,fe,Fe;return n[42]===Symbol.for("react.memo_cache_sentinel")?(ce=["click"],n[42]=ce):ce=n[42],n[43]!==u?(me=u("import.StartWithOptions"),n[43]=u,n[44]=me):me=n[44],n[45]!==ne||n[46]!==b?(ge=()=>{const e=ne(),l=new URLSearchParams;l.set("formValues",JSON.stringify(e)),l.set("step","4"),b({pathname:"/session/start",search:l.toString()})},n[45]=ne,n[46]=b,n[47]=ge):ge=n[47],n[48]!==me||n[49]!==ge?(pe={items:[{key:"custom",label:me,onClick:ge}]},n[48]=me,n[49]=ge,n[50]=pe):pe=n[50],n[51]===Symbol.for("react.memo_cache_sentinel")?(ye=(0,Y.jsx)(_.Fvl,{icon:(0,Y.jsx)(f.A,{})}),n[51]=ye):ye=n[51],n[52]!==ue||n[53]!==pe?(ve=(0,Y.jsx)(k.A,{disabled:ue,trigger:ce,menu:pe,children:ye}),n[52]=ue,n[53]=pe,n[54]=ve):ve=n[54],n[55]!==de||n[56]!==ve?(fe=(0,Y.jsxs)(S.A.Compact,{children:[de,ve]}),n[55]=de,n[56]=ve,n[57]=fe):fe=n[57],n[58]!==fe||n[59]!==ae?(Fe=(0,Y.jsx)(x.A,{title:ae,children:fe}),n[58]=fe,n[59]=ae,n[60]=Fe):Fe=n[60],Fe},ne={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SFTPServerButtonFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"8bf5b2e08fd923cb5fc74aaa801b7e1f"},ae=ne,re=["showTitle","vfolderFrgmt"],ie=e=>{var l,n;const i=(0,c.c)(67);let o,t,s;if(i[0]!==e){var d=e;({showTitle:t,vfolderFrgmt:s}=d),o=(0,r.A)(d,re),i[0]=e,i[1]=o,i[2]=t,i[3]=s}else o=i[1],t=i[2],s=i[3];const u=void 0===t||t,{logger:m}=(0,_.Q7t)(),{t:g}=(0,j.Bd)(),{message:p,modal:y}=F.A.useApp(),b=(0,v.f0)(),P=(0,v.CX)(),V=(0,v.eZ)(),T=(0,N.hd)(),z=null===P||void 0===P||null===(l=P._config)||void 0===l?void 0:l.accessKey,{unitedAllowedPermissionByVolume:O}=Z(V,T.id,z),{vhostInfo:R}=(0,N.Bk)(),{getErrorMessage:H}=(0,_.B78)(),{startSessionWithDefault:Q,upsertSessionNotification:M}=(0,J.G)(),{systemSSHImage:L}=(()=>{const e=(0,c.c)(11),[l,n]=(0,I.fp)(D),[a,r]=(0,I.fp)(C),i=(0,A.useRelayEnvironment)();let o;e[0]!==i||e[1]!==n||e[2]!==r||e[3]!==l?(o=()=>{void 0===l&&(0,A.fetchQuery)(i,B,{installed:!0},{fetchPolicy:"store-or-network"}).toPromise().then(q).then((async e=>{const l=K().first(e);n(l?(0,E.A_)(l):null),r(l||void 0)})).catch((()=>{n(null)}))},e[0]=i,e[1]=n,e[2]=r,e[3]=l,e[4]=o):o=e[4];const t=(0,w.useEffectEvent)(o);let s,d,u;return e[5]!==t?(s=()=>{t()},e[5]=t,e[6]=s):s=e[6],e[7]===Symbol.for("react.memo_cache_sentinel")?(d=[],e[7]=d):d=e[7],(0,w.useEffect)(s,d),e[8]!==l||e[9]!==a?(u={systemSSHImage:l,systemSSHImageInfo:a},e[8]=l,e[9]=a,e[10]=u):u=e[10],u})();let W;i[4]===Symbol.for("react.memo_cache_sentinel")?(W=ae,i[4]=W):W=i[4];const U=(0,A.useFragment)(W,s),$=null===R||void 0===R||null===(n=R.volume_info[(null===U||void 0===U?void 0:U.host)||""])||void 0===n?void 0:n.sftp_scaling_groups;let G;var X;i[5]!==O||i[6]!==(null===U||void 0===U?void 0:U.host)?(G=K().includes(O[null!==(X=null===U||void 0===U?void 0:U.host)&&void 0!==X?X:""],"mount-in-session"),i[5]=O,i[6]=null===U||void 0===U?void 0:U.host,i[7]=G):G=i[7];const ee=G;let le;i[8]!==ee||i[9]!==$||i[10]!==u||i[11]!==L||i[12]!==g?(le=()=>ee?K().isEmpty($)?g("data.explorer.NoSFTPSupportingScalingGroup"):L?!u&&L?g("data.explorer.RunSSH/SFTPserver"):"":g("data.explorer.NoImagesSupportingSystemSession"):g("data.explorer.NoPermissionToMountFolder"),i[8]=ee,i[9]=$,i[10]=u,i[11]=L,i[12]=g,i[13]=le):le=i[13];const ne=le;let ie;i[14]!==P._config||i[15]!==(null===$||void 0===$?void 0:$[0])||i[16]!==L||i[17]!==(null===U||void 0===U?void 0:U.id)?(ie=()=>{var e,l;return(0,a.A)((0,a.A)({sessionName:"sftp-".concat((0,_.omW)((null===U||void 0===U?void 0:U.id)||"")),sessionType:"system"},null!==(e=P._config)&&void 0!==e&&e.systemSSHImage&&null!==(l=P._config)&&void 0!==l&&l.allow_manual_image_name_for_session?{environments:{manual:P._config.systemSSHImage}}:{environments:{version:L||""}}),{},{cluster_mode:"single-node",cluster_size:1,mount_ids:[(0,_.omW)((null===U||void 0===U?void 0:U.id)||"").replaceAll("-","")],resourceGroup:null===$||void 0===$?void 0:$[0]})},i[14]=P._config,i[15]=null===$||void 0===$?void 0:$[0],i[16]=L,i[17]=null===U||void 0===U?void 0:U.id,i[18]=ie):ie=i[18];const oe=ie;let te,se,de,ue,ce,me,ge,pe,ye,ve,fe,Fe,he,ke,Se;return i[19]!==ne?(te=ne(),i[19]=ne,i[20]=te):te=i[20],i[21]!==ee||i[22]!==$||i[23]!==L?(se=K().isEmpty($)||!L||!ee,i[21]=ee,i[22]=$,i[23]=L,i[24]=se):se=i[24],i[25]===Symbol.for("react.memo_cache_sentinel")?(de=(0,Y.jsx)(h.A,{width:"18px",src:"/resources/icons/sftp.png",alt:"SSH / SFTP",preview:!1}),i[25]=de):de=i[25],i[26]!==oe||i[27]!==H||i[28]!==m||i[29]!==p||i[30]!==y||i[31]!==Q||i[32]!==g||i[33]!==M||i[34]!==(null===U||void 0===U?void 0:U.id)?(ue=async()=>{const e=oe();await Q(e).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&M(e.fulfilled,[{key:"sftp-".concat((0,_.omW)((null===U||void 0===U?void 0:U.id)||""))}]),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const l=e.rejected[0].reason;y.error({title:null===l||void 0===l?void 0:l.title,content:H(l)})}})).catch((e=>{m.error("Unexpected error during session creation:",e),p.error(g("error.UnexpectedError"))}))},i[26]=oe,i[27]=H,i[28]=m,i[29]=p,i[30]=y,i[31]=Q,i[32]=g,i[33]=M,i[34]=null===U||void 0===U?void 0:U.id,i[35]=ue):ue=i[35],i[36]!==u||i[37]!==g?(ce=u&&g("data.explorer.RunSSH/SFTPserver"),i[36]=u,i[37]=g,i[38]=ce):ce=i[38],i[39]!==o||i[40]!==ce||i[41]!==se||i[42]!==ue?(me=(0,Y.jsx)(_.Fvl,(0,a.A)((0,a.A)({disabled:se,icon:de,action:ue},o),{},{children:ce})),i[39]=o,i[40]=ce,i[41]=se,i[42]=ue,i[43]=me):me=i[43],i[44]!==ee||i[45]!==$||i[46]!==L?(ge=K().isEmpty($)||!L||!ee,i[44]=ee,i[45]=$,i[46]=L,i[47]=ge):ge=i[47],i[48]===Symbol.for("react.memo_cache_sentinel")?(pe=["click"],i[48]=pe):pe=i[48],i[49]!==g?(ye=g("import.StartWithOptions"),i[49]=g,i[50]=ye):ye=i[50],i[51]!==oe||i[52]!==b?(ve=()=>{const e=oe(),l=new URLSearchParams;l.set("formValues",JSON.stringify(e)),l.set("step","4"),b({pathname:"/session/start",search:l.toString()})},i[51]=oe,i[52]=b,i[53]=ve):ve=i[53],i[54]!==ye||i[55]!==ve?(fe={items:[{key:"custom",label:ye,onClick:ve}]},i[54]=ye,i[55]=ve,i[56]=fe):fe=i[56],i[57]===Symbol.for("react.memo_cache_sentinel")?(Fe=(0,Y.jsx)(_.Fvl,{icon:(0,Y.jsx)(f.A,{})}),i[57]=Fe):Fe=i[57],i[58]!==ge||i[59]!==fe?(he=(0,Y.jsx)(k.A,{disabled:ge,trigger:pe,menu:fe,children:Fe}),i[58]=ge,i[59]=fe,i[60]=he):he=i[60],i[61]!==me||i[62]!==he?(ke=(0,Y.jsxs)(S.A.Compact,{children:[me,he]}),i[61]=me,i[62]=he,i[63]=ke):ke=i[63],i[64]!==ke||i[65]!==te?(Se=(0,Y.jsx)(x.A,{title:te,children:ke}),i[64]=ke,i[65]=te,i[66]=Se):Se=i[66],Se};var oe=n(66561),te=n(7749),se=n(77095),de=n(68632),ue=n(63745);const ce=e=>{const l=(0,c.c)(26),{vfolderNodeFrgmt:n,titleStyle:r}=e,{token:i}=te.A.useToken(),{lg:o}=se.Ay.useBreakpoint();let t;l[0]===Symbol.for("react.memo_cache_sentinel")?(t=u,l[0]=t):t=l[0];const s=(0,A.useFragment)(t,n);let d,p,y,v,f,F,h,k;return l[1]===Symbol.for("react.memo_cache_sentinel")?(d={width:"100%"},l[1]=d):d=l[1],l[2]!==r?(p=(0,a.A)({flex:1,fontWeight:"normal"},r),l[2]=r,l[3]=p):p=l[3],l[4]!==i.borderRadius||l[5]!==i.colorBorderSecondary||l[6]!==i.fontSizeHeading3||l[7]!==i.fontSizeHeading4||l[8]!==s?(y=s?(0,Y.jsx)(oe.A,{vfolderNodeIdenticonFrgmt:s,style:{fontSize:i.fontSizeHeading4}}):(0,Y.jsx)(_.OOm,{style:{borderColor:i.colorBorderSecondary,borderWidth:1,borderStyle:"solid",width:i.fontSizeHeading3,height:i.fontSizeHeading3,borderRadius:i.borderRadius}}),l[4]=i.borderRadius,l[5]=i.colorBorderSecondary,l[6]=i.fontSizeHeading3,l[7]=i.fontSizeHeading4,l[8]=s,l[9]=y):y=l[9],l[10]!==s?(v=s&&(0,Y.jsx)(m.A,{vfolderFrgmt:s,enableLink:!1,component:de.A.Title,level:3,style:{margin:0,width:"100%"},ellipsis:!0,editable:{triggerType:["icon","text"]},inputProps:{size:"large",count:{max:64,show:!0},style:{fontWeight:"normal"}}}),l[10]=s,l[11]=v):v=l[11],l[12]!==p||l[13]!==y||l[14]!==v?(f=(0,Y.jsxs)(_.OOm,{"data-testid":"folder-explorer-title",gap:"xs",style:p,children:[y,v]}),l[12]=p,l[13]=y,l[14]=v,l[15]=f):f=l[15],l[16]!==o||l[17]!==s?(F=!s||null!==s&&void 0!==s&&s.unmanaged_path?null:(0,Y.jsxs)(w.Suspense,{fallback:(0,Y.jsx)(ue.A.Button,{active:!0}),children:[(0,Y.jsx)(g.A,{children:(0,Y.jsx)(le,{vfolderFrgmt:s,showTitle:o})}),(0,Y.jsx)(g.A,{children:(0,Y.jsx)(ie,{vfolderFrgmt:s,showTitle:o})})]}),l[16]=o,l[17]=s,l[18]=F):F=l[18],l[19]!==F||l[20]!==i.marginSM?(h=(0,Y.jsx)(_.OOm,{"data-testid":"folder-explorer-actions",justify:"end",gap:i.marginSM,children:F}),l[19]=F,l[20]=i.marginSM,l[21]=h):h=l[21],l[22]!==f||l[23]!==h||l[24]!==i.marginMD?(k=(0,Y.jsxs)(_.OOm,{"data-testid":"folder-explorer-header",justify:"between",gap:i.marginMD,style:d,children:[f,h]}),l[22]=f,l[23]=h,l[24]=i.marginMD,l[25]=k):k=l[25],k};var me=n(87295);const ge=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],l=[{kind:"Variable",name:"id",variableName:"id"}],n={alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"3aee063a4b508648c2365ba6c7f0f44a",id:null,metadata:{},name:"VFolderNodeDescriptionPermissionRefreshQuery",operationKind:"query",text:"query VFolderNodeDescriptionPermissionRefreshQuery(\n  $id: String!\n) {\n  vfolder_node(id: $id) {\n    permission\n    permissions\n    id\n  }\n}\n"}}}();ge.hash="36063c8300310d9ef6c369b49127a2a2";const pe=ge,ye={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderPermissionCellFragment"},{args:null,kind:"FragmentSpread",name:"useVirtualFolderNodePathFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"f4ca4470ea635f85c8c346eed0a5fe8c"},ve=ye;var fe=n(62459),Fe=n(41458);const he={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useVirtualFolderNodePathFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"439221036e87c57ca3ec1ce737e0cdf7"},ke=he,Se=e=>{const l=(0,A.useFragment)(ke,e),[n,a]=K().split(null===l||void 0===l?void 0:l.quota_scope_id,":"),r=(0,_.omW)(null===l||void 0===l?void 0:l.id),i=r.slice(0,2),o=r.slice(2,4),t=r.slice(4),s="".concat(a.replaceAll("-",""),"/").concat(i,"/").concat(o,"/").concat(t.replaceAll("-",""));return{quotaScopeType:n,quotaScopeIdWithoutType:a,vfolderId:r,vfolderIdPrefix1:i,vfolderIdPrefix2:o,vfolderIdRest:t,vfolderPath:s}};var xe=n(91182);const _e=e=>{let{vfolderNodeFrgmt:l}=e;const{quotaScopeType:n,quotaScopeIdWithoutType:a,vfolderId:r,vfolderIdPrefix1:i,vfolderIdPrefix2:o,vfolderIdRest:t}=Se(l),{token:s}=te.A.useToken();return(0,Y.jsxs)(_.OOm,{direction:"row",align:"start",justify:"start",wrap:"wrap",gap:3,children:[(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"(root)"}),(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,Y.jsxs)(_.OOm,{direction:"column",align:"start",justify:"start",children:[(0,Y.jsx)(_.mQ0,{monospace:!0,copyable:{text:a},style:{fontSize:"0.9em"},children:K().truncate(a.replaceAll("-",""),{length:15})}),(0,Y.jsxs)(_.mQ0,{type:"secondary",style:{fontSize:s.fontSizeSM},children:["Quota Scope ID (",K().upperFirst(n),")"]})]}),(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,Y.jsxs)(_.OOm,{direction:"column",align:"start",justify:"start",children:[(0,Y.jsxs)(_.OOm,{gap:3,children:[(0,Y.jsx)(_.mQ0,{monospace:!0,style:{fontSize:"0.9em"},children:i}),(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,Y.jsx)(_.mQ0,{monospace:!0,style:{fontSize:"0.9em"},children:o}),(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,Y.jsx)(_.mQ0,{monospace:!0,copyable:{text:r},style:{fontSize:"0.9em"},children:K().truncate(t.replaceAll("-",""),{length:7})})]}),(0,Y.jsx)(_.mQ0,{type:"secondary",style:{fontSize:s.fontSizeSM},children:"VFolder ID"})]})]})};var be=n(75993),Ke=n(94456),we=n(54086),je=n(2210),Ae=n.n(je);const Ne=["vfolderNodeFrgmt"],Pe=e=>{var l;let{vfolderNodeFrgmt:n}=e,i=(0,r.A)(e,Ne);const{t:o}=(0,j.Bd)(),{token:t}=te.A.useToken(),{message:s}=F.A.useApp(),{getErrorMessage:d}=(0,_.B78)(),u=(0,A.useRelayEnvironment)(),c=(0,N.hd)(),m=(0,v.CX)(),[g]=(0,fe.U6)(),p=(0,Fe.ET)({mutationFn:e=>{let{permission:l,id:n}=e;return m.vfolder.update_folder({permission:l},n)}}),y=(0,A.useFragment)(ve,n),{vfolderPath:f}=Se(y),h=(0,_.omW)(y.id),k=(0,_.YM3)([!(null!==y&&void 0!==y&&y.unmanaged_path)&&{key:"path",label:(0,Y.jsx)(de.A.Text,{copyable:{text:f},style:{color:t.colorTextLabel},children:o("data.folders.Path")}),children:(0,Y.jsx)(_e,{vfolderNodeFrgmt:y})},{key:"status",label:o("data.folders.Status"),children:(0,Y.jsx)(_.d6Z,{color:y.status?xe.C[y.status]:void 0,children:K().toUpper(y.status||"")})},{key:"host",label:o("data.Host"),children:y.host},{key:"ownership_type",label:o("data.folders.Ownership"),children:"user"===(null===y||void 0===y?void 0:y.ownership_type)?(0,Y.jsxs)(_.OOm,{gap:"xs",children:[(0,Y.jsx)(de.A.Text,{children:o("data.User")}),(0,Y.jsx)(be.A,{style:{color:t.colorTextTertiary}})]}):(0,Y.jsxs)(_.OOm,{gap:"xs",children:[(0,Y.jsx)(de.A.Text,{children:o("data.Project")}),(0,Y.jsx)(_.ObC,{style:{color:t.colorTextTertiary}})]})},((null===y||void 0===y?void 0:y.user)===g.uuid||m.is_admin&&(null===y||void 0===y?void 0:y.group)===(null===c||void 0===c?void 0:c.id))&&{key:"permission",label:o("data.folders.MountPermission"),children:(0,Y.jsx)(_.xrr,{defaultValue:"wd"===y.permission?"rw":y.permission,options:[{value:"ro",label:o("data.ReadOnly")},{value:"rw",label:o("data.ReadWrite")}],onChange:e=>{p.mutate({permission:e,id:h},{onSuccess:()=>{s.success(o("data.permission.PermissionModified")),document.dispatchEvent(new CustomEvent("backend-ai-folder-updated")),(0,A.fetchQuery)(u,pe,{id:y.id}).toPromise()},onError:e=>{s.error(d(e))}})},popupMatchSelectWidth:!1})},{key:"owner",label:o("data.folders.Owner"),children:(null===y||void 0===y?void 0:y.user)===(null===g||void 0===g?void 0:g.uuid)||m.is_admin&&(null===y||void 0===y?void 0:y.group)===(null===c||void 0===c?void 0:c.id)?(0,Y.jsx)(_.OOm,{justify:"start",children:(0,Y.jsx)(Ke.A,{})}):null},null!==y.user_email&&{key:"user_email",label:o("data.User"),children:(0,Y.jsx)(de.A.Text,{copyable:!0,children:y.user_email})},null!==y.group_name&&{key:"group_name",label:o("data.Project"),children:y.group_name},{key:"cloneable",label:o("data.folders.Cloneable"),children:y.cloneable?(0,Y.jsx)(_.OOm,{justify:"start",children:(0,Y.jsx)(Ke.A,{})}):null},{key:"max_size",label:o("data.folders.MaxSize"),children:y.max_size?null===(l=(0,E.Gh)(y.max_size,"g",2))||void 0===l?void 0:l.displayValue:"\u221e"},{key:"usage",label:o("data.UsageMode"),children:y.usage_mode},{key:"created_at",label:o("data.folders.CreatedAt"),children:Ae()(y.created_at).format("lll")}]);return(0,Y.jsx)(we.A,(0,a.A)({bordered:!0,column:1,size:"small",items:k,styles:{content:{wordBreak:"break-word",overflowWrap:"break-word"}}},i))};var Ve=n(15229),Te=n(35395);const Ie=["targetVFolderId","currentPath","fileInfo","onRequestClose","uploadFiles"],ze=w.lazy((()=>n.e(9799).then(n.bind(n,9799)).then((e=>({default:e.Editor}))))),Ee=(e,l)=>{const n=e.languages.getLanguages();for(const o of n){var a;if(null!==(a=o.extensions)&&void 0!==a&&a.some((e=>l.endsWith(e)))){var r,i;const e=null!==(r=null===(i=o.mimetypes)||void 0===i?void 0:i[0])&&void 0!==r?r:"text/plain";return{detectedLanguage:o.id,detectedMimeType:e}}}return{detectedLanguage:"plaintext",detectedMimeType:"text/plain"}},Be=e=>{var l;const n=(0,c.c)(82);let i,o,t,s,d,u;if(n[0]!==e){var m=e;({targetVFolderId:d,currentPath:i,fileInfo:o,onRequestClose:s,uploadFiles:u}=m),t=(0,r.A)(m,Ie),n[0]=e,n[1]=i,n[2]=o,n[3]=t,n[4]=s,n[5]=d,n[6]=u}else i=n[1],o=n[2],t=n[3],s=n[4],d=n[5],u=n[6];const{t:g}=(0,j.Bd)(),{isDarkMode:p}=(0,Ve.e)(),{message:y}=F.A.useApp(),v=(0,_.kqi)(),{getErrorMessage:f}=(0,_.B78)(),{token:h}=te.A.useToken(),k=(0,Te.jE)(),S=(0,w.useRef)(null),x=(0,w.useRef)("text/plain");let b;var K,A,N;n[7]!==i||n[8]!==(null===(l=o)||void 0===l?void 0:l.name)?(b="."===i?null===(K=o)||void 0===K?void 0:K.name:"".concat(i,"/").concat(null===(A=o)||void 0===A?void 0:A.name).replace(/^\.\//,""),n[7]=i,n[8]=null===(N=o)||void 0===N?void 0:N.name,n[9]=b):b=n[9];const P=b;let V,T;n[10]!==P||n[11]!==d?(V=["textFileContent",d,P],n[10]=P,n[11]=d,n[12]=V):V=n[12],n[13]!==v||n[14]!==P||n[15]!==d?(T=async()=>{const e=await v.vfolder.request_download_token(P,d,!1),l="".concat(e.url,"?token=").concat(e.token,"&archive=false"),n=await fetch(l);if(!n.ok)throw new Error("HTTP error! status: ".concat(n.status));return(await n.blob()).text()},n[13]=v,n[14]=P,n[15]=d,n[16]=T):T=n[16];const I=!!t.open&&!!o&&!!d;let z;n[17]!==V||n[18]!==T||n[19]!==I?(z={queryKey:V,queryFn:T,enabled:I,staleTime:0,gcTime:0},n[17]=V,n[18]=T,n[19]=I,n[20]=z):z=n[20];const{data:E,error:B,isFetching:O}=(0,Fe.nN)(z);let D,C,R,H;n[21]!==i||n[22]!==E||n[23]!==o||n[24]!==d||n[25]!==u?(D=async()=>{var e,l,n;if(!o)return;const a=null!==(e=null!==(l=null===(n=S.current)||void 0===n?void 0:n.getValue())&&void 0!==l?l:E)&&void 0!==e?e:"",r=new Blob([a],{type:x.current}),t=new File([r],o.name,{type:x.current});await u([t],d,i)},n[21]=i,n[22]=E,n[23]=o,n[24]=d,n[25]=u,n[26]=D):D=n[26],n[27]!==P||n[28]!==s||n[29]!==k||n[30]!==d?(C=()=>{k.invalidateQueries({queryKey:["textFileContent",d,P]}),s(!0)},n[27]=P,n[28]=s,n[29]=k,n[30]=d,n[31]=C):C=n[31],n[32]!==f||n[33]!==y?(R=e=>{y.error(f(e))},n[32]=f,n[33]=y,n[34]=R):R=n[34],n[35]!==D||n[36]!==C||n[37]!==R?(H={mutationFn:D,onSuccess:C,onError:R},n[35]=D,n[36]=C,n[37]=R,n[38]=H):H=n[38];const Q=(0,Fe.ET)(H);let M;n[39]!==h.paddingContentHorizontal||n[40]!==h.paddingContentVertical?(M=(0,Y.jsx)(ue.A,{active:!0,style:{alignSelf:"start",paddingInline:h.paddingContentHorizontal,paddingBlock:h.paddingContentVertical}}),n[39]=h.paddingContentHorizontal,n[40]=h.paddingContentVertical,n[41]=M):M=n[41];const L=M;let q,W,U,$;var G;(n[42]!==g?(q=g("button.Save"),n[42]=g,n[43]=q):q=n[43],n[44]!==g?(W=g("button.Cancel"),n[44]=g,n[45]=W):W=n[45],n[46]!==g?(U=g("data.explorer.EditFile"),n[46]=g,n[47]=U):U=n[47],n[48]!==o)?($=o&&(0,Y.jsxs)(_.mQ0,{type:"secondary",style:{fontWeight:"normal"},children:["- ",o.name,o.size>0&&" (".concat(null===(G=(0,_.GhK)(o.size,"auto"))||void 0===G?void 0:G.displayValue,")")]}),n[48]=o,n[49]=$):$=n[49];let X,Z,J;n[50]!==U||n[51]!==$?(X=(0,Y.jsxs)(Y.Fragment,{children:[U,$]}),n[50]=U,n[51]=$,n[52]=X):X=n[52],n[53]!==s?(Z=()=>s(),n[53]=s,n[54]=Z):Z=n[54],n[55]!==Q?(J=()=>Q.mutate(),n[55]=Q,n[56]=J):J=n[56];const ee=!!B;let le,ne,ae,re,ie,oe;return n[57]!==ee?(le={disabled:ee},n[57]=ee,n[58]=le):le=n[58],n[59]===Symbol.for("react.memo_cache_sentinel")?(ne={body:{paddingBlock:0,paddingInline:0}},n[59]=ne):ne=n[59],n[60]===Symbol.for("react.memo_cache_sentinel")?(ae={height:"calc(100vh - 180px)"},n[60]=ae):ae=n[60],n[61]!==E||n[62]!==o||n[63]!==p||n[64]!==O||n[65]!==B||n[66]!==L||n[67]!==g?(re=B?(0,Y.jsx)(_.RfO,{type:"error",showIcon:!0,title:g("data.explorer.FailedToLoadFile"),description:g("data.explorer.FailedToLoadFileDescription")}):O?L:(0,Y.jsx)(ze,{defaultValue:null!==E&&void 0!==E?E:"",beforeMount:e=>{var l;if(null!==(l=o)&&void 0!==l&&l.name){const{detectedMimeType:l}=Ee(e,o.name);x.current=l}},onMount:(e,l)=>{var n;if(S.current=e,null!==(n=o)&&void 0!==n&&n.name){const{detectedLanguage:n}=Ee(l,o.name),a=e.getModel();a&&l.editor.setModelLanguage(a,n)}},theme:p?"vs-dark":"light",loading:L,width:"100%",height:"100%",options:{fixedOverflowWidgets:!0}}),n[61]=E,n[62]=o,n[63]=p,n[64]=O,n[65]=B,n[66]=L,n[67]=g,n[68]=re):re=n[68],n[69]!==L||n[70]!==re?(ie=(0,Y.jsx)(_.OOm,{direction:"column",gap:"md",style:ae,children:(0,Y.jsx)(w.Suspense,{fallback:L,children:re})}),n[69]=L,n[70]=re,n[71]=ie):ie=n[71],n[72]!==t||n[73]!==Q.isPending||n[74]!==q||n[75]!==W||n[76]!==X||n[77]!==Z||n[78]!==J||n[79]!==le||n[80]!==ie?(oe=(0,Y.jsx)(_.IbE,(0,a.A)((0,a.A)({width:"100%",destroyOnHidden:!0,okText:q,cancelText:W},t),{},{title:X,onCancel:Z,onOk:J,confirmLoading:Q.isPending,okButtonProps:le,styles:ne,children:ie})),n[72]=t,n[73]=Q.isPending,n[74]=q,n[75]=W,n[76]=X,n[77]=Z,n[78]=J,n[79]=le,n[80]=ie,n[81]=oe):oe=n[81],oe};var Oe=n(60594),De=n(8744),Ce=n(59989),Re=n(93806),He=n(37777);const Qe=["vfolderID","onRequestClose"];var Me;const Le=(0,Re.rU)((e=>{let{css:l}=e;return{baiModalHeader:l(Me||(Me=(0,i.A)(["\n    .ant-modal-title {\n      width: 100%;\n    }\n  "])))}})),qe=e=>{var l,n;let{vfolderID:i,onRequestClose:o}=e,d=(0,r.A)(e,Qe);const{t:u}=(0,j.Bd)(),{token:c}=te.A.useToken(),{xl:m}=se.Ay.useBreakpoint(),{styles:g}=Le(),[p,y]=(0,_.zui)(),f=(0,v.CX)(),F=(0,v.eZ)(),h=(0,N.hd)(),k=null===f||void 0===f||null===(l=f._config)||void 0===l?void 0:l.accessKey,S=(0,w.useRef)(null),{unitedAllowedPermissionByVolume:x}=Z(F,h.id,k),b=(0,w.useRef)(null),P=(0,w.useDeferredValue)(d.open),{vfolder_node:V}=(0,A.useLazyLoadQuery)(t,{vfolderGlobalId:(0,_.wcZ)("VirtualFolderNode",i)},{fetchPolicy:P&&d.open?"store-and-network":"store-only"}),{upsertNotification:T,closeNotification:I}=(0,He.js)(),{generateFolderPath:z}=(0,me.useFolderExplorerOpener)(),[E,B]=(0,w.useState)([]),[O,D]=(0,w.useState)(null),{uploadStatus:C,uploadFiles:R}=(0,s.useFileUploadManager)(null===V||void 0===V?void 0:V.id,(null===V||void 0===V?void 0:V.name)||void 0);(0,_.$$z)((()=>{var e;null===(e=S.current)||void 0===e||e.refetch()}),C&&!K().isEmpty(null===C||void 0===C?void 0:C.pendingFiles)?5e3:null),(0,w.useEffect)((()=>{C&&K().isEmpty(null===C||void 0===C?void 0:C.pendingFiles)&&y()}),[C,y]);const H=K().includes(x[null!==(n=null===V||void 0===V?void 0:V.host)&&void 0!==n?n:""],"download-file"),Q=K().includes(null===V||void 0===V?void 0:V.permissions,"delete_content"),M=K().includes(null===V||void 0===V?void 0:V.permissions,"write_content"),L=null!==V&&void 0!==V&&V.unmanaged_path?(0,Y.jsx)(Oe.A,{title:u("explorer.NoExplorerSupportForUnmanagedFolder"),showIcon:!0}):V?(0,Y.jsx)(_.Gt_,{ref:S,targetVFolderId:i,deletingFilePaths:E,fetchKey:p,onUpload:(e,l)=>{R(e,i,l)},onDeleteFilesInBackground:(e,l,n)=>{B(n),T({key:"delete:".concat(e),open:!0,message:(0,Y.jsxs)("span",{children:[u("explorer.VFolder"),":\xa0",(0,Y.jsx)(_.rmy,{style:{fontWeight:"normal"},to:z(l),onClick:()=>{I("delete:".concat(e))},children:"".concat(V.name)})]}),backgroundTask:{status:"pending",taskId:e,promise:null,percent:0,onChange:{pending:u("explorer.DeletingSelectedItems"),resolved:()=>(B([]),u("explorer.SelectedItemsDeletedSuccessfully")),rejected:()=>(B([]),u("explorer.SelectedItemsDeletionFailed"))}}})},enableDownload:H,enableDelete:Q,enableWrite:M,enableEdit:M,tableProps:{scroll:m?{x:"max-content"}:{x:"max-content",y:"calc(100vh - 400px)"}},style:{paddingBottom:m?c.paddingLG:0},fileDropContainerRef:b,onClickEditFile:(e,l)=>{D({file:e,currentPath:l})}}):null,q=V?(0,Y.jsx)(Pe,{vfolderNodeFrgmt:V}):null;return(0,Y.jsxs)(_.IbE,(0,a.A)((0,a.A)({className:g.baiModalHeader,width:"90%",keyboard:!0,destroyOnHidden:!0,footer:null,style:{maxWidth:"1600px"},styles:{body:{height:"100vh"}},title:V?(0,Y.jsx)(ce,{titleStyle:{zIndex:c.zIndexPopupBase+2},vfolderNodeFrgmt:V}):null,bodyProps:{ref:b},onCancel:()=>{o()}},d),{},{children:[(0,Y.jsx)(w.Suspense,{fallback:(0,Y.jsx)(ue.A,{active:!0}),children:P!==d.open||void 0===V?(0,Y.jsx)(ue.A,{active:!0}):(0,Y.jsxs)(_.OOm,{direction:"column",gap:"lg",align:"stretch",children:[null===V?(0,Y.jsx)(Oe.A,{title:u("explorer.FolderNotFoundOrNoAccess"),type:"error",showIcon:!0}):(null===h||void 0===h?void 0:h.id)!==(null===V||void 0===V?void 0:V.group)&&null!==V&&void 0!==V&&V.group?(0,Y.jsx)(Oe.A,{title:V.group_name?u("data.NotInProject",{projectName:V.group_name}):u("data.BelongsToDifferentProject"),type:"info",showIcon:!0}):null,m?(0,Y.jsxs)(De.A,{style:{gap:c.size},orientation:"horizontal",children:[(0,Y.jsx)(De.A.Panel,{resizable:!1,children:L}),(0,Y.jsx)(De.A.Panel,{defaultSize:500,children:q})]}):(0,Y.jsxs)(_.OOm,{direction:"column",align:"stretch",children:[L,(0,Y.jsx)(Ce.A,{style:{borderColor:c.colorBorderSecondary}}),q]})]})}),(0,Y.jsx)(_.XcZ,{children:(0,Y.jsx)(Be,{open:!!O,targetVFolderId:i,currentPath:(null===O||void 0===O?void 0:O.currentPath)||".",fileInfo:(null===O||void 0===O?void 0:O.file)||null,uploadFiles:R,onRequestClose:e=>{var l;e&&(null===(l=S.current)||void 0===l||l.refetch());D(null)}})})]}))}},91521(e,l,n){n.r(l),n.d(l,{default:()=>K,useFileUploadManager:()=>w});var a=n(56276),r=n(23177),i=n(37777),o=n(87295),t=n(7749),s=n(68632),d=n(96337),u=n(44011),c=n(21507),m=n(62406),g=n(47476),p=n.n(g),y=n(83476),v=n(32397),f=n(94109),F=n(18249),h=n(83632),k=n(31638),S=n(33337);const x=(0,u.eU)([]),_=(0,u.eU)({}),b=(0,m.I)((e=>(0,u.eU)((l=>l(_)[e]),((l,n,r)=>{const i=l(_);n(_,(0,a.A)((0,a.A)({},i),{},{[e]:r}))})))),K=()=>{const{t:e}=(0,f.Bd)(),{token:l}=t.A.useToken(),n=(0,F.CX)(),{upsertNotification:r,closeNotification:u}=(0,i.js)(),{generateFolderPath:m}=(0,o.useFolderExplorerOpener)(),[g,k]=(0,c.fp)(x),[b,K]=(0,c.fp)(_),[w]=(0,h.q)("max_concurrent_uploads"),j=new y.A({concurrency:w||2}),A=(0,v.useRef)({}),N=p().throttle(((n,i)=>{const o=A.current[n]||0;A.current[n]=0,K((t=>{var u,c,m,g,p,y,v,f,F,h;const k=(null===(u=t[n])||void 0===u||null===(c=u.completedFiles)||void 0===c?void 0:c.length)||0,x=((null===(m=t[n])||void 0===m||null===(g=m.completedFiles)||void 0===g?void 0:g.length)||0)+((null===(p=t[n])||void 0===p||null===(y=p.failedFiles)||void 0===y?void 0:y.length)||0)+((null===(v=t[n])||void 0===v||null===(f=v.pendingFiles)||void 0===f?void 0:f.length)||0),_=(null===(F=t[n])||void 0===F?void 0:F.totalExpectedSize)||0,b=((null===(h=t[n])||void 0===h?void 0:h.completedBytes)||0)+o;return r({key:"upload:"+n,backgroundTask:{status:"pending",percent:_>0?b/_*100:0,onChange:{pending:{description:(0,S.jsxs)(d.OOm,{direction:"column",align:"start",children:[(0,S.jsxs)(s.A.Text,{children:[e("explorer.UploadingFiles")," ( ",k," /"," ",x," )"]}),(0,S.jsx)(s.A.Text,{ellipsis:!0,type:"secondary",style:{fontSize:l.fontSizeSM,maxWidth:"300px"},children:i})]})}}}}),(0,a.A)((0,a.A)({},t),{},{[n]:(0,a.A)((0,a.A)({},t[n]),{},{completedBytes:b})})}))}),200,{leading:!0,trailing:!0});return(0,v.useEffect)((()=>{0!==g.length&&n&&(g.forEach((l=>{const{vFolderId:n,vFolderName:i,uploadFileInfo:o}=l,t=p().sumBy(o,(e=>e.file.size));K((l=>{var s,c,g,p,y,v;const f=!l[n],F=((null===(s=l[n])||void 0===s?void 0:s.totalExpectedSize)||0)+t,h=f?0:((null===(c=l[n])||void 0===c?void 0:c.completedBytes)||0)/F*100;return r({key:"upload:"+n,open:!0,message:(0,S.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,S.jsx)(d.rmy,{style:{fontWeight:"normal"},to:m(n),onClick:()=>{u("upload:"+n)},children:"".concat(i)})]}),backgroundTask:{status:"pending",percent:h,onChange:{pending:e("explorer.ProcessingUpload")}},duration:0}),(0,a.A)((0,a.A)({},l),{},{[n]:{vFolderName:i,pendingFiles:[...(null===(g=l[n])||void 0===g?void 0:g.pendingFiles)||[],...o.map((e=>e.file.webkitRelativePath||e.file.name))],completedFiles:(null===(p=l[n])||void 0===p?void 0:p.completedFiles)||[],failedFiles:(null===(y=l[n])||void 0===y?void 0:y.failedFiles)||[],completedBytes:(null===(v=l[n])||void 0===v?void 0:v.completedBytes)||0,totalExpectedSize:F}})})),o.forEach((e=>{let{file:l,startFunction:r}=e;j.add((async()=>{const e=l.webkitRelativePath||l.name;let i=0;try{await r({onProgress:(e,l,a)=>{const r=e-i;i=e,A.current[n]=(A.current[n]||0)+r,N(n,a)}}),N.flush(),delete A.current[n],K((l=>{var r;return(0,a.A)((0,a.A)({},l),{},{[n]:(0,a.A)((0,a.A)({},l[n]),{},{pendingFiles:l[n].pendingFiles.filter((l=>l!==e)),completedFiles:[...(null===(r=l[n])||void 0===r?void 0:r.completedFiles)||[],e]})})}))}catch(o){N.flush(),delete A.current[n],K((l=>{var r;return(0,a.A)((0,a.A)({},l),{},{[n]:(0,a.A)((0,a.A)({},l[n]),{},{pendingFiles:l[n].pendingFiles.filter((l=>l!==e)),failedFiles:[...(null===(r=l[n])||void 0===r?void 0:r.failedFiles)||[],e]})})}))}}))}))})),k([]))}),[g]),(0,v.useEffect)((()=>{Object.entries(b).forEach((l=>{let[n,i]=l;p().isEmpty(null===i||void 0===i?void 0:i.pendingFiles)&&(p().isEmpty(null===i||void 0===i?void 0:i.failedFiles)?p().isEmpty(null===i||void 0===i?void 0:i.completedFiles)||(r({key:"upload:"+n,open:!0,message:(0,S.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,S.jsx)(d.rmy,{style:{fontWeight:"normal"},to:m(n),onClick:()=>{u("upload:"+n)},children:"".concat(null===i||void 0===i?void 0:i.vFolderName)})]}),backgroundTask:{status:"resolved",percent:100,onChange:{resolved:e("explorer.SuccessfullyUploadedToFolder")}},duration:3}),K((e=>(0,a.A)((0,a.A)({},e),{},{[n]:(0,a.A)((0,a.A)({},e[n]),{},{completedFiles:[],completedBytes:0,totalExpectedSize:0})})))):r({key:"upload:"+n,open:!0,message:e("explorer.UploadFailed",{folderName:null===i||void 0===i?void 0:i.vFolderName}),backgroundTask:{status:"rejected",percent:0,onChange:{rejected:e("explorer.FileUploadFailed",{folderName:null===i||void 0===i?void 0:i.vFolderName})}},extraDescription:p().join(null===i||void 0===i?void 0:i.failedFiles,", ")}))}))}),[b]),null},w=(e,l)=>{const n=(0,r.c)(16),a=(0,d.kqi)(),{t:o}=(0,f.Bd)(),{upsertNotification:t}=(0,i.js)(),s=(0,c.Xr)(x);let u;n[0]!==e?(u=e?(0,d.omW)(e).replace(/-/g,""):"",n[0]=e,n[1]=u):u=n[1];const[m,g]=(y=u,(0,c.fp)(b(y)));var y;let v;n[2]!==a||n[3]!==l||n[4]!==o||n[5]!==t?(v=(e,n)=>{const r=a._config.maxFileUploadSize,i=p().map(e,A).reduce(N,0);return!(r>0&&i>r)||(t({open:!0,key:"upload:"+n,message:o("explorer.UploadFailed",{folderName:null!==l&&void 0!==l?l:""}),description:o("data.explorer.FileUploadSizeLimit"),duration:3,toText:o("data.folders.OpenAFolder"),to:{search:new URLSearchParams({folder:n}).toString()}}),!1)},n[2]=a,n[3]=l,n[4]=o,n[5]=t,n[6]=v):v=n[6];const F=v;let h;n[7]!==a||n[8]!==l||n[9]!==s||n[10]!==F?(h=async(e,n,r)=>{if(!F(e,n))return;const i=[],o=p().map(e,(e=>(i.push(e),async l=>{const i=e.webkitRelativePath||e.name;try{const o=[r,i].filter(Boolean).join("/"),t=await a.vfolder.create_upload_session(o,e,n);return await new Promise(((n,a)=>{try{new k._O(e,{endpoint:t,uploadUrl:t,retryDelays:[0,3e3,5e3,1e4,2e4],chunkSize:j(e.size),storeFingerprintForResuming:!1,metadata:{filename:e.name,filetype:e.type},onProgress:(e,n)=>{var a;null===l||void 0===l||null===(a=l.onProgress)||void 0===a||a.call(l,e,n,i)},onSuccess:()=>{n({name:i,bytes:e.size})},onError:e=>{a(new Error("Upload failed for ".concat(i)))}}).start()}catch(r){a(new Error("Failed to initialize upload for ".concat(i)))}}))}catch(o){throw new Error("Failed to prepare upload for ".concat(i))}}))),t={vFolderId:n,vFolderName:null!==l&&void 0!==l?l:"",uploadFileInfo:p().zipWith(i,o,P)};s((e=>[...e,t]))},n[7]=a,n[8]=l,n[9]=s,n[10]=F,n[11]=h):h=n[11];const S=h;let _;return n[12]!==g||n[13]!==S||n[14]!==m?(_={uploadStatus:m,setUploadStatus:g,uploadFiles:S},n[12]=g,n[13]=S,n[14]=m,n[15]=_):_=n[15],_},j=e=>{const l=1048576;return e>=5120*l?200*l:e>=1024*l?100*l:e>=100*l?50*l:15*l};function A(e){return e.size}function N(e,l){return Math.max(e,l)}function P(e,l){return{file:e,startFunction:l}}}}]);
//# sourceMappingURL=4251.74a4b4ce.chunk.js.map