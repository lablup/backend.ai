(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[4104],{29124:e=>{function n(e){return Promise.resolve().then((()=>{var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}))}n.keys=()=>[],n.resolve=n,n.id=29124,e.exports=n},50555:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>l});const i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ChatCard_endpoint",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"b1ec3869b3c8db05d40a1d2089bf4681"},l=i},38166:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>l});const i=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpointId"},{defaultValue:null,kind:"LocalArgument",name:"isEmptyEndpointId"}],n=[{kind:"Variable",name:"endpoint_id",variableName:"endpointId"}],t={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},i=[t,{args:null,kind:"FragmentSpread",name:"ChatCard_endpoint"}],l=[{kind:"Literal",name:"limit",value:1},{kind:"Literal",name:"offset",value:0}],a=[t,{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ConversationQuery",selections:[{kind:"CatchField",field:{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:i,storageKey:null},to:"RESULT"},{alias:null,args:l,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:i,storageKey:null}],storageKey:"endpoint_list(limit:1,offset:0)"}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ConversationQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:a,storageKey:null},{alias:null,args:l,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:a,storageKey:null}],storageKey:"endpoint_list(limit:1,offset:0)"}]},params:{cacheID:"d7653723856ff846f2ffa7a4c6208108",id:null,metadata:{},name:"ConversationQuery",operationKind:"query",text:"query ConversationQuery(\n  $endpointId: UUID!\n  $isEmptyEndpointId: Boolean!\n) {\n  endpoint(endpoint_id: $endpointId) @skipOnClient(if: $isEmptyEndpointId) {\n    endpoint_id\n    ...ChatCard_endpoint\n    id\n  }\n  endpoint_list(limit: 1, offset: 0) {\n    items {\n      endpoint_id\n      ...ChatCard_endpoint\n      id\n    }\n  }\n}\n\nfragment ChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="19ab098027047c8f5d7ef3a879db277d";const l=i},86164:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>l});const i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"endpoint_id"},n={defaultValue:null,kind:"LocalArgument",name:"filter"},t={defaultValue:null,kind:"LocalArgument",name:"limit"},i={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"projectID"},a={defaultValue:null,kind:"LocalArgument",name:"skipEndpoint"},o=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],s={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},u={args:null,kind:"FragmentSpread",name:"ChatCard_endpoint"},p=[{kind:"Variable",name:"endpoint_id",variableName:"endpoint_id"}],m=[d,r,c,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:[e,n,t,i,l,a],kind:"Fragment",metadata:null,name:"EndpointSelectQuery",selections:[{alias:null,args:o,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[s,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[d,r,c,u],storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[d,r,u],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[i,t,l,n,e,a],kind:"Operation",name:"EndpointSelectQuery",selections:[{alias:null,args:o,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[s,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:m,storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:m,storageKey:null}]},params:{cacheID:"3e721bc4d82b8863ef87a9a37d052d0d",id:null,metadata:{},name:"EndpointSelectQuery",operationKind:"query",text:"query EndpointSelectQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n  $filter: String\n  $endpoint_id: UUID!\n  $skipEndpoint: Boolean!\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: $filter) {\n    total_count\n    items {\n      name\n      endpoint_id\n      url\n      ...ChatCard_endpoint\n      id\n    }\n  }\n  endpoint(endpoint_id: $endpoint_id) @skipOnClient(if: $skipEndpoint) {\n    name\n    endpoint_id\n    ...ChatCard_endpoint\n    id\n  }\n}\n\nfragment ChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="02cb33fa42cc8d8aa56c5ddd6542c548";const l=i},27766:(e,n,t)=>{"use strict";t.d(n,{W:()=>a});var i=t(77668),l=(t(1426),t(42906));const a=e=>{let{name:n,height:t,width:a}=e;const o=i.Pt.icons[null!==n&&void 0!==n?n:"pure"];return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",height:t,width:a,role:"img",dangerouslySetInnerHTML:{__html:o.body}})}},49871:(e,n,t)=>{"use strict";t.d(n,{B:()=>o});var i=t(32967),l=t(88578),a=t(1426);const o=()=>{var e;const[n,t]=(0,i.Tw)("first"),{data:o,isLoading:s}=(0,l.nN)({queryKey:["useAgents",n],queryFn:()=>fetch("resources/ai-agents.json").then((e=>e.json())),staleTime:864e5});return{agents:null!==(e=null===o||void 0===o?void 0:o.agents)&&void 0!==e?e:[],isLoading:s,refresh:(0,a.useCallback)((()=>t()),[t])}}},22413:(e,n,t)=>{"use strict";t.r(n),t.d(n,{default:()=>rn});var i=t(21173),l=t(90840),a=t(32967),o=t(88578),s=t(49871),d=t(75045),r=t(46606),c=t(27766),u=t(37383),p=t(1869),m=t(18695),g=t(1426),h=t(42906);function v(e,n){return e.map((e=>({label:e.meta.title,value:e.id,...e}))).filter((e=>e.label.toLocaleLowerCase().includes(n||"")))}const f=e=>{let{loading:n,agents:t,selectedAgent:i,...a}=e;const{token:o}=p.A.useToken(),[s,d]=(0,u.A)(a,{valuePropName:"value",trigger:"onChange",defaultValue:a.value}),[r,f]=(0,g.useState)(),[y,x]=(0,g.useTransition)();return(0,h.jsx)(h.Fragment,{children:i&&(0,h.jsxs)(l.A,{gap:"xs",children:[(0,h.jsx)(c.W,{name:i.meta.avatar,height:o.sizeXL,width:o.sizeXL}),(0,h.jsx)(m.A,{showSearch:!0,onSearch:e=>{x((()=>{f(e)}))},filterOption:!1,loading:y||n,options:v(t,r),value:s,onChange:(e,n)=>{d(e,n)},popupMatchSelectWidth:!1})]})})};var y,x=t(27484),k=t.n(x),j=t(48602),C=t(18347);const b=e=>{let{fetchKey:n,lifecycleStageFilter:i=["created"],loading:l,...o}=e;const{t:s}=(0,j.Bd)(),d=(0,a.CX)(),[r,c]=(0,u.A)(o),[p,v]=(0,g.useState)(),[f,x]=(0,g.useTransition)(),b=i.map((e=>`lifecycle_stage == "${e}"`)).join(" | "),{endpoint_list:A,endpoint:S}=(0,C.useLazyLoadQuery)(void 0!==y?y:y=t(86164),{limit:10,offset:0,filter:d.supports("endpoint-lifecycle-stage-filter")?[b,p].filter(Boolean).map((e=>`(${e})`)).join(" & "):void 0,endpoint_id:r,skipEndpoint:!r},{fetchKey:n}),I=S?k().map(k().uniqBy(k().concat(null===A||void 0===A?void 0:A.items,S),"endpoint_id"),(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e}))):k().map(null===A||void 0===A?void 0:A.items,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e})));return(0,h.jsx)(m.A,{placeholder:s("chatui.SelectEndpoint"),style:{fontWeight:"normal"},showSearch:!0,onSearch:e=>{x((()=>{v(e&&`name ilike "%${e}%"`)}))},filterOption:!1,loading:f||l,options:I,...o,value:r,onChange:(e,n)=>{var t;c(e,null===(t=k().castArray(n))||void 0===t?void 0:t[0].endpoint)}})},A=e=>{let{models:n,allowCustomModel:t,...i}=e;const{t:l}=(0,j.Bd)();return(0,h.jsx)(m.A,{placeholder:l("chatui.SelectModel"),style:{fontWeight:"normal"},showSearch:!0,options:k().concat(t?[{label:"Custom",value:"custom"}]:[],k().chain(n).groupBy("group").mapValues((e=>k().map(e,(e=>({label:e.label,value:e.name}))))).map(((e,n)=>({label:"undefined"===n?"Others":n,options:e}))).value()),popupMatchSelectWidth:!1,...i})};var S=t(20535),I=t(92559),w=t(33134),L=t(75864),T=t(29180),_=t(76415),E=t(50184),F=t(75394),M=t(70310);const R=e=>{let{sync:n,onClick:t}=e;const{t:i}=(0,j.Bd)();return(0,h.jsxs)(h.Fragment,{children:[n&&(0,h.jsx)(L.A.Text,{type:"secondary",children:i("chatui.SyncInput")}),(0,h.jsx)(T.A,{checked:n,onClick:t})]})},K=e=>{let{chat:n,showCompareMenuItem:t,allowCustomModel:i,closable:o,models:s,modelId:c,setModelId:u,endpoint:m,setEndpoint:v,agents:y,agent:x,setAgent:k,sync:C,setSync:L,onRequestClose:T,onCreateNewChat:K,fetchKey:D,setMessages:$}=e;const{t:B}=(0,j.Bd)(),{token:U}=p.A.useToken(),V=(0,a.f0)(),[N,z]=(0,g.useState)(m),q=(0,d.LY)([t&&{key:"compare",label:B("chatui.CompareWithOtherModels"),icon:(0,h.jsx)(F.A,{}),onClick:()=>{V(`/serving?tab=chatting&endpointId=${null===m||void 0===m?void 0:m.endpoint_id}&modelId=${c}`)}},t&&{type:"divider"},{key:"clear",label:B("chatui.DeleteChatHistory"),icon:(0,h.jsx)(M.A,{}),onClick:()=>{$([])}},o&&{type:"divider"},o&&{key:"close",danger:!0,label:B("chatui.DeleteChattingSession"),icon:(0,h.jsx)(S.A,{}),onClick:()=>{null===T||void 0===T||T(n)}}]),[O]=(0,r.q)("experimental_ai_agents");return(0,h.jsxs)(l.A,{direction:"row",justify:"start",wrap:"wrap",gap:"xs",style:{minHeight:"56px",width:"100%",paddingTop:U.paddingXS,paddingBottom:U.paddingXS},children:[(0,h.jsxs)(l.A,{wrap:"wrap",align:"start",gap:"xs",style:{flexGrow:1,flexShrink:1,flexBasis:"auto"},children:[O&&(0,h.jsx)(f,{agents:y,selectedAgent:x,value:null===x||void 0===x?void 0:x.id,onChange:(e,n)=>{(0,g.startTransition)((()=>{k(n)}))}}),(0,h.jsx)(b,{fetchKey:D,loading:(null===N||void 0===N?void 0:N.endpoint_id)!==(null===m||void 0===m?void 0:m.endpoint_id),onChange:(e,n)=>{z(n),(0,g.startTransition)((()=>{v(n)}))},value:null===m||void 0===m?void 0:m.endpoint_id,popupMatchSelectWidth:!1}),(0,h.jsx)(A,{models:s,value:c,onChange:e=>{(0,g.startTransition)((()=>{u(e)}))},allowCustomModel:i})]}),(0,h.jsxs)(l.A,{gap:"xs",children:[o&&(0,h.jsx)(R,{sync:C,onClick:e=>{(0,g.startTransition)((()=>{L(e)}))}}),(0,h.jsx)(_.Ay,{onClick:()=>null===K||void 0===K?void 0:K(),icon:(0,h.jsx)(I.A,{})}),(0,h.jsx)(E.A,{menu:{items:q},trigger:["click"],children:(0,h.jsx)(_.Ay,{type:"link",onClick:e=>e.preventDefault(),icon:(0,h.jsx)(w.A,{}),style:{color:U.colorTextSecondary,width:U.sizeMS}})})]})]})};var D=t(22403),$=t(38579),B=t(6389),U=t(84631),V=t(73857);const N=e=>{let{items:n,onChange:t,dropContainerRef:i,children:l}=e;const{t:a}=(0,j.Bd)();return(0,h.jsx)(B.A,{beforeUpload:()=>!1,getDropContainer:()=>i.current,accept:"image/*,text/*",items:n,onChange:t,placeholder:e=>"drop"===e?{title:a("chatui.DropFileHere")}:{icon:(0,h.jsx)(D.A,{}),title:a("chatui.UploadFiles"),description:a("chatui.UploadFilesDescription")},children:l})},z=e=>{let{loading:n,autoFocus:t,items:i,openAttachment:l,dropContainerRef:a,onInputChange:o,onInputSubmit:s,onInputCancel:d,onAttachmentChange:r,onAttachmentOpenChange:c,...u}=e;const{t:p}=(0,j.Bd)(),m=(0,g.useRef)(null);return(0,g.useEffect)((()=>{t&&m.current&&m.current.focus()}),[t]),(0,h.jsx)(U.A,{style:{flex:1},ref:m,...u,loading:n,onChange:o,onSubmit:s,onCancel:d,submitType:"enter",header:(0,h.jsx)(U.A.Header,{closable:!1,title:p("chatui.Attachments"),open:!!l&&!(0,x.isEmpty)(i),onOpenChange:c,styles:{content:{padding:0}},children:(0,h.jsx)(N,{items:i,dropContainerRef:a,onChange:e=>null===r||void 0===r?void 0:r("header",e)})}),prefix:(0,h.jsx)(N,{items:i,dropContainerRef:a,onChange:e=>null===r||void 0===r?void 0:r("prefix",e),children:(0,h.jsx)(V.A,{dot:!(0,x.isEmpty)(i)&&!l,children:(0,h.jsx)(_.Ay,{type:"text",icon:(0,h.jsx)($.A,{})})})})})};var q=t(62021),O=t(74157);const H=(0,q.eU)(""),P=(0,q.eU)(),Q=(0,q.eU)(void 0),W=e=>{let{sync:n,input:t,setInput:i,stop:a,append:o,isLoading:s}=e;const{token:r}=p.A.useToken(),c={background:"#ffffff",borderTop:"1px solid #f0f0f0",borderRadius:"0 0 8px 8px",padding:r.paddingContentVertical},[u,m]=(0,g.useState)(!1),[v,f]=(0,g.useState)([]),y=(0,g.useRef)(null),[k,j]=(0,O.fp)(H),[C,b]=(0,O.fp)(P),[A,S]=(0,O.fp)(Q),I=(0,g.useId)(),w=(null===A||void 0===A?void 0:A.id)===I||null===A||void 0===A?void 0:A.key,L=(0,g.useRef)(n);(0,g.useEffect)((()=>{L.current!==n&&(i(""),L.current=n)}),[n,i]),(0,g.useEffect)((()=>{n&&!(0,x.isUndefined)(k)&&i(k)}),[k,i,n]);(0,g.useEffect)((()=>{var e;e=C,(0,x.isUndefined)(e)||(0,x.isEqual)(v,e)||(f(e),m(!0))}),[C]),(0,g.useEffect)((()=>{if(!(0,x.isUndefined)(w)&&t){const e={};(0,x.isEmpty)(v)||(e.experimental_attachments=(0,d.bJ)(v)),o({role:"user",content:t},e)}}),[w]);const T=(0,g.useCallback)((e=>{i(e),n&&j(e)}),[n,i,j]),_=(0,g.useCallback)((()=>{a()}),[a]),E=(0,g.useCallback)((()=>{if(t||!(0,x.isEmpty)(v)){const e={};(0,x.isEmpty)(v)||(e.experimental_attachments=(0,d.bJ)(v)),o({role:"user",content:t},e),setTimeout((()=>{i(""),f([]),m(!1)}),0),j(""),b([]),n&&S({id:I,key:(new Date).toString()})}}),[t,v,o,j,b,n,i,S,I]),F=(0,g.useCallback)(((e,t)=>{const i=t.fileList;f(i),"prefix"===e&&m(!0),n&&b(i)}),[n,f,m,b]),M=(0,g.useCallback)((e=>{m(e)}),[m]);return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(l.A,{style:c,direction:"column",align:"center",children:(0,h.jsx)(z,{placeholder:"Say something...",autoFocus:!0,value:t,items:v,openAttachment:u,dropContainerRef:y,loading:s,onInputChange:T,onInputSubmit:E,onInputCancel:_,onAttachmentChange:F,onAttachmentOpenChange:M})})})},X=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[n,i]=(0,g.useState)(0);return(0,g.useEffect)((()=>{(0,g.startTransition)((()=>{(async e=>{const{encode:n}=await t.e(1254).then(t.bind(t,61254));return n(e).length})(e).then(i).catch((()=>{i(e.length)}))}))}),[e]),n};var G=t(48251),J=t(47525);const Y=e=>{let{input:n,messages:t,startTime:i}=e;const{token:a}=p.A.useToken(),o=X(n),s=(0,g.useMemo)((()=>(0,x.map)(t,(e=>null===e||void 0===e?void 0:e.content)).join("")),[t]),d=o+X(s),r=(0,g.useMemo)((()=>{const e=(0,x.last)(t);return"assistant"===(null===e||void 0===e?void 0:e.role)?null===e||void 0===e?void 0:e.content:""}),[t]),c=X(r),u=(0,g.useMemo)((()=>c>0&&i?c/((Date.now()-i)/1e3):0),[c,i]);return(0,h.jsx)(l.A,{justify:"end",align:"end",style:{margin:a.marginSM},children:(0,h.jsx)(J.A,{children:(0,h.jsxs)(l.A,{gap:"xs",children:[(0,h.jsx)(G.A,{}),(0,h.jsxs)(l.A,{gap:"xxs",children:[(0,h.jsx)(L.A.Text,{children:u.toFixed(2)}),(0,h.jsx)(L.A.Text,{type:"secondary",children:"tok/s"})]}),(0,h.jsxs)(l.A,{gap:"xxs",children:[(0,h.jsx)(L.A.Text,{children:d}),(0,h.jsx)(L.A.Text,{type:"secondary",children:"total tokens"})]})]})})})};var Z=t(94558),ee=t(52708),ne=t(76515),te=t(80994);const ie=e=>{let{copyable:n,defaultIcon:t,...i}=e;const[l,a]=(0,g.useState)(!1);return(0,g.useEffect)((()=>{if(l){const e=setTimeout((()=>{a(!1)}),2e3);return()=>clearTimeout(e)}}),[l]),(0,h.jsx)(Z.A,{title:l?"Copied!":"Copy",open:!!l||void 0,children:(0,h.jsx)(te.CopyToClipboard,{text:(null===n||void 0===n?void 0:n.text)||"",onCopy:async()=>{a(!0)},children:(0,h.jsx)(_.Ay,{icon:l?(0,h.jsx)(ee.A,{}):t||(0,h.jsx)(ne.A,{}),...i})})})};var le=t(94281),ae=(t(15148),t(78350)),oe=t(11048),se=t(33532),de=t(81368),re=t(40841),ce=t(47732);const{Text:ue}=L.A,pe=e=>{let{children:n}=e;return(0,h.jsx)(ae.oz,{remarkPlugins:[re.A,ce.A],rehypePlugins:[de.A],components:{p(e){let{node:n,...t}=e;return(0,h.jsx)("p",{...t,style:{whiteSpace:"pre-wrap"}})},code(e){const{children:n,className:t,node:i,ref:l,...a}=e,o=/language-(\w+)/.exec(t||""),s=String(n).replace(/\n$/,"");return o?(0,h.jsx)(le.A,{title:(0,h.jsx)(ue,{style:{fontWeight:"normal"},type:"secondary",children:o[1]}),type:"inner",size:"small",extra:(0,h.jsx)(ie,{type:"text",copyable:{text:"s"}}),styles:{body:{padding:0},header:{margin:0}},children:(0,h.jsx)("div",{style:{margin:"-0.5em 0",width:"100%"},children:(0,h.jsx)(ge,{ref:l,...a,PreTag:"div",language:o[1],style:se.A,wrapLongLines:!0,wrapLines:!0,children:s})})}):(0,h.jsx)("code",{...a,className:t,children:n})}},children:n})},me=e=>{let{children:n,...t}=e;return(0,h.jsx)(oe.A,{...t,children:n})},ge=g.memo(me),he=g.memo(pe);var ve=t(23935),fe=t(5310),ye=t(24365),xe=t(77385),ke=t(89762),je=t.n(ke),Ce=t(82391),be=t.n(Ce),Ae=t(3144),Se=t.n(Ae);je().extend(be()),je().extend(Se());const Ie=e=>{let{extra:n,message:t,placement:i="left",containerStyle:a,enableExtraHover:o,isStreaming:s}=e;const{token:d}=p.A.useToken(),{t:r}=(0,j.Bd)(),[c,u]=(0,g.useState)(!1),m=(0,g.useDeferredValue)(t.reasoning),v=(0,g.useDeferredValue)(t.content);return(0,h.jsxs)(l.A,{direction:"left"===i?"row":"row-reverse",justify:"start",align:"baseline",style:{marginLeft:"left"===i?"0":"15%",marginRight:"right"===i?"0":20,...a},gap:"sm",onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:["user"!==t.role?(0,h.jsx)(ve.A,{icon:"\ud83e\udd16",style:{fontSize:d.fontSizeHeading3}}):null,(0,h.jsxs)(l.A,{direction:"column",align:"left"===i?"start":"end",wrap:"wrap",style:{flex:1},gap:"xs",children:[k().map(t.experimental_attachments,((e,n)=>k().includes(null===e||void 0===e?void 0:e.contentType,"image/")?(0,h.jsx)(l.A,{style:{border:"none",textAlign:"end"},align:"end",children:(0,h.jsx)(fe.A,{src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name,style:{maxWidth:"50vw",maxHeight:"12vh",borderRadius:d.borderRadius}},`${null===t||void 0===t?void 0:t.id}-${n}`)}):(0,h.jsx)(B.A.FileCard,{item:{uid:`${null===t||void 0===t?void 0:t.id}-${n}`,name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.url),type:null===e||void 0===e?void 0:e.contentType,description:null===e||void 0===e?void 0:e.name,url:null===e||void 0===e?void 0:e.url}},n))),(0,h.jsxs)(l.A,{align:"stretch",direction:"column",style:{borderRadius:d.borderRadius,borderColor:d.colorBorderSecondary,borderWidth:d.lineWidth,padding:"1em",paddingTop:0,paddingBottom:0,backgroundColor:"user"!==t.role?d.colorBgContainer:d.colorBgContainerDisabled,maxWidth:"100%",width:k().trim(t.reasoning)?"100%":"auto"},children:[k().trim(t.reasoning)&&(0,h.jsx)(ye.A,{style:{marginTop:d.margin,width:"100%"},items:[{key:"reasoning",label:k().isEmpty(v)?(0,h.jsxs)(l.A,{gap:"xs",children:[(0,h.jsx)(L.A.Text,{children:r("chatui.Thinking")}),(0,h.jsx)(xe.A,{size:"small"})]}):(0,h.jsx)(L.A.Text,{children:r("chatui.ViewReasoning")}),children:(0,h.jsx)(he,{children:m})}]}),(0,h.jsx)(he,{children:v+(s?"\n\u25cf":"")})]}),(0,h.jsx)(l.A,{style:{fontSize:d.fontSizeSM,...o?{opacity:c?1:0,transition:"opacity 0.2s",transitionDelay:c?"0s":"0.2s"}:{}},children:n})]})]})};var we=t(85288),Le=t(25186);const Te=e=>{let{autoScroll:n,atBottom:t,lastMessageContent:i,...l}=e;const a=(0,we.E)(l.onScrollToBottom);return(0,g.useEffect)((()=>{t&&n&&(null===a||void 0===a||a("auto"))}),[t,n,i,a]),(0,h.jsx)(_.Ay,{icon:(0,h.jsx)(Le.A,{}),shape:"circle",onClick:()=>{a&&a("click")}})};var _e=t(12457),Ee=t(2883);const Fe=e=>{let{messages:n,isStreaming:t}=e;const i=(0,g.useRef)(null),[a,o]=(0,g.useState)(!0),{token:s}=p.A.useToken(),d="undefined"!==typeof window?1.5*window.innerHeight:0;return(0,h.jsxs)(l.A,{direction:"column",align:"stretch",style:{height:"100%",flex:1},children:[(0,h.jsx)(Ee.aY,{atBottomStateChange:o,atBottomThreshold:60,computeItemKey:(e,n)=>n.id,data:n,followOutput:"auto",initialTopMostItemIndex:(null===n||void 0===n?void 0:n.length)-1,itemContent:(e,i)=>(0,h.jsx)(Ie,{message:i,placement:"user"===i.role?"right":"left",containerStyle:{paddingLeft:s.paddingMD,paddingRight:s.paddingMD,paddingTop:0===e?s.paddingMD:0,paddingBottom:e===n.length-1?s.paddingMD:0},isStreaming:"user"!==i.role&&t&&e===n.length-1,enableExtraHover:"user"===i.role,extra:"user"!==i.role?(0,h.jsx)(_e.Ay,{children:(0,h.jsx)(ie,{type:"text",size:"small",copyable:{text:i.content}})}):(0,h.jsx)(_e.Ay,{children:null})},i.id),overscan:d,ref:i}),(0,h.jsx)("div",{style:{position:"absolute",right:"50%",transform:"translateX(+50%)",bottom:s.marginSM,opacity:a?0:1,transition:"opacity 0.2s",transitionDelay:a?"0s":"0.2s"},children:(0,h.jsx)(Te,{atBottom:a,autoScroll:t,onScrollToBottom:e=>{const n=i.current;switch(e){case"auto":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"auto",index:"LAST"});break;case"click":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"smooth",index:"LAST"})}},lastMessageContent:k().get(k().last(n),"content")})})]})};var Me=t(53961),Re=t.n(Me);const Ke=(0,g.memo)(Fe,((e,n)=>!!Re()(e.messages,n.messages)&&e.isStreaming===n.isStreaming)),De=(0,g.memo)(Y,((e,n)=>e.input===n.input&&(!!Re()(e.messages,n.messages)&&e.startTime===n.startTime))),$e=e=>{let{messages:n,input:t,isLoading:i,startTime:a}=e;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(Ke,{messages:n,isStreaming:i}),(0,h.jsx)(l.A,{direction:"column",align:"end",children:(0,h.jsx)(De,{messages:n,input:t,startTime:a})})]})};var Be=t(36266),Ue=t(59910),Ve=t(81021),Ne=t(37565);const ze=e=>{let{baseURL:n,token:t,allowCustomModel:i,alert:a,modelId:o,formRef:s}=e;const{token:d}=p.A.useToken();return(0,h.jsx)(l.A,{direction:"row",style:{padding:d.paddingSM,paddingRight:d.paddingContentHorizontalLG,paddingLeft:d.paddingContentHorizontalLG,backgroundColor:d.colorBgContainer,display:i&&"custom"===o?"flex":"none"},children:(0,h.jsxs)(Ue.A,{ref:s,layout:"horizontal",size:"small",requiredMark:"optional",style:{flex:1},initialValues:{baseURL:n,token:t},children:[a?(0,h.jsx)("div",{style:{marginBottom:d.size},children:a}):null,(0,h.jsx)(Ue.A.Item,{label:"baseURL",name:"baseURL",rules:[{type:"url"},{required:!0}],children:(0,h.jsx)(Ve.A,{placeholder:"https://domain/v1"})}),(0,h.jsx)(Ue.A.Item,{label:"Model ID",name:"modelId",rules:[{required:!0}],children:(0,h.jsx)(Ve.A,{placeholder:"llm-model"})}),(0,h.jsx)(Ue.A.Item,{label:"Token",name:"token",children:(0,h.jsx)(Ve.A,{})})]},n)})},qe=e=>{let{onClick:n}=e;const{t:t}=(0,j.Bd)();return(0,h.jsx)(Ne.A,{type:"warning",showIcon:!0,message:t("chatui.CannotFindModel"),action:(0,h.jsx)(_.Ay,{icon:(0,h.jsx)(Be.A,{}),onClick:n,children:t("button.Refresh")})})};var Oe,He=t(16021),Pe=t(36553),Qe=t(74419),We=t(76832);const Xe=(0,We.rU)((e=>{let{token:n,css:t}=e;return{chatCard:t`
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
  `,body:t`
    background-color: ${n.colorFillQuaternary};
    border-radius: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 0;
    height: 50%;
    position: relative;
  `,actions:t`
    padding-left: ${n.paddingContentHorizontal};
    padding-right: ${n.paddingContentHorizontal};
  `,header:t`
    zindex: 1;
  `,alert:t`
    margin: ${n.marginSM};
  `}}));const Ge=g.memo(K,((e,n)=>e.modelId===n.modelId&&(e.endpoint===n.endpoint&&(e.agent===n.agent&&(e.fetchKey===n.fetchKey&&(e.sync===n.sync&&e.closable===n.closable)))))),Je=g.memo(W,((e,n)=>e.input===n.input&&(e.sync===n.sync&&e.isLoading===n.isLoading))),Ye=e=>{var n,i,l,d,r;let{chat:c,selectedEndpoint:u,closable:p,fetchOnClient:m,onRequestClose:v,onCreateNewChat:f}=e;const{styles:{chatCard:y,alert:j,...b}}=Xe(),A=(0,g.useRef)(null),[S,I]=(0,a.Tw)("first"),[w,L]=(0,g.useState)(null),{endpoint:T,setEndpoint:_}=function(e){const[n,i]=(0,g.useState)(e||null);return{endpoint:(0,C.useFragment)(void 0!==Oe?Oe:Oe=t(50555),n),setEndpoint:i}}(u),{models:E,modelId:F,setModelId:M}=function(e,n,t){const{data:i}=(0,o.nj)({queryKey:["models",n,null===t||void 0===t?void 0:t.endpoint_id],queryFn:()=>{var n;return null!==t&&void 0!==t&&t.url?fetch(new URL(e.basePath+"/models",null!==(n=null===t||void 0===t?void 0:t.url)&&void 0!==n?n:void 0).toString()).then((e=>e.json())).catch((e=>({data:[]}))):Promise.resolve({data:[]})}}),l=k().map(null===i||void 0===i?void 0:i.data,(e=>({id:e.id,name:e.id}))),a=(0,g.useMemo)((()=>{var n,t,l;return e.modelId&&k().includes(k().map(null===i||void 0===i?void 0:i.data,"id"),e.modelId)?e.modelId:null!==(n=null===i||void 0===i||null===(t=i.data)||void 0===t||null===(l=t[0])||void 0===l?void 0:l.id)&&void 0!==n?n:"custom"}),[null===i||void 0===i?void 0:i.data,e.modelId]),[s,d]=(0,g.useState)(a);return(0,g.useEffect)((()=>{d(a)}),[a]),{models:l,modelId:s,setModelId:d}}(c.provider,S,T),{agents:R,agent:K,setAgent:D}=function(e){const{agents:n}=(0,s.B)(),[t,i]=(0,g.useState)(void 0),l=(0,g.useMemo)((()=>n.find((n=>n.id===e.agentId))),[n,e.agentId]);return(0,g.useEffect)((()=>{i(l)}),[l]),{agents:n,agent:t,setAgent:i}}(c.provider),[$,B]=(0,g.useState)(c.sync),U=null!==T&&void 0!==T&&T.url?new URL(c.provider.basePath,null!==(n=null===T||void 0===T?void 0:T.url)&&void 0!==n?n:void 0).toString():void 0,V=(0,x.isEmpty)(E),N={baseURL:V?null===(i=A.current)||void 0===i?void 0:i.getFieldValue("baseURL"):U,modelId:V?null===(l=A.current)||void 0===l?void 0:l.getFieldValue("modelId"):F,apiKey:V?null===(d=A.current)||void 0===d?void 0:d.getFieldValue("token"):c.provider.apiKey},{error:z,messages:q,input:O,setInput:H,stop:P,isLoading:Q,append:W,setMessages:X}=(0,Pe.Y_)({id:`${c.id}-${null===T||void 0===T?void 0:T.endpoint_id}-${null!==(r=null===K||void 0===K?void 0:K.id)&&void 0!==r?r:"none"}-${F}`,api:U,credentials:c.provider.credentials,body:{modelId:F},experimental_throttle:100,fetch:async(e,n)=>{if(m||"custom"===F){var t;const e=JSON.parse(null===n||void 0===n?void 0:n.body),i=(0,He.r)({baseURL:N.baseURL,apiKey:N.apiKey||"dummy"}),l=(0,Qe.gM)({abortSignal:(null===n||void 0===n?void 0:n.signal)||void 0,model:(0,Qe.ae)({model:i(N.modelId),middleware:(0,Qe.Ol)({tagName:"think"})}),messages:null===e||void 0===e?void 0:e.messages,system:K&&null!==(t=K.config.system_prompt)&&void 0!==t?t:""});return L(Date.now()),l.toDataStreamResponse({sendReasoning:!0})}return fetch(e,n)}});return(0,h.jsxs)(le.A,{bordered:!0,className:y,classNames:b,title:(0,h.jsx)(Ge,{chat:c,allowCustomModel:V,models:E,modelId:F,setModelId:M,endpoint:T,setEndpoint:_,agents:R,agent:K,setAgent:D,sync:$,setSync:B,fetchKey:S,closable:p,onCreateNewChat:f,onRequestClose:v,setMessages:X}),children:[(0,h.jsx)(ze,{modelId:F,baseURL:U,formRef:A,allowCustomModel:V,alert:A&&(0,h.jsx)(qe,{onClick:()=>I(U)})}),k().isEmpty(null===z||void 0===z?void 0:z.message)?null:(0,h.jsx)(Ne.A,{message:null===z||void 0===z?void 0:z.message,type:"error",showIcon:!0,className:j,closable:!0}),(0,h.jsx)($e,{messages:q,input:O,isLoading:Q,startTime:w}),(0,h.jsx)(Je,{sync:$,input:O,setInput:H,stop:P,append:W,isLoading:Q})]})};var Ze,en=t(33341),nn=t(47059);const tn=(0,We.rU)((e=>{let{token:n,css:t}=e;return{chatView:t`
    overflow: auto;
    height: calc(100vh - 240px);
  `,skeleton:t`
    width: 100%;
    display: flex;
    flex-direction: column;
  `,chatCard:t`
    flex: 1;
    overflow: 'hidden';
  `,conversation:t`
    overflow: hidden;
  `}}));function ln(e,n,t){return{id:e,conversationId:n,label:"Chat",sync:!0,provider:t}}const an=e=>{let{conversation:n,provider:i}=e;const a=function(e){var n,i;const{endpoint:l,endpoint_list:a}=(0,C.useLazyLoadQuery)(void 0!==Ze?Ze:Ze=t(38166),{endpointId:e||"",isEmptyEndpointId:!e});return null!==(n=l.ok?l.value:null===a||void 0===a||null===(i=a.items)||void 0===i?void 0:i[0])&&void 0!==n?n:null}(i.endpointId),o=ln((0,g.useId)(),n.id,i),{list:s,remove:d,push:r}=(0,en.A)([o]),{styles:c}=tn();return(0,h.jsx)(l.A,{className:c.conversation,direction:"column",align:"stretch",gap:"xs",children:(0,h.jsx)(l.A,{className:c.chatView,gap:"xs",direction:"row",align:"stretch",children:(0,x.map)(s,((e,t)=>(0,h.jsx)(g.Suspense,{fallback:(0,h.jsx)(le.A,{className:c.skeleton,bordered:!0,children:(0,h.jsx)(nn.A,{active:!0})}),children:(0,h.jsx)(Ye,{className:c.chatCard,selectedEndpoint:a,chat:e,fetchOnClient:!0,onRequestClose:()=>d(t),onCreateNewChat:()=>{r(ln(s.length.toString(),n.id,i))},closable:s.length>1},t)},t)))})})};var on=t(48587),sn=t(93409);const dn={body:{overflow:"hidden"}},rn=()=>{const[{endpointId:e,modelId:n,agentId:t}]=(0,sn.useQueryParams)({endpointId:sn.StringParam,agentId:sn.StringParam,modelId:sn.StringParam}),l={id:(0,g.useId)(),label:(0,on.t)("webui.menu.Chat"),chats:[]},a={basePath:"v1",agentId:null!==t&&void 0!==t?t:void 0,endpointId:null!==e&&void 0!==e?e:void 0,modelId:null!==n&&void 0!==n?n:void 0};return(0,h.jsx)(i.A,{title:(0,on.t)("webui.menu.Chat"),styles:dn,children:(0,h.jsx)(an,{conversation:l,provider:a})})}}}]);
//# sourceMappingURL=4104.fc49d9ff.chunk.js.map