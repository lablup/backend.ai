"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[6560],{8570:(e,n,t)=>{t.d(n,{Ay:()=>j,r2:()=>C});var a=t(72375),l=t(72338),s=t(71515),r=t(51847),i=t(9571),o=t(65196),u=t(1581),d=t(82919),c=t(78186),p=t(83978),g=t(24798),m=t(52335),y=t(46976),f=t.n(y),S=t(53350),k=t(91788),v=t(60598);const F={string:"ilike",boolean:"=="},h={boolean:[{label:"True",value:"true"},{label:"False",value:"false"}],string:void 0},b={boolean:!0};function C(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&";const t=f().join(f().map((0,a.LY)(e),(e=>`(${e})`)),n);return t||void 0}const j=e=>{var n;let{filterProperties:t,value:a,onChange:y,defaultValue:C,loading:j,..._}=e;const[x,A]=(0,S.useState)(),T=(0,S.useRef)(null),[L,K]=(0,S.useState)(!1),[N,w]=(0,r.A)({value:a,defaultValue:C,onChange:y}),$=(0,S.useMemo)((()=>{if(void 0===N||""===N)return[];return N.split("&").map((e=>e.trim())).map(((e,n)=>{var a,l;const{property:s,operator:r,value:i}=function(e){const[n,...t]=e.split(/\s+(?=(?:(?:[^"]*"){2})*[^"]*$)/),[a,...l]=t.join(" ").split(/\s+(?=(?:(?:[^"]*"){2})*[^"]*$)/);return{property:n,operator:a,value:l.join(" ").replace(/^"|"$/g,"")}}(e);return{key:n+i,property:s,operator:r,value:i,propertyLabel:(null===(a=f().find(t,(e=>e.key===s)))||void 0===a?void 0:a.propertyLabel)||s,type:(null===(l=f().find(t,(e=>e.key===s)))||void 0===l?void 0:l.type)||"string"}}))}),[N,t]),{t:I}=(0,k.Bd)(),E=f().map(t,(e=>({label:e.propertyLabel,value:e.key,filter:e}))),[R,P]=(0,S.useState)(E[0].filter),{token:D}=i.A.useToken(),[V,z]=(0,S.useState)(!0),[q,M]=(0,S.useState)(!1),O=e=>{if(0===e.length)w(void 0);else{const n=f().map(e,(e=>{const n="string"===e.type?`"${e.value}"`:e.value;return`${e.property} ${e.operator} ${n}`}));w(function(e,n){return e.join(` ${n} `)}(n,"&"))}},U=e=>{var n,t,a;if(f().isEmpty(e))return;if(R.strictSelection||b[R.type]){if(!f().find(R.options||h[R.type],(n=>n.value===e)))return}const l=!(null!==(n=R.rule)&&void 0!==n&&n.validate)||R.rule.validate(e);if(z(l),!l)return;A("");const s=R.defaultOperator||F[R.type],r="ilike"===s||"like"===s?`%${e}%`:`${e}`;var i;i={property:R.key,propertyLabel:R.propertyLabel,operator:s,value:r,label:null===(t=R.options)||void 0===t||null===(a=t.find((n=>n.value===e)))||void 0===a?void 0:a.label,type:R.type},O([...$,i])};return(0,v.jsxs)(l.A,{direction:"column",gap:"xs",style:{flex:1},align:"start",children:[(0,v.jsxs)(o.A.Compact,{children:[(0,v.jsx)(u.A,{popupMatchSelectWidth:!1,options:E,value:R.key,onChange:(e,n)=>{P(f().castArray(n)[0].filter)},onSelect:()=>{var e;null===(e=T.current)||void 0===e||e.focus(),K(!0),z(!0)},showSearch:!0,optionFilterProp:"label"}),(0,v.jsx)(d.A,{title:V||!q?"":null===(n=R.rule)||void 0===n?void 0:n.message,open:!V&&q,color:D.colorError,children:(0,v.jsx)(c.A,{ref:T,value:x,open:L,onDropdownVisibleChange:K,onSelect:U,onChange:e=>{z(!0),A(e)},style:{minWidth:200},options:f().filter(R.options||h[R.type],(e=>{var n;return!x||(null===(n=e.label)||void 0===n?void 0:n.toString().includes(x))})),placeholder:I("propertyFilter.PlaceHolder"),onBlur:()=>{M(!1)},onFocus:()=>{M(!0)},children:(0,v.jsx)(p.A.Search,{onSearch:U,allowClear:!0,status:!V&&q?"error":void 0})})})]}),$.length>0&&(0,v.jsxs)(l.A,{direction:"row",gap:"xs",wrap:"wrap",style:{alignSelf:"stretch"},children:[f().map($,(e=>{return(0,v.jsxs)(g.A,{closable:!0,onClose:()=>(e=>{const n=$.filter((n=>n.key!==e));O(n)})(e.key),style:{margin:0},children:[e.propertyLabel,": ",(n=e.value,n.replace(/^%|%$/g,""))]},e.key);var n})),$.length>1&&(0,v.jsx)(d.A,{title:I("propertyFilter.ResetFilter"),children:(0,v.jsx)(m.Ay,{size:"small",icon:(0,v.jsx)(s.A,{style:{color:D.colorTextSecondary}}),type:"text",onClick:()=>{O([])}})})]})]})}},74009:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionSlotCellFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"requested_slots",storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"39927d6fcf4a8ce5c71769155ce2a7a4"},l=a},29093:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const a={argumentDefinitions:[],kind:"Fragment",metadata:{plural:!0},name:"SessionNodesFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},action:"NONE",path:"row_id"},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{args:null,kind:"FragmentSpread",name:"SessionStatusTagFragment"},{args:null,kind:"FragmentSpread",name:"SessionReservationFragment"},{args:null,kind:"FragmentSpread",name:"SessionSlotCellFragment"},{args:null,kind:"FragmentSpread",name:"SessionUsageMonitorFragment"}],type:"ComputeSessionNode",abstractKey:null,hash:"bdc7ae5235b75dfbe3d856167333a079"},l=a},76560:(e,n,t)=>{t.r(n),t.d(n,{default:()=>U});var a,l=t(97759),s=t(8570),r=t(72338),i=t(72375),o=t(8699),u=t(61207),d=t(7971),c=t(50128),p=t(40056),g=t(46976),m=t.n(g),y=t(53350),f=t(22018),S=t(60598);const k=e=>{let{type:n,sessionFrgmt:l,mode:s="requested"}=e;const{deviceMetadata:r}=(0,d.Hv)(),o=(0,f.useFragment)(void 0!==a?a:a=t(74009),l),u=JSON.parse(("occupied"===s?o.occupied_slots:o.requested_slots)||"{}");var g;if("cpu"===n)return null!==(g=u.cpu)&&void 0!==g?g:"-";if("mem"===n){var k,v;const e=null!==(k=u.mem)&&void 0!==k?k:"-";return"-"===e?e:(null===(v=(0,i.Is)(e,"G"))||void 0===v?void 0:v.number)+" GiB"}if("accelerator"===n){const e=m().omit(u,["cpu","mem"]);return m().isEmpty(e)?"-":m().map(e,((e,n)=>{var t;return(0,S.jsxs)(y.Fragment,{children:[(0,S.jsx)(c.A.Text,{children:e}),(0,S.jsx)(p.A,{type:"vertical"}),(0,S.jsx)(c.A.Text,{children:null===r||void 0===r||null===(t=r[n])||void 0===t?void 0:t.human_readable_name})]},n)}))}};var v,F=t(5415),h=t(23492),b=t(95950),C=t(29471),j=t(91788);const _=e=>{let{sessionsFrgmt:n,...a}=e;const{t:s}=(0,j.Bd)(),[d,c]=(0,y.useState)(),{token:p}=C.w4.useToken(),g=(0,f.useFragment)(void 0!==v?v:v=t(29093),n),m=(0,i.tS)(g);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(o.A,{resizable:!0,neoStyle:!0,rowKey:e=>e.row_id,size:"small",dataSource:m,scroll:{x:"max-content"},columns:[{key:"name",title:s("session.SessionName"),dataIndex:"name",render:(e,n)=>(0,S.jsx)(l.A,{to:"#",type:"hover",onClick:e=>{n.row_id&&c(n.row_id)},children:e}),sorter:!0},{key:"status",title:s("session.Status"),dataIndex:"status",render:(e,n)=>(0,S.jsx)(F.A,{sessionFrgmt:n})},{key:"utils",title:s("session.Utilization"),render:(e,n)=>(0,S.jsx)(r.A,{style:{paddingLeft:p.paddingXS},children:(0,S.jsx)(b.A,{size:"small",sessionFrgmt:n})})},{key:"accelerator",title:s("session.launcher.AIAccelerator"),render:(e,n)=>(0,S.jsx)(k,{sessionFrgmt:n,type:"accelerator"})},{key:"cpu",title:s("session.launcher.CPU"),render:(e,n)=>(0,S.jsx)(k,{sessionFrgmt:n,type:"cpu"})},{key:"mem",title:s("session.launcher.Memory"),render:(e,n)=>(0,S.jsx)(k,{sessionFrgmt:n,type:"mem"})},{key:"elapsedTime",title:s("session.ElapsedTime"),render:(e,n)=>(0,S.jsx)(u.A,{mode:"simple-elapsed",sessionFrgmt:n})}],...a}),(0,S.jsx)(h.A,{open:!d,sessionId:d,onClose:()=>{c(void 0)}})]})};var x=t(23441),A=t(54690),T=t(81530),L=t(21110),K=t(7322),N=t(44452),w=t(32043);const $=(0,L.eU)({});var I,E=t(50332),R=t(2667),P=t(9571),D=t(20418),V=t(52335),z=t(81529),q=t(9712),M=t(49978),O=t(58668);const U=()=>{var e;const n=(0,T.hd)(),{t:a}=(0,j.Bd)(),{token:o}=P.A.useToken(),{baiPaginationOption:u,tablePaginationOption:d,setTablePaginationOption:c}=(0,A.w4)({current:1,pageSize:10}),[p,g]=(0,y.useTransition)(),[k,v]=(0,y.useTransition)(),[F,h]=(0,y.useTransition)(),[b,C]=function(e){const[n,t]=(0,w.useQueryParams)(e),a=(0,y.useMemo)((()=>(0,N.t_)((t=>{const a=t($),l=m().pick(a,Object.keys(e));return m().isEmpty(l)?n:l}))),[JSON.stringify(e)]);let l=(0,K.md)(a);const s=(0,K.Xr)($),r=(0,y.useCallback)(((e,n)=>{const a="function"===typeof e?e(l):e;s("replaceIn"===n||"pushIn"===n?e=>({...e,...a}):a),t(a,n)}),[l,t,s]);return[l,r]}({order:w.StringParam,filter:w.StringParam,type:(0,w.withDefault)(w.StringParam,"all"),statusCategory:(0,w.withDefault)(w.StringParam,"running")}),L=(0,y.useRef)({[b.type]:b});L.current[b.type]=b;const U="all"===b.type||void 0===b.type?void 0:`type == "${b.type}"`,B="running"===b.statusCategory||void 0===b.statusCategory?'status != "TERMINATED" & status != "CANCELLED"':'status == "TERMINATED" | status == "CANCELLED"',[Q,W]=(0,x.Tw)("first"),{compute_session_nodes:H,allRunningSessionForCount:X}=(0,f.useLazyLoadQuery)(void 0!==I?I:I=t(34474),{projectId:n.id,offset:u.offset,first:u.first,filter:(0,s.r2)([B,b.filter,U]),order:b.order,runningTypeFilter:'status != "TERMINATED" & status != "CANCELLED"'},{fetchPolicy:"network-only",fetchKey:Q});return(0,E.$)((()=>{(0,y.startTransition)((()=>{W()}))}),15e3),(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)(D.A,{bordered:!1,title:a("webui.menu.Sessions"),extra:[(0,S.jsx)(l.A,{to:"/session/start",children:(0,S.jsx)(V.Ay,{type:"primary",children:a("session.launcher.Start")})},"start-session")],styles:{header:{borderBottom:"none"},body:{paddingTop:0}},children:[(0,S.jsx)(z.A,{type:"card",activeKey:b.type,onChange:e=>{h((()=>{const n=L.current[e]||{statusCategory:"running"};C({...n,type:e},"replace"),c({current:1})}))},items:m().map({all:a("general.All"),interactive:a("session.Interactive"),batch:a("session.Batch"),inference:a("session.Inference"),system:a("session.System")},((e,n)=>({key:n,label:(0,S.jsxs)(r.A,{justify:"center",gap:10,children:[e,"all"===n&&(0,S.jsx)(q.A,{count:null===X||void 0===X?void 0:X.count,color:o.colorPrimary,size:"small",showZero:!0,style:{paddingRight:o.paddingXS,paddingLeft:o.paddingXS,fontSize:10}})]})})))}),(0,S.jsx)(M.A,{spinning:F,indicator:(0,S.jsx)(R.A,{}),children:(0,S.jsxs)(r.A,{direction:"column",align:"stretch",gap:"sm",children:[(0,S.jsxs)(r.A,{gap:"sm",align:"start",children:[(0,S.jsx)(O.Ay.Group,{optionType:"button",value:b.statusCategory,onChange:e=>{v((()=>{C({statusCategory:e.target.value},"replaceIn"),c({current:1})}))},options:[{label:"Running",value:"running"},{label:"Finished",value:"finished"}]}),(0,S.jsx)(s.Ay,{filterProperties:[{key:"name",propertyLabel:a("session.SessionName"),type:"string"}],value:b.filter||void 0,onChange:e=>{v((()=>{C({filter:e},"replaceIn"),c({current:1})}))}})]}),(0,S.jsx)(_,{rowSelection:"finished"!==b.statusCategory?{type:"checkbox"}:void 0,sessionsFrgmt:(0,i.tS)(null===H||void 0===H?void 0:H.edges.map((e=>null===e||void 0===e?void 0:e.node))),pagination:{pageSize:d.pageSize,current:d.current,total:null!==(e=null===H||void 0===H?void 0:H.count)&&void 0!==e?e:0},loading:{spinning:p||k,indicator:(0,S.jsx)(R.A,{})},onChange:(e,n,t)=>{let{current:a,pageSize:l}=e;g((()=>{m().isNumber(a)&&m().isNumber(l)&&c({current:a,pageSize:l}),C({order:(0,i.Wh)(t)},"replaceIn")}))}})]})})]})})}},34474:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const a=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:20,kind:"LocalArgument",name:"first"},t={defaultValue:0,kind:"LocalArgument",name:"offset"},a={defaultValue:null,kind:"LocalArgument",name:"order"},l={defaultValue:null,kind:"LocalArgument",name:"projectId"},s={defaultValue:null,kind:"LocalArgument",name:"runningTypeFilter"},r={kind:"Variable",name:"project_id",variableName:"projectId"},i=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"first",variableName:"first"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"order",variableName:"order"},r],o={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"count",storageKey:null},d={alias:"allRunningSessionForCount",args:[{kind:"Variable",name:"filter",variableName:"runningTypeFilter"},{kind:"Literal",name:"first",value:0},{kind:"Literal",name:"offset",value:0},r],concreteType:"ComputeSessionConnection",kind:"LinkedField",name:"compute_session_nodes",plural:!1,selections:[u],storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null};return{fragment:{argumentDefinitions:[e,n,t,a,l,s],kind:"Fragment",metadata:null,name:"ComputeSessionListPageQuery",selections:[{alias:null,args:i,concreteType:"ComputeSessionConnection",kind:"LinkedField",name:"compute_session_nodes",plural:!1,selections:[{kind:"RequiredField",field:{alias:null,args:null,concreteType:"ComputeSessionEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{kind:"RequiredField",field:{alias:null,args:null,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"node",plural:!1,selections:[o,{args:null,kind:"FragmentSpread",name:"SessionNodesFragment"}],storageKey:null},action:"THROW",path:"compute_session_nodes.edges.node"}],storageKey:null},action:"THROW",path:"compute_session_nodes.edges"},u],storageKey:null},d],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,n,t,e,a,s],kind:"Operation",name:"ComputeSessionListPageQuery",selections:[{alias:null,args:i,concreteType:"ComputeSessionConnection",kind:"LinkedField",name:"compute_session_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSessionEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"node",plural:!1,selections:[o,{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"starts_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null},c,{alias:null,args:null,kind:"ScalarField",name:"requested_slots",storageKey:null},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"live_stat",storageKey:null},c,o],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},u],storageKey:null},d]},params:{cacheID:"53ddd2fdeb112865b101e3f758bf089d",id:null,metadata:{},name:"ComputeSessionListPageQuery",operationKind:"query",text:"query ComputeSessionListPageQuery(\n  $projectId: UUID!\n  $first: Int = 20\n  $offset: Int = 0\n  $filter: String\n  $order: String\n  $runningTypeFilter: String!\n) {\n  compute_session_nodes(project_id: $projectId, first: $first, offset: $offset, filter: $filter, order: $order) {\n    edges {\n      node {\n        id\n        ...SessionNodesFragment\n      }\n    }\n    count\n  }\n  allRunningSessionForCount: compute_session_nodes(project_id: $projectId, first: 0, offset: 0, filter: $runningTypeFilter) {\n    count\n  }\n}\n\nfragment SessionNodesFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  ...SessionStatusTagFragment\n  ...SessionReservationFragment\n  ...SessionSlotCellFragment\n  ...SessionUsageMonitorFragment\n}\n\nfragment SessionReservationFragment on ComputeSessionNode {\n  id\n  created_at\n  starts_at\n  terminated_at\n}\n\nfragment SessionSlotCellFragment on ComputeSessionNode {\n  id\n  occupied_slots\n  requested_slots\n}\n\nfragment SessionStatusTagFragment on ComputeSessionNode {\n  id\n  name\n  status\n  status_info\n}\n\nfragment SessionUsageMonitorFragment on ComputeSessionNode {\n  kernel_nodes {\n    edges {\n      node {\n        live_stat\n        occupied_slots\n        id\n      }\n    }\n  }\n}\n"}}}();a.hash="6c1c06bb33de91c3f187ac06efe71e20";const l=a}}]);
//# sourceMappingURL=6560.702064d2.chunk.js.map