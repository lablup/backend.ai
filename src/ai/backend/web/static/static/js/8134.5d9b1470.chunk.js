"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[8134],{47990:(e,n,a)=>{a.d(n,{Ay:()=>h,tt:()=>f,uD:()=>y});var o=a(56276),t=a(11863),s=a(40690),l=a(94010),r=a(30782),i=a(42338),u=a(47699),d=a.n(u),c=(a(17534),a(62962)),m=a(89374);const p=["name"],g=["inValid","value"],v=1024,_=65535,y=e=>{let{inValid:n,value:a}=e,s=(0,t.A)(e,g);return(0,m.jsx)(i.A,(0,o.A)({color:!n&&F(a)?void 0:"red"},s))},F=e=>{if(S(e)){const n=e.split(":"),[a,o]=n.map((e=>parseInt(e)));return a>=v&&o<=_}return e===parseInt(e).toString()&&parseInt(e)>=v&&parseInt(e)<=_},S=e=>{const n=e.split(":");if(2===n.length){const[e,a]=n.map((e=>parseInt(e)));return e<=a}return!1},f=e=>d().flatten(d().map(e,(e=>S(e)?(e=>{const[n,a]=e.split(":").map((e=>parseInt(e)));return d().range(n,a+1)})(e):parseInt(e)))),h=e=>{let{name:n="ports"}=e,a=(0,t.A)(e,p);const{t:i}=(0,c.Bd)(),u=(0,s.CX)(),g=l.A.useFormInstance();return(0,m.jsx)(l.A.Item,(0,o.A)((0,o.A)({label:i("session.launcher.PreOpenPortTitle"),name:n,tooltip:(0,m.jsx)(c.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:i("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,n)=>f(n).length<=u._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(i("session.launcher.PreOpenPortMaxCountLimit",{count:u._config.maxCountForPreopenPorts})))}),()=>({validator:(e,n)=>d().every(n,(e=>parseInt(e).toString()===e||S(e)))?Promise.resolve():Promise.reject(new Error(i("session.launcher.InvalidPortFormat")))}),()=>({validator(e,n){const a=f(n);return d().every(a,(e=>e>=v&&e<=_))?Promise.resolve():Promise.reject(new Error(i("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,n){const a=f(n);return d().uniq(a).length===a.length?Promise.resolve():Promise.reject(new Error(i("session.launcher.DuplicatedPort")))}})]},a),{},{children:(0,m.jsx)(r.A,{mode:"tags",tagRender:e=>{const a=d().filter(f(g.getFieldValue(n)),(n=>n===parseInt(e.value))).length>1;return(0,m.jsx)(y,{inValid:a,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})}))}},68134:(e,n,a)=>{a.d(n,{G:()=>_});var o=a(56276);const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],n=[{kind:"Variable",name:"id",variableName:"id"}],a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useStartSessionCreationQuery",selections:[{alias:null,args:n,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"BAINodeNotificationItemFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useStartSessionCreationQuery",selections:[{alias:null,args:n,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[a,{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[o,t,s,l,{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commit_status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"agent_id",storageKey:null},a,l,{alias:null,args:null,kind:"ScalarField",name:"cluster_idx",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_role",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_hostname",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"vfolder_mounts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_data",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"queue_position",storageKey:null}],type:"ComputeSessionNode",abstractKey:null},{kind:"InlineFragment",selections:[o,t,l,s],type:"VirtualFolderNode",abstractKey:null}],type:"Node",abstractKey:"__isNode"}],storageKey:null}]},params:{cacheID:"df17bc758f108f787c21e9ee6bba0257",id:null,metadata:{},name:"useStartSessionCreationQuery",operationKind:"query",text:'query useStartSessionCreationQuery(\n  $id: GlobalIDField!\n) {\n  compute_session_node(id: $id) {\n    ...BAINodeNotificationItemFragment\n    id\n  }\n}\n\nfragment AppLauncherModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  service_ports\n  access_key\n}\n\nfragment BAIComputeSessionNodeNotificationItemFragment on ComputeSessionNode {\n  row_id\n  id\n  name\n  status\n  ...SessionActionButtonsFragment\n  ...SessionStatusTagFragment\n}\n\nfragment BAINodeNotificationItemFragment on Node {\n  __isNode: __typename\n  ... on ComputeSessionNode {\n    __typename\n    status\n    name\n    row_id\n    ...BAIComputeSessionNodeNotificationItemFragment\n  }\n  ... on VirtualFolderNode {\n    __typename\n    status\n    ...BAIVirtualFolderNodeNotificationItemFragment\n  }\n  id\n}\n\nfragment BAIVirtualFolderNodeNotificationItemFragment on VirtualFolderNode {\n  row_id\n  id\n  name\n  status\n}\n\nfragment ContainerCommitModalFragment on ComputeSessionNode {\n  id\n  name\n  row_id\n}\n\nfragment ContainerLogModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  status\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        id\n        row_id\n        container_id\n        cluster_idx\n        cluster_role\n        cluster_hostname\n      }\n    }\n  }\n}\n\nfragment SFTPConnectionInfoModalFragment on ComputeSessionNode {\n  row_id\n  vfolder_mounts\n}\n\nfragment SessionActionButtonsFragment on ComputeSessionNode {\n  id\n  name\n  row_id\n  type\n  status\n  access_key\n  service_ports\n  commit_status\n  user_id\n  ...TerminateSessionModalFragment\n  ...ContainerLogModalFragment\n  ...ContainerCommitModalFragment\n  ...AppLauncherModalFragment\n  ...SFTPConnectionInfoModalFragment\n  ...useBackendAIAppLauncherFragment\n}\n\nfragment SessionStatusTagFragment on ComputeSessionNode {\n  id\n  status\n  status_info\n  status_data\n  queue_position @since(version: "25.13.0")\n}\n\nfragment TerminateSessionModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  scaling_group\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        container_id\n        agent_id\n        id\n      }\n    }\n  }\n}\n\nfragment useBackendAIAppLauncherFragment on ComputeSessionNode {\n  name\n  row_id\n  vfolder_mounts\n}\n'}}}();t.hash="7a350248b5a833005f531bd8caa3adec";const s=t;var l=a(40690),r=a(86167),i=a(81109),u=a(67631),d=a(47699),c=a.n(d),m=a(62962),p=a(46336),g=a(47990),v=a(85653);const _=()=>{var e,n;const{t:a}=(0,m.Bd)(),t=(0,i.hd)(),{upsertNotification:d}=(0,r.js)(),_=(0,p.useRelayEnvironment)(),S=(0,l.CX)(),f=S.supports("mount-by-id"),h=null!==(e=null===S||void 0===S?void 0:S.supports("batch-timeout"))&&void 0!==e&&e,[k]=(0,i.zL)(),b=(0,o.A)((0,o.A)((0,o.A)({sessionType:"interactive",allocationPreset:"auto-select",hpcOptimization:{autoEnabled:!0},batch:(0,o.A)({enabled:!1,command:void 0,scheduleDate:void 0},h&&{timeoutEnabled:!1,timeout:void 0,timeoutUnit:"s"}),envvars:[]},(null===(n=S._config)||void 0===n?void 0:n.default_session_environment)&&{environments:F(S._config.default_session_environment)}),c().omit(v.jh,["resource"])),{},{resourceGroup:k||void 0}),N=async e=>{var n,s,l,r,i,d,m,p,v,_,F,k,b,N;const A=e.environments.manual||e.environments.version,[C,I]=A?A.split("@"):["",""],w={sessionName:c().isEmpty(e.sessionName)?y():e.sessionName,kernelName:C,architecture:I,resources:(0,o.A)((0,o.A)((0,o.A)((0,o.A)((0,o.A)({enqueueOnly:!0,group_name:null!==(n=e.owner)&&void 0!==n&&n.enabled?e.owner.project:t.name,domain:null!==(s=e.owner)&&void 0!==s&&s.enabled?e.owner.domainName:S._config.domainName,type:e.sessionType,cluster_mode:e.cluster_mode,cluster_size:e.cluster_size,maxWaitSeconds:15},null!==(l=e.owner)&&void 0!==l&&l.enabled?{owner_access_key:e.owner.accesskey}:{}),"batch"===e.sessionType?{starts_at:e.batch.enabled?e.batch.scheduleDate:void 0,startupCommand:e.batch.command}:{}),e.bootstrap_script?{bootstrap_script:e.bootstrap_script}:{}),h&&null!==e&&void 0!==e&&null!==(r=e.batch)&&void 0!==r&&r.timeoutEnabled&&!c().isUndefined(null===e||void 0===e||null===(i=e.batch)||void 0===i?void 0:i.timeout)?{batchTimeout:c().toString(e.batch.timeout)+(null===e||void 0===e||null===(d=e.batch)||void 0===d?void 0:d.timeoutUnit)}:void 0),{},{config:(0,o.A)((0,o.A)((0,o.A)({},(null===e||void 0===e?void 0:e.resource)&&{resources:(0,o.A)({cpu:null===e||void 0===e||null===(m=e.resource)||void 0===m?void 0:m.cpu,mem:null===e||void 0===e||null===(p=e.resource)||void 0===p?void 0:p.mem},null!==(v=e.resource)&&void 0!==v&&v.acceleratorType&&null!==(_=e.resource)&&void 0!==_&&_.accelerator&&(null===(F=e.resource)||void 0===F?void 0:F.accelerator)>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0)}),{},{scaling_group:null!==(k=e.owner)&&void 0!==k&&k.enabled?e.owner.project:e.resourceGroup},(null===e||void 0===e?void 0:e.resource)&&{resource_opts:{shmem:null===e||void 0===e||null===(b=e.resource)||void 0===b?void 0:b.shmem}}),{},{[f?"mount_ids":"mounts"]:e.mount_ids,[f?"mount_id_map":"mount_map"]:e.mount_id_map,environ:(0,o.A)((0,o.A)({},c().fromPairs(e.envvars.map((e=>[e.variable,e.value])))),e.hpcOptimization.autoEnabled?{}:c().omit(e.hpcOptimization,"autoEnabled")),preopen_ports:(0,g.tt)(e.ports)},!S.supports("agent-select")||null!==S&&void 0!==S&&null!==(N=S._config)&&void 0!==N&&N.hideAgents||void 0===e.agent||c().isEqual(c().castArray(e.agent),["auto"])?void 0:{agent_list:c().chain(e.agent).castArray().filter((e=>!!e)).value()})})},K=c().map(c().range(e.num_of_sessions||1),(n=>{const o=(e.num_of_sessions||1)>1?"".concat(w.sessionName,"-").concat((0,u.kX)(),"-").concat(n):w.sessionName;return S.createIfNotExists(w.kernelName,o,null===w||void 0===w?void 0:w.resources,void 0,w.architecture).then((e=>e)).catch((e=>{var n;throw null!==e&&void 0!==e&&null!==(n=e.message)&&void 0!==n&&n.includes("The session already exists")?new Error(a("session.launcher.SessionAlreadyExists")):e}))}));return Promise.allSettled(K).then((async e=>c().groupBy(e,"status")))};return{startSession:N,startSessionWithDefault:e=>{const n=c().merge({},b,e);return N(n)},defaultFormValues:b,upsertSessionNotification:async(e,n)=>{const a=c().map(e,(e=>{const a=e.value;return(0,p.fetchQuery)(_,s,{id:(0,u.wc)("ComputeSessionNode",a.sessionId)}).toPromise().then((e=>{var t;const s=null!==(t=null===e||void 0===e?void 0:e.compute_session_node)&&void 0!==t?t:null;s&&d((0,o.A)({key:"".concat("session-launcher:").concat(a.sessionId),node:s,open:!0,duration:0},null===n||void 0===n?void 0:n[0]),null===n||void 0===n?void 0:n[1])}))}));return Promise.allSettled(a)}}},y=()=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let a=0;a<8;a++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},F=e=>e.includes(":")?{version:e}:{environment:e}}}]);
//# sourceMappingURL=8134.5d9b1470.chunk.js.map