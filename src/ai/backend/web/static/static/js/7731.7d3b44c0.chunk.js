"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[7731],{41610:(e,n,s)=>{s.d(n,{A:()=>u});var l=s(89130),a=s(50868),i=s(85690),t=s(89608),r=s.n(t),o=(s(43373),s(73689));const u=e=>{let{title:n,valueLabel:s,percent:t=0,width:u,strokeColor:d,labelStyle:c,size:m="small"}=e;const{token:g}=a.A.useToken(),p="small"===m?g.fontSizeSM:"middle"===m?g.fontSize:g.fontSizeLG;return(0,o.jsxs)(l.A,{style:{padding:1,border:`1px solid ${g.colorBorder}`,borderRadius:3,backgroundColor:g.colorBgContainerDisabled,...r().isNumber(u)||r().isString(u)?{width:u}:{flex:1}},direction:"column",align:"stretch",children:[(0,o.jsx)(l.A,{style:{height:"100%",width:`${t>100?100:t}%`,position:"absolute",left:0,top:0,backgroundColor:null!==d&&void 0!==d?d:g.colorSuccess,opacity:.7,zIndex:0,overflow:"hidden"}}),(0,o.jsxs)(l.A,{direction:"row",justify:"between",children:[(0,o.jsx)(i.A.Text,{style:{fontSize:p,...c},children:n}),(0,o.jsx)(i.A.Text,{style:{fontSize:p,...c},children:s})]})]})}},56702:(e,n,s)=>{s.r(n),s.d(n,{default:()=>a});const l={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionInfoCellFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null}],type:"ComputeSession",abstractKey:null,hash:"93f8cd0d4b47d24ea281955be0ad792b"},a=l},89788:(e,n,s)=>{s.r(n),s.d(n,{default:()=>a});const l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"ak"},n={defaultValue:null,kind:"LocalArgument",name:"group_id"},s={defaultValue:null,kind:"LocalArgument",name:"limit"},l={defaultValue:null,kind:"LocalArgument",name:"offset"},a={defaultValue:null,kind:"LocalArgument",name:"skipClusterSize"},i={defaultValue:null,kind:"LocalArgument",name:"status"},t=[{kind:"Variable",name:"access_key",variableName:"ak"},{kind:"Variable",name:"group_id",variableName:"group_id"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"status",variableName:"status"}],r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},A={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"starts_at",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"agents",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null};return{fragment:{argumentDefinitions:[e,n,s,l,a,i],kind:"Fragment",metadata:null,name:"SessionListQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,m,g,p,x,y,h,k,S,f,A,j,v,_,b,{args:null,kind:"FragmentSpread",name:"SessionInfoCellFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[s,l,e,n,i,a],kind:"Operation",name:"SessionListQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,m,g,p,x,y,h,k,S,f,A,j,v,_,b,{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"83e3fabcd47538a643850d50617579a5",id:null,metadata:{},name:"SessionListQuery",operationKind:"query",text:"query SessionListQuery(\n  $limit: Int!\n  $offset: Int!\n  $ak: String\n  $group_id: String\n  $status: String\n  $skipClusterSize: Boolean!\n) {\n  compute_session_list(limit: $limit, offset: $offset, access_key: $ak, group_id: $group_id, status: $status) {\n    items {\n      id\n      type\n      session_id\n      name\n      image\n      architecture\n      created_at\n      terminated_at\n      status\n      status_info\n      service_ports\n      mounts\n      occupied_slots\n      resource_opts\n      access_key\n      starts_at\n      scaling_group\n      agents\n      cluster_size @skipOnClient(if: $skipClusterSize)\n      ...SessionInfoCellFragment\n    }\n  }\n}\n\nfragment SessionInfoCellFragment on ComputeSession {\n  id\n  session_id\n  name\n  status\n  user_email\n  image\n}\n"}}}();l.hash="b0859dbf2946abcb56ec83ac42d76781";const a=l},67731:(e,n,s)=>{s.r(n),s.d(n,{default:()=>Q});var l=s(58879),a=s(15634),i=s(9194),t=s(41610),r=s(89130),o=s(19675),u=s(65666),d=s(40567),c=s(55368),m=s(33789),g=s(60822),p=s(43373),x=s(73689);const y=()=>{var e,n,s,y;const h=(0,a.hd)(),[k,S]=(0,p.useState)(),f=(0,p.useDeferredValue)(k),[{remaining:A,resourceLimits:j,resourceGroupResourceSize:v}]=(0,i.y)({currentProjectName:h.name,currentResourceGroup:f||"default"});return console.log(typeof A.mem,A.mem),(0,x.jsx)(c.A,{title:(0,x.jsxs)(r.A,{direction:"row",gap:"xs",children:[(0,x.jsx)(o.A,{showSearch:!0,style:{minWidth:100},onChange:e=>S(e),loading:k!==f,popupMatchSelectWidth:!1})," ","\ub9ac\uc18c\uc2a4 \uadf8\ub8f9 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc790\uc6d0",(0,x.jsx)(m.A,{title:"\uc120\ud0dd\ud55c \ub9ac\uc18c\uc2a4 \uadf8\ub8f9\uc5d0\uc11c \ud604\uc7ac \uc0ac\uc6a9\uc790\uac00 \uc9c0\uae08 \ubc14\ub85c \uc0ac\uc6a9\uac00\ub2a5\ud55c \ub9ac\uc18c\uc2a4 \uc591\uc73c\ub85c \ud604\uc7ac \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc801\uc6a9\ub418\ub294 \ub9ac\uc18c\uc2a4 \uc815\ucc45\uacfc \ub9ac\uc18c\uc2a4 \uadf8\ub8f9\uc758 \uac00\uc6a9\uc591\uc5d0 \ub530\ub77c \uacb0\uc815\ub429\ub2c8\ub2e4.",children:(0,x.jsx)(u.A,{})})]}),extra:[(0,x.jsx)(g.Ay,{icon:(0,x.jsx)(d.A,{}),type:"text"})],children:(0,x.jsxs)(r.A,{gap:"md",children:[(0,x.jsx)(t.A,{title:"CPU",percent:A.cpu/(j.cpu?j.cpu.max:v.cpu)*100,valueLabel:A.cpu+" Core"}),(0,x.jsx)(t.A,{title:"MEM",percent:((null===(e=(0,l.Js)(A.mem+"","m"))||void 0===e?void 0:e.number)||0)/((null===(n=(0,l.Js)((null===(s=j.mem)||void 0===s?void 0:s.max)+"","m"))||void 0===n?void 0:n.number)||1)*100,valueLabel:(null===(y=(0,l.Js)(A.mem+"","g",2))||void 0===y?void 0:y.numberFixed)+" GiB"})]})})};var h,k=s(51593),S=s(94016),f=s(98401),A=s(16272),j=s(76604),v=s(60881),_=s(96301),b=s(50868),I=s(23702),N=s(67378),F=s(85690),C=s(89608),E=s.n(C),T=s(56762),L=s(88522);const R=e=>{let{sessionFrgmt:n,sessionNameList:l,onRename:a}=e;const i=(0,k.CX)(),{token:t}=b.A.useToken(),o=(0,L.useFragment)(void 0!==h?h:h=s(56702),n),u=(0,v.ET)({mutationFn:e=>{const n=i.APIMajorVersion<5?o.name:o.session_id;return i.rename(n,e)}}),d=(0,p.useRef)(null),{t:c}=(0,T.Bd)(),[m,y]=(0,p.useState)(!1),[S,f]=(0,p.useState)(o.name),A=function(){return["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(o.status||void 0)&&!function(){return["RESTARTING","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(o.status||void 0)&&i.email===o.user_email,j=u.isPending||S!==o.name;return(0,x.jsx)(I.A,{ref:d,children:m?(0,x.jsx)(I.A.Item,{style:{margin:0},name:"name",rules:[{required:!0},{max:64},{pattern:/^(?:[a-zA-Z0-9][-a-zA-Z0-9._]{2,}[a-zA-Z0-9])?$/,message:c("session.Validation.EnterValidSessionName")},()=>({validator:(e,n)=>E().without(l,o.name).includes(String(n))?Promise.reject(new Error(c("session.Validation.SessionNameAlreadyExist"))):Promise.resolve()})],children:(0,x.jsx)(N.A,{autoFocus:!0,onPressEnter:()=>(()=>{var e;null===(e=d.current)||void 0===e||e.validateFields().then((e=>{let{name:n}=e;y(!1),o.name!==n&&(f(n),u.mutate(n,{onSuccess:e=>{a&&a()},onError:e=>{f(o.name)}}))})).catch((()=>{}))})(),onKeyUp:e=>{"Escape"===e.key&&y(!1)}})}):(0,x.jsxs)(r.A,{style:{maxWidth:250},children:[(0,x.jsx)(F.A.Text,{ellipsis:{tooltip:{overlayInnerStyle:{width:"max-content"}}},style:{opacity:j?.5:1},children:S}),A&&(0,x.jsx)(g.Ay,{loading:j,type:"text",icon:(0,x.jsx)(_.A,{}),style:{color:t.colorLink},onClick:()=>{var e;null===(e=d.current)||void 0===e||e.setFieldsValue({name:o.name}),y(!0)}})]})})};var K,w=s(51786),G=s(60210),P=s(77731),D=s(15934);const V=e=>{var n;let{status:l=[],limit:a=50,currentPage:i=1,pageSize:t=50,projectId:o,filter:u,extraFetchKey:d="",...c}=e;const m=(0,k.CX)(),[g,y]=(0,k.Tw)("initial-fetch"),h=(0,p.useDeferredValue)(g+d),{t:v}=(0,T.Bd)(),{token:_}=b.A.useToken(),[,{getImageAliasName:I,getBaseVersion:N,getBaseImage:C}]=(0,k.Gj)();!m.supports("avoid-hol-blocking")&&l.includes("SCHEDULED")&&(l=l.filter((e=>"SCHEDULED"!==e)));const{compute_session_list:V}=(0,L.useLazyLoadQuery)(void 0!==K?K:K=s(89788),{limit:t,offset:(i-1)*t,status:null===(n=l)||void 0===n?void 0:n.join(","),group_id:o,skipClusterSize:!m.supports("multi-container")},{fetchKey:h,fetchPolicy:"network-only"}),z={RESTARTING:"blue",PREPARING:"blue",PULLING:"blue",RUNNING:"green",PENDING:"green",SCHEDULED:"green",ERROR:"red"},$={"idle-timeout":"green","user-requested":"green",scheduled:"green","self-terminated":"green","no-available-instances":"red","failed-to-start":"red","creation-failed":"red"},U={INTERACTIVE:"green",BATCH:"darkgreen",INFERENCE:"blue"};return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(P.A,{scroll:{x:"max-content"},columns:[{title:v("session.SessionInfo"),render:(e,n,s)=>(0,x.jsx)(R,{sessionFrgmt:n,sessionNameList:E().map(((null===V||void 0===V?void 0:V.items)||[]).filter(u)||[],"name"),onRename:()=>{y(n.session_id+(new Date).toISOString())}},n.session_id),fixed:"left"},{title:v("session.Status"),dataIndex:"status",render:(e,n)=>(0,x.jsx)(x.Fragment,{children:""!==n.status_info?(0,x.jsx)(f.A,{values:[{label:e,color:E().get(z,e)},{label:n.status_info,color:E().get($,n.status_info)}]}):(0,x.jsx)(D.A,{color:E().get(z,e),children:e})})},{title:v("general.Control")},{title:v("session.Configuration"),dataIndex:"mounts",render:(e,n)=>(0,x.jsxs)(x.Fragment,{children:[e.length>0?(0,x.jsxs)(r.A,{gap:"xxs",style:{width:200},children:[(0,x.jsx)(w.A,{}),(0,x.jsx)(F.A.Text,{ellipsis:{tooltip:{overlayInnerStyle:{width:"max-content"},title:E().map(e,(e=>(0,x.jsx)("div",{children:e})))}},children:e.join(", ")})]}):(0,x.jsxs)(r.A,{gap:"xxs",style:{color:_.colorTextDisabled},children:[(0,x.jsx)(w.A,{}),"No mount"]}),(0,x.jsxs)(r.A,{gap:"xxs",children:[(0,x.jsx)(G.A,{}),n.scaling_group]}),(0,x.jsx)(r.A,{gap:"xxs",children:n.occupied_slots&&E().map(JSON.parse(n.occupied_slots),((e,s)=>(0,x.jsx)(j.A,{type:s,value:E().toString(e),opts:{shmem:E().sum(E().map(JSON.parse(n.resource_opts),(e=>e.shmem)))}},s)))})]})},{title:v("session.Usage")},{title:v("session.Reservation"),dataIndex:"created_at",render(e,n){const s=new Date(e).toLocaleString();return(0,x.jsxs)(r.A,{direction:"column",gap:"xs",children:[s,(0,x.jsx)(f.A,{values:[v("session.ElapsedTime"),(0,x.jsx)(S.A,{callback:()=>m.utils.elapsedTime(e,n.terminated_at),delay:1e3})]})]})}},{title:v("session.EnvironmentInfo"),render:e=>(0,x.jsx)(D.A,{color:"gold",children:(0,x.jsxs)(r.A,{direction:"column",children:[(0,x.jsxs)(r.A,{gap:"xxs",children:[(0,x.jsx)(A.A,{image:e.image}),(0,x.jsx)("div",{children:I(e.image)}),N(e.image)]}),(0,x.jsxs)(r.A,{gap:"xxs",children:[(0,x.jsx)("div",{children:C(e.image)}),e.architecture]})]})})},{title:v("session.SessionType"),dataIndex:"type",render:e=>(0,x.jsx)(D.A,{color:E().get(U,e),children:e})},...m.is_admin||m._config.hideAgents?[{title:v("session.Agents"),dataIndex:"agents",render:e=>E().map(e,(e=>e))}]:[]],dataSource:((null===V||void 0===V?void 0:V.items)||[]).filter(u),...c})})};var z=s(68190),$=s(24337),U=s(29977),B=s(39464),M=s(78792);const O=["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"],H={running:O,interactive:O,batch:O,inference:O,finished:["TERMINATED","CANCELLED"],others:["TERMINATING","ERROR"],default:O},Q=e=>{let{children:n}=e;const{t:s}=(0,T.Bd)(),l=(0,k.CX)(),{token:i}=b.A.useToken(),t=(0,a.hd)(),o=(0,k.f0)(),[u,d]=(0,p.useState)("running"),[m,h]=(0,p.useState)("next"),[{keypair:S,keypairResourcePolicy:f}]=(0,z.y)();return(0,x.jsxs)(r.A,{direction:"column",align:"stretch",gap:"sm",children:[(0,x.jsx)(B.A,{message:(0,x.jsxs)(r.A,{gap:"md",children:[(0,x.jsxs)(F.A.Text,{children:["This is"," ","current"===m?"current version":"NEXT generation"," ","of session list. you can switch anytime."]}),(0,x.jsx)(M.A,{options:[{label:"Current",value:"current"},{label:(0,x.jsx)(F.A.Text,{style:{color:"next"===m?i.colorPrimary:void 0},children:"Next"}),value:"next",icon:(0,x.jsx)($.A,{twoToneColor:i.colorWarning})}],value:m,onChange:e=>h(e)})]}),type:"info",showIcon:!0}),(0,x.jsxs)(r.A,{direction:"column",align:"stretch",style:{display:"next"===m?"flex":"none"},gap:"sm",children:[(0,x.jsx)(y,{}),(0,x.jsxs)(c.A,{bodyStyle:{padding:0},tabList:[{key:"running",label:(0,x.jsx)(x.Fragment,{children:s("session.Running")+` (${S.concurrency_used}/${1e6===f.max_concurrent_sessions?"\u221e":f.max_concurrent_sessions})`})},{key:"interactive",label:s("session.Interactive")},{key:"batch",label:s("session.Batch")},...l.supports("inference-workload")?[{key:"inference",label:s("session.Inference")}]:[],{key:"finished",label:s("session.Finished")},{key:"others",label:s("session.Others")}],activeTabKey:u,onTabChange:e=>d(e),tabBarExtraContent:(0,x.jsx)(r.A,{direction:"row",gap:"sm",children:(0,x.jsx)(g.Ay,{type:"primary",icon:(0,x.jsx)(U.A,{}),onClick:()=>{o("/session/start")},children:"START"})}),children:[n,(0,x.jsx)(r.A,{direction:"column",align:"stretch",children:(0,x.jsx)(p.Suspense,{fallback:(0,x.jsx)("div",{children:"loading.."}),children:(0,x.jsx)(r.A,{direction:"column",align:"stretch",children:(0,x.jsx)(V,{projectId:t.id,style:{marginTop:1},status:H[u]||H.default,filter:e=>{var n;return!["interactive","batch","inference"].includes(u)||(null===e||void 0===e||null===(n=e.type)||void 0===n?void 0:n.toLowerCase())===u},extraFetchKey:u})})})})]})]}),(0,x.jsx)(r.A,{direction:"column",align:"stretch",style:{display:"next"===m?"none":"flex"},children:(0,x.jsx)("backend-ai-session-view",{class:"page",name:"job",active:"next"!==m||null})})]})}}}]);
//# sourceMappingURL=7731.7d3b44c0.chunk.js.map