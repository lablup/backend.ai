"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[392],{37007:function(e,n,i){var r=i(99277),o=i(82548),l=i(32048),t=i.n(l),a=i(4519),u=i(2556);n.Z=function(e){var n,i=e.values,l=void 0===i?[]:i;return 0===l.length?null:(n=l[0]&&("string"===typeof l[0]||a.isValidElement(l[0]))?l.map((function(e){return{label:e,color:"blue"}})):l,(0,u.jsx)(r.Z,{direction:"row",children:t().map(n,(function(e,i){return(0,u.jsx)(o.Z,{style:t().last(n)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:e.label},i)}))}))}},15008:function(e,n,i){i.d(n,{Z:function(){return S}});var r,o=i(84506),l=i(29439),t=i(40406),a=i(21232),u=i(37007),s=i(99277),c=i(14001),d=i(91278),m=i(57054),v=i(44036),p=i(72887),g=i(82548),f=i(83799),h=i(38818),y=i(32048),x=i.n(y),Z=i(4519),b=i(81748),_=i(16980),k=i(2556),j=function(e){return e?"".concat(e.registry,"/").concat(e.name,":").concat(e.tag,"@").concat(e.architecture):void 0};var S=function(e){var n=e.filter,y=e.showPrivate,S=m.Z.useFormInstance(),w=m.Z.useWatch("environments",{form:S,preserve:!0}),P=(0,t.Dj)(),F=(0,Z.useState)(""),N=(0,l.Z)(F,2),I=N[0],C=N[1],K=(0,Z.useState)(""),E=(0,l.Z)(K,2),V=E[0],M=E[1],R=(0,b.$G)().t,q=(0,t.X6)(),D=(0,l.Z)(q,2),T=D[0],A=D[1].getImageMeta,U=v.Z.useToken().token,B=(0,a.r)().isDarkMode,L=(0,Z.useRef)(null),Q=(0,Z.useRef)(null),O=(0,_.useLazyLoadQuery)(void 0!==r?r:r=i(71947),{installed:!0},{fetchPolicy:"store-and-network"}).images;(0,Z.useEffect)((function(){var e;if(x().isEmpty(null===w||void 0===w?void 0:w.manual)){var n,i,r,o,l,t,a=null===(e=S.getFieldValue("environments"))||void 0===e?void 0:e.version;if(a&&x().find(G,(function(e){return!!(n=x().find(e.environmentGroups,(function(e){return!!(i=x().find(e.images,(function(e){return j(e)===a})))})))})),n)r=n,o=i;else o=null===(t=r=null===(l=G[0])||void 0===l?void 0:l.environmentGroups[0])||void 0===t?void 0:t.images[0];o?!n&&P._config.allow_manual_image_name_for_session&&a?S.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0,manual:a}}):S.setFieldsValue({environments:{environment:r.environmentName,version:j(o),image:o}}):P._config.allow_manual_image_name_for_session&&S.setFieldValue(["environments","manual"],a)}else(w.environment||w.version)&&S.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}})}),[null===w||void 0===w?void 0:w.version,null===w||void 0===w?void 0:w.manual]);var G=(0,Z.useMemo)((function(){return x().chain(O).filter((function(e){return(!!y||!function(e){return x().some(null===e||void 0===e?void 0:e.labels,(function(e){var n;return"ai.backend.features"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.split(" ").includes("private"))}))}(e))&&(!n||n(e))})).groupBy((function(e){var n;return(null===T||void 0===T||null===(n=T.imageInfo[A(j(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map((function(e,n){return{groupName:n,environmentGroups:x().chain(e).groupBy((function(e){return null===e||void 0===e?void 0:e.name})).map((function(e,n){var i,r,o=null===(i=n.split("/"))||void 0===i?void 0:i[1];return{environmentName:n,displayName:o&&(null===T||void 0===T||null===(r=T.imageInfo[o])||void 0===r?void 0:r.name)||x().last(n.split("/")),prefix:x().chain(n).split("/").dropRight(1).join("/").value(),images:e.sort((function(e,n){var i,r,o,l,t,a;return function(e,n){for(var i=e.split(".").map(Number),r=n.split(".").map(Number),o=0;o<Math.max(i.length,r.length);o++){var l=i[o]||0,t=r[o]||0;if(l>t)return 1;if(l<t)return-1}return 0}(null!==(i=null===n||void 0===n||null===(r=n.tag)||void 0===r||null===(o=r.split("-"))||void 0===o?void 0:o[0])&&void 0!==i?i:"",null!==(l=null===e||void 0===e||null===(t=e.tag)||void 0===t||null===(a=t.split("-"))||void 0===a?void 0:a[0])&&void 0!==l?l:"")}))}})).sortBy((function(e){return e.displayName})).value()}})).sortBy((function(e){return e.groupName})).value()}),[O,T,n,y]),z=(0,Z.useMemo)((function(){var e,n;return I.length&&x().chain(G.flatMap((function(e){return e.environmentGroups})).find((function(i){return n=i,!!(e=x().find(i.images,(function(e){return j(e)===I})))}))).value(),{fullNameMatchedImage:e,fullNameMatchedImageGroup:n}}),[I,G]),W=z.fullNameMatchedImage;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("style",{children:"/* Change the image and tags of the select option when the selection is opened  */\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  img,\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  span.ant-tag {\n  opacity: 0.5;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-light {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-dark {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px; /* Width of the transparent gradient area */\n  background: linear-gradient(\n    to right,\n    rgba(255, 255, 255, 0),\n    rgba(255, 255, 255, 1)\n  );\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px;\n  background: linear-gradient(\n    to right,\n    rgba(20, 20, 20, 0),\n    rgba(20, 20, 20, 1)\n  );\n}\n"}),(0,k.jsx)(m.Z.Item,{className:"image-environment-select-form-item",name:["environments","environment"],label:"".concat(R("session.launcher.Environments")," / ").concat(R("session.launcher.Version")),rules:[{required:x().isEmpty(null===w||void 0===w?void 0:w.manual)}],style:{marginBottom:10},children:(0,k.jsx)(p.Z,{ref:L,showSearch:!0,className:"image-environment-select",searchValue:I,onSearch:C,defaultActiveFirstOption:!0,optionFilterProp:"filterValue",onChange:function(e){if(W)S.setFieldsValue({environments:{environment:(null===W||void 0===W?void 0:W.name)||"",version:j(W),image:W}});else{var n=G.flatMap((function(e){return e.environmentGroups})).filter((function(n){return n.environmentName===e}))[0].images[0];S.setFieldsValue({environments:{environment:(null===n||void 0===n?void 0:n.name)||"",version:j(n),image:n}})}},disabled:P._config.allow_manual_image_name_for_session&&!x().isEmpty(null===w||void 0===w?void 0:w.manual),children:W?(0,k.jsx)(p.Z.Option,{value:null===W||void 0===W?void 0:W.name,filterValue:j(W),children:(0,k.jsxs)(s.Z,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,k.jsx)(c.Z,{image:j(W)||"",style:{width:15,height:15}}),j(W)]})}):x().map(G,(function(e){return(0,k.jsx)(p.Z.OptGroup,{label:e.groupName,children:x().map(e.environmentGroups,(function(e){var n,i=e.images[0],r=null===T||void 0===T?void 0:T.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[1]],o=[],l=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(o.push(e.prefix),l=(0,k.jsx)(g.Z,{color:"purple",children:(0,k.jsx)(d.Z,{keyword:I,children:e.prefix})}));var t=x().map(null===r||void 0===r?void 0:r.label,(function(e){return x().isUndefined(e.category)&&e.tag&&e.color?(o.push(e.tag),(0,k.jsx)(g.Z,{color:e.color,children:(0,k.jsx)(d.Z,{keyword:I,children:e.tag},e.tag)},e.tag)):null}));return(0,k.jsx)(p.Z.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+o.join("\t"),children:(0,k.jsxs)(s.Z,{direction:"row",justify:"between",children:[(0,k.jsxs)(s.Z,{direction:"row",align:"center",gap:"xs",children:[(0,k.jsx)(c.Z,{image:j(i)||"",style:{width:15,height:15}}),(0,k.jsx)(d.Z,{keyword:I,children:e.displayName})]}),(0,k.jsxs)(s.Z,{direction:"row",className:B?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:U.marginXS,flexShrink:1},children:[l,t]})]})},e.environmentName)}))},e.groupName)}))})}),(0,k.jsx)(m.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.environments)||void 0===i?void 0:i.environment)!==(null===(r=n.environments)||void 0===r?void 0:r.environment)},children:function(e){var n,i,r=e.getFieldValue;return x().find(G,(function(e){return x().find(e.environmentGroups,(function(e){var n;return e.environmentName===(null===(n=r("environments"))||void 0===n?void 0:n.environment)&&(i=e,!0)}))})),(0,k.jsx)(m.Z.Item,{className:"image-environment-select-form-item",name:["environments","version"],rules:[{required:x().isEmpty(null===w||void 0===w?void 0:w.manual)}],children:(0,k.jsx)(p.Z,{ref:Q,onChange:function(e){var n=x().find(O,(function(n){return j(n)===e}));S.setFieldValue(["environments","image"],n)},showSearch:!0,searchValue:V,onSearch:M,optionFilterProp:"filterValue",dropdownRender:function(e){return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(s.Z,{style:{fontWeight:U.fontWeightStrong,paddingLeft:U.paddingSM},children:[R("session.launcher.Version"),(0,k.jsx)(f.Z,{type:"vertical"}),R("session.launcher.Base"),(0,k.jsx)(f.Z,{type:"vertical"}),R("session.launcher.Architecture"),(0,k.jsx)(f.Z,{type:"vertical"}),R("session.launcher.Requirements")]}),(0,k.jsx)(f.Z,{style:{margin:"8px 0"}}),e]})},disabled:P._config.allow_manual_image_name_for_session&&!x().isEmpty(null===w||void 0===w?void 0:w.manual),children:x().map(x().uniqBy(null===(n=i)||void 0===n?void 0:n.images,"digest"),(function(e){var n,i=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""],r=(0,o.Z)(i),t=r[0],a=r[1],c=r.slice(2),m=null===T||void 0===T?void 0:T.tagAlias[a];if(!m){for(var v=0,g=Object.entries((null===T||void 0===T?void 0:T.tagReplace)||{});v<g.length;v++){var h=(0,l.Z)(g[v],2),y=h[0],Z=h[1],b=new RegExp(y);b.test(a)&&(m=null===a||void 0===a?void 0:a.replace(b,Z))}m||(m=a)}var _=[],S=c.length>0?x().map(c,(function(e,n){return(0,k.jsx)(u.Z,{values:x().split((null===T||void 0===T?void 0:T.tagAlias[e])||e,":").map((function(e){return _.push(e),(0,k.jsx)(d.Z,{keyword:V,children:e},e)}))},n)})):"-";return(0,k.jsx)(p.Z.Option,{value:j(e),filterValue:[t,m,null===e||void 0===e?void 0:e.architecture].concat(_).join("\t"),children:(0,k.jsxs)(s.Z,{direction:"row",justify:"between",children:[(0,k.jsxs)(s.Z,{direction:"row",children:[(0,k.jsx)(d.Z,{keyword:V,children:t}),(0,k.jsx)(f.Z,{type:"vertical"}),(0,k.jsx)(d.Z,{keyword:V,children:m}),(0,k.jsx)(f.Z,{type:"vertical"}),(0,k.jsx)(d.Z,{keyword:V,children:null===e||void 0===e?void 0:e.architecture})]}),(0,k.jsx)(s.Z,{direction:"row",className:B?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:U.marginXS,flexShrink:1},children:S})]})},null===e||void 0===e?void 0:e.digest)}))})})}}),(0,k.jsx)(m.Z.Item,{label:R("session.launcher.ManualImageName"),name:["environments","manual"],style:{display:P._config.allow_manual_image_name_for_session?"block":"none"},children:(0,k.jsx)(h.Z,{allowClear:!0,onChange:function(e){x().isEmpty(e)||S.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}})}})}),(0,k.jsx)(m.Z.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,k.jsx)(h.Z,{})})]})}},14001:function(e,n,i){var r=i(1413),o=i(29439),l=i(40406),t=i(4519),a=i(2556),u=function(e,n){var i=e.image,t=e.style,u=void 0===t?{}:t,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=(0,l.X6)(),d=(0,o.Z)(c,2)[1].getImageIcon;return(0,a.jsx)("img",{src:d(i),style:(0,r.Z)({width:"1em",height:"1em"},u),alt:s})};n.Z=t.memo(u)},17913:function(e,n,i){var r=i(1413),o=i(29439),l=i(44925),t=i(99277),a=i(99821),u=i(80558),s=i(31603),c=i(32048),d=i.n(c),m=i(4519),v=i(2556),p=["min","max","step","disabled","inputNumberProps","sliderProps"];n.Z=function(e){var n=e.min,i=e.max,c=e.step,g=e.disabled,f=e.inputNumberProps,h=e.sliderProps,y=(0,l.Z)(e,p),x=(0,a.Z)(y),Z=(0,o.Z)(x,2),b=Z[0],_=Z[1],k=m.useRef(null);return(0,m.useEffect)((function(){1===c&&b%1!==0&&_(Math.round(b))}),[c]),(0,v.jsxs)(t.Z,{direction:"row",gap:"md",children:[(0,v.jsx)(t.Z,{style:{flex:2,minWidth:190},align:"stretch",direction:"column",children:(0,v.jsx)(u.Z,(0,r.Z)({ref:k,max:i,min:n,step:c,disabled:g,value:b,onChange:_,onBlur:function(){if(d().isNumber(c)&&c>0){var e,n,i=(null===(e=c.toString().split(".")[1])||void 0===e?void 0:e.length)||0;_(d().toNumber((Math.round(d().toNumber((null===(n=k.current)||void 0===n?void 0:n.value)||"0")/c)*c).toFixed(i)))}}},f))}),(0,v.jsx)(t.Z,{direction:"column",align:"stretch",style:{flex:3},children:(0,v.jsx)(s.Z,(0,r.Z)((0,r.Z)({max:i,min:0,step:c,disabled:g,value:b,onChange:function(e){void 0!==n&&e<n||_(e)}},h),{},{marks:d().omitBy(null===h||void 0===h?void 0:h.marks,(function(e,n){return!!d().isNumber(i)&&d().parseInt(n)>i}))}))})]})}},20328:function(e,n,i){i.d(n,{A9:function(){return H},ds:function(){return J},ZP:function(){return ne}});var r,o,l,t=i(4942),a=i(74165),u=i(15861),s=i(1413),c=i(29439),d=i(43255),m=i(40406),v=i(1839),p=i(4519),g=i(16980),f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fetchPolicy:"store-and-network"},n=(0,m.Kr)("first"),l=(0,c.Z)(n,2),t=l[0],a=l[1],u=(0,m.Dj)(),d=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchPolicy:"store-and-network"},o=(0,m.Kr)("first"),l=(0,c.Z)(o,2),t=l[0],a=l[1];return[(0,g.useLazyLoadQuery)(void 0!==r?r:r=i(25338),{accessKey:e},(0,s.Z)((0,s.Z)({},n),{},{fetchKey:t+n.fetchKey})).keypair,{refresh:(0,p.useCallback)((function(){a()}),[a])}]}(null===u||void 0===u?void 0:u._config.accessKey),v=(0,c.Z)(d,1)[0];return[{keypairResourcePolicy:(0,g.useLazyLoadQuery)(void 0!==o?o:o=i(94177),{name:(null===v||void 0===v?void 0:v.resource_policy)||""},(0,s.Z)((0,s.Z)({},e),{},{fetchKey:t+e.fetchKey})).keypair_resource_policy||{},keypair:v||{}},{refresh:(0,p.useCallback)((function(){a()}),[a])}]},h=i(50164),y=i(32048),x=i.n(y),Z=function(e){return void 0===e||"Infinity"===e||"NaN"===e?void 0:x().toNumber(e)},b=i(44925),_=i(99821),k=i(67668),j=i(80558),S=i(72887),w=i(70389),P=i(2556),F=["dynamicSteps","units","disableAutoUnit","min","max","roundStep"],N=function(e){var n=e.dynamicSteps,i=void 0===n?[1,2,4,8,16,32,64,128,256,512]:n,r=e.units,o=void 0===r?["m","g","t","p"]:r,l=e.disableAutoUnit,t=void 0!==l&&l,a=e.min,u=void 0===a?"0m":a,m=e.max,v=void 0===m?"300p":m,g=e.roundStep,f=(0,b.Z)(e,F),h=(0,_.Z)(f,{defaultValue:"0g"}),y=(0,c.Z)(h,2),Z=y[0],N=y[1],I=null===Z||void 0===Z?[null,null]:(0,d.n2)(Z),C=(0,c.Z)(I,2),K=C[0],E=C[1],V=(0,k.Z)(E),M=E||V||o[0],R=(0,d.n2)(u),q=(0,c.Z)(R,2),D=q[0],T=q[1],A=(0,d.n2)(v),U=(0,c.Z)(A,2),B=U[0],L=U[1],Q=(0,p.useRef)(null);return(0,p.useEffect)((function(){if(Q.current){var e=function(e){var n,i=null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value;/^\d+(g|m)$/.test(i)&&N(i)},n=Q.current;return null===n||void 0===n||n.addEventListener("input",e),function(){null===n||void 0===n||n.removeEventListener("input",e)}}}),[Q,K,E,N]),(0,P.jsx)(j.Z,(0,s.Z)((0,s.Z)({ref:Q},f),{},{onBlur:function(){if(x().isNumber(g)&&g>0){var e,n,i=(null===(e=g.toString().split(".")[1])||void 0===e?void 0:e.length)||0;N("".concat((Math.round(x().toNumber((null===(n=Q.current)||void 0===n?void 0:n.value)||"0")/g)*g).toFixed(i)).concat(M))}},value:K,onChange:function(e){N(null===e||void 0===e?e:"".concat(e).concat(M))},max:L===M?B:(0,d.PZ)(v,M).number,min:T===M?D:(0,d.PZ)(u,M).number,addonAfter:(0,P.jsx)(S.Z,{tabIndex:-1,value:M,onChange:function(e){N("".concat(K).concat(e))},onDropdownVisibleChange:function(e){(e&&null===Z||void 0===Z)&&N("0".concat(M))},options:x().map(o,(function(e){return{value:e,label:(0,P.jsx)(w.Z.Text,{style:{fontFamily:"'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace"},children:e.toUpperCase()+"iB"})}})),suffixIcon:o.length>1?void 0:null,open:o.length>1&&void 0,style:{cursor:o.length>1?void 0:"default"}}),step:0,onStep:function(e,n){var r,l=x().isNull(K)||x().isUndefined(K)?0:K,a=x().sortedIndex(x().sortBy(i),l);r="up"===n.type?l===i[a]?a+1:a:a-1;var u=o.indexOf(M);if(!t&&r<0)if(0===u)N("0".concat(M));else{var s=i[i.length-1],c=o[u-1];N("".concat(s).concat(c))}else if(!t&&r>i.length-1)if(u===o.length-1)N("".concat(l+("up"===n.type?1:-1)).concat(L));else{var d=i[0],m=o[u+1];N("".concat(d).concat(m))}else if(r>=0&&r<i.length){var v=i[r];T===M&&v<D?v=D:L===M&&v>B&&(v=B),N("".concat(v).concat(M))}}}))},I=i(99277),C=i(44036),K=i(31603),E=["min","max","warn","units","extraMarks","hideSlider","step"],V=function(e){var n=e.min,i=void 0===n?"0m":n,r=e.max,o=void 0===r?"32g":r,l=e.warn,a=e.units,u=void 0===a?["m","g"]:a,m=e.extraMarks,v=e.hideSlider,g=e.step,f=void 0===g?.05:g,h=(0,b.Z)(e,E),y=(0,_.Z)(h,{defaultValue:"0g"}),Z=(0,c.Z)(y,2),k=Z[0],j=Z[1],S=C.Z.useToken().token,w=(0,p.useMemo)((function(){return(0,d.PZ)(i,"g",2)}),[i]),F=(0,p.useMemo)((function(){return(0,d.PZ)(o,"g",2)}),[o]),V=(0,p.useMemo)((function(){return(0,d.PZ)(k||"0g","g",2)}),[k]);return(0,P.jsxs)(I.Z,{direction:"row",gap:"md",children:[(0,P.jsx)(I.Z,{style:{flex:2,minWidth:190},direction:"column",align:"stretch",children:(0,P.jsx)(N,(0,s.Z)((0,s.Z)({},h),{},{min:i,max:o,units:u,value:k,onChange:function(e){j(e)},style:{minWidth:130},roundStep:f}))}),(0,P.jsx)(I.Z,{direction:"column",align:"stretch",style:(0,s.Z)({flex:3},v&&{visibility:"hidden",height:0}),children:(0,P.jsx)(I.Z,{direction:"column",align:"stretch",children:(0,P.jsx)(K.Z,{max:null===F||void 0===F?void 0:F.number,styles:{track:l&&{backgroundColor:(0,d.p)(l,k||"0b")<0?S.colorWarning:void 0}||void 0,rail:{}},step:f,value:null===V||void 0===V?void 0:V.number,tooltip:{formatter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<1?"".concat((1024*e).toFixed(2)," MiB"):"".concat(e.toFixed(2)," GiB")}},onChange:function(e){null!==w&&void 0!==w&&w.number&&w.number>e?j(i):j(e<1?"".concat(1024*e,"m"):"".concat(e,"g"))},marks:(0,s.Z)((0,s.Z)((0,s.Z)({},w&&x().isNumber(null===w||void 0===w?void 0:w.number)&&(0,t.Z)({},w.number,{style:{color:S.colorTextSecondary},label:0===w.number?w.number:w.number>=1?w.number+"g":1024*w.number+"m"})),x().omitBy(m,(function(e,n){return!!x().isNumber(null===F||void 0===F?void 0:F.number)&&x().parseInt(n)>(null===F||void 0===F?void 0:F.number)}))),(null===F||void 0===F?void 0:F.number)&&(0,t.Z)({},F.number,{style:{color:S.colorTextSecondary},label:0===F.number?F.number:F.number>=1?F.number+"g":1024*F.number+"m"}))})})})]})},M=i(17913),R=i(61815),q=i(96732),D=i(36459),T=i(61749),A=i(73519),U=function(e){var n=Object.assign({},((0,D.Z)(e),e)),r=(0,m.Kr)("first"),o=(0,c.Z)(r,2),t=o[0],a=o[1],u=(0,A.Z)(a,{wait:3e3,trailing:!1,leading:!0}).run,d=(0,v.T6)(),f=(0,c.Z)(d,1)[0],h=(0,p.useTransition)(),y=(0,c.Z)(h,2),Z=y[0],b=y[1],_=(0,g.useLazyLoadQuery)(void 0!==l?l:l=i(73340),{},{fetchKey:t,fetchPolicy:"first"===t?"store-and-network":"network-only"}).resource_presets;return(0,P.jsx)(S.Z,(0,s.Z)((0,s.Z)({loading:Z,options:[{value:"custom",label:(0,P.jsxs)(I.Z,{gap:"xs",style:{display:"inline-flex"},children:[(0,P.jsx)(T.Z,{})," Custom"]})},{label:"Preset",options:x().map(_,(function(e,n){var i=JSON.parse(null===e||void 0===e?void 0:e.resource_slots);return{value:null===e||void 0===e?void 0:e.name,label:(0,P.jsxs)(I.Z,{direction:"row",justify:"between",gap:"xs",children:[null===e||void 0===e?void 0:e.name,(0,P.jsx)(I.Z,{direction:"row",gap:"xxs",style:{color:"black",opacity:1===n?.5:1},children:x().map(x().omitBy(i,(function(e,n){return x().isEmpty(f[n])})),(function(e,n){return(0,P.jsx)(q.ZP,{type:n,value:e,hideTooltip:!0},n)}))})]}),preset:e}}))}],showSearch:!0},n),{},{onDropdownVisibleChange:function(e){e&&(console.log(e),b((function(){u()})))}}))},B=i(58021),L=i(57054),Q=i(86199),O=i(62708),G=i(83799),z=i(35492),W=i(2704),X=i(22733),$=i(81748),H="64m",J={resource:{cpu:0,mem:"0g",shmem:"0g",accelerator:0},num_of_sessions:1,cluster_mode:"single-node",cluster_size:1,enabledAutomaticShmem:!0},Y=function(e){var n=e.enableNumOfSessions,i=e.enableResourcePresets,r=e.forceImageMinValues,o=void 0!==r&&r,l=L.Z.useFormInstance(),g=(0,$.$G)().t,y=C.Z.useToken().token,b=(0,m.Dj)(),_=(0,v.T6)(),k=(0,c.Z)(_,1)[0],j=x().omit(k,["cpu","mem","shmem"]),w=f(),F=(0,c.Z)(w,1)[0],N=F.keypair,K=F.keypairResourcePolicy,E=(0,m.qh)(),D=(0,p.useState)(l.getFieldValue("resourceGroup")),T=(0,c.Z)(D,2),A=T[0],B=T[1],J=(0,p.useTransition)(),Y=(0,c.Z)(J,2),ne=Y[0],ie=Y[1],re=L.Z.useWatch(["environments","image"],{form:l,preserve:!0}),oe=function(e){var n,i,r,o,l,t,a,u,s,p,g,f,y,b,_,k,j,S,w,P,F,N,I=e.currentImage,C=e.currentResourceGroup,K=e.currentProjectName,E=(0,m.Dj)(),V=(0,v.T6)(),M=(0,c.Z)(V,1)[0],R=x().omit(M,["cpu","mem","shmem"]),q=(0,h.h)({queryKey:["check-resets",K,C],queryFn:function(){return C?E.resourcePreset.check({group:K,scaling_group:C}):void 0},staleTime:0,suspense:!x().isEmpty(C)}),D=q.data,T=q.refetch,A=q.isRefetching,U=(null===(n=x().find(null===I||void 0===I?void 0:I.resource_limits,(function(e){return"mem"===(null===e||void 0===e?void 0:e.key)})))||void 0===n?void 0:n.min)||"0g",B={cpu:x().isEmpty(null===D||void 0===D||null===(i=D.scaling_groups[C])||void 0===i||null===(r=i.using)||void 0===r?void 0:r.cpu)||x().isEmpty(null===D||void 0===D||null===(o=D.scaling_groups[C])||void 0===o||null===(l=o.remaining)||void 0===l?void 0:l.cpu)?void 0:x().toNumber(null===D||void 0===D||null===(t=D.scaling_groups[C])||void 0===t?void 0:t.using.cpu)+x().toNumber(null===D||void 0===D||null===(a=D.scaling_groups[C])||void 0===a?void 0:a.remaining.cpu),mem:x().isEmpty(null===D||void 0===D||null===(u=D.scaling_groups[C])||void 0===u||null===(s=u.using)||void 0===s?void 0:s.mem)||x().isEmpty(null===D||void 0===D||null===(p=D.scaling_groups[C])||void 0===p||null===(g=p.remaining)||void 0===g?void 0:g.mem)?void 0:(null===(f=(0,d.PZ)(x().toNumber(null===D||void 0===D||null===(y=D.scaling_groups[C])||void 0===y?void 0:y.using.mem)+x().toNumber(null===D||void 0===D||null===(b=D.scaling_groups[C])||void 0===b?void 0:b.remaining.mem)+"b","g",2))||void 0===f?void 0:f.numberFixed)+"g",accelerators:x().reduce(R,(function(e,n,i){var r,o,l,t,a,u;return e[i]=x().isEmpty(null===D||void 0===D||null===(r=D.scaling_groups[C])||void 0===r||null===(o=r.using)||void 0===o?void 0:o[i])||x().isEmpty(null===D||void 0===D||null===(l=D.scaling_groups[C])||void 0===l||null===(t=l.remaining)||void 0===t?void 0:t[i])?void 0:x().toNumber(null===D||void 0===D||null===(a=D.scaling_groups[C])||void 0===a?void 0:a.using[i])+x().toNumber(null===D||void 0===D||null===(u=D.scaling_groups[C])||void 0===u?void 0:u.remaining[i]),e}),{})},L={cpu:void 0===(null===M||void 0===M?void 0:M.cpu)?void 0:{min:x().max([x().toNumber((null===(_=x().find(null===I||void 0===I?void 0:I.resource_limits,(function(e){return"cpu"===(null===e||void 0===e?void 0:e.key)})))||void 0===_?void 0:_.min)||"0")]),max:x().min([E._config.maxCPUCoresPerContainer,Z(null===D||void 0===D?void 0:D.keypair_limits.cpu),Z(null===D||void 0===D?void 0:D.group_limits.cpu),null===B||void 0===B?void 0:B.cpu])},mem:void 0===(null===M||void 0===M?void 0:M.mem)?void 0:{min:(0,d.v3)(x().max([null===(k=(0,d.PZ)(U,"b"))||void 0===k?void 0:k.number,null===(j=(0,d.PZ)(H,"b"))||void 0===j?void 0:j.number,0])+"b",H),max:x().min([E._config.maxMemoryPerContainer,Z(null===D||void 0===D?void 0:D.keypair_limits.mem)&&(null===(S=(0,d.PZ)(Z(null===D||void 0===D?void 0:D.keypair_limits.mem)+"","g"))||void 0===S?void 0:S.number),Z(null===D||void 0===D?void 0:D.group_limits.mem)&&(null===(w=(0,d.PZ)(Z(null===D||void 0===D?void 0:D.group_limits.mem)+"","g"))||void 0===w?void 0:w.number),(null===B||void 0===B?void 0:B.mem)&&(null===(P=(0,d.PZ)((null===B||void 0===B?void 0:B.mem)+"","g"))||void 0===P?void 0:P.number)])+"g"},accelerators:x().reduce(R,(function(e,n,i){var r,o,l={"cuda.device":"maxCUDADevicesPerContainer","cuda.shares":"maxCUDASharesPerContainer","rocm.device":"maxROCMDevicesPerContainer","tpu.device":"maxTPUDevicesPerContainer","ipu.device":"maxIPUDevicesPerContainer","atom.device":"maxATOMDevicesPerContainer","warboy.device":"maxWarboyDevicesPerContainer"}[i]||"cuda.device";return e[i]={min:parseInt((null===(r=x().filter(null===I||void 0===I?void 0:I.resource_limits,(function(e){return(null===e||void 0===e?void 0:e.key)===i})))||void 0===r||null===(o=r[0])||void 0===o?void 0:o.min)||"0"),max:x().min([E._config[l]||8,B.accelerators[i]])},e}),{})},Q={accelerators:x().reduce(R,(function(e,n,i){var r;return e[i]=null!==(r=x().min([x().toNumber(null===D||void 0===D?void 0:D.keypair_remaining[i]),x().toNumber(null===D||void 0===D?void 0:D.group_remaining[i]),x().toNumber(null===D||void 0===D?void 0:D.scaling_group_remaining[i])]))&&void 0!==r?r:Number.MAX_SAFE_INTEGER,e}),{}),cpu:null!==(F=x().min([Z(null===D||void 0===D?void 0:D.keypair_remaining.cpu),Z(null===D||void 0===D?void 0:D.group_remaining.cpu),Z(null===D||void 0===D?void 0:D.scaling_group_remaining.cpu)]))&&void 0!==F?F:Number.MAX_SAFE_INTEGER,mem:null!==(N=x().min([Z(null===D||void 0===D?void 0:D.keypair_remaining.mem),Z(null===D||void 0===D?void 0:D.group_remaining.mem),Z(null===D||void 0===D?void 0:D.scaling_group_remaining.mem)]))&&void 0!==N?N:Number.MAX_SAFE_INTEGER};return[{resourceGroupResourceSize:B,resourceLimits:L,remaining:Q,currentImageMinM:U,isRefetching:A},{refetch:T}]}({currentProjectName:E.name,currentResourceGroup:A,currentImage:re}),le=(0,c.Z)(oe,1)[0],te=le.currentImageMinM,ae=le.remaining,ue=le.resourceLimits,se=x().filter(null===re||void 0===re?void 0:re.resource_limits,(function(e){return!!e&&!x().includes(["cpu","mem","shmem"],e.key)})),ce={min:1,max:x().min([K.max_concurrent_sessions,3]),remaining:(K.max_concurrent_sessions||3)-(N.concurrency_used||0)};(0,p.useEffect)((function(){var e,n,i,r,t,a,u={cpu:null===(e=ue.cpu)||void 0===e?void 0:e.min,mem:(null===(n=(0,d.PZ)(((null===(i=(0,d.PZ)(null===(r=ue.shmem)||void 0===r?void 0:r.min,"m"))||void 0===i?void 0:i.number)||0)+((null===(t=(0,d.PZ)(null===(a=ue.mem)||void 0===a?void 0:a.min,"m"))||void 0===t?void 0:t.number)||0)+"m","g"))||void 0===n?void 0:n.number)+"g"};if(se.length>0)if(x().find(se,(function(e){return(null===e||void 0===e?void 0:e.key)===l.getFieldValue(["resource","acceleratorType"])}))){var c;u.acceleratorType=l.getFieldValue(["resource","acceleratorType"]),u.accelerator=null===(c=ue.accelerators[l.getFieldValue(["resource","acceleratorType"])])||void 0===c?void 0:c.min}else{var m,v,p=null===(m=x().filter(se,(function(e){return x().keys(k).includes(null===e||void 0===e?void 0:e.key)}))[0])||void 0===m?void 0:m.key;if(p)u.accelerator=null===(v=ue.accelerators[p])||void 0===v?void 0:v.min,u.acceleratorType=p}else u.accelerator=0;!0!==o&&(["cpu","accelerator"].forEach((function(e){var n=u[e];x().isNumber(n)&&n<l.getFieldValue(["resource",e])&&delete u[e]})),["mem","shmem"].forEach((function(e){var n=u[e];x().isString(n)&&(0,d.p)(n,l.getFieldValue(["resource",e]))<0&&delete u[e]}))),l.setFieldsValue({resource:(0,s.Z)({},u)}),re&&0===se.length&&l.setFieldValue(["resource","accelerator"],0),l.validateFields([["resource","cpu"],["resource","mem"],["resource","shmem"],["resource","accelerator"],["resource","acceleratorType"]]).catch((function(){})),l.getFieldValue("enabledAutomaticShmem")&&de(l.getFieldValue(["resource","mem"])||"0g")}),[re]);var de=function(e){(0,d.p)(e,"4g")>=0&&(0,d.p)(e,(0,d.v3)(te,"1g")||"0b")>=0&&(0,d.p)("1g",H)>0?l.setFieldValue(["resource","shmem"],"1g"):l.setFieldValue(["resource","shmem"],H)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(L.Z.Item,{name:"resourceGroup",label:g("session.ResourceGroup"),rules:[{required:!0}],children:(0,P.jsx)(R.Z,{autoSelectDefault:!0,showSearch:!0,loading:ne,onChange:function(e){ie((function(){B(e)}))}})}),i?(0,P.jsx)(L.Z.Item,{label:g("resourcePreset.ResourcePresets"),name:"allocationPreset",required:!0,style:{marginBottom:y.marginXS},children:(0,P.jsx)(U,{onChange:function(e,n){var i,r,o,t,a=x().pick(JSON.parse((null===n||void 0===n||null===(i=n.preset)||void 0===i?void 0:i.resource_slots)||"{}"),x().keys(k));l.setFieldsValue({resource:(0,s.Z)((0,s.Z)({},a),{},{mem:null===(r=(0,d.PZ)(((null===a||void 0===a?void 0:a.mem)||0)+"b","g",2))||void 0===r?void 0:r.numberUnit,shmem:null===(o=(0,d.PZ)(((null===n||void 0===n||null===(t=n.preset)||void 0===t?void 0:t.shared_memory)||0)+"b","g",2))||void 0===o?void 0:o.numberUnit})})}})}):null,(0,P.jsx)(Q.Z,{style:{marginBottom:y.margin},children:(0,P.jsx)(L.Z.Item,{shouldUpdate:function(e,n){return e.allocationPreset!==n.allocationPreset},noStyle:!0,children:function(e){var n,i,r,o,c,m,v,p,f,h,Z=e.getFieldValue;return(0,P.jsxs)(P.Fragment,{children:[(null===k||void 0===k?void 0:k.cpu)&&(0,P.jsx)(L.Z.Item,{name:["resource","cpu"],label:g("session.launcher.CPU"),tooltip:{placement:"right",title:(0,P.jsx)($.cC,{i18nKey:"session.launcher.DescCPU"})},required:!0,rules:[{required:!0},{type:"number",min:null===(n=ue.cpu)||void 0===n?void 0:n.min},{warningOnly:null===(i=b._config)||void 0===i?void 0:i.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(x().isNumber(ae.cpu)&&i>ae.cpu)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=b._config)&&void 0!==r&&r.always_enqueue_compute_session?g("session.launcher.EnqueueComputeSessionWarning"):g("session.launcher.ErrorCanNotExceedRemaining",{amount:ae.cpu})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(M.Z,{inputNumberProps:{addonAfter:g("session.launcher.Core")},sliderProps:{marks:(0,s.Z)((0,s.Z)((0,s.Z)({},ae.cpu?(0,t.Z)({},ae.cpu,{label:(0,P.jsx)(ee,{})}):{}),null!==(r=ue.cpu)&&void 0!==r&&r.min?(0,t.Z)({},null===(o=ue.cpu)||void 0===o?void 0:o.min,null===(c=ue.cpu)||void 0===c?void 0:c.min):{}),null!==(m=ue.cpu)&&void 0!==m&&m.max?(0,t.Z)({},null===(v=ue.cpu)||void 0===v?void 0:v.max,{style:{color:y.colorTextSecondary},label:null===(p=ue.cpu)||void 0===p?void 0:p.max}):{})},min:null===(f=ue.cpu)||void 0===f?void 0:f.min,max:null===(h=ue.cpu)||void 0===h?void 0:h.max,step:1})}),(null===k||void 0===k?void 0:k.mem)&&(0,P.jsxs)(L.Z.Item,{label:g("session.launcher.Memory"),tooltip:{placement:"right",props:{onClick:function(e){return e.preventDefault()}},title:(0,P.jsx)(I.Z,{direction:"column",onClick:function(e){return e.preventDefault()},children:(0,P.jsx)($.cC,{i18nKey:"session.launcher.DescMemory"})})},required:!0,children:[(0,P.jsx)(L.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.resource.shmem!==n.resource.shmem},children:function(){var e,n,i,r;return(0,P.jsx)(L.Z.Item,{name:["resource","mem"],noStyle:!0,rules:[{required:!0},{validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r,o,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!x().isElement(i)&&null!==(r=ue.mem)&&void 0!==r&&r.min&&(0,d.p)(i,(null===(o=ue.mem)||void 0===o?void 0:o.min)||"0g")<0)){e.next=4;break}return e.abrupt("return",Promise.reject(g("session.launcher.MinMemory",{size:x().toUpper((null===(l=ue.mem)||void 0===l?void 0:l.min)||"0g")})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()},{warningOnly:null===(e=b._config)||void 0===e?void 0:e.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!x().isElement(i)&&ue.mem&&(0,d.p)(i,ae.mem+"b")>0)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=b._config)&&void 0!==r&&r.always_enqueue_compute_session?g("session.launcher.EnqueueComputeSessionWarning"):g("session.launcher.ErrorCanNotExceedRemaining",{amount:(null===(o=(0,d.PZ)(ae.mem+"b","g",3))||void 0===o?void 0:o.numberUnit)+"iB"})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(V,{max:null===(n=ue.mem)||void 0===n?void 0:n.max,min:null===(i=ue.mem)||void 0===i?void 0:i.min,addonBefore:"MEM",extraMarks:(0,s.Z)({},ae.mem?(0,t.Z)({},null===(r=(0,d.PZ)(ae.mem+"b","g",3))||void 0===r?void 0:r.numberFixed,{label:(0,P.jsx)(ee,{})}):{}),onChange:function(e){e&&l.getFieldValue("enabledAutomaticShmem")&&de(e)}})})}}),(0,P.jsxs)(I.Z,{direction:"column",gap:"xxs",align:"start",children:[(0,P.jsxs)(I.Z,{direction:"row",gap:"xs",children:[g("session.launcher.EnableAutomaticShmem")," ",(0,P.jsx)(L.Z.Item,{noStyle:!0,name:"enabledAutomaticShmem",valuePropName:"checked",children:(0,P.jsx)(O.Z,{size:"small",onChange:function(e){e&&de(l.getFieldValue(["resource","mem"])||"0g")}})})]}),(0,P.jsx)(L.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.resource.mem!==n.resource.mem||e.enabledAutomaticShmem!==n.enabledAutomaticShmem},children:function(){var e;return(0,P.jsx)(L.Z.Item,{noStyle:!0,name:["resource","shmem"],hidden:l.getFieldValue("enabledAutomaticShmem"),tooltip:(0,P.jsx)($.cC,{i18nKey:"session.launcher.DescSharedMemory"}),dependencies:[["resource","mem"]],rules:[{required:!0},{},{validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(x().isEmpty(null===(r=Z("resource"))||void 0===r?void 0:r.mem)||x().isEmpty(i)||(0,d.p)(null===(o=Z("resource"))||void 0===o?void 0:o.mem,i)>=0)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:throw g("resourcePreset.SHMEMShouldBeSmallerThanMemory");case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(V,{min:null===(e=ue.shmem)||void 0===e?void 0:e.min,addonBefore:"SHM",max:l.getFieldValue(["resource","mem"])||"0g",hideSlider:!0})})}})]})]}),(0,P.jsx)(L.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.resource)||void 0===i?void 0:i.acceleratorType)!==(null===(r=n.resource)||void 0===r?void 0:r.acceleratorType)||e.cluster_size!==n.cluster_size},children:function(e){var n,i,r,o,c,d,m,v=(0,e.getFieldValue)(["resource","acceleratorType"]);return(0,P.jsx)(L.Z.Item,{name:["resource","accelerator"],label:g("session.launcher.AIAccelerator"),tooltip:{placement:"right",title:(0,P.jsx)($.cC,{i18nKey:"session.launcher.DescAIAccelerator"})},rules:[{required:se.length>0},{type:"number",min:(null===(n=ue.accelerators[v])||void 0===n?void 0:n.min)||0,max:null===(i=ue.accelerators[v])||void 0===i?void 0:i.max},{validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(x().endsWith(v,"shares")&&l.getFieldValue("cluster_size")>=2&&i%1!==0)){e.next=4;break}return e.abrupt("return",Promise.reject(g("session.launcher.OnlyAllowsDiscreteNumberByClusterSize")));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()},{warningOnly:null===(r=b._config)||void 0===r?void 0:r.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(x().isNumber(ae.accelerators[v])&&i>ae.accelerators[v])){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=b._config)&&void 0!==r&&r.always_enqueue_compute_session?g("session.launcher.EnqueueComputeSessionWarning"):g("session.launcher.ErrorCanNotExceedRemaining",{amount:ae.accelerators[v]})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(M.Z,{sliderProps:{marks:(0,s.Z)((0,s.Z)({0:0},ae.accelerators[v]?(0,t.Z)({},ae.accelerators[v],{label:(0,P.jsx)(ee,{})}):{}),x().isNumber(null===(o=ue.accelerators[v])||void 0===o?void 0:o.max)?(0,t.Z)({},null===(c=ue.accelerators[v])||void 0===c?void 0:c.max,null===(d=ue.accelerators[v])||void 0===d?void 0:d.max):{}),tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(q.Ec[v])},open:!(se.length<=0)&&void 0}},disabled:0===se.length&&x().isEmpty(l.getFieldValue(["environments","manual"])),min:0,max:null===(m=ue.accelerators[v])||void 0===m?void 0:m.max,step:x().endsWith(v,"shares")&&l.getFieldValue("cluster_size")<2?.1:1,inputNumberProps:{addonAfter:(0,P.jsx)(L.Z.Item,{noStyle:!0,name:["resource","acceleratorType"],initialValue:x().keys(j)[0],children:(0,P.jsx)(S.Z,{tabIndex:-1,disabled:0===se.length&&x().isEmpty(l.getFieldValue(["environments","manual"])),suffixIcon:x().size(j)>1?void 0:null,popupMatchSelectWidth:!1,options:x().map(j,(function(e,n){return{value:n,label:q.Ec[n]||"UNIT",disabled:se.length>0&&!x().find(se,(function(e){return(null===e||void 0===e?void 0:e.key)===n}))}}))})})}})})}})]})}})}),n?(0,P.jsx)(Q.Z,{style:{marginBottom:y.margin},children:(0,P.jsx)(L.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.cluster_size!==n.cluster_size},children:function(){var e;return(0,P.jsx)(L.Z.Item,{name:["num_of_sessions"],label:g("webui.menu.Sessions"),tooltip:(0,P.jsx)($.cC,{i18nKey:"session.launcher.DescSession"}),required:!0,rules:[{required:!0},{warningOnly:null===(e=b._config)||void 0===e?void 0:e.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(ce&&i>ce.remaining)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=b._config)&&void 0!==r&&r.always_enqueue_compute_session?g("session.launcher.EnqueueComputeSessionWarning"):g("session.launcher.ErrorCanNotExceedRemaining",{amount:ce.remaining})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(M.Z,{inputNumberProps:{addonAfter:"#"},disabled:l.getFieldValue("cluster_size")>1,sliderProps:{marks:(0,s.Z)((0,s.Z)((0,t.Z)({},null===ce||void 0===ce?void 0:ce.min,null===ce||void 0===ce?void 0:ce.min),null!==ce&&void 0!==ce&&ce.remaining?(0,t.Z)({},null===ce||void 0===ce?void 0:ce.remaining,{label:(0,P.jsx)(ee,{})}):{}),{},(0,t.Z)({},null===ce||void 0===ce?void 0:ce.max,null===ce||void 0===ce?void 0:ce.max))},min:null===ce||void 0===ce?void 0:ce.min,max:null===ce||void 0===ce?void 0:ce.max})})}})}):null,b.supports("multi-container")&&(0,P.jsx)(L.Z.Item,{label:g("session.launcher.ClusterMode"),tooltip:(0,P.jsxs)(I.Z,{direction:"column",align:"start",children:[g("session.launcher.SingleNode"),(0,P.jsx)($.cC,{i18nKey:"session.launcher.DescSingleNode"}),(0,P.jsx)(G.Z,{style:{backgroundColor:y.colorBorder}}),g("session.launcher.MultiNode"),(0,P.jsx)($.cC,{i18nKey:"session.launcher.DescMultiNode"})]}),required:!0,children:(0,P.jsx)(Q.Z,{style:{marginBottom:y.margin},children:(0,P.jsxs)(z.Z,{gutter:y.marginMD,children:[(0,P.jsx)(W.Z,{xs:24,children:(0,P.jsx)(L.Z.Item,{name:"cluster_mode",required:!0,children:(0,P.jsxs)(X.ZP.Group,{onChange:function(e){l.validateFields().catch((function(){}))},children:[(0,P.jsx)(X.ZP.Button,{value:"single-node",children:g("session.launcher.SingleNode")}),(0,P.jsx)(X.ZP.Button,{value:"multi-node",children:g("session.launcher.MultiNode")})]})})}),(0,P.jsx)(W.Z,{xs:24,children:(0,P.jsx)(L.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.cluster_mode!==n.cluster_mode},children:function(){var e,n,i=x().min([null===(e=ue.cpu)||void 0===e?void 0:e.max,K.max_containers_per_session]),r="single-node"===l.getFieldValue("cluster_mode")?g("session.launcher.Container"):g("session.launcher.Node");return(0,P.jsx)(L.Z.Item,{name:"cluster_size",label:g("session.launcher.ClusterSize"),required:!0,rules:[{warningOnly:null===(n=b._config)||void 0===n?void 0:n.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=x().min([ae.cpu,K.max_containers_per_session]),!(x().isNumber(r)&&i>r)){e.next=5;break}return e.abrupt("return",Promise.reject(g("session.launcher.EnqueueComputeSessionWarning")));case 5:return e.abrupt("return",Promise.resolve());case 6:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(M.Z,{min:1,step:1,max:x().isNumber(i)?i:void 0,disabled:1===i,sliderProps:{marks:(0,s.Z)((0,s.Z)({1:"1"},ae.cpu?(0,t.Z)({},ae.cpu,{label:(0,P.jsx)(ee,{})}):{}),x().isNumber(i)?(0,t.Z)({},i,i):{}),tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(r)}}},inputNumberProps:{addonAfter:r},onChange:function(e){e>1&&l.setFieldValue("num_of_sessions",1)}})})}})})]})})})]})},ee=function(){var e=C.Z.useToken().token;return(0,P.jsx)(I.Z,{style:{position:"absolute",top:-24,transform:"translateX(-50%)",color:e.colorSuccess,opacity:.5},children:(0,P.jsx)(B.Z,{})})},ne=p.memo(Y)},71947:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},i=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:i,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:i},params:{cacheID:"ea71f4a3948d4742dd6bb11ef80a8300",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:"query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    name\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n  }\n}\n"}}}();r.hash="33367bd6e1532b42b61629ef9d3dc46b",n.default=r},73340:function(e,n,i){i.r(n);var r=function(){var e=[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetSelectQuery",selections:e,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ResourcePresetSelectQuery",selections:e},params:{cacheID:"bd89430b9924d926a1b8e91191746b4f",id:null,metadata:{},name:"ResourcePresetSelectQuery",operationKind:"query",text:"query ResourcePresetSelectQuery {\n  resource_presets {\n    name\n    resource_slots\n    shared_memory\n  }\n}\n"}}}();r.hash="9841642e96d89476c2848bfb093ed9c5",n.default=r},25338:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"accessKey"}],n=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"accessKey"}],concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"concurrency_used",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairQuery",selections:n},params:{cacheID:"1f8fc324e9907111de581f5cd2dc3640",id:null,metadata:{},name:"hooksUsingRelay_KeyPairQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairQuery(\n  $accessKey: String!\n) {\n  keypair(access_key: $accessKey) {\n    id\n    resource_policy\n    concurrency_used\n  }\n}\n"}}}();r.hash="d8f5c91f0fc46a3366f57566ab688d81",n.default=r},94177:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n},params:{cacheID:"ad7039c1935637fe3f3841f0ea8bf347",id:null,metadata:{},name:"hooksUsingRelay_KeyPairResourcePolicyQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairResourcePolicyQuery(\n  $name: String!\n) {\n  keypair_resource_policy(name: $name) {\n    max_containers_per_session\n    max_concurrent_sessions\n  }\n}\n"}}}();r.hash="f3f7364c63aefe9b03111b584c48c103",n.default=r}}]);
//# sourceMappingURL=392.78bc7216.chunk.js.map