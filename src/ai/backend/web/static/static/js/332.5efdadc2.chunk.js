"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[332],{97855:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointLLMChatCard_endpoint",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"d5fbaab35efda649f9f7847ee51028b6"},l=i},50396:(e,n,t)=>{t.d(n,{W:()=>a});var i=t(63075),l=(t(53350),t(60598));const a=e=>{let{name:n,height:t,width:a}=e;const o=i.Pt.icons[null!==n&&void 0!==n?n:"pure"];return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",height:t,width:a,role:"img",dangerouslySetInnerHTML:{__html:o.body}})}},90003:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"endpoint_id"},n={defaultValue:null,kind:"LocalArgument",name:"filter"},t={defaultValue:null,kind:"LocalArgument",name:"limit"},i={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"projectID"},a={defaultValue:null,kind:"LocalArgument",name:"skipEndpoint"},o=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],d={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},c={args:null,kind:"FragmentSpread",name:"EndpointLLMChatCard_endpoint"},p=[{kind:"Variable",name:"endpoint_id",variableName:"endpoint_id"}],m=[s,r,u,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:[e,n,t,i,l,a],kind:"Fragment",metadata:null,name:"EndpointSelectQuery",selections:[{alias:null,args:o,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[d,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[s,r,u,c],storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[s,r,c],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[i,t,l,n,e,a],kind:"Operation",name:"EndpointSelectQuery",selections:[{alias:null,args:o,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[d,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:m,storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:m,storageKey:null}]},params:{cacheID:"4ed77e0d8d228a82aa36a46316bc28ca",id:null,metadata:{},name:"EndpointSelectQuery",operationKind:"query",text:"query EndpointSelectQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n  $filter: String\n  $endpoint_id: UUID!\n  $skipEndpoint: Boolean!\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: $filter) {\n    total_count\n    items {\n      name\n      endpoint_id\n      url\n      ...EndpointLLMChatCard_endpoint\n      id\n    }\n  }\n  endpoint(endpoint_id: $endpoint_id) @skipOnClient(if: $skipEndpoint) {\n    name\n    endpoint_id\n    ...EndpointLLMChatCard_endpoint\n    id\n  }\n}\n\nfragment EndpointLLMChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="bc98e0b499fc7a18b88e87841f5e6e47";const l=i},31513:(e,n,t)=>{t.d(n,{B:()=>o});var i=t(23441),l=t(73e3),a=t(53350);const o=()=>{var e;const[n,t]=(0,i.Tw)("first"),{data:o,isLoading:d}=(0,l.nN)({queryKey:["useAgents",n],queryFn:()=>fetch("resources/ai-agents.json").then((e=>e.json())),staleTime:864e5});return{agents:null!==(e=null===o||void 0===o?void 0:o.agents)&&void 0!==e?e:[],isLoading:d,refresh:(0,a.useCallback)((()=>t()),[t])}}},80332:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Qe});var i=t(29217),l=t(23441),a=t(73e3),o=t(31513),d=t(39768),s=t(51847),r=t(1581),u=t(53350),c=t(60598);function p(e,n){return e.map((e=>({label:e.meta.title,value:e.id}))).filter((e=>e.label.toLocaleLowerCase().includes(n||"")))}const m=e=>{let{agents:n,defaultId:t,onSelectAgent:i,loading:l,...a}=e;const[o,d]=(0,s.A)(a),[m,g]=(0,u.useState)(),[h,y]=(0,u.useTransition)();return(0,c.jsx)(r.A,{showSearch:!0,onSearch:e=>{y((()=>{g(e)}))},filterOption:!1,loading:h||l,options:p(n,m),value:o,onChange:(e,n)=>{d(e,n)},popupMatchSelectWidth:!1})};var g,h=t(46976),y=t.n(h),v=t(22018);const f=e=>{let{fetchKey:n,lifecycleStageFilter:i=["created"],loading:a,...o}=e;const d=(0,l.CX)(),[p,m]=(0,s.A)(o),[h,f]=(0,u.useState)(),[x,j]=(0,u.useTransition)(),k=i.map((e=>`lifecycle_stage == "${e}"`)).join(" | "),{endpoint_list:A,endpoint:b}=(0,v.useLazyLoadQuery)(void 0!==g?g:g=t(90003),{limit:10,offset:0,filter:d.supports("endpoint-lifecycle-stage-filter")?[k,h].filter(Boolean).map((e=>`(${e})`)).join(" & "):void 0,endpoint_id:p,skipEndpoint:!p},{fetchKey:n}),S=b?y().map(y().uniqBy(y().concat(null===A||void 0===A?void 0:A.items,b),"endpoint_id"),(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e}))):y().map(null===A||void 0===A?void 0:A.items,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e})));return(0,c.jsx)(r.A,{showSearch:!0,onSearch:e=>{j((()=>{f(e&&`name ilike "%${e}%"`)}))},filterOption:!1,loading:x||a,options:S,...o,value:p,onChange:(e,n)=>{var t;m(e,null===(t=y().castArray(n))||void 0===t?void 0:t[0].endpoint)}})};var x=t(72338),j=t(50396),k=t(72375);const A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[n,i]=(0,u.useState)(0);return(0,u.useEffect)((()=>{(0,u.startTransition)((()=>{(async e=>{const{encode:n}=await t.e(2471).then(t.bind(t,32471));return n(e).length})(e).then(i).catch((()=>{i(e.length)}))}))}),[e]),n};var b=t(11383);const S=e=>{let{style:n,loading:t,autoFocus:i,onStop:l,onSend:a,...o}=e;const d=(0,u.useRef)(null);return(0,u.useEffect)((()=>{i&&d.current&&d.current.focus()}),[i]),(0,c.jsx)(b.A,{ref:d,...o,loading:t,onSubmit:()=>{null===a||void 0===a||a()},onCancel:()=>{null===l||void 0===l||l()},submitType:"enter"})};var C=t(91788);const L=e=>{let{models:n,allowCustomModel:t,...i}=e;const{t:l}=(0,C.Bd)();return(0,c.jsx)(r.A,{placeholder:l("chatui.SelectModel"),style:{fontWeight:"normal"},showSearch:!0,options:y().concat(t?[{label:"Custom",value:"custom"}]:[],y().chain(n).groupBy("group").mapValues((e=>y().map(e,(e=>({label:e.label,value:e.name}))))).map(((e,n)=>({label:"undefined"===n?"Others":n,options:e}))).value()),popupMatchSelectWidth:!1,...i})};var w=t(82919),E=t(52335),_=t(31456),I=t(167),T=t(37542);const M=e=>{let{copyable:n,defaultIcon:t,...i}=e;const[l,a]=(0,u.useState)(!1);return(0,u.useEffect)((()=>{if(l){const e=setTimeout((()=>{a(!1)}),2e3);return()=>clearTimeout(e)}}),[l]),(0,c.jsx)(w.A,{title:l?"Copied!":"Copy",open:!!l||void 0,children:(0,c.jsx)(T.CopyToClipboard,{text:(null===n||void 0===n?void 0:n.text)||"",onCopy:async()=>{a(!0)},children:(0,c.jsx)(E.Ay,{icon:l?(0,c.jsx)(_.A,{}):t||(0,c.jsx)(I.A,{}),...i})})})};var F=t(50128),D=t(20418),K=(t(92134),t(23409)),R=t(28304),U=t(83376),$=t(22608),B=t(80557),V=t(52737);const{Text:P}=F.A,q=e=>{let{children:n}=e;return(0,c.jsx)(K.o,{remarkPlugins:[B.A,V.A],rehypePlugins:[$.A],components:{p(e){let{node:n,...t}=e;return(0,c.jsx)("p",{...t,style:{whiteSpace:"pre-wrap"}})},code(e){const{children:n,className:t,node:i,ref:l,...a}=e,o=/language-(\w+)/.exec(t||""),d=String(n).replace(/\n$/,"");return o?(0,c.jsx)(D.A,{title:(0,c.jsx)(P,{style:{fontWeight:"normal"},type:"secondary",children:o[1]}),type:"inner",size:"small",extra:(0,c.jsx)(M,{type:"text",copyable:{text:"s"}}),styles:{body:{padding:0},header:{margin:0}},children:(0,c.jsx)("div",{style:{margin:"-0.5em 0",width:"100%"},children:(0,c.jsx)(Q,{ref:l,...a,PreTag:"div",language:o[1],style:U.A,wrapLongLines:!0,wrapLines:!0,children:d})})}):(0,c.jsx)("code",{...a,className:t,children:n})}},children:n})},z=e=>{let{children:n,...t}=e;return(0,c.jsx)(R.A,{...t,children:n})},Q=u.memo(z),H=u.memo(q);var O=t(79429),W=t(65839),N=t(9571),J=t(69546),Y=t(38385),G=t(85391),X=t(49978),Z=t(78502),ee=t.n(Z),ne=t(48787),te=t.n(ne),ie=t(2660),le=t.n(ie);ee().extend(te()),ee().extend(le());const ae=e=>{let{extra:n,message:t,placement:i="left",containerStyle:l,enableExtraHover:a,isStreaming:o}=e;const{token:d}=N.A.useToken(),{t:s}=(0,C.Bd)(),[r,p]=(0,u.useState)(!1),m=(0,W.A)(t.reasoning,{wait:50}),g=(0,W.A)(t.content,{wait:50});return(0,c.jsxs)(x.A,{direction:"left"===i?"row":"row-reverse",justify:"start",align:"baseline",style:{marginLeft:"left"===i?"0":"15%",marginRight:"right"===i?"0":20,...l},gap:"sm",onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:["user"!==t.role?(0,c.jsx)(J.A,{icon:"\ud83e\udd16",style:{fontSize:d.fontSizeHeading3}}):null,(0,c.jsxs)(x.A,{direction:"column",align:"left"===i?"start":"end",wrap:"wrap",style:{flex:1},gap:"xs",children:[y().map(t.experimental_attachments,((e,n)=>y().includes(null===e||void 0===e?void 0:e.contentType,"image/")?(0,c.jsx)(x.A,{style:{border:"none",textAlign:"end"},align:"end",children:(0,c.jsx)(Y.A,{src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name,style:{maxWidth:"50vw",maxHeight:"12vh",borderRadius:d.borderRadius}},`${null===t||void 0===t?void 0:t.id}-${n}`)}):(0,c.jsx)(O.A.FileCard,{item:{uid:`${null===t||void 0===t?void 0:t.id}-${n}`,name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.url),type:null===e||void 0===e?void 0:e.contentType,description:null===e||void 0===e?void 0:e.name,url:null===e||void 0===e?void 0:e.url}},n))),(0,c.jsxs)(x.A,{align:"stretch",direction:"column",style:{borderRadius:d.borderRadius,borderColor:d.colorBorderSecondary,borderWidth:d.lineWidth,padding:"1em",paddingTop:0,paddingBottom:0,backgroundColor:"user"!==t.role?d.colorBgContainer:d.colorBgContainerDisabled,maxWidth:"100%",width:y().trim(t.reasoning)?"100%":"auto"},children:[y().trim(t.reasoning)&&(0,c.jsx)(G.A,{style:{marginTop:d.margin,width:"100%"},items:[{key:"reasoning",label:y().isEmpty(g)?(0,c.jsxs)(x.A,{gap:"xs",children:[(0,c.jsx)(F.A.Text,{children:s("chatui.Thinking")}),(0,c.jsx)(X.A,{size:"small"})]}):(0,c.jsx)(F.A.Text,{children:s("chatui.ViewReasoning")}),children:(0,c.jsx)(H,{children:m})}]}),(0,c.jsx)(H,{children:g+(o?"\n\u25cf":"")})]}),(0,c.jsx)(x.A,{style:{fontSize:d.fontSizeSM,...a?{opacity:r?1:0,transition:"opacity 0.2s",transitionDelay:r?"0s":"0.2s"}:{}},children:n})]})]})};var oe=t(68098),de=t(7126);const se=e=>{let{autoScroll:n,atBottom:t,lastMessageContent:i,...l}=e;const a=(0,oe.E)(l.onScrollToBottom);return(0,u.useEffect)((()=>{t&&n&&(null===a||void 0===a||a("auto"))}),[t,n,i,a]),(0,c.jsx)(E.Ay,{icon:(0,c.jsx)(de.A,{}),shape:"circle",onClick:()=>{a&&a("click")}})};var re=t(85064),ue=t(2646);const ce=e=>{let{messages:n,isStreaming:t}=e;const i=(0,u.useRef)(null),[l,a]=(0,u.useState)(!0),{token:o}=N.A.useToken(),d="undefined"!==typeof window?1.5*window.innerHeight:0;return(0,c.jsxs)(x.A,{direction:"column",align:"stretch",style:{height:"100%",flex:1},children:[(0,c.jsx)(ue.aY,{atBottomStateChange:a,atBottomThreshold:60,computeItemKey:(e,n)=>n.id,data:n,followOutput:"auto",initialTopMostItemIndex:(null===n||void 0===n?void 0:n.length)-1,itemContent:(e,i)=>(0,c.jsx)(ae,{message:i,placement:"user"===i.role?"right":"left",containerStyle:{paddingLeft:o.paddingMD,paddingRight:o.paddingMD,paddingTop:0===e?o.paddingMD:0,paddingBottom:e===n.length-1?o.paddingMD:0},isStreaming:"user"!==i.role&&t&&e===n.length-1,enableExtraHover:"user"===i.role,extra:"user"!==i.role?(0,c.jsx)(re.Ay,{children:(0,c.jsx)(M,{type:"text",size:"small",copyable:{text:i.content}})}):(0,c.jsx)(re.Ay,{children:null})},i.id),overscan:d,ref:i}),(0,c.jsx)("div",{style:{position:"absolute",right:"50%",transform:"translateX(+50%)",bottom:o.marginSM,opacity:l?0:1,transition:"opacity 0.2s",transitionDelay:l?"0s":"0.2s"},children:(0,c.jsx)(se,{atBottom:l,autoScroll:t,onScrollToBottom:e=>{const n=i.current;switch(e){case"auto":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"auto",index:"LAST"});break;case"click":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"smooth",index:"LAST"})}},lastMessageContent:y().get(y().last(n),"content")})})]})};var pe=t(93232),me=t(46538),ge=t(10424),he=t(51282),ye=t(27319),ve=t(12943),fe=t(56431),xe=t(27857),je=t(79773),ke=t(9712),Ae=t(13170),be=t(83978),Se=t(58325),Ce=t(24798),Le=t(2822);const we=e=>{var n;let{models:t=[],endpointId:i,systemPrompt:a,chatId:o,baseURL:d,headers:r,credentials:p,apiKey:m,fetchOnClient:g,allowCustomModel:h,alert:v,leftExtra:f,inputMessage:j,inputAttachment:w,submitKey:_,onInputChange:I,onAttachmentChange:T,onSubmitChange:M,showCompareMenuItem:K,modelToken:R,...U}=e;const $=(0,l.f0)(),[B,V]=(0,u.useState)(!1),[P,q]=(0,u.useState)([]),[z,Q]=(0,s.A)(U,{valuePropName:"modelId",trigger:"onModelChange",defaultValue:null===t||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id}),H=(0,u.useRef)(null),W=(0,u.useRef)(null),{messages:J,error:Y,input:G,setInput:X,stop:Z,isLoading:ee,append:ne,setMessages:te}=(0,me.Y_)({id:o,api:d,credentials:p,body:{modelId:z},fetch:async(e,n)=>{if(g||"custom"===z){var t,i,l;const e=JSON.parse(null===n||void 0===n?void 0:n.body),o=(0,pe.r)({baseURL:h?null===(t=H.current)||void 0===t?void 0:t.getFieldValue("baseURL"):d,apiKey:(h?null===(i=H.current)||void 0===i?void 0:i.getFieldValue("token"):m)||"dummy"}),s=(0,xe.gM)({abortSignal:(null===n||void 0===n?void 0:n.signal)||void 0,model:(0,xe.ae)({model:o(h?null===(l=H.current)||void 0===l?void 0:l.getFieldValue("modelId"):z),middleware:(0,xe.Ol)({tagName:"think"})}),messages:null===e||void 0===e?void 0:e.messages,system:a});return oe(Date.now()),s.toDataStreamResponse({sendReasoning:!0})}return fetch(e,n)}}),{token:ie}=N.A.useToken(),{t:le}=(0,C.Bd)(),[ae,oe]=(0,u.useState)(null);(0,u.useEffect)((()=>{y().isUndefined(j)||X(j)}),[j,X]);(0,u.useEffect)((()=>{(e=>{y().isUndefined(e)||y().isEqual(P,e)||(q(e),V(!0))})(w)}),[w]),(0,u.useEffect)((()=>{if(!y().isUndefined(_)&&G){const e={};y().isEmpty(P)||(e.experimental_attachments=(0,k.bJ)(P)),ne({role:"user",content:G},e)}}),[_]);const de=A(G),se=(0,u.useMemo)((()=>y().map(J,(e=>null===e||void 0===e?void 0:e.content)).join("")),[J]),re=de+A(se),ue=(0,u.useMemo)((()=>{const e=y().last(J);return"assistant"===(null===e||void 0===e?void 0:e.role)?null===e||void 0===e?void 0:e.content:""}),[J]),we=A(ue),Ee=(0,u.useMemo)((()=>we>0&&ae?we/((Date.now()-ae)/1e3):0),[we,ae]),_e=(0,k.LY)([K&&{key:"compare",label:le("chatui.CompareWithOtherModels"),icon:(0,c.jsx)(Le.A,{}),onClick:()=>{$(`/serving?tab=chatting&endpointId=${i}&modelId=${z}`)}},K&&{type:"divider"},{key:"clear",danger:!0,label:le("chatui.DeleteChatHistory"),icon:(0,c.jsx)(ge.A,{}),onClick:()=>{te([])}}]);return(0,c.jsxs)(D.A,{ref:W,bordered:!0,extra:[],...U,title:(0,c.jsx)(x.A,{direction:"column",align:"stretch",gap:"sm",children:(0,c.jsxs)(x.A,{direction:"row",gap:"xs",children:[f,(0,c.jsx)(L,{models:t,value:z,onChange:Q,allowCustomModel:h}),(0,c.jsx)(je.A,{menu:{items:_e},trigger:["click"],children:(0,c.jsx)(E.Ay,{type:"link",onClick:e=>e.preventDefault(),icon:(0,c.jsx)(he.A,{}),style:{color:ie.colorTextSecondary,width:ie.sizeMS}})})]})}),style:{height:"100%",width:"100%",display:"flex",flexDirection:"column"},styles:{body:{backgroundColor:ie.colorFillQuaternary,borderRadius:0,flex:1,display:"flex",flexDirection:"column",padding:0,height:"50%",position:"relative"},actions:{paddingLeft:ie.paddingContentHorizontal,paddingRight:ie.paddingContentHorizontal},header:{zIndex:1}},actions:[(0,c.jsx)(S,{autoFocus:!0,value:G,placeholder:"Say something...",header:(0,c.jsx)(b.A.Header,{closable:!1,title:le("chatui.Attachments"),open:!!B&&!y().isEmpty(P),onOpenChange:V,styles:{content:{padding:0}},children:(0,c.jsx)(O.A,{beforeUpload:()=>!1,getDropContainer:()=>W.current,accept:"image/*,text/*",items:P,onChange:e=>{let{fileList:n}=e;q(n),null===T||void 0===T||T(n)},placeholder:e=>"drop"===e?{title:le("chatui.DropFileHere")}:{icon:(0,c.jsx)(ye.A,{}),title:le("chatui.UploadFiles"),description:le("chatui.UploadFilesDescription")}})}),prefix:(0,c.jsx)(O.A,{beforeUpload:()=>!1,getDropContainer:()=>W.current,accept:"image/*,text/*",items:P,onChange:e=>{let{fileList:n}=e;q(n),null===T||void 0===T||T(n),V(!0)},placeholder:e=>"drop"===e?{title:le("chatui.DropFileHere")}:{icon:(0,c.jsx)(ye.A,{}),title:le("chatui.UploadFiles"),description:le("chatui.UploadFilesDescription")},children:(0,c.jsx)(ke.A,{dot:!y().isEmpty(P)&&!B,children:(0,c.jsx)(E.Ay,{type:"text",icon:(0,c.jsx)(ve.A,{})})})}),onChange:e=>{X(e),I&&I(e)},loading:ee,onStop:()=>{Z()},onSend:()=>{if(G||!y().isEmpty(P)){const e={};y().isEmpty(P)||(e.experimental_attachments=(0,k.bJ)(P)),ne({role:"user",content:G},e),setTimeout((()=>{X(""),q([]),V(!1)}),0),null===M||void 0===M||M()}},style:{flex:1}})],children:[(0,c.jsx)(x.A,{direction:"row",style:{padding:ie.paddingSM,paddingRight:ie.paddingContentHorizontalLG,paddingLeft:ie.paddingContentHorizontalLG,backgroundColor:ie.colorBgContainer,display:h&&"custom"===z?"flex":"none"},children:(0,c.jsxs)(Ae.A,{ref:H,layout:"horizontal",size:"small",requiredMark:"optional",style:{flex:1},initialValues:{baseURL:d,token:R},children:[v?(0,c.jsx)("div",{style:{marginBottom:ie.size},children:v}):null,(0,c.jsx)(Ae.A.Item,{label:"baseURL",name:"baseURL",rules:[{type:"url"},{required:!0}],children:(0,c.jsx)(be.A,{placeholder:"https://domain/v1"})}),(0,c.jsx)(Ae.A.Item,{label:"Model ID",name:"modelId",rules:[{required:!0}],children:(0,c.jsx)(be.A,{placeholder:"llm-model"})}),(0,c.jsx)(Ae.A.Item,{label:"Token",name:"token",children:(0,c.jsx)(be.A,{})})]},d)}),y().isEmpty(null===Y||void 0===Y?void 0:Y.message)?null:(0,c.jsx)(Se.A,{message:null===Y||void 0===Y?void 0:Y.message,type:"error",showIcon:!0,style:{margin:ie.marginSM},closable:!0}),(0,c.jsx)(ce,{messages:J,isStreaming:ee}),(0,c.jsx)(x.A,{justify:"end",align:"end",style:{margin:ie.marginSM},children:(0,c.jsx)(Ce.A,{children:(0,c.jsxs)(x.A,{gap:"xs",children:[(0,c.jsx)(fe.A,{}),(0,c.jsxs)(x.A,{gap:"xxs",children:[(0,c.jsx)(F.A.Text,{children:Ee.toFixed(2)}),(0,c.jsx)(F.A.Text,{type:"secondary",children:"tok/s"})]}),(0,c.jsxs)(x.A,{gap:"xxs",children:[(0,c.jsx)(F.A.Text,{children:re}),(0,c.jsx)(F.A.Text,{type:"secondary",children:"total tokens"})]})]})})})]})};var Ee,_e=t(59203),Ie=t(43622),Te=t(24034),Me=t(21110),Fe=t(7322);const De=(0,Me.eU)(""),Ke=(0,Me.eU)(),Re=(0,Me.eU)(void 0),Ue=e=>{var n,i,s,r,p;let{basePath:g="v1",closable:h,defaultModelId:k,defaultEndpoint:A,defaultAgentId:b,isSynchronous:S,onRequestClose:L,onModelChange:w,..._}=e;const{t:I}=(0,C.Bd)(),{token:T}=N.A.useToken(),[M,F]=(0,l.Tw)("first"),[D,K]=(0,u.useState)(A||null),R=(0,v.useFragment)(void 0!==Ee?Ee:Ee=t(97855),D),[U,$]=(0,u.useState)(R),[B,V]=(0,Fe.fp)(De),[P,q]=(0,Fe.fp)(Ke),[z,Q]=(0,Fe.fp)(Re),{data:H}=(0,a.nj)({queryKey:["models",M,null===R||void 0===R?void 0:R.endpoint_id],queryFn:()=>{var e;return null!==R&&void 0!==R&&R.url?fetch(new URL(g+"/models",null!==(e=null===R||void 0===R?void 0:R.url)&&void 0!==e?e:void 0).toString()).then((e=>e.json())).catch((e=>({data:[]}))):Promise.resolve({data:[]})}}),O=y().map(null===H||void 0===H?void 0:H.data,(e=>({id:e.id,name:e.id}))),W=(0,u.useId)(),{agents:J}=(0,o.B)(),[Y,G]=(0,u.useState)(b),X=(0,u.useMemo)((()=>J.find((e=>e.id===Y))),[J,Y]),[Z]=(0,d.q)("experimental_ai_agents");return(0,u.useEffect)((()=>{G(b)}),[b]),(0,c.jsx)(we,{..._,chatId:`${null===R||void 0===R?void 0:R.endpoint_id}_${Y}`,baseURL:null!==R&&void 0!==R&&R.url?new URL(g,null!==(n=null===R||void 0===R?void 0:R.url)&&void 0!==n?n:void 0).toString():void 0,models:O,systemPrompt:null===X||void 0===X||null===(i=X.config)||void 0===i?void 0:i.system_prompt,fetchOnClient:!0,leftExtra:(0,c.jsxs)(c.Fragment,{children:[Z&&X&&(0,c.jsxs)(x.A,{gap:"xs",children:[(0,c.jsx)(j.W,{name:X.meta.avatar,height:32,width:32}),(0,c.jsx)(m,{agents:J,value:Y,onChange:e=>{(0,u.startTransition)((()=>{G(e)}))}})]}),(0,c.jsx)(f,{placeholder:I("chatui.SelectEndpoint"),style:{fontWeight:"normal"},fetchKey:M,showSearch:!0,loading:(null===U||void 0===U?void 0:U.endpoint_id)!==(null===R||void 0===R?void 0:R.endpoint_id),onChange:(e,n)=>{$(n),(0,u.startTransition)((()=>{K(n)}))},value:null===R||void 0===R?void 0:R.endpoint_id,popupMatchSelectWidth:!1})]}),modelId:k&&y().includes(y().map(null===H||void 0===H?void 0:H.data,"id"),k)?k:null!==(s=null===H||void 0===H||null===(r=H.data)||void 0===r||null===(p=r[0])||void 0===p?void 0:p.id)&&void 0!==s?s:"custom",extra:h?(0,c.jsx)(Te.A,{title:I("chatui.DeleteChattingSession"),description:I("chatui.DeleteChattingSessionDescription"),onConfirm:()=>{null===L||void 0===L||L()},okText:I("button.Delete"),okButtonProps:{danger:!0},children:(0,c.jsx)(E.Ay,{icon:(0,c.jsx)(_e.A,{}),type:"text",style:{color:T.colorIcon}})}):void 0,allowCustomModel:y().isEmpty(O),alert:y().isEmpty(O)&&(0,c.jsx)(Se.A,{type:"warning",showIcon:!0,message:I("chatui.CannotFindModel"),action:(0,c.jsx)(E.Ay,{icon:(0,c.jsx)(Ie.A,{}),onClick:()=>{F()},children:I("button.Refresh")})}),inputMessage:S?B:void 0,onInputChange:e=>{V(e)},inputAttachment:S?P:void 0,onAttachmentChange:e=>{q(e)},submitKey:(null===z||void 0===z?void 0:z.id)===W||null===z||void 0===z?void 0:z.key,onSubmitChange:()=>{V(""),q([]),S&&Q({id:W,key:(new Date).toString()})}})};var $e,Be=t(53051),Ve=t(9184),Pe=t(77109),qe=t(91867),ze=t(32043);const Qe=e=>{let{...n}=e;const{t:l}=(0,C.Bd)(),{list:a,remove:o,getKey:d,push:s}=(0,Ve.A)(["0"]),[r,p]=(0,u.useState)(!1),[m]=(0,ze.useQueryParam)("endpointId",ze.StringParam),[g]=(0,ze.useQueryParam)("modelId",ze.StringParam),[h]=(0,ze.useQueryParam)("agentId",ze.StringParam),f=!m,{endpoint:j,endpoint_list:k}=(0,v.useLazyLoadQuery)(void 0!==$e?$e:$e=t(85849),{endpointId:m||"",isEmptyEndpointId:f});return(0,c.jsx)(i.A,{title:l("webui.menu.Chat"),styles:{body:{overflow:"hidden"}},extra:(0,c.jsx)(x.A,{direction:"row",gap:"xs",wrap:"wrap",style:{flexShrink:1},children:(0,c.jsxs)(x.A,{gap:"xs",children:[(0,c.jsx)(F.A.Text,{type:"secondary",children:l("chatui.SyncInput")}),(0,c.jsx)(Pe.A,{value:r,onClick:e=>{p(e)}}),(0,c.jsx)(E.Ay,{onClick:()=>{s((new Date).toString())},icon:(0,c.jsx)(Be.A,{})})]})}),children:(0,c.jsx)(x.A,{direction:"column",align:"stretch",gap:"xs",children:(0,c.jsx)(x.A,{gap:"xs",direction:"row",style:{overflow:"auto",height:"calc(100vh - 240px)"},align:"stretch",children:y().map(a,((e,n)=>{var t;return(0,c.jsx)(u.Suspense,{fallback:(0,c.jsx)(D.A,{bordered:!0,style:{width:"100%",display:"flex",flexDirection:"column"},children:(0,c.jsx)(qe.A,{active:!0})}),children:(0,c.jsx)(Ue,{defaultModelId:0===n&&j.ok&&g?g:void 0,defaultEndpoint:0===n&&j.ok?j.value||void 0:(null===k||void 0===k||null===(t=k.items)||void 0===t?void 0:t[0])||void 0,defaultAgentId:h||void 0,style:{flex:1},onRequestClose:()=>{o(n)},closable:a.length>1,isSynchronous:r},d(n))},d(n))}))})})})}},85849:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpointId"},{defaultValue:null,kind:"LocalArgument",name:"isEmptyEndpointId"}],n=[{kind:"Variable",name:"endpoint_id",variableName:"endpointId"}],t=[{args:null,kind:"FragmentSpread",name:"EndpointLLMChatCard_endpoint"}],i=[{kind:"Literal",name:"limit",value:1},{kind:"Literal",name:"offset",value:0}],l=[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatPageQuery",selections:[{kind:"CatchField",field:{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:t,storageKey:null},to:"RESULT",path:"endpoint"},{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:t,storageKey:null}],storageKey:"endpoint_list(limit:1,offset:0)"}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatPageQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:l,storageKey:null},{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:l,storageKey:null}],storageKey:"endpoint_list(limit:1,offset:0)"}]},params:{cacheID:"b78052a376d66eed6b273f0ababb32fc",id:null,metadata:{},name:"ChatPageQuery",operationKind:"query",text:"query ChatPageQuery(\n  $endpointId: UUID!\n  $isEmptyEndpointId: Boolean!\n) {\n  endpoint(endpoint_id: $endpointId) @skipOnClient(if: $isEmptyEndpointId) {\n    ...EndpointLLMChatCard_endpoint\n    id\n  }\n  endpoint_list(limit: 1, offset: 0) {\n    items {\n      ...EndpointLLMChatCard_endpoint\n      id\n    }\n  }\n}\n\nfragment EndpointLLMChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="b884e7f7e1919ec5de6ccff8444229c8";const l=i}}]);
//# sourceMappingURL=332.5efdadc2.chunk.js.map