"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[230,502],{77758:function(e,n,t){t.d(n,{Z:function(){return l}});var a=t(1413),r=t(36459),o=t(65113),i=(t(4519),t(2556)),l=function(e){var n,t=Object.assign({},((0,r.Z)(e),e));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("style",{children:".ant-modal.bai-modal .ant-modal-content {\n  padding: var(--general-modal-content-padding, 0);\n}\n.ant-modal.bai-modal .ant-modal-body {\n  padding: var(--general-modal-body-padding, 0 24px);\n}\n\n.ant-modal.bai-modal .ant-modal-footer {\n  padding: var(--general-modal-footer-padding, 0 20px 24px 20px);\n}\n\n.ant-modal.bai-modal .ant-modal-header {\n  border-bottom: 1px solid rgb(221, 221, 221);\n  border-width: 100%;\n  justify-content: space-between;\n  display: flex;\n  align-items: center;\n}\n\n.ant-modal.bai-modal .ant-modal-content .ant-modal-header,\n.ant-modal.bai-modal .ant-modal-content > button.ant-modal-close {\n  padding: var(--general-modal-header-padding, 10px 20px);\n  height: var(--general-modal-header-height, 69px);\n}\n\n.ant-modal.bai-modal .ant-modal-content > button.ant-modal-close {\n  /* center */\n  top: 0;\n}\n"}),(0,i.jsx)(o.Z,(0,a.Z)({centered:null===(n=t.centered)||void 0===n||n,className:"bai-modal"},t))]})}},61502:function(e,n,t){t.r(n),t.d(n,{default:function(){return W},useShadowRoot:function(){return U},useWebComponentInfo:function(){return Q}});var a=t(29439),r=t(74165),o=t(15861),i=t(1413);function l(e,n){var t=(0,i.Z)({},n);return function(e){for(var n,t=/(\w+)\s@\s*(\w+)\s*\(\s*(\w+)\s*:\s*(\$?\w+)\s*\)/g,r=[];null!==(n=t.exec(e));){var o=n,i=(0,a.Z)(o,5),l=i[0],s=i[1],u=i[2],d=i[3],c=i[4];r.push({fieldName:s,directive:u,argumentName:d,argumentValue:c,originFieldStr:l})}return r}(e).forEach((function(a){if("skipOnClient"===a.directive&&"if"===a.argumentName&&(e=!a.argumentValue||!0!==n[a.argumentValue.substring(1)]&&"true"!==a.argumentValue?e.replace(a.originFieldStr,a.originFieldStr.replace(/@\s*(skipOnClient)\s*\(\s*(\w+)\s*:\s*(\$?\w+)\s*\)/,"")):e.replace(a.originFieldStr,""),a.argumentValue.startsWith("$")&&2===e.split(a.argumentValue).length)){var r=a.argumentValue.substring(1),o=new RegExp(".*".concat(r,".*\n"),"g");e=e.replace(o,""),delete t[a.argumentValue.substring(1)]}})),{query:e,variables:t}}var s=t(41011);s.RelayFeatureFlags.ENABLE_RELAY_RESOLVERS=!0;var u=function(){var e=(0,o.Z)((0,r.Z)().mark((function e(n,t){var a,o,i,s,u,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=l(n.text||"",t),s={query:i.query,variables:i.variables},u=null===(a=globalThis.backendaiclient)||void 0===a?void 0:a.newSignedRequest("POST","/admin/gql",s),e.next=5,null===(o=globalThis.backendaiclient)||void 0===o?void 0:o._wrapWithPromise(u,!1,null,1e4,0).catch((function(e){}));case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0={};case 8:return d=e.t0,e.abrupt("return",d);case 10:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();var d,c=new s.Environment({network:s.Network.create(u,void 0),store:new s.Store(new s.RecordSource)}),m=t(80382),f=t(27340),p=t(41239),g=t(47226),v=t(49883),w=t(66670),h=t(99517),b=t.n(h),y=(t(24989),t(79354)),x=t.n(y),Z=t(79748),P=t.n(Z),k=t(51714),j=t.n(k),_=t(63540),S=t.n(_),T=t(18272),F=t.n(T),C=t(9666),E=t.n(C),M=t(64447),L=t(13881),N=t(4519),V=t(81748),O=t(87112),I=t(16980),R=t(51843),A=t(12674),q=t(55144),K=t(73181),z=t(2556);b().extend(E()),b().extend(x()),b().extend(P()),b().extend(j()),b().extend(F()),b().extend(S());var $=N.createContext(null),D=N.createContext(null),U=function(){return N.useContext(D)},Q=function(){return N.useContext($)},Y=new O.QueryClient({defaultOptions:{queries:{suspense:!0,refetchOnWindowFocus:!1,retry:!1}}});M.ZP.use(V.Db).use(L.Z).init({backend:{loadPath:"/resources/i18n/{{lng}}.json"},lng:(null===globalThis||void 0===globalThis||null===(d=globalThis.backendaioptions)||void 0===d?void 0:d.get("current_language"))||"en",fallbackLng:"en",interpolation:{escapeValue:!1},react:{transSupportBasicHtmlNodes:!0,transKeepBasicHtmlNodesFor:["br","strong","span","code","p"]}});var B=function(){var e=(0,A.s0)();return(0,N.useLayoutEffect)((function(){var n=function(n){var t=n.detail;e(t,{replace:!0})};return document.addEventListener("react-navigate",n),function(){document.removeEventListener("react-navigate",n)}}),[e]),null},W=function(e){var n=e.children,t=e.value,r=e.styles,o=e.shadowRoot,i=e.dispatchEvent,l=(0,N.useMemo)((function(){return(0,f.Df)()}),[]),s=function(){var e,n=(0,N.useState)(null===globalThis||void 0===globalThis||null===(e=globalThis.backendaioptions)||void 0===e?void 0:e.get("current_language")),t=(0,a.Z)(n,2),r=t[0],o=t[1],i=(0,V.$G)().i18n;return(0,N.useEffect)((function(){setTimeout((function(){return null===i||void 0===i?void 0:i.changeLanguage(r)}),0),b().locale(r)}),[]),(0,N.useEffect)((function(){var e=function(e){var n,t;o(null===e||void 0===e||null===(n=e.detail)||void 0===n?void 0:n.lang);var a=(null===e||void 0===e||null===(t=e.detail)||void 0===t?void 0:t.lang)||"en";null===i||void 0===i||i.changeLanguage(a),b().locale(a)};return window.addEventListener("langChanged",e),function(){return window.removeEventListener("langChanged",e)}}),[i]),[r]}(),u=(0,a.Z)(s,1)[0],d=(0,m.x)(),h=(0,N.useMemo)((function(){return{value:t,dispatchEvent:i,moveTo:function(e,n){i("moveTo",{path:e,params:n})}}}),[t,i]);return(0,z.jsx)(z.Fragment,{children:c&&(0,z.jsx)(I.RelayEnvironmentProvider,{environment:c,children:(0,z.jsxs)(N.StrictMode,{children:[(0,z.jsxs)("style",{children:[r,".anticon {\n  display: inline-block;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n/* fix: fixed column shadow display outside of a table wrapper */\n.ant-table-wrapper {\n  border-radius: 8px 8px 0 0;\n  overflow: hidden;\n}\n\n/* fix: the tooltip does not appear in the `<Form.Item tooltip={'something'}` when the popup container is a parent node of the trigger node. */\n.ant-form-item-label {\n  overflow: unset !important;\n}\n"]}),(0,z.jsx)(O.QueryClientProvider,{client:Y,children:(0,z.jsx)(D.Provider,{value:o,children:(0,z.jsx)($.Provider,{value:h,children:(0,z.jsx)(p.ZP,{getPopupContainer:function(e){return(null===e||void 0===e?void 0:e.parentNode)||o},locale:"ko"===u?w.Z:v.Z,theme:d,children:(0,z.jsx)(g.Z,{children:(0,z.jsx)(f.V9,{container:o,cache:l,children:(0,z.jsx)(N.Suspense,{fallback:"",children:(0,z.jsx)(R.VK,{children:(0,z.jsxs)(q.QueryParamProvider,{adapter:K.Q,options:{},children:[(0,z.jsx)(B,{}),n]})})})})})})})})})]})})})}},79898:function(e,n,t){t.r(n),t.d(n,{default:function(){return k},passwordPattern:function(){return P}});var a=t(29439),r=t(43255),o=t(87760),i=t(50164),l=t(61502),s=t(99277),u=t(87462),d=t(4519),c={icon:function(e,n){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z",fill:e}},{tag:"path",attrs:{d:"M172.2 828.1h679.6L512 239.9 172.2 828.1zM560 720a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm-16-304v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8z",fill:n}},{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z",fill:e}}]}},name:"warning",theme:"twotone"},m=t(9491),f=function(e,n){return d.createElement(m.Z,(0,u.Z)({},e,{ref:n,icon:c}))};var p=d.forwardRef(f),g=t(44036),v=t(57054),w=t(65113),h=t(28499),b=t(38818),y=t(92171),x=t(81748),Z=t(2556),P=/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,k=function(){var e,n=(0,l.useWebComponentInfo)(),t=n.value,u=n.dispatchEvent;try{e=JSON.parse(t||"")}catch(L){e={open:!1,currentPassword:"",username:"",api_endpoint:""}}var c=e,m=c.open,f=c.currentPassword,k=c.username,j=c.api_endpoint,_=g.Z.useToken().token,S=v.Z.useForm(),T=(0,a.Z)(S,1)[0],F=(0,x.$G)().t;(0,d.useEffect)((function(){m&&T.resetFields()}),[m,T]);var C=(0,o.M)({api_endpoint:j}),E=(0,i.Y)({mutationFn:function(e){return(0,r.Lc)({method:"POST",url:"/server/update-password-no-auth",body:e,client:C})}}),M=function(){T.validateFields().then((function(e){E.mutate({username:k,current_password:f,new_password:e.newPassword},{onSuccess:function(e,n,t){u("ok",null)},onError:function(e,n,t){}})}))};return(0,Z.jsx)(w.Z,{open:m,centered:!0,mask:!1,onCancel:function(){u("cancel",null)},keyboard:!1,maskClosable:!1,footer:null,width:450,destroyOnClose:!0,forceRender:!0,children:(0,Z.jsxs)(s.Z,{direction:"column",justify:"start",align:"stretch",gap:"md",style:{alignSelf:"stretch",paddingTop:_.paddingMD,paddingBottom:_.paddingMD},children:[(0,Z.jsxs)(h.Z.Title,{level:3,style:{margin:0},children:[(0,Z.jsx)(p,{twoToneColor:_.colorWarning})," ",F("webui.menu.PleaseChangeYourPassword")]}),F("webui.menu.YouMushChangeYourPassword"),(0,Z.jsxs)(v.Z,{form:T,layout:"vertical",initialValues:{currentPassword:f},disabled:E.isLoading,children:[(0,Z.jsx)(v.Z.Item,{name:"newPassword",label:F("webui.menu.NewPassword"),rules:[{required:!0},{pattern:P,message:F("webui.menu.InvalidPasswordMessage").toString()},function(){return{validator:function(e,n){return f===n?Promise.reject(new Error(F("webui.menu.NewPasswordCannotBeSame").toString())):Promise.resolve()}}}],hasFeedback:!0,children:(0,Z.jsx)(b.Z.Password,{})}),(0,Z.jsx)(v.Z.Item,{name:"confirm",label:F("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0},function(e){var n=e.getFieldValue;return{validator:function(e,t){return t&&n("newPassword")!==t?Promise.reject(new Error(F("environment.PasswordsDoNotMatch").toString())):Promise.resolve()}}}],children:(0,Z.jsx)(b.Z.Password,{onPressEnter:M})})]}),(0,Z.jsx)(y.ZP,{type:"primary",onClick:M,loading:E.isLoading,children:F("webui.menu.Update")})]})})}},14749:function(e,n,t){var a,r=t(1413),o=t(29439),i=t(44925),l=t(87760),s=t(50164),u=t(77758),d=t(99277),c=t(44036),m=t(57054),f=t(88464),p=t(39883),g=t(42272),v=t(28499),w=t(38818),h=(t(4519),t(81748)),b=t(87112),y=t(16980),x=t(2556),Z=["userFrgmt","onRequestClose"];n.Z=function(e){var n=e.userFrgmt,P=void 0===n?null:n,k=e.onRequestClose,j=(0,i.Z)(e,Z),_=(0,h.$G)().t,S=c.Z.useToken().token,T=m.Z.useForm(),F=(0,o.Z)(T,1)[0],C=(0,y.useFragment)(void 0!==a?a:a=t(78067),P),E=(0,l.Dj)(),M=(0,b.useQuery)({queryKey:["initialize_totp",null===E||void 0===E?void 0:E.email,j.open],queryFn:function(){return(null===C||void 0===C?void 0:C.email)!==(null===E||void 0===E?void 0:E.email)||null!==C&&void 0!==C&&C.totp_activated||!j.open?null:E.initialize_totp()},suspense:!1,staleTime:0,cacheTime:0}),L=(0,s.Y)({mutationFn:function(e){return E.activate_totp(e.otp)}});return(0,x.jsx)(u.Z,(0,r.Z)((0,r.Z)({title:_("webui.menu.SetupTotp"),maskClosable:!1,confirmLoading:L.isLoading,onOk:function(){F.validateFields().then((function(e){L.mutate(e,{onSuccess:function(){f.ZP.success(_("totp.TotpSetupCompleted")),k(!0)},onError:function(){f.ZP.error(_("totp.InvalidTotpCode"))}}),new Promise((function(e,n){})).then((function(){k(!0)}))}))},onCancel:function(){k()},style:{zIndex:1}},j),{},{children:M.isLoading?(0,x.jsx)(d.Z,{justify:"center",direction:"row",children:(0,x.jsx)(p.Z,{})}):M.data?(0,x.jsxs)(m.Z,{preserve:!1,form:F,validateTrigger:["onChange","onBlur"],children:[_("totp.TypeInAuthKey"),(0,x.jsx)(d.Z,{justify:"center",style:{margin:S.marginSM,gap:S.margin},children:(0,x.jsx)(g.Z,{value:M.data.totp_uri})}),_("totp.ScanQRToEnable"),(0,x.jsx)(d.Z,{justify:"center",style:{margin:S.marginSM,gap:S.margin},children:(0,x.jsx)(v.Z.Text,{copyable:!0,code:!0,children:M.data.totp_key})}),_("totp.TypeInAuthKey"),(0,x.jsx)(d.Z,{justify:"center",style:{margin:S.marginSM,gap:S.margin},children:(0,x.jsx)(m.Z.Item,{required:!0,name:"otp",children:(0,x.jsx)(w.Z,{maxLength:6,allowClear:!0,placeholder:"000000",style:{maxWidth:120}})})})]}):(0,x.jsx)(d.Z,{justify:"center",direction:"row",children:_("totp.TotpSetupNotAvailable")})}))}},51230:function(e,n,t){t.r(n),t.d(n,{default:function(){return T}});var a,r=t(1413),o=t(29439),i=t(44925),l=t(87760),s=t(1839),u=t(50164),d=t(77758),c=t(79898),m=t(14749),f=t(88724),p=t(63703),g=t(57054),v=t(88464),w=t(65113),h=t(38818),b=t(19427),y=t(62708),x=t(32048),Z=t.n(x),P=t(4519),k=t(81748),j=t(16980),_=t(2556),S=["onRequestClose"],T=function(e){var n=e.onRequestClose,x=(0,i.Z)(e,S),T=(0,k.$G)().t,F=g.Z.useForm(),C=(0,o.Z)(F,1)[0],E=v.ZP.useMessage(),M=(0,o.Z)(E,2),L=M[0],N=M[1],V=w.Z.useModal(),O=(0,o.Z)(V,2),I=O[0],R=O[1],A=(0,p.Z)(!1),q=(0,o.Z)(A,2),K=q[0],z=q[1].toggle,$=(0,l.Dj)(),D=(0,u.h)("isManagerSupportingTOTP",(function(){return $.isManagerSupportingTOTP()}),{suspense:!0}).data,U=$.supports("2FA")&&D,Q=(0,s.j)(),Y=(0,o.Z)(Q,2),B=Y[0],W=Y[1],G=(0,l.Kr)("initial-fetch"),H=(0,o.Z)(G,2),J=H[0],X=H[1],ee=(0,P.useDeferredValue)(J),ne=(0,j.useLazyLoadQuery)(void 0!==a?a:a=t(57555),{email:B.email,isNotSupportTotp:!U},{fetchPolicy:"network-only",fetchKey:ee}).user,te=(0,u.h)("baiClient.keypair.list",(function(){return $.keypair.list(B.email,["access_key","secret_key"],!0).then((function(e){return e.keypairs}))}),{suspense:!0}).data,ae=(0,u.Y)({mutationFn:function(){return $.remove_totp()}});return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("style",{children:".disabled_style_readonly,\n.disabled_style_readonly input {\n  background-color: #f5f5f5;\n}\n"}),(0,_.jsxs)(d.Z,(0,r.Z)((0,r.Z)({},x),{},{okText:T("webui.menu.Update"),cancelText:T("webui.menu.Cancel"),onCancel:function(){n()},confirmLoading:B.isPendingMutation,onOk:function(){C.validateFields().then((function(e){W.updateFullName(e.full_name,{onSuccess:function(t){t!==B.full_name&&L.open({type:"success",content:T("webui.menu.FullnameUpdated")}),e.newPassword&&e.newPasswordConfirm&&e.originalPassword?W.updatePassword({new_password:e.newPassword,new_password2:e.newPasswordConfirm,old_password:e.originalPassword},{onSuccess:function(){L.open({type:"success",content:T("webui.menu.PasswordUpdated")}),n(!0)},onError:function(e){L.open({type:"error",content:e.message})}}):n(!0)},onError:function(e){L.open({type:"error",content:e.message})}})}))},centered:!0,destroyOnClose:!0,title:T("webui.menu.MyAccountInformation"),children:[(0,_.jsxs)(g.Z,{layout:"horizontal",labelCol:{span:8},form:C,initialValues:{full_name:B.full_name,totp_activated:(null===ne||void 0===ne?void 0:ne.totp_activated)||!1,access_key:null===te||void 0===te?void 0:te[0].access_key},preserve:!1,children:[(0,_.jsx)(g.Z.Item,{name:"full_name",label:T("webui.menu.FullName"),rules:[function(){return{validator:function(e,n){return n&&n.length<65?Promise.resolve():Promise.reject(new Error(T("webui.menu.FullNameInvalid")))}}}],children:(0,_.jsx)(h.Z,{})}),(0,_.jsx)(g.Z.Item,{name:"access_key",label:T("general.AccessKey"),children:(0,_.jsx)(b.Z,{options:Z().map(te,(function(e){return{value:e.access_key}}))})}),(0,_.jsx)(g.Z.Item,{label:T("general.SecretKey"),shouldUpdate:function(e,n){return e.access_key!==n.access_key},children:function(e){var n,t=e.getFieldValue;return(0,_.jsx)(h.Z.Password,{value:null===(n=Z().find(te,["access_key",t("access_key")]))||void 0===n?void 0:n.secret_key,className:"disabled_style_readonly",readOnly:!0})}}),(0,_.jsx)(g.Z.Item,{name:"originalPassword",label:T("webui.menu.OriginalPassword"),rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return t||!n("newPassword")&&!n("newPasswordConfirm")?Promise.resolve():Promise.reject(new Error(T("webui.menu.InputOriginalPassword")))}}}],dependencies:["newPassword","newPasswordConfirm"],children:(0,_.jsx)(h.Z.Password,{})}),(0,_.jsx)(g.Z.Item,{name:"newPassword",label:T("webui.menu.NewPassword"),rules:[{pattern:c.passwordPattern,message:T("webui.menu.InvalidPasswordMessage")}],children:(0,_.jsx)(h.Z.Password,{})}),(0,_.jsx)(g.Z.Item,{name:"newPasswordConfirm",label:T("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return t&&n("newPassword")!==t?Promise.reject(new Error(T("webui.menu.NewPasswordMismatch"))):Promise.resolve()}}}],children:(0,_.jsx)(h.Z.Password,{})}),!!U&&(0,_.jsx)(g.Z.Item,{name:"totp_activated",label:T("webui.menu.TotpActivated"),valuePropName:"checked",children:(0,_.jsx)(y.Z,{onChange:function(e){e?z():null!==ne&&void 0!==ne&&ne.totp_activated&&(C.setFieldValue("totp_activated",!0),I.confirm({title:T("totp.TurnOffTotp"),icon:(0,_.jsx)(f.Z,{}),content:T("totp.ConfirmTotpRemovalBody"),okText:T("button.Yes"),okType:"danger",cancelText:T("button.No"),onOk:function(){ae.mutate(void 0,{onSuccess:function(){v.ZP.success(T("totp.RemoveTotpSetupCompleted")),X(),C.setFieldValue("totp_activated",!1)},onError:function(e){v.ZP.error(e.message)}})},onCancel:function(){C.setFieldValue("totp_activated",!0)}}))}})})]}),!!U&&(0,_.jsx)(m.Z,{userFrgmt:ne,open:K,onRequestClose:function(e){e?X():C.setFieldValue("totp_activated",!1),z()}})]})),N,R]})}},78067:function(e,n,t){t.r(n);var a={argumentDefinitions:[{kind:"RootArgument",name:"isNotSupportTotp"}],kind:"Fragment",metadata:null,name:"TOTPActivateModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null}],type:"User",abstractKey:null,hash:"f5da6b3094f7d70bef9373d9c907955c"};n.default=a},57555:function(e,n,t){t.r(n);var a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"}],n=[{kind:"Variable",name:"email",variableName:"email"}],t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserProfileSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,a,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserProfileSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,a,{alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null}],storageKey:null}]},params:{cacheID:"b0c9773ff4a3e759f0f9822463daa757",id:null,metadata:{},name:"UserProfileSettingModalQuery",operationKind:"query",text:"query UserProfileSettingModalQuery(\n  $email: String!\n  $isNotSupportTotp: Boolean!\n) {\n  user(email: $email) {\n    id\n    totp_activated @skipOnClient(if: $isNotSupportTotp)\n    ...TOTPActivateModalFragment\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();a.hash="c87e74dfaa01d51a1697e67df81e101b",n.default=a},1839:function(e,n,t){t.d(n,{T:function(){return c},j:function(){return m}});var a=t(1413),r=t(29439),o=t(87760),i=t(43255),l=t(50164),s=t(32048),u=t.n(s),d=t(4519),c=function(){var e=(0,o.Kr)("first"),n=(0,r.Z)(e,2),t=n[0],a=n[1],i=(0,o.Dj)();return[(0,l.h)({queryKey:["useResourceSlots",t],queryFn:function(){return i.get_resource_slots()},staleTime:0}).data,{refresh:function(){return a()}}]},m=function(){var e=(0,o.Dj)(),n=(0,d.useState)({full_name:e.full_name,email:e.email}),t=(0,r.Z)(n,2),s=t[0],c=t[1];(0,d.useEffect)((function(){var n=function(n){if(e.supports("change-user-name")){var t=n.detail;c((function(e){return(0,a.Z)((0,a.Z)({},e),{},{full_name:t})}))}};return document.addEventListener("current-user-info-changed",n),function(){document.removeEventListener("current-user-info-changed",n)}}),[e]);var m=(0,l.Y)({mutationFn:function(n){return e.update_full_name(n.email,n.full_name)}}),f=(0,l.Y)({mutationFn:function(n){return e.update_password(n.old_password,n.new_password,n.new_password2)}});return[(0,a.Z)((0,a.Z)({},s),{},{username:function(){var n=u().trim(s.full_name).length>0?s.full_name:s.email;if(e._config.maskUserInfo){var t=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(n)?n.split("@")[0].length-2:n.length-2;n=(0,i.Cd)(n,"*",2,t)}return n}(),isPendingMutation:m.isLoading||f.isLoading}),{updateFullName:function(n,t){m.mutate({full_name:n,email:e.email},{onSuccess:function(){(null===t||void 0===t?void 0:t.onSuccess)&&t.onSuccess(n),document.dispatchEvent(new CustomEvent("current-user-info-changed",{detail:n})),c((function(e){return(0,a.Z)((0,a.Z)({},e),{},{full_name:n})}))},onError:function(e){(null===t||void 0===t?void 0:t.onError)&&t.onError(e)}})},updatePassword:function(e,n){f.mutate(e,{onSuccess:function(){(null===n||void 0===n?void 0:n.onSuccess)&&n.onSuccess(void 0)},onError:function(e){(null===n||void 0===n?void 0:n.onError)&&n.onError(e)}})}}]}}}]);
//# sourceMappingURL=230.46e20d97.chunk.js.map