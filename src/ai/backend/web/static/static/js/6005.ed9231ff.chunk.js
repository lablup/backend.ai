"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[6005],{50555:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ChatCard_endpoint",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"b1ec3869b3c8db05d40a1d2089bf4681"},l=i},38166:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"endpointId"},n={defaultValue:null,kind:"LocalArgument",name:"filter"},t={defaultValue:null,kind:"LocalArgument",name:"isEmptyEndpointId"},i=[{kind:"Variable",name:"endpoint_id",variableName:"endpointId"}],l={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},a=[l,{args:null,kind:"FragmentSpread",name:"ChatCard_endpoint"}],o=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Literal",name:"limit",value:1},{kind:"Literal",name:"offset",value:0}],s=[l,{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:[e,n,t],kind:"Fragment",metadata:null,name:"ConversationQuery",selections:[{kind:"CatchField",field:{alias:null,args:i,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:a,storageKey:null},to:"RESULT"},{alias:null,args:o,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:a,storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,t,n],kind:"Operation",name:"ConversationQuery",selections:[{alias:null,args:i,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:s,storageKey:null},{alias:null,args:o,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:s,storageKey:null}],storageKey:null}]},params:{cacheID:"56259e350d53dc9561096bb424a1b3c7",id:null,metadata:{},name:"ConversationQuery",operationKind:"query",text:"query ConversationQuery(\n  $endpointId: UUID!\n  $isEmptyEndpointId: Boolean!\n  $filter: String\n) {\n  endpoint(endpoint_id: $endpointId) @skipOnClient(if: $isEmptyEndpointId) {\n    endpoint_id\n    ...ChatCard_endpoint\n    id\n  }\n  endpoint_list(limit: 1, offset: 0, filter: $filter) {\n    items {\n      endpoint_id\n      ...ChatCard_endpoint\n      id\n    }\n  }\n}\n\nfragment ChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="61d8c291f586bd041b033742fd247d67";const l=i},86164:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"endpoint_id"},n={defaultValue:null,kind:"LocalArgument",name:"filter"},t={defaultValue:null,kind:"LocalArgument",name:"limit"},i={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"projectID"},a={defaultValue:null,kind:"LocalArgument",name:"skipEndpoint"},o=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],s={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},u={args:null,kind:"FragmentSpread",name:"ChatCard_endpoint"},p=[{kind:"Variable",name:"endpoint_id",variableName:"endpoint_id"}],m=[d,r,c,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:[e,n,t,i,l,a],kind:"Fragment",metadata:null,name:"EndpointSelectQuery",selections:[{alias:null,args:o,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[s,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[d,r,c,u],storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[d,r,u],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[i,t,l,n,e,a],kind:"Operation",name:"EndpointSelectQuery",selections:[{alias:null,args:o,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[s,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:m,storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:m,storageKey:null}]},params:{cacheID:"3e721bc4d82b8863ef87a9a37d052d0d",id:null,metadata:{},name:"EndpointSelectQuery",operationKind:"query",text:"query EndpointSelectQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n  $filter: String\n  $endpoint_id: UUID!\n  $skipEndpoint: Boolean!\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: $filter) {\n    total_count\n    items {\n      name\n      endpoint_id\n      url\n      ...ChatCard_endpoint\n      id\n    }\n  }\n  endpoint(endpoint_id: $endpoint_id) @skipOnClient(if: $skipEndpoint) {\n    name\n    endpoint_id\n    ...ChatCard_endpoint\n    id\n  }\n}\n\nfragment ChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="02cb33fa42cc8d8aa56c5ddd6542c548";const l=i},27766:(e,n,t)=>{t.d(n,{W:()=>a});var i=t(77668),l=(t(1426),t(42906));const a=e=>{let{name:n,height:t,width:a}=e;const o=i.Pt.icons[null!==n&&void 0!==n?n:"pure"];return(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",height:t,width:a,role:"img",dangerouslySetInnerHTML:{__html:o.body}})}},49871:(e,n,t)=>{t.d(n,{B:()=>o});var i=t(32967),l=t(88616),a=t(1426);const o=()=>{var e;const[n,t]=(0,i.Tw)("first"),{data:o,isLoading:s}=(0,l.nN)({queryKey:["useAgents",n],queryFn:()=>fetch("resources/ai-agents.json").then((e=>e.json())),staleTime:864e5});return{agents:null!==(e=null===o||void 0===o?void 0:o.agents)&&void 0!==e?e:[],isLoading:s,refresh:(0,a.useCallback)((()=>t()),[t])}}},66005:(e,n,t)=>{t.r(n),t.d(n,{default:()=>pn});var i=t(80403),l=t(32967),a=t(90840),o=t(88616),s=t(49871),d=t(75045),r=t(46606),c=t(27766),u=t(37383),p=t(59571),m=t(88961),g=t(1426),h=t(42906);function v(e,n){return e.map((e=>({label:e.meta.title,value:e.id,...e}))).filter((e=>e.label.toLocaleLowerCase().includes(n||"")))}const y=e=>{let{loading:n,agents:t,selectedAgent:i,...l}=e;const{token:o}=p.A.useToken(),[s,d]=(0,u.A)(l,{valuePropName:"value",trigger:"onChange",defaultValue:l.value}),[r,y]=(0,g.useState)(),[x,f]=(0,g.useTransition)();return(0,h.jsx)(h.Fragment,{children:i&&(0,h.jsxs)(a.A,{gap:"xs",children:[(0,h.jsx)(c.W,{name:i.meta.avatar,height:o.sizeXL,width:o.sizeXL}),(0,h.jsx)(m.A,{showSearch:!0,onSearch:e=>{f((()=>{y(e)}))},filterOption:!1,loading:x||n,options:v(t,r),value:s,onChange:(e,n)=>{d(e,n)},popupMatchSelectWidth:!1})]})})};var x,f=t(27484),k=t.n(f),b=t(9976),j=t(18347);const C=e=>{let{fetchKey:n,lifecycleStageFilter:i=["created"],loading:a,...o}=e;const{t:s}=(0,b.Bd)(),d=(0,l.CX)(),[r,c]=(0,u.A)(o),[p,v]=(0,g.useState)(),[y,f]=(0,g.useTransition)(),C=i.map((e=>`lifecycle_stage == "${e}"`)).join(" | "),{endpoint_list:A,endpoint:S}=(0,j.useLazyLoadQuery)(void 0!==x?x:x=t(86164),{limit:10,offset:0,filter:d.supports("endpoint-lifecycle-stage-filter")?[C,p].filter(Boolean).map((e=>`(${e})`)).join(" & "):void 0,endpoint_id:r,skipEndpoint:!r},{fetchKey:n}),w=S?k().map(k().uniqBy(k().concat(null===A||void 0===A?void 0:A.items,S),"endpoint_id"),(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e}))):k().map(null===A||void 0===A?void 0:A.items,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e})));return(0,h.jsx)(m.A,{placeholder:s("chatui.SelectEndpoint"),style:{fontWeight:"normal"},showSearch:!0,onSearch:e=>{f((()=>{v(e&&`name ilike "%${e}%"`)}))},filterOption:!1,loading:y||a,options:w,...o,value:r,onChange:(e,n)=>{var t;c(e,null===(t=k().castArray(n))||void 0===t?void 0:t[0].endpoint)}})},A=e=>{let{models:n,allowCustomModel:t,...i}=e;const{t:l}=(0,b.Bd)();return(0,h.jsx)(m.A,{placeholder:l("chatui.SelectModel"),style:{fontWeight:"normal"},showSearch:!0,options:k().concat(t?[{label:"Custom",value:"custom"}]:[],k().chain(n).groupBy("group").mapValues((e=>k().map(e,(e=>({label:e.label,value:e.name}))))).map(((e,n)=>({label:"undefined"===n?"Others":n,options:e}))).value()),popupMatchSelectWidth:!1,...i})};var S=t(32017),w=t(39651),I=t(17257),L=t(3730),T=t(12418),_=t(64181),E=t(20818),M=t(16332),F=t(95440);const R=e=>{let{sync:n,onClick:t}=e;const{t:i}=(0,b.Bd)();return(0,h.jsxs)(h.Fragment,{children:[n&&(0,h.jsx)(L.A.Text,{type:"secondary",children:i("chatui.SyncInput")}),(0,h.jsx)(T.A,{checked:n,onClick:t})]})},K=e=>{let{chat:n,showCompareMenuItem:t,allowCustomModel:i,closable:o,models:s,modelId:c,setModelId:u,endpoint:m,setEndpoint:v,agents:x,agent:f,setAgent:k,sync:j,setSync:L,onRequestClose:T,onCreateNewChat:K,fetchKey:$,setMessages:B}=e;const{t:D}=(0,b.Bd)(),{token:q}=p.A.useToken(),N=(0,l.f0)(),[U,V]=(0,g.useState)(m),z=(0,d.LY)([t&&{key:"compare",label:D("chatui.CompareWithOtherModels"),icon:(0,h.jsx)(M.A,{}),onClick:()=>{N(`/serving?tab=chatting&endpointId=${null===m||void 0===m?void 0:m.endpoint_id}&modelId=${c}`)}},t&&{type:"divider"},{key:"clear",label:D("chatui.DeleteChatHistory"),icon:(0,h.jsx)(F.A,{}),onClick:()=>{B([])}},o&&{type:"divider"},o&&{key:"close",danger:!0,label:D("chatui.DeleteChattingSession"),icon:(0,h.jsx)(S.A,{}),onClick:()=>{null===T||void 0===T||T(n)}}]),[H]=(0,r.q)("experimental_ai_agents");return(0,h.jsxs)(a.A,{direction:"row",justify:"start",wrap:"wrap",gap:"xs",style:{minHeight:"56px",width:"100%",paddingTop:q.paddingXS,paddingBottom:q.paddingXS},children:[(0,h.jsxs)(a.A,{wrap:"wrap",align:"start",gap:"xs",style:{flexGrow:1,flexShrink:1,flexBasis:"auto"},children:[H&&(0,h.jsx)(y,{agents:x,selectedAgent:f,value:null===f||void 0===f?void 0:f.id,onChange:(e,n)=>{(0,g.startTransition)((()=>{k(n)}))}}),(0,h.jsx)(C,{fetchKey:$,loading:(null===U||void 0===U?void 0:U.endpoint_id)!==(null===m||void 0===m?void 0:m.endpoint_id),onChange:(e,n)=>{V(n),(0,g.startTransition)((()=>{v(n)}))},value:null===m||void 0===m?void 0:m.endpoint_id,popupMatchSelectWidth:!1}),(0,h.jsx)(A,{models:s,value:c,onChange:e=>{(0,g.startTransition)((()=>{u(e)}))},allowCustomModel:i})]}),(0,h.jsxs)(a.A,{gap:"xs",children:[o&&(0,h.jsx)(R,{sync:j,onClick:e=>{(0,g.startTransition)((()=>{L(e)}))}}),(0,h.jsx)(_.Ay,{onClick:()=>null===K||void 0===K?void 0:K(),icon:(0,h.jsx)(w.A,{})}),(0,h.jsx)(E.A,{menu:{items:z},trigger:["click"],children:(0,h.jsx)(_.Ay,{type:"link",onClick:e=>e.preventDefault(),icon:(0,h.jsx)(I.A,{}),style:{color:q.colorTextSecondary,width:q.sizeMS}})})]})]})};var $=t(58049),B=t(7405),D=t(49087),q=t(69810),N=t(79151);const U=e=>{let{items:n,onChange:t,dropContainerRef:i,children:l}=e;const{t:a}=(0,b.Bd)();return(0,h.jsx)(D.A,{beforeUpload:()=>!1,getDropContainer:()=>i.current,accept:"image/*,text/*",items:n,onChange:t,placeholder:e=>"drop"===e?{title:a("chatui.DropFileHere")}:{icon:(0,h.jsx)($.A,{}),title:a("chatui.UploadFiles"),description:a("chatui.UploadFilesDescription")},children:l})},V=e=>{let{loading:n,autoFocus:t,items:i,openAttachment:l,dropContainerRef:a,onInputChange:o,onInputSubmit:s,onInputCancel:d,onAttachmentChange:r,onAttachmentOpenChange:c,...u}=e;const{t:p}=(0,b.Bd)(),m=(0,g.useRef)(null);return(0,g.useEffect)((()=>{t&&m.current&&m.current.focus()}),[t]),(0,h.jsx)(q.A,{style:{flex:1},ref:m,...u,loading:n,onChange:o,onSubmit:s,onCancel:d,submitType:"enter",header:(0,h.jsx)(q.A.Header,{closable:!1,title:p("chatui.Attachments"),open:!!l&&!(0,f.isEmpty)(i),onOpenChange:c,styles:{content:{padding:0}},children:(0,h.jsx)(U,{items:i,dropContainerRef:a,onChange:e=>null===r||void 0===r?void 0:r("header",e)})}),prefix:(0,h.jsx)(U,{items:i,dropContainerRef:a,onChange:e=>null===r||void 0===r?void 0:r("prefix",e),children:(0,h.jsx)(N.A,{dot:!(0,f.isEmpty)(i)&&!l,children:(0,h.jsx)(_.Ay,{type:"text",icon:(0,h.jsx)(B.A,{})})})})})};var z=t(62021),H=t(74157);const O=(0,z.eU)(""),Q=(0,z.eU)(),P=(0,z.eU)(void 0),W=e=>{let{sync:n,input:t,setInput:i,stop:l,append:o,isStreaming:s,dropContainerRef:r}=e;const{token:c}=p.A.useToken(),u={borderTop:`1px solid ${c.colorBorderSecondary}`,padding:c.paddingContentVertical},[m,v]=(0,g.useState)(!1),[y,x]=(0,g.useState)([]),[k,b]=(0,H.fp)(O),[j,C]=(0,H.fp)(Q),[A,S]=(0,H.fp)(P),w=(0,g.useId)(),I=(null===A||void 0===A?void 0:A.id)===w||null===A||void 0===A?void 0:A.key,L=(0,g.useRef)(n);(0,g.useEffect)((()=>{L.current!==n&&(i(""),L.current=n)}),[n,i]),(0,g.useEffect)((()=>{n&&!(0,f.isUndefined)(k)&&i(k)}),[k,i,n]);(0,g.useEffect)((()=>{var e;e=j,(0,f.isUndefined)(e)||(0,f.isEqual)(y,e)||(x(e),v(!0))}),[j]),(0,g.useEffect)((()=>{if(!(0,f.isUndefined)(I)&&t){const e={};(0,f.isEmpty)(y)||(e.experimental_attachments=(0,d.bJ)(y)),o({role:"user",content:t},e)}}),[I]);const T=(0,g.useCallback)((e=>{i(e),n&&b(e)}),[n,i,b]),_=(0,g.useCallback)((()=>{l()}),[l]),E=(0,g.useCallback)((()=>{if(t||!(0,f.isEmpty)(y)){const e={};(0,f.isEmpty)(y)||(e.experimental_attachments=(0,d.bJ)(y)),o({role:"user",content:t},e),setTimeout((()=>{i(""),x([]),v(!1)}),0),b(""),C([]),n&&S({id:w,key:(new Date).toString()})}}),[t,y,o,b,C,n,i,S,w]),M=(0,g.useCallback)(((e,t)=>{const i=t.fileList;x(i),"prefix"===e&&v(!0),n&&C(i)}),[n,x,v,C]),F=(0,g.useCallback)((e=>{v(e)}),[v]);return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(a.A,{style:u,direction:"column",align:"center",children:(0,h.jsx)(V,{placeholder:"Say something...",autoFocus:!0,value:t,items:y,openAttachment:m,dropContainerRef:r,loading:s,onInputChange:T,onInputSubmit:E,onInputCancel:_,onAttachmentChange:M,onAttachmentOpenChange:F})})})},X=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[n,i]=(0,g.useState)(0);return(0,g.useEffect)((()=>{(0,g.startTransition)((()=>{(async e=>{const{encode:n}=await t.e(1254).then(t.bind(t,61254));return n(e).length})(e).then(i).catch((()=>{i(e.length)}))}))}),[e]),n};var G=t(50495),Y=t(20447);const J=e=>{let{input:n,messages:t,startTime:i}=e;const{token:l}=p.A.useToken(),o=X(n),s=(0,g.useMemo)((()=>(0,f.map)(t,(e=>null===e||void 0===e?void 0:e.content)).join("")),[t]),d=o+X(s),r=(0,g.useMemo)((()=>{const e=(0,f.last)(t);return"assistant"===(null===e||void 0===e?void 0:e.role)?null===e||void 0===e?void 0:e.content:""}),[t]),c=X(r),u=(0,g.useMemo)((()=>c>0&&i?c/((Date.now()-i)/1e3):0),[c,i]);return(0,h.jsx)(a.A,{justify:"end",align:"end",style:{margin:l.marginSM},children:(0,h.jsx)(Y.A,{children:(0,h.jsxs)(a.A,{gap:"xs",children:[(0,h.jsx)(G.A,{}),(0,h.jsxs)(a.A,{gap:"xxs",children:[(0,h.jsx)(L.A.Text,{children:u.toFixed(2)}),(0,h.jsx)(L.A.Text,{type:"secondary",children:"tok/s"})]}),(0,h.jsxs)(a.A,{gap:"xxs",children:[(0,h.jsx)(L.A.Text,{children:d}),(0,h.jsx)(L.A.Text,{type:"secondary",children:"total tokens"})]})]})})})};var Z=t(10137);const ee=(0,g.memo)((e=>{let{children:n,placement:t={},avatar:i,onMouseEnter:l,onMouseLeave:o}=e;const{token:s}=p.A.useToken();return(0,h.jsxs)(a.A,{direction:t.left?"row":"row-reverse",justify:"start",align:"baseline",style:{marginLeft:t.left?0:"15%",marginRight:t.right?0:20,paddingLeft:s.paddingMD,paddingRight:s.paddingMD,paddingTop:t.top?s.paddingMD:0,paddingBottom:t.bottom?s.paddingMD:0},gap:"sm",onMouseEnter:l,onMouseLeave:o,children:[(0,h.jsx)(Z.A,{icon:i,style:{fontSize:s.fontSizeHeading3}}),(0,h.jsx)(a.A,{direction:"column",align:t.left?"start":"end",wrap:"wrap",style:{flex:1},gap:"xs",children:n})]})}));ee.displayName="ChatMessageContainer";var ne=t(70468),te=t(31778),ie=t(29865),le=t(80994);const ae=e=>{let{copyable:n,defaultIcon:t,...i}=e;const[l,a]=(0,g.useState)(!1);return(0,g.useEffect)((()=>{if(l){const e=setTimeout((()=>{a(!1)}),2e3);return()=>clearTimeout(e)}}),[l]),(0,h.jsx)(ne.A,{title:l?"Copied!":"Copy",open:!!l||void 0,children:(0,h.jsx)(le.CopyToClipboard,{text:(null===n||void 0===n?void 0:n.text)||"",onCopy:async()=>{a(!0)},children:(0,h.jsx)(_.Ay,{icon:l?(0,h.jsx)(te.A,{}):t||(0,h.jsx)(ie.A,{}),...i})})})};var oe=t(53517),se=t(5656),de=t(25596),re=t(43114);const ce={abap:!0,"actionscript-3":!0,ada:!0,apache:!0,apex:!0,apl:!0,applescript:!0,ara:!0,asm:!0,astro:!0,awk:!0,ballerina:!0,bat:!0,beancount:!0,berry:!0,bibtex:!0,bicep:!0,blade:!0,c:!0,cadence:!0,clarity:!0,clojure:!0,cmake:!0,cobol:!0,codeql:!0,coffee:!0,cpp:!0,crystal:!0,csharp:!0,css:!0,cue:!0,cypher:!0,d:!0,dart:!0,dax:!0,diff:!0,docker:!0,"dream-maker":!0,elixir:!0,elm:!0,erb:!0,erlang:!0,fish:!0,fsharp:!0,gdresource:!0,gdscript:!0,gdshader:!0,gherkin:!0,"git-commit":!0,"git-rebase":!0,"glimmer-js":!0,"glimmer-ts":!0,glsl:!0,gnuplot:!0,go:!0,graphql:!0,groovy:!0,hack:!0,haml:!0,handlebars:!0,haskell:!0,hcl:!0,hjson:!0,hlsl:!0,html:!0,http:!0,imba:!0,ini:!0,java:!0,javascript:!0,"jinja-html":!0,jison:!0,json:!0,json5:!0,jsonc:!0,jsonl:!0,jsonnet:!0,jssm:!0,jsx:!0,julia:!0,kotlin:!0,kusto:!0,latex:!0,less:!0,liquid:!0,lisp:!0,logo:!0,lua:!0,make:!0,markdown:!0,marko:!0,matlab:!0,mdc:!0,mdx:!0,mermaid:!0,mojo:!0,narrat:!0,nextflow:!0,nginx:!0,nim:!0,nix:!0,"objective-c":!0,"objective-cpp":!0,ocaml:!0,pascal:!0,perl:!0,php:!0,plsql:!0,postcss:!0,powerquery:!0,powershell:!0,prisma:!0,prolog:!0,proto:!0,pug:!0,puppet:!0,purescript:!0,python:!0,r:!0,raku:!0,razor:!0,reg:!0,rel:!0,riscv:!0,rst:!0,ruby:!0,rust:!0,sas:!0,sass:!0,scala:!0,scheme:!0,scss:!0,shaderlab:!0,shellscript:!0,shellsession:!0,smalltalk:!0,solidity:!0,sparql:!0,splunk:!0,sql:!0,"ssh-config":!0,stata:!0,stylus:!0,svelte:!0,swift:!0,"system-verilog":!0,tasl:!0,tcl:!0,tex:!0,toml:!0,tsx:!0,turtle:!0,twig:!0,typescript:!0,v:!0,vb:!0,verilog:!0,vhdl:!0,viml:!0,vue:!0,"vue-html":!0,vyper:!0,wasm:!0,wenyan:!0,wgsl:!0,wolfram:!0,xml:!0,xsl:!0,yaml:!0,zenscript:!0,zig:!0,bash:!0,batch:!0,be:!0,"c#":!0,cdc:!0,clj:!0,cmd:!0,console:!0,cql:!0,cs:!0,dockerfile:!0,erl:!0,"f#":!0,fs:!0,fsl:!0,gjs:!0,gts:!0,hbs:!0,hs:!0,jade:!0,js:!0,kql:!0,makefile:!0,md:!0,nar:!0,nf:!0,objc:!0,perl6:!0,properties:!0,ps:!0,ps1:!0,py:!0,ql:!0,rb:!0,rs:!0,sh:!0,shader:!0,shell:!0,spl:!0,styl:!0,ts:!0,vim:!0,vimscript:!0,vy:!0,yml:!0,zsh:!0,"\u6587\u8a00":!0},ue=(0,g.memo)((e=>{let{children:n,language:t}=e;const{data:i,isLoading:l}=((e,n)=>{const{isDarkMode:t}=(0,oe.e)(),i=n.toLowerCase(),l=ce[i]?i:"txt",a=(0,g.useMemo)((()=>re.VV.hashStr(e)),[e]);return(0,de.Ay)([l,t?"d":"l",a].join("-"),(async()=>{try{return(0,se.Yz)(e,{lang:l,theme:t?"github-dark":"github-light"})}catch(n){return console.error("shiki Highlight error:",n),e}}))})(n,t);return(0,h.jsx)(h.Fragment,{children:l||!i?(0,h.jsx)("pre",{children:(0,h.jsx)("code",{children:n})}):(0,h.jsx)("div",{dangerouslySetInnerHTML:{__html:i},dir:"ltr"})})}));ue.displayName="SyntaxHighlighter";t(15148);var pe=t(611),me=t(46132),ge=t(33532),he=t(2128),ve=t(63357),ye=t(47732);const{Text:xe}=L.A;const fe=(0,g.memo)((e=>{let{children:n,...t}=e;return(0,h.jsx)(ue,{...t,children:n})}));fe.displayName="CodeBlock";const ke=(0,g.memo)((e=>{let{lang:n,extra:t}=e;const{token:i}=p.A.useToken();return(0,h.jsxs)(a.A,{style:{margin:0,minHeight:38,padding:`0 ${i.paddingSM}px`,background:"rgba(0, 0, 0, 0.02)",width:"100%"},children:[(0,h.jsx)(a.A,{style:{display:"inline-block",flex:"1",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:(0,h.jsx)(xe,{style:{fontWeight:"normal"},type:"secondary",children:n})}),(0,h.jsx)(a.A,{children:t})]})}));ke.displayName="CodeHead";const be=(0,g.memo)((e=>{let{block:n,isStreaming:t}=e;const i=(0,g.useCallback)((e=>{const{children:n,className:i,node:l,ref:o,...s}=e,d=/language-(\w+)/.exec(i||""),r=String(null!==n&&void 0!==n?n:"").replace(/\n$/,""),{token:c}=p.A.useToken();return d?(0,h.jsxs)(a.A,{direction:"column",style:{border:"1px solid #f0f0f0",margin:"0",padding:"0",borderRadius:c.borderRadiusLG,overflow:"hidden"},children:[(0,h.jsx)(ke,{lang:d[1],extra:(0,h.jsx)(ae,{type:"text",copyable:{text:null!==r&&void 0!==r?r:""},style:{display:t?"none":"block"}})}),(0,h.jsx)(a.A,{style:{width:"100%",padding:c.paddingSM,borderRadius:`0 0 ${c.borderRadiusLG}px ${c.borderRadiusLG}px`,margin:"-0.5em 0"},children:(0,h.jsx)(fe,{...s,PreTag:"div",language:d[1],style:ge.A,wrapLongLines:!0,wrapLines:!0,children:r})})]}):(0,h.jsx)("code",{...s,className:i,children:n})}),[t]),l=(0,g.useCallback)((e=>{let{node:n,...t}=e;return(0,h.jsx)("p",{...t,style:{whiteSpace:"pre-wrap"}})}),[]);return(0,h.jsx)(me.oz,{remarkPlugins:[ve.A,ye.A],rehypePlugins:[he.A],components:{p:l,code:i},children:n})}));be.displayName="ChatMessageContentBlock";const je=e=>{let{children:n,isStreaming:t}=e;return(0,g.useMemo)((()=>{return e=null!==n&&void 0!==n?n:"",pe.xI.lexer(e).map((e=>e.raw));var e}),[n]).map(((e,n)=>(0,h.jsx)(be,{block:e,isStreaming:t},`block_${n}`)))};je.displayName="ChatMessageContent";const Ce=(0,g.memo)(je);var Ae=t(24764),Se=t(31795),we=t(46443);const Ie=e=>{let{extra:n,message:t,placement:i,enableExtraHover:l,isStreaming:o,avatar:s}=e;const{token:d}=p.A.useToken(),{t:r}=(0,b.Bd)(),[c,u]=(0,g.useState)(!1),{content:m,reasoning:v}=t;return(0,h.jsxs)(ee,{placement:i,avatar:s,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[k().map(t.experimental_attachments,((e,n)=>k().includes(null===e||void 0===e?void 0:e.contentType,"image/")?(0,h.jsx)(a.A,{style:{border:"none",textAlign:"end"},align:"end",children:(0,h.jsx)(Ae.A,{src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name,style:{maxWidth:"50vw",maxHeight:"12vh",borderRadius:d.borderRadius}},`${null===t||void 0===t?void 0:t.id}-${n}`)}):(0,h.jsx)(D.A.FileCard,{item:{uid:`${null===t||void 0===t?void 0:t.id}-${n}`,name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.url),type:null===e||void 0===e?void 0:e.contentType,description:null===e||void 0===e?void 0:e.name,url:null===e||void 0===e?void 0:e.url}},n))),(0,h.jsxs)(a.A,{align:"stretch",direction:"column",style:{borderRadius:d.borderRadius,borderColor:d.colorBorderSecondary,borderWidth:d.lineWidth,padding:"1em",paddingTop:0,paddingBottom:0,backgroundColor:"user"!==t.role?d.colorBgContainer:d.colorBgContainerDisabled,maxWidth:"100%",width:k().trim(t.reasoning)?"100%":"auto"},children:[k().trim(t.reasoning)&&(0,h.jsx)(Se.A,{style:{marginTop:d.margin,width:"100%"},items:[{key:"reasoning",label:k().isEmpty(m)?(0,h.jsxs)(a.A,{gap:"xs",children:[(0,h.jsx)(L.A.Text,{children:r("chatui.Thinking")}),(0,h.jsx)(we.A,{size:"small"})]}):(0,h.jsx)(L.A.Text,{children:r("chatui.ViewReasoning")}),children:(0,h.jsx)(Ce,{isStreaming:o,children:v})}]}),(0,h.jsx)(Ce,{isStreaming:o,children:m+(o?"\n":"")})]}),(0,h.jsx)(a.A,{style:{fontSize:d.fontSizeSM,...l?{opacity:c?1:0,transition:"opacity 0.2s",transitionDelay:c?"0s":"0.2s"}:{}},children:n})]})},Le=(0,g.memo)(Ie);var Te=t(74727);const _e=e=>{let{message:n,isStreaming:t,placement:i}=e;return(0,h.jsx)(Le,{message:n,placement:{...i,left:!0},isStreaming:t,enableExtraHover:!1,extra:(0,h.jsx)(Te.Ay,{children:(0,h.jsx)(ae,{type:"text",size:"small",copyable:{text:n.content},style:{display:t?"none":"block"}})}),avatar:"\ud83e\udd16"},n.id)};var Ee=t(85288),Me=t(59404);const Fe=e=>{let{autoScroll:n,atBottom:t,...i}=e;const l=(0,Ee.E)(i.onScrollToBottom);return(0,g.useEffect)((()=>{t&&n&&(null===l||void 0===l||l("auto"))}),[t,n,l]),(0,h.jsx)(_.Ay,{icon:(0,h.jsx)(Me.A,{}),shape:"circle",onClick:()=>{l&&l("click")}})};var Re=t(28703);const Ke={user:e=>{let{message:n,isStreaming:t,placement:i}=e;return(0,h.jsx)(Le,{message:n,placement:{...i,right:!0},isStreaming:t,enableExtraHover:!0,extra:(0,h.jsx)(Te.Ay,{children:null}),avatar:"\ud83e\uddd1\u200d\ud83e\uddb0"},n.id)},assistant:_e,system:_e,data:_e},$e=e=>{let{messages:n,isStreaming:t}=e;const i=(0,g.useRef)(null),[l,o]=(0,g.useState)(!0),{token:s}=p.A.useToken(),d="undefined"!==typeof window?1.5*window.innerHeight:0,r=(0,g.useCallback)(((e,i)=>{const l=Ke[i.role];return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(l,{message:i,isStreaming:null!==t&&void 0!==t&&t,placement:{top:0===e,bottom:e===n.length-1}},i.id)})}),[t,n.length]);return(0,h.jsxs)(a.A,{direction:"column",align:"stretch",style:{height:"100%",flex:1},children:[(0,h.jsx)(Re.aY,{atBottomStateChange:o,atBottomThreshold:60,computeItemKey:(e,n)=>n.id,data:n,followOutput:"auto",initialTopMostItemIndex:(null===n||void 0===n?void 0:n.length)-1,itemContent:r,overscan:d,ref:i}),(0,h.jsx)("div",{style:{position:"absolute",right:"50%",transform:"translateX(+50%)",bottom:s.marginSM,opacity:l?0:1,transition:"opacity 0.2s",transitionDelay:l?"0s":"0.2s"},children:(0,h.jsx)(Fe,{atBottom:l,autoScroll:t,onScrollToBottom:e=>{const n=i.current;switch(e){case"auto":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"auto",index:"LAST"});break;case"click":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"smooth",index:"LAST"})}}})})]})},Be=(0,g.memo)($e),De=(0,g.memo)(J),qe=e=>{let{messages:n,input:t,isStreaming:i,startTime:l}=e;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(Be,{messages:n,isStreaming:i}),(0,h.jsx)(a.A,{direction:"column",align:"end",children:(0,h.jsx)(De,{messages:n,input:t,startTime:l})})]})};var Ne=t(45554),Ue=t(91564),Ve=t(86187),ze=t(4800);const He=e=>{let{baseURL:n,token:t,allowCustomModel:i,alert:l,modelId:o,formRef:s}=e;const{token:d}=p.A.useToken();return(0,h.jsx)(a.A,{direction:"row",style:{padding:d.paddingSM,paddingRight:d.paddingContentHorizontalLG,paddingLeft:d.paddingContentHorizontalLG,backgroundColor:d.colorBgContainer,display:i&&"custom"===o?"flex":"none"},children:(0,h.jsxs)(Ue.A,{ref:s,layout:"horizontal",size:"small",requiredMark:"optional",style:{flex:1},initialValues:{baseURL:n,token:t},children:[l?(0,h.jsx)("div",{style:{marginBottom:d.size},children:l}):null,(0,h.jsx)(Ue.A.Item,{label:"baseURL",name:"baseURL",rules:[{type:"url"},{required:!0}],children:(0,h.jsx)(Ve.A,{placeholder:"https://domain/v1"})}),(0,h.jsx)(Ue.A.Item,{label:"Model ID",name:"modelId",rules:[{required:!0}],children:(0,h.jsx)(Ve.A,{placeholder:"llm-model"})}),(0,h.jsx)(Ue.A.Item,{label:"Token",name:"token",children:(0,h.jsx)(Ve.A,{})})]},n)})},Oe=e=>{let{onClick:n}=e;const{t:t}=(0,b.Bd)();return(0,h.jsx)(ze.A,{type:"warning",showIcon:!0,message:t("chatui.CannotFindModel"),action:(0,h.jsx)(_.Ay,{icon:(0,h.jsx)(Ne.A,{}),onClick:n,children:t("button.Refresh")})})};var Qe,Pe=t(31658),We=t(23324),Xe=t(63761),Ge=t(14287),Ye=t(29107);const Je=(0,Ye.rU)((e=>{let{token:n,css:t}=e;return{chatCard:t`
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
  `,body:t`
    background-color: ${n.colorFillQuaternary};
    border-radius: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 0;
    height: 50%;
    position: relative;
  `,actions:t`
    padding-left: ${n.paddingContentHorizontal};
    padding-right: ${n.paddingContentHorizontal};
  `,header:t`
    zindex: 1;
  `,alert:t`
    margin: ${n.marginSM};
  `}}));const Ze=g.memo(K,((e,n)=>e.modelId===n.modelId&&(e.endpoint===n.endpoint&&(e.agent===n.agent&&(e.fetchKey===n.fetchKey&&(e.sync===n.sync&&e.closable===n.closable)))))),en=g.memo(W),nn=e=>{var n,i,a,d,r;let{chat:c,selectedEndpoint:u,closable:p,fetchOnClient:m,onRequestClose:v,onCreateNewChat:y}=e;const{styles:{chatCard:x,alert:b,...C}}=Je(),A=(0,g.useRef)(null),S=(0,g.useRef)(null),[w,I]=(0,l.Tw)("first"),[L,T]=(0,g.useState)(null),{endpoint:_,setEndpoint:E}=function(e){const[n,i]=(0,g.useState)(e||null);return{endpoint:(0,j.useFragment)(void 0!==Qe?Qe:Qe=t(50555),n),setEndpoint:i}}(u),{models:M,modelId:F,setModelId:R}=function(e,n,t){const{data:i}=(0,o.nj)({queryKey:["models",n,null===t||void 0===t?void 0:t.endpoint_id],queryFn:()=>{var n;return null!==t&&void 0!==t&&t.url?fetch(new URL(e.basePath+"/models",null!==(n=null===t||void 0===t?void 0:t.url)&&void 0!==n?n:void 0).toString()).then((e=>e.json())).catch((e=>({data:[]}))):Promise.resolve({data:[]})}}),l=k().map(null===i||void 0===i?void 0:i.data,(e=>({id:e.id,name:e.id}))),a=(0,g.useMemo)((()=>{var n,t,l;return e.modelId&&k().includes(k().map(null===i||void 0===i?void 0:i.data,"id"),e.modelId)?e.modelId:null!==(n=null===i||void 0===i||null===(t=i.data)||void 0===t||null===(l=t[0])||void 0===l?void 0:l.id)&&void 0!==n?n:"custom"}),[null===i||void 0===i?void 0:i.data,e.modelId]),[s,d]=(0,g.useState)(a);return(0,g.useEffect)((()=>{d(a)}),[a]),{models:l,modelId:s,setModelId:d}}(c.provider,w,_),{agents:K,agent:$,setAgent:B}=function(e){const{agents:n}=(0,s.B)(),[t,i]=(0,g.useState)(void 0),l=(0,g.useMemo)((()=>n.find((n=>n.id===e.agentId))),[n,e.agentId]);return(0,g.useEffect)((()=>{i(l)}),[l]),{agents:n,agent:t,setAgent:i}}(c.provider),[D,q]=(0,g.useState)(c.sync),N=null!==_&&void 0!==_&&_.url?new URL(c.provider.basePath,null!==(n=null===_||void 0===_?void 0:_.url)&&void 0!==n?n:void 0).toString():void 0,U=(0,f.isEmpty)(M),V={baseURL:U?null===(i=A.current)||void 0===i?void 0:i.getFieldValue("baseURL"):N,modelId:U?null===(a=A.current)||void 0===a?void 0:a.getFieldValue("modelId"):F,apiKey:U?null===(d=A.current)||void 0===d?void 0:d.getFieldValue("token"):c.provider.apiKey},{error:z,messages:H,input:O,setInput:Q,stop:P,status:W,append:X,setMessages:G}=(0,We.Y_)({id:`${c.id}-${null===_||void 0===_?void 0:_.endpoint_id}-${null!==(r=null===$||void 0===$?void 0:$.id)&&void 0!==r?r:"none"}-${F}`,api:N,credentials:c.provider.credentials,body:{modelId:F},experimental_throttle:50,fetch:async(e,n)=>{if(m||"custom"===F){var t;const e=JSON.parse(null===n||void 0===n?void 0:n.body),i=(0,Pe.r)({baseURL:V.baseURL,apiKey:V.apiKey||"dummy"}),l=(0,Xe.gM)({abortSignal:(null===n||void 0===n?void 0:n.signal)||void 0,model:(0,Xe.ae)({model:i(V.modelId),middleware:(0,Xe.Ol)({tagName:"think"})}),messages:null===e||void 0===e?void 0:e.messages,system:$&&null!==(t=$.config.system_prompt)&&void 0!==t?t:""});return T(Date.now()),l.toDataStreamResponse({sendReasoning:!0})}return fetch(e,n)}}),Y="streaming"===W||"submitted"===W;return(0,h.jsxs)(Ge.A,{variant:"outlined",className:x,classNames:C,title:(0,h.jsx)(Ze,{chat:c,allowCustomModel:U,models:M,modelId:F,setModelId:R,endpoint:_,setEndpoint:E,agents:K,agent:$,setAgent:B,sync:D,setSync:q,fetchKey:w,closable:p,onCreateNewChat:y,onRequestClose:v,setMessages:G}),ref:S,children:[U?(0,h.jsx)(He,{modelId:F,baseURL:N,formRef:A,allowCustomModel:U,alert:A&&(0,h.jsx)(Oe,{onClick:()=>I(N)})}):null,k().isEmpty(null===z||void 0===z?void 0:z.message)?null:(0,h.jsx)(ze.A,{message:null===z||void 0===z?void 0:z.message,type:"error",showIcon:!0,className:b,closable:!0}),(0,h.jsx)(qe,{messages:H,input:O,isStreaming:Y,startTime:L}),(0,h.jsx)(en,{sync:D,input:O,setInput:Q,stop:P,append:X,isStreaming:Y,dropContainerRef:S})]})};var tn,ln=t(33341),an=t(89097);const on=(0,Ye.rU)((e=>{let{token:n,css:t}=e;return{chatView:t`
    overflow: auto;
    height: calc(100vh - 240px);
  `,skeleton:t`
    width: 100%;
    display: flex;
    flex-direction: column;
  `,chatCard:t`
    flex: 1;
    overflow: 'hidden';
  `,conversation:t`
    overflow: hidden;
  `}}));function sn(e,n,t){return{id:e,conversationId:n,label:"Chat",sync:!0,provider:t}}const dn=e=>{let{conversation:n,provider:i}=e;const o=function(e){var n,i;const a=(0,l.CX)(),{endpoint:o,endpoint_list:s}=(0,j.useLazyLoadQuery)(void 0!==tn?tn:tn=t(38166),{endpointId:e||"",isEmptyEndpointId:!e,filter:a.supports("endpoint-lifecycle-stage-filter")?'lifecycle_stage == "created"':void 0});return null!==(n=o.ok?o.value:null===s||void 0===s||null===(i=s.items)||void 0===i?void 0:i[0])&&void 0!==n?n:null}(i.endpointId),s=sn((0,g.useId)(),n.id,i),{list:d,remove:r,push:c}=(0,ln.A)([s]),{styles:u}=on();return(0,h.jsx)(a.A,{className:u.conversation,direction:"column",align:"stretch",gap:"xs",children:(0,h.jsx)(a.A,{className:u.chatView,gap:"xs",direction:"row",align:"stretch",children:(0,f.map)(d,((e,t)=>(0,h.jsx)(g.Suspense,{fallback:(0,h.jsx)(Ge.A,{className:u.skeleton,variant:"outlined",children:(0,h.jsx)(an.A,{active:!0})}),children:(0,h.jsx)(nn,{className:u.chatCard,selectedEndpoint:o,chat:e,fetchOnClient:!0,onRequestClose:()=>r(t),onCreateNewChat:()=>{c(sn(d.length.toString(),n.id,i))},closable:d.length>1},t)},t)))})})};var rn=t(8168),cn=t(86289);const un={body:{overflow:"hidden"}},pn=()=>{const[{endpointId:e,modelId:n,agentId:t}]=(0,cn.useQueryParams)({endpointId:cn.StringParam,agentId:cn.StringParam,modelId:cn.StringParam}),l={id:(0,g.useId)(),label:(0,rn.t)("webui.menu.Chat"),chats:[]},a={basePath:"v1",agentId:null!==t&&void 0!==t?t:void 0,endpointId:null!==e&&void 0!==e?e:void 0,modelId:null!==n&&void 0!==n?n:void 0};return(0,h.jsx)(i.A,{title:(0,rn.t)("webui.menu.Chat"),styles:un,children:(0,h.jsx)(dn,{conversation:l,provider:a})})}}}]);
//# sourceMappingURL=6005.ed9231ff.chunk.js.map