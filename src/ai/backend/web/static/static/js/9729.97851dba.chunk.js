/*! For license information please see 9729.97851dba.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[9729],{98401:(e,n,l)=>{l.d(n,{A:()=>d});var i=l(89130),t=l(15934),a=l(89608),r=l.n(a),o=l(43373),s=l(73689);const d=e=>{let n,{values:l=[]}=e;return 0===l.length?null:(n=l[0]&&("string"===typeof l[0]||o.isValidElement(l[0]))?l.map((e=>({label:e,color:"blue"}))):l,(0,s.jsx)(i.A,{direction:"row",children:r().map(n,((e,l)=>(0,s.jsx)(t.A,{style:r().last(n)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:e.label},l)))}))}},69715:(e,n,l)=>{l.d(n,{Ay:()=>y,Kk:()=>g,p3:()=>p,sT:()=>m,vB:()=>c});var i=l(51593),t=l(98401),a=l(89130),r=l(6597),o=l(15934),s=l(43373),d=l(73689);const u=e=>{let{image:n,...l}=e;n=n||"";const[,{getImageAliasName:a,getBaseVersion:r,tagAlias:o}]=(0,i.Gj)();return(0,d.jsx)(t.A,{values:[{label:o(a(n)),color:"blue"},{label:r(n),color:"green"}],...l})},c=e=>{let{image:n,...l}=e;n=n||"";const[,{getBaseVersion:t,tagAlias:a}]=(0,i.Gj)();return(0,d.jsx)(o.A,{color:"green",...l,children:a(t(n))})},m=e=>{let{image:n,...l}=e;n=n||"";const[,{getBaseImage:t,tagAlias:a}]=(0,i.Gj)();return(0,d.jsx)(o.A,{color:"green",...l,children:a(t(n))})},v=e=>{let{image:n,...l}=e;n=n||"";const[,{getArchitecture:t,tagAlias:a}]=(0,i.Gj)();return(0,d.jsx)(o.A,{color:"green",...l,children:a(t(n))})},g=e=>{let{image:n,...l}=e;n=n||"";const[,{getImageLang:t,tagAlias:a}]=(0,i.Gj)();return(0,d.jsx)(o.A,{color:"green",...l,children:a(t(n))})},p=e=>{let{tag:n,labels:l,highlightKeyword:s,...u}=e;l=l||[];const[,{getConstraints:c}]=(0,i.Gj)(),m=c(n,l);return(0,d.jsxs)(a.A,{direction:"row",align:"start",children:[m[0]?(0,d.jsx)(o.A,{color:"blue",...u,children:(0,d.jsx)(r.A,{keyword:s,children:m[0]})}):null,m[1]?(0,d.jsx)(t.A,{color:"cyan",values:[{label:(0,d.jsx)(r.A,{keyword:s,children:"Customized"}),color:"cyan"},{label:(0,d.jsx)(r.A,{keyword:s,children:m[1]}),color:"cyan"}],...u}):null]})},h=(e,n)=>{let{image:l,style:i={}}=e;return l=l||"",(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u,{image:l}),(0,d.jsx)(m,{image:l}),(0,d.jsx)(v,{image:l})]})},y=s.memo(h)},76604:(e,n,l)=>{l.d(n,{Ay:()=>f,s5:()=>x,uJ:()=>p});var i=l(58879),t=l(11899),a=l(15634),r=l(89130),o=l(50868),s=l(85690),d=l(33789),u=l(89608),c=l.n(u),m=l(43373),v=l(56762),g=l(73689);const p={"cuda.device":"GPU","cuda.shares":"FGPU","rocm.device":"GPU","tpu.device":"TPU","ipu.device":"IPU","atom.device":"ATOM","atom-plus.device":"ATOM+","gaudi2.device":"Gaudi 2","warboy.device":"Warboy","hyperaccel-lpu.device":"Hyperaccel LPU"},h=e=>{var n,l;let{type:d,value:u,extra:m,opts:v,hideTooltip:p=!1,max:h}=e;const{token:y}=o.A.useToken(),f=(0,a.Nw)(),[A]=(0,t.Hv)(f||void 0),b=e=>{var n,l,t;return null!==A&&void 0!==A&&null!==(n=A[d])&&void 0!==n&&n.number_format.binary?Number(null===(l=(0,i.Js)(e,"g",3,!0))||void 0===l?void 0:l.numberFixed).toString():((null===A||void 0===A||null===(t=A[d])||void 0===t?void 0:t.number_format.round_length)||0)>0?parseFloat(e).toFixed(2):e};return(0,g.jsxs)(r.A,{direction:"row",gap:"xxs",children:[null!==A&&void 0!==A&&A[d]?(0,g.jsx)(x,{type:d,showTooltip:!p}):d,(0,g.jsxs)(s.A.Text,{children:[b(u),c().isUndefined(h)?null:"Infinity"===h?"~\u221e":`~${b(h)}`]}),(0,g.jsx)(s.A.Text,{type:"secondary",children:(null===A||void 0===A||null===(n=A[d])||void 0===n?void 0:n.display_unit)||""}),"mem"===d&&null!==v&&void 0!==v&&v.shmem&&(null===v||void 0===v?void 0:v.shmem)>0?(0,g.jsxs)(s.A.Text,{type:"secondary",style:{fontSize:y.fontSizeSM},children:["(SHM: ",null===(l=(0,i.Js)(v.shmem+"b","g",2,!0))||void 0===l?void 0:l.numberFixed,"GiB)"]}):null,m]})},y=e=>{let{size:n=16,children:l}=e;return(0,g.jsx)("mwc-icon",{style:{"--mdc-icon-size":`${n+2}px`,width:n,height:n},children:l})},x=e=>{var n,l,i;let{type:t,size:a=16,showIcon:o=!0,showUnit:s=!0,showTooltip:u=!0,...c}=e;const{t:m}=(0,v.Bd)(),p={cpu:[(0,g.jsx)(y,{size:a,children:"developer_board"}),m("session.core")],mem:[(0,g.jsx)(y,{size:a,children:"memory"}),"GiB"],"cuda.device":["/resources/icons/file_type_cuda.svg","GPU"],"cuda.shares":["/resources/icons/file_type_cuda.svg","FGPU"],"rocm.device":["/resources/icons/rocm.svg","GPU"],"tpu.device":[(0,g.jsx)(y,{size:a,children:"view_module"}),"TPU"],"ipu.device":[(0,g.jsx)(y,{size:a,children:"view_module"}),"IPU"],"atom.device":["/resources/icons/rebel.svg","ATOM"],"atom-plus.device":["/resources/icons/rebel.svg","ATOM+"],"gaudi2.device":["/resources/icons/gaudi.svg","Gaudi 2"],"warboy.device":["/resources/icons/furiosa.svg","Warboy"],"hyperaccel-lpu.device":["/resources/icons/npu_generic.svg","Hyperaccel LPU"]},h="string"===typeof(null===(n=p[t])||void 0===n?void 0:n[0])?(0,g.jsx)("img",{...c,style:{height:a,alignSelf:"center",...c.style||{}},src:(null===(l=p[t])||void 0===l?void 0:l[0])||"",alt:t}):(0,g.jsx)(r.A,{style:{width:16,height:16},children:(null===(i=p[t])||void 0===i?void 0:i[0])||t});return u?(0,g.jsx)(d.A,{title:t,children:h}):(0,g.jsx)(r.A,{style:{pointerEvents:"none"},children:h})},f=m.memo(h)},35987:(e,n,l)=>{l.r(n),l.d(n,{default:()=>t});const i=function(){var e={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},n=[{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ImageListQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ImageListQuery",selections:n},params:{cacheID:"a9b21b0f0f396926cf1af9e794ec4c1d",id:null,metadata:{},name:"ImageListQuery",operationKind:"query",text:"query ImageListQuery {\n  images {\n    id\n    name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    labels {\n      key\n      value\n    }\n    humanized_name\n    resource_limits {\n      key\n      min\n      max\n    }\n  }\n}\n"}}}();i.hash="0881e461c1e3dc480359bc4af37042dc";const t=i},36751:(e,n,l)=>{l.r(n),l.d(n,{default:()=>t});const i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"architecture"},n={defaultValue:null,kind:"LocalArgument",name:"props"},l={defaultValue:null,kind:"LocalArgument",name:"target"},i=[{alias:null,args:[{kind:"Variable",name:"architecture",variableName:"architecture"},{kind:"Variable",name:"props",variableName:"props"},{kind:"Variable",name:"target",variableName:"target"}],concreteType:"ModifyImage",kind:"LinkedField",name:"modify_image",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n,l],kind:"Fragment",metadata:null,name:"ManageAppsModalMutation",selections:i,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,e,n],kind:"Operation",name:"ManageAppsModalMutation",selections:i},params:{cacheID:"b7a57119037085ec9f08346991633e0a",id:null,metadata:{},name:"ManageAppsModalMutation",operationKind:"mutation",text:"mutation ManageAppsModalMutation(\n  $target: String!\n  $architecture: String\n  $props: ModifyImageInput!\n) {\n  modify_image(target: $target, architecture: $architecture, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();i.hash="bb280196745e96f5c488d1d785a5b012";const t=i},28499:(e,n,l)=>{l.r(n),l.d(n,{default:()=>t});const i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"architecture"},n={defaultValue:null,kind:"LocalArgument",name:"props"},l={defaultValue:null,kind:"LocalArgument",name:"target"},i=[{alias:null,args:[{kind:"Variable",name:"architecture",variableName:"architecture"},{kind:"Variable",name:"props",variableName:"props"},{kind:"Variable",name:"target",variableName:"target"}],concreteType:"ModifyImage",kind:"LinkedField",name:"modify_image",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n,l],kind:"Fragment",metadata:null,name:"ManageImageResourceLimitModalMutation",selections:i,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,e,n],kind:"Operation",name:"ManageImageResourceLimitModalMutation",selections:i},params:{cacheID:"b4c4a5b17c6aa265df64e4d2d6338684",id:null,metadata:{},name:"ManageImageResourceLimitModalMutation",operationKind:"mutation",text:"mutation ManageImageResourceLimitModalMutation(\n  $target: String!\n  $architecture: String\n  $props: ModifyImageInput!\n) {\n  modify_image(target: $target, architecture: $architecture, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();i.hash="491b6e500587a3630195d9025ef76f29";const t=i},79729:(e,n,l)=>{l.r(n),l.d(n,{default:()=>ae});var i=l(4703),t=l(89130),a=l(55182),r=l(58879),o=l(51593),s=l(3643),d=l(34357),u=l(94126),c=l(29546),m=l(56762),v=l(73689);const g=e=>{let{onRequestClose:n,selectedRows:l,setInstallingImages:i,...a}=e;const{t:r}=(0,m.Bd)(),g=(0,o.CX)(),{upsertNotification:p}=(0,s.js)(),h=(0,d.b)();if(!a.open)return null;const{imagesToInstall:y,hasInstalledImage:x}=(()=>{let e=!1;return{imagesToInstall:l.filter((n=>(n.installed&&(e=!0),!n.installed))),hasInstalledImage:e}})();return(0,v.jsx)(u.A,{...a,destroyOnClose:!0,maskClosable:!1,onCancel:()=>n(),title:r("environment.CheckImageInstallation"),okText:r("environment.Install"),onOk:()=>{n();const e=y.map((async e=>{var n;const l=(null===e||void 0===e?void 0:e.registry)+"/"+(null===e||void 0===e?void 0:e.name)+":"+(null===e||void 0===e?void 0:e.tag);let i=!1;const t={};null===e||void 0===e||null===(n=e.resource_limits)||void 0===n||n.forEach((e=>{const n=null===e||void 0===e?void 0:e.key;t[n]=null===e||void 0===e?void 0:e.min})),"cuda.device"in t&&" cuda.shares"in t?(i=!0,t.gpu=0,t.fgpu=t["cuda.shares"]):"cuda.device"in t?(t.gpu=t["cuda.device"],i=!0):i=!1,t.mem.endsWith("g")?t.mem=t.mem.replace("g",".5g"):t.mem.endsWith("m")&&(t.mem=Number(t.mem.slice(0,-1))+256+"m"),t.domain=g._config.domainName,t.group_name=g.current_group;const a=await g.get_resource_slots();i&&("cuda.device"in a||"cuda.shares"in a||(delete t.gpu,delete t.fgpu,delete t["cuda.shares"],delete t["cuda.device"])),"cuda.device"in a&&"cuda.shares"in a?"fgpu"in t&&"gpu"in t&&(delete t.gpu,delete t["cuda.device"]):"cuda.device"in a?(delete t.fgpu,delete t["cuda.shares"]):"cuda.shares"in a&&(delete t.gpu,delete t["cuda.device"]),t.enqueueOnly=!0,t.type="batch",t.startupCommand='echo "Image is installed"',p({message:`${r("environment.InstallingImage")}${l}${r("environment.TakesTime")}`,open:!0,duration:2});const o=await globalThis.lablupIndicator.start("indeterminate");o.set(10,r("import.Downloading"));try{return await g.image.install(l,null===e||void 0===e?void 0:e.architecture,t),o.end(1e3),null===e||void 0===e?void 0:e.id}catch(s){return globalThis.lablupNotification.text=h.relieve(s.title),globalThis.lablupNotification.detail=s.message,globalThis.lablupNotification.show(!0,s),o.set(100,r("environment.DescProblemOccurred")),o.end(1e3),null}}));Promise.allSettled(e).then((e=>{const n=e.filter((e=>"fulfilled"===e.status&&null!==e.value)).map((e=>e.value));i(n)}))},children:(0,v.jsxs)(t.A,{direction:"column",gap:"md",align:"start",children:[x?r("environment.InstalledImagesAreExcluded"):null,(0,v.jsx)(t.A,{direction:"column",align:"start",children:(0,v.jsx)(c.A,{size:"small",bordered:!0,dataSource:y.map((e=>`${null===e||void 0===e?void 0:e.registry}/${null===e||void 0===e?void 0:e.name}/${null===e||void 0===e?void 0:e.tag}`)),renderItem:e=>(0,v.jsx)(c.A.Item,{children:e})})}),r("environment.DescSignificantInstallTime"),r("dialog.ask.DoYouWantToProceed")]})})};var p,h=l(69715),y=l(64703),x=l(4342),f=l(44733),A=l(50868),b=l(85029),k=l(85690),j=l(23702),I=l(67378),w=l(60822),S=l(89608),C=l.n(S),M=l(43373),_=l(88522);const T=e=>{let{open:n,image:i,onRequestClose:a,...r}=e;const{t:s}=(0,m.Bd)(),d=(0,o.CX)(),c=M.useRef(null),g=f.A.useApp(),{token:h}=A.A.useToken(),[S,T]=(0,_.useMutation)(void 0!==p?p:p=l(36751));if(!i)return null;const $=(()=>{let e=[];if(i.labels){const t=C().findIndex(i.labels,(e=>null!==e&&"ai.backend.service-ports"===(null===e||void 0===e?void 0:e.key)));var n,l;if(-1!==t)e=null===i||void 0===i||null===(n=i.labels[t])||void 0===n||null===(l=n.value)||void 0===l?void 0:l.split(",").map((e=>{const n=e.split(":");return{app:n[0],protocol:n[1],port:Number(n[2])}}))}return e})();return(0,v.jsxs)(u.A,{destroyOnClose:!0,open:n,onOk:()=>{var e;null===(e=c.current)||void 0===e||e.validateFields().then((()=>{var e;const n=null===(e=c.current)||void 0===e?void 0:e.getFieldValue("apps").map((e=>`${e.app}:${e.protocol}:${e.port}`)).join(","),l=C().map(i.labels,(e=>{return e.key.includes("service-ports")?{key:e.key,value:n}:{key:e.key,value:(null===(l=e.value)||void 0===l?void 0:l.toString())||""};var l})),t=()=>S({variables:{target:`${null===i||void 0===i?void 0:i.registry}/${null===i||void 0===i?void 0:i.name}:${null===i||void 0===i?void 0:i.tag}`,architecture:null===i||void 0===i?void 0:i.architecture,props:{labels:l,resource_limits:d.isManagerVersionCompatibleWith("24.03.4.*")?void 0:null}},onCompleted:(e,n)=>{var l,i;if(null!==e&&void 0!==e&&null!==(l=e.modify_image)&&void 0!==l&&l.ok)if(n&&(null===n||void 0===n?void 0:n.length)>0){const e=C().map(n,(e=>e.message));for(const n of e)b.Ay.error(n,2.5)}else b.Ay.success(s("environment.DescImagePortsModified")),a(!0);else b.Ay.error(null===e||void 0===e||null===(i=e.modify_image)||void 0===i?void 0:i.msg)},onError:e=>{b.Ay.error(s("dialog.ErrorOccurred"))}});null!==i&&void 0!==i&&i.installed?g.modal.confirm({title:"Image reinstallation required",content:(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(m.x6,{i18nKey:"environment.ModifyImageResourceLimitReinstallRequired"})}),onOk:t,getContainer:()=>document.body,closable:!0}):t()})).catch((e=>{}))},onCancel:()=>a(!1),confirmLoading:T,title:s("environment.ManageApps"),...r,children:[(0,v.jsxs)(t.A,{direction:"row",style:{width:"100%",marginBottom:h.marginXS},children:[(0,v.jsx)(k.A.Text,{strong:!0,style:{width:"32%"},children:s("environment.AppName")}),(0,v.jsx)(k.A.Text,{strong:!0,style:{width:"32%"},children:s("environment.Protocol")}),(0,v.jsx)(k.A.Text,{strong:!0,style:{width:"32%"},children:s("environment.Port")}),(0,v.jsx)(t.A,{})]}),(0,v.jsx)(j.A,{ref:c,layout:"vertical",autoComplete:"off",initialValues:{apps:$},requiredMark:!1,children:(0,v.jsx)(t.A,{direction:"column",children:(0,v.jsx)(j.A.List,{name:"apps",children:(e,n)=>{let{add:l,remove:a}=n;return(0,v.jsxs)(t.A,{direction:"column",style:{width:"100%"},children:[C().map(e,((e,n)=>(0,v.jsx)(j.A.Item,{children:(0,v.jsxs)(t.A,{direction:"row",gap:"xs",children:[(0,v.jsx)(j.A.Item,{...e,name:[e.name,"app"],noStyle:!0,rules:[{required:!0,message:s("environment.AppNameMustNotBeEmpty")}],children:(0,v.jsx)(I.A,{placeholder:s("environment.AppName")})}),(0,v.jsx)(j.A.Item,{...e,name:[e.name,"protocol"],noStyle:!0,rules:[{pattern:/^(http|tcp|pty|preopen)$/,required:!0,message:s("environment.ProtocolMustBeOneOfSupported")}],children:(0,v.jsx)(I.A,{placeholder:s("environment.Protocol")})}),(0,v.jsx)(j.A.Item,{...e,name:[e.name,"port"],noStyle:!0,rules:[{validator:(e,n)=>{const l=C().isUndefined(n)||""===n?NaN:C().toNumber(n);return C().isNaN(l)||l<0||l>=65535?Promise.reject(s("environment.PortMustBeInRange")):[2e3,2001,2002,2003,2200,7681].includes(Number(l))?Promise.reject(s("environment.PortReservedForInternalUse")):Promise.resolve()}},{validator:(e,l)=>{var i;const t=null===(i=c.current)||void 0===i?void 0:i.getFieldValue("apps");return C().isString(l)&&l.length>0&&t.some(((e,i)=>i!==n&&(null===e||void 0===e?void 0:e.port)===l))?Promise.reject(s("environment.PortMustBeUnique")):Promise.resolve()}}],children:(0,v.jsx)(I.A,{placeholder:s("environment.Port")})}),(0,v.jsx)(w.Ay,{type:"text",danger:!0,onClick:()=>a(e.name),style:0===n?{width:"10%",marginTop:8}:{width:"10%"},icon:(0,v.jsx)(y.A,{})})]},e.key)}))),(0,v.jsx)(w.Ay,{type:"dashed",onClick:()=>l(),block:!0,icon:(0,v.jsx)(x.A,{}),disabled:!i,children:s("button.Add")})]})}})})})]})};var $=l(11899),R=l(7194),F=l(87298);const K=e=>{var n;let{value:l,defaultValue:i,onChange:t,steps:a,showAllMarkLabels:r,...o}=e;const s=a.map((e=>C().isNumber(e)||C().isString(e)?{value:e,label:e.toString()}:e)),[d,u]=(0,R.A)({value:l,defaultValue:null!==i&&void 0!==i?i:null===(n=s[0])||void 0===n?void 0:n.value,onChange:t}),c=e=>0===e||e===s.length-1,m=C().fromPairs(s.map(((e,n)=>[n,c(n)?e.label:" "])));return(0,v.jsx)(F.A,{...o,marks:m,value:C().findIndex(s,{value:d}),min:0,tooltip:{formatter(e){var n;if((0,S.isNumber)(e))return null===(n=s[e])||void 0===n?void 0:n.label},...o.tooltip},max:s.length-1,onChange:e=>{var n,l;u(null===(n=s[e])||void 0===n?void 0:n.value,null===(l=s[e])||void 0===l?void 0:l.label)}})};var L=l(96799);const P=e=>{var n,l,i,a;let{name:r,min:o,max:s}=e;const{token:d}=A.A.useToken(),[u]=(0,$.Hv)(),c=e=>{var n,l,i,t,a,r;return{cpu:{label:null===u||void 0===u||null===(n=u.cpu)||void 0===n?void 0:n.description,steps:C().map(["0","1","2","3","4","5","6","7","8"],(e=>{var n;return{value:e,label:`${e} ${null===u||void 0===u||null===(n=u.cpu)||void 0===n?void 0:n.display_unit}`}}))},mem:{label:null===u||void 0===u||null===(l=u.mem)||void 0===l?void 0:l.description,steps:C().map(["64m","128m","256m","512m","1g","2g","4g","8g","16g","32g","64g","128g","256g","512g"],(e=>({value:e,label:`${e.slice(0,-1)} ${C().toUpper(C().last(e))}iB`})))},"cuda.device":{label:null===u||void 0===u||null===(i=u["cuda.device"])||void 0===i?void 0:i.description,steps:C().map(["0","1","2","3","4","5","6","7","8"],(e=>{var n;return{value:e,label:`${e} ${null===u||void 0===u||null===(n=u["cuda.device"])||void 0===n?void 0:n.display_unit}`}}))},"cuda.shares":{label:null===u||void 0===u||null===(t=u["cuda.shares"])||void 0===t?void 0:t.description,steps:C().map(["0","0.1","0.2","0.5","1.0","2.0","4.0","8.0"],(e=>{var n;return{value:e,label:`${e} ${null===u||void 0===u||null===(n=u["cuda.shares"])||void 0===n?void 0:n.display_unit}`}}))},"rocm.device":{label:null===u||void 0===u||null===(a=u["rocm.device"])||void 0===a?void 0:a.description,steps:["0","1","2","3","4","5","6","7","8"]}}[e]||{label:null===u||void 0===u||null===(r=u[e])||void 0===r?void 0:r.description,steps:C().map(["0","1","2","3","4"],(n=>{var l;return{value:n,label:`${n} ${(null===u||void 0===u||null===(l=u[e])||void 0===l?void 0:l.display_unit)||""}`}}))}},m=j.A.useFormInstance(),g=j.A.useWatch(r,m),p=C().find(c(r).steps,(e=>e.value===g||e===g));return(0,v.jsx)(j.A.Item,{label:null!==(n=null===(l=c(r))||void 0===l?void 0:l.label)&&void 0!==n?n:r.toUpperCase(),style:{flex:1},children:(0,v.jsxs)(t.A,{direction:"row",gap:"lg",children:[(0,v.jsx)(I.A,{size:"large",variant:"borderless",readOnly:!0,value:null!==(i=null===p||void 0===p?void 0:p.label)&&void 0!==i?i:p,style:{flex:1,fontSize:d.fontSizeLG},tabIndex:-1}),(0,v.jsx)(L.A,{type:"vertical",style:{height:40}}),(0,v.jsx)(j.A.Item,{name:r,noStyle:!0,initialValue:o,children:(0,v.jsx)(K,{style:{flex:5},steps:null===(a=c(r))||void 0===a?void 0:a.steps})})]})})};var V;const z=e=>{var n;let{image:i,open:t,onRequestClose:a,...r}=e;const s=(0,o.CX)(),{t:d}=(0,m.Bd)(),c=(0,M.useRef)(null),g=f.A.useApp(),[p,h]=(0,_.useMutation)(void 0!==V?V:V=l(28499));return(0,v.jsx)(u.A,{destroyOnClose:!0,open:t,maskClosable:!1,onOk:async()=>{var e;const n=await(null===(e=c.current)||void 0===e?void 0:e.getFieldsValue()),l=Object.entries(n).map((e=>{var n,l,t,a;let[r,o]=e;return{key:r,min:null!==(n=o.toString())&&void 0!==n?n:"0",max:(null!==(l=null===i||void 0===i||null===(t=i.resource_limits)||void 0===t||null===(a=t.find((e=>(null===e||void 0===e?void 0:e.key)===r)))||void 0===a?void 0:a.max)&&void 0!==l?l:s.isManagerVersionCompatibleWith("24.03.4.*"))?void 0:null}})),t=()=>p({variables:{target:`${null===i||void 0===i?void 0:i.registry}/${null===i||void 0===i?void 0:i.name}:${null===i||void 0===i?void 0:i.tag}`,architecture:null===i||void 0===i?void 0:i.architecture,props:{resource_limits:l}},onCompleted:(e,n)=>{var l,i;if(null!==e&&void 0!==e&&null!==(l=e.modify_image)&&void 0!==l&&l.ok)if(n&&(null===n||void 0===n?void 0:n.length)>0){const e=C().map(n,(e=>e.message));for(const n of e)b.Ay.error(n,2.5)}else b.Ay.success(d("environment.DescImageResourceModified")),a(!0);else b.Ay.error(null===e||void 0===e||null===(i=e.modify_image)||void 0===i?void 0:i.msg)},onError:e=>{b.Ay.error(d("dialog.ErrorOccurred"))}});null!==i&&void 0!==i&&i.installed?g.modal.confirm({title:"Image reinstallation required",content:(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(m.x6,{i18nKey:"environment.ModifyImageResourceLimitReinstallRequired"})}),onOk:t,getContainer:()=>document.body,closable:!0}):t()},onCancel:()=>a(!1),confirmLoading:h,centered:!0,title:d("environment.ModifyImageResourceLimit"),...r,children:(0,v.jsx)(j.A,{ref:c,layout:"vertical",children:null===i||void 0===i||null===(n=i.resource_limits)||void 0===n?void 0:n.map((e=>{const{key:n,min:l,max:i}=e,t=n.replace(/_/g,".");return(0,v.jsx)(P,{name:null!==t&&void 0!==t?t:"",min:null!==l&&void 0!==l?l:"",max:null!==i&&void 0!==i?i:""},t)}))})})};var N=l(76604),O=l(6597),B=l(81850),q=l(40991);const U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z"}}]},name:"appstore",theme:"outlined"};var D=l(64098),G=function(e,n){return M.createElement(D.A,(0,q.A)({},e,{ref:n,icon:U}))};const H=M.forwardRef(G);var E=l(1499),W=l(40567);const Q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"};var X=function(e,n){return M.createElement(D.A,(0,q.A)({},e,{ref:n,icon:Q}))};const J=M.forwardRef(X);var Y,Z=l(15934),ee=l(77731);const ne=e=>{let{style:n}=e;const{t:i}=(0,m.Bd)(),[a,s]=(0,M.useState)([]),[,{getNamespace:d,getBaseVersion:u,getLang:c,getBaseImages:p,getConstraints:y}]=(0,o.Gj)(),{token:x}=A.A.useToken(),[b,j]=(0,M.useState)(null),[S,$]=(0,M.useState)(null),[R,F]=(0,M.useState)(!1),[K,L]=(0,o.Tw)("initial-fetch"),[,P]=(0,M.useTransition)(),[V,q]=(0,M.useState)([]),{message:U}=f.A.useApp(),[D,G]=(0,M.useState)(""),[Q,X]=(0,M.useTransition)(),[ne,le]=(0,M.useTransition)(),{images:ie}=(0,_.useLazyLoadQuery)(void 0!==Y?Y:Y=l(35987),{},{fetchPolicy:"initial-fetch"===K?"store-and-network":"network-only",fetchKey:K}),te=(0,M.useMemo)((()=>C().sortBy(ie,(e=>null===e||void 0===e?void 0:e.humanized_name))),[ie]),ae=[{title:i("environment.Status"),dataIndex:"installed",key:"installed",defaultSortOrder:"descend",sorter:(e,n)=>C().toNumber((null===e||void 0===e?void 0:e.installed)||0)-C().toNumber((null===n||void 0===n?void 0:n.installed)||0),render:(e,n)=>null!==n&&void 0!==n&&n.id&&V.includes(n.id)?(0,v.jsx)(Z.A,{color:"gold",children:(0,v.jsx)(O.A,{keyword:D,children:i("environment.Installing")})}):null!==n&&void 0!==n&&n.installed?(0,v.jsx)(Z.A,{color:"gold",children:(0,v.jsx)(O.A,{keyword:D,children:i("environment.Installed")})}):null},{title:i("environment.Registry"),dataIndex:"registry",key:"registry",sorter:(e,n)=>null!==e&&void 0!==e&&e.registry&&null!==n&&void 0!==n&&n.registry?e.registry.localeCompare(n.registry):0,render:(e,n)=>(0,v.jsx)(O.A,{keyword:D,children:n.registry})},{title:i("environment.Architecture"),dataIndex:"architecture",key:"architecture",sorter:(e,n)=>null!==e&&void 0!==e&&e.architecture&&null!==n&&void 0!==n&&n.architecture?e.architecture.localeCompare(n.architecture):0,render:(e,n)=>(0,v.jsx)(O.A,{keyword:D,children:n.architecture})},{title:i("environment.Namespace"),key:"namespace",dataIndex:"namespace",sorter:(e,n)=>{const l=d((0,r.A_)(e)||""),i=d((0,r.A_)(n)||"");return l&&i?l.localeCompare(i):0},render:(e,n)=>(0,v.jsx)(O.A,{keyword:D,children:d((0,r.A_)(n)||"")})},{title:i("environment.Language"),key:"lang",dataIndex:"lang",sorter:(e,n)=>{const l=null!==e&&void 0!==e&&e.name?c(null===e||void 0===e?void 0:e.name):"",i=null!==n&&void 0!==n&&n.name?c(null===n||void 0===n?void 0:n.name):"";return l&&i?l.localeCompare(i):0},render:(e,n)=>(0,v.jsx)(O.A,{keyword:D,children:n.name?c(n.name):null})},{title:i("environment.Version"),key:"baseversion",dataIndex:"baseversion",sorter:(e,n)=>{const l=u((0,r.A_)(e)||""),i=u((0,r.A_)(n)||"");return l&&i?l.localeCompare(i):0},render:(e,n)=>(0,v.jsx)(O.A,{keyword:D,children:u((0,r.A_)(n)||"")})},{title:i("environment.Base"),key:"baseimage",dataIndex:"baseimage",sorter:(e,n)=>{const l=null!==e&&void 0!==e&&e.tag&&null!==e&&void 0!==e&&e.name&&p(null===e||void 0===e?void 0:e.tag,null===e||void 0===e?void 0:e.name)[0]||"",i=null!==n&&void 0!==n&&n.tag&&null!==n&&void 0!==n&&n.name&&p(null===n||void 0===n?void 0:n.tag,null===n||void 0===n?void 0:n.name)[0]||"";return""===l&&""===i?0:""===l?-1:""===i?1:l.localeCompare(i)},render:(e,n)=>(0,v.jsx)(t.A,{direction:"row",align:"start",children:null!==n&&void 0!==n&&n.tag&&null!==n&&void 0!==n&&n.name?p(n.tag,n.name).map((e=>(0,v.jsx)(Z.A,{color:"green",children:(0,v.jsx)(O.A,{keyword:D,children:e})}))):null})},{title:i("environment.Constraint"),key:"constraint",dataIndex:"constraint",sorter:(e,n)=>{const l=null!==e&&void 0!==e&&e.tag&&null!==n&&void 0!==n&&n.labels&&y(null===e||void 0===e?void 0:e.tag,null===e||void 0===e?void 0:e.labels)[0]||"",i=null!==n&&void 0!==n&&n.tag&&null!==n&&void 0!==n&&n.labels&&y(null===n||void 0===n?void 0:n.tag,null===n||void 0===n?void 0:n.labels)[0]||"";return""===l&&""===i?0:""===l?-1:""===i?1:l.localeCompare(i)},render:(e,n)=>null!==n&&void 0!==n&&n.tag?(0,v.jsx)(h.p3,{tag:null===n||void 0===n?void 0:n.tag,labels:null===n||void 0===n?void 0:n.labels,highlightKeyword:D}):null},{title:i("environment.Digest"),dataIndex:"digest",key:"digest",sorter:(e,n)=>null!==e&&void 0!==e&&e.digest&&null!==n&&void 0!==n&&n.digest?e.digest.localeCompare(n.digest):0,render:(e,n)=>(0,v.jsx)(O.A,{keyword:D,children:n.digest})},{title:i("environment.ResourceLimit"),dataIndex:"resource_limits",key:"resource_limits",render:(e,n)=>{var l;return(0,v.jsx)(t.A,{direction:"row",gap:"xxs",children:null===n||void 0===n||null===(l=n.resource_limits)||void 0===l?void 0:l.map((e=>(0,v.jsx)(N.Ay,{type:(null===e||void 0===e?void 0:e.key)||"",value:(null===e||void 0===e?void 0:e.min)||"0",max:(null===e||void 0===e?void 0:e.max)||"Infinity"})))})}},{title:i("general.Control"),key:"control",dataIndex:"control",fixed:"right",render:(e,n)=>(0,v.jsxs)(t.A,{direction:"row",align:"stretch",justify:"center",gap:"xxs",onClick:e=>{e.stopPropagation()},children:[(0,v.jsx)(w.Ay,{type:"text",icon:(0,v.jsx)(B.A,{style:{color:x.colorInfo}}),onClick:()=>$(n)}),(0,v.jsx)(w.Ay,{type:"text",icon:(0,v.jsx)(H,{style:{color:x.colorInfo}}),onClick:()=>{j(n)}})]})}],re=(0,M.useMemo)((()=>null===te||void 0===te?void 0:te.map((e=>({installed:null!==e&&void 0!==e&&e.installed?i("environment.Installed"):"",namespace:d((0,r.A_)(e)||""),lang:null!==e&&void 0!==e&&e.name?c(e.name):"",baseversion:u((0,r.A_)(e)||""),baseimage:null!==e&&void 0!==e&&e.tag&&null!==e&&void 0!==e&&e.name?p(e.tag,e.name):[],constraints:null!==e&&void 0!==e&&e.tag&&null!==e&&void 0!==e&&e.labels?y(e.tag,e.labels):[],isCustomized:!(null===e||void 0===e||!e.tag)&&-1!==e.tag.indexOf("customized")})))),[te]),oe=(0,M.useMemo)((()=>{if(C().isEmpty(D))return te;const e=new RegExp(`${C().escapeRegExp(D)}`,"i");return C().filter(te,((n,l)=>C().some(n,((n,i)=>{if("id"===i)return!1;if(["digest","architecture","registry"].includes(i))return e.test(C().toString(n));const t=re[l]||{};if("installed"===i)return e.test(t.installed);const a=e.test(t.baseversion),r=C().some(t.baseimage,(n=>e.test(n))),o=C().some(t.constraints,(n=>e.test(n))),s=!!t.isCustomized&&e.test("customized"),d=e.test(t.lang),u=e.test(t.namespace);return a||r||o||d||u||s}))))}),[D,re,te]);return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(t.A,{direction:"column",align:"stretch",style:{flex:1,...n},children:[(0,v.jsxs)(t.A,{justify:"end",style:{padding:x.paddingSM},gap:"xs",children:[a.length>0?(0,v.jsx)(k.A.Text,{children:i("general.NSelected",{count:a.length})}):null,(0,v.jsx)(I.A,{allowClear:!0,prefix:(0,v.jsx)(E.A,{}),placeholder:i("environment.SearchImages"),onChange:e=>{le((()=>G(e.target.value)))},style:{width:200}}),(0,v.jsx)(w.Ay,{icon:(0,v.jsx)(W.A,{}),loading:Q,onClick:()=>{s([]),X((()=>L()))},children:i("button.Refresh")}),(0,v.jsx)(w.Ay,{icon:(0,v.jsx)(J,{}),style:{backgroundColor:x.colorPrimary,color:"white"},onClick:()=>{0!==a.length?a.some((e=>!e.installed))?F(!0):U.error(i("environment.AlreadyInstalledImage")):U.error(i("environment.NoImagesAreSelected"))},children:i("environment.Install")})]}),(0,v.jsx)(ee.A,{rowKey:"id",scroll:{x:"max-content"},pagination:{showTotal:(e,n)=>`${n[0]}-${n[1]} of ${e} items`,pageSizeOptions:["10","20","50"],style:{marginRight:x.marginXS}},dataSource:(0,r.tS)(oe),columns:ae,loading:ne,rowSelection:{type:"checkbox",onChange:(e,n)=>{s(n)},selectedRowKeys:a.map((e=>e.id))},onRow:e=>({onClick:n=>{a.find((n=>n.id===e.id))?s((n=>n.filter((n=>n.id!==e.id)))):s((n=>[...n,e]))}}),showSorterTooltip:!1,sortDirections:["descend","ascend","descend"]})]}),(0,v.jsx)(z,{open:!!S,onRequestClose:e=>{$(null),e&&P((()=>{L()}))},image:S}),(0,v.jsx)(T,{open:!!b,onRequestClose:e=>{j(null),e&&P((()=>{L()}))},image:b}),(0,v.jsx)(g,{open:R,onRequestClose:()=>{F(!1)},setInstallingImages:q,selectedRows:a})]})};var le=l(72269),ie=l(12121);const te=(0,ie.withDefault)(ie.StringParam,"image"),ae=()=>{const{t:e}=(0,m.Bd)(),[n,l]=(0,ie.useQueryParam)("tab",te),r=(0,o.CX)(),s=r.supports("container-registry-gql"),{token:d}=A.A.useToken();return(0,v.jsxs)(le.A,{activeTabKey:n,onTabChange:l,tabList:[{key:"image",label:e("environment.Images")},{key:"preset",label:e("environment.ResourcePresets")},...r.is_superadmin?[{key:"registry",label:e("environment.Registries")}]:[]],styles:{body:{padding:0,paddingTop:1,overflow:"hidden"}},children:["image"===n?(0,v.jsx)(M.Suspense,{fallback:(0,v.jsx)(a.A,{style:{height:"calc(100vh - 145px)"},spinSize:"large"}),children:(0,v.jsx)(ne,{})}):null,(0,v.jsx)(t.A,{style:{display:"preset"===n?"block":"none",paddingTop:d.paddingContentVerticalSM},children:(0,v.jsx)("backend-ai-resource-preset-list",{active:"preset"===n})}),(0,v.jsx)(t.A,{style:{display:"registry"===n?"block":"none",height:"calc(100vh - 145px)"},children:s?"registry"===n?(0,v.jsx)(M.Suspense,{children:(0,v.jsx)(i.default,{})}):null:(0,v.jsx)("backend-ai-registry-list",{active:"registry"===n})})]})}}}]);
//# sourceMappingURL=9729.97851dba.chunk.js.map