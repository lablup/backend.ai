"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[539,4222],{10539(e,l,n){n.r(l),n.d(l,{default:()=>w,useFileUploadManager:()=>K});var a=n(56276),r=n(34917),o=n(99634),i=n(15725),t=n(49749),s=n(85212),d=n(83765),u=n(65995),c=n(2947),m=n(21222),g=n(47984),p=n.n(g),y=n(94111),f=n(90953),v=n(48130),F=n(5519),h=n(42806),k=n(38772),S=n(83037);const x=(0,u.eU)([]),_=(0,u.eU)({}),b=(0,m.I)((e=>(0,u.eU)((l=>l(_)[e]),((l,n,r)=>{const o=l(_);n(_,(0,a.A)((0,a.A)({},o),{},{[e]:r}))})))),w=()=>{const{t:e}=(0,v.Bd)(),{token:l}=t.A.useToken(),n=(0,F.CX)(),{upsertNotification:r,closeNotification:u}=(0,o.js)(),{generateFolderPath:m}=(0,i.useFolderExplorerOpener)(),[g,k]=(0,c.fp)(x),[b,w]=(0,c.fp)(_),[K]=(0,h.q)("max_concurrent_uploads"),j=new y.A({concurrency:K||2}),A=(0,f.useRef)({}),N=p().throttle(((n,o)=>{const i=A.current[n]||0;A.current[n]=0,w((t=>{var u,c,m,g,p,y,f,v,F,h;const k=(null===(u=t[n])||void 0===u||null===(c=u.completedFiles)||void 0===c?void 0:c.length)||0,x=((null===(m=t[n])||void 0===m||null===(g=m.completedFiles)||void 0===g?void 0:g.length)||0)+((null===(p=t[n])||void 0===p||null===(y=p.failedFiles)||void 0===y?void 0:y.length)||0)+((null===(f=t[n])||void 0===f||null===(v=f.pendingFiles)||void 0===v?void 0:v.length)||0),_=(null===(F=t[n])||void 0===F?void 0:F.totalExpectedSize)||0,b=((null===(h=t[n])||void 0===h?void 0:h.completedBytes)||0)+i;return r({key:"upload:"+n,backgroundTask:{status:"pending",percent:_>0?b/_*100:0,onChange:{pending:{description:(0,S.jsxs)(d.OOm,{direction:"column",align:"start",children:[(0,S.jsxs)(s.A.Text,{children:[e("explorer.UploadingFiles")," ( ",k," /"," ",x," )"]}),(0,S.jsx)(s.A.Text,{ellipsis:!0,type:"secondary",style:{fontSize:l.fontSizeSM,maxWidth:"300px"},children:o})]})}}}}),(0,a.A)((0,a.A)({},t),{},{[n]:(0,a.A)((0,a.A)({},t[n]),{},{completedBytes:b})})}))}),200,{leading:!0,trailing:!0});return(0,f.useEffect)((()=>{0!==g.length&&n&&(g.forEach((l=>{const{vFolderId:n,vFolderName:o,uploadFileInfo:i}=l,t=p().sumBy(i,(e=>e.file.size));w((l=>{var s,c,g,p,y,f;const v=!l[n],F=((null===(s=l[n])||void 0===s?void 0:s.totalExpectedSize)||0)+t,h=v?0:((null===(c=l[n])||void 0===c?void 0:c.completedBytes)||0)/F*100;return r({key:"upload:"+n,open:!0,message:(0,S.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,S.jsx)(d.rmy,{style:{fontWeight:"normal"},to:m(n),onClick:()=>{u("upload:"+n)},children:"".concat(o)})]}),backgroundTask:{status:"pending",percent:h,onChange:{pending:e("explorer.ProcessingUpload")}},duration:0}),(0,a.A)((0,a.A)({},l),{},{[n]:{vFolderName:o,pendingFiles:[...(null===(g=l[n])||void 0===g?void 0:g.pendingFiles)||[],...i.map((e=>e.file.webkitRelativePath||e.file.name))],completedFiles:(null===(p=l[n])||void 0===p?void 0:p.completedFiles)||[],failedFiles:(null===(y=l[n])||void 0===y?void 0:y.failedFiles)||[],completedBytes:(null===(f=l[n])||void 0===f?void 0:f.completedBytes)||0,totalExpectedSize:F}})})),i.forEach((e=>{let{file:l,startFunction:r}=e;j.add((async()=>{const e=l.webkitRelativePath||l.name;let o=0;try{await r({onProgress:(e,l,a)=>{const r=e-o;o=e,A.current[n]=(A.current[n]||0)+r,N(n,a)}}),N.flush(),delete A.current[n],w((l=>{var r;return(0,a.A)((0,a.A)({},l),{},{[n]:(0,a.A)((0,a.A)({},l[n]),{},{pendingFiles:l[n].pendingFiles.filter((l=>l!==e)),completedFiles:[...(null===(r=l[n])||void 0===r?void 0:r.completedFiles)||[],e]})})}))}catch(i){N.flush(),delete A.current[n],w((l=>{var r;return(0,a.A)((0,a.A)({},l),{},{[n]:(0,a.A)((0,a.A)({},l[n]),{},{pendingFiles:l[n].pendingFiles.filter((l=>l!==e)),failedFiles:[...(null===(r=l[n])||void 0===r?void 0:r.failedFiles)||[],e]})})}))}}))}))})),k([]))}),[g]),(0,f.useEffect)((()=>{Object.entries(b).forEach((l=>{let[n,o]=l;p().isEmpty(null===o||void 0===o?void 0:o.pendingFiles)&&(p().isEmpty(null===o||void 0===o?void 0:o.failedFiles)?p().isEmpty(null===o||void 0===o?void 0:o.completedFiles)||(r({key:"upload:"+n,open:!0,message:(0,S.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,S.jsx)(d.rmy,{style:{fontWeight:"normal"},to:m(n),onClick:()=>{u("upload:"+n)},children:"".concat(null===o||void 0===o?void 0:o.vFolderName)})]}),backgroundTask:{status:"resolved",percent:100,onChange:{resolved:e("explorer.SuccessfullyUploadedToFolder")}},duration:3}),w((e=>(0,a.A)((0,a.A)({},e),{},{[n]:(0,a.A)((0,a.A)({},e[n]),{},{completedFiles:[],completedBytes:0,totalExpectedSize:0})})))):r({key:"upload:"+n,open:!0,message:e("explorer.UploadFailed",{folderName:null===o||void 0===o?void 0:o.vFolderName}),backgroundTask:{status:"rejected",percent:0,onChange:{rejected:e("explorer.FileUploadFailed",{folderName:null===o||void 0===o?void 0:o.vFolderName})}},extraDescription:p().join(null===o||void 0===o?void 0:o.failedFiles,", ")}))}))}),[b]),null},K=(e,l)=>{const n=(0,r.c)(16),a=(0,d.kqi)(),{t:i}=(0,v.Bd)(),{upsertNotification:t}=(0,o.js)(),s=(0,c.Xr)(x);let u;n[0]!==e?(u=e?(0,d.omW)(e).replace(/-/g,""):"",n[0]=e,n[1]=u):u=n[1];const[m,g]=(y=u,(0,c.fp)(b(y)));var y;let f;n[2]!==a||n[3]!==l||n[4]!==i||n[5]!==t?(f=(e,n)=>{const r=a._config.maxFileUploadSize,o=p().map(e,A).reduce(N,0);return!(r>0&&o>r)||(t({open:!0,key:"upload:"+n,message:i("explorer.UploadFailed",{folderName:null!==l&&void 0!==l?l:""}),description:i("data.explorer.FileUploadSizeLimit"),duration:3,toText:i("data.folders.OpenAFolder"),to:{search:new URLSearchParams({folder:n}).toString()}}),!1)},n[2]=a,n[3]=l,n[4]=i,n[5]=t,n[6]=f):f=n[6];const F=f;let h;n[7]!==a||n[8]!==l||n[9]!==s||n[10]!==F?(h=async(e,n,r)=>{if(!F(e,n))return;const o=[],i=p().map(e,(e=>(o.push(e),async l=>{const o=e.webkitRelativePath||e.name;try{const i=[r,o].filter(Boolean).join("/"),t=await a.vfolder.create_upload_session(i,e,n);return await new Promise(((n,a)=>{try{new k._O(e,{endpoint:t,uploadUrl:t,retryDelays:[0,3e3,5e3,1e4,2e4],chunkSize:j(e.size),storeFingerprintForResuming:!1,metadata:{filename:e.name,filetype:e.type},onProgress:(e,n)=>{var a;null===l||void 0===l||null===(a=l.onProgress)||void 0===a||a.call(l,e,n,o)},onSuccess:()=>{n({name:o,bytes:e.size})},onError:e=>{a(new Error("Upload failed for ".concat(o)))}}).start()}catch(r){a(new Error("Failed to initialize upload for ".concat(o)))}}))}catch(i){throw new Error("Failed to prepare upload for ".concat(o))}}))),t={vFolderId:n,vFolderName:null!==l&&void 0!==l?l:"",uploadFileInfo:p().zipWith(o,i,P)};s((e=>[...e,t]))},n[7]=a,n[8]=l,n[9]=s,n[10]=F,n[11]=h):h=n[11];const S=h;let _;return n[12]!==g||n[13]!==S||n[14]!==m?(_={uploadStatus:m,setUploadStatus:g,uploadFiles:S},n[12]=g,n[13]=S,n[14]=m,n[15]=_):_=n[15],_},j=e=>{const l=1048576;return e>=5120*l?200*l:e>=1024*l?100*l:e>=100*l?50*l:15*l};function A(e){return e.size}function N(e,l){return Math.max(e,l)}function P(e,l){return{file:e,startFunction:l}}},64222(e,l,n){n.r(l),n.d(l,{default:()=>qe});var a=n(56276),r=n(11863),o=n(7871);const i=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"vfolderGlobalId"}],l=[{kind:"Variable",name:"id",variableName:"vfolderGlobalId"}],n={alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"FolderExplorerModalQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a,r,o,i,t,s,{args:null,kind:"FragmentSpread",name:"FolderExplorerHeaderFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeDescriptionFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"FolderExplorerModalQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a,r,o,i,t,s,{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},o],storageKey:null}]},params:{cacheID:"37f1c759f1e7dddf7b1c090eca2e8860",id:null,metadata:{},name:"FolderExplorerModalQuery",operationKind:"query",text:'query FolderExplorerModalQuery(\n  $vfolderGlobalId: String!\n) {\n  vfolder_node(id: $vfolderGlobalId) {\n    group\n    group_name\n    unmanaged_path @since(version: "25.04.0")\n    permissions\n    host\n    id\n    name\n    ...FolderExplorerHeaderFragment\n    ...VFolderNodeDescriptionFragment\n    ...VFolderNameTitleNodeFragment\n  }\n}\n\nfragment EditableVFolderNameFragment on VirtualFolderNode {\n  id\n  name\n  user\n  group\n  status\n}\n\nfragment FileBrowserButtonFragment on VirtualFolderNode {\n  id\n  host\n}\n\nfragment FolderExplorerHeaderFragment on VirtualFolderNode {\n  id\n  user\n  permission\n  row_id\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderNameTitleNodeFragment\n  ...VFolderNodeIdenticonFragment\n  ...EditableVFolderNameFragment\n  ...FileBrowserButtonFragment\n  ...SFTPServerButtonFragment\n}\n\nfragment SFTPServerButtonFragment on VirtualFolderNode {\n  id\n  row_id\n  host\n}\n\nfragment VFolderNameTitleNodeFragment on VirtualFolderNode {\n  name\n}\n\nfragment VFolderNodeDescriptionFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderPermissionCellFragment\n  ...useVirtualFolderNodePathFragment\n}\n\nfragment VFolderNodeIdenticonFragment on VirtualFolderNode {\n  id\n}\n\nfragment VFolderPermissionCellFragment on VirtualFolderNode {\n  permissions\n}\n\nfragment useVirtualFolderNodePathFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n}\n'}}}();i.hash="bc8ed85ec64ce6416231f71a40388f03";const t=i;var s=n(10539);const d={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FolderExplorerHeaderFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},action:"THROW"},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeIdenticonFragment"},{args:null,kind:"FragmentSpread",name:"EditableVFolderNameFragment"},{args:null,kind:"FragmentSpread",name:"FileBrowserButtonFragment"},{args:null,kind:"FragmentSpread",name:"SFTPServerButtonFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"8c6e3cf5a92c8f51f54f315622c8bb75"},u=d;var c=n(34917),m=n(56196),g=n(53096);const p={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FileBrowserButtonFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"b96df1a5289fd1330848207e43880ddd"},y=p;var f=n(5519),v=n(53281),F=n(15336),h=n(25702),k=n(25036),S=n(27999),x=n(25558),_=n(83765),b=n(47984),w=n.n(b),K=n(90953),j=n(48130),A=n(35721),N=n(19440);const P=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],l={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},n=[l,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:n,storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:n,storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useDefaultImagesWithFallbackQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useDefaultImagesWithFallbackQuery",selections:a},params:{cacheID:"50986f0b2ceaf84de4cd397a2d793329",id:null,metadata:{},name:"useDefaultImagesWithFallbackQuery",operationKind:"query",text:'query useDefaultImagesWithFallbackQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    tag\n    registry\n    architecture\n    name @deprecatedSince(version: "24.12.0")\n    namespace @since(version: "24.12.0")\n    labels {\n      key\n      value\n    }\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    resource_limits {\n      key\n      min\n      max\n    }\n  }\n}\n'}}}();P.hash="10405daea8947c9eb138ed58ff364fe0";const V=P;var T=n(65995),I=n(2947),z=n(25913),E=n(12059);const B=V,O=(0,z.t_)((async()=>{var e,l;const n=await f.VV;return w().isEmpty(null===(e=n._config)||void 0===e?void 0:e.defaultFileBrowserImage)||null===(l=n._config)||void 0===l?void 0:l.defaultFileBrowserImage})),D=(0,z.t_)((async()=>{var e,l;const n=await f.VV;return w().isEmpty(null===(e=n._config)||void 0===e?void 0:e.systemSSHImage)||null===(l=n._config)||void 0===l?void 0:l.systemSSHImage})),C=(0,T.eU)();function R(e){var l;return"ai.backend.service-ports"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l.toLowerCase().includes("filebrowser"))}function H(e){var l;return null===e||void 0===e||null===(l=e.labels)||void 0===l?void 0:l.find(R)}function Q(e){var l;return null===e||void 0===e||null===(l=e.images)||void 0===l?void 0:l.filter(H)}function M(e){var l;return"ai.backend.role"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l.toLowerCase().includes("system"))}function L(e){var l;return null===e||void 0===e||null===(l=e.labels)||void 0===l?void 0:l.find(M)}function q(e){var l;return null===e||void 0===e||null===(l=e.images)||void 0===l?void 0:l.filter(L)}const U=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domainName"},{defaultValue:null,kind:"LocalArgument",name:"projectId"},{defaultValue:null,kind:"LocalArgument",name:"resourcePolicyName"}],l=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domainName"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domainName"},{kind:"Variable",name:"id",variableName:"projectId"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"resourcePolicyName"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:l,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:n,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:n},params:{cacheID:"f7d16150a7d77cb465733a2933a08261",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery(\n  $domainName: String\n  $projectId: UUID!\n  $resourcePolicyName: String\n) {\n  domain(name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  group(id: $projectId, domain_name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $resourcePolicyName) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();U.hash="616594ca9d6c787458c32688c1a25b1f";const W=U,$=function(){var e={defaultValue:null,kind:"LocalArgument",name:"accessKey"},l={defaultValue:null,kind:"LocalArgument",name:"domainName"},n=[{kind:"Variable",name:"access_key",variableName:"accessKey"},{kind:"Variable",name:"domain_name",variableName:"domainName"}],a={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null};return{fragment:{argumentDefinitions:[e,l],kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{kind:"RequiredField",field:{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{kind:"RequiredField",field:a,action:"THROW"}],storageKey:null},action:"THROW"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,e],kind:"Operation",name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"05bd7db7ab185940108fba3f2cadc989",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_KeypairQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_KeypairQuery(\n  $domainName: String\n  $accessKey: String\n) {\n  keypair(domain_name: $domainName, access_key: $accessKey) {\n    resource_policy\n    id\n  }\n}\n"}}}();$.hash="bca5af88ccf1508389ec648bf31c4965";const G=$;var X=n(79880);const Z=(e,l,n)=>{var a,r,o;const i=(0,f.CX)(),{keypair:t}=(0,A.useLazyLoadQuery)(G,{domainName:e,accessKey:n},{fetchPolicy:"store-or-network"}),s=(0,A.useLazyLoadQuery)(W,{domainName:e,projectId:l,resourcePolicyName:null===t||void 0===t?void 0:t.resource_policy},{fetchPolicy:"store-or-network"}),d=JSON.parse((null===s||void 0===s||null===(a=s.domain)||void 0===a?void 0:a.allowed_vfolder_hosts)||"{}"),u=JSON.parse((null===s||void 0===s||null===(r=s.group)||void 0===r?void 0:r.allowed_vfolder_hosts)||"{}"),c=JSON.parse((null===s||void 0===s||null===(o=s.keypair_resource_policy)||void 0===o?void 0:o.allowed_vfolder_hosts)||"{}"),{data:m}=(0,X.U)({queryKey:["vhostInfo"],queryFn:async()=>await i.vfolder.list_hosts(),staleTime:3e5,gcTime:0}),g=Object.assign({},...m.allowed.map((e=>{return{[e]:(l=[d[e],u[e],c[e]],[...new Set([].concat(...l.filter(Boolean)))])};var l})));return{StorageHostPermissionByDomain:d,StorageHostPermissionByGroup:u,StorageHostPermissionByResourcePolicy:c,unitedAllowedPermissionByVolume:g}};var J=n(78970),Y=n(83037);const ee=["showTitle","vfolderFrgmt"],le=e=>{var l;const n=(0,c.c)(61);let o,i,t;if(n[0]!==e){var s=e;({showTitle:i,vfolderFrgmt:t}=s),o=(0,r.A)(s,ee),n[0]=e,n[1]=o,n[2]=i,n[3]=t}else o=n[1],i=n[2],t=n[3];const d=void 0===i||i,{t:u}=(0,j.Bd)(),{message:m,modal:g}=F.A.useApp(),{logger:p}=(0,_.Q7t)(),b=(0,f.f0)(),P=(0,f.CX)(),V=(0,f.eZ)(),T=(0,N.hd)(),z=null===P||void 0===P||null===(l=P._config)||void 0===l?void 0:l.accessKey,{unitedAllowedPermissionByVolume:D}=Z(V,T.id,z),{getErrorMessage:C}=(0,_.B78)(),{startSessionWithDefault:R,upsertSessionNotification:H}=(0,J.G)(),M=(()=>{const e=(0,c.c)(7),[l,n]=(0,I.fp)(O),a=(0,A.useRelayEnvironment)();let r;e[0]!==l||e[1]!==a||e[2]!==n?(r=()=>{void 0===l&&(0,A.fetchQuery)(a,B,{installed:!0},{fetchPolicy:"store-or-network"}).toPromise().then(Q).then((async e=>{const l=w().first(e);n(l?(0,E.A_)(l):null)})).catch((()=>{n(null)}))},e[0]=l,e[1]=a,e[2]=n,e[3]=r):r=e[3];const o=(0,K.useEffectEvent)(r);let i,t;return e[4]!==o?(i=()=>{o()},e[4]=o,e[5]=i):i=e[5],e[6]===Symbol.for("react.memo_cache_sentinel")?(t=[],e[6]=t):t=e[6],(0,K.useEffect)(i,t),l})();let L;n[4]===Symbol.for("react.memo_cache_sentinel")?(L=y,n[4]=L):L=n[4];const q=(0,A.useFragment)(L,t);let U;var W;n[5]!==D||n[6]!==q.host?(U=w().includes(D[null!==(W=null===q||void 0===q?void 0:q.host)&&void 0!==W?W:""],"mount-in-session"),n[5]=D,n[6]=q.host,n[7]=U):U=n[7];const $=U;let G;n[8]!==M||n[9]!==$||n[10]!==d||n[11]!==u?(G=()=>$?null===M?u("data.explorer.NoImagesSupportingFileBrowser"):!d&&M?u("data.explorer.ExecuteFileBrowser"):"":u("data.explorer.NoPermissionToMountFolder"),n[8]=M,n[9]=$,n[10]=d,n[11]=u,n[12]=G):G=n[12];const X=G;let le;n[13]!==M||n[14]!==q.id?(le=()=>({sessionName:"filebrowser-".concat((0,_.omW)(q.id||"")),sessionType:"interactive",environments:{version:M||""},allocationPreset:"minimum-required",cluster_mode:"single-node",cluster_size:1,mount_ids:[(0,_.omW)(q.id||"").replaceAll("-","")],reuseIfExists:!0}),n[13]=M,n[14]=q.id,n[15]=le):le=n[15];const ne=le;let ae,re,oe;n[16]!==X?(ae=X(),n[16]=X,n[17]=ae):ae=n[17],n[18]!==M?(re=M?void 0:{filter:"grayscale(100%)"},n[18]=M,n[19]=re):re=n[19],n[20]!==re?(oe=(0,Y.jsx)(h.A,{width:"18px",src:"/resources/icons/filebrowser.svg",alt:"File Browser",preview:!1,style:re}),n[20]=re,n[21]=oe):oe=n[21];const ie=!M||!$;let te,se,de;n[22]!==ne||n[23]!==M||n[24]!==C||n[25]!==p||n[26]!==m||n[27]!==g||n[28]!==R||n[29]!==u||n[30]!==H||n[31]!==q.id?(te=async()=>{if(!M)return;const e=ne();await R(e).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&H(e.fulfilled,[{key:"filebrowser-".concat((0,_.omW)(q.id||"")),extraData:{appName:"filebrowser"}}]),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const l=e.rejected[0].reason;g.error({title:null===l||void 0===l?void 0:l.title,content:C(l)})}})).catch((e=>{p.error("Unexpected error during session creation:",e),m.error(u("error.UnexpectedError"))}))},n[22]=ne,n[23]=M,n[24]=C,n[25]=p,n[26]=m,n[27]=g,n[28]=R,n[29]=u,n[30]=H,n[31]=q.id,n[32]=te):te=n[32],n[33]!==d||n[34]!==u?(se=d&&u("data.explorer.ExecuteFileBrowser"),n[33]=d,n[34]=u,n[35]=se):se=n[35],n[36]!==o||n[37]!==te||n[38]!==se||n[39]!==oe||n[40]!==ie?(de=(0,Y.jsx)(_.Fvl,(0,a.A)((0,a.A)({icon:oe,disabled:ie,action:te},o),{},{children:se})),n[36]=o,n[37]=te,n[38]=se,n[39]=oe,n[40]=ie,n[41]=de):de=n[41];const ue=!M||!$;let ce,me,ge,pe,ye,fe,ve,Fe;return n[42]===Symbol.for("react.memo_cache_sentinel")?(ce=["click"],n[42]=ce):ce=n[42],n[43]!==u?(me=u("import.StartWithOptions"),n[43]=u,n[44]=me):me=n[44],n[45]!==ne||n[46]!==b?(ge=()=>{const e=ne(),l=new URLSearchParams;l.set("formValues",JSON.stringify(e)),l.set("step","4"),b({pathname:"/session/start",search:l.toString()})},n[45]=ne,n[46]=b,n[47]=ge):ge=n[47],n[48]!==me||n[49]!==ge?(pe={items:[{key:"custom",label:me,onClick:ge}]},n[48]=me,n[49]=ge,n[50]=pe):pe=n[50],n[51]===Symbol.for("react.memo_cache_sentinel")?(ye=(0,Y.jsx)(_.Fvl,{icon:(0,Y.jsx)(v.A,{})}),n[51]=ye):ye=n[51],n[52]!==ue||n[53]!==pe?(fe=(0,Y.jsx)(k.A,{disabled:ue,trigger:ce,menu:pe,children:ye}),n[52]=ue,n[53]=pe,n[54]=fe):fe=n[54],n[55]!==de||n[56]!==fe?(ve=(0,Y.jsxs)(S.A.Compact,{children:[de,fe]}),n[55]=de,n[56]=fe,n[57]=ve):ve=n[57],n[58]!==ve||n[59]!==ae?(Fe=(0,Y.jsx)(x.A,{title:ae,children:ve}),n[58]=ve,n[59]=ae,n[60]=Fe):Fe=n[60],Fe},ne={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SFTPServerButtonFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"8bf5b2e08fd923cb5fc74aaa801b7e1f"},ae=ne,re=["showTitle","vfolderFrgmt"],oe=e=>{var l,n;const o=(0,c.c)(67);let i,t,s;if(o[0]!==e){var d=e;({showTitle:t,vfolderFrgmt:s}=d),i=(0,r.A)(d,re),o[0]=e,o[1]=i,o[2]=t,o[3]=s}else i=o[1],t=o[2],s=o[3];const u=void 0===t||t,{logger:m}=(0,_.Q7t)(),{t:g}=(0,j.Bd)(),{message:p,modal:y}=F.A.useApp(),b=(0,f.f0)(),P=(0,f.CX)(),V=(0,f.eZ)(),T=(0,N.hd)(),z=null===P||void 0===P||null===(l=P._config)||void 0===l?void 0:l.accessKey,{unitedAllowedPermissionByVolume:O}=Z(V,T.id,z),{vhostInfo:R}=(0,N.Bk)(),{getErrorMessage:H}=(0,_.B78)(),{startSessionWithDefault:Q,upsertSessionNotification:M}=(0,J.G)(),{systemSSHImage:L}=(()=>{const e=(0,c.c)(11),[l,n]=(0,I.fp)(D),[a,r]=(0,I.fp)(C),o=(0,A.useRelayEnvironment)();let i;e[0]!==o||e[1]!==n||e[2]!==r||e[3]!==l?(i=()=>{void 0===l&&(0,A.fetchQuery)(o,B,{installed:!0},{fetchPolicy:"store-or-network"}).toPromise().then(q).then((async e=>{const l=w().first(e);n(l?(0,E.A_)(l):null),r(l||void 0)})).catch((()=>{n(null)}))},e[0]=o,e[1]=n,e[2]=r,e[3]=l,e[4]=i):i=e[4];const t=(0,K.useEffectEvent)(i);let s,d,u;return e[5]!==t?(s=()=>{t()},e[5]=t,e[6]=s):s=e[6],e[7]===Symbol.for("react.memo_cache_sentinel")?(d=[],e[7]=d):d=e[7],(0,K.useEffect)(s,d),e[8]!==l||e[9]!==a?(u={systemSSHImage:l,systemSSHImageInfo:a},e[8]=l,e[9]=a,e[10]=u):u=e[10],u})();let U;o[4]===Symbol.for("react.memo_cache_sentinel")?(U=ae,o[4]=U):U=o[4];const W=(0,A.useFragment)(U,s),$=null===R||void 0===R||null===(n=R.volume_info[(null===W||void 0===W?void 0:W.host)||""])||void 0===n?void 0:n.sftp_scaling_groups;let G;var X;o[5]!==O||o[6]!==(null===W||void 0===W?void 0:W.host)?(G=w().includes(O[null!==(X=null===W||void 0===W?void 0:W.host)&&void 0!==X?X:""],"mount-in-session"),o[5]=O,o[6]=null===W||void 0===W?void 0:W.host,o[7]=G):G=o[7];const ee=G;let le;o[8]!==ee||o[9]!==$||o[10]!==u||o[11]!==L||o[12]!==g?(le=()=>ee?w().isEmpty($)?g("data.explorer.NoSFTPSupportingScalingGroup"):L?!u&&L?g("data.explorer.RunSSH/SFTPserver"):"":g("data.explorer.NoImagesSupportingSystemSession"):g("data.explorer.NoPermissionToMountFolder"),o[8]=ee,o[9]=$,o[10]=u,o[11]=L,o[12]=g,o[13]=le):le=o[13];const ne=le;let oe;o[14]!==P._config||o[15]!==(null===$||void 0===$?void 0:$[0])||o[16]!==L||o[17]!==(null===W||void 0===W?void 0:W.id)?(oe=()=>{var e,l;return(0,a.A)((0,a.A)({sessionName:"sftp-".concat((0,_.omW)((null===W||void 0===W?void 0:W.id)||"")),sessionType:"system"},null!==(e=P._config)&&void 0!==e&&e.systemSSHImage&&null!==(l=P._config)&&void 0!==l&&l.allow_manual_image_name_for_session?{environments:{manual:P._config.systemSSHImage}}:{environments:{version:L||""}}),{},{cluster_mode:"single-node",cluster_size:1,mount_ids:[(0,_.omW)((null===W||void 0===W?void 0:W.id)||"").replaceAll("-","")],resourceGroup:null===$||void 0===$?void 0:$[0],reuseIfExists:!0})},o[14]=P._config,o[15]=null===$||void 0===$?void 0:$[0],o[16]=L,o[17]=null===W||void 0===W?void 0:W.id,o[18]=oe):oe=o[18];const ie=oe;let te,se,de,ue,ce,me,ge,pe,ye,fe,ve,Fe,he,ke,Se;return o[19]!==ne?(te=ne(),o[19]=ne,o[20]=te):te=o[20],o[21]!==ee||o[22]!==$||o[23]!==L?(se=w().isEmpty($)||!L||!ee,o[21]=ee,o[22]=$,o[23]=L,o[24]=se):se=o[24],o[25]===Symbol.for("react.memo_cache_sentinel")?(de=(0,Y.jsx)(h.A,{width:"18px",src:"/resources/icons/sftp.png",alt:"SSH / SFTP",preview:!1}),o[25]=de):de=o[25],o[26]!==ie||o[27]!==H||o[28]!==m||o[29]!==p||o[30]!==y||o[31]!==Q||o[32]!==g||o[33]!==M||o[34]!==(null===W||void 0===W?void 0:W.id)?(ue=async()=>{const e=ie();await Q(e).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&M(e.fulfilled,[{key:"sftp-".concat((0,_.omW)((null===W||void 0===W?void 0:W.id)||""))}]),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const l=e.rejected[0].reason;y.error({title:null===l||void 0===l?void 0:l.title,content:H(l)})}})).catch((e=>{m.error("Unexpected error during session creation:",e),p.error(g("error.UnexpectedError"))}))},o[26]=ie,o[27]=H,o[28]=m,o[29]=p,o[30]=y,o[31]=Q,o[32]=g,o[33]=M,o[34]=null===W||void 0===W?void 0:W.id,o[35]=ue):ue=o[35],o[36]!==u||o[37]!==g?(ce=u&&g("data.explorer.RunSSH/SFTPserver"),o[36]=u,o[37]=g,o[38]=ce):ce=o[38],o[39]!==i||o[40]!==ce||o[41]!==se||o[42]!==ue?(me=(0,Y.jsx)(_.Fvl,(0,a.A)((0,a.A)({disabled:se,icon:de,action:ue},i),{},{children:ce})),o[39]=i,o[40]=ce,o[41]=se,o[42]=ue,o[43]=me):me=o[43],o[44]!==ee||o[45]!==$||o[46]!==L?(ge=w().isEmpty($)||!L||!ee,o[44]=ee,o[45]=$,o[46]=L,o[47]=ge):ge=o[47],o[48]===Symbol.for("react.memo_cache_sentinel")?(pe=["click"],o[48]=pe):pe=o[48],o[49]!==g?(ye=g("import.StartWithOptions"),o[49]=g,o[50]=ye):ye=o[50],o[51]!==ie||o[52]!==b?(fe=()=>{const e=ie(),l=new URLSearchParams;l.set("formValues",JSON.stringify(e)),l.set("step","4"),b({pathname:"/session/start",search:l.toString()})},o[51]=ie,o[52]=b,o[53]=fe):fe=o[53],o[54]!==ye||o[55]!==fe?(ve={items:[{key:"custom",label:ye,onClick:fe}]},o[54]=ye,o[55]=fe,o[56]=ve):ve=o[56],o[57]===Symbol.for("react.memo_cache_sentinel")?(Fe=(0,Y.jsx)(_.Fvl,{icon:(0,Y.jsx)(v.A,{})}),o[57]=Fe):Fe=o[57],o[58]!==ge||o[59]!==ve?(he=(0,Y.jsx)(k.A,{disabled:ge,trigger:pe,menu:ve,children:Fe}),o[58]=ge,o[59]=ve,o[60]=he):he=o[60],o[61]!==me||o[62]!==he?(ke=(0,Y.jsxs)(S.A.Compact,{children:[me,he]}),o[61]=me,o[62]=he,o[63]=ke):ke=o[63],o[64]!==ke||o[65]!==te?(Se=(0,Y.jsx)(x.A,{title:te,children:ke}),o[64]=ke,o[65]=te,o[66]=Se):Se=o[66],Se};var ie=n(10331),te=n(49749),se=n(38851),de=n(85212),ue=n(29730);const ce=e=>{const l=(0,c.c)(26),{vfolderNodeFrgmt:n,titleStyle:r}=e,{token:o}=te.A.useToken(),{lg:i}=se.Ay.useBreakpoint();let t;l[0]===Symbol.for("react.memo_cache_sentinel")?(t=u,l[0]=t):t=l[0];const s=(0,A.useFragment)(t,n);let d,p,y,f,v,F,h,k;return l[1]===Symbol.for("react.memo_cache_sentinel")?(d={width:"100%"},l[1]=d):d=l[1],l[2]!==r?(p=(0,a.A)({flex:1,fontWeight:"normal"},r),l[2]=r,l[3]=p):p=l[3],l[4]!==o.borderRadius||l[5]!==o.colorBorderSecondary||l[6]!==o.fontSizeHeading3||l[7]!==o.fontSizeHeading4||l[8]!==s?(y=s?(0,Y.jsx)(ie.A,{vfolderNodeIdenticonFrgmt:s,style:{fontSize:o.fontSizeHeading4}}):(0,Y.jsx)(_.OOm,{style:{borderColor:o.colorBorderSecondary,borderWidth:1,borderStyle:"solid",width:o.fontSizeHeading3,height:o.fontSizeHeading3,borderRadius:o.borderRadius}}),l[4]=o.borderRadius,l[5]=o.colorBorderSecondary,l[6]=o.fontSizeHeading3,l[7]=o.fontSizeHeading4,l[8]=s,l[9]=y):y=l[9],l[10]!==s?(f=s&&(0,Y.jsx)(m.A,{vfolderFrgmt:s,enableLink:!1,component:de.A.Title,level:3,style:{margin:0,width:"100%"},ellipsis:!0,editable:{triggerType:["icon","text"]},inputProps:{size:"large",count:{max:64,show:!0},style:{fontWeight:"normal"}}}),l[10]=s,l[11]=f):f=l[11],l[12]!==p||l[13]!==y||l[14]!==f?(v=(0,Y.jsxs)(_.OOm,{"data-testid":"folder-explorer-title",gap:"xs",style:p,children:[y,f]}),l[12]=p,l[13]=y,l[14]=f,l[15]=v):v=l[15],l[16]!==i||l[17]!==s?(F=!s||null!==s&&void 0!==s&&s.unmanaged_path?null:(0,Y.jsxs)(K.Suspense,{fallback:(0,Y.jsx)(ue.A.Button,{active:!0}),children:[(0,Y.jsx)(g.A,{children:(0,Y.jsx)(le,{vfolderFrgmt:s,showTitle:i})}),(0,Y.jsx)(g.A,{children:(0,Y.jsx)(oe,{vfolderFrgmt:s,showTitle:i})})]}),l[16]=i,l[17]=s,l[18]=F):F=l[18],l[19]!==F||l[20]!==o.marginSM?(h=(0,Y.jsx)(_.OOm,{"data-testid":"folder-explorer-actions",justify:"end",gap:o.marginSM,children:F}),l[19]=F,l[20]=o.marginSM,l[21]=h):h=l[21],l[22]!==v||l[23]!==h||l[24]!==o.marginMD?(k=(0,Y.jsxs)(_.OOm,{"data-testid":"folder-explorer-header",justify:"between",gap:o.marginMD,style:d,children:[v,h]}),l[22]=v,l[23]=h,l[24]=o.marginMD,l[25]=k):k=l[25],k};var me=n(15725);const ge=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],l=[{kind:"Variable",name:"id",variableName:"id"}],n={alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"3aee063a4b508648c2365ba6c7f0f44a",id:null,metadata:{},name:"VFolderNodeDescriptionPermissionRefreshQuery",operationKind:"query",text:"query VFolderNodeDescriptionPermissionRefreshQuery(\n  $id: String!\n) {\n  vfolder_node(id: $id) {\n    permission\n    permissions\n    id\n  }\n}\n"}}}();ge.hash="36063c8300310d9ef6c369b49127a2a2";const pe=ge,ye={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderPermissionCellFragment"},{args:null,kind:"FragmentSpread",name:"useVirtualFolderNodePathFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"f4ca4470ea635f85c8c346eed0a5fe8c"},fe=ye;var ve=n(95650),Fe=n(58178);const he={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useVirtualFolderNodePathFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"439221036e87c57ca3ec1ce737e0cdf7"},ke=he,Se=e=>{const l=(0,A.useFragment)(ke,e),[n,a]=w().split(null===l||void 0===l?void 0:l.quota_scope_id,":"),r=(0,_.omW)(null===l||void 0===l?void 0:l.id),o=r.slice(0,2),i=r.slice(2,4),t=r.slice(4),s="".concat(a.replaceAll("-",""),"/").concat(o,"/").concat(i,"/").concat(t.replaceAll("-",""));return{quotaScopeType:n,quotaScopeIdWithoutType:a,vfolderId:r,vfolderIdPrefix1:o,vfolderIdPrefix2:i,vfolderIdRest:t,vfolderPath:s}};var xe=n(85953);const _e=e=>{let{vfolderNodeFrgmt:l}=e;const{quotaScopeType:n,quotaScopeIdWithoutType:a,vfolderId:r,vfolderIdPrefix1:o,vfolderIdPrefix2:i,vfolderIdRest:t}=Se(l),{token:s}=te.A.useToken();return(0,Y.jsxs)(_.OOm,{direction:"row",align:"start",justify:"start",wrap:"wrap",gap:3,children:[(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"(root)"}),(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,Y.jsxs)(_.OOm,{direction:"column",align:"start",justify:"start",children:[(0,Y.jsx)(_.mQ0,{monospace:!0,copyable:{text:a},style:{fontSize:"0.9em"},children:w().truncate(a.replaceAll("-",""),{length:15})}),(0,Y.jsxs)(_.mQ0,{type:"secondary",style:{fontSize:s.fontSizeSM},children:["Quota Scope ID (",w().upperFirst(n),")"]})]}),(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,Y.jsxs)(_.OOm,{direction:"column",align:"start",justify:"start",children:[(0,Y.jsxs)(_.OOm,{gap:3,children:[(0,Y.jsx)(_.mQ0,{monospace:!0,style:{fontSize:"0.9em"},children:o}),(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,Y.jsx)(_.mQ0,{monospace:!0,style:{fontSize:"0.9em"},children:i}),(0,Y.jsx)(_.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,Y.jsx)(_.mQ0,{monospace:!0,copyable:{text:r},style:{fontSize:"0.9em"},children:w().truncate(t.replaceAll("-",""),{length:7})})]}),(0,Y.jsx)(_.mQ0,{type:"secondary",style:{fontSize:s.fontSizeSM},children:"VFolder ID"})]})]})};var be=n(4628),we=n(4498),Ke=n(96165),je=n(56062),Ae=n.n(je);const Ne=["vfolderNodeFrgmt"],Pe=e=>{var l;let{vfolderNodeFrgmt:n}=e,o=(0,r.A)(e,Ne);const{t:i}=(0,j.Bd)(),{token:t}=te.A.useToken(),{message:s}=F.A.useApp(),{getErrorMessage:d}=(0,_.B78)(),u=(0,A.useRelayEnvironment)(),c=(0,N.hd)(),m=(0,f.CX)(),[g]=(0,ve.U6)(),p=(0,Fe.ET)({mutationFn:e=>{let{permission:l,id:n}=e;return m.vfolder.update_folder({permission:l},n)}}),y=(0,A.useFragment)(fe,n),{vfolderPath:v}=Se(y),h=(0,_.omW)(y.id),k=(0,_.YM3)([!(null!==y&&void 0!==y&&y.unmanaged_path)&&{key:"path",label:(0,Y.jsx)(de.A.Text,{copyable:{text:v},style:{color:t.colorTextLabel},children:i("data.folders.Path")}),children:(0,Y.jsx)(_e,{vfolderNodeFrgmt:y})},{key:"status",label:i("data.folders.Status"),children:(0,Y.jsx)(_.d6Z,{color:y.status?xe.C[y.status]:void 0,children:w().toUpper(y.status||"")})},{key:"host",label:i("data.Host"),children:y.host},{key:"ownership_type",label:i("data.folders.Ownership"),children:"user"===(null===y||void 0===y?void 0:y.ownership_type)?(0,Y.jsxs)(_.OOm,{gap:"xs",children:[(0,Y.jsx)(de.A.Text,{children:i("data.User")}),(0,Y.jsx)(be.A,{style:{color:t.colorTextTertiary}})]}):(0,Y.jsxs)(_.OOm,{gap:"xs",children:[(0,Y.jsx)(de.A.Text,{children:i("data.Project")}),(0,Y.jsx)(_.ObC,{style:{color:t.colorTextTertiary}})]})},((null===y||void 0===y?void 0:y.user)===g.uuid||m.is_admin&&(null===y||void 0===y?void 0:y.group)===(null===c||void 0===c?void 0:c.id))&&{key:"permission",label:i("data.folders.MountPermission"),children:(0,Y.jsx)(_.xrr,{defaultValue:"wd"===y.permission?"rw":y.permission,options:[{value:"ro",label:i("data.ReadOnly")},{value:"rw",label:i("data.ReadWrite")}],onChange:e=>{p.mutate({permission:e,id:h},{onSuccess:()=>{s.success(i("data.permission.PermissionModified")),document.dispatchEvent(new CustomEvent("backend-ai-folder-updated")),(0,A.fetchQuery)(u,pe,{id:y.id}).toPromise()},onError:e=>{s.error(d(e))}})},popupMatchSelectWidth:!1})},{key:"owner",label:i("data.folders.Owner"),children:(null===y||void 0===y?void 0:y.user)===(null===g||void 0===g?void 0:g.uuid)||m.is_admin&&(null===y||void 0===y?void 0:y.group)===(null===c||void 0===c?void 0:c.id)?(0,Y.jsx)(_.OOm,{justify:"start",children:(0,Y.jsx)(we.A,{})}):null},null!==y.user_email&&{key:"user_email",label:i("data.User"),children:(0,Y.jsx)(de.A.Text,{copyable:!0,children:y.user_email})},null!==y.group_name&&{key:"group_name",label:i("data.Project"),children:y.group_name},{key:"cloneable",label:i("data.folders.Cloneable"),children:y.cloneable?(0,Y.jsx)(_.OOm,{justify:"start",children:(0,Y.jsx)(we.A,{})}):null},{key:"max_size",label:i("data.folders.MaxSize"),children:y.max_size?null===(l=(0,E.Gh)(y.max_size,"g",2))||void 0===l?void 0:l.displayValue:"\u221e"},{key:"usage",label:i("data.UsageMode"),children:y.usage_mode},{key:"created_at",label:i("data.folders.CreatedAt"),children:Ae()(y.created_at).format("lll")}]);return(0,Y.jsx)(Ke.A,(0,a.A)({bordered:!0,column:1,size:"small",items:k,styles:{content:{wordBreak:"break-word",overflowWrap:"break-word"}}},o))};var Ve=n(99634),Te=n(7903),Ie=n(69347);const ze=["targetVFolderId","currentPath","fileInfo","onRequestClose","uploadFiles"],Ee=K.lazy((()=>n.e(4124).then(n.bind(n,84124)).then((e=>({default:e.Editor}))))),Be=(e,l)=>{const n=e.languages.getLanguages();for(const i of n){var a;if(null!==(a=i.extensions)&&void 0!==a&&a.some((e=>l.endsWith(e)))){var r,o;const e=null!==(r=null===(o=i.mimetypes)||void 0===o?void 0:o[0])&&void 0!==r?r:"text/plain";return{detectedLanguage:i.id,detectedMimeType:e}}}return{detectedLanguage:"plaintext",detectedMimeType:"text/plain"}},Oe=e=>{var l;const n=(0,c.c)(85);let o,i,t,s,d,u;if(n[0]!==e){var m=e;({targetVFolderId:d,currentPath:o,fileInfo:i,onRequestClose:s,uploadFiles:u}=m),t=(0,r.A)(m,ze),n[0]=e,n[1]=o,n[2]=i,n[3]=t,n[4]=s,n[5]=d,n[6]=u}else o=n[1],i=n[2],t=n[3],s=n[4],d=n[5],u=n[6];const{t:g}=(0,j.Bd)(),{isDarkMode:p}=(0,Te.e)(),{message:y}=F.A.useApp(),f=(0,_.kqi)(),{getErrorMessage:v}=(0,_.B78)(),{token:h}=te.A.useToken(),{upsertNotification:k}=(0,Ve.js)(),S=(0,Ie.jE)(),x=(0,K.useRef)(null),b=(0,K.useRef)("text/plain");let w;var A,N,P;n[7]!==o||n[8]!==(null===(l=i)||void 0===l?void 0:l.name)?(w="."===o?null===(A=i)||void 0===A?void 0:A.name:"".concat(o,"/").concat(null===(N=i)||void 0===N?void 0:N.name).replace(/^\.\//,""),n[7]=o,n[8]=null===(P=i)||void 0===P?void 0:P.name,n[9]=w):w=n[9];const V=w;let T,I;n[10]!==V||n[11]!==d?(T=["textFileContent",d,V],n[10]=V,n[11]=d,n[12]=T):T=n[12],n[13]!==f||n[14]!==V||n[15]!==d?(I=async()=>{const e=await f.vfolder.request_download_token(V,d,!1),l="".concat(e.url,"?token=").concat(e.token,"&archive=false"),n=await fetch(l);if(!n.ok)throw new Error("HTTP error! status: ".concat(n.status));return(await n.blob()).text()},n[13]=f,n[14]=V,n[15]=d,n[16]=I):I=n[16];const z=!!t.open&&!!i&&!!d;let E;n[17]!==T||n[18]!==I||n[19]!==z?(E={queryKey:T,queryFn:I,enabled:z,staleTime:0,gcTime:0},n[17]=T,n[18]=I,n[19]=z,n[20]=E):E=n[20];const{data:B,error:O,isFetching:D}=(0,Fe.nN)(E);let C,R,H,Q;n[21]!==f||n[22]!==o||n[23]!==B||n[24]!==i||n[25]!==g||n[26]!==d||n[27]!==u||n[28]!==k?(C=async()=>{var e,l,n;if(!i)return;const a=null!==(e=null!==(l=null===(n=x.current)||void 0===n?void 0:n.getValue())&&void 0!==l?l:B)&&void 0!==e?e:"",r=new Blob([a],{type:b.current}),t=new File([r],i.name,{type:b.current});if(0===t.size){const e=[o,i.name].filter(Boolean).join("/"),l=await f.vfolder.create_upload_session(e,t,d);if(!(await fetch(l,{method:"PATCH",headers:{"Upload-Offset":"0","Content-Type":"application/offset+octet-stream","Tus-Resumable":"1.0.0"},body:r})).ok)throw new Error(g("explorer.UploadFailed",{folderName:i.name}));k({key:"upload:"+d,open:!0,backgroundTask:{status:"resolved",percent:100,onChange:{resolved:g("explorer.SuccessfullyUploadedToFolder")}},duration:3})}else await u([t],d,o)},n[21]=f,n[22]=o,n[23]=B,n[24]=i,n[25]=g,n[26]=d,n[27]=u,n[28]=k,n[29]=C):C=n[29],n[30]!==V||n[31]!==s||n[32]!==S||n[33]!==d?(R=()=>{S.invalidateQueries({queryKey:["textFileContent",d,V]}),s(!0)},n[30]=V,n[31]=s,n[32]=S,n[33]=d,n[34]=R):R=n[34],n[35]!==v||n[36]!==y?(H=e=>{y.error(v(e))},n[35]=v,n[36]=y,n[37]=H):H=n[37],n[38]!==C||n[39]!==R||n[40]!==H?(Q={mutationFn:C,onSuccess:R,onError:H},n[38]=C,n[39]=R,n[40]=H,n[41]=Q):Q=n[41];const M=(0,Fe.ET)(Q);let L;n[42]!==h.paddingContentHorizontal||n[43]!==h.paddingContentVertical?(L=(0,Y.jsx)(ue.A,{active:!0,style:{alignSelf:"start",paddingInline:h.paddingContentHorizontal,paddingBlock:h.paddingContentVertical}}),n[42]=h.paddingContentHorizontal,n[43]=h.paddingContentVertical,n[44]=L):L=n[44];const q=L;let U,W,$,G;var X;(n[45]!==g?(U=g("button.Save"),n[45]=g,n[46]=U):U=n[46],n[47]!==g?(W=g("button.Cancel"),n[47]=g,n[48]=W):W=n[48],n[49]!==g?($=g("data.explorer.EditFile"),n[49]=g,n[50]=$):$=n[50],n[51]!==i)?(G=i&&(0,Y.jsxs)(_.mQ0,{type:"secondary",style:{fontWeight:"normal"},children:["- ",i.name,i.size>0&&" (".concat(null===(X=(0,_.GhK)(i.size,"auto"))||void 0===X?void 0:X.displayValue,")")]}),n[51]=i,n[52]=G):G=n[52];let Z,J,ee;n[53]!==$||n[54]!==G?(Z=(0,Y.jsxs)(Y.Fragment,{children:[$,G]}),n[53]=$,n[54]=G,n[55]=Z):Z=n[55],n[56]!==s?(J=()=>s(),n[56]=s,n[57]=J):J=n[57],n[58]!==M?(ee=()=>M.mutate(),n[58]=M,n[59]=ee):ee=n[59];const le=!!O;let ne,ae,re,oe,ie,se;return n[60]!==le?(ne={disabled:le},n[60]=le,n[61]=ne):ne=n[61],n[62]===Symbol.for("react.memo_cache_sentinel")?(ae={body:{paddingBlock:0,paddingInline:0}},n[62]=ae):ae=n[62],n[63]===Symbol.for("react.memo_cache_sentinel")?(re={height:"calc(100vh - 180px)"},n[63]=re):re=n[63],n[64]!==B||n[65]!==i||n[66]!==p||n[67]!==D||n[68]!==O||n[69]!==q||n[70]!==g?(oe=O?(0,Y.jsx)(_.RfO,{type:"error",showIcon:!0,title:g("data.explorer.FailedToLoadFile"),description:g("data.explorer.FailedToLoadFileDescription")}):D?q:(0,Y.jsx)(Ee,{defaultValue:null!==B&&void 0!==B?B:"",beforeMount:e=>{var l;if(null!==(l=i)&&void 0!==l&&l.name){const{detectedMimeType:l}=Be(e,i.name);b.current=l}},onMount:(e,l)=>{var n;if(x.current=e,null!==(n=i)&&void 0!==n&&n.name){const{detectedLanguage:n}=Be(l,i.name),a=e.getModel();a&&l.editor.setModelLanguage(a,n)}},theme:p?"vs-dark":"light",loading:q,width:"100%",height:"100%",options:{fixedOverflowWidgets:!0}}),n[64]=B,n[65]=i,n[66]=p,n[67]=D,n[68]=O,n[69]=q,n[70]=g,n[71]=oe):oe=n[71],n[72]!==q||n[73]!==oe?(ie=(0,Y.jsx)(_.OOm,{direction:"column",gap:"md",style:re,children:(0,Y.jsx)(K.Suspense,{fallback:q,children:oe})}),n[72]=q,n[73]=oe,n[74]=ie):ie=n[74],n[75]!==t||n[76]!==M.isPending||n[77]!==U||n[78]!==W||n[79]!==Z||n[80]!==J||n[81]!==ee||n[82]!==ne||n[83]!==ie?(se=(0,Y.jsx)(_.IbE,(0,a.A)((0,a.A)({width:"100%",destroyOnHidden:!0,okText:U,cancelText:W},t),{},{title:Z,onCancel:J,onOk:ee,confirmLoading:M.isPending,okButtonProps:ne,styles:ae,children:ie})),n[75]=t,n[76]=M.isPending,n[77]=U,n[78]=W,n[79]=Z,n[80]=J,n[81]=ee,n[82]=ne,n[83]=ie,n[84]=se):se=n[84],se};var De=n(90855),Ce=n(43807),Re=n(38157),He=n(16419);const Qe=["vfolderID","onRequestClose"];var Me;const Le=(0,He.rU)((e=>{let{css:l}=e;return{baiModalHeader:l(Me||(Me=(0,o.A)(["\n    .ant-modal-title {\n      width: 100%;\n    }\n  "])))}})),qe=e=>{var l,n;let{vfolderID:o,onRequestClose:i}=e,d=(0,r.A)(e,Qe);const{t:u}=(0,j.Bd)(),{token:c}=te.A.useToken(),{xl:m}=se.Ay.useBreakpoint(),{styles:g}=Le(),[p,y]=(0,_.zui)(),v=(0,f.CX)(),F=(0,f.eZ)(),h=(0,N.hd)(),k=null===v||void 0===v||null===(l=v._config)||void 0===l?void 0:l.accessKey,S=(0,K.useRef)(null),{unitedAllowedPermissionByVolume:x}=Z(F,h.id,k),b=(0,K.useRef)(null),P=(0,K.useDeferredValue)(d.open),{vfolder_node:V}=(0,A.useLazyLoadQuery)(t,{vfolderGlobalId:(0,_.wcZ)("VirtualFolderNode",o)},{fetchPolicy:P&&d.open?"store-and-network":"store-only"}),{upsertNotification:T,closeNotification:I}=(0,Ve.js)(),{generateFolderPath:z}=(0,me.useFolderExplorerOpener)(),[E,B]=(0,K.useState)([]),[O,D]=(0,K.useState)(null),{uploadStatus:C,uploadFiles:R}=(0,s.useFileUploadManager)(null===V||void 0===V?void 0:V.id,(null===V||void 0===V?void 0:V.name)||void 0);(0,_.$$z)((()=>{var e;null===(e=S.current)||void 0===e||e.refetch()}),C&&!w().isEmpty(null===C||void 0===C?void 0:C.pendingFiles)?5e3:null),(0,K.useEffect)((()=>{C&&w().isEmpty(null===C||void 0===C?void 0:C.pendingFiles)&&y()}),[C,y]);const H=w().includes(x[null!==(n=null===V||void 0===V?void 0:V.host)&&void 0!==n?n:""],"download-file"),Q=w().includes(null===V||void 0===V?void 0:V.permissions,"delete_content"),M=w().includes(null===V||void 0===V?void 0:V.permissions,"write_content"),L=null!==V&&void 0!==V&&V.unmanaged_path?(0,Y.jsx)(De.A,{title:u("explorer.NoExplorerSupportForUnmanagedFolder"),showIcon:!0}):V?(0,Y.jsx)(_.Gt_,{ref:S,targetVFolderId:o,deletingFilePaths:E,fetchKey:p,onUpload:(e,l)=>{R(e,o,l)},onDeleteFilesInBackground:(e,l,n)=>{B(n),T({key:"delete:".concat(e),open:!0,message:(0,Y.jsxs)("span",{children:[u("explorer.VFolder"),":\xa0",(0,Y.jsx)(_.rmy,{style:{fontWeight:"normal"},to:z(l),onClick:()=>{I("delete:".concat(e))},children:"".concat(V.name)})]}),backgroundTask:{status:"pending",taskId:e,promise:null,percent:0,onChange:{pending:u("explorer.DeletingSelectedItems"),resolved:()=>(B([]),u("explorer.SelectedItemsDeletedSuccessfully")),rejected:()=>(B([]),u("explorer.SelectedItemsDeletionFailed"))}}})},enableDownload:H,enableDelete:Q,enableWrite:M,enableEdit:M,tableProps:{scroll:m?{x:"max-content"}:{x:"max-content",y:"calc(100vh - 400px)"}},style:{paddingBottom:m?c.paddingLG:0},fileDropContainerRef:b,onClickEditFile:(e,l)=>{D({file:e,currentPath:l})}}):null,q=V?(0,Y.jsx)(Pe,{vfolderNodeFrgmt:V}):null;return(0,Y.jsxs)(_.IbE,(0,a.A)((0,a.A)({className:g.baiModalHeader,width:"90%",keyboard:!0,destroyOnHidden:!0,footer:null,style:{maxWidth:"1600px"},styles:{body:{height:"100vh"}},title:V?(0,Y.jsx)(ce,{titleStyle:{zIndex:c.zIndexPopupBase+2},vfolderNodeFrgmt:V}):null,bodyProps:{ref:b},onCancel:()=>{i()}},d),{},{children:[(0,Y.jsx)(K.Suspense,{fallback:(0,Y.jsx)(ue.A,{active:!0}),children:P!==d.open||void 0===V?(0,Y.jsx)(ue.A,{active:!0}):(0,Y.jsxs)(_.OOm,{direction:"column",gap:"lg",align:"stretch",children:[null===V?(0,Y.jsx)(De.A,{title:u("explorer.FolderNotFoundOrNoAccess"),type:"error",showIcon:!0}):(null===h||void 0===h?void 0:h.id)!==(null===V||void 0===V?void 0:V.group)&&null!==V&&void 0!==V&&V.group?(0,Y.jsx)(De.A,{title:V.group_name?u("data.NotInProject",{projectName:V.group_name}):u("data.BelongsToDifferentProject"),type:"info",showIcon:!0}):null,m?(0,Y.jsxs)(Ce.A,{style:{gap:c.size},orientation:"horizontal",children:[(0,Y.jsx)(Ce.A.Panel,{resizable:!1,children:L}),(0,Y.jsx)(Ce.A.Panel,{defaultSize:500,children:q})]}):(0,Y.jsxs)(_.OOm,{direction:"column",align:"stretch",children:[L,(0,Y.jsx)(Re.A,{style:{borderColor:c.colorBorderSecondary}}),q]})]})}),(0,Y.jsx)(_.XcZ,{children:(0,Y.jsx)(Oe,{open:!!O,targetVFolderId:o,currentPath:(null===O||void 0===O?void 0:O.currentPath)||".",fileInfo:(null===O||void 0===O?void 0:O.file)||null,uploadFiles:R,onRequestClose:e=>{var l;e&&(null===(l=S.current)||void 0===l||l.refetch());D(null)}})})]}))}}}]);
//# sourceMappingURL=4222.f0816fb2.chunk.js.map