"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[299],{23623:(e,s,n)=>{n.d(s,{A:()=>l});var t=n(76998);const r=(e,s,n)=>{const[r,l]=(0,t.useState)(e());return(0,t.useEffect)((()=>{n&&l(e())}),[n]),function(e,s){const n=(0,t.useRef)();(0,t.useEffect)((()=>{n.current=e})),(0,t.useEffect)((()=>{if(null!==s){let e=setInterval((function(){var e;null===(e=n.current)||void 0===e||e.call(n)}),s);return()=>clearInterval(e)}}),[s])}((()=>{const s=e();s!==r&&l(s)}),s),r},l=e=>{let{callback:s,delay:n,triggerKey:t}=e;return r(s,n,t)}},42989:(e,s,n)=>{n.d(s,{A:()=>d});var t=n(66464),r=n(60708),l=n(14455),o=n.n(l),i=n(45901),a=n.n(i),c=(n(76998),n(23446));const d=e=>{let{value:s,onChange:n,localFormat:l,...i}=e;const[,d]=(0,t.A)({value:s,onChange:n});return(0,c.jsx)(r.A,{value:s?o()(s):void 0,onChange:e=>{var s,n,t;a().isArray(e)&&(e=e[0]);const r=l?null===(s=e)||void 0===s?void 0:s.format():null===(n=e)||void 0===n||null===(t=n.tz())||void 0===t?void 0:t.toISOString();d(r)},...i})}},55256:(e,s,n)=>{n.d(s,{Ay:()=>A,Kk:()=>x,p3:()=>p,sT:()=>h,vB:()=>m});var t=n(83468),r=n(5621),l=n(29871),o=n(48713),i=n(45901),a=n.n(i),c=n(76998),d=n(23446);const u=e=>{let{image:s,...n}=e;s=s||"";const[,{getImageAliasName:l,getBaseVersion:o,tagAlias:i}]=(0,t.Gj)();return(0,d.jsx)(r.A,{values:[{label:i(l(s)),color:"blue"},{label:o(s),color:"green"}],...n})},m=e=>{let{image:s,...n}=e;s=s||"";const[,{getBaseVersion:r,tagAlias:l}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...n,children:l(r(s))})},h=e=>{let{image:s,...n}=e;s=s||"";const[,{getBaseImage:r,tagAlias:l}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...n,children:l(r(s))})},g=e=>{let{image:s,...n}=e;s=s||"";const[,{getArchitecture:r,tagAlias:l}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...n,children:l(r(s))})},x=e=>{let{image:s,...n}=e;s=s||"";const[,{getImageLang:r,tagAlias:l}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...n,children:l(r(s))})},p=e=>{let{image:s,labels:n,...i}=e;s=s||"",n=n||[];const[,{getFilteredRequirementsTags:c,getCustomTag:u,tagAlias:m}]=(0,t.Gj)();return(0,d.jsxs)(l.A,{children:[a().map(c(s),((e,s)=>(0,d.jsx)(o.A,{color:"blue",...i,children:m(e||"")},s))),(0,d.jsx)(r.A,{color:"cyan",values:[{label:"Customized",color:"cyan"},{label:u(n),color:"cyan"}],...i})]})},v=(e,s)=>{let{image:n,style:t={}}=e;return n=n||"",(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u,{image:n}),(0,d.jsx)(h,{image:n}),(0,d.jsx)(g,{image:n})]})},A=c.memo(v)},86299:(e,s,n)=>{n.r(s),n.d(s,{default:()=>Fe});var t=n(25344),r=n(82156),l=n(50840),o=n(6932),i=n(29475),a=n(45901),c=n.n(a),d=n(76998),u=n(23446);const m=e=>{let{status:s="default",extraButtonTitle:n,onClickExtraButton:a,extra:d,style:m,...h}=e;const{token:g}=l.A.useToken(),x=d||n&&(0,u.jsx)(o.Ay,{type:"link",icon:"error"===s?(0,u.jsx)(t.A,{twoToneColor:g.colorError}):"warning"===s?(0,u.jsx)(r.A,{twoToneColor:g.colorWarning}):void 0,onClick:a,children:n})||void 0;return(0,u.jsx)(i.A,{className:"error"===s?"bai-card-error":"",style:c().extend(m,{borderColor:"error"===s?g.colorError:"warning"===s?g.colorWarning:"success"===s?g.colorSuccess:null===m||void 0===m?void 0:m.borderColor}),extra:x,...h})};var h=n(23623),g=n(42989),x=n(5621),p=n(29871),v=n(94080),A=n(5336),j=n(65080),y=n(36209),b=n(77678);const f=e=>{let{formItemProps:s,...n}=e;const t=(0,d.useRef)(null),{t:r}=(0,b.Bd)(),l=j.A.useFormInstance();return(0,u.jsx)(j.A.List,{...n,children:(e,i)=>{let{add:a,remove:d}=i;return(0,u.jsxs)(p.A,{direction:"column",gap:"xs",align:"stretch",children:[e.map(((o,i)=>{let{key:a,name:m,...h}=o;return(0,u.jsxs)(p.A,{direction:"row",align:"baseline",gap:"xs",children:[(0,u.jsx)(j.A.Item,{...h,style:{marginBottom:0,flex:1},name:[m,"variable"],rules:[{required:!0,message:r("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:r("session.launcher.EnvironmentVariableNamePatternError")},e=>{let{getFieldValue:s}=e;return{validator(e,t){const l=c().map(s(n.name),(e=>null===e||void 0===e?void 0:e.variable));return!c().isEmpty(t)&&l.length>0&&c().filter(l,(e=>e===t)).length>1?Promise.reject(r("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}],...s,children:(0,u.jsx)(y.A,{ref:i===e.length-1?t:null,placeholder:"Variable",onChange:()=>{const s=e.map(((e,s)=>[n.name,s,"variable"]));l.validateFields(s)}})}),(0,u.jsx)(j.A.Item,{...h,name:[m,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:r("session.launcher.EnvironmentVariableValueRequired")}],validateTrigger:["onChange","onBlur"],children:(0,u.jsx)(y.A,{placeholder:"Value"})}),(0,u.jsx)(v.A,{onClick:()=>d(m)})]},a)})),(0,u.jsx)(j.A.Item,{noStyle:!0,children:(0,u.jsx)(o.Ay,{type:"dashed",onClick:()=>{a(),setTimeout((()=>{t.current&&t.current.focus()}),0)},icon:(0,u.jsx)(A.A,{}),block:!0,children:r("session.launcher.AddEnvironmentVariable")})})]})}})};var F=n(85676),T=n(35051),S=n(55256),k=n(68231),V=n(83468),E=n(78074),C=n(48713);const w=e=>{let{value:s,...n}=e;const t=parseInt(s),r=t>=1024&&t<=65535;return(0,u.jsx)(C.A,{color:r?void 0:"red",...n})},N=e=>{let{...s}=e;const{t:n}=(0,b.Bd)(),t=(0,V.CX)();return(0,u.jsx)(j.A.Item,{label:n("session.launcher.PreOpenPortTitle"),name:"ports",tooltip:(0,u.jsx)(b.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:n("session.launcher.PreOpenPortRangeGuide"),rules:[{max:t._config.maxCountForPreopenPorts,type:"array",message:n("session.launcher.PreOpenPortMaxCountLimit",{count:t._config.maxCountForPreopenPorts})},e=>{let{getFieldValue:s}=e;return{validator:(e,s)=>c().every(s,(e=>{const s=parseInt(e);return s>=1024&&s<=65535}))?Promise.resolve():Promise.reject(new Error(n("session.launcher.PreOpenPortRange")))}}],...s,children:(0,u.jsx)(E.A,{mode:"tags",tagRender:e=>(0,u.jsx)(w,{closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label}),style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})};var I=n(44183),P=n(8469),_=n(44453),M=n(14246);const D=e=>{let{open:s,onClose:n,...t}=e;const{t:r}=(0,b.Bd)(),[l,o]=(0,_.q)("has_opened_tour_neo_session_validation"),i=[{title:r("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:r("tourguide.NeoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:r("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:r("tourguide.NeoSessionLauncher.FixErrorFieldbyModifyButton"),target:()=>{var e;return(null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]).querySelector(".ant-card-extra")}},{title:r("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:r("tourguide.NeoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,u.jsx)(M.A,{steps:i,onClose:e=>{null===n||void 0===n||n(e),o(!0)},open:!l&&s,...t})},z=e=>{let{...s}=e;const{t:n}=(0,b.Bd)();return(0,u.jsx)(j.A.Item,{label:n("session.launcher.SessionName"),name:"sessionName",rules:[{min:4,message:n("session.Validation.SessionNameTooShort")},{max:64,message:n("session.Validation.SessionNameTooLong64")},{validator:(e,s)=>c().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/^[\w.-]*$/.test(s)?!/\w$/.test(s)&&s.length>=4?Promise.reject(n("session.Validation.SessionNameShouldEndWith")):Promise.resolve():Promise.reject(n("session.Validation.SessionNameInvalidCharacter")):Promise.reject(n("session.Validation.SessionNameShouldStartWith"))}],...s,children:(0,u.jsx)(y.A,{allowClear:!0,autoComplete:"off"})})};var O=n(22089),B=n(30032),L=n(21454),R=n(96495),q=n(90660);var G=n(21186),W=n(71155),U=n(15618),H=n(78474),K=n(42290),J=n(40718),Z=n(76108),X=n(12620),$=n(33554),Q=n(41814),Y=n(17480),ee=n(24128),se=n(87627),ne=n(82745),te=n(7518),re=n(9788),le=n(329),oe=n(22307),ie=n(41856),ae=n(14862),ce=n(59065),de=n(20307),ue=n(31687),me=n(14455),he=n.n(me),ge=n(60269),xe=n(34515),pe=n(81365),ve=n(6592),Ae=n(52276),je=n(58346);const ye=e=>{let{form:s,containerCount:n=1}=e;return(0,u.jsxs)(u.Fragment,{children:[c().map(c().omit(s.getFieldsValue().resource,"shmem","accelerator","acceleratorType"),((e,t)=>{var r,l;return(0,u.jsx)(P.Ay,{type:t,value:"mem"===t?((null===(r=(0,B.Js)(e,"b"))||void 0===r?void 0:r.number)||0)*n+"":c().toNumber(e)*n+"",opts:{shmem:s.getFieldValue("resource").shmem?((null===(l=(0,B.Js)(s.getFieldValue("resource").shmem,"b"))||void 0===l?void 0:l.number)||0)*n:void 0}},t)})),c().isNumber(s.getFieldValue(["resource","accelerator"]))&&s.getFieldValue(["resource","acceleratorType"])&&(0,u.jsx)(P.Ay,{type:s.getFieldValue(["resource","acceleratorType"]),value:c().toString(s.getFieldValue(["resource","accelerator"])*n)})]})},be=()=>{let e="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<8;n++)e+=s.charAt(Math.floor(62*Math.random()));return e+"-session"},fe=()=>{let e=Math.floor(52*Math.random()*52*52);let s="";for(let t=0;t<3;t++)s+=(n=e%52)<26?String.fromCharCode(65+n):String.fromCharCode(97+n-26),e=Math.floor(e/52);var n;return s},Fe=()=>{var e,s,n,t,r,a,v,A,P,_,M,me,Fe,Te,Se,ke,Ve,Ee;const Ce=X.A.useApp();let we="normal";const Ne=(0,ge.md)(k.i7),Ie=(0,V.CX)(),[Pe,_e]=(0,d.useState)(!1),Me={sessionType:"interactive",allocationPreset:"auto-preset",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0},envvars:[],...(null===(e=Ie._config)||void 0===e?void 0:e.default_session_environment)&&{environments:{environment:null===(s=Ie._config)||void 0===s?void 0:s.default_session_environment}},...I.jh},De=(0,je.withDefault)(je.NumberParam,0),ze=(0,je.withDefault)(je.JsonParam,Me),[{step:Oe,formValues:Be,redirectTo:Le},Re]=(0,je.useQueryParams)({step:De,formValues:ze,redirectTo:je.StringParam}),{isDarkMode:qe}=(0,q.e)(),Ge=(0,pe.Zp)(),We=(0,V.f0)(),Ue=(0,R.hd)(),{upsertNotification:He}=(0,L.js)(),{run:Ke}=(0,Z.A)((()=>{Re({formValues:c().omit(Qe.getFieldsValue(),["environments.image"],["environments.customizedTag"],["autoMountedFolderNames"])},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),Je=e=>{Re({step:e},"pushIn")},{token:Ze}=l.A.useToken(),{t:Xe}=(0,b.Bd)(),$e=$.Ay.useBreakpoint(),[Qe]=j.A.useForm();(0,d.useEffect)((()=>{JSON.stringify(Me)!==JSON.stringify(Be)&&(Qe.setFieldsValue(Be),Qe.validateFields().catch((e=>{})))}),[]),(0,d.useEffect)((()=>{var e;null===(e=Ne.current)||void 0===e||e.scrollTo(0,0)}),[Oe]);const Ye=j.A.useWatch("sessionType",{form:Qe,preserve:!0})||Qe.getFieldValue("sessionType")||Be.sessionType,es=c().filter([{title:Xe("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(Xe("session.launcher.Environments")," & ").concat(Xe("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==Ye&&{title:Xe("webui.menu.Data&Storage"),key:"storage"},{title:Xe("session.launcher.Network"),key:"network"},{title:Xe("session.launcher.ConfirmAndLaunch"),icon:(0,u.jsx)(G.A,{}),key:"review"}],(e=>!!e)),ss=null===(n=es[Oe])||void 0===n?void 0:n.key,ns=c().some(Qe.getFieldsError(),(e=>e.errors.length>0)),[ts,rs]=(0,V.Tw)("first");(0,d.useEffect)((()=>{Oe===es.length-1&&Qe.validateFields().catch((e=>{})).finally((()=>rs()))}),[Oe,Qe,rs,es.length]),(0,d.useEffect)((()=>{"first"!==ts&&os(!!ns)}),[ts,ns]);const[ls,os]=(0,d.useState)(!1);return(0,u.jsxs)(p.A,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,u.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),Le&&(0,u.jsx)(Q.A,{items:[{title:Xe("webui.menu.Sessions"),onClick:e=>{e.preventDefault(),We(Le)},href:Le},{title:Xe("session.launcher.StartNewSession")}]}),(0,u.jsxs)(p.A,{direction:"row",gap:"md",align:"start",children:[(0,u.jsx)(p.A,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:(0,u.jsx)(j.A.Provider,{onFormChange:(e,s)=>{Ke()},children:(0,u.jsx)(j.A,{form:Qe,layout:"vertical",requiredMark:"optional",initialValues:Me,children:(0,u.jsxs)(p.A,{direction:"column",align:"stretch",gap:"md",children:[(0,u.jsxs)(i.A,{title:Xe("session.launcher.SessionType"),style:{display:"sessionType"===ss?"block":"none"},children:[(0,u.jsx)(j.A.Item,{name:"sessionType",children:(0,u.jsx)(Y.Ay.Group,{options:[{label:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ee.A.Text,{code:!0,children:Xe("session.launcher.InteractiveMode")})," ",(0,u.jsx)(ee.A.Text,{type:"secondary",children:Xe("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ee.A.Text,{code:!0,children:Xe("session.launcher.BatchMode")})," ",(0,u.jsx)(ee.A.Text,{type:"secondary",children:Xe("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,u.jsx)(z,{})]}),"batch"===Ye&&(0,u.jsxs)(i.A,{title:Xe("session.launcher.BatchModeConfig"),style:{display:"sessionType"===ss?"block":"none"},children:[(0,u.jsx)(j.A.Item,{label:Xe("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,u.jsx)(y.A.TextArea,{autoSize:!0})}),(0,u.jsx)(j.A.Item,{label:Xe("session.launcher.SessionStartTime"),extra:(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>e.batch.scheduleDate!==s.batch.scheduleDate,children:()=>{const e=Qe.getFieldValue(["batch","scheduleDate"]);return(0,u.jsx)(h.A,{delay:1e3,callback:()=>{const e=Qe.getFieldValue(["batch","scheduleDate"]);return e?he()(e).isBefore(he()())?void(0===Qe.getFieldError(["batch","scheduleDate"]).length&&Qe.validateFields([["batch","scheduleDate"]])):he()(e).fromNow():void 0},triggerKey:e||"none"})}}),children:(0,u.jsxs)(p.A,{direction:"row",gap:"xs",children:[(0,u.jsx)(j.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,u.jsx)(se.A,{onChange:e=>{e.target.checked&&c().isEmpty(Qe.getFieldValue(["batch","scheduleDate"]))?Qe.setFieldValue(["batch","scheduleDate"],he()().add(2,"minutes").toISOString()):!1===e.target.checked&&Qe.setFieldValue(["batch","scheduleDate"],void 0),Qe.validateFields([["batch","scheduleDate"]])},children:Xe("session.launcher.Enable")})}),(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.batch)||void 0===n?void 0:n.enabled)!==(null===(t=s.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const s=!0!==(null===(e=Qe.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(j.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,s)=>s&&he()(s).isBefore(he()())?Promise.reject(Xe("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,u.jsx)(g.A,{disabled:s,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(he()().startOf("day"))})})})}})]})})]}),"inference"===Ye&&(0,u.jsx)(i.A,{title:"Inference Mode Configuration",children:(0,u.jsx)(j.A.Item,{name:["inference","vFolderName"],label:Xe("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,u.jsx)(E.A,{})})}),(0,u.jsxs)(i.A,{title:Xe("session.launcher.Environments"),style:{display:"environment"===ss?"block":"none"},children:[(0,u.jsx)(xe.tH,{fallbackRender:e=>(console.log(e),null),children:(0,u.jsx)(F.A,{})}),(0,u.jsx)(j.A.Item,{label:Xe("session.launcher.EnvironmentVariable"),children:(0,u.jsx)(f,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,u.jsx)(i.A,{title:Xe("session.launcher.ResourceAllocation"),style:{display:"environment"===ss?"block":"none"},children:(0,u.jsx)(I.Ay,{enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,u.jsxs)(i.A,{title:Xe("session.launcher.HPCOptimization"),style:{display:"environment"===ss?"block":"none"},children:[(0,u.jsx)(j.A.Item,{noStyle:!0,children:(0,u.jsxs)(p.A,{direction:"row",gap:"sm",children:[(0,u.jsx)(ee.A.Text,{children:Xe("session.launcher.SwitchOpenMPoptimization")}),(0,u.jsx)(j.A.Item,{label:Xe("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,u.jsx)(ne.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e&&Qe.setFieldsValue(c().pick(Me,["hpcOptimization"]))}})})]})}),(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.hpcOptimization)||void 0===n?void 0:n.autoEnabled)!==(null===(t=s.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=Qe.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,u.jsxs)(te.A,{gutter:Ze.marginMD,style:{display:e?"none":void 0,marginTop:Ze.marginMD},children:[(0,u.jsx)(re.A,{xs:24,sm:12,children:(0,u.jsx)(j.A.Item,{style:{flex:1},label:Xe("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,u.jsxs)(u.Fragment,{children:[Xe("session.launcher.OpenMPOptimization"),(0,u.jsx)(b.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,u.jsx)(le.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,u.jsx)(re.A,{xs:24,sm:12,children:(0,u.jsx)(j.A.Item,{style:{flex:1},label:Xe("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,u.jsxs)(u.Fragment,{children:[Xe("session.launcher.OpenMPOptimization"),(0,u.jsx)(b.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,u.jsx)(le.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,u.jsx)(i.A,{title:Xe("webui.menu.Data&Storage"),style:{display:"storage"===ss?"block":"none"},children:(0,u.jsx)(O.A,{filter:e=>{var s;return"ready"===e.status&&!(null!==(s=e.name)&&void 0!==s&&s.startsWith("."))}})}),(0,u.jsx)(i.A,{title:Xe("session.launcher.Network"),style:{display:"network"===ss?"block":"none"},children:(0,u.jsx)(N,{})}),"review"===ss&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(m,{title:Xe("session.launcher.SessionType"),size:"small",status:Qe.getFieldError("sessionName").length>0||Qe.getFieldError(["batch","command"]).length>0||Qe.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:Xe("button.Edit"),onClickExtraButton:()=>{Je(es.findIndex((e=>"sessionType"===e.key)))},children:(0,u.jsxs)(oe.A,{size:"small",column:1,children:[(0,u.jsx)(oe.A.Item,{label:Xe("session.SessionType"),children:Qe.getFieldValue("sessionType")}),!c().isEmpty(Qe.getFieldValue("sessionName"))&&(0,u.jsx)(oe.A.Item,{label:Xe("session.launcher.SessionName"),children:Qe.getFieldValue("sessionName")}),"batch"===Ye&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(oe.A.Item,{label:Xe("session.launcher.StartUpCommand"),children:Qe.getFieldValue(["batch","command"])?(0,u.jsx)(ve.A,{style:qe?Ae.A:void 0,language:"shell",customStyle:{margin:0,width:"100%"},children:Qe.getFieldValue(["batch","command"])}):(0,u.jsx)(ee.A.Text,{type:"secondary",children:Xe("general.None")})}),(0,u.jsx)(oe.A.Item,{label:Xe("session.launcher.ScheduleTimeSimple"),children:Qe.getFieldValue(["batch","scheduleDate"])?he()(Qe.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,u.jsx)(ee.A.Text,{type:"secondary",children:Xe("general.None")})})]})]})}),(0,u.jsx)(m,{title:Xe("session.launcher.Environments"),size:"small",status:c().some(Qe.getFieldValue("envvars"),((e,s)=>Qe.getFieldError(["envvars",s,"variable"]).length>0||Qe.getFieldError(["envvars",s,"value"]).length>0))?"error":void 0,extraButtonTitle:Xe("button.Edit"),onClickExtraButton:()=>{Je(es.findIndex((e=>"environment"===e.key)))},children:(0,u.jsxs)(oe.A,{size:"small",column:1,children:[(0,u.jsx)(oe.A.Item,{label:Xe("session.launcher.Project"),children:Ue.name}),(0,u.jsx)(oe.A.Item,{label:Xe("general.Image"),children:(0,u.jsxs)(te.A,{style:{flexFlow:"nowrap",gap:Ze.sizeXS},children:[(0,u.jsx)(re.A,{children:(0,u.jsx)(T.A,{image:(null===(t=Qe.getFieldValue("environments"))||void 0===t?void 0:t.version)||(null===(r=Qe.getFieldValue("environments"))||void 0===r?void 0:r.manual)})}),(0,u.jsx)(re.A,{children:(0,u.jsx)(p.A,{direction:"row",children:null!==(a=Qe.getFieldValue("environments"))&&void 0!==a&&a.manual?(0,u.jsx)(ee.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(v=Qe.getFieldValue("environments"))||void 0===v?void 0:v.manual},children:null===(A=Qe.getFieldValue("environments"))||void 0===A?void 0:A.manual}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(S.Ay,{image:null===(P=Qe.getFieldValue("environments"))||void 0===P?void 0:P.version}),null!==(_=Qe.getFieldValue("environments"))&&void 0!==_&&_.customizedTag?(0,u.jsx)(x.A,{values:[{label:"Customized",color:"cyan"},{label:null===(M=Qe.getFieldValue("environments"))||void 0===M?void 0:M.customizedTag,color:"cyan"}]}):null,(0,u.jsx)(ee.A.Text,{copyable:{text:null===(me=Qe.getFieldValue("environments"))||void 0===me?void 0:me.version}})]})})})]})}),(null===(Fe=Qe.getFieldValue("envvars"))||void 0===Fe?void 0:Fe.length)>0&&(0,u.jsx)(oe.A.Item,{label:Xe("session.launcher.EnvironmentVariable"),children:null!==(Te=Qe.getFieldValue("envvars"))&&void 0!==Te&&Te.length?(0,u.jsx)(ve.A,{style:qe?Ae.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:c().map(Qe.getFieldValue("envvars"),(e=>"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"'))).join("\n")}):(0,u.jsx)(ee.A.Text,{type:"secondary",children:"-"})})]})}),(0,u.jsx)(m,{title:Xe("session.launcher.ResourceAllocation"),status:c().some(Qe.getFieldValue("resource"),((e,s)=>Qe.getFieldError(["resource",s]).length>0))||Qe.getFieldError(["num_of_sessions"]).length>0||Qe.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:Xe("button.Edit"),onClickExtraButton:()=>{Je(es.findIndex((e=>"environment"===e.key)))},children:(0,u.jsxs)(p.A,{direction:"column",align:"stretch",children:[c().some(null===(Se=Qe.getFieldValue("resource"))||void 0===Se?void 0:Se.resource,((e,s)=>Qe.getFieldWarning(["resource",s]).length>0))&&(0,u.jsx)(ie.A,{type:"warning",showIcon:!0,message:Xe("session.launcher.EnqueueComputeSessionWarning")}),(0,u.jsxs)(oe.A,{column:2,children:[(0,u.jsx)(oe.A.Item,{label:Xe("general.ResourceGroup"),span:2,children:Qe.getFieldValue("resourceGroup")||(0,u.jsx)(ee.A.Text,{type:"secondary",children:Xe("general.None")})}),(0,u.jsx)(oe.A.Item,{label:Xe("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,u.jsxs)(p.A,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===Qe.getFieldValue("allocationPreset")?"":(0,u.jsx)(C.A,{children:Qe.getFieldValue("allocationPreset")}),(0,u.jsx)(ye,{form:Qe})]})}),(0,u.jsx)(oe.A.Item,{label:Xe("session.launcher.NumberOfContainer"),children:1===Qe.getFieldValue("cluster_size")?Qe.getFieldValue("num_of_sessions"):Qe.getFieldValue("cluster_size")}),(0,u.jsx)(oe.A.Item,{label:Xe("session.launcher.ClusterMode"),children:"single-node"===Qe.getFieldValue("cluster_mode")?Xe("session.launcher.SingleNode"):Xe("session.launcher.MultiNode")})]}),(0,u.jsx)(i.A,{size:"small",type:"inner",title:Xe("session.launcher.TotalAllocation"),children:(0,u.jsx)(p.A,{direction:"row",gap:"xxs",children:(0,u.jsx)(ye,{form:Qe,containerCount:1===Qe.getFieldValue("cluster_size")?Qe.getFieldValue("num_of_sessions"):Qe.getFieldValue("cluster_size")})})})]})}),(0,u.jsx)(m,{title:Xe("webui.menu.Data&Storage"),size:"small",status:Qe.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:Xe("button.Edit"),onClickExtraButton:()=>{Je(es.findIndex((e=>"storage"===e.key)))},children:(0,u.jsxs)(p.A,{direction:"column",align:"stretch",gap:"xs",children:[(null===(ke=Qe.getFieldValue("mounts"))||void 0===ke?void 0:ke.length)>0?(0,u.jsx)(ae.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:Xe("data.folders.Name")},{dataIndex:"alias",title:Xe("session.launcher.FolderAlias"),render:(e,s)=>c().isEmpty(e)?(0,u.jsx)(ee.A.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(s.name)}):e}],dataSource:c().map(Qe.getFieldValue("mounts"),(e=>{var s;return{name:e,alias:null===(s=Qe.getFieldValue("vfoldersAliasMap"))||void 0===s?void 0:s[e]}}))}):(0,u.jsx)(ie.A,{type:"warning",showIcon:!0,message:Xe("session.launcher.NoFolderMounted")}),(null===(Ve=Qe.getFieldValue("autoMountedFolderNames"))||void 0===Ve?void 0:Ve.length)>0?(0,u.jsx)(oe.A,{size:"small",children:(0,u.jsx)(oe.A.Item,{label:Xe("data.AutomountFolders"),children:c().map(Qe.getFieldValue("autoMountedFolderNames"),(e=>(0,u.jsx)(C.A,{children:e})))})}):null]})}),(0,u.jsx)(m,{title:"Network",size:"small",status:Qe.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:Xe("button.Edit"),onClickExtraButton:()=>{Je(es.findIndex((e=>"network"===e.key)))},children:(0,u.jsx)(oe.A,{size:"small",children:(0,u.jsx)(oe.A.Item,{label:Xe("session.launcher.PreOpenPortTitle"),children:(0,u.jsxs)(p.A,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[c().sortBy(Qe.getFieldValue("ports"),(e=>parseInt(e))).map((e=>(0,u.jsx)(w,{value:e,style:{margin:0},children:e}))),c().isArray(Qe.getFieldValue("ports"))&&0!==(null===(Ee=Qe.getFieldValue("ports"))||void 0===Ee?void 0:Ee.length)?null:(0,u.jsx)(ee.A.Text,{type:"secondary",children:Xe("general.None")})]})})})})]}),(0,u.jsxs)(p.A,{direction:"row",justify:"between",children:[(0,u.jsx)(p.A,{gap:"sm",children:(0,u.jsx)(ce.A,{title:Xe("button.Reset"),description:Xe("session.launcher.ResetFormConfirm"),onConfirm:()=>{Qe.resetFields(),Ge("/session/start")},icon:(0,u.jsx)(W.A,{style:{color:Ze.colorError}}),okText:Xe("button.Reset"),okButtonProps:{danger:!0},children:(0,u.jsx)(o.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:Xe("button.Reset")})})}),(0,u.jsxs)(p.A,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[Oe>0&&(0,u.jsx)(o.Ay,{onClick:()=>{Je(Oe-1)},icon:(0,u.jsx)(U.A,{}),disabled:Pe,children:Xe("button.Previous")}),Oe===es.length-1?(0,u.jsx)(de.A,{title:ns?Xe("session.launcher.PleaseCompleteForm"):void 0,children:(0,u.jsx)(o.Ay,{type:"primary",icon:(0,u.jsx)(H.A,{}),disabled:ns,onClick:()=>{_e(!0),Qe.validateFields().then((async e=>{if(c().isEmpty(e.mounts)||0===e.mounts.length){if(!await new Promise((e=>{Ce.modal.confirm({title:Xe("session.launcher.NoFolderMounted"),content:(0,u.jsxs)(u.Fragment,{children:[Xe("session.launcher.HomeDirectoryDeletionDialog"),(0,u.jsx)("br",{}),(0,u.jsx)("br",{}),Xe("session.launcher.LaunchConfirmationDialog"),(0,u.jsx)("br",{}),(0,u.jsx)("br",{}),Xe("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:Xe("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const s=e.environments.manual||e.environments.version;let[n,t]=s?s.split("@"):["",""];const r=c().isEmpty(e.sessionName)?be():e.sessionName,l={kernelName:n,architecture:t,sessionName:r,config:{type:e.sessionType,..."batch"===e.sessionType?{startsAt:e.batch.enabled?e.batch.scheduleDate:void 0,startupCommand:e.batch.command}:{},group_name:Ue.name,domain:Ie._config.domainName,scaling_group:e.resourceGroup,cluster_mode:e.cluster_mode,cluster_size:e.cluster_size,maxWaitSeconds:15,cpu:e.resource.cpu,mem:e.resource.mem,shmem:(0,B.Mh)(e.resource.mem,"4g")>0&&(0,B.Mh)(e.resource.shmem,"1g")<0?"1g":e.resource.shmem,...e.resource.accelerator>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0,mounts:e.mounts,mount_map:e.vfoldersAliasMap,env:{...c().fromPairs(e.envvars.map((e=>[e.variable,e.value]))),...c().omit(e.hpcOptimization,"autoEnabled")},preopen_ports:c().map(e.ports,(e=>parseInt(e)))}},o=c().map(c().range(e.num_of_sessions||1),(s=>{const n=(e.num_of_sessions||1)>1?"".concat(l.sessionName,"-").concat(fe(),"-").concat(s):l.sessionName;return Ie.createIfNotExists(l.kernelName,n,l.config,2e4,l.architecture).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(Xe("session.launcher.SessionAlreadyExists"));if("CANCELLED"===(null===e||void 0===e?void 0:e.status))throw new Error(Xe("session.launcher.FailedToStartNewSession"));return e})).catch((e=>{throw e}))}));We(Le||"/job"),He({key:"session-launcher:"+r,backgroundTask:{promise:Promise.all(o),status:"pending",statusDescriptions:{pending:Xe("session.PreparingSession"),resolved:Xe("eduapi.ComputeSessionPrepared")}},duration:0,message:Xe("general.Session")+": "+r,open:!0}),await Promise.all(o).then((s=>{let[n]=s;if(1===e.num_of_sessions&&"batch"!==e.sessionType){const e=n;let s;s="kernelId"in e?{"session-name":e.kernelId,"access-key":"",mode:we}:{"session-uuid":e.sessionId,"session-name":e.sessionName,"access-key":"",mode:we};const t=e.servicePorts;!0===Array.isArray(t)?s["app-services"]=t.map((e=>e.name)):s["app-services"]=[],t.length>0&&globalThis.appLauncher.showLauncher(s)}})).catch((()=>{}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{_e(!1)}))},loading:Pe,children:Xe("session.launcher.Launch")})}):(0,u.jsxs)(o.Ay,{type:"primary",ghost:!0,onClick:()=>{Je(Oe+1)},children:[Xe("button.Next")," ",(0,u.jsx)(K.A,{})]}),Oe!==es.length-1&&(0,u.jsxs)(o.Ay,{onClick:()=>{Je(es.length-1)},children:[Xe("session.launcher.SkipToConfirmAndLaunch"),(0,u.jsx)(J.A,{})]})]})]})]})})})}),$e.lg&&(0,u.jsx)(p.A,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,u.jsx)(ue.A,{size:"small",direction:"vertical",current:Oe,onChange:e=>{Je(e)},items:c().map(es,((e,s)=>({...e,status:s===Oe?"process":"wait"})))})})]}),(0,u.jsx)(D,{open:ls,onClose:()=>{os(!1)},scrollIntoViewOptions:!0})]})}}}]);
//# sourceMappingURL=299.59016706.chunk.js.map