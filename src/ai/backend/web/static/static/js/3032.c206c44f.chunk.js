/*! For license information please see 3032.c206c44f.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[3032,7474],{87474:(e,n,s)=>{s.a(e,(async(e,r)=>{try{s.r(n),s.d(n,{default:()=>A,passwordPattern:()=>f});var a=s(72375),t=s(23441),o=s(69949),i=s(59764),l=s(72338),d=s(70899),u=s(66596),c=s(79597),w=s(52010),m=s(12221),p=s(1364),P=s(99142),v=s(55093),h=s(33364),g=s(79569),b=e([i]);i=(b.then?(await b)():b)[0];const f=/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,A=()=>{const{value:e,dispatchEvent:n}=(0,i.useWebComponentInfo)();let s;try{s=JSON.parse(e||"")}catch(M){s={open:!1,currentPassword:"",username:"",api_endpoint:""}}const{open:r,currentPassword:b,username:A,api_endpoint:j}=s,{token:x}=u.A.useToken(),[y]=c.A.useForm(),{t:_}=(0,h.Bd)();(0,v.useEffect)((()=>{r&&y.resetFields()}),[r,y]);const C=(0,t.oM)({api_endpoint:j}),k=(0,o.ET)({mutationFn:e=>(0,a.hu)({method:"POST",url:"/server/update-password-no-auth",body:e,client:C})}),F=()=>{y.validateFields().then((e=>{k.mutate({username:A,current_password:b,new_password:e.newPassword},{onSuccess(e,s,r){n("ok",null)},onError(e,n,s){}})}))};return(0,g.jsx)(w.A,{open:r,centered:!0,mask:!1,onCancel:()=>{n("cancel",null)},keyboard:!1,maskClosable:!1,footer:null,width:450,destroyOnClose:!0,forceRender:!0,children:(0,g.jsxs)(l.A,{direction:"column",justify:"start",align:"stretch",gap:"md",style:{alignSelf:"stretch",paddingTop:x.paddingMD,paddingBottom:x.paddingMD},children:[(0,g.jsxs)(m.A.Title,{level:3,style:{margin:0},children:[(0,g.jsx)(d.A,{twoToneColor:x.colorWarning})," ",_("webui.menu.PleaseChangeYourPassword")]}),_("webui.menu.YouMushChangeYourPassword"),(0,g.jsxs)(c.A,{form:y,layout:"vertical",initialValues:{currentPassword:b},disabled:k.isPending,children:[(0,g.jsx)(c.A.Item,{name:"newPassword",label:_("webui.menu.NewPassword"),rules:[{required:!0},{pattern:f,message:_("webui.menu.InvalidPasswordMessage").toString()},()=>({validator:(e,n)=>b===n?Promise.reject(new Error(_("webui.menu.NewPasswordCannotBeSame").toString())):Promise.resolve()})],hasFeedback:!0,children:(0,g.jsx)(p.A.Password,{})}),(0,g.jsx)(c.A.Item,{name:"confirm",label:_("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0},e=>{let{getFieldValue:n}=e;return{validator:(e,s)=>s&&n("newPassword")!==s?Promise.reject(new Error(_("environment.PasswordsDoNotMatch").toString())):Promise.resolve()}}],children:(0,g.jsx)(p.A.Password,{onPressEnter:F})})]}),(0,g.jsx)(P.Ay,{type:"primary",onClick:F,loading:k.isPending,children:_("webui.menu.Update")})]})})};r()}catch(f){r(f)}}))},30651:(e,n,s)=>{s.a(e,(async(e,r)=>{try{s.r(n),s.d(n,{default:()=>_});var a=s(23441),t=s(7971),o=s(69949),i=s(88543),l=s(87474),d=s(5058),u=s(97274),c=s(68260),w=s(86435),m=s(11956),p=s(75197),P=s(52010),v=s(65489),h=s(79597),g=s(1364),b=s(47149),f=s(55093),A=s(33364),j=s(63821),x=s(79569),y=e([l]);l=(y.then?(await y)():y)[0];const _=e=>{let{onRequestClose:n,onRequestRefresh:s,isRefreshModalPending:r,totpSupported:y,queryRef:_,...C}=e;const{t:k}=(0,A.Bd)(),F=(0,f.useRef)(null),[M,T]=p.Ay.useMessage(),[E,N]=P.A.useModal(),[I,{toggle:S}]=(0,m.A)(!1),R=(0,a.CX)(),V=(0,t.Am)(),[O,z]=(0,t.U6)(),{user:q}=(0,j.usePreloadedQuery)(u.j,_),B=(0,o.ET)({mutationFn:()=>R.remove_totp()});return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(i.A,{...C,okText:k("webui.menu.Update"),cancelText:k("webui.menu.Cancel"),onCancel:()=>{n()},confirmLoading:O.isPendingMutation,onOk:()=>(()=>{var e;null===(e=F.current)||void 0===e||e.validateFields().then((e=>{z.updateFullName(e.full_name,{onSuccess:s=>{s!==O.full_name&&M.open({type:"success",content:k("webui.menu.FullNameUpdated")}),e.newPassword&&e.newPasswordConfirm&&e.originalPassword?z.updatePassword({new_password:e.newPassword,new_password2:e.newPasswordConfirm,old_password:e.originalPassword},{onSuccess:()=>{M.open({type:"success",content:k("webui.menu.PasswordUpdated")}),n(!0)},onError:e=>{M.open({type:"error",content:e.message})}}):n(!0)},onError:e=>{M.open({type:"error",content:e.message})}})})).catch((()=>{}))})(),centered:!0,destroyOnClose:!0,title:k("webui.menu.MyAccountInformation"),children:[(0,x.jsx)(v.A,{spinning:r,indicator:(0,x.jsx)(c.A,{}),children:(0,x.jsxs)(h.A,{ref:F,layout:"vertical",labelCol:{span:8},initialValues:{full_name:O.full_name,totp_activated:(null===q||void 0===q?void 0:q.totp_activated)||!1},preserve:!1,children:[(0,x.jsx)(h.A.Item,{name:"full_name",label:k("webui.menu.FullName"),rules:[()=>({validator:(e,n)=>n&&n.length<65?Promise.resolve():Promise.reject(new Error(k("webui.menu.FullNameInvalid")))})],children:(0,x.jsx)(g.A,{})}),(0,x.jsx)(h.A.Item,{name:"originalPassword",label:k("webui.menu.OriginalPassword"),rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,s)=>s||!n("newPassword")&&!n("newPasswordConfirm")?Promise.resolve():Promise.reject(new Error(k("webui.menu.InputOriginalPassword")))}}],dependencies:["newPassword","newPasswordConfirm"],children:(0,x.jsx)(g.A.Password,{})}),(0,x.jsx)(h.A.Item,{name:"newPassword",label:k("webui.menu.NewPassword"),rules:[{pattern:"superadmin"===V?void 0:l.passwordPattern,message:k("webui.menu.InvalidPasswordMessage")}],children:(0,x.jsx)(g.A.Password,{})}),(0,x.jsx)(h.A.Item,{name:"newPasswordConfirm",label:k("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,s)=>s&&n("newPassword")!==s?Promise.reject(new Error(k("webui.menu.NewPasswordMismatch"))):Promise.resolve()}}],children:(0,x.jsx)(g.A.Password,{})}),!!y&&(0,x.jsx)(h.A.Item,{name:"totp_activated",label:k("webui.menu.TotpActivated"),valuePropName:"checked",children:(0,x.jsx)(b.A,{loading:B.isPending,onChange:e=>{var n;e?S():null!==q&&void 0!==q&&q.totp_activated&&(null===(n=F.current)||void 0===n||n.setFieldValue("totp_activated",!0),E.confirm({title:k("totp.TurnOffTotp"),icon:(0,x.jsx)(w.A,{}),content:k("totp.ConfirmTotpRemovalBody"),okText:k("button.Yes"),okType:"danger",cancelText:k("button.No"),onOk(){B.mutate(void 0,{onSuccess:()=>{var e;p.Ay.success(k("totp.RemoveTotpSetupCompleted")),s(),null===(e=F.current)||void 0===e||e.setFieldValue("totp_activated",!1)},onError:e=>{p.Ay.error(e.message)}})},onCancel(){var e;null===(e=F.current)||void 0===e||e.setFieldValue("totp_activated",!0)}}))}})})]})}),!!y&&(0,x.jsx)(d.A,{userFrgmt:q,open:I,onRequestClose:e=>{var n;e?s():null===(n=F.current)||void 0===n||n.setFieldValue("totp_activated",!1);S()}})]}),T,N]})};r()}catch(_){r(_)}}))},70899:(e,n,s)=>{s.d(n,{A:()=>l});var r=s(40991),a=s(55093);const t={icon:function(e,n){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z",fill:e}},{tag:"path",attrs:{d:"M172.2 828.1h679.6L512 239.9 172.2 828.1zM560 720a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm-16-304v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8z",fill:n}},{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z",fill:e}}]}},name:"warning",theme:"twotone"};var o=s(36462),i=function(e,n){return a.createElement(o.A,(0,r.A)({},e,{ref:n,icon:t}))};const l=a.forwardRef(i)}}]);
//# sourceMappingURL=3032.c206c44f.chunk.js.map