"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[20],{71020:(e,l,a)=>{a.r(l),a.d(l,{default:()=>K});var n,i,s=a(83468),t=a(16162),r=a(57857),o=a(25339),d=a(91412),u=a(71741),m=a(58736),c=a(40379),p=a(90214),g=a(24717),v=a(65080),k=a(82028),y=a(30217),S=a(82745),f=a(13279),b=a(45901),_=a.n(b),F=a(76998),A=a(77678),h=a(3606),T=a(23446);const K=e=>{var l;let{extraFetchKey:b="",...K}=e;const{t:x}=(0,A.Bd)(),{value:w,dispatchEvent:U}=(0,d.useWebComponentInfo)();let N;try{N=JSON.parse(w||"")}catch(X){N={open:!1,userEmail:""}}const{open:j,userEmail:M}=N,[I,L]=p.A.useModal(),C=(0,F.useRef)(null),P={superadmin:["superadmin","admin","user","monitor"],admin:["admin","user","monitor"]},[E,O]=(0,s.Tw)("initial-fetch"),V=(0,F.useDeferredValue)(E+b),$=(0,s.CX)(),D=null===$||void 0===$?void 0:$.supports("sudo-session-enabled"),{isTOTPSupported:B,isLoading:R}=(0,t.F4)(),{user:q,loggedInUser:Q}=(0,h.useLazyLoadQuery)(void 0!==n?n:n=a(8643),{email:M,isNotSupportSudoSessionEnabled:!D,isNotSupportTotp:!B,loggedInUserEmail:null!==(l=null===$||void 0===$?void 0:$.email)&&void 0!==l?l:""},{fetchKey:V,fetchPolicy:"network-only"}),[z,G]=(0,h.useMutation)(void 0!==i?i:i=a(58638)),W=(0,r.E)({mutationFn:e=>$.remove_totp(e)}),[Y,{toggle:J}]=(0,c.A)(!1);return(0,T.jsxs)(o.A,{open:j,onCancel:()=>{U("cancel",null)},centered:!0,title:x("credential.ModifyUserDetail"),destroyOnClose:!0,onOk:()=>{var e;null===(e=C.current)||void 0===e||e.validateFields().then((async e=>{let l={...e};var a,n;(delete l.email,l=_().omit(l,["password_confirm"]),l=_().omitBy(l,(e=>void 0===e||""===e)),D)||(null===(a=l)||void 0===a||delete a.sudo_session_enabled);B||(null===(n=l)||void 0===n||delete n.totp_activated);z({variables:{email:(null===e||void 0===e?void 0:e.email)||"",props:l,isNotSupportSudoSessionEnabled:!D,isNotSupportTotp:!B},onCompleted(e){var l,a;null!==e&&void 0!==e&&null!==(l=e.modify_user)&&void 0!==l&&l.ok?g.Ay.success(x("environment.SuccessfullyModified")):g.Ay.error(null===e||void 0===e||null===(a=e.modify_user)||void 0===a?void 0:a.msg);U("ok",null)},onError(e){g.Ay.error(null===e||void 0===e?void 0:e.message)}})}))},confirmLoading:G,...K,children:[(0,T.jsxs)(v.A,{ref:C,preserve:!1,labelCol:{span:10},wrapperCol:{span:20},validateTrigger:["onChange","onBlur"],style:{marginBottom:40,marginTop:20},initialValues:{...q},children:[(0,T.jsx)(v.A.Item,{name:"email",label:x("credential.UserID"),children:(0,T.jsx)(k.A,{disabled:!0})}),(0,T.jsx)(v.A.Item,{name:"username",label:x("credential.UserName"),children:(0,T.jsx)(k.A,{placeholder:x("maxLength.64chars")})}),(0,T.jsx)(v.A.Item,{name:"full_name",label:x("credential.FullName"),children:(0,T.jsx)(k.A,{placeholder:x("maxLength.64chars")})}),(0,T.jsx)(v.A.Item,{name:"password",label:x("general.NewPassword"),rules:[{pattern:/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,message:x("webui.menu.InvalidPasswordMessage")}],children:(0,T.jsx)(k.A.Password,{})}),(0,T.jsx)(v.A.Item,{name:"password_confirm",dependencies:["password"],label:x("webui.menu.NewPasswordAgain"),rules:[e=>{let{getFieldValue:l}=e;return{validator:(e,a)=>!a&&l("password")?Promise.reject(new Error(x("webui.menu.PleaseConfirmYourPassword"))):a&&l("password")!==a?Promise.reject(new Error(x("environment.PasswordsDoNotMatch"))):Promise.resolve()}}],children:(0,T.jsx)(k.A.Password,{})}),(0,T.jsx)(v.A.Item,{name:"description",label:x("credential.Description"),children:(0,T.jsx)(k.A.TextArea,{placeholder:x("maxLength.500chars")})}),(0,T.jsx)(v.A.Item,{name:"status",label:x("credential.UserStatus"),children:(0,T.jsx)(y.A,{options:_().map({active:"Active",inactive:"Inactive","before-verification":"Before Verification",deleted:"Deleted"},((e,l)=>({value:l,label:e})))})}),!(null===q||void 0===q||!q.role)&&!(null===Q||void 0===Q||!Q.role)&&Q.role in P&&(0,T.jsx)(v.A.Item,{name:"role",label:x("credential.Role"),children:(0,T.jsx)(y.A,{options:_().map(P[Q.role],(e=>({value:e,label:e})))})}),(0,T.jsx)(v.A.Item,{name:"need_password_change",label:x("credential.DescRequirePasswordChange"),valuePropName:"checked",children:(0,T.jsx)(S.A,{})}),!!D&&(0,T.jsx)(v.A.Item,{name:"sudo_session_enabled",label:x("credential.EnableSudoSession"),valuePropName:"checked",children:(0,T.jsx)(S.A,{})}),!!B&&(0,T.jsx)(v.A.Item,{name:"totp_activated",label:x("webui.menu.TotpActivated"),valuePropName:"checked",extra:(null===q||void 0===q?void 0:q.email)!==(null===$||void 0===$?void 0:$.email)&&(0,T.jsx)(f.A.Text,{type:"secondary",style:{fontSize:12},children:x("credential.AdminCanOnlyRemoveTotp")}),children:(0,T.jsx)(S.A,{loading:R||W.isLoading,disabled:(null===q||void 0===q?void 0:q.email)!==(null===$||void 0===$?void 0:$.email)&&!(null!==q&&void 0!==q&&q.totp_activated),onChange:e=>{var l;e?J():null!==q&&void 0!==q&&q.totp_activated&&(null===(l=C.current)||void 0===l||l.setFieldValue("totp_activated",!0),I.confirm({title:x("totp.TurnOffTotp"),icon:(0,T.jsx)(m.A,{}),content:x("totp.ConfirmTotpRemovalBody"),okText:x("button.Yes"),okType:"danger",cancelText:x("button.No"),onOk(){W.mutate((null===q||void 0===q?void 0:q.email)||"",{onSuccess:()=>{var e;g.Ay.success(x("totp.RemoveTotpSetupCompleted")),O(),null===(e=C.current)||void 0===e||e.setFieldValue("totp_activated",!1)},onError:e=>{console.log(e)}})},onCancel(){var e;null===(e=C.current)||void 0===e||e.setFieldValue("totp_activated",!0)}}))}})})]}),!!B&&(0,T.jsx)(u.A,{userFrgmt:q,open:Y,onRequestClose:e=>{var l;e?O():null===(l=C.current)||void 0===l||l.setFieldValue("totp_activated",!1);J()}}),L]})}},58638:(e,l,a)=>{a.r(l),a.d(l,{default:()=>i});const n=function(){var e={defaultValue:null,kind:"LocalArgument",name:"email"},l={defaultValue:null,kind:"LocalArgument",name:"isNotSupportSudoSessionEnabled"},a={defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},n={defaultValue:null,kind:"LocalArgument",name:"props"},i=[{kind:"Variable",name:"email",variableName:"email"},{kind:"Variable",name:"props",variableName:"props"}],s={alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},k={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:[e,l,a,n],kind:"Fragment",metadata:null,name:"UserSettingModalMutation",selections:[{alias:null,args:i,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[s,t,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[r,o,d,u,m,c,p,g,v,k,y,S,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],storageKey:null}],type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,n,l,a],kind:"Operation",name:"UserSettingModalMutation",selections:[{alias:null,args:i,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[s,t,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[r,o,d,u,m,c,p,g,v,k,y,S],storageKey:null}],storageKey:null}]},params:{cacheID:"9b1a3e23ee391f117fee34e25b6fbf05",id:null,metadata:{},name:"UserSettingModalMutation",operationKind:"mutation",text:"mutation UserSettingModalMutation(\n  $email: String!\n  $props: ModifyUserInput!\n  $isNotSupportSudoSessionEnabled: Boolean!\n  $isNotSupportTotp: Boolean!\n) {\n  modify_user(email: $email, props: $props) {\n    ok\n    msg\n    user {\n      id\n      email\n      username\n      need_password_change\n      full_name\n      description\n      status\n      domain_name\n      role\n      groups {\n        id\n        name\n      }\n      sudo_session_enabled @skipOnClient(if: $isNotSupportSudoSessionEnabled)\n      totp_activated @skipOnClient(if: $isNotSupportTotp)\n      ...TOTPActivateModalFragment\n    }\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();n.hash="b7bb2083b30dea10ff3f89197e67e2cb";const i=n},8643:(e,l,a)=>{a.r(l),a.d(l,{default:()=>i});const n=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportSudoSessionEnabled"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},{defaultValue:null,kind:"LocalArgument",name:"loggedInUserEmail"}],l=[{kind:"Variable",name:"email",variableName:"email"}],a={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},m={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[u,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null},g=[{kind:"Variable",name:"email",variableName:"loggedInUserEmail"}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserSettingModalQuery",selections:[{alias:null,args:l,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[a,n,i,s,t,r,o,d,m,c,p,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null},{alias:"loggedInUser",args:g,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[d],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserSettingModalQuery",selections:[{alias:null,args:l,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[a,n,i,s,t,r,o,d,m,c,p,u],storageKey:null},{alias:"loggedInUser",args:g,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[d,u],storageKey:null}]},params:{cacheID:"55fb94209e66cec0a1a802ff12b18c64",id:null,metadata:{},name:"UserSettingModalQuery",operationKind:"query",text:"query UserSettingModalQuery(\n  $email: String\n  $isNotSupportSudoSessionEnabled: Boolean!\n  $isNotSupportTotp: Boolean!\n  $loggedInUserEmail: String\n) {\n  user(email: $email) {\n    email\n    username\n    need_password_change\n    full_name\n    description\n    status\n    domain_name\n    role\n    groups {\n      id\n      name\n    }\n    sudo_session_enabled @skipOnClient(if: $isNotSupportSudoSessionEnabled)\n    totp_activated @skipOnClient(if: $isNotSupportTotp)\n    ...TOTPActivateModalFragment\n    id\n  }\n  loggedInUser: user(email: $loggedInUserEmail) {\n    role\n    id\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();n.hash="139401e06fdc036b1235475a82fd4397";const i=n}}]);
//# sourceMappingURL=20.cbdc4c3f.chunk.js.map