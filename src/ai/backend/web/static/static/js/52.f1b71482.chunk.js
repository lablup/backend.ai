"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[52],{23623:(e,s,n)=>{n.d(s,{A:()=>r});var t=n(76998);const l=(e,s,n)=>{const[l,r]=(0,t.useState)(e());return(0,t.useEffect)((()=>{n&&r(e())}),[n]),function(e,s){const n=(0,t.useRef)();(0,t.useEffect)((()=>{n.current=e})),(0,t.useEffect)((()=>{if(null!==s){let e=setInterval((function(){var e;null===(e=n.current)||void 0===e||e.call(n)}),s);return()=>clearInterval(e)}}),[s])}((()=>{const s=e();s!==l&&r(s)}),s),l},r=e=>{let{callback:s,delay:n,triggerKey:t}=e;return l(s,n,t)}},42989:(e,s,n)=>{n.d(s,{A:()=>d});var t=n(66464),l=n(60708),r=n(14455),a=n.n(r),o=n(45901),i=n.n(o),c=(n(76998),n(23446));const d=e=>{let{value:s,onChange:n,localFormat:r,...o}=e;const[,d]=(0,t.A)({value:s,onChange:n});return(0,c.jsx)(l.A,{value:s?a()(s):void 0,onChange:e=>{var s,n,t;i().isArray(e)&&(e=e[0]);const l=r?null===(s=e)||void 0===s?void 0:s.format():null===(n=e)||void 0===n||null===(t=n.tz())||void 0===t?void 0:t.toISOString();d(l)},...o})}},26165:(e,s,n)=>{n.r(s),n.d(s,{default:()=>l});const t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"},l=t},90052:(e,s,n)=>{n.r(s),n.d(s,{default:()=>Ne});var t=n(25344),l=n(82156),r=n(50840),a=n(6932),o=n(29475),i=n(45901),c=n.n(i),d=n(76998),u=n(23446);const m=e=>{let{status:s="default",extraButtonTitle:n,onClickExtraButton:i,extra:d,style:m,...h}=e;const{token:g}=r.A.useToken(),p=d||n&&(0,u.jsx)(a.Ay,{type:"link",icon:"error"===s?(0,u.jsx)(t.A,{twoToneColor:g.colorError}):"warning"===s?(0,u.jsx)(l.A,{twoToneColor:g.colorWarning}):void 0,onClick:i,children:n})||void 0;return(0,u.jsx)(o.A,{style:c().extend(m,{borderColor:"error"===s?g.colorError:"warning"===s?g.colorWarning:"success"===s?g.colorSuccess:null===m||void 0===m?void 0:m.borderColor}),extra:p,...h})};var h=n(23623),g=n(42989),p=n(5621),x=n(29871),v=n(94080),A=n(5336),j=n(65080),y=n(82028),b=n(77678);const f=e=>{let{formItemProps:s,...n}=e;const t=(0,d.useRef)(null),{t:l}=(0,b.Bd)(),r=j.A.useFormInstance();return(0,u.jsx)(j.A.List,{...n,children:(e,o)=>{let{add:i,remove:d}=o;return(0,u.jsxs)(x.A,{direction:"column",gap:"xs",align:"stretch",children:[e.map(((a,o)=>{let{key:i,name:m,...h}=a;return(0,u.jsxs)(x.A,{direction:"row",align:"baseline",gap:"xs",children:[(0,u.jsx)(j.A.Item,{...h,style:{marginBottom:0,flex:1},name:[m,"variable"],rules:[{required:!0,message:l("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:l("session.launcher.EnvironmentVariableNamePatternError")},e=>{let{getFieldValue:s}=e;return{validator(e,t){const r=c().map(s(n.name),(e=>null===e||void 0===e?void 0:e.variable));return!c().isEmpty(t)&&r.length>0&&c().filter(r,(e=>e===t)).length>1?Promise.reject(l("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}],...s,children:(0,u.jsx)(y.A,{ref:o===e.length-1?t:null,placeholder:"Variable",onChange:()=>{const s=e.map(((e,s)=>[n.name,s,"variable"]));r.validateFields(s)}})}),(0,u.jsx)(j.A.Item,{...h,name:[m,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:l("session.launcher.EnvironmentVariableValueRequired")}],validateTrigger:["onChange","onBlur"],children:(0,u.jsx)(y.A,{placeholder:"Value"})}),(0,u.jsx)(v.A,{onClick:()=>d(m)})]},i)})),(0,u.jsx)(j.A.Item,{noStyle:!0,children:(0,u.jsx)(a.Ay,{type:"dashed",onClick:()=>{i(),setTimeout((()=>{t.current&&t.current.focus()}),0)},icon:(0,u.jsx)(A.A,{}),block:!0,children:l("session.launcher.AddEnvironmentVariable")})})]})}})};var F=n(85676),w=n(35051),k=n(16788),C=n(83468),V=n(30217),S=n(48713);const T=e=>{let{value:s,...n}=e;const t=parseInt(s),l=t>=1024&&t<=65535;return(0,u.jsx)(S.A,{color:l?void 0:"red",...n})},I=e=>{let{...s}=e;const{t:n}=(0,b.Bd)(),t=(0,C.CX)();return(0,u.jsx)(j.A.Item,{label:n("session.launcher.PreOpenPortTitle"),name:"ports",tooltip:(0,u.jsx)(b.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:n("session.launcher.PreOpenPortRangeGuide"),rules:[{max:t._config.maxCountForPreopenPorts,type:"array",message:n("session.launcher.PreOpenPortMaxCountLimit",{count:t._config.maxCountForPreopenPorts})},e=>{let{getFieldValue:s}=e;return{validator:(e,s)=>c().every(s,(e=>{const s=parseInt(e);return s>=1024&&s<=65535}))?Promise.resolve():Promise.reject(new Error(n("session.launcher.PreOpenPortRange")))}}],...s,children:(0,u.jsx)(V.A,{mode:"tags",tagRender:e=>(0,u.jsx)(T,{closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label}),style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})};var P=n(97953),E=n(8469);const N=(e,s)=>{let{image:n,style:t={}}=e;n=n||"";const[,{getImageAliasName:l,getBaseVersion:r,getBaseImage:a,getArchitecture:o,tagAlias:i}]=(0,C.Gj)();return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(p.A,{values:[{label:i(l(n)),color:"blue"},{label:r(n),color:"green"}]}),(0,u.jsx)(S.A,{color:"green",children:i(a(n))}),(0,u.jsx)(S.A,{color:"green",children:i(o(n))})]})},M=d.memo(N),_=e=>{let{...s}=e;const{t:n}=(0,b.Bd)();return(0,u.jsx)(j.A.Item,{label:n("session.launcher.SessionName"),name:"sessionName",rules:[{min:4,message:n("session.Validation.SessionNameTooShort")},{max:64,message:n("session.Validation.SessionNameTooLong64")},{validator:(e,s)=>c().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/^[\w.-]*$/.test(s)?!/\w$/.test(s)&&s.length>=4?Promise.reject(n("session.Validation.SessionNameShouldEndWith")):Promise.resolve():Promise.reject(n("session.Validation.SessionNameInvalidCharacter")):Promise.reject(n("session.Validation.SessionNameShouldStartWith"))}],...s,children:(0,u.jsx)(y.A,{allowClear:!0,autoComplete:"off"})})};var D,O=n(30032),z=n(57857),B=n(91412),R=n(81638),K=n(3606);const L=e=>{let{vFolderFrgmt:s=null,permission:t}=e;const l=(0,K.useFragment)(void 0!==D?D:D=n(26165),s),r=c().chain({r:"green",w:"blue",d:"red"}).map(((e,s)=>{if(((e,s)=>!(null===e||void 0===e||!e.includes(s))||!(null===e||void 0===e||!e.includes("w")||"r"!==s))((null===l||void 0===l?void 0:l.permission)||t,s))return{label:s.toUpperCase(),color:e}})).compact().value();return(0,u.jsx)(p.A,{values:r})};var W=n(71155),q=n(8925),U=n(93792),G=n(66464),H=n(13279),J=n(20307),Z=n(14862),Q=n(14455),$=n.n(Q);const X=e=>{let{filter:s,showAliasInput:n=!1,selectedRowKeys:t=[],onChangeSelectedRowKeys:l,aliasBasePath:r="/home/work/",aliasMap:o,onChangeAliasMap:i,rowKey:m="name",...h}=e;const g=d.useMemo((()=>e=>e&&e[m]),[m]),[p,v]=(0,G.A)({value:t,onChange:l},{defaultValue:[]}),[A,f]=(0,G.A)({value:o,onChange:i},{defaultValue:{}}),[F]=j.A.useForm();(0,d.useEffect)((()=>{A&&(F.setFieldsValue(c().mapValues(A,(e=>e.startsWith(r)?e.slice(r.length):e))),F.validateFields())}),[A,F,r]);const{t:w}=(0,b.Bd)(),k=(0,O.QE)(),V=(0,C.hd)(),[S,T]=(0,C.Tw)("first"),[I,P]=(0,d.useTransition)(),{data:E}=(0,z.n)({queryKey:["VFolderSelectQuery",S,V.id],queryFn:()=>k({method:"GET",url:"/folders?group_id=".concat(V.id)}),staleTime:0}),[N,M]=(0,d.useState)(""),_=c().chain(E).filter((e=>!s||s(e))).filter((e=>!!p.includes(g(e))||(!N||e.name.includes(N)))).value(),D=e=>{null===e||void 0===e||e.preventDefault(),F.validateFields().then((e=>{})).catch((()=>{})).finally((()=>{f(c().mapValues(c().pickBy(F.getFieldsValue(),(e=>!!e)),((e,s)=>K(s,e))))}))},K=(e,s)=>c().isEmpty(s)?"".concat(r).concat(e):null!==s&&void 0!==s&&s.startsWith("/")?s:"".concat(r).concat(s),Q=(0,B.useShadowRoot)(),X=[{title:(0,u.jsxs)(x.A,{direction:"row",gap:"xxs",children:[(0,u.jsx)(H.A.Text,{children:w("data.folders.Name")}),n&&(0,u.jsx)(u.Fragment,{children:(0,u.jsxs)(H.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",w("session.launcher.FolderAlias")," ",(0,u.jsx)(J.A,{title:(0,u.jsx)(b.x6,{i18nKey:"session.launcher.DescFolderAlias"}),getPopupContainer:()=>Q,children:(0,u.jsx)(W.A,{})}),")"]})})]}),dataIndex:"name",sorter:(e,s)=>e.name.localeCompare(s.name),render:(e,s)=>{const t=p.includes(g(s));return(0,u.jsxs)(x.A,{direction:"column",align:"stretch",gap:"xxs",style:n&&t?{display:"inline-flex",height:70,width:"100%"}:{maxWidth:200},children:[(0,u.jsx)(R.A,{keyword:N,children:e}),n&&t&&(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e[g(s)]!==n[g(s)],children:()=>{const e=c()(p).reduce(((e,s)=>(e[s]=(null===A||void 0===A?void 0:A[s])||K(s,void 0),e)),{});return(0,u.jsx)(j.A.Item,{name:g(s),rules:[{type:"string",pattern:/^[a-zA-Z0-9_/-]*$/,message:w("session.launcher.FolderAliasInvalid")},{type:"string",validator:async(n,t)=>t&&c().some(e,((e,n)=>n!==g(s)&&e===K(g(s),t)))?Promise.reject(w("session.launcher.FolderAliasOverlapping")):Promise.resolve()}],extra:K(s.name,F.getFieldValue(g(s))),children:(0,u.jsx)(y.A,{onClick:e=>{e.stopPropagation()},placeholder:w("session.launcher.FolderAlias"),onChange:D,allowClear:!0})})}})]})}},{title:w("data.UsageMode"),dataIndex:"usage_mode",sorter:(e,s)=>e.usage_mode.localeCompare(s.usage_mode)},{title:w("data.Host"),dataIndex:"host"},{title:w("data.Type"),dataIndex:"type",sorter:(e,s)=>e.type.localeCompare(s.type),render:(e,s)=>(0,u.jsxs)(x.A,{direction:"column",children:["user"===s.type?(0,u.jsx)(q.A,{title:"User"}):(0,u.jsx)("div",{children:"Group"}),"group"===s.type&&"(".concat(s.group_name,")")]})},{title:w("data.Permission"),dataIndex:"permission",sorter:(e,s)=>e.permission.localeCompare(s.permission),render:(e,s)=>(0,u.jsx)(L,{permission:s.permission})},{title:w("data.Created"),dataIndex:"created_at",sorter:(e,s)=>e.created_at.localeCompare(s.created_at),render:(e,s)=>$()(e).format("L")}];return(0,u.jsxs)(x.A,{direction:"column",align:"stretch",gap:"xs",children:[(0,u.jsxs)(x.A,{direction:"row",gap:"xs",justify:"between",children:[(0,u.jsx)(y.A,{value:N,onChange:e=>M(e.target.value),allowClear:!0,placeholder:w("data.SearchByName")}),(0,u.jsx)(a.Ay,{loading:I,icon:(0,u.jsx)(U.A,{}),onClick:()=>{P((()=>{T()}))}})]}),(0,u.jsx)(j.A,{form:F,children:(0,u.jsx)(Z.A,{scroll:{x:"max-content"},rowKey:g,rowSelection:{selectedRowKeys:p,onChange:e=>{v(e),D()}},showSorterTooltip:!1,columns:X,dataSource:_,onRow:(e,s)=>({onClick:s=>{var n;const t=s.target;null!==t&&void 0!==t&&null!==(n=t.classList)&&void 0!==n&&n.contains("ant-table-selection-column")&&(s.stopPropagation(),p.includes(g(e))?v(p.filter((s=>s!==g(e)))):v([...p,g(e)]))}}),...h})})]})},Y=e=>{let{filter:s,...n}=e;const t=j.A.useFormInstance(),{t:l}=(0,b.Bd)();return j.A.useWatch("vfoldersAliasMap",t),(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(j.A.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator(e,s){const n=c().chain(t.getFieldValue("mounts")).reduce(((e,n)=>(e[n]=s[n]||"/home/work/"+n,e)),{}).values().value();return c().uniq(n).length!==n.length?Promise.reject(l("session.launcher.FolderAliasOverlapping")):Promise.resolve()}}],children:(0,u.jsx)(y.A,{})}),(0,u.jsx)(j.A.Item,{name:"mounts",...n,valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,u.jsx)(X,{rowKey:"name",showAliasInput:!0,aliasMap:t.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:e=>{t.setFieldValue("vfoldersAliasMap",e),t.validateFields(["vfoldersAliasMap"])},pagination:!1,filter:s})})]})};var ee=n(21454),se=n(90660);var ne=n(21186),te=n(15618),le=n(78474),re=n(42290),ae=n(40718),oe=n(76108),ie=n(12620),ce=n(33554),de=n(41814),ue=n(17480),me=n(87627),he=n(82745),ge=n(7518),pe=n(9788),xe=n(91409),ve=n(22307),Ae=n(41856),je=n(59065),ye=n(67970),be=n(34515),fe=n(81365),Fe=n(6592),we=n(52276),ke=n(44442),Ce=n(58346);const Ve={sessionType:"interactive",allocationPreset:"auto-preset",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0},envvars:[],...P.jh},Se=(0,Ce.withDefault)(Ce.NumberParam,0),Te=(0,Ce.withDefault)(Ce.JsonParam,Ve),Ie=e=>{let{form:s,containerCount:n=1}=e;return(0,u.jsxs)(u.Fragment,{children:[c().map(c().omit(s.getFieldsValue().resource,"shmem","accelerator","acceleratorType"),((e,t)=>{var l,r;return(0,u.jsx)(E.Ay,{type:t,value:"mem"===t?((null===(l=(0,O.Js)(e,"b"))||void 0===l?void 0:l.number)||0)*n+"":c().toNumber(e)*n+"",opts:{shmem:s.getFieldValue("resource").shmem?((null===(r=(0,O.Js)(s.getFieldValue("resource").shmem,"b"))||void 0===r?void 0:r.number)||0)*n:void 0}},t)})),c().isNumber(s.getFieldValue(["resource","accelerator"]))&&s.getFieldValue(["resource","acceleratorType"])&&(0,u.jsx)(E.Ay,{type:s.getFieldValue(["resource","acceleratorType"]),value:c().toString(s.getFieldValue(["resource","accelerator"])*n)})]})},Pe=()=>{let e="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<8;n++)e+=s.charAt(Math.floor(62*Math.random()));return e+"-session"},Ee=()=>{let e=Math.floor(52*Math.random()*52*52);let s="";for(let t=0;t<3;t++)s+=(n=e%52)<26?String.fromCharCode(65+n):String.fromCharCode(97+n-26),e=Math.floor(e/52);var n;return s},Ne=()=>{var e,s,n,t,l,i,v,A,E,N,D,z,B;const R=ie.A.useApp();let K="normal";const L=(0,ke.vc)(k.i7),[q,U]=(0,d.useState)(!1),[{step:G,formValues:Q,redirectTo:X},Ne]=(0,Ce.useQueryParams)({step:Se,formValues:Te,redirectTo:Ce.StringParam}),{isDarkMode:Me}=(0,se.e)(),_e=(0,fe.Zp)(),De=(0,C.f0)(),Oe=(0,C.CX)(),ze=(0,C.hd)(),{upsertNotification:Be}=(0,ee.js)(),{run:Re}=(0,oe.A)((()=>{Ne({formValues:c().omit(Ue.getFieldsValue(),["environments.image"],["environments.customizedTag"])},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),Ke=e=>{Ne({step:e},"pushIn")},{token:Le}=r.A.useToken(),{t:We}=(0,b.Bd)(),qe=ce.Ay.useBreakpoint(),[Ue]=j.A.useForm();(0,d.useEffect)((()=>{JSON.stringify(Ve)!==JSON.stringify(Q)&&(Ue.setFieldsValue(Q),Ue.validateFields().catch((e=>{})))}),[]),(0,d.useEffect)((()=>{var e;null===(e=L.current)||void 0===e||e.scrollTo(0,0)}),[G]);const Ge=j.A.useWatch("sessionType",{form:Ue,preserve:!0})||Ue.getFieldValue("sessionType")||Q.sessionType,He=c().filter([{title:We("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(We("session.launcher.Environments")," & ").concat(We("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==Ge&&{title:We("webui.menu.Data&Storage"),key:"storage"},{title:We("session.launcher.Network"),key:"network"},{title:We("session.launcher.ConfirmAndLaunch"),icon:(0,u.jsx)(ne.A,{}),key:"review"}],(e=>!!e)),Je=null===(e=He[G])||void 0===e?void 0:e.key,Ze=c().some(Ue.getFieldsError(),(e=>e.errors.length>0)),Qe=()=>{Ue.validateFields().catch((e=>{})).finally((()=>{Ke(He.length-1)}))};return(0,u.jsxs)(x.A,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,u.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),X&&(0,u.jsx)(de.A,{items:[{title:We("webui.menu.Sessions"),onClick:e=>{e.preventDefault(),De(X)},href:X},{title:We("session.launcher.StartNewSession")}]}),(0,u.jsxs)(x.A,{direction:"row",gap:"md",align:"start",children:[(0,u.jsx)(x.A,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:(0,u.jsx)(j.A.Provider,{onFormChange:(e,s)=>{Re()},children:(0,u.jsx)(j.A,{form:Ue,layout:"vertical",requiredMark:"optional",initialValues:Ve,children:(0,u.jsxs)(x.A,{direction:"column",align:"stretch",gap:"md",children:[(0,u.jsxs)(o.A,{title:We("session.launcher.SessionType"),style:{display:"sessionType"===Je?"block":"none"},children:[(0,u.jsx)(j.A.Item,{name:"sessionType",children:(0,u.jsx)(ue.Ay.Group,{className:"session-type-radio-group",options:[{label:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(H.A.Text,{code:!0,children:We("session.launcher.InteractiveMode")})," ",(0,u.jsx)(H.A.Text,{type:"secondary",children:We("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(H.A.Text,{code:!0,children:We("session.launcher.BatchMode")})," ",(0,u.jsx)(H.A.Text,{type:"secondary",children:We("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,u.jsx)(_,{})]}),"batch"===Ge&&(0,u.jsxs)(o.A,{title:We("session.launcher.BatchModeConfig"),style:{display:"sessionType"===Je?"block":"none"},children:[(0,u.jsx)(j.A.Item,{label:We("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,u.jsx)(y.A.TextArea,{autoSize:!0})}),(0,u.jsx)(j.A.Item,{label:We("session.launcher.SessionStartTime"),extra:(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>e.batch.scheduleDate!==s.batch.scheduleDate,children:()=>{const e=Ue.getFieldValue(["batch","scheduleDate"]);return(0,u.jsx)(h.A,{delay:1e3,callback:()=>{const e=Ue.getFieldValue(["batch","scheduleDate"]);return e?$()(e).isBefore($()())?void(0===Ue.getFieldError(["batch","scheduleDate"]).length&&Ue.validateFields([["batch","scheduleDate"]])):$()(e).fromNow():void 0},triggerKey:e||"none"})}}),children:(0,u.jsxs)(x.A,{direction:"row",gap:"xs",children:[(0,u.jsx)(j.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,u.jsx)(me.A,{onChange:e=>{e.target.checked&&c().isEmpty(Ue.getFieldValue(["batch","scheduleDate"]))?Ue.setFieldValue(["batch","scheduleDate"],$()().add(2,"minutes").toISOString()):!1===e.target.checked&&Ue.setFieldValue(["batch","scheduleDate"],void 0),Ue.validateFields([["batch","scheduleDate"]])},children:We("session.launcher.Enable")})}),(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.batch)||void 0===n?void 0:n.enabled)!==(null===(t=s.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const s=!0!==(null===(e=Ue.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,u.jsx)(u.Fragment,{children:(0,u.jsx)(j.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,s)=>s&&$()(s).isBefore($()())?Promise.reject(We("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,u.jsx)(g.A,{disabled:s,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore($()().startOf("day"))})})})}})]})})]}),"inference"===Ge&&(0,u.jsx)(o.A,{title:"Inference Mode Configuration",children:(0,u.jsx)(j.A.Item,{name:["inference","vFolderName"],label:We("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,u.jsx)(V.A,{})})}),(0,u.jsxs)(o.A,{title:We("session.launcher.Environments"),style:{display:"environment"===Je?"block":"none"},children:[(0,u.jsx)(be.tH,{fallbackRender:e=>(console.log(e),null),children:(0,u.jsx)(F.A,{})}),(0,u.jsx)(j.A.Item,{label:We("session.launcher.EnvironmentVariable"),children:(0,u.jsx)(f,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,u.jsx)(o.A,{title:We("session.launcher.ResourceAllocation"),style:{display:"environment"===Je?"block":"none"},children:(0,u.jsx)(P.Ay,{enableNumOfSessions:!0,enableResourcePresets:!0})}),(0,u.jsxs)(o.A,{title:We("session.launcher.HPCOptimization"),style:{display:"environment"===Je?"block":"none"},children:[(0,u.jsx)(j.A.Item,{noStyle:!0,children:(0,u.jsxs)(x.A,{direction:"row",gap:"sm",children:[(0,u.jsx)(H.A.Text,{children:We("session.launcher.SwitchOpenMPoptimization")}),(0,u.jsx)(j.A.Item,{label:We("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,u.jsx)(he.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e&&Ue.setFieldsValue(c().pick(Ve,["hpcOptimization"]))}})})]})}),(0,u.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.hpcOptimization)||void 0===n?void 0:n.autoEnabled)!==(null===(t=s.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=Ue.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,u.jsxs)(ge.A,{gutter:Le.marginMD,style:{display:e?"none":void 0,marginTop:Le.marginMD},children:[(0,u.jsx)(pe.A,{xs:24,sm:12,children:(0,u.jsx)(j.A.Item,{style:{flex:1},label:We("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,u.jsxs)(u.Fragment,{children:[We("session.launcher.OpenMPOptimization"),(0,u.jsx)(b.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,u.jsx)(xe.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,u.jsx)(pe.A,{xs:24,sm:12,children:(0,u.jsx)(j.A.Item,{style:{flex:1},label:We("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,u.jsxs)(u.Fragment,{children:[We("session.launcher.OpenMPOptimization"),(0,u.jsx)(b.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,u.jsx)(xe.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,u.jsx)(o.A,{title:We("webui.menu.Data&Storage"),style:{display:"storage"===Je?"block":"none"},children:(0,u.jsx)(Y,{filter:e=>"ready"===e.status})}),(0,u.jsx)(o.A,{title:We("session.launcher.Network"),style:{display:"network"===Je?"block":"none"},children:(0,u.jsx)(I,{})}),"review"===Je&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(m,{title:We("session.launcher.SessionType"),size:"small",status:Ue.getFieldError("sessionName").length>0||Ue.getFieldError(["batch","command"]).length>0||Ue.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:We("button.Edit"),onClickExtraButton:()=>{Ke(He.findIndex((e=>"sessionType"===e.key)))},children:(0,u.jsxs)(ve.A,{size:"small",column:1,children:[(0,u.jsx)(ve.A.Item,{label:We("session.SessionType"),children:Ue.getFieldValue("sessionType")}),!c().isEmpty(Ue.getFieldValue("sessionName"))&&(0,u.jsx)(ve.A.Item,{label:We("session.launcher.SessionName"),children:Ue.getFieldValue("sessionName")}),"batch"===Ge&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(ve.A.Item,{label:We("session.launcher.StartUpCommand"),children:Ue.getFieldValue(["batch","command"])?(0,u.jsx)(Fe.A,{style:Me?we.A:void 0,language:"shell",customStyle:{margin:0,width:"100%"},children:Ue.getFieldValue(["batch","command"])}):(0,u.jsx)(H.A.Text,{type:"secondary",children:We("general.None")})}),(0,u.jsx)(ve.A.Item,{label:We("session.launcher.ScheduleTimeSimple"),children:Ue.getFieldValue(["batch","scheduleDate"])?$()(Ue.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,u.jsx)(H.A.Text,{type:"secondary",children:We("general.None")})})]})]})}),(0,u.jsx)(m,{title:We("session.launcher.Environments"),size:"small",status:c().some(Ue.getFieldValue("envvars"),((e,s)=>Ue.getFieldError(["envvars",s,"variable"]).length>0||Ue.getFieldError(["envvars",s,"value"]).length>0))?"error":void 0,extraButtonTitle:We("button.Edit"),onClickExtraButton:()=>{Ke(He.findIndex((e=>"environment"===e.key)))},children:(0,u.jsxs)(ve.A,{size:"small",column:2,children:[(0,u.jsx)(ve.A.Item,{label:We("session.launcher.Project"),children:ze.name}),(0,u.jsx)(ve.A.Item,{label:We("general.ResourceGroup"),children:Ue.getFieldValue("resourceGroup")}),(0,u.jsx)(ve.A.Item,{label:We("general.Image"),span:2,children:(0,u.jsxs)(x.A,{direction:"row",gap:"xs",style:{flex:1},children:[(0,u.jsx)(w.A,{image:(null===(s=Ue.getFieldValue("environments"))||void 0===s?void 0:s.version)||(null===(n=Ue.getFieldValue("environments"))||void 0===n?void 0:n.manual)}),(0,u.jsx)(x.A,{direction:"row",children:null!==(t=Ue.getFieldValue("environments"))&&void 0!==t&&t.manual?(0,u.jsx)(H.A.Text,{copyable:!0,code:!0,children:"form.getFieldValue('environments')?.manual"}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(M,{image:null===(l=Ue.getFieldValue("environments"))||void 0===l?void 0:l.version}),null!==(i=Ue.getFieldValue("environments"))&&void 0!==i&&i.customizedTag?(0,u.jsx)(p.A,{values:[{label:"Customized",color:"cyan"},{label:null===(v=Ue.getFieldValue("environments"))||void 0===v?void 0:v.customizedTag,color:"cyan"}]}):null,(0,u.jsx)(H.A.Text,{copyable:{text:null===(A=Ue.getFieldValue("environments"))||void 0===A?void 0:A.version}})]})})]})}),(null===(E=Ue.getFieldValue("envvars"))||void 0===E?void 0:E.length)>0&&(0,u.jsx)(ve.A.Item,{label:We("session.launcher.EnvironmentVariable"),children:null!==(N=Ue.getFieldValue("envvars"))&&void 0!==N&&N.length?(0,u.jsx)(Fe.A,{style:Me?we.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:c().map(Ue.getFieldValue("envvars"),(e=>"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"'))).join("\n")}):(0,u.jsx)(H.A.Text,{type:"secondary",children:"-"})})]})}),(0,u.jsx)(m,{title:We("session.launcher.ResourceAllocation"),status:c().some(Ue.getFieldValue("resource"),((e,s)=>Ue.getFieldError(["resource",s]).length>0))||Ue.getFieldError(["num_of_sessions"]).length>0?"error":void 0,size:"small",extraButtonTitle:We("button.Edit"),onClickExtraButton:()=>{Ke(He.findIndex((e=>"environment"===e.key)))},children:(0,u.jsxs)(x.A,{direction:"column",align:"stretch",children:[c().some(null===(D=Ue.getFieldValue("resource"))||void 0===D?void 0:D.resource,((e,s)=>Ue.getFieldWarning(["resource",s]).length>0))&&(0,u.jsx)(Ae.A,{type:"warning",showIcon:!0,message:We("session.launcher.EnqueueComputeSessionWarning")}),(0,u.jsxs)(ve.A,{column:2,children:[(0,u.jsx)(ve.A.Item,{label:We("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,u.jsxs)(x.A,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===Ue.getFieldValue("allocationPreset")?"":(0,u.jsx)(S.A,{children:Ue.getFieldValue("allocationPreset")}),(0,u.jsx)(Ie,{form:Ue})]})}),(0,u.jsx)(ve.A.Item,{label:We("session.launcher.NumberOfContainer"),children:1===Ue.getFieldValue("cluster_size")?Ue.getFieldValue("num_of_sessions"):Ue.getFieldValue("cluster_size")}),(0,u.jsx)(ve.A.Item,{label:We("session.launcher.ClusterMode"),children:"single-node"===Ue.getFieldValue("cluster_mode")?We("session.launcher.SingleNode"):We("session.launcher.MultiNode")})]}),(0,u.jsx)(o.A,{size:"small",type:"inner",title:We("session.launcher.TotalAllocation"),children:(0,u.jsx)(x.A,{direction:"row",gap:"xxs",children:(0,u.jsx)(Ie,{form:Ue,containerCount:1===Ue.getFieldValue("cluster_size")?Ue.getFieldValue("num_of_sessions"):Ue.getFieldValue("cluster_size")})})})]})}),(0,u.jsx)(m,{title:We("webui.menu.Data&Storage"),size:"small",status:Ue.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:We("button.Edit"),onClickExtraButton:()=>{Ke(He.findIndex((e=>"storage"===e.key)))},children:(null===(z=Ue.getFieldValue("mounts"))||void 0===z?void 0:z.length)>0?(0,u.jsx)(Z.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:We("data.folders.Name")},{dataIndex:"alias",title:We("session.launcher.FolderAlias"),render:(e,s)=>c().isEmpty(e)?(0,u.jsx)(H.A.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(s.name)}):e}],dataSource:c().map(Ue.getFieldValue("mounts"),(e=>{var s;return{name:e,alias:null===(s=Ue.getFieldValue("vfoldersAliasMap"))||void 0===s?void 0:s[e]}}))}):(0,u.jsx)(Ae.A,{type:"warning",showIcon:!0,message:We("session.launcher.NoFolderMounted")})}),(0,u.jsx)(m,{title:"Network",size:"small",status:Ue.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:We("button.Edit"),onClickExtraButton:()=>{Ke(He.findIndex((e=>"network"===e.key)))},children:(0,u.jsx)(ve.A,{size:"small",children:(0,u.jsx)(ve.A.Item,{label:We("session.launcher.PreOpenPortTitle"),children:(0,u.jsxs)(x.A,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[c().sortBy(Ue.getFieldValue("ports"),(e=>parseInt(e))).map((e=>(0,u.jsx)(T,{value:e,style:{margin:0},children:e}))),c().isArray(Ue.getFieldValue("ports"))&&0!==(null===(B=Ue.getFieldValue("ports"))||void 0===B?void 0:B.length)?null:(0,u.jsx)(H.A.Text,{type:"secondary",children:We("general.None")})]})})})})]}),(0,u.jsxs)(x.A,{direction:"row",justify:"between",children:[(0,u.jsx)(x.A,{gap:"sm",children:(0,u.jsx)(je.A,{title:We("button.Reset"),description:We("session.launcher.ResetFormConfirm"),onConfirm:()=>{Ue.resetFields(),_e("/session/start")},icon:(0,u.jsx)(W.A,{style:{color:Le.colorError}}),okText:We("button.Reset"),okButtonProps:{danger:!0},children:(0,u.jsx)(a.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:We("button.Reset")})})}),(0,u.jsxs)(x.A,{direction:"row",gap:"sm",children:[G>0&&(0,u.jsx)(a.Ay,{onClick:()=>{Ke(G-1)},icon:(0,u.jsx)(te.A,{}),disabled:q,children:We("button.Previous")}),G===He.length-1?(0,u.jsx)(J.A,{title:Ze?We("session.launcher.PleaseCompleteForm"):void 0,children:(0,u.jsx)(a.Ay,{type:"primary",icon:(0,u.jsx)(le.A,{}),disabled:Ze,onClick:()=>{U(!0),Ue.validateFields().then((async e=>{if(c().isEmpty(e.mounts)||0===e.mounts.length){if(!await new Promise((e=>{R.modal.confirm({title:We("session.launcher.NoFolderMounted"),content:(0,u.jsxs)(u.Fragment,{children:[We("session.launcher.HomeDirectoryDeletionDialog"),(0,u.jsx)("br",{}),(0,u.jsx)("br",{}),We("session.launcher.LaunchConfirmationDialog"),(0,u.jsx)("br",{}),(0,u.jsx)("br",{}),We("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:We("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const s=e.environments.manual||e.environments.version;let[n,t]=s?s.split("@"):["",""];const l=c().isEmpty(e.sessionName)?Pe():e.sessionName,r={kernelName:n,architecture:t,sessionName:l,config:{type:e.sessionType,..."batch"===e.sessionType?{startsAt:e.batch.enabled?e.batch.scheduleDate:void 0,startupCommand:e.batch.command}:{},group_name:ze.name,domain:Oe._config.domainName,scaling_group:e.resourceGroup,cluster_mode:e.cluster_mode,cluster_size:e.cluster_size,maxWaitSeconds:15,cpu:e.resource.cpu,mem:e.resource.mem,shmem:(0,O.Mh)(e.resource.mem,"4g")>0&&(0,O.Mh)(e.resource.shmem,"1g")<0?"1g":e.resource.shmem,...e.resource.accelerator>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0,mounts:e.mounts,mount_map:e.vfoldersAliasMap,env:{...c().fromPairs(e.envvars.map((e=>[e.variable,e.value]))),...c().omit(e.hpcOptimization,"autoEnabled")},preopen_ports:c().map(e.ports,(e=>parseInt(e)))}},a=c().map(c().range(e.num_of_sessions||1),(s=>{const n=(e.num_of_sessions||1)>1?"".concat(r.sessionName,"-").concat(Ee(),"-").concat(s):r.sessionName;return Oe.createIfNotExists(r.kernelName,n,r.config,2e4,r.architecture).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(We("session.launcher.SessionAlreadyExists"));return e})).catch((e=>{throw console.log(e),e}))}));De(X||"/job"),Be({key:"session-launcher:"+l,backgroundTask:{promise:Promise.all(a),status:"pending",statusDescriptions:{pending:We("session.PreparingSession"),resolved:We("eduapi.ComputeSessionPrepared")}},duration:0,message:We("general.Session")+": "+l,open:!0}),await Promise.all(a).then((s=>{let[n]=s;if(1===e.num_of_sessions&&"batch"!==e.sessionType){const e=n;let s;s="kernelId"in e?{"session-name":e.kernelId,"access-key":"",mode:K}:{"session-uuid":e.sessionId,"session-name":e.sessionName,"access-key":"",mode:K};const t=e.servicePorts;!0===Array.isArray(t)?s["app-services"]=t.map((e=>e.name)):s["app-services"]=[],t.length>0&&globalThis.appLauncher.showLauncher(s)}})).catch((()=>{}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{U(!1)}))},loading:q,children:We("session.launcher.Launch")})}):(0,u.jsxs)(a.Ay,{type:"primary",ghost:!0,onClick:()=>{Ke(G+1)},children:[We("button.Next")," ",(0,u.jsx)(re.A,{})]}),G!==He.length-1&&(0,u.jsxs)(a.Ay,{onClick:Qe,children:[We("session.launcher.SkipToConfirmAndLaunch"),(0,u.jsx)(ae.A,{})]})]})]})]})})})}),qe.lg&&(0,u.jsx)(x.A,{style:{position:"sticky",top:80},children:(0,u.jsx)(ye.A,{size:"small",direction:"vertical",current:G,onChange:e=>{e===He.length-1?Qe():Ke(e)},items:c().map(He,((e,s)=>({...e,status:s===G?"process":"wait"})))})})]})]})}}}]);
//# sourceMappingURL=52.f1b71482.chunk.js.map