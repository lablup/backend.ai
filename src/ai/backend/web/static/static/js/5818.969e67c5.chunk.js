"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[5818,8463],{32461:(e,n,l)=>{l.d(n,{Ay:()=>h,z7:()=>p});var a=l(89130),i=l(67318),r=l(4342),o=l(23702),t=l(67378),s=l(60822),d=l(89608),u=l.n(d),m=l(43373),c=l(56762),v=l(73689);const g=[/AUTH/i,/ACCESS/i,/SECRET/i,/_KEY/i,/PASSWORD/i,/PASSWD/i,/PWD/i,/TOKEN/i,/PRIVATE/i,/CREDENTIAL/i,/JWT/i,/KEYPAIR/i,/CERTIFICATE/i,/SSH/i,/ENCRYPT/i,/SIGNATURE/i,/SALT/i,/PIN/i,/PASSPHRASE/i,/OAUTH/i];function p(e){return u().map(e,(e=>{return e&&(n=e.variable,g.some((e=>e.test(n))))?{...e,value:""}:e;var n}))}const h=e=>{let{formItemProps:n,...l}=e;const d=(0,m.useRef)(null),{t:g}=(0,c.Bd)(),p=o.A.useFormInstance();return(0,v.jsx)(o.A.List,{...l,children:(e,m)=>{let{add:c,remove:h}=m;return(0,v.jsxs)(a.A,{direction:"column",gap:"xs",align:"stretch",children:[e.map(((r,s)=>{let{key:m,name:c,...y}=r;return(0,v.jsxs)(a.A,{direction:"row",align:"baseline",gap:"xs",children:[(0,v.jsx)(o.A.Item,{...y,style:{marginBottom:0,flex:1},name:[c,"variable"],rules:[{required:!0,message:g("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:g("session.launcher.EnvironmentVariableNamePatternError")},e=>{let{getFieldValue:n}=e;return{validator(e,a){const i=u().map(n(l.name),(e=>null===e||void 0===e?void 0:e.variable));return!u().isEmpty(a)&&i.length>0&&u().filter(i,(e=>e===a)).length>1?Promise.reject(g("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}],...n,children:(0,v.jsx)(t.A,{ref:s===e.length-1?d:null,placeholder:"Variable",onChange:()=>{const n=e.map(((e,n)=>[l.name,n,"variable"]));p.validateFields(n)}})}),(0,v.jsx)(o.A.Item,{...y,name:[c,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:g("session.launcher.EnvironmentVariableValueRequired")}],validateTrigger:["onChange","onBlur"],children:(0,v.jsx)(t.A,{placeholder:"Value"})}),(0,v.jsx)(i.A,{onClick:()=>h(c)})]},m)})),(0,v.jsx)(o.A.Item,{noStyle:!0,children:(0,v.jsx)(s.Ay,{type:"dashed",onClick:()=>{c(),setTimeout((()=>{d.current&&d.current.focus()}),0)},icon:(0,v.jsx)(r.A,{}),block:!0,children:g("session.launcher.AddEnvironmentVariable")})})]})}})}},18463:(e,n,l)=>{l.r(n),l.d(n,{default:()=>s,useFolderExplorerOpener:()=>d});var a=l(43373),i=l(18150),r=l(12121),o=l(73689);const t=a.lazy((()=>Promise.all([l.e(2963),l.e(4639)]).then(l.bind(l,44639)))),s=()=>{const[e,n]=(0,r.useQueryParam)("folder",r.StringParam),l=null===e||void 0===e?void 0:e.replaceAll("-","");return(0,o.jsx)(t,{vfolderID:l||"",open:!!l,onRequestClose:()=>{n(null,"replaceIn")},destroyOnClose:!0})},d=()=>{const[,e]=(0,r.useQueryParam)("folder",r.StringParam),n=(0,i.zy)();return{open:n=>{e(n)},generateFolderPath:e=>{const l=new URLSearchParams(n.search);return l.set("folder",e),{pathname:n.pathname,search:l.toString()}}}}},98957:(e,n,l)=>{l.d(n,{A:()=>F});var a=l(58879),i=l(51593),r=l(84553),o=l(20782),t=l(89130);var s,d=l(16272),u=l(69715),m=l(6597),c=l(23702),v=l(50868),g=l(52515),p=l(69056),h=l(15934),y=l(96799),f=l(67378),A=l(89608),x=l.n(A),j=l(43373),_=l(56762),k=l(88789),b=l(73689);const F=e=>{var n;let{filter:A,showPrivate:F}=e;const w=c.A.useFormInstance(),S=c.A.useWatch("environments",{form:w,preserve:!0}),V=(0,i.CX)(),I=null===V||void 0===V?void 0:V.supports("extended-image-info"),[C,K]=(0,j.useState)(""),[N,P]=(0,j.useState)(""),{t:E}=(0,_.Bd)(),[T,{getBaseVersion:M,getImageMeta:R,tagAlias:L}]=(0,i.Gj)(),{token:O}=v.A.useToken(),{isDarkMode:z}=(0,r.e)(),B=(0,j.useRef)(null),$=(0,j.useRef)(null),q=null!==V&&void 0!==V&&null!==(n=V._config)&&void 0!==n&&n.showNonInstalledImages?{}:{installed:!0},{images:G}=(0,k.useLazyLoadQuery)(void 0!==s?s:s=l(38044),q,{fetchPolicy:"store-and-network"});(0,j.useEffect)((()=>{var e,n,l;if(!x().isEmpty(null===S||void 0===S?void 0:S.manual))return void((S.environment||S.version)&&w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}}));let i,r,o,t,s=null===(e=w.getFieldValue("environments"))||void 0===e?void 0:e.version;var d,u;(s&&s.indexOf("@")<0&&(s+="@x86_64"),s&&x().find(D,(e=>(i=x().find(e.environmentGroups,(e=>(r=x().find(e.images,(e=>(0,a.A_)(e)===s)),!!r))),!!i))),i?(o=i,t=r):w.getFieldValue(["environments","environment"])&&x().find(D,(e=>{var n;return o=x().find(e.environmentGroups,(e=>e.environmentName===w.getFieldValue(["environments","environment"]))),t=null===(n=o)||void 0===n?void 0:n.images[0],!!o})),o&&t)||(o=null===(d=D[0])||void 0===d?void 0:d.environmentGroups[0],t=null===(u=o)||void 0===u?void 0:u.images[0]);const m=null===(n=x().find(null===(l=t)||void 0===l?void 0:l.labels,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key))))||void 0===n?void 0:n.value;t?!i&&V._config.allow_manual_image_name_for_session&&s?w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0,manual:s,customizedTag:null!==m&&void 0!==m?m:void 0}}):w.setFieldsValue({environments:{environment:o.environmentName,version:(0,a.A_)(t),image:t,customizedTag:null!==m&&void 0!==m?m:void 0}}):V._config.allow_manual_image_name_for_session&&w.setFieldValue(["environments","manual"],s)}),[null===S||void 0===S?void 0:S.version,null===S||void 0===S?void 0:S.manual]);const D=(0,j.useMemo)((()=>x().chain(G).filter((e=>(!!F||!(e=>x().some(null===e||void 0===e?void 0:e.labels,(e=>{var n;return"ai.backend.features"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.split(" ").includes("private"))})))(e))&&(!A||A(e)))).groupBy((e=>{var n;return(null===T||void 0===T||null===(n=T.imageInfo[R((0,a.A_)(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map(((e,n)=>({groupName:n,environmentGroups:x().chain(e).groupBy((e=>`${null===e||void 0===e?void 0:e.registry}/${I?null===e||void 0===e?void 0:e.namespace:null===e||void 0===e?void 0:e.name}`)).map(((e,n)=>{var l,i;const r=null===(l=n.split("/"))||void 0===l?void 0:l[2];return{environmentName:n,displayName:r&&(null===T||void 0===T||null===(i=T.imageInfo[r])||void 0===i?void 0:i.name)||x().last(n.split("/")),prefix:x().chain(n).split("/").drop(1).dropRight(1).join("/").value(),images:e.sort(((e,n)=>{var l,i,r,o,t,s;return function(e,n){const l=e.split(".").map(Number),a=n.split(".").map(Number);for(let i=0;i<Math.max(l.length,a.length);i++){const e=l[i]||0,n=a[i]||0;if(e>n)return 1;if(e<n)return-1}return 0}(null!==(l=null===n||void 0===n||null===(i=n.tag)||void 0===i||null===(r=i.split("-"))||void 0===r?void 0:r[0])&&void 0!==l?l:"",null!==(o=null===e||void 0===e||null===(t=e.tag)||void 0===t||null===(s=t.split("-"))||void 0===s?void 0:s[0])&&void 0!==o?o:"")||(0,a._f)(null===e||void 0===e?void 0:e.architecture,null===n||void 0===n?void 0:n.architecture)}))}})).sortBy((e=>e.displayName)).value()}))).sortBy((e=>e.groupName)).value()),[G,T,A,F]),{fullNameMatchedImage:Q}=(0,j.useMemo)((()=>{let e,n;return C.length&&x().chain(D.flatMap((e=>e.environmentGroups)).find((l=>(n=l,e=x().find(l.images,(e=>(0,a.A_)(e)===C)),!!e)))).value(),{fullNameMatchedImage:e,fullNameMatchedImageGroup:n}}),[C,D]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("style",{children:"/* Change the image and tags of the select option when the selection is opened  */\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  img,\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  span.ant-tag {\n  opacity: 0.5;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-light {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-dark {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px; /* Width of the transparent gradient area */\n  background: linear-gradient(\n    to right,\n    rgba(255, 255, 255, 0),\n    rgba(255, 255, 255, 1)\n  );\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px;\n  background: linear-gradient(\n    to right,\n    rgba(20, 20, 20, 0),\n    rgba(20, 20, 20, 1)\n  );\n}\n"}),(0,b.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","environment"],label:(0,b.jsxs)(g.A.Text,{copyable:{text:(0,a.A_)(w.getFieldValue(["environments","image"]))},children:[E("session.launcher.Environments")," /"," ",E("session.launcher.Version")]}),rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],style:{marginBottom:10},children:(0,b.jsx)(p.A,{ref:B,showSearch:!0,searchValue:C,onSearch:K,defaultActiveFirstOption:!0,optionFilterProp:"filterValue",onChange:e=>{if(Q)w.setFieldsValue({environments:{environment:(I?null===Q||void 0===Q?void 0:Q.namespace:null===Q||void 0===Q?void 0:Q.name)||"",version:(0,a.A_)(Q),image:Q}});else{const n=D.flatMap((e=>e.environmentGroups)).filter((n=>n.environmentName===e))[0].images[0];w.setFieldsValue({environments:{environment:(I?null===n||void 0===n?void 0:n.namespace:null===n||void 0===n?void 0:n.name)||"",version:(0,a.A_)(n),image:n}})}},disabled:V._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:Q?(0,b.jsx)(p.A.Option,{value:I?null===Q||void 0===Q?void 0:Q.namespace:null===Q||void 0===Q?void 0:Q.name,filterValue:(0,a.A_)(Q),children:(0,b.jsxs)(t.A,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,b.jsx)(d.A,{image:(0,a.A_)(Q)||"",style:{width:15,height:15}}),(0,a.A_)(Q)]})}):x().map(D,(e=>(0,b.jsx)(p.A.OptGroup,{label:e.groupName,children:x().map(e.environmentGroups,(e=>{var n;const l=e.images[0],i=null===T||void 0===T?void 0:T.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[2]],r=[];let o=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(r.push(e.prefix),o=(0,b.jsx)(h.A,{color:"purple",children:(0,b.jsx)(m.A,{keyword:C,children:e.prefix})}));const s=x().map(null===i||void 0===i?void 0:i.label,(e=>x().isUndefined(e.category)&&e.tag&&e.color?(r.push(e.tag),(0,b.jsx)(h.A,{color:e.color,children:(0,b.jsx)(m.A,{keyword:C,children:e.tag},e.tag)},e.tag)):null));return(0,b.jsx)(p.A.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+r.join("\t"),children:(0,b.jsxs)(t.A,{direction:"row",justify:"between",children:[(0,b.jsxs)(t.A,{direction:"row",align:"center",gap:"xs",children:[(0,b.jsx)(d.A,{image:(0,a.A_)(l)||"",style:{width:15,height:15}}),(0,b.jsx)(m.A,{keyword:C,children:e.displayName})]}),(0,b.jsxs)(t.A,{direction:"row",className:z?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:O.marginXS,flexShrink:1},children:[o,s]})]})},e.environmentName)}))},e.groupName)))})}),(0,b.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var l,a;return(null===(l=e.environments)||void 0===l?void 0:l.environment)!==(null===(a=n.environments)||void 0===a?void 0:a.environment)},children:e=>{var n;let l,{getFieldValue:i}=e;return x().find(D,(e=>x().find(e.environmentGroups,(e=>{var n;return e.environmentName===(null===(n=i("environments"))||void 0===n?void 0:n.environment)&&(l=e,!0)})))),(0,b.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","version"],rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],children:(0,b.jsx)(p.A,{ref:$,onChange:e=>{const n=x().find(G,(n=>(0,a.A_)(n)===e));w.setFieldValue(["environments","image"],n)},showSearch:!0,searchValue:N,onSearch:P,optionFilterProp:"filterValue",dropdownRender:e=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(t.A,{style:{fontWeight:O.fontWeightStrong,paddingLeft:O.paddingSM},children:[E("session.launcher.Version"),(0,b.jsx)(y.A,{type:"vertical"}),E("session.launcher.Architecture"),(0,b.jsx)(y.A,{type:"vertical"}),E("session.launcher.Tags")]}),(0,b.jsx)(y.A,{style:{margin:"8px 0"}}),e]}),disabled:V._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:x().map(x().uniqBy(null===(n=l)||void 0===n?void 0:n.images,"id"),(e=>{var n;const[l,i,...r]=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""];let s=null===T||void 0===T?void 0:T.tagAlias[i];if(!s){for(const[e,n]of Object.entries((null===T||void 0===T?void 0:T.tagReplace)||{})){const l=new RegExp(e);l.test(i)&&(s=null===i||void 0===i?void 0:i.replace(l,n))}s||(s=i)}const d=[],c=x().chain(r).filter((e=>!e.startsWith("customized_"))).map(((e,n)=>(0,b.jsx)(o.A,{values:x().split((null===T||void 0===T?void 0:T.tagAlias[e])||e,":").map((e=>(d.push(e),{label:e,highlightKeyword:N})))},n))).value(),v=null===e||void 0===e?void 0:e.labels;if(v){const e=x().findIndex(v,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key)));if(e&&v[e]){var g;const n=(null===(g=v[e])||void 0===g?void 0:g.value)||"";d.push("Customized"),d.push(n),c.push((0,b.jsx)(o.A,{highlightKeyword:N,values:[{label:"Customized",color:"cyan"},{label:null!==n&&void 0!==n?n:"",color:"cyan"}]},c.length+1))}}return(0,b.jsx)(p.A.Option,{value:(0,a.A_)(e),filterValue:[l,s,null===e||void 0===e?void 0:e.architecture,...d].join("\t"),children:I?(0,b.jsxs)(t.A,{direction:"row",children:[(0,b.jsx)(m.A,{keyword:N,children:null===e||void 0===e?void 0:e.version}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(m.A,{keyword:N,children:null===e||void 0===e?void 0:e.architecture}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(t.A,{direction:"row",align:"start",children:x().map(null===e||void 0===e?void 0:e.tags,(n=>{var l;const i=x().includes(n.key,"customized_"),r=i?null===(l=x().find(null===e||void 0===e?void 0:e.labels,{key:"ai.backend.customized-image.name"}))||void 0===l?void 0:l.value:n.value,t=L(n.key+r);return x().isEqual(t,(0,a.WY)(n.key+r))?(0,b.jsx)(o.A,{highlightKeyword:N,values:[{label:L(n.key),color:i?"cyan":"blue"},{label:null!==r&&void 0!==r?r:"",color:i?"cyan":"blue"}]},n.key):(0,b.jsx)(h.A,{color:i?"cyan":"blue",children:(0,b.jsx)(m.A,{keyword:N,children:t})},n.key)}))})]}):(0,b.jsx)(t.A,{direction:"row",justify:"between",children:(0,b.jsxs)(t.A,{direction:"row",children:[(0,b.jsx)(m.A,{keyword:N,children:M((0,a.A_)(e)||"")}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(m.A,{keyword:N,children:null===e||void 0===e?void 0:e.architecture}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(u.Jj,{tag:(null===e||void 0===e?void 0:e.tag)||"",highlightKeyword:N,labels:null===e||void 0===e?void 0:e.labels})]})})},null===e||void 0===e?void 0:e.id)}))})})}}),(0,b.jsx)(c.A.Item,{label:E("session.launcher.ManualImageName"),name:["environments","manual"],style:{display:V._config.allow_manual_image_name_for_session?"block":"none"},children:(0,b.jsx)(f.A,{allowClear:!0,onChange:e=>{x().isEmpty(e)||w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}})}})}),(0,b.jsx)(c.A.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,b.jsx)(f.A,{})})]})}},69715:(e,n,l)=>{l.d(n,{Ay:()=>y,Jj:()=>f});var a=l(58879),i=l(51593),r=l(20782),o=l(89130),t=l(6597),s=l(15934),d=l(89608),u=l.n(d),m=l(43373),c=l(73689);const v=e=>{let{image:n,...l}=e;n=n||"";const[,{getImageAliasName:a,getBaseVersion:o,tagAlias:t}]=(0,i.Gj)();return(0,c.jsx)(r.A,{values:[{label:t(a(n)),color:"blue"},{label:o(n),color:"green"}],...l})},g=e=>{let{image:n,...l}=e;n=n||"";const[,{getBaseImage:a,tagAlias:r}]=(0,i.Gj)();return u().isEmpty(r(a(n)))?null:(0,c.jsx)(s.A,{color:"green",...l,children:r(a(n))})},p=e=>{let{image:n,...l}=e;n=n||"";const[,{getArchitecture:a,tagAlias:r}]=(0,i.Gj)();return u().isEmpty(r(a(n)))?null:(0,c.jsx)(s.A,{color:"green",...l,children:a(n)})},h=(e,n)=>{let{image:l,style:a={}}=e;return l=l||"",(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(v,{image:l}),(0,c.jsx)(g,{image:l}),(0,c.jsx)(p,{image:l})]})},y=m.memo(h),f=e=>{let{tag:n,labels:l,highlightKeyword:d,...m}=e;l=l||[];const[,{getTags:v,tagAlias:g}]=(0,i.Gj)(),p=v(n,l);return(0,c.jsx)(o.A,{direction:"row",align:"start",children:u().map(p,((e,n)=>{const l="Customized"===e.key,i=g(e.key+e.value);return u().isEqual(i,(0,a.WY)(e.key+e.value))?(0,c.jsx)(r.A,{highlightKeyword:d,values:[{label:g(e.key),color:l?"cyan":"blue"},{label:e.value,color:l?"cyan":"blue"}]},e.key):(0,c.jsx)(s.A,{color:l?"cyan":"blue",children:(0,c.jsx)(t.A,{keyword:d,children:i},n)},e.key)}))})}},81514:(e,n,l)=>{l.d(n,{A:()=>Q});var a=l(58879),i=l(51593),r=l(68190),o=l(60881),t=l(7194),s=l(15634),d=l(60266),u=l(59286),m=l(43373),c=l(97734),v=l(73689);const g=(0,u.rU)((e=>{let{css:n,token:l}=e;return{hover:n`
    text-decoration: none;
    color: inherit;

    &:hover {
      color: ${l.colorLinkHover};
      text-decoration: underline;
    }
  `}})),p=e=>{let{type:n,...l}=e;const{styles:a}=g();return(0,v.jsx)(c.N_,{className:"hover"===n?a.hover:void 0,...l})};var h,y=l(45719),f=l(89130),A=l(92920),x=l(18463),j=l(6597),_=l(20782),k=l(89608),b=l.n(k),F=l(88789);const w=e=>{let{vFolderFrgmt:n=null,permission:a}=e;const i=(0,F.useFragment)(void 0!==h?h:h=l(34790),n),r=b().chain({r:"green",w:"blue",d:"red"}).map(((e,n)=>{if(((e,n)=>!(null===e||void 0===e||!e.includes(n))||!(null===e||void 0===e||!e.includes("w")||"r"!==n))((null===i||void 0===i?void 0:i.permission)||a,n))return{label:n.toUpperCase(),color:e}})).compact().value();return(0,v.jsx)(_.A,{values:r})};var S,V=l(65666),I=l(58457),C=l(40567),K=l(23702),N=l(52515),P=l(33789),E=l(67378),T=l(60822),M=l(77731),R=l(45679),L=l(15934),O=l(12731),z=l.n(O),B=l(93056),$=l(56762);const q=/^[a-zA-Z0-9_/.-]*$/,G="/home/work/",D=e=>{let{filter:n,showAliasInput:u=!1,selectedRowKeys:c=[],onChangeSelectedRowKeys:g,aliasBasePath:h=G,aliasMap:_,onChangeAliasMap:k,rowKey:O="name",onChangeAutoMountedFolders:D,showAutoMountedFoldersSection:Q,...W}=e;const{generateFolderPath:U}=(0,x.useFolderExplorerOpener)(),J=m.useMemo((()=>e=>e&&e[O]),[O]),[H,Y]=(0,m.useState)(!1),[X,Z]=(0,t.A)({value:c,onChange:g},{defaultValue:[]}),[ee,ne]=(0,t.A)({value:_,onChange:k},{defaultValue:{}}),le=(0,i.CX)(),[ae]=(0,r.x)(null===le||void 0===le?void 0:le._config.accessKey),[ie]=K.A.useForm();(0,m.useEffect)((()=>{ee&&(ie.setFieldsValue(b().mapValues(ee,(e=>e.startsWith(h)?e.slice(h.length):e))),ie.validateFields())}),[ee,ie,h]);const{t:re}=(0,$.Bd)(),oe=(0,a.QE)(),te=(0,s.hd)(),[se,de]=(0,i.Tw)("first"),[ue,me]=(0,m.useTransition)(),{data:ce}=(0,o.nj)({queryKey:["VFolderSelectQuery",se,te.id],queryFn:()=>{const e=new URLSearchParams;return e.set("group_id",te.id),oe({method:"GET",url:`/folders?${e.toString()}`})},staleTime:1e3}),{domain:ve,group:ge,keypair_resource_policy:pe}=(0,F.useLazyLoadQuery)(void 0!==S?S:S=l(46385),{domain_name:le._config.domainName,group_id:te.id,keypair_resource_policy_name:(null===ae||void 0===ae?void 0:ae.resource_policy)||""},{fetchPolicy:"store-and-network",fetchKey:se}),he=(0,m.useMemo)((()=>{const e=JSON.parse((null===ve||void 0===ve?void 0:ve.allowed_vfolder_hosts)||"{}"),n=JSON.parse((null===ge||void 0===ge?void 0:ge.allowed_vfolder_hosts)||"{}"),l=JSON.parse((null===pe||void 0===pe?void 0:pe.allowed_vfolder_hosts)||"{}"),a=b().merge({},e,n,l),i=Object.keys(a).filter((e=>a[e].includes("mount-in-session")));return null===ce||void 0===ce?void 0:ce.filter((e=>i.includes(e.host)))}),[ve,ge,pe,ce]),ye=(0,m.useMemo)((()=>b().chain(he).filter((e=>{var n;return"ready"===e.status&&(null===(n=e.name)||void 0===n?void 0:n.startsWith("."))})).map((e=>e.name)).value()),[he]);(0,m.useEffect)((()=>{b().isFunction(D)&&D(ye)}),[ye]);const[fe,Ae]=(0,m.useState)(""),xe=b().chain(he).filter((e=>!n||n(e))).filter((e=>!!X.includes(J(e))||(!fe||e.name.includes(fe)))).value(),je=(0,m.useCallback)(((e,n)=>void 0===n||""===n?`${h}${e}`:n.startsWith("/")?n:`${h}${n}`),[h]),_e=(0,d.E)((()=>{ne(b().mapValues(b().pickBy(ie.getFieldsValue({strict:!1}),(e=>!!e)),((e,n)=>je(n,e)))),ie.validateFields().catch((()=>{}))}));(0,m.useEffect)((()=>{_e()}),[JSON.stringify(X),_e]);const ke=(0,y.useShadowRoot)(),be=[{title:(0,v.jsxs)(f.A,{direction:"row",gap:"xxs",children:[(0,v.jsx)(N.A.Text,{children:re("data.folders.Name")}),u&&(0,v.jsx)(v.Fragment,{children:(0,v.jsxs)(N.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",re("session.launcher.FolderAlias")," ",(0,v.jsx)(P.A,{title:(0,v.jsx)($.x6,{i18nKey:"session.launcher.DescFolderAlias"}),getPopupContainer:()=>ke,children:(0,v.jsx)(V.A,{})}),")"]})})]}),dataIndex:"name",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n)=>{const l=X.includes(J(n));return(0,v.jsxs)(f.A,{direction:"column",align:"start",gap:"xxs",style:u&&l?{display:"inline-flex",height:70,width:"100%"}:{maxWidth:200},children:[(0,v.jsx)(p,{type:"hover",to:U(n.id),children:(0,v.jsx)(j.A,{keyword:fe,children:e})}),u&&l&&(0,v.jsx)(K.A.Item,{noStyle:!0,shouldUpdate:(e,l)=>e[J(n)]!==l[J(n)],children:()=>{const e=b()(X).reduce(((e,n)=>(e[n]=(null===ee||void 0===ee?void 0:ee[n])||je(n,void 0),e)),{});return(0,v.jsx)(K.A.Item,{name:J(n),rules:[{type:"string",pattern:q,message:re("session.launcher.FolderAliasInvalid")},{type:"string",validator:async(l,a)=>a&&b().some(e,((e,l)=>l!==J(n)&&e===je(J(n),a)))?Promise.reject(re("session.launcher.FolderAliasOverlapping")):Promise.resolve()},{type:"string",validator:async(e,l)=>{const a=je(J(n),l);return l&&b().map(ye,(e=>je("",e))).includes(a)?Promise.reject(re("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],extra:je(n.name,ie.getFieldValue(J(n))),children:(0,v.jsx)(E.A,{onClick:e=>{e.stopPropagation()},placeholder:re("session.launcher.FolderAlias"),allowClear:!0,onChange:()=>{_e()}})})}})]})}},{title:re("data.UsageMode"),dataIndex:"usage_mode",sorter:(e,n)=>e.usage_mode.localeCompare(n.usage_mode)},{title:re("data.Host"),dataIndex:"host"},{title:re("data.Type"),dataIndex:"type",sorter:(e,n)=>e.type.localeCompare(n.type),render:(e,n)=>(0,v.jsxs)(f.A,{direction:"column",children:["user"===n.type?(0,v.jsx)(I.A,{title:"User"}):(0,v.jsx)("div",{children:"Group"}),"group"===n.type&&`(${n.group_name})`]})},{title:re("data.Permission"),dataIndex:"permission",sorter:(e,n)=>e.permission.localeCompare(n.permission),render:(e,n)=>(0,v.jsx)(w,{permission:n.permission})},{title:re("data.Created"),dataIndex:"created_at",sorter:(e,n)=>e.created_at.localeCompare(n.created_at),render:(e,n)=>z()(e).format("L"),defaultSortOrder:"descend"}];return(0,v.jsxs)(f.A,{direction:"column",align:"stretch",gap:"xs",children:[(0,v.jsxs)(f.A,{direction:"row",gap:"xs",justify:"between",children:[(0,v.jsx)(E.A,{value:fe,onChange:e=>Ae(e.target.value),allowClear:!0,placeholder:re("data.SearchByName")}),(0,v.jsx)(P.A,{title:re("button.Refresh"),children:(0,v.jsx)(T.Ay,{loading:ue,icon:(0,v.jsx)(C.A,{}),onClick:()=>{me((()=>{de()}))}})}),(0,v.jsx)(P.A,{title:re("data.CreateANewStorageFolder"),children:(0,v.jsx)(T.Ay,{icon:(0,v.jsx)(B.A,{}),type:"primary",ghost:!0,onClick:()=>{Y(!0)}})})]}),(0,v.jsx)(K.A,{form:ie,component:!1,preserve:!1,children:(0,v.jsx)(M.A,{scroll:{x:"max-content"},rowKey:J,rowSelection:{selectedRowKeys:X,onChange:e=>{Z(e),_e()}},showSorterTooltip:!1,columns:be,dataSource:xe,onRow:(e,n)=>({onClick:n=>{var l;const a=n.target;null!==a&&void 0!==a&&null!==(l=a.classList)&&void 0!==l&&l.contains("ant-table-selection-column")&&(n.stopPropagation(),X.includes(J(e))?Z(X.filter((n=>n!==J(e)))):Z([...X,J(e)]))}}),sortDirections:["ascend","descend"],...W})}),Q&&ye.length>0?(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(R.A,{size:"small",children:(0,v.jsx)(R.A.Item,{label:re("data.AutomountFolders"),children:b().map(ye,(e=>(0,v.jsx)(L.A,{children:e},e)))})})}):null,(0,v.jsx)(A.A,{open:H,onRequestClose:e=>{Y(!1),e&&me((()=>{de(),Z((n=>[...n,e[O]]))}))}})]})},Q=e=>{let{filter:n,rowKey:l="name",tableProps:a,...i}=e;const r=K.A.useFormInstance(),{t:o}=(0,$.Bd)();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(K.A.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator(e,n){const l=b().chain(r.getFieldValue("mounts")).reduce(((e,l)=>(e[l]=n[l]||"/home/work/"+l,e)),{}).values().value();return b().uniq(l).length!==l.length?Promise.reject(o("session.launcher.FolderAliasOverlapping")):b().some(l,(e=>!q.test(e)))?Promise.reject(o("session.launcher.FolderAliasInvalid")):b().some(r.getFieldValue("autoMountedFolderNames"),(e=>l.includes(G+e)))?Promise.reject(o("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],children:(0,v.jsx)(E.A,{})}),(0,v.jsx)(K.A.Item,{hidden:!0,name:"autoMountedFolderNames"}),(0,v.jsx)(K.A.Item,{name:"mounts",...i,valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,v.jsx)(D,{rowKey:l,showAliasInput:!0,aliasMap:r.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:e=>{r.setFieldValue("vfoldersAliasMap",e),r.validateFields(["vfoldersAliasMap"])},pagination:!1,filter:n,showAutoMountedFoldersSection:!0,onChangeAutoMountedFolders:e=>{r.setFieldValue("autoMountedFolderNames",e)},...a})})]})}},38044:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},l=[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base_image_name",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"version",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:a,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:a},params:{cacheID:"9ff1339a66b7da77df70de956e3c7dd8",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:'query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    name @deprecatedSince(version: "24.12.0")\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n    namespace @since(version: "24.12.0")\n    base_image_name @since(version: "24.12.0")\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    version @since(version: "24.12.0")\n  }\n}\n'}}}();a.hash="40b2d995106300fffb0c3a5d66103d38";const i=a},34790:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"},i=a},46385:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domain_name"},{defaultValue:null,kind:"LocalArgument",name:"group_id"},{defaultValue:null,kind:"LocalArgument",name:"keypair_resource_policy_name"}],n=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],l=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domain_name"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domain_name"},{kind:"Variable",name:"id",variableName:"group_id"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"keypair_resource_policy_name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:n,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderTableProjectQuery",selections:l,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderTableProjectQuery",selections:l},params:{cacheID:"2c2ce905afd89e93c6d761f22ed59f3d",id:null,metadata:{},name:"VFolderTableProjectQuery",operationKind:"query",text:"query VFolderTableProjectQuery(\n  $domain_name: String!\n  $group_id: UUID!\n  $keypair_resource_policy_name: String!\n) {\n  domain(name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  group(id: $group_id, domain_name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $keypair_resource_policy_name) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();a.hash="ccdbaa52a63c2ea005423e7c541eff80";const i=a}}]);
//# sourceMappingURL=5818.969e67c5.chunk.js.map