"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[818,3293],{30818:(e,n,l)=>{l.r(n),l.d(n,{default:()=>x,useFileUploadManager:()=>K});var a=l(40005),r=l(41633),o=l(18302),i=l(234),s=l(8334),t=l(45045),d=l(23370),u=l(39758),c=l(48200),m=l(43749),g=l.n(m),p=l(75334),y=l(21481),v=l(51569),f=l(43224),F=l(497),h=l(6620),_=l(66845);const S=(0,d.eU)([]),k=(0,d.eU)({}),b=(0,c.Iz)((e=>(0,d.eU)((n=>n(k)[e]),((n,l,a)=>{const r=n(k);l(k,{...r,[e]:a})})))),x=()=>{const{t:e}=(0,v.Bd)(),{token:n}=i.A.useToken(),l=(0,f.CX)(),{upsertNotification:a,closeNotification:d}=(0,r.js)(),{generateFolderPath:c}=(0,o.useFolderExplorerOpener)(),[m,h]=(0,u.fp)(S),[b,x]=(0,u.fp)(k),[K]=(0,F.q)("max_concurrent_uploads"),w=new p.A({concurrency:K||2}),N=(0,y.useRef)({}),P=g().throttle(((l,r)=>{const o=N.current[l]||0;N.current[l]=0,x((i=>{var d,u,c,m,g,p,y,v,f,F;const h=(null===(d=i[l])||void 0===d||null===(u=d.completedFiles)||void 0===u?void 0:u.length)||0,S=((null===(c=i[l])||void 0===c||null===(m=c.completedFiles)||void 0===m?void 0:m.length)||0)+((null===(g=i[l])||void 0===g||null===(p=g.failedFiles)||void 0===p?void 0:p.length)||0)+((null===(y=i[l])||void 0===y||null===(v=y.pendingFiles)||void 0===v?void 0:v.length)||0),k=(null===(f=i[l])||void 0===f?void 0:f.totalExpectedSize)||0,b=((null===(F=i[l])||void 0===F?void 0:F.completedBytes)||0)+o;return a({key:"upload:"+l,backgroundTask:{status:"pending",percent:k>0?b/k*100:0,onChange:{pending:{description:(0,_.jsxs)(t.OO,{direction:"column",align:"start",children:[(0,_.jsxs)(s.A.Text,{children:[e("explorer.UploadingFiles")," ( ",h," /"," ",S," )"]}),(0,_.jsx)(s.A.Text,{ellipsis:!0,type:"secondary",style:{fontSize:n.fontSizeSM,maxWidth:"300px"},children:r})]})}}}}),{...i,[l]:{...i[l],completedBytes:b}}}))}),200,{leading:!0,trailing:!0});return(0,y.useEffect)((()=>{0!==m.length&&l&&(m.forEach((n=>{const{vFolderId:l,vFolderName:r,uploadFileInfo:o}=n,i=g().sumBy(o,(e=>e.file.size));x((n=>{var s,u,m,g,p,y;const v=!n[l],f=((null===(s=n[l])||void 0===s?void 0:s.totalExpectedSize)||0)+i,F=v?0:((null===(u=n[l])||void 0===u?void 0:u.completedBytes)||0)/f*100;return a({key:"upload:"+l,open:!0,message:(0,_.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,_.jsx)(t.rm,{style:{fontWeight:"normal"},to:c(l),onClick:()=>{d("upload:"+l)},children:`${r}`})]}),backgroundTask:{status:"pending",percent:F,onChange:{pending:e("explorer.ProcessingUpload")}},duration:0}),{...n,[l]:{vFolderName:r,pendingFiles:[...(null===(m=n[l])||void 0===m?void 0:m.pendingFiles)||[],...o.map((e=>e.file.webkitRelativePath||e.file.name))],completedFiles:(null===(g=n[l])||void 0===g?void 0:g.completedFiles)||[],failedFiles:(null===(p=n[l])||void 0===p?void 0:p.failedFiles)||[],completedBytes:(null===(y=n[l])||void 0===y?void 0:y.completedBytes)||0,totalExpectedSize:f}}})),o.forEach((e=>{let{file:n,startFunction:a}=e;w.add((async()=>{const e=n.webkitRelativePath||n.name;let r=0;try{await a({onProgress:(e,n,a)=>{const o=e-r;r=e,N.current[l]=(N.current[l]||0)+o,P(l,a)}}),P.flush(),delete N.current[l],x((n=>{var a;return{...n,[l]:{...n[l],pendingFiles:n[l].pendingFiles.filter((n=>n!==e)),completedFiles:[...(null===(a=n[l])||void 0===a?void 0:a.completedFiles)||[],e]}}}))}catch(o){P.flush(),delete N.current[l],x((n=>{var a;return{...n,[l]:{...n[l],pendingFiles:n[l].pendingFiles.filter((n=>n!==e)),failedFiles:[...(null===(a=n[l])||void 0===a?void 0:a.failedFiles)||[],e]}}}))}}))}))})),h([]))}),[m]),(0,y.useEffect)((()=>{Object.entries(b).forEach((n=>{let[l,r]=n;g().isEmpty(null===r||void 0===r?void 0:r.pendingFiles)&&(g().isEmpty(null===r||void 0===r?void 0:r.failedFiles)?g().isEmpty(null===r||void 0===r?void 0:r.completedFiles)||(a({key:"upload:"+l,open:!0,message:(0,_.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,_.jsx)(t.rm,{style:{fontWeight:"normal"},to:c(l),onClick:()=>{d("upload:"+l)},children:`${null===r||void 0===r?void 0:r.vFolderName}`})]}),backgroundTask:{status:"resolved",percent:100,onChange:{resolved:e("explorer.SuccessfullyUploadedToFolder")}},duration:3}),x((e=>({...e,[l]:{...e[l],completedFiles:[],completedBytes:0,totalExpectedSize:0}})))):a({key:"upload:"+l,open:!0,message:e("explorer.UploadFailed",{folderName:null===r||void 0===r?void 0:r.vFolderName}),backgroundTask:{status:"rejected",percent:0,onChange:{rejected:e("explorer.FileUploadFailed",{folderName:null===r||void 0===r?void 0:r.vFolderName})}},extraDescription:g().join(null===r||void 0===r?void 0:r.failedFiles,", ")}))}))}),[b]),null},K=(e,n)=>{const l=(0,a.c)(16),o=(0,t.kq)(),{t:i}=(0,v.Bd)(),{upsertNotification:s}=(0,r.js)(),d=(0,u.Xr)(S);let c;l[0]!==e?(c=e?(0,t.om)(e).replace(/-/g,""):"",l[0]=e,l[1]=c):c=l[1];const[m,p]=(y=c,(0,u.fp)(b(y)));var y;let f;l[2]!==o||l[3]!==n||l[4]!==i||l[5]!==s?(f=(e,l)=>{const a=o._config.maxFileUploadSize,r=g().map(e,N).reduce(P,0);return!(a>0&&r>a)||(s({open:!0,key:"upload:"+l,message:i("explorer.UploadFailed",{folderName:null!==n&&void 0!==n?n:""}),description:i("data.explorer.FileUploadSizeLimit"),duration:3,toText:i("data.folders.OpenAFolder"),to:{search:new URLSearchParams({folder:l}).toString()}}),!1)},l[2]=o,l[3]=n,l[4]=i,l[5]=s,l[6]=f):f=l[6];const F=f;let _;l[7]!==o||l[8]!==n||l[9]!==d||l[10]!==F?(_=async(e,l,a)=>{if(!F(e,l))return;const r=[],i=g().map(e,(e=>(r.push(e),async n=>{const r=e.webkitRelativePath||e.name;try{const i=[a,r].filter(Boolean).join("/"),s=await o.vfolder.create_upload_session(i,e,l);return await new Promise(((l,a)=>{try{new h._O(e,{endpoint:s,uploadUrl:s,retryDelays:[0,3e3,5e3,1e4,2e4],chunkSize:w(e.size),storeFingerprintForResuming:!1,metadata:{filename:e.name,filetype:e.type},onProgress:(e,l)=>{var a;null===n||void 0===n||null===(a=n.onProgress)||void 0===a||a.call(n,e,l,r)},onSuccess:()=>{l({name:r,bytes:e.size})},onError:e=>{a(new Error(`Upload failed for ${r}`))}}).start()}catch(o){a(new Error(`Failed to initialize upload for ${r}`))}}))}catch(x){throw new Error(`Failed to prepare upload for ${r}`)}}))),s={vFolderId:l,vFolderName:null!==n&&void 0!==n?n:"",uploadFileInfo:g().zipWith(r,i,j)};d((e=>[...e,s]))},l[7]=o,l[8]=n,l[9]=d,l[10]=F,l[11]=_):_=l[11];const k=_;let x;return l[12]!==p||l[13]!==k||l[14]!==m?(x={uploadStatus:m,setUploadStatus:p,uploadFiles:k},l[12]=p,l[13]=k,l[14]=m,l[15]=x):x=l[15],x},w=e=>{const n=1048576;return e>=5120*n?200*n:e>=1024*n?100*n:e>=100*n?50*n:15*n};function N(e){return e.size}function P(e,n){return Math.max(e,n)}function j(e,n){return{file:e,startFunction:n}}},63293:(e,n,l)=>{l.r(n),l.d(n,{default:()=>Pe});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"vfolderGlobalId"}],n=[{kind:"Variable",name:"id",variableName:"vfolderGlobalId"}],l={alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"FolderExplorerModalQuery",selections:[{alias:null,args:n,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[l,a,r,o,i,s,{args:null,kind:"FragmentSpread",name:"FolderExplorerHeaderFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeDescriptionFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"FolderExplorerModalQuery",selections:[{alias:null,args:n,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[l,a,r,o,i,s,{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},r],storageKey:null}]},params:{cacheID:"58f5bbfd510cd6b79c3357b5995b0db4",id:null,metadata:{},name:"FolderExplorerModalQuery",operationKind:"query",text:'query FolderExplorerModalQuery(\n  $vfolderGlobalId: String!\n) {\n  vfolder_node(id: $vfolderGlobalId) {\n    group\n    unmanaged_path @since(version: "25.04.0")\n    permissions\n    host\n    id\n    name\n    ...FolderExplorerHeaderFragment\n    ...VFolderNodeDescriptionFragment\n    ...VFolderNameTitleNodeFragment\n  }\n}\n\nfragment EditableVFolderNameFragment on VirtualFolderNode {\n  id\n  name\n  user\n  group\n  status\n}\n\nfragment FileBrowserButtonFragment on VirtualFolderNode {\n  id\n  row_id\n  host\n}\n\nfragment FolderExplorerHeaderFragment on VirtualFolderNode {\n  id\n  user\n  permission\n  row_id\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderNameTitleNodeFragment\n  ...VFolderNodeIdenticonFragment\n  ...EditableVFolderNameFragment\n  ...FileBrowserButtonFragment\n  ...SFTPServerButtonFragment\n}\n\nfragment SFTPServerButtonFragment on VirtualFolderNode {\n  id\n  row_id\n  host\n}\n\nfragment VFolderNameTitleNodeFragment on VirtualFolderNode {\n  name\n}\n\nfragment VFolderNodeDescriptionFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderPermissionCellFragment\n  ...useVirtualFolderNodePathFragment\n}\n\nfragment VFolderNodeIdenticonFragment on VirtualFolderNode {\n  id\n}\n\nfragment VFolderPermissionCellFragment on VirtualFolderNode {\n  permissions\n}\n\nfragment useVirtualFolderNodePathFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n}\n'}}}();a.hash="d77b09a9578329829d7b76b18186e731";const r=a;var o=l(30818);const i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FolderExplorerHeaderFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},action:"THROW"},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeIdenticonFragment"},{args:null,kind:"FragmentSpread",name:"EditableVFolderNameFragment"},{args:null,kind:"FragmentSpread",name:"FileBrowserButtonFragment"},{args:null,kind:"FragmentSpread",name:"SFTPServerButtonFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"8c6e3cf5a92c8f51f54f315622c8bb75"},s=i;var t=l(40005),d=l(59370),u=l(19065);const c={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FileBrowserButtonFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"4efd44f6f555400c7682e3af18779331"},m=c;var g=l(52688),p=l(35413),y=l(91454),v=l(45045),f=l(43749),F=l.n(f),h=l(21481),_=l(51569),S=l(69775),k=l(43224),b=l(41633),x=l(16507);const K=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},l=[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:l,storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:l,storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useDefaultImagesWithFallbackQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useDefaultImagesWithFallbackQuery",selections:a},params:{cacheID:"50986f0b2ceaf84de4cd397a2d793329",id:null,metadata:{},name:"useDefaultImagesWithFallbackQuery",operationKind:"query",text:'query useDefaultImagesWithFallbackQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    tag\n    registry\n    architecture\n    name @deprecatedSince(version: "24.12.0")\n    namespace @since(version: "24.12.0")\n    labels {\n      key\n      value\n    }\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    resource_limits {\n      key\n      min\n      max\n    }\n  }\n}\n'}}}();K.hash="10405daea8947c9eb138ed58ff364fe0";const w=K;var N=l(23370),P=l(39758),j=l(48200),I=l(92882);const A=w,T=(0,j.t_)((async()=>{var e,n;const l=await k.VV;return F().isEmpty(null===(e=l._config)||void 0===e?void 0:e.defaultFileBrowserImage)||null===(n=l._config)||void 0===n?void 0:n.defaultFileBrowserImage})),V=(0,j.t_)((async()=>{var e,n;const l=await k.VV;return F().isEmpty(null===(e=l._config)||void 0===e?void 0:e.systemSSHImage)||null===(n=l._config)||void 0===n?void 0:n.systemSSHImage})),E=(0,N.eU)();function D(e){var n;return"ai.backend.service-ports"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.toLowerCase().includes("filebrowser"))}function z(e){var n;return null===e||void 0===e||null===(n=e.labels)||void 0===n?void 0:n.find(D)}function C(e){var n;return null===e||void 0===e||null===(n=e.images)||void 0===n?void 0:n.filter(z)}function B(e){var n;return"ai.backend.role"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.toLowerCase().includes("system"))}function O(e){var n;return null===e||void 0===e||null===(n=e.labels)||void 0===n?void 0:n.find(B)}function L(e){var n;return null===e||void 0===e||null===(n=e.images)||void 0===n?void 0:n.filter(O)}const M=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domainName"},{defaultValue:null,kind:"LocalArgument",name:"projectId"},{defaultValue:null,kind:"LocalArgument",name:"resourcePolicyName"}],n=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],l=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domainName"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domainName"},{kind:"Variable",name:"id",variableName:"projectId"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"resourcePolicyName"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:n,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:l,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:l},params:{cacheID:"f7d16150a7d77cb465733a2933a08261",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery(\n  $domainName: String\n  $projectId: UUID!\n  $resourcePolicyName: String\n) {\n  domain(name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  group(id: $projectId, domain_name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $resourcePolicyName) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();M.hash="616594ca9d6c787458c32688c1a25b1f";const Q=M,R=function(){var e={defaultValue:null,kind:"LocalArgument",name:"accessKey"},n={defaultValue:null,kind:"LocalArgument",name:"domainName"},l=[{kind:"Variable",name:"access_key",variableName:"accessKey"},{kind:"Variable",name:"domain_name",variableName:"domainName"}],a={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null};return{fragment:{argumentDefinitions:[e,n],kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{kind:"RequiredField",field:{alias:null,args:l,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{kind:"RequiredField",field:a,action:"THROW"}],storageKey:null},action:"THROW"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e],kind:"Operation",name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{alias:null,args:l,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"ca4270af888b8158a6bbb4fe9dc305ca",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_KeypairQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_KeypairQuery(\n  $domainName: String!\n  $accessKey: String\n) {\n  keypair(domain_name: $domainName, access_key: $accessKey) {\n    resource_policy\n    id\n  }\n}\n"}}}();R.hash="43280e755e9e0f52dcd74eb7aa29d60c";const q=R;var H=l(54656);const U=(e,n,l)=>{var a,r,o;const i=(0,k.CX)(),{keypair:s}=(0,S.useLazyLoadQuery)(q,{domainName:e,accessKey:l},{fetchPolicy:"store-or-network"}),t=(0,S.useLazyLoadQuery)(Q,{domainName:e,projectId:n,resourcePolicyName:null===s||void 0===s?void 0:s.resource_policy},{fetchPolicy:"store-or-network"}),d=JSON.parse((null===t||void 0===t||null===(a=t.domain)||void 0===a?void 0:a.allowed_vfolder_hosts)||"{}"),u=JSON.parse((null===t||void 0===t||null===(r=t.group)||void 0===r?void 0:r.allowed_vfolder_hosts)||"{}"),c=JSON.parse((null===t||void 0===t||null===(o=t.keypair_resource_policy)||void 0===o?void 0:o.allowed_vfolder_hosts)||"{}"),{data:m}=(0,H.U)({queryKey:["vhostInfo"],queryFn:async()=>await i.vfolder.list_hosts(),staleTime:3e5,gcTime:0}),g=Object.assign({},...m.allowed.map((e=>{return{[e]:(n=[d[e],u[e],c[e]],[...new Set([].concat(...n.filter(Boolean)))])};var n})));return{StorageHostPermissionByDomain:d,StorageHostPermissionByGroup:u,StorageHostPermissionByResourcePolicy:c,unitedAllowedPermissionByVolume:g}};var $=l(43352),W=l(66845);const G=e=>{var n;const l=(0,t.c)(41);let a,r,o;l[0]!==e?(({showTitle:r,vfolderFrgmt:o,...a}=e),l[0]=e,l[1]=a,l[2]=r,l[3]=o):(a=l[1],r=l[2],o=l[3]);const i=void 0===r||r,{t:s}=(0,_.Bd)(),{message:d,modal:u}=g.A.useApp(),c=(0,k.CX)(),f=(0,k.eZ)(),K=(0,x.hd)(),w=null===c||void 0===c||null===(n=c._config)||void 0===n?void 0:n.accessKey,{unitedAllowedPermissionByVolume:N}=U(f,K.id,w),{getErrorMessage:j}=(0,v.B7)(),{startSessionWithDefault:V,upsertSessionNotification:E}=(0,$.GQ)(),{upsertNotification:D}=(0,b.js)(),z=(()=>{const e=(0,t.c)(7),[n,l]=(0,P.fp)(T),a=(0,S.useRelayEnvironment)();let r;e[0]!==n||e[1]!==a||e[2]!==l?(r=()=>{void 0===n&&(0,S.fetchQuery)(a,A,{installed:!0},{fetchPolicy:"store-or-network"}).toPromise().then(C).then((async e=>{const n=F().first(e);l(n?(0,I.A_)(n):null)})).catch((()=>{l(null)}))},e[0]=n,e[1]=a,e[2]=l,e[3]=r):r=e[3];const o=(0,h.useEffectEvent)(r);let i,s;return e[4]!==o?(i=()=>{o()},e[4]=o,e[5]=i):i=e[5],e[6]===Symbol.for("react.memo_cache_sentinel")?(s=[],e[6]=s):s=e[6],(0,h.useEffect)(i,s),n})();let B;l[4]===Symbol.for("react.memo_cache_sentinel")?(B=m,l[4]=B):B=l[4];const O=(0,S.useFragment)(B,o);let L;var M;l[5]!==N||l[6]!==(null===O||void 0===O?void 0:O.host)?(L=F().includes(N[null!==(M=null===O||void 0===O?void 0:O.host)&&void 0!==M?M:""],"mount-in-session"),l[5]=N,l[6]=null===O||void 0===O?void 0:O.host,l[7]=L):L=l[7];const Q=L;let R;l[8]!==z||l[9]!==Q||l[10]!==i||l[11]!==s?(R=()=>Q?null===z?s("data.explorer.NoImagesSupportingFileBrowser"):!i&&z?s("data.explorer.ExecuteFileBrowser"):"":s("data.explorer.NoPermissionToMountFolder"),l[8]=z,l[9]=Q,l[10]=i,l[11]=s,l[12]=R):R=l[12];const q=R;let H,G,X;l[13]!==q?(H=q(),l[13]=q,l[14]=H):H=l[14],l[15]!==z?(G=z?void 0:{filter:"grayscale(100%)"},l[15]=z,l[16]=G):G=l[16],l[17]!==G?(X=(0,W.jsx)(p.A,{width:"18px",src:"/resources/icons/filebrowser.svg",alt:"File Browser",preview:!1,style:G}),l[17]=G,l[18]=X):X=l[18];const J=!z||!Q;let Z,Y,ee,ne;return l[19]!==z||l[20]!==j||l[21]!==d||l[22]!==u||l[23]!==V||l[24]!==s||l[25]!==D||l[26]!==E||l[27]!==O?(Z=async()=>{var e;if(!z)return;const n={sessionName:`filebrowser-${O.row_id}`,sessionType:"interactive",environments:{version:z},allocationPreset:"minimum-required",cluster_mode:"single-node",cluster_size:1,mount_ids:[(null===(e=O.row_id)||void 0===e?void 0:e.replaceAll("-",""))||""],resource:{cpu:1,mem:"0.5g"}};await V(n).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&E(e.fulfilled,[{extraData:{appName:"filebrowser"}}]),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const n=e.rejected[0].reason;F().includes(n.message,$.dM.DUPLICATED_SESSION)?D({key:`filebrowser-${O.row_id}`,open:!0}):u.error({title:null===n||void 0===n?void 0:n.title,content:j(n)})}})).catch((e=>{console.error("Unexpected error during session creation:",e),d.error(s("error.UnexpectedError"))}))},l[19]=z,l[20]=j,l[21]=d,l[22]=u,l[23]=V,l[24]=s,l[25]=D,l[26]=E,l[27]=O,l[28]=Z):Z=l[28],l[29]!==i||l[30]!==s?(Y=i&&s("data.explorer.ExecuteFileBrowser"),l[29]=i,l[30]=s,l[31]=Y):Y=l[31],l[32]!==a||l[33]!==Y||l[34]!==X||l[35]!==J||l[36]!==Z?(ee=(0,W.jsx)(v.Fv,{icon:X,disabled:J,action:Z,...a,children:Y}),l[32]=a,l[33]=Y,l[34]=X,l[35]=J,l[36]=Z,l[37]=ee):ee=l[37],l[38]!==ee||l[39]!==H?(ne=(0,W.jsx)(y.A,{title:H,children:ee}),l[38]=ee,l[39]=H,l[40]=ne):ne=l[40],ne},X={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SFTPServerButtonFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"8bf5b2e08fd923cb5fc74aaa801b7e1f"},J=X,Z=e=>{var n,l;const a=(0,t.c)(45);let r,o,i;a[0]!==e?(({showTitle:o,vfolderFrgmt:i,...r}=e),a[0]=e,a[1]=r,a[2]=o,a[3]=i):(r=a[1],o=a[2],i=a[3]);const s=void 0===o||o,{t:d}=(0,_.Bd)(),{message:u,modal:c}=g.A.useApp(),m=(0,k.CX)(),f=(0,k.eZ)(),K=(0,x.hd)(),w=null===m||void 0===m||null===(n=m._config)||void 0===n?void 0:n.accessKey,{unitedAllowedPermissionByVolume:N}=U(f,K.id,w),{vhostInfo:j}=(0,x.Bk)(),{getErrorMessage:T}=(0,v.B7)(),{startSessionWithDefault:D,upsertSessionNotification:z}=(0,$.GQ)(),{upsertNotification:C}=(0,b.js)(),{systemSSHImage:B,systemSSHImageInfo:O}=(()=>{const e=(0,t.c)(11),[n,l]=(0,P.fp)(V),[a,r]=(0,P.fp)(E),o=(0,S.useRelayEnvironment)();let i;e[0]!==o||e[1]!==l||e[2]!==r||e[3]!==n?(i=()=>{void 0===n&&(0,S.fetchQuery)(o,A,{installed:!0},{fetchPolicy:"store-or-network"}).toPromise().then(L).then((async e=>{const n=F().first(e);l(n?(0,I.A_)(n):null),r(n||void 0)})).catch((()=>{l(null)}))},e[0]=o,e[1]=l,e[2]=r,e[3]=n,e[4]=i):i=e[4];const s=(0,h.useEffectEvent)(i);let d,u,c;return e[5]!==s?(d=()=>{s()},e[5]=s,e[6]=d):d=e[6],e[7]===Symbol.for("react.memo_cache_sentinel")?(u=[],e[7]=u):u=e[7],(0,h.useEffect)(d,u),e[8]!==n||e[9]!==a?(c={systemSSHImage:n,systemSSHImageInfo:a},e[8]=n,e[9]=a,e[10]=c):c=e[10],c})();let M;a[4]===Symbol.for("react.memo_cache_sentinel")?(M=J,a[4]=M):M=a[4];const Q=(0,S.useFragment)(M,i),R=null===j||void 0===j||null===(l=j.volume_info[(null===Q||void 0===Q?void 0:Q.host)||""])||void 0===l?void 0:l.sftp_scaling_groups;let q;var H;a[5]!==N||a[6]!==(null===Q||void 0===Q?void 0:Q.host)?(q=F().includes(N[null!==(H=null===Q||void 0===Q?void 0:Q.host)&&void 0!==H?H:""],"mount-in-session"),a[5]=N,a[6]=null===Q||void 0===Q?void 0:Q.host,a[7]=q):q=a[7];const G=q;let X;a[8]!==G||a[9]!==R||a[10]!==s||a[11]!==B||a[12]!==d?(X=()=>G?F().isEmpty(R)?d("data.explorer.NoSFTPSupportingScalingGroup"):B?!s&&B?d("data.explorer.RunSSH/SFTPserver"):"":d("data.explorer.NoImagesSupportingSystemSession"):d("data.explorer.NoPermissionToMountFolder"),a[8]=G,a[9]=R,a[10]=s,a[11]=B,a[12]=d,a[13]=X):X=a[13];const Z=X;let Y,ee,ne,le,ae,re,oe;return a[14]!==Z?(Y=Z(),a[14]=Z,a[15]=Y):Y=a[15],a[16]!==G||a[17]!==R||a[18]!==B?(ee=F().isEmpty(R)||!B||!G,a[16]=G,a[17]=R,a[18]=B,a[19]=ee):ee=a[19],a[20]===Symbol.for("react.memo_cache_sentinel")?(ne=(0,W.jsx)(p.A,{width:"18px",src:"/resources/icons/sftp.png",alt:"SSH / SFTP",preview:!1}),a[20]=ne):ne=a[20],a[21]!==m._config||a[22]!==T||a[23]!==u||a[24]!==c||a[25]!==(null===R||void 0===R?void 0:R[0])||a[26]!==D||a[27]!==B||a[28]!==(null===O||void 0===O?void 0:O.resource_limits)||a[29]!==d||a[30]!==C||a[31]!==z||a[32]!==(null===Q||void 0===Q?void 0:Q.row_id)?(le=async()=>{var e,n,l,a,r;const o={cpu:F().toNumber(null===(e=F().find(null===O||void 0===O?void 0:O.resource_limits,{key:"cpu"}))||void 0===e?void 0:e.min)||2,mem:(null===(n=F().find(null===O||void 0===O?void 0:O.resource_limits,{key:"mem"}))||void 0===n?void 0:n.min)||"0.5g"},i={sessionName:`sftp-${null===Q||void 0===Q?void 0:Q.row_id}`,sessionType:"system",...null!==(l=m._config)&&void 0!==l&&l.systemSSHImage&&null!==(a=m._config)&&void 0!==a&&a.allow_manual_image_name_for_session?{environments:{manual:m._config.systemSSHImage}}:{environments:{version:B||""}},cluster_mode:"single-node",cluster_size:1,mount_ids:[(null===Q||void 0===Q||null===(r=Q.row_id)||void 0===r?void 0:r.replaceAll("-",""))||""],resourceGroup:null===R||void 0===R?void 0:R[0],resource:{cpu:o.cpu<2?2:o.cpu,mem:o.mem}};await D(i).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&z(e.fulfilled,[{key:`sftp-${null===Q||void 0===Q?void 0:Q.row_id}`}]),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const n=e.rejected[0].reason;F().includes(n.message,$.dM.DUPLICATED_SESSION)?C({key:`sftp-${null===Q||void 0===Q?void 0:Q.row_id}`,open:!0}):c.error({title:null===n||void 0===n?void 0:n.title,content:T(n)})}})).catch((e=>{console.error("Unexpected error during session creation:",e),u.error(d("error.UnexpectedError"))}))},a[21]=m._config,a[22]=T,a[23]=u,a[24]=c,a[25]=null===R||void 0===R?void 0:R[0],a[26]=D,a[27]=B,a[28]=null===O||void 0===O?void 0:O.resource_limits,a[29]=d,a[30]=C,a[31]=z,a[32]=null===Q||void 0===Q?void 0:Q.row_id,a[33]=le):le=a[33],a[34]!==s||a[35]!==d?(ae=s&&d("data.explorer.RunSSH/SFTPserver"),a[34]=s,a[35]=d,a[36]=ae):ae=a[36],a[37]!==r||a[38]!==ee||a[39]!==le||a[40]!==ae?(re=(0,W.jsx)(v.Fv,{disabled:ee,icon:ne,action:le,...r,children:ae}),a[37]=r,a[38]=ee,a[39]=le,a[40]=ae,a[41]=re):re=a[41],a[42]!==re||a[43]!==Y?(oe=(0,W.jsx)(y.A,{title:Y,children:re}),a[42]=re,a[43]=Y,a[44]=oe):oe=a[44],oe};var Y=l(25823),ee=l(234),ne=l(94916),le=l(8334),ae=l(78890);const re=e=>{const n=(0,t.c)(26),{vfolderNodeFrgmt:l,titleStyle:a}=e,{token:r}=ee.A.useToken(),{lg:o}=ne.Ay.useBreakpoint();let i;n[0]===Symbol.for("react.memo_cache_sentinel")?(i=s,n[0]=i):i=n[0];const c=(0,S.useFragment)(i,l);let m,g,p,y,f,F,_,k;return n[1]===Symbol.for("react.memo_cache_sentinel")?(m={width:"100%"},n[1]=m):m=n[1],n[2]!==a?(g={flex:1,fontWeight:"normal",...a},n[2]=a,n[3]=g):g=n[3],n[4]!==r.borderRadius||n[5]!==r.colorBorderSecondary||n[6]!==r.fontSizeHeading3||n[7]!==r.fontSizeHeading4||n[8]!==c?(p=c?(0,W.jsx)(Y.A,{vfolderNodeIdenticonFrgmt:c,style:{fontSize:r.fontSizeHeading4}}):(0,W.jsx)(v.OO,{style:{borderColor:r.colorBorderSecondary,borderWidth:1,borderStyle:"solid",width:r.fontSizeHeading3,height:r.fontSizeHeading3,borderRadius:r.borderRadius}}),n[4]=r.borderRadius,n[5]=r.colorBorderSecondary,n[6]=r.fontSizeHeading3,n[7]=r.fontSizeHeading4,n[8]=c,n[9]=p):p=n[9],n[10]!==c?(y=c&&(0,W.jsx)(d.A,{vfolderFrgmt:c,enableLink:!1,component:le.A.Title,level:3,style:{margin:0,width:"100%"},ellipsis:!0,editable:{triggerType:["icon","text"]},inputProps:{size:"large",count:{max:64,show:!0},style:{fontWeight:"normal"}}}),n[10]=c,n[11]=y):y=n[11],n[12]!==g||n[13]!==p||n[14]!==y?(f=(0,W.jsxs)(v.OO,{"data-testid":"folder-explorer-title",gap:"xs",style:g,children:[p,y]}),n[12]=g,n[13]=p,n[14]=y,n[15]=f):f=n[15],n[16]!==o||n[17]!==c?(F=!c||null!==c&&void 0!==c&&c.unmanaged_path?null:(0,W.jsxs)(h.Suspense,{fallback:(0,W.jsx)(ae.A.Button,{active:!0}),children:[(0,W.jsx)(u.A,{children:(0,W.jsx)(G,{vfolderFrgmt:c,showTitle:o})}),(0,W.jsx)(u.A,{children:(0,W.jsx)(Z,{vfolderFrgmt:c,showTitle:o})})]}),n[16]=o,n[17]=c,n[18]=F):F=n[18],n[19]!==F||n[20]!==r.marginSM?(_=(0,W.jsx)(v.OO,{"data-testid":"folder-explorer-actions",justify:"end",gap:r.marginSM,children:F}),n[19]=F,n[20]=r.marginSM,n[21]=_):_=n[21],n[22]!==f||n[23]!==_||n[24]!==r.marginMD?(k=(0,W.jsxs)(v.OO,{"data-testid":"folder-explorer-header",justify:"between",gap:r.marginMD,style:m,children:[f,_]}),n[22]=f,n[23]=_,n[24]=r.marginMD,n[25]=k):k=n[25],k},oe=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],n=[{kind:"Variable",name:"id",variableName:"id"}],l={alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:n,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[l,a],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:n,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[l,a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"3aee063a4b508648c2365ba6c7f0f44a",id:null,metadata:{},name:"VFolderNodeDescriptionPermissionRefreshQuery",operationKind:"query",text:"query VFolderNodeDescriptionPermissionRefreshQuery(\n  $id: String!\n) {\n  vfolder_node(id: $id) {\n    permission\n    permissions\n    id\n  }\n}\n"}}}();oe.hash="36063c8300310d9ef6c369b49127a2a2";const ie=oe,se={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderPermissionCellFragment"},{args:null,kind:"FragmentSpread",name:"useVirtualFolderNodePathFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"f4ca4470ea635f85c8c346eed0a5fe8c"},te=se;var de=l(23054),ue=l(28380);const ce={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useVirtualFolderNodePathFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"439221036e87c57ca3ec1ce737e0cdf7"},me=ce,ge=e=>{const n=(0,S.useFragment)(me,e),[l,a]=F().split(null===n||void 0===n?void 0:n.quota_scope_id,":"),r=(0,v.om)(null===n||void 0===n?void 0:n.id),o=r.slice(0,2),i=r.slice(2,4),s=r.slice(4),t=`${a.replaceAll("-","")}/${o}/${i}/${s.replaceAll("-","")}`;return{quotaScopeType:l,quotaScopeIdWithoutType:a,vfolderId:r,vfolderIdPrefix1:o,vfolderIdPrefix2:i,vfolderIdRest:s,vfolderPath:t}};var pe=l(38728),ye=l(47666),ve=l(56410);const fe=e=>{let{vfolderNodeFrgmt:n}=e;const{quotaScopeType:l,quotaScopeIdWithoutType:a,vfolderId:r,vfolderIdPrefix1:o,vfolderIdPrefix2:i,vfolderIdRest:s}=ge(n),{token:t}=ee.A.useToken();return(0,W.jsxs)(v.OO,{direction:"row",align:"start",justify:"start",wrap:"wrap",gap:3,children:[(0,W.jsx)(v.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"(root)"}),(0,W.jsx)(v.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,W.jsxs)(v.OO,{direction:"column",align:"start",justify:"start",children:[(0,W.jsx)(v.mQ,{monospace:!0,copyable:{text:a},style:{fontSize:"0.9em"},children:F().truncate(a.replaceAll("-",""),{length:15})}),(0,W.jsxs)(v.mQ,{type:"secondary",style:{fontSize:t.fontSizeSM},children:["Quota Scope ID (",F().upperFirst(l),")"]})]}),(0,W.jsx)(v.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,W.jsxs)(v.OO,{direction:"column",align:"start",justify:"start",children:[(0,W.jsxs)(v.OO,{gap:3,children:[(0,W.jsx)(v.mQ,{monospace:!0,style:{fontSize:"0.9em"},children:o}),(0,W.jsx)(v.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,W.jsx)(v.mQ,{monospace:!0,style:{fontSize:"0.9em"},children:i}),(0,W.jsx)(v.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,W.jsx)(v.mQ,{monospace:!0,copyable:{text:r},style:{fontSize:"0.9em"},children:F().truncate(s.replaceAll("-",""),{length:7})})]}),(0,W.jsx)(v.mQ,{type:"secondary",style:{fontSize:t.fontSizeSM},children:"VFolder ID"})]})]})};var Fe=l(11424),he=l(24011),_e=l(77419),Se=l(70127),ke=l.n(Se);const be=e=>{var n;let{vfolderNodeFrgmt:l,onRequestRefresh:a,...r}=e;const{t:o}=(0,_.Bd)(),{token:i}=ee.A.useToken(),{message:s}=g.A.useApp(),{getErrorMessage:t}=(0,v.B7)(),d=(0,S.useRelayEnvironment)(),u=(0,x.hd)(),c=(0,k.CX)(),[m]=(0,de.U6)(),p=(0,ue.ET)({mutationFn:e=>{let{permission:n,id:l}=e;return c.vfolder.update_folder({permission:n},l)}}),y=(0,S.useFragment)(te,l),{vfolderPath:f}=ge(y),h=(0,v.om)(y.id),b=(0,v.YM)([!(null!==y&&void 0!==y&&y.unmanaged_path)&&{key:"path",label:(0,W.jsx)(le.A.Text,{copyable:{text:f},style:{color:i.colorTextLabel},children:o("data.folders.Path")}),children:(0,W.jsx)(fe,{vfolderNodeFrgmt:y})},{key:"status",label:o("data.folders.Status"),children:(0,W.jsx)(ye.A,{color:y.status?ve.C[y.status]:void 0,children:F().toUpper(y.status||"")})},{key:"host",label:o("data.Host"),children:y.host},{key:"ownership_type",label:o("data.folders.Ownership"),children:"user"===(null===y||void 0===y?void 0:y.ownership_type)?(0,W.jsxs)(v.OO,{gap:"xs",children:[(0,W.jsx)(le.A.Text,{children:o("data.User")}),(0,W.jsx)(Fe.A,{style:{color:i.colorTextTertiary}})]}):(0,W.jsxs)(v.OO,{gap:"xs",children:[(0,W.jsx)(le.A.Text,{children:o("data.Project")}),(0,W.jsx)(v.Ob,{style:{color:i.colorTextTertiary}})]})},((null===y||void 0===y?void 0:y.user)===m.uuid||c.is_admin&&(null===y||void 0===y?void 0:y.group)===(null===u||void 0===u?void 0:u.id))&&{key:"permission",label:o("data.folders.MountPermission"),children:(0,W.jsx)(pe.A,{defaultValue:"wd"===y.permission?"rw":y.permission,options:[{value:"ro",label:o("data.ReadOnly")},{value:"rw",label:o("data.ReadWrite")}],onChange:e=>{p.mutate({permission:e,id:h},{onSuccess:()=>{s.success(o("data.permission.PermissionModified")),document.dispatchEvent(new CustomEvent("backend-ai-folder-updated")),(0,S.fetchQuery)(d,ie,{id:y.id}).toPromise(),null===a||void 0===a||a()},onError:e=>{s.error(t(e))}})},popupMatchSelectWidth:!1})},{key:"owner",label:o("data.folders.Owner"),children:(null===y||void 0===y?void 0:y.user)===(null===m||void 0===m?void 0:m.uuid)||c.is_admin&&(null===y||void 0===y?void 0:y.group)===(null===u||void 0===u?void 0:u.id)?(0,W.jsx)(v.OO,{justify:"start",children:(0,W.jsx)(he.A,{})}):null},null!==y.user_email&&{key:"user_email",label:o("data.User"),children:(0,W.jsx)(le.A.Text,{copyable:!0,children:y.user_email})},null!==y.group_name&&{key:"group_name",label:o("data.Project"),children:y.group_name},{key:"cloneable",label:o("data.folders.Cloneable"),children:y.cloneable?(0,W.jsx)(v.OO,{justify:"start",children:(0,W.jsx)(he.A,{})}):null},{key:"max_size",label:o("data.folders.MaxSize"),children:y.max_size?null===(n=(0,I.Gh)(y.max_size,"g",2))||void 0===n?void 0:n.displayValue:"\u221e"},{key:"usage",label:o("data.UsageMode"),children:y.usage_mode},{key:"created_at",label:o("data.folders.CreatedAt"),children:ke()(y.created_at).format("lll")}]);return(0,W.jsx)(_e.A,{bordered:!0,column:1,size:"small",items:b,styles:{content:{wordBreak:"break-word",overflowWrap:"break-word"}},...r})};var xe=l(54575),Ke=l(74485),we=l(60402);const Ne=(0,l(11753).rU)((e=>{let{css:n}=e;return{baiModalHeader:n`
    .ant-modal-title {
      width: 100%;
    }
  `}})),Pe=e=>{var n,l;let{vfolderID:a,onRequestClose:i,...s}=e;const{t:t}=(0,_.Bd)(),{token:d}=ee.A.useToken(),{xl:u}=ne.Ay.useBreakpoint(),{styles:c}=Ne(),m=(0,h.useRef)(null),[g,p]=(0,k.zu)(),y=(0,k.CX)(),f=(0,k.eZ)(),b=(0,x.hd)(),K=null===y||void 0===y||null===(n=y._config)||void 0===n?void 0:n.accessKey,w=(0,h.useRef)(null),{unitedAllowedPermissionByVolume:N}=U(f,b.id,K),P=(0,h.useRef)(null),j=(0,h.useDeferredValue)(s.open),{vfolder_node:I}=(0,S.useLazyLoadQuery)(r,{vfolderGlobalId:(0,v.wc)("VirtualFolderNode",a)},{fetchPolicy:j&&s.open?"network-only":"store-only"}),{uploadStatus:A,uploadFiles:T}=(0,o.useFileUploadManager)(null===I||void 0===I?void 0:I.id,(null===I||void 0===I?void 0:I.name)||void 0);(0,v.$$)((()=>{var e;null===(e=w.current)||void 0===e||e.refetch()}),A&&!F().isEmpty(null===A||void 0===A?void 0:A.pendingFiles)?5e3:null),(0,h.useEffect)((()=>{A&&F().isEmpty(null===A||void 0===A?void 0:A.pendingFiles)&&p()}),[A,p]);const V=F().includes(N[null!==(l=null===I||void 0===I?void 0:I.host)&&void 0!==l?l:""],"download-file"),E=F().includes(null===I||void 0===I?void 0:I.permissions,"delete_content"),D=F().includes(null===I||void 0===I?void 0:I.permissions,"write_content"),z=null!==I&&void 0!==I&&I.unmanaged_path?(0,W.jsx)(xe.A,{message:t("explorer.NoExplorerSupportForUnmanagedFolder"),showIcon:!0}):I?(0,W.jsx)(v.Gt,{ref:w,targetVFolderId:a,fetchKey:g,onUpload:(e,n)=>{T(e,a,n)},enableDownload:V,enableDelete:E,enableWrite:D,tableProps:{scroll:u?{x:"max-content"}:{x:"max-content",y:"calc(100vh - 400px)"}},style:{paddingBottom:u?d.paddingLG:0},fileDropContainerRef:P}):null,C=I?(0,W.jsx)(be,{vfolderNodeFrgmt:I,onRequestRefresh:()=>{var e;null===(e=m.current)||void 0===e||e._fetchVFolder()}}):null;return(0,W.jsx)(v.Ib,{className:c.baiModalHeader,width:"90%",keyboard:!0,destroyOnHidden:!0,footer:null,style:{maxWidth:"1600px"},styles:{body:{height:"100vh"}},title:I?(0,W.jsx)(re,{titleStyle:{zIndex:d.zIndexPopupBase+2},vfolderNodeFrgmt:I}):null,bodyProps:{ref:P},onCancel:()=>{i()},...s,children:(0,W.jsx)(h.Suspense,{fallback:(0,W.jsx)(ae.A,{active:!0}),children:j!==s.open?(0,W.jsx)(ae.A,{active:!0}):(0,W.jsxs)(v.OO,{direction:"column",gap:"lg",align:"stretch",children:[I?(null===b||void 0===b?void 0:b.id)!==(null===I||void 0===I?void 0:I.group)&&null!==I&&void 0!==I&&I.group?(0,W.jsx)(xe.A,{message:t("data.NotInProject"),type:"warning",showIcon:!0}):null:(0,W.jsx)(xe.A,{message:t("explorer.FolderNotFoundOrNoAccess"),type:"error",showIcon:!0}),u?(0,W.jsxs)(Ke.A,{style:{gap:d.size},layout:"horizontal",children:[(0,W.jsx)(Ke.A.Panel,{resizable:!1,children:z}),(0,W.jsx)(Ke.A.Panel,{defaultSize:500,children:C})]}):(0,W.jsxs)(v.OO,{direction:"column",align:"stretch",children:[z,(0,W.jsx)(we.A,{style:{borderColor:d.colorBorderSecondary}}),C]}),(0,W.jsx)("div",{style:{display:"none"},children:(0,W.jsx)("backend-ai-folder-explorer",{ref:m,active:!0,vfolderID:a})})]})})})}},94252:(e,n,l)=>{l.d(n,{Ay:()=>f,tt:()=>v,uD:()=>g});var a=l(43224),r=l(40370),o=l(89881),i=l(85829),s=l(43749),t=l.n(s),d=(l(21481),l(51569)),u=l(66845);const c=1024,m=65535,g=e=>{let{inValid:n,value:l,...a}=e;return(0,u.jsx)(i.A,{color:!n&&p(l)?void 0:"red",...a})},p=e=>{if(y(e)){const n=e.split(":"),[l,a]=n.map((e=>parseInt(e)));return l>=c&&a<=m}return e===parseInt(e).toString()&&parseInt(e)>=c&&parseInt(e)<=m},y=e=>{const n=e.split(":");if(2===n.length){const[e,l]=n.map((e=>parseInt(e)));return e<=l}return!1},v=e=>t().flatten(t().map(e,(e=>y(e)?(e=>{const[n,l]=e.split(":").map((e=>parseInt(e)));return t().range(n,l+1)})(e):parseInt(e)))),f=e=>{let{name:n="ports",...l}=e;const{t:i}=(0,d.Bd)(),s=(0,a.CX)(),p=r.A.useFormInstance();return(0,u.jsx)(r.A.Item,{label:i("session.launcher.PreOpenPortTitle"),name:n,tooltip:(0,u.jsx)(d.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:i("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,n)=>v(n).length<=s._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(i("session.launcher.PreOpenPortMaxCountLimit",{count:s._config.maxCountForPreopenPorts})))}),()=>({validator:(e,n)=>t().every(n,(e=>parseInt(e).toString()===e||y(e)))?Promise.resolve():Promise.reject(new Error(i("session.launcher.InvalidPortFormat")))}),()=>({validator(e,n){const l=v(n);return t().every(l,(e=>e>=c&&e<=m))?Promise.resolve():Promise.reject(new Error(i("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,n){const l=v(n);return t().uniq(l).length===l.length?Promise.resolve():Promise.reject(new Error(i("session.launcher.DuplicatedPort")))}})],...l,children:(0,u.jsx)(o.A,{mode:"tags",tagRender:e=>{const l=t().filter(v(p.getFieldValue(n)),(n=>n===parseInt(e.value))).length>1;return(0,u.jsx)(g,{inValid:l,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})}},43352:(e,n,l)=>{l.d(n,{dM:()=>y,GQ:()=>v});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],n=[{kind:"Variable",name:"id",variableName:"id"}],l={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useStartSessionCreationQuery",selections:[{alias:null,args:n,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"BAINodeNotificationItemFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useStartSessionCreationQuery",selections:[{alias:null,args:n,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[l,{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[a,r,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},o,{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commit_status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"agent_id",storageKey:null},l,o,{alias:null,args:null,kind:"ScalarField",name:"cluster_idx",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_role",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_hostname",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"vfolder_mounts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_data",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"queue_position",storageKey:null}],type:"ComputeSessionNode",abstractKey:null},{kind:"InlineFragment",selections:[a,r],type:"VirtualFolderNode",abstractKey:null}],type:"Node",abstractKey:"__isNode"}],storageKey:null}]},params:{cacheID:"f782d7867b29fc40f57266d16809b260",id:null,metadata:{},name:"useStartSessionCreationQuery",operationKind:"query",text:'query useStartSessionCreationQuery(\n  $id: GlobalIDField!\n) {\n  compute_session_node(id: $id) {\n    ...BAINodeNotificationItemFragment\n    id\n  }\n}\n\nfragment AppLauncherModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  service_ports\n  access_key\n}\n\nfragment BAIComputeSessionNodeNotificationItemFragment on ComputeSessionNode {\n  row_id\n  id\n  name\n  status\n  ...SessionActionButtonsFragment\n  ...SessionStatusTagFragment\n}\n\nfragment BAINodeNotificationItemFragment on Node {\n  __isNode: __typename\n  ... on ComputeSessionNode {\n    __typename\n    status\n    name\n    row_id\n    ...BAIComputeSessionNodeNotificationItemFragment\n  }\n  ... on VirtualFolderNode {\n    __typename\n    status\n  }\n  id\n}\n\nfragment ContainerCommitModalFragment on ComputeSessionNode {\n  id\n  name\n  row_id\n}\n\nfragment ContainerLogModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  status\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        id\n        row_id\n        container_id\n        cluster_idx\n        cluster_role\n        cluster_hostname\n      }\n    }\n  }\n}\n\nfragment SFTPConnectionInfoModalFragment on ComputeSessionNode {\n  row_id\n  vfolder_mounts\n}\n\nfragment SessionActionButtonsFragment on ComputeSessionNode {\n  id\n  name\n  row_id\n  type\n  status\n  access_key\n  service_ports\n  commit_status\n  user_id\n  ...TerminateSessionModalFragment\n  ...ContainerLogModalFragment\n  ...ContainerCommitModalFragment\n  ...AppLauncherModalFragment\n  ...SFTPConnectionInfoModalFragment\n  ...useBackendAIAppLauncherFragment\n}\n\nfragment SessionStatusTagFragment on ComputeSessionNode {\n  id\n  status\n  status_info\n  status_data\n  queue_position @since(version: "25.13.0")\n}\n\nfragment TerminateSessionModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  scaling_group\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        container_id\n        agent_id\n        id\n      }\n    }\n  }\n}\n\nfragment useBackendAIAppLauncherFragment on ComputeSessionNode {\n  name\n  row_id\n  vfolder_mounts\n}\n'}}}();a.hash="7a350248b5a833005f531bd8caa3adec";const r=a;var o=l(43224),i=l(41633),s=l(16507),t=l(45045),d=l(43749),u=l.n(d),c=l(51569),m=l(69775),g=l(94252),p=l(88144);const y={DUPLICATED_SESSION:"DUPLICATED_SESSION"},v=()=>{var e,n;const{t:l}=(0,c.Bd)(),a=(0,s.hd)(),{upsertNotification:d}=(0,i.js)(),v=(0,m.useRelayEnvironment)(),h=(0,o.CX)(),_=h.supports("mount-by-id"),S=null!==(e=null===h||void 0===h?void 0:h.supports("batch-timeout"))&&void 0!==e&&e,[k]=(0,s.zL)(),b={sessionType:"interactive",allocationPreset:"auto-select",hpcOptimization:{autoEnabled:!0},batch:{enabled:!1,command:void 0,scheduleDate:void 0,...S&&{timeoutEnabled:!1,timeout:void 0,timeoutUnit:"s"}},envvars:[],...(null===(n=h._config)||void 0===n?void 0:n.default_session_environment)&&{environments:F(h._config.default_session_environment)},...p.jh,resourceGroup:k||void 0},x=async e=>{var n,r,o,i,s,d,c,m,p,v,F;const k=e.environments.manual||e.environments.version,[b,x]=k?k.split("@"):["",""],K={sessionName:u().isEmpty(e.sessionName)?f():e.sessionName,kernelName:b,architecture:x,resources:{enqueueOnly:!0,group_name:null!==(n=e.owner)&&void 0!==n&&n.enabled?e.owner.project:a.name,domain:null!==(r=e.owner)&&void 0!==r&&r.enabled?e.owner.domainName:h._config.domainName,type:e.sessionType,cluster_mode:e.cluster_mode,cluster_size:e.cluster_size,maxWaitSeconds:15,...null!==(o=e.owner)&&void 0!==o&&o.enabled?{owner_access_key:e.owner.accesskey}:{},..."batch"===e.sessionType?{starts_at:e.batch.enabled?e.batch.scheduleDate:void 0,startupCommand:e.batch.command}:{},...e.bootstrap_script?{bootstrap_script:e.bootstrap_script}:{},...S&&null!==e&&void 0!==e&&null!==(i=e.batch)&&void 0!==i&&i.timeoutEnabled&&!u().isUndefined(null===e||void 0===e||null===(s=e.batch)||void 0===s?void 0:s.timeout)?{batchTimeout:u().toString(e.batch.timeout)+(null===e||void 0===e||null===(d=e.batch)||void 0===d?void 0:d.timeoutUnit)}:void 0,config:{resources:{cpu:e.resource.cpu,mem:e.resource.mem,...null!==(c=e.resource)&&void 0!==c&&c.acceleratorType&&null!==(m=e.resource)&&void 0!==m&&m.accelerator&&(null===(p=e.resource)||void 0===p?void 0:p.accelerator)>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0},scaling_group:null!==(v=e.owner)&&void 0!==v&&v.enabled?e.owner.project:e.resourceGroup,resource_opts:{shmem:e.resource.shmem},[_?"mount_ids":"mounts"]:e.mount_ids,[_?"mount_id_map":"mount_map"]:e.mount_id_map,environ:{...u().fromPairs(e.envvars.map((e=>[e.variable,e.value]))),...e.hpcOptimization.autoEnabled?{}:u().omit(e.hpcOptimization,"autoEnabled")},preopen_ports:(0,g.tt)(e.ports),...!h.supports("agent-select")||null!==h&&void 0!==h&&null!==(F=h._config)&&void 0!==F&&F.hideAgents||void 0===e.agent||u().isEqual(u().castArray(e.agent),["auto"])?void 0:{agent_list:u().chain(e.agent).castArray().filter((e=>!!e)).value()}}}},w=u().map(u().range(e.num_of_sessions||1),(n=>{const a=(e.num_of_sessions||1)>1?`${K.sessionName}-${(0,t.kX)()}-${n}`:K.sessionName;return h.createIfNotExists(K.kernelName,a,K.resources,void 0,K.architecture).then((e=>{if(null===e||void 0===e||!e.created){throw new Error(y.DUPLICATED_SESSION)}return e})).catch((e=>{var n;throw null!==e&&void 0!==e&&null!==(n=e.message)&&void 0!==n&&n.includes("The session already exists")?new Error(l("session.launcher.SessionAlreadyExists")):e}))}));return Promise.allSettled(w).then((async e=>u().groupBy(e,"status")))};return{startSession:x,startSessionWithDefault:e=>{const n=u().merge({},b,e);return x(n)},defaultFormValues:b,upsertSessionNotification:async(e,n)=>{const l=u().map(e,(e=>{const l=e.value;return(0,m.fetchQuery)(v,r,{id:(0,t.wc)("ComputeSessionNode",l.sessionId)}).toPromise().then((e=>{var a;const r=null!==(a=null===e||void 0===e?void 0:e.compute_session_node)&&void 0!==a?a:null;r&&d({key:`session-launcher:${l.sessionId}`,node:r,open:!0,duration:0,...null===n||void 0===n?void 0:n[0]},null===n||void 0===n?void 0:n[1])}))}));return Promise.allSettled(l)}}},f=()=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let l=0;l<8;l++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},F=e=>e.includes(":")?{version:e}:{environment:e}}}]);
//# sourceMappingURL=3293.9c8ebf61.chunk.js.map