"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[6735],{46735:(e,t,n)=>{n.d(t,{A:()=>ye});var o=n(72375),i=n(23441),l=n(53350);const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[t,o]=(0,l.useState)(0);return(0,l.useEffect)((()=>{(0,l.startTransition)((()=>{(async e=>{const{encode:t}=await n.e(2471).then(n.bind(n,32471));return t(e).length})(e).then(o).catch((()=>{o(e.length)}))}))}),[e]),t};var a=n(72338),r=n(11383),d=n(60598);const c=e=>{let{style:t,loading:n,autoFocus:o,onStop:i,onSend:s,...a}=e;const c=(0,l.useRef)(null);return(0,l.useEffect)((()=>{o&&c.current&&c.current.focus()}),[o]),(0,d.jsx)(r.A,{ref:c,...a,loading:n,onSubmit:()=>{null===s||void 0===s||s()},onCancel:()=>{null===i||void 0===i||i()},submitType:"enter"})};var u=n(1581),p=n(46976),h=n.n(p),m=n(91788);const g=e=>{let{models:t,allowCustomModel:n,...o}=e;const{t:i}=(0,m.Bd)();return(0,d.jsx)(u.A,{placeholder:i("chatui.SelectModel"),style:{fontWeight:"normal"},showSearch:!0,options:h().concat(n?[{label:"Custom",value:"custom"}]:[],h().chain(t).groupBy("group").mapValues((e=>h().map(e,(e=>({label:e.label,value:e.name}))))).map(((e,t)=>({label:"undefined"===t?"Others":t,options:e}))).value()),popupMatchSelectWidth:!1,...o})};var x=n(82919),y=n(52335),v=n(31456),j=n(167),f=n(37542);const A=e=>{let{copyable:t,defaultIcon:n,...o}=e;const[i,s]=(0,l.useState)(!1);return(0,l.useEffect)((()=>{if(i){const e=setTimeout((()=>{s(!1)}),2e3);return()=>clearTimeout(e)}}),[i]),(0,d.jsx)(x.A,{title:i?"Copied!":"Copy",open:!!i||void 0,children:(0,d.jsx)(f.CopyToClipboard,{text:(null===t||void 0===t?void 0:t.text)||"",onCopy:async()=>{s(!0)},children:(0,d.jsx)(y.Ay,{icon:i?(0,d.jsx)(v.A,{}):n||(0,d.jsx)(j.A,{}),...o})})})};var b=n(50128),C=n(20418),S=(n(92134),n(23409)),w=n(28304),k=n(83376),T=n(22608),M=n(80557),I=n(52737);const{Text:L}=b.A,R=e=>{let{children:t}=e;return(0,d.jsx)(S.o,{remarkPlugins:[M.A,I.A],rehypePlugins:[T.A],components:{p(e){let{node:t,...n}=e;return(0,d.jsx)("p",{...n,style:{whiteSpace:"pre-wrap"}})},code(e){const{children:t,className:n,node:o,ref:i,...l}=e,s=/language-(\w+)/.exec(n||""),a=String(t).replace(/\n$/,"");return s?(0,d.jsx)(C.A,{title:(0,d.jsx)(L,{style:{fontWeight:"normal"},type:"secondary",children:s[1]}),type:"inner",size:"small",extra:(0,d.jsx)(A,{type:"text",copyable:{text:"s"}}),styles:{body:{padding:0},header:{margin:0}},children:(0,d.jsx)("div",{style:{margin:"-0.5em 0",width:"100%"},children:(0,d.jsx)(E,{ref:i,...l,PreTag:"div",language:s[1],style:k.A,wrapLongLines:!0,wrapLines:!0,children:a})})}):(0,d.jsx)("code",{...l,className:n,children:t})}},children:t})},D=e=>{let{children:t,...n}=e;return(0,d.jsx)(w.A,{...n,children:t})},E=l.memo(D),B=l.memo(R);var z=n(79429),U=n(65839),F=n(9571),H=n(69546),_=n(38385),W=n(85391),O=n(49978),V=n(78502),$=n.n(V),N=n(48787),q=n.n(N),K=n(2660),P=n.n(K);$().extend(q()),$().extend(P());const J=e=>{let{extra:t,message:n,placement:o="left",containerStyle:i,enableExtraHover:s,isStreaming:r}=e;const{token:c}=F.A.useToken(),{t:u}=(0,m.Bd)(),[p,g]=(0,l.useState)(!1),x=(0,U.A)(n.reasoning,{wait:50}),y=(0,U.A)(n.content,{wait:50});return(0,d.jsxs)(a.A,{direction:"left"===o?"row":"row-reverse",justify:"start",align:"baseline",style:{marginLeft:"left"===o?"0":"15%",marginRight:"right"===o?"0":20,...i},gap:"sm",onMouseEnter:()=>g(!0),onMouseLeave:()=>g(!1),children:["user"!==n.role?(0,d.jsx)(H.A,{icon:"\ud83e\udd16",style:{fontSize:c.fontSizeHeading3}}):null,(0,d.jsxs)(a.A,{direction:"column",align:"left"===o?"start":"end",wrap:"wrap",style:{flex:1},gap:"xs",children:[h().map(n.experimental_attachments,((e,t)=>h().includes(null===e||void 0===e?void 0:e.contentType,"image/")?(0,d.jsx)(a.A,{style:{border:"none",textAlign:"end"},align:"end",children:(0,d.jsx)(_.A,{src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name,style:{maxWidth:"50vw",maxHeight:"12vh",borderRadius:c.borderRadius}},`${null===n||void 0===n?void 0:n.id}-${t}`)}):(0,d.jsx)(z.A.FileCard,{item:{uid:`${null===n||void 0===n?void 0:n.id}-${t}`,name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.url),type:null===e||void 0===e?void 0:e.contentType,description:null===e||void 0===e?void 0:e.name,url:null===e||void 0===e?void 0:e.url}},t))),(0,d.jsxs)(a.A,{align:"stretch",direction:"column",style:{borderRadius:c.borderRadius,borderColor:c.colorBorderSecondary,borderWidth:c.lineWidth,padding:"1em",paddingTop:0,paddingBottom:0,backgroundColor:"user"!==n.role?c.colorBgContainer:c.colorBgContainerDisabled,maxWidth:"100%",width:h().trim(n.reasoning)?"100%":"auto"},children:[h().trim(n.reasoning)&&(0,d.jsx)(W.A,{style:{marginTop:c.margin,width:"100%"},items:[{key:"reasoning",label:h().isEmpty(y)?(0,d.jsxs)(a.A,{gap:"xs",children:[(0,d.jsx)(b.A.Text,{children:u("chatui.Thinking")}),(0,d.jsx)(O.A,{size:"small"})]}):(0,d.jsx)(b.A.Text,{children:u("chatui.ViewReasoning")}),children:(0,d.jsx)(B,{children:x})}]}),(0,d.jsx)(B,{children:y+(r?"\n\u25cf":"")})]}),(0,d.jsx)(a.A,{style:{fontSize:c.fontSizeSM,...s?{opacity:p?1:0,transition:"opacity 0.2s",transitionDelay:p?"0s":"0.2s"}:{}},children:t})]})]})};var Y=n(68098),G=n(7126);const Q=e=>{let{autoScroll:t,atBottom:n,lastMessageContent:o,...i}=e;const s=(0,Y.E)(i.onScrollToBottom);return(0,l.useEffect)((()=>{n&&t&&(null===s||void 0===s||s("auto"))}),[n,t,o,s]),(0,d.jsx)(y.Ay,{icon:(0,d.jsx)(G.A,{}),shape:"circle",onClick:()=>{s&&s("click")}})};var X=n(85064),Z=n(2646);const ee=e=>{let{messages:t,isStreaming:n}=e;const o=(0,l.useRef)(null),[i,s]=(0,l.useState)(!0),{token:r}=F.A.useToken(),c="undefined"!==typeof window?1.5*window.innerHeight:0;return(0,d.jsxs)(a.A,{direction:"column",align:"stretch",style:{height:"100%",flex:1},children:[(0,d.jsx)(Z.aY,{atBottomStateChange:s,atBottomThreshold:60,computeItemKey:(e,t)=>t.id,data:t,followOutput:"auto",initialTopMostItemIndex:(null===t||void 0===t?void 0:t.length)-1,itemContent:(e,o)=>(0,d.jsx)(J,{message:o,placement:"user"===o.role?"right":"left",containerStyle:{paddingLeft:r.paddingMD,paddingRight:r.paddingMD,paddingTop:0===e?r.paddingMD:0,paddingBottom:e===t.length-1?r.paddingMD:0},isStreaming:"user"!==o.role&&n&&e===t.length-1,enableExtraHover:"user"===o.role,extra:"user"!==o.role?(0,d.jsx)(X.Ay,{children:(0,d.jsx)(A,{type:"text",size:"small",copyable:{text:o.content}})}):(0,d.jsx)(X.Ay,{children:null})},o.id),overscan:c,ref:o}),(0,d.jsx)("div",{style:{position:"absolute",right:"50%",transform:"translateX(+50%)",bottom:r.marginSM,opacity:i?0:1,transition:"opacity 0.2s",transitionDelay:i?"0s":"0.2s"},children:(0,d.jsx)(Q,{atBottom:i,autoScroll:n,onScrollToBottom:e=>{const t=o.current;switch(e){case"auto":null===t||void 0===t||t.scrollToIndex({align:"end",behavior:"auto",index:"LAST"});break;case"click":null===t||void 0===t||t.scrollToIndex({align:"end",behavior:"smooth",index:"LAST"})}},lastMessageContent:h().get(h().last(t),"content")})})]})};var te=n(93232),ne=n(46538),oe=n(10424),ie=n(51282),le=n(27319),se=n(12943),ae=n(56431),re=n(51847),de=n(27857),ce=n(79773),ue=n(9712),pe=n(13170),he=n(83978),me=n(58325),ge=n(24798),xe=n(2822);const ye=e=>{var t;let{models:n=[],endpointId:u,baseURL:p,headers:x,credentials:v,apiKey:j,fetchOnClient:f,allowCustomModel:A,alert:S,leftExtra:w,inputMessage:k,inputAttachment:T,submitKey:M,onInputChange:I,onAttachmentChange:L,onSubmitChange:R,showCompareMenuItem:D,modelToken:E,...B}=e;const U=(0,i.f0)(),[H,_]=(0,l.useState)(!1),[W,O]=(0,l.useState)([]),[V,$]=(0,re.A)(B,{valuePropName:"modelId",trigger:"onModelChange",defaultValue:null===n||void 0===n||null===(t=n[0])||void 0===t?void 0:t.id}),N=(0,l.useRef)(null),q=(0,l.useRef)(null),{messages:K,error:P,input:J,setInput:Y,stop:G,isLoading:Q,append:X,setMessages:Z}=(0,ne.Y_)({api:p,headers:x,credentials:v,body:{modelId:V},fetch:async(e,t)=>{if(f||"custom"===V){var n,o,i;const e=JSON.parse(null===t||void 0===t?void 0:t.body),l=(0,te.r)({baseURL:A?null===(n=N.current)||void 0===n?void 0:n.getFieldValue("baseURL"):p,apiKey:(A?null===(o=N.current)||void 0===o?void 0:o.getFieldValue("token"):j)||"dummy"}),s=(0,de.gM)({abortSignal:(null===t||void 0===t?void 0:t.signal)||void 0,model:(0,de.ae)({model:l(A?null===(i=N.current)||void 0===i?void 0:i.getFieldValue("modelId"):V),middleware:(0,de.Ol)({tagName:"think"})}),messages:null===e||void 0===e?void 0:e.messages});return fe(Date.now()),s.toDataStreamResponse({sendReasoning:!0})}return fetch(e,t)}}),{token:ye}=F.A.useToken(),{t:ve}=(0,m.Bd)(),[je,fe]=(0,l.useState)(null);(0,l.useEffect)((()=>{h().isUndefined(k)||Y(k)}),[k,Y]);(0,l.useEffect)((()=>{(e=>{h().isUndefined(e)||h().isEqual(W,e)||(O(e),_(!0))})(T)}),[T]),(0,l.useEffect)((()=>{if(!h().isUndefined(M)&&J){const e={};h().isEmpty(W)||(e.experimental_attachments=(0,o.bJ)(W)),X({role:"user",content:J},e)}}),[M]);const Ae=s(J),be=(0,l.useMemo)((()=>h().map(K,(e=>null===e||void 0===e?void 0:e.content)).join("")),[K]),Ce=Ae+s(be),Se=(0,l.useMemo)((()=>{const e=h().last(K);return"assistant"===(null===e||void 0===e?void 0:e.role)?null===e||void 0===e?void 0:e.content:""}),[K]),we=s(Se),ke=(0,l.useMemo)((()=>we>0&&je?we/((Date.now()-je)/1e3):0),[we,je]),Te=(0,o.LY)([D&&{key:"compare",label:ve("chatui.CompareWithOtherModels"),icon:(0,d.jsx)(xe.A,{}),onClick:()=>{U(`/serving?tab=chatting&endpointId=${u}&modelId=${V}`)}},D&&{type:"divider"},{key:"clear",danger:!0,label:ve("chatui.DeleteChatHistory"),icon:(0,d.jsx)(oe.A,{}),onClick:()=>{Z([])}}]);return(0,d.jsxs)(C.A,{ref:q,bordered:!0,extra:[],...B,title:(0,d.jsx)(a.A,{direction:"column",align:"stretch",gap:"sm",children:(0,d.jsxs)(a.A,{direction:"row",gap:"xs",children:[w,(0,d.jsx)(g,{models:n,value:V,onChange:$,allowCustomModel:A}),(0,d.jsx)(ce.A,{menu:{items:Te},trigger:["click"],children:(0,d.jsx)(y.Ay,{type:"link",onClick:e=>e.preventDefault(),icon:(0,d.jsx)(ie.A,{}),style:{color:ye.colorTextSecondary,width:ye.sizeMS}})})]})}),style:{height:"100%",width:"100%",display:"flex",flexDirection:"column"},styles:{body:{backgroundColor:ye.colorFillQuaternary,borderRadius:0,flex:1,display:"flex",flexDirection:"column",padding:0,height:"50%",position:"relative"},actions:{paddingLeft:ye.paddingContentHorizontal,paddingRight:ye.paddingContentHorizontal},header:{zIndex:1}},actions:[(0,d.jsx)(c,{autoFocus:!0,value:J,placeholder:"Say something...",header:(0,d.jsx)(r.A.Header,{closable:!1,title:ve("chatui.Attachments"),open:!!H&&!h().isEmpty(W),onOpenChange:_,styles:{content:{padding:0}},children:(0,d.jsx)(z.A,{beforeUpload:()=>!1,getDropContainer:()=>q.current,accept:"image/*,text/*",items:W,onChange:e=>{let{fileList:t}=e;O(t),null===L||void 0===L||L(t)},placeholder:e=>"drop"===e?{title:ve("chatui.DropFileHere")}:{icon:(0,d.jsx)(le.A,{}),title:ve("chatui.UploadFiles"),description:ve("chatui.UploadFilesDescription")}})}),prefix:(0,d.jsx)(z.A,{beforeUpload:()=>!1,getDropContainer:()=>q.current,accept:"image/*,text/*",items:W,onChange:e=>{let{fileList:t}=e;O(t),null===L||void 0===L||L(t),_(!0)},placeholder:e=>"drop"===e?{title:ve("chatui.DropFileHere")}:{icon:(0,d.jsx)(le.A,{}),title:ve("chatui.UploadFiles"),description:ve("chatui.UploadFilesDescription")},children:(0,d.jsx)(ue.A,{dot:!h().isEmpty(W)&&!H,children:(0,d.jsx)(y.Ay,{type:"text",icon:(0,d.jsx)(se.A,{})})})}),onChange:e=>{Y(e),I&&I(e)},loading:Q,onStop:()=>{G()},onSend:()=>{if(J||!h().isEmpty(W)){const e={};h().isEmpty(W)||(e.experimental_attachments=(0,o.bJ)(W)),X({role:"user",content:J},e),setTimeout((()=>{Y(""),O([]),_(!1)}),0),null===R||void 0===R||R()}},style:{flex:1}})],children:[(0,d.jsx)(a.A,{direction:"row",style:{padding:ye.paddingSM,paddingRight:ye.paddingContentHorizontalLG,paddingLeft:ye.paddingContentHorizontalLG,backgroundColor:ye.colorBgContainer,display:A&&"custom"===V?"flex":"none"},children:(0,d.jsxs)(pe.A,{ref:N,layout:"horizontal",size:"small",requiredMark:"optional",style:{flex:1},initialValues:{baseURL:p,token:E},children:[S?(0,d.jsx)("div",{style:{marginBottom:ye.size},children:S}):null,(0,d.jsx)(pe.A.Item,{label:"baseURL",name:"baseURL",rules:[{type:"url"},{required:!0}],children:(0,d.jsx)(he.A,{placeholder:"https://domain/v1"})}),(0,d.jsx)(pe.A.Item,{label:"Model ID",name:"modelId",rules:[{required:!0}],children:(0,d.jsx)(he.A,{placeholder:"llm-model"})}),(0,d.jsx)(pe.A.Item,{label:"Token",name:"token",children:(0,d.jsx)(he.A,{})})]},p)}),h().isEmpty(null===P||void 0===P?void 0:P.message)?null:(0,d.jsx)(me.A,{message:null===P||void 0===P?void 0:P.message,type:"error",showIcon:!0,style:{margin:ye.marginSM},closable:!0}),(0,d.jsx)(ee,{messages:K,isStreaming:Q}),(0,d.jsx)(a.A,{justify:"end",align:"end",style:{margin:ye.marginSM},children:(0,d.jsx)(ge.A,{children:(0,d.jsxs)(a.A,{gap:"xs",children:[(0,d.jsx)(ae.A,{}),(0,d.jsxs)(a.A,{gap:"xxs",children:[(0,d.jsx)(b.A.Text,{children:ke.toFixed(2)}),(0,d.jsx)(b.A.Text,{type:"secondary",children:"tok/s"})]}),(0,d.jsxs)(a.A,{gap:"xxs",children:[(0,d.jsx)(b.A.Text,{children:Ce}),(0,d.jsx)(b.A.Text,{type:"secondary",children:"total tokens"})]})]})})})]})}}}]);
//# sourceMappingURL=6735.c4ecf4ba.chunk.js.map