"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[152],{13747:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpointId"}],n=[{kind:"Variable",name:"endpoint_id",variableName:"endpointId"}],t={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatCardQuery",selections:[{kind:"CatchField",field:{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[t,a,{args:null,kind:"FragmentSpread",name:"ChatHeader_Endpoint"}],storageKey:null},to:"RESULT"}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatCardQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[t,a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"6e2c7cca467d32f74de4ddf840a8f08a",id:null,metadata:{},name:"ChatCardQuery",operationKind:"query",text:"query ChatCardQuery(\n  $endpointId: UUID!\n) {\n  endpoint(endpoint_id: $endpointId) {\n    endpoint_id\n    url\n    ...ChatHeader_Endpoint\n    id\n  }\n}\n\nfragment ChatHeader_Endpoint on Endpoint {\n  endpoint_id\n}\n"}}}();a.hash="5ff3fd270fca0bac7779be279e93341e";const i=a},77206:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ChatHeader_Endpoint",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"baa41c02cf67330c6bf4313d43280faa"},i=a},56440:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"filter"}],n=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Literal",name:"limit",value:1},{kind:"Literal",name:"offset",value:0}],t={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatPageQuery",selections:[{alias:null,args:n,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[t],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatPageQuery",selections:[{alias:null,args:n,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"763e262ee50ff2487754885efebacb90",id:null,metadata:{},name:"ChatPageQuery",operationKind:"query",text:"query ChatPageQuery(\n  $filter: String\n) {\n  endpoint_list(limit: 1, offset: 0, filter: $filter) {\n    items {\n      endpoint_id\n      id\n    }\n  }\n}\n"}}}();a.hash="81b9bb8d9bd90410dd13088b30f18dc2";const i=a},45360:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"limit"},t={defaultValue:null,kind:"LocalArgument",name:"offset"},a={defaultValue:null,kind:"LocalArgument",name:"projectID"},i=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],l={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null};return{fragment:{argumentDefinitions:[e,n,t,a],kind:"Fragment",metadata:null,name:"EndpointSelectQuery",selections:[{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[l,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[o,{kind:"RequiredField",field:r,action:"NONE"},s],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[t,n,a,e],kind:"Operation",name:"EndpointSelectQuery",selections:[{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[l,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[o,r,s,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"aae5f818f3d7f1a77dce26a43ed1ead6",id:null,metadata:{},name:"EndpointSelectQuery",operationKind:"query",text:"query EndpointSelectQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n  $filter: String\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: $filter) {\n    total_count\n    items {\n      name\n      endpoint_id\n      url\n      id\n    }\n  }\n}\n"}}}();a.hash="75cd9e15a8e37c564ec047492c6798b3";const i=a},97235:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpoint_id"}],n=[{kind:"Variable",name:"endpoint_id",variableName:"endpoint_id"}],t={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EndpointSelectValueQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[t,{kind:"RequiredField",field:a,action:"NONE"},i],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EndpointSelectValueQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[t,a,i,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"305b4336fc43ab460edf54efa95ff116",id:null,metadata:{},name:"EndpointSelectValueQuery",operationKind:"query",text:"query EndpointSelectValueQuery(\n  $endpoint_id: UUID!\n) {\n  endpoint(endpoint_id: $endpoint_id) {\n    name\n    endpoint_id\n    url\n    id\n  }\n}\n"}}}();a.hash="5f7c6954ddf84a211dc8428e86004300";const i=a},64679:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpointId"},{defaultValue:null,kind:"LocalArgument",name:"isEmptyEndpointId"}],n={alias:null,args:[{kind:"Variable",name:"endpoint_id",variableName:"endpointId"},{kind:"Literal",name:"limit",value:100},{kind:"Literal",name:"offset",value:0}],concreteType:"EndpointTokenList",kind:"LinkedField",name:"endpoint_token_list",plural:!1,selections:[{alias:null,args:null,concreteType:"EndpointToken",kind:"LinkedField",name:"items",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"token",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"valid_until",storageKey:null}],storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EndpointTokenSelectQuery",selections:[{kind:"CatchField",field:n,to:"RESULT"}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EndpointTokenSelectQuery",selections:[n]},params:{cacheID:"f8777131f4094de086beaa0e11d6ae09",id:null,metadata:{},name:"EndpointTokenSelectQuery",operationKind:"query",text:"query EndpointTokenSelectQuery(\n  $endpointId: UUID!\n  $isEmptyEndpointId: Boolean!\n) {\n  endpoint_token_list(offset: 0, limit: 100, endpoint_id: $endpointId) @skipOnClient(if: $isEmptyEndpointId) {\n    items {\n      id\n      token\n      created_at\n      valid_until\n    }\n  }\n}\n"}}}();a.hash="839fdaad7009de6f1d8dc79de4e35a3d";const i=a},4038:(e,n,t)=>{t.d(n,{W:()=>l});var a=t(4986),i=(t(55202),t(52426));const l=e=>{let{name:n,height:t,width:l}=e;const o=a.Pt.icons[null!==n&&void 0!==n?n:"pure"];return(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",height:t,width:l,role:"img",dangerouslySetInnerHTML:{__html:o.body}})}},86879:(e,n,t)=>{t.d(n,{B:()=>o});var a=t(81751),i=t(7885),l=t(55202);const o=()=>{var e;const[n,t]=(0,a.Tw)("first"),{data:o,isLoading:r}=(0,i.nN)({queryKey:["useAgents",n],queryFn:()=>fetch("resources/ai-agents.json").then((e=>e.json())),staleTime:864e5});return{agents:null!==(e=null===o||void 0===o?void 0:o.agents)&&void 0!==e?e:[],isLoading:r,refresh:(0,l.useCallback)((()=>t()),[t])}}},90152:(e,n,t)=>{t.r(n),t.d(n,{default:()=>nt});var a=t(4335),i=t(81751),l=t(7885),o=t(86879),r=t(65079),s=t(79678),d=t(96520),c=t(4038),u=t(43742),p=t(37090),m=t(49965),g=t(55202),h=t(52426);function v(e,n){return e.map((e=>({label:e.meta.title,value:e.id,...e}))).filter((e=>e.label.toLocaleLowerCase().includes(n||"")))}const y=e=>{let{loading:n,...t}=e;const{token:a}=p.A.useToken(),[i,l]=(0,u.A)(t),[r,s]=(0,g.useState)(),[y,f]=(0,g.useTransition)(),{agents:x}=(0,o.B)(),k=x.find((e=>e.id===i));return(0,h.jsx)(h.Fragment,{children:k&&(0,h.jsxs)(d.A,{gap:"xs",children:[(0,h.jsx)(c.W,{name:k.meta.avatar,height:a.sizeXL,width:a.sizeXL}),(0,h.jsx)(m.A,{showSearch:!0,onSearch:e=>{f((()=>{s(e)}))},filterOption:!1,loading:y||n,options:v(x,r),value:i,onChange:(e,n)=>{l(e,n)},popupMatchSelectWidth:!1})]})})};var f=t(29101),x=t(81081),k=t(47574);const b={maxTokens:4096,temperature:.7,topP:1,topK:1,frequencyPenalty:1,presencePenalty:1};var j=t(79837),C=t(75772),A=t(18959),S=t(97990),w=t(34589),I=t(55616),T=t(49924);const E=e=>{let{id:n,label:t,max:a,min:i,step:l,description:o,disabled:r}=e;const{token:s}=p.A.useToken();return(0,h.jsx)(j.A.Item,{label:(0,h.jsx)(C.A,{justify:"between",style:{width:"240px"},children:(0,h.jsxs)(C.A,{gap:"xxs",children:[(0,h.jsx)(A.A.Text,{style:{fontSize:s.fontSizeSM,marginRight:s.marginXXS},children:t}),o&&(0,h.jsx)(x.A,{title:o,trigger:"hover"})]})}),name:n,children:(0,h.jsx)(f.A,{disabled:r,min:i,max:a,step:null!==l&&void 0!==l?l:null})})},L={maxTokens:{label:"Max Tokens",min:50,max:16384,step:1,description:(0,T.t)("chatui.chat.parameter.MaxTokens")},temperature:{label:"Temperature",min:0,max:1,step:.01,description:(0,T.t)("chatui.chat.parameter.Temperature")},topP:{label:"Top P",min:0,max:1,step:.01,description:(0,T.t)("chatui.chat.parameter.TopP")},topK:{label:"Top K",min:1,max:500,step:1,description:(0,T.t)("chatui.chat.parameter.TopK")},frequencyPenalty:{label:"Frequency Penalty",min:0,max:2,step:.01,description:(0,T.t)("chatui.chat.parameter.FrequencyPenalty")},presencePenalty:{label:"Presence Penalty",min:0,max:2,step:.01,description:(0,T.t)("chatui.chat.parameter.PresencePenalty")}},_=e=>{let{parameters:n,usingParameters:t,onChangeParameter:a}=e;const{token:i}=p.A.useToken(),l=(0,g.useRef)(Object.keys(n).length>0?n:b);return(0,h.jsx)(S.Ay,{theme:{components:{Form:{verticalLabelPadding:0,itemMarginBottom:i.marginXXS}}},children:(0,h.jsxs)(j.A,{size:"small",layout:"vertical",initialValues:Object.keys(n).length>0?n:b,onValuesChange:e=>{l.current={...l.current,...e},a(t,{...l.current})},children:[(0,h.jsxs)(C.A,{align:"center",justify:"space-between",children:[(0,h.jsx)(A.A.Text,{style:{fontSize:i.fontSizeLG,marginLeft:i.marginXXS},children:(0,T.t)("chatui.chat.parameter.Title")}),(0,h.jsx)(w.A,{checked:t,onChange:()=>{a(!t,{...l.current})}})]}),(0,h.jsx)(I.A,{style:{marginBlock:i.marginSM}}),Object.entries(L).map((e=>{let[n,a]=e;return(0,h.jsx)(E,{disabled:!t,id:n,...a},n)}))]})})};var F=t(62424),R=t(64428),K=t.n(R),M=t(18139);var P=t(54145),D=t(76385),B=t(83150),$=t(90635);const z=e=>{let{loading:n,total:t}=e;const{token:a}=p.A.useToken(),{t:i}=(0,$.Bd)();return(0,h.jsxs)(d.A,{justify:"end",gap:"xs",children:[n?(0,h.jsx)(B.A,{spin:!0,style:{color:a.colorTextSecondary}}):(0,h.jsx)("div",{}),(0,h.jsx)(A.A.Text,{type:"secondary",children:i("general.TotalItems",{total:t})})]})};var V,N,q=t(86663),H=t(60073),U=t(2393),Q=t(2624);const O=e=>{let{fetchKey:n,lifecycleStageFilter:a=["created"],loading:l,...o}=e;const{t:r}=(0,$.Bd)(),s=(0,i.CX)(),[d,c]=(0,u.A)(o),[p,m]=(0,u.A)(o,{valuePropName:"open",trigger:"onDropdownVisibleChange"}),v=(0,g.useDeferredValue)(p),[y,f]=(0,g.useState)(),x=(0,g.useDeferredValue)(y),k=(0,g.useRef)(null),b=a.map((e=>`lifecycle_stage == "${e}"`)).join(" | "),{endpoint:j}=(0,M.useLazyLoadQuery)(void 0!==V?V:V=t(97235),{endpoint_id:null!==d&&void 0!==d?d:""},{fetchPolicy:d?"store-or-network":"store-only"}),{paginationData:C,result:{endpoint_list:A},loadNext:S,isLoadingNext:w}=function(e,n,t,a,i){let{getItem:l,getId:o,getTotal:r}=i;const s=(0,g.useRef)([]),[d,c]=(0,g.useTransition)(),[u]=(0,g.useState)(n.limit),[p,m]=(0,g.useState)(0),h=(0,g.useRef)(t),v=!K().isEqual(h.current,t),y=(0,M.useLazyLoadQuery)(e,{limit:v?n.limit:u,offset:v?0:p,...t},a),f=(0,g.useMemo)((()=>{const e=l(y);return v&&(s.current=[]),e?K().uniqBy([...s.current,...e],o):void 0}),[y]),x=p+u<r(y),k=(0,F.E)((()=>{!d&&x&&(s.current=f||[],c((()=>{m(p+u)})))}));return(0,g.useEffect)((()=>{v&&(h.current=t,m(0))}),[v]),{paginationData:f,result:y,loadNext:k,hasNext:x,isLoadingNext:d}}(void 0!==N?N:N=t(45360),{limit:10},{filter:s.supports("endpoint-lifecycle-stage-filter")?[b,x?`name ilike "%${x}%"`:void 0].filter(Boolean).map((e=>`(${e})`)).join(" & "):void 0},{fetchKey:n,fetchPolicy:v?"network-only":"store-only"},{getTotal:e=>{var n;return null===(n=e.endpoint_list)||void 0===n?void 0:n.total_count},getItem:e=>{var n;return null===(n=e.endpoint_list)||void 0===n?void 0:n.items},getId:e=>null===e||void 0===e?void 0:e.endpoint_id}),I=K().map(C,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e}))),[T,E]=(0,g.useState)(j?{label:(null===j||void 0===j?void 0:j.name)||void 0,value:(null===j||void 0===j?void 0:j.endpoint_id)||void 0}:d?{label:d,value:d}:d),L=y===x;return(0,g.useEffect)((()=>{var e;L&&(null===(e=k.current)||void 0===e||e.scrollTo(0))}),[L]),(0,h.jsx)(D.A,{ref:k,placeholder:r("chatui.SelectEndpoint"),style:{minWidth:100},showSearch:!0,searchValue:y,onSearch:e=>{f(e)},labelRender:e=>{let{label:n}=e;return n?(0,h.jsxs)(U.so,{gap:"xxs",children:[n,(0,h.jsx)(q.A,{title:r("general.NavigateToDetailPage"),children:(0,h.jsx)(P.A,{to:`/serving/${null===j||void 0===j?void 0:j.endpoint_id}`,children:(0,h.jsx)(Q.A,{})})})]}):n},autoClearSearchValue:!0,filterOption:!1,loading:y!==x||l,options:I,...o,labelInValue:!0,value:T,onChange:(e,n)=>{var t,a;E(e),c(e.value,null===(t=K().castArray(n))||void 0===t?void 0:t[0].endpoint),null===(a=o.onChange)||void 0===a||a.call(o,e.value||"",n)},endReached:()=>{S()},open:p,onDropdownVisibleChange:m,notFoundContent:K().isUndefined(C)?(0,h.jsx)(H.A.Input,{active:!0,size:"small",block:!0}):void 0,footer:K().isNumber(null===A||void 0===A?void 0:A.total_count)&&A.total_count>0?(0,h.jsx)(z,{loading:w,total:null===A||void 0===A?void 0:A.total_count}):void 0})},X=e=>{let{models:n,...t}=e;const{t:a}=(0,$.Bd)();return(0,h.jsx)(m.A,{placeholder:a("chatui.SelectModel"),style:{fontWeight:"normal"},showSearch:!0,options:K().chain(n).groupBy("group").mapValues((e=>K().map(e,(e=>{let{name:n}=e;return{label:n,value:n}})))).map(((e,n)=>({label:"undefined"===n?"Others":n,options:e}))).value(),popupMatchSelectWidth:!1,...t})};var W,G=t(33856),Y=t(91430),J=t(2880),Z=t(90086),ee=t(16165),ne=t(16672),te=t(30567),ae=t(58924),ie=t(57884),le=t(19680),oe=t(98552);const re=e=>{let{sync:n,onClick:t}=e;const{t:a}=(0,$.Bd)(),{token:i}=p.A.useToken();return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(q.A,{title:a("chatui.SyncInput"),children:(0,h.jsx)(Z.Ay,{type:"text",icon:n?(0,h.jsx)(te.A,{}):(0,h.jsx)(ae.A,{}),onClick:()=>t(!n),style:{marginLeft:8,color:n?i.colorPrimary:void 0}})})})},se=e=>{let{showCompareMenuItem:n,closable:a,cloneable:l,models:o,modelId:c,onChangeModel:u,endpointFrgmt:m,onChangeEndpoint:v,agent:f,onChangeAgent:x,sync:k,onChangeSync:b,onRemoveChat:j,onAddChat:C,fetchKey:A,parameters:S,usingParameters:w,onChangeParameter:I,onClearMessage:T}=e;const{t:E}=(0,$.Bd)(),{token:L}=p.A.useToken(),F=(0,i.f0)(),[K,P]=(0,g.useTransition)(),[D,B]=(0,g.useTransition)(),z=(0,M.useFragment)(void 0!==W?W:W=t(77206),m),V=(0,r.LY)([n&&{key:"compare",label:E("chatui.CompareWithOtherModels"),icon:(0,h.jsx)(ie.A,{}),onClick:()=>{var e;F({pathname:"/serving",search:new URLSearchParams({tab:"chatting",endpointId:null!==(e=null===z||void 0===z?void 0:z.endpoint_id)&&void 0!==e?e:"",modelId:c}).toString()})}},n&&{type:"divider"},{key:"clear",label:E("chatui.DeleteChatHistory"),icon:(0,h.jsx)(le.A,{}),onClick:()=>{null===T||void 0===T||T()}},a&&{type:"divider"},a&&{key:"close",danger:!0,label:E("chatui.DeleteChattingSession"),icon:(0,h.jsx)(G.A,{}),onClick:()=>{null===j||void 0===j||j()}}]),[N]=(0,s.q)("experimental_ai_agents");return(0,h.jsxs)(d.A,{direction:"row",justify:"start",wrap:"wrap",gap:"xs",style:{minHeight:"56px",width:"100%",paddingTop:L.paddingXS,paddingBottom:L.paddingXS},children:[(0,h.jsxs)(d.A,{wrap:"wrap",align:"start",gap:"xs",style:{flexGrow:1,flexShrink:1,flexBasis:"auto"},children:[N&&(0,h.jsx)(y,{loading:D,value:null===f||void 0===f?void 0:f.id,onChange:(e,n)=>{B((()=>{x(n)}))}}),(0,h.jsx)(O,{fetchKey:A,loading:K,onChange:e=>{P((()=>{null===v||void 0===v||v(e)}))},value:null===z||void 0===z?void 0:z.endpoint_id,popupMatchSelectWidth:!1}),!(0,R.isEmpty)(o)&&(0,h.jsx)(X,{models:o,value:c,onChange:e=>{(0,g.startTransition)((()=>{u(e)}))}})]}),(0,h.jsxs)(d.A,{style:{zIndex:1},children:[a&&(0,h.jsx)(re,{sync:k,onClick:e=>{(0,g.startTransition)((()=>{b(e)}))}}),(0,h.jsx)(ee.A,{content:(0,h.jsx)(_,{parameters:S,usingParameters:w,onChangeParameter:(e,n)=>{(0,g.startTransition)((()=>{I(e,n)}))}}),trigger:"click",placement:"bottomLeft",style:{padding:L.paddingXS},children:(0,h.jsx)(q.A,{title:E("chatui.chat.parameter.Title"),children:(0,h.jsx)(Z.Ay,{type:"text",icon:(0,h.jsx)(Y.A,{style:{color:w?L.colorPrimary:void 0}})})})}),l&&(0,h.jsx)(q.A,{title:E("chatui.CreateCompareChat"),children:(0,h.jsx)(Z.Ay,{type:"text",onClick:()=>null===C||void 0===C?void 0:C(),icon:(0,h.jsx)(oe.A,{})})}),(0,h.jsx)(ne.A,{menu:{items:V},trigger:["click"],children:(0,h.jsx)(Z.Ay,{type:"text",onClick:e=>e.preventDefault(),icon:(0,h.jsx)(J.A,{}),style:{color:L.colorTextSecondary}})})]})]})};var de=t(21605),ce=t(61288),ue=t(93940),pe=t(32703),me=t(70441);const ge=e=>{let{items:n,onChange:t,dropContainerRef:a,children:i}=e;const{t:l}=(0,$.Bd)();return(0,h.jsx)(ue.A,{beforeUpload:()=>!1,getDropContainer:()=>a.current,accept:"image/*,text/*",items:n,onChange:t,placeholder:e=>"drop"===e?{title:l("chatui.DropFileHere")}:{icon:(0,h.jsx)(de.A,{}),title:l("chatui.UploadFiles"),description:l("chatui.UploadFilesDescription")},children:i})},he=e=>{let{loading:n,autoFocus:t,items:a,openAttachment:i,dropContainerRef:l,onInputChange:o,onInputSubmit:r,onInputCancel:s,onAttachmentChange:d,onAttachmentOpenChange:c,...u}=e;const{t:p}=(0,$.Bd)(),m=(0,g.useRef)(null);return(0,g.useEffect)((()=>{t&&m.current&&m.current.focus()}),[t]),(0,h.jsx)(pe.A,{style:{flex:1},ref:m,...u,loading:n,placeholder:p("chatui.SenderPlaceholder"),onChange:o,onSubmit:r,onCancel:s,submitType:"enter",header:(0,h.jsx)(pe.A.Header,{closable:!1,title:p("chatui.Attachments"),open:!!i&&!(0,R.isEmpty)(a),onOpenChange:c,styles:{content:{padding:0}},children:(0,h.jsx)(ge,{items:a,dropContainerRef:l,onChange:e=>null===d||void 0===d?void 0:d("header",e)})}),prefix:(0,h.jsx)(ge,{items:a,dropContainerRef:l,onChange:e=>null===d||void 0===d?void 0:d("prefix",e),children:(0,h.jsx)(me.A,{dot:!(0,R.isEmpty)(a)&&!i,children:(0,h.jsx)(Z.Ay,{type:"text",icon:(0,h.jsx)(ce.A,{})})})})})};var ve=t(62249),ye=t(26881);const fe=(0,ve.eU)(""),xe=(0,ve.eU)(),ke=(0,ve.eU)(void 0),be=e=>{let{sync:n,input:t,setInput:a,stop:i,append:l,isStreaming:o,disabled:s,dropContainerRef:c}=e;const{token:u}=p.A.useToken(),m={borderTop:`1px solid ${u.colorBorderSecondary}`,paddingBlock:u.paddingContentVertical,paddingInline:u.paddingContentHorizontal},[v,y]=(0,g.useState)(!1),[f,x]=(0,g.useState)([]),[k,b]=(0,ye.fp)(fe),[j,C]=(0,ye.fp)(xe),[A,S]=(0,ye.fp)(ke),w=(0,g.useId)(),I=(null===A||void 0===A?void 0:A.id)===w||null===A||void 0===A?void 0:A.key,T=(0,g.useRef)(n);(0,g.useEffect)((()=>{T.current!==n&&(a(""),T.current=n)}),[n,a]),(0,g.useEffect)((()=>{n&&!(0,R.isUndefined)(k)&&a(k)}),[k,a,n]);(0,g.useEffect)((()=>{var e;e=j,(0,R.isUndefined)(e)||(0,R.isEqual)(f,e)||(x(e),y(!0))}),[j]),(0,g.useEffect)((()=>{if(!(0,R.isUndefined)(I)&&t){const e={};(0,R.isEmpty)(f)||(e.experimental_attachments=(0,r.bJ)(f)),l({role:"user",content:t},e)}}),[I]);const E=(0,g.useCallback)((e=>{a(e),n&&b(e)}),[n,a,b]),L=(0,g.useCallback)((()=>{i()}),[i]),_=(0,g.useCallback)((()=>{if(t||!(0,R.isEmpty)(f)){const e={};(0,R.isEmpty)(f)||(e.experimental_attachments=(0,r.bJ)(f)),l({role:"user",content:t},e),setTimeout((()=>{a(""),x([]),y(!1)}),0),b(""),C([]),n&&S({id:w,key:(new Date).toString()})}}),[t,f,l,b,C,n,a,S,w]),F=(0,g.useCallback)(((e,t)=>{const a=t.fileList;x(a),"prefix"===e&&y(!0),n&&C(a)}),[n,x,y,C]),K=(0,g.useCallback)((e=>{y(e)}),[y]);return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(d.A,{style:m,direction:"column",align:"center",children:(0,h.jsx)(he,{disabled:s,placeholder:"Say something...",autoFocus:!0,value:t,items:f,openAttachment:v,dropContainerRef:c,loading:o,onInputChange:E,onInputSubmit:_,onInputCancel:L,onAttachmentChange:F,onAttachmentOpenChange:K})})})},je=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[n,a]=(0,g.useState)(0);return(0,g.useEffect)((()=>{(0,g.startTransition)((()=>{(async e=>{const{encode:n}=await t.e(3762).then(t.bind(t,93762));return n(e).length})(e).then(a).catch((()=>{a(e.length)}))}))}),[e]),n};var Ce=t(36290);const Ae=e=>{let{input:n,messages:t,startTime:a,style:i}=e;const l=je(n),o=(0,g.useMemo)((()=>(0,R.map)(t,(e=>null===e||void 0===e?void 0:e.content)).join("")),[t]),r=l+je(o),s=(0,g.useMemo)((()=>{const e=(0,R.last)(t);return"assistant"===(null===e||void 0===e?void 0:e.role)?null===e||void 0===e?void 0:e.content:""}),[t]),c=je(s),u=(0,g.useMemo)((()=>c>0&&a?c/((Date.now()-a)/1e3):0),[c,a]);return(0,h.jsx)(d.A,{justify:"end",align:"end",children:(0,h.jsxs)(Ce.A,{style:{margin:0},children:[(0,h.jsxs)("span",{children:[(0,h.jsx)(A.A.Text,{children:u.toFixed(1)})," ",(0,h.jsx)(A.A.Text,{type:"secondary",children:"TPS"})]})," ",(0,h.jsx)(I.A,{type:"vertical"}),(0,h.jsxs)("span",{children:[(0,h.jsx)(A.A.Text,{children:r})," ",(0,h.jsx)(A.A.Text,{type:"secondary",children:" tokens"})]}),(0,h.jsx)(x.A,{title:(0,T.t)("chatui.TokenCounterTooltip")})]})})};var Se=t(83187);const we=(0,g.memo)((e=>{let{children:n,placement:t={},avatar:a,onMouseEnter:i,onMouseLeave:l}=e;const{token:o}=p.A.useToken();return(0,h.jsxs)(d.A,{direction:t.left?"row":"row-reverse",justify:"start",align:"baseline",style:{marginLeft:t.left?0:"15%",marginRight:t.right?0:20,paddingLeft:o.paddingMD,paddingRight:o.paddingMD,paddingTop:t.top?o.paddingMD:0,paddingBottom:t.bottom?o.paddingMD:0},gap:"sm",onMouseEnter:i,onMouseLeave:l,children:[(0,h.jsx)(Se.A,{icon:a,style:{fontSize:o.fontSizeHeading3}}),(0,h.jsx)(d.A,{direction:"column",align:t.left?"start":"end",wrap:"wrap",style:{flex:1},gap:"xs",children:n})]})}));we.displayName="ChatMessageContainer";var Ie=t(10898),Te=t(78745),Ee=t(52818);const Le=e=>{let{copyable:n,defaultIcon:t,...a}=e;const[i,l]=(0,g.useState)(!1);return(0,g.useEffect)((()=>{if(i){const e=setTimeout((()=>{l(!1)}),2e3);return()=>clearTimeout(e)}}),[i]),(0,h.jsx)(q.A,{title:i?"Copied!":"Copy",open:!!i||void 0,children:(0,h.jsx)("div",{children:(0,h.jsx)(Ee.CopyToClipboard,{text:(null===n||void 0===n?void 0:n.text)||"",onCopy:async()=>{l(!0)},children:(0,h.jsx)(Z.Ay,{icon:i?(0,h.jsx)(Ie.A,{}):t||(0,h.jsx)(Te.A,{}),...a})})})})};var _e=t(83937),Fe=t(27943),Re=t(59617),Ke=t(20336);const Me={abap:!0,"actionscript-3":!0,ada:!0,apache:!0,apex:!0,apl:!0,applescript:!0,ara:!0,asm:!0,astro:!0,awk:!0,ballerina:!0,bat:!0,beancount:!0,berry:!0,bibtex:!0,bicep:!0,blade:!0,c:!0,cadence:!0,clarity:!0,clojure:!0,cmake:!0,cobol:!0,codeql:!0,coffee:!0,cpp:!0,crystal:!0,csharp:!0,css:!0,cue:!0,cypher:!0,d:!0,dart:!0,dax:!0,diff:!0,docker:!0,"dream-maker":!0,elixir:!0,elm:!0,erb:!0,erlang:!0,fish:!0,fsharp:!0,gdresource:!0,gdscript:!0,gdshader:!0,gherkin:!0,"git-commit":!0,"git-rebase":!0,"glimmer-js":!0,"glimmer-ts":!0,glsl:!0,gnuplot:!0,go:!0,graphql:!0,groovy:!0,hack:!0,haml:!0,handlebars:!0,haskell:!0,hcl:!0,hjson:!0,hlsl:!0,html:!0,http:!0,imba:!0,ini:!0,java:!0,javascript:!0,"jinja-html":!0,jison:!0,json:!0,json5:!0,jsonc:!0,jsonl:!0,jsonnet:!0,jssm:!0,jsx:!0,julia:!0,kotlin:!0,kusto:!0,latex:!0,less:!0,liquid:!0,lisp:!0,logo:!0,lua:!0,make:!0,markdown:!0,marko:!0,matlab:!0,mdc:!0,mdx:!0,mermaid:!0,mojo:!0,narrat:!0,nextflow:!0,nginx:!0,nim:!0,nix:!0,"objective-c":!0,"objective-cpp":!0,ocaml:!0,pascal:!0,perl:!0,php:!0,plsql:!0,postcss:!0,powerquery:!0,powershell:!0,prisma:!0,prolog:!0,proto:!0,pug:!0,puppet:!0,purescript:!0,python:!0,r:!0,raku:!0,razor:!0,reg:!0,rel:!0,riscv:!0,rst:!0,ruby:!0,rust:!0,sas:!0,sass:!0,scala:!0,scheme:!0,scss:!0,shaderlab:!0,shellscript:!0,shellsession:!0,smalltalk:!0,solidity:!0,sparql:!0,splunk:!0,sql:!0,"ssh-config":!0,stata:!0,stylus:!0,svelte:!0,swift:!0,"system-verilog":!0,tasl:!0,tcl:!0,tex:!0,toml:!0,tsx:!0,turtle:!0,twig:!0,typescript:!0,v:!0,vb:!0,verilog:!0,vhdl:!0,viml:!0,vue:!0,"vue-html":!0,vyper:!0,wasm:!0,wenyan:!0,wgsl:!0,wolfram:!0,xml:!0,xsl:!0,yaml:!0,zenscript:!0,zig:!0,bash:!0,batch:!0,be:!0,"c#":!0,cdc:!0,clj:!0,cmd:!0,console:!0,cql:!0,cs:!0,dockerfile:!0,erl:!0,"f#":!0,fs:!0,fsl:!0,gjs:!0,gts:!0,hbs:!0,hs:!0,jade:!0,js:!0,kql:!0,makefile:!0,md:!0,nar:!0,nf:!0,objc:!0,perl6:!0,properties:!0,ps:!0,ps1:!0,py:!0,ql:!0,rb:!0,rs:!0,sh:!0,shader:!0,shell:!0,spl:!0,styl:!0,ts:!0,vim:!0,vimscript:!0,vy:!0,yml:!0,zsh:!0,"\u6587\u8a00":!0},Pe=(0,g.memo)((e=>{let{children:n,language:t}=e;const{data:a,isLoading:i}=((e,n)=>{const{isDarkMode:t}=(0,_e.e)(),a=n.toLowerCase(),i=Me[a]?a:"txt",l=(0,g.useMemo)((()=>Ke.VV.hashStr(e)),[e]);return(0,Re.Ay)([i,t?"d":"l",l].join("-"),(async()=>{try{return(0,Fe.Yz)(e,{lang:i,theme:t?"github-dark":"github-light"})}catch(n){return console.error("shiki Highlight error:",n),e}}))})(n,t);return(0,h.jsx)(h.Fragment,{children:i||!a?(0,h.jsx)("pre",{children:(0,h.jsx)("code",{style:{whiteSpace:"pre-wrap"},children:n})}):(0,h.jsx)("div",{dangerouslySetInnerHTML:{__html:a},dir:"ltr"})})}));Pe.displayName="SyntaxHighlighter";t(80588);var De=t(60103),Be=t(48913),$e=t(63116),ze=t(20269),Ve=t(20786),Ne=t(68573);const{Text:qe}=A.A;const He=(0,g.memo)((e=>{let{children:n,...t}=e;return(0,h.jsx)(Pe,{...t,children:n})}));He.displayName="CodeBlock";const Ue=(0,g.memo)((e=>{let{lang:n,extra:t}=e;const{token:a}=p.A.useToken();return(0,h.jsxs)(d.A,{style:{margin:0,minHeight:38,padding:`0 ${a.paddingSM}px`,background:"rgba(0, 0, 0, 0.02)",width:"100%"},children:[(0,h.jsx)(d.A,{style:{display:"inline-block",flex:"1",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:(0,h.jsx)(qe,{style:{fontWeight:"normal"},type:"secondary",children:n})}),(0,h.jsx)(d.A,{children:t})]})}));Ue.displayName="CodeHead";const Qe=(0,g.memo)((e=>{let{block:n,isStreaming:t}=e;const a=(0,g.useCallback)((e=>{const{children:n,className:a,node:i,ref:l,...o}=e,r=/language-(\w+)/.exec(a||""),s=String(null!==n&&void 0!==n?n:"").replace(/\n$/,""),{token:c}=p.A.useToken();return r?(0,h.jsxs)(d.A,{direction:"column",style:{border:"1px solid #f0f0f0",margin:"0",padding:"0",borderRadius:c.borderRadiusLG,overflow:"hidden"},children:[(0,h.jsx)(Ue,{lang:r[1],extra:(0,h.jsx)(Le,{type:"text",copyable:{text:null!==s&&void 0!==s?s:""},style:{display:t?"none":"block"}})}),(0,h.jsx)(d.A,{style:{width:"100%",padding:c.paddingSM,borderRadius:`0 0 ${c.borderRadiusLG}px ${c.borderRadiusLG}px`,margin:"-0.5em 0",overflow:"scroll"},children:(0,h.jsx)(He,{...o,PreTag:"div",language:r[1],style:$e.A,wrapLongLines:!0,wrapLines:!0,children:s})})]}):(0,h.jsx)(d.A,{style:{width:"100%",padding:c.paddingSM,borderRadius:`0 0 ${c.borderRadiusLG}px ${c.borderRadiusLG}px`,margin:"-0.5em 0",overflow:"scroll"},children:(0,h.jsx)("code",{...o,style:{whiteSpace:"pre-wrap"},className:a,children:n})})}),[t]),i=(0,g.useCallback)((e=>{let{node:n,...t}=e;return(0,h.jsx)("p",{...t,style:{whiteSpace:"pre-wrap"}})}),[]);return(0,h.jsx)(Be.oz,{remarkPlugins:[Ve.A,Ne.A],rehypePlugins:[ze.A],components:{p:i,code:a},children:n})}));Qe.displayName="ChatMessageContentBlock";const Oe=e=>{let{children:n,isStreaming:t}=e;return(0,g.useMemo)((()=>{return e=null!==n&&void 0!==n?n:"",De.xI.lexer(e).map((e=>e.raw));var e}),[n]).map(((e,n)=>(0,h.jsx)(Qe,{block:e,isStreaming:t},`block_${n}`)))};Oe.displayName="ChatMessageContent";const Xe=(0,g.memo)(Oe);var We=t(6679),Ge=t(86143),Ye=t(87326);const Je=e=>{let{extra:n,message:t,placement:a,enableExtraHover:i,isStreaming:l,avatar:o}=e;const{token:r}=p.A.useToken(),{t:s}=(0,$.Bd)(),[c,u]=(0,g.useState)(!1),{content:m,reasoning:v}=t;return(0,h.jsxs)(we,{placement:a,avatar:o,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[K().map(t.experimental_attachments,((e,n)=>K().includes(null===e||void 0===e?void 0:e.contentType,"image/")?(0,h.jsx)(d.A,{style:{border:"none",textAlign:"end"},align:"end",children:(0,h.jsx)(We.A,{src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name,style:{maxWidth:"50vw",maxHeight:"12vh",borderRadius:r.borderRadius}},`${null===t||void 0===t?void 0:t.id}-${n}`)}):(0,h.jsx)(ue.A.FileCard,{item:{uid:`${null===t||void 0===t?void 0:t.id}-${n}`,name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.url),type:null===e||void 0===e?void 0:e.contentType,description:null===e||void 0===e?void 0:e.name,url:null===e||void 0===e?void 0:e.url}},n))),(0,h.jsxs)(d.A,{align:"stretch",direction:"column",style:{borderRadius:r.borderRadius,borderColor:r.colorBorderSecondary,borderWidth:r.lineWidth,padding:"1em",paddingTop:0,paddingBottom:0,backgroundColor:"user"!==t.role?r.colorBgContainer:r.colorBgContainerDisabled,maxWidth:"100%",width:K().trim(t.reasoning)?"100%":"auto"},children:[K().trim(t.reasoning)&&(0,h.jsx)(Ge.A,{style:{marginTop:r.margin,width:"100%"},items:[{key:"reasoning",label:K().isEmpty(m)?(0,h.jsxs)(d.A,{gap:"xs",children:[(0,h.jsx)(A.A.Text,{children:s("chatui.Thinking")}),(0,h.jsx)(Ye.A,{size:"small"})]}):(0,h.jsx)(A.A.Text,{children:s("chatui.ViewReasoning")}),children:(0,h.jsx)(Xe,{isStreaming:l,children:v})}]}),(0,h.jsx)(Xe,{isStreaming:l,children:m+(l?"\n":"")})]}),(0,h.jsx)(d.A,{style:{fontSize:r.fontSizeSM,...i?{opacity:c?1:0,transition:"opacity 0.2s",transitionDelay:c?"0s":"0.2s"}:{}},children:n})]})},Ze=(0,g.memo)(Je);var en=t(44299);const nn=e=>{let{message:n,isStreaming:t,placement:a}=e;return(0,h.jsx)(Ze,{message:n,placement:{...a,left:!0},isStreaming:t,enableExtraHover:!1,extra:(0,h.jsx)(en.Ay,{children:(0,h.jsx)(Le,{type:"text",size:"small",copyable:{text:n.content},style:{display:t?"none":"block"}})}),avatar:"\ud83e\udd16"},n.id)};var tn=t(67836);const an=e=>{let{autoScroll:n,atBottom:t,...a}=e;const i=(0,F.E)(a.onScrollToBottom);return(0,g.useEffect)((()=>{t&&n&&(null===i||void 0===i||i("auto"))}),[t,n,i]),(0,h.jsx)(Z.Ay,{icon:(0,h.jsx)(tn.A,{}),shape:"circle",onClick:()=>{i&&i("click")}})};var ln=t(67107);const on={user:e=>{let{message:n,isStreaming:t,placement:a}=e;return(0,h.jsx)(Ze,{message:n,placement:{...a,right:!0},isStreaming:t,enableExtraHover:!0,extra:(0,h.jsx)(en.Ay,{children:null}),avatar:"\ud83e\uddd1\u200d\ud83e\uddb0"},n.id)},assistant:nn,system:nn,data:nn},rn=e=>{let{messages:n,isStreaming:t}=e;const a=(0,g.useRef)(null),[i,l]=(0,g.useState)(!0),{token:o}=p.A.useToken(),r="undefined"!==typeof window?1.5*window.innerHeight:0,s=(0,g.useCallback)(((e,a)=>{const i=on[a.role];return(0,h.jsx)(i,{message:a,isStreaming:null!==t&&void 0!==t&&t,placement:{top:0===e,bottom:e===n.length-1}},a.id)}),[t,n.length]);return(0,h.jsxs)(d.A,{direction:"column",align:"stretch",style:{height:"100%",flex:1},children:[(0,h.jsx)(ln.aY,{atBottomStateChange:l,atBottomThreshold:60,computeItemKey:(e,n)=>n.id,data:n,followOutput:"auto",initialTopMostItemIndex:(null===n||void 0===n?void 0:n.length)-1,itemContent:s,overscan:r,ref:a}),(0,h.jsx)("div",{style:{position:"absolute",right:"50%",transform:"translateX(+50%)",bottom:o.marginSM,opacity:i?0:1,transition:"opacity 0.2s",transitionDelay:i?"0s":"0.2s",zIndex:1},children:(0,h.jsx)(an,{atBottom:i,autoScroll:t,onScrollToBottom:e=>{const n=a.current;switch(e){case"auto":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"auto",index:"LAST"});break;case"click":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"smooth",index:"LAST"})}}})})]})},sn=(0,g.memo)(rn),dn=(0,g.memo)(Ae),cn=e=>{let{messages:n,input:t,isStreaming:a,startTime:i}=e;const{token:l}=p.A.useToken();return(0,h.jsxs)(d.A,{direction:"column",align:"stretch",style:{flex:1},children:[(0,h.jsx)(sn,{messages:n,isStreaming:a}),(0,h.jsx)(d.A,{direction:"column",align:"end",style:{position:"absolute",bottom:0,right:0,margin:l.margin},children:(0,h.jsx)(dn,{messages:n,input:t,startTime:i})})]})};var un,pn=t(294),mn=t(52530),gn=t.n(mn);const hn=e=>{let{endpointId:n,...a}=e;const{t:i}=(0,$.Bd)(),[l,o]=(0,u.A)(a),{endpoint_token_list:r}=(0,M.useLazyLoadQuery)(void 0!==un?un:un=t(64679),{endpointId:n||"",isEmptyEndpointId:!n}),s=(0,g.useMemo)((()=>function(e){var n;if(!e.ok)return[];const t=gn()();return(0,R.sortBy)(null===(n=e.value)||void 0===n?void 0:n.items,"created_at").map((e=>({label:null===e||void 0===e?void 0:e.token,value:null===e||void 0===e?void 0:e.token,disabled:!gn().utc(null===e||void 0===e?void 0:e.valid_until).tz().isAfter(t)})))}(r)),[r]);return s.length<=0?(0,h.jsx)(pn.A,{onChange:e=>o(e.target.value)}):(0,h.jsx)(m.A,{placeholder:i("chatui.SelectToken"),style:{fontWeight:"normal",width:"200px"},options:s,value:l,onChange:(e,n)=>{var t,a;o(null!==(t=null===(a=(0,R.castArray)(n))||void 0===a?void 0:a[0].value)&&void 0!==t?t:"")},...a})};var vn=t(24262),yn=t(88439),fn=t(43299);const xn=e=>{let{endpointUrl:n,basePath:t,token:a,endpointId:i,loading:l,onSubmit:o}=e;const{t:r}=(0,$.Bd)(),{token:s}=p.A.useToken(),c=(0,g.useRef)(null),u=(0,g.useRef)(null),[m,v]=(0,g.useState)(!0);return(0,yn.A)(u.current,(e=>{let{contentRect:n}=e;v(n.width<480)})),(0,h.jsx)(d.A,{direction:"row",style:{padding:s.paddingContentVerticalLG,paddingInline:s.paddingContentHorizontal,backgroundColor:s.colorBgContainer,overflow:"hidden",borderBottom:`1px solid ${s.colorBorderSecondary}`},ref:u,children:(0,h.jsxs)(j.A,{ref:c,layout:"horizontal",size:"small",requiredMark:"optional",style:{flex:1},initialValues:{basePath:t,token:a},children:[(0,h.jsx)("div",{style:{marginBottom:s.size},children:(0,h.jsx)(fn.A,{type:"warning",showIcon:!0,message:r("chatui.CannotFindModel")})}),(0,h.jsx)(j.A.Item,{label:r("modelService.BasePath"),name:"basePath",children:(0,h.jsx)(pn.A,{placeholder:"v1",addonBefore:m?void 0:n,defaultValue:t})}),(0,h.jsx)(j.A.Item,{label:r("modelService.Token"),name:"token",children:(0,h.jsx)(hn,{loading:l,endpointId:i,style:{width:m?"100%":"200px"}})}),(0,h.jsx)(Z.Ay,{icon:(0,h.jsx)(vn.A,{}),loading:l,onClick:()=>{var e,n,t;null===o||void 0===o||o({basePath:null!==(e=null===(n=c.current)||void 0===n?void 0:n.getFieldValue("basePath"))&&void 0!==e?e:"",token:null===(t=c.current)||void 0===t?void 0:t.getFieldValue("token")})},children:r("button.RefreshModelInformation")})]},n)})};var kn,bn=t(3871),jn=t(11409),Cn=t(58570),An=t(24480),Sn=t(70554),wn=t(77397),In=t(98311),Tn=t.n(In);const En=(0,wn.rU)((e=>{let{token:n,css:t}=e;return{chatCard:t`
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
  `,alert:t`
    margin-block: ${n.paddingContentVertical}px;
    margin-inline: ${n.paddingContentHorizontal}px;
  `}}));function Ln(e,n,t){const{t:a}=(0,$.Bd)(),{data:i}=(0,l.nj)({queryKey:["models",n,t,e.apiKey],queryFn:async()=>{if(!t)return{data:[]};const n=function(e){const{origin:n,pathname:t}=new URL(e.trim());return new URL("/"===t?"/models":`${t}/models`,n).toString()}(t),a=e.apiKey,i=await fetch(n,{headers:{Authorization:a?`Bearer ${a}`:""}}).then((e=>e.json())).catch((e=>({ok:!1,status:-1})));return!1===i.ok?{data:[],error:null===i||void 0===i?void 0:i.status}:i},select:e=>({data:e?e.data.map((e=>({id:e.id,name:e.id}))):[]})}),o=(0,g.useMemo)((()=>{var n,t,a;return e.modelId&&K().includes(K().map((null===i||void 0===i?void 0:i.data)||[],"id"),e.modelId)?e.modelId:null!==(n=null===i||void 0===i||null===(t=i.data)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.id)&&void 0!==n?n:"custom"}),[null===i||void 0===i?void 0:i.data,e.modelId]),r=i.error&&(e=>{switch(e){case 401:return a("error.UnauthorizedToken");case 404:return a("error.NotFoundBasePath");case 500:return a("error.InternalServerError");case 503:return a("error.ServiceUnavailable");default:return a("error.UnknownError")}})(i.error);return{models:null===i||void 0===i?void 0:i.data,modelId:o,modelsError:r}}const _n=se,Fn=g.memo(be);const Rn=e=>{var n;let{chat:a,onUpdateChat:l,closable:r,cloneable:s,fetchOnClient:d,onRemoveChat:c,onAddChat:u,onSaveMessage:m,onClearMessage:v,styles:y,className:f,...x}=e;const{t:b}=(0,$.Bd)(),{message:j}=An.A.useApp(),C=(0,M.useLazyLoadQuery)(void 0!==kn?kn:kn=t(13747),{endpointId:a.provider.endpointId||""},{fetchPolicy:a.provider.endpointId?"store-or-network":"store-only"}),A=C.endpoint.ok?C.endpoint.value:null,{styles:{chatCard:S,alert:w}}=En(),{token:I}=p.A.useToken(),[T,E]=(0,g.useTransition)(),L=(0,g.useRef)(null),[_,F]=(0,i.Tw)("first"),[R,P]=(0,g.useState)(null),D=function(e,n){try{return n?new URL(null!==e&&void 0!==e?e:"",n).toString():void 0}catch{console.error("Invalid base URL:",e,"endpointUrl",n)}}(a.provider.basePath,null===A||void 0===A?void 0:A.url),{models:B,modelId:z,modelsError:V}=Ln(a.provider,_,D),{agents:N}=(0,o.B)(),q=N.find((e=>e.id===a.provider.agentId)),{error:H,messages:U,input:Q,setInput:O,stop:X,status:W,append:G,setMessages:Y}=(0,jn.Y_)({id:a.id,api:D,body:{modelId:z},initialMessages:a.messages,experimental_throttle:50,fetch:async(e,n)=>{if(d||"custom"===z){var t;const e=JSON.parse(null===n||void 0===n?void 0:n.body),i=(0,bn.r)({baseURL:D,apiKey:a.provider.apiKey||"dummy"}),l=(0,Cn.gM)({abortSignal:(null===n||void 0===n?void 0:n.signal)||void 0,model:(0,Cn.ae)({model:i(z),middleware:(0,Cn.Ol)({tagName:"think"})}),messages:null===e||void 0===e?void 0:e.messages,system:q&&null!==(t=q.config.system_prompt)&&void 0!==t?t:"",...a.usingParameters?a.parameters:{}}),o=function(e){return e.filter((e=>"user"===e.role)).at(-1)}(e.messages);return o&&(null===m||void 0===m||m(o)),P(Date.now()),l.toDataStreamResponse({sendReasoning:!0,getErrorMessage:e=>function(e){try{if(k.hL.isInstance(e))return e.responseBody?JSON.parse(e.responseBody||"{}").message:e.message;if(e instanceof Error)return e.message;if("string"===typeof e)return e}catch{}return"Unknown error:"+e}(e)})}return fetch(e,n)},onFinish:(e,n)=>{let{finishReason:t}=n;"stop"===t&&(null===m||void 0===m||m(e))}}),J="streaming"===W||"submitted"===W;return(0,g.useEffect)((()=>{V&&"first"!==_&&j.error(`Error fetching models: ${V}`,5)}),[V,_,j]),(0,g.useEffect)((()=>{a.messages.length>0&&Y(a.messages)}),[Y,a.messages]),(0,h.jsxs)(Sn.A,{...x,variant:"outlined",className:Tn()(S,f),styles:{...y,body:{backgroundColor:I.colorFillQuaternary,borderRadius:0,flex:1,display:"flex",flexDirection:"column",padding:0,height:"50%",position:"relative",...null===y||void 0===y?void 0:y.body},actions:{paddingLeft:I.paddingContentHorizontal,paddingRight:I.paddingContentHorizontal,...null===y||void 0===y?void 0:y.actions},header:{zIndex:1,paddingInline:I.paddingContentHorizontal,paddingRight:I.paddingXS,...null===y||void 0===y?void 0:y.header}},title:(0,h.jsx)(_n,{models:B,modelId:z,onChangeModel:e=>{null===l||void 0===l||l({provider:{modelId:e}})},agents:N,agent:q,onChangeAgent:e=>{null===l||void 0===l||l({provider:{agentId:e.id,endpointId:e.endpoint_id}})},endpointFrgmt:A,onChangeEndpoint:e=>{null===l||void 0===l||l({provider:{endpointId:e}})},sync:a.sync,onChangeSync:e=>{null===l||void 0===l||l({sync:e})},fetchKey:_,closable:r,cloneable:s,onAddChat:()=>{null===u||void 0===u||u(a)},onRemoveChat:()=>{null===c||void 0===c||c(a)},onClearMessage:()=>{null===v||void 0===v||v(a),Y([])},parameters:a.parameters,usingParameters:a.usingParameters,onChangeParameter:(e,n)=>{null===l||void 0===l||l({usingParameters:e,parameters:n})}}),ref:L,children:[D&&A&&K().isEmpty(B)&&(0,h.jsx)(xn,{endpointUrl:null!==(n=null===A||void 0===A?void 0:A.url)&&void 0!==n?n:"",basePath:a.provider.basePath,token:a.provider.apiKey,endpointId:null===A||void 0===A?void 0:A.endpoint_id,loading:T,onSubmit:e=>{E((()=>{F(),null===l||void 0===l||l({...a,provider:{...a.provider,basePath:e.basePath,apiKey:e.token}})}))}}),K().isEmpty(null===H||void 0===H?void 0:H.message)?null:(0,h.jsx)(fn.A,{message:null===H||void 0===H?void 0:H.message,type:"error",showIcon:!0,className:w,closable:!0}),D?null:(0,h.jsx)(fn.A,{message:b("error.InvalidBaseURL"),type:"error",showIcon:!0,className:w,closable:!0}),(0,h.jsx)(cn,{messages:U,input:Q,isStreaming:J,startTime:R}),(0,h.jsx)(Fn,{disabled:!D,sync:a.sync,input:Q,setInput:O,stop:X,append:G,isStreaming:J,dropContainerRef:L})]})},Kn=(0,g.memo)(Rn);var Mn=t(98606);const Pn=(()=>{const e=(0,Mn.d)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",8);return n=>`${n}/${e()}`})();function Dn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const n=16*Math.random()|0;return("x"===e?n:3&n|8).toString(16)}))}const Bn=function(e){var n;const t=new Map(JSON.parse(null!==(n=localStorage.getItem(e))&&void 0!==n?n:"[]"));return{cache:t,set(n,a){t.set(n,a),localStorage.setItem(e,JSON.stringify(Array.from(t.entries())))},get:e=>t.get(e),size:()=>t.size,delete(n){t.delete(n),localStorage.setItem(e,JSON.stringify(Array.from(t.entries())))},clear:()=>{t.clear(),localStorage.removeItem(e)},getAll:()=>Array.from(t.entries()).map((e=>{let[n,t]=e;return{id:n,...t}}))}}("backendaiwebui.cache.chat_history");function $n(e,n){const[t,a]=(0,g.useState)([]),[l,o]=(0,g.useState)(void 0),r=(0,i.f0)(),s=(0,g.useCallback)((e=>(Bn.delete(e),a([...Bn.getAll().sort(Nn)]),Bn.size())),[]),d=(0,g.useCallback)((e=>{const n=K().merge({},e,{updatedAt:(new Date).toISOString()});Bn.set(e.id,n),o({...n}),a([...Bn.getAll().sort(Nn)])}),[]),c=(0,g.useCallback)((e=>{let{provider:n,id:t}=e;if(!l)return void console.error("Chat history is not initialized.");const a=Vn({provider:n}),i=l.chats.findIndex((e=>e.id===t));if(-1!==i){if(l.chats.splice(i+1,0,a),!zn(t))return d({...l}),void r(`/chat/${l.id}`,{replace:!0});d({...l})}else console.error(`Chat with id ${t} not found in cache.`)}),[l,r,d]),u=(0,g.useCallback)((e=>{if(!l)return void console.error("Chat history is not initialized.");-1!==l.chats.findIndex((n=>n.id===e))&&(l.chats=l.chats.filter((n=>n.id!==e)),d({...l}))}),[l,d]),p=(0,g.useCallback)(((e,n)=>{if(!l)return void console.error("Chat history is not initialized.");const t=l.chats.findIndex((n=>n.id===e));if(-1===t)return void console.error(`Chat with id ${e} not found in cache.`);l.chats[t]=K().merge({},l.chats[t],n);const a=zn(l.id);a?(a.chats[t]=l.chats[t],d(a)):(d({...l}),r(`/chat/${l.id}`,{replace:!0}))}),[l,d,r]),m=(0,g.useCallback)(((e,n)=>{if(!l)return void console.error("Chat history is not initialized.");const t=l.chats.findIndex((n=>n.id===e));if(-1===t)return void console.error(`Chat with id ${e} not found in cache.`);const a=l.chats[t],i=a.messages.at(-1);var o;((null===i||void 0===i?void 0:i.id)===e?l.chats[t].messages=[...a.messages.slice(0,-1),K().merge({},i,{content:n.content,parts:n.parts})]:l.chats[t].messages=[...a.messages,n],0===t&&2===l.chats[t].messages.length&&"assistant"===n.role)&&(l.label=null!==(o=l.chats[0].messages[0].content)&&void 0!==o?o:l.label);const s=zn(l.id);s?(s.chats[t]=l.chats[t],d(s)):(d({...l}),r(`/chat/${l.id}`,{replace:!0}))}),[l,d,r]),h=(0,g.useCallback)((e=>{if(!l)return void console.error("Chat history is not initialized.");const n=l.chats.findIndex((n=>n.id===e));if(-1===n)return void console.error(`Chat with id ${e} not found in cache.`);l.chats.find((n=>n.id===e))?(l.chats[n].messages=[],d({...l})):console.error(`Chat with id ${e} not found in chat history.`)}),[l,d]);return(0,g.useEffect)((()=>{const t=zn(e),i=t||function(e){let{chats:n,provider:t}=e;const a=new Date,i=Dn(),l={id:i,label:"Chat",chats:null!==n&&void 0!==n?n:[Vn({provider:t})],updatedAt:a.toISOString()};return l}({provider:n});o(i),a([...Bn.getAll().sort(Nn)])}),[e]),{chat:l,addChatData:c,removeChatData:u,updateChatData:p,saveChatMessage:m,clearChatMessage:h,history:t,removeHistory:s,updateHistory:d}}function zn(e){return Bn.get(e)}function Vn(e){let{provider:n}=e;return{id:Pn("/chat"),sync:!0,usingParameters:!1,parameters:b,provider:n,messages:[]}}function Nn(e,n){return new Date(n.updatedAt).getTime()-new Date(e.updatedAt).getTime()}var qn,Hn=t(94558),Un=t(9987),Qn=t(18728),On=t(49664),Xn=t(62122),Wn=t(83902),Gn=t(47174);const Yn=(0,wn.rU)((e=>{let{css:n}=e;return{chatViewHorizontal:n`
    overflow: auto;
    height: calc(100vh - 224px);
  `,chatViewVertical:n`
    overflow: hidden;
  `,chatCard:n`
    flex: 1;
    overflow: 'hidden';
  `,fixEditableVerticalAlign:n`
    & {
      margin-top: 0px !important;
      inset-inline-start: 0px !important;
    }
  `}}));const Jn=e=>{let{selectedHistoryId:n,history:t,open:a,onClickClose:i,onClickRemove:l,onClickHistory:o}=e;return(0,h.jsx)(Hn.A,{getContainer:!1,open:a,onClose:i,mask:!1,maskClosable:!0,title:(0,T.t)("chatui.History"),styles:{body:{paddingBlock:0}},children:(0,h.jsx)(Un.A,{dataSource:t.map((e=>({title:e.label,id:e.id,updatedAt:e.updatedAt}))),renderItem:e=>(0,h.jsx)(Un.A.Item,{actions:[(0,h.jsx)(Z.Ay,{type:"text",icon:(0,h.jsx)(Qn.A,{onClick:n=>{n.stopPropagation(),l(e.id)}})},"delete")],style:{cursor:"pointer"},styles:{actions:{padding:0}},onClick:()=>o(e.id),children:(0,h.jsx)(Un.A.Item.Meta,{title:(0,h.jsx)(me.A,{dot:n===e.id,children:e.title}),description:gn()(e.updatedAt).format("YYYY-MM-DD HH:mm:ss")})})})})},Zn=e=>{let{id:n}=e;const l=function(e){var n;const[{endpointId:t,modelId:a,agentId:i,apiKey:l}]=(0,Gn.useQueryParams)({endpointId:Gn.StringParam,agentId:Gn.StringParam,modelId:Gn.StringParam,apiKey:Gn.StringParam});return{basePath:"v1",baseURL:"",endpointId:null!==(n=null!==t&&void 0!==t?t:e)&&void 0!==n?n:void 0,agentId:null!==i&&void 0!==i?i:void 0,modelId:null!==a&&void 0!==a?a:void 0,apiKey:null!==l&&void 0!==l?l:void 0}}(function(){var e;const n=(0,i.CX)(),{endpoint_list:a}=(0,M.useLazyLoadQuery)(void 0!==qn?qn:qn=t(56440),{filter:n.supports("endpoint-lifecycle-stage-filter")?'lifecycle_stage == "created"':void 0});return(null===a||void 0===a||null===(e=a.items[0])||void 0===e?void 0:e.endpoint_id)||void 0}()),{styles:o}=Yn(),[r,s]=(0,g.useState)(!1),{chat:c,history:u,addChatData:p,removeChatData:m,updateChatData:v,saveChatMessage:y,clearChatMessage:f,removeHistory:x,updateHistory:k}=$n(n,l),b=(0,i.f0)();return c&&(0,h.jsxs)(a.A,{title:(0,h.jsx)(A.A.Text,{className:o.fixEditableVerticalAlign,editable:zn(c.id)?{onChange:e=>{K().isEmpty(e)||k({...c,label:e})},text:c.label,triggerType:["icon","text"]}:void 0,children:c.label}),styles:{body:{overflow:"hidden",paddingTop:0}},style:{overflow:"hidden"},extra:(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(q.A,{title:(0,T.t)("chatui.NewChat"),children:(0,h.jsx)(Z.Ay,{type:"text",icon:(0,h.jsx)(On.A,{}),onClick:()=>{s(!1),b("/chat",{replace:!0})}})}),(0,h.jsx)(q.A,{title:(0,T.t)("chatui.History"),children:(0,h.jsx)(Z.Ay,{type:"text",icon:(0,h.jsx)(Xn.A,{}),onClick:()=>{s(!r)}})})]}),children:[n&&(0,h.jsx)(d.A,{className:o.chatViewVertical,direction:"column",align:"stretch",gap:"xs",children:(0,h.jsx)(d.A,{className:o.chatViewHorizontal,gap:"xs",direction:"row",align:"stretch",children:(0,h.jsx)(g.Suspense,{fallback:(0,h.jsx)(Sn.A,{className:o.chatCard,loading:!0}),children:K().map(c.chats,((e,n)=>{return(0,h.jsx)(Kn,{className:o.chatCard,chat:e,onUpdateChat:n=>{v(e.id,n)},fetchOnClient:!0,onRemoveChat:()=>{m(e.id)},onAddChat:()=>{p(e)},onSaveMessage:n=>{y(e.id,n)},onClearMessage:e=>{f(e.id)},closable:(t=c.chats.length,t>1),cloneable:et(c.chats.length)},e.id);var t}))})})}),(0,h.jsx)(Jn,{selectedHistoryId:c.id,open:r,history:u,onClickClose:()=>{s(!1)},onClickRemove:e=>{if(0===x(e))s(!1),b("/chat",{replace:!0});else if(e===c.id){const n=u.filter((n=>{let{id:t}=n;return t!==e}))[0];b(`/chat/${null===n||void 0===n?void 0:n.id}`,{replace:!0})}},onClickHistory:e=>{b(`/chat/${e}`,{replace:!0})}})]})};function et(e){return e<=10}const nt=()=>{const{id:e}=(0,Wn.g)(),n=(0,i.f0)();return e&&!zn(e)&&n("/chat",{replace:!0}),(0,h.jsx)(Zn,{id:e||Dn()})}}}]);
//# sourceMappingURL=152.bfb836f3.chunk.js.map