"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[8377],{41610:(e,n,l)=>{l.d(n,{A:()=>u});var a=l(89130),s=l(50868),i=l(85690),t=l(89608),r=l.n(t),o=(l(43373),l(73689));const u=e=>{let{title:n,valueLabel:l,percent:t=0,width:u,strokeColor:d,labelStyle:c,size:m="small"}=e;const{token:g}=s.A.useToken(),p="small"===m?g.fontSizeSM:"middle"===m?g.fontSize:g.fontSizeLG;return(0,o.jsxs)(a.A,{style:{padding:1,border:`1px solid ${g.colorBorder}`,borderRadius:3,backgroundColor:g.colorBgContainerDisabled,...r().isNumber(u)||r().isString(u)?{width:u}:{flex:1}},direction:"column",align:"stretch",children:[(0,o.jsx)(a.A,{style:{height:"100%",width:`${t>100?100:t}%`,position:"absolute",left:0,top:0,backgroundColor:null!==d&&void 0!==d?d:g.colorSuccess,opacity:.7,zIndex:0,overflow:"hidden"}}),(0,o.jsxs)(a.A,{direction:"row",justify:"between",children:[(0,o.jsx)(i.A.Text,{style:{fontSize:p,...c},children:n}),(0,o.jsx)(i.A.Text,{style:{fontSize:p,...c},children:l})]})]})}},56702:(e,n,l)=>{l.r(n),l.d(n,{default:()=>s});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionInfoCellFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null}],type:"ComputeSession",abstractKey:null,hash:"93f8cd0d4b47d24ea281955be0ad792b"},s=a},89788:(e,n,l)=>{l.r(n),l.d(n,{default:()=>s});const a=function(){var e={defaultValue:null,kind:"LocalArgument",name:"ak"},n={defaultValue:null,kind:"LocalArgument",name:"group_id"},l={defaultValue:null,kind:"LocalArgument",name:"limit"},a={defaultValue:null,kind:"LocalArgument",name:"offset"},s={defaultValue:null,kind:"LocalArgument",name:"skipClusterSize"},i={defaultValue:null,kind:"LocalArgument",name:"status"},t=[{kind:"Variable",name:"access_key",variableName:"ak"},{kind:"Variable",name:"group_id",variableName:"group_id"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"status",variableName:"status"}],r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},A={alias:null,args:null,kind:"ScalarField",name:"starts_at",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"agents",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null};return{fragment:{argumentDefinitions:[e,n,l,a,s,i],kind:"Fragment",metadata:null,name:"SessionListQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,m,g,p,x,h,y,f,S,v,k,A,j,_,b,{args:null,kind:"FragmentSpread",name:"SessionInfoCellFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,a,e,n,i,s],kind:"Operation",name:"SessionListQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,m,g,p,x,h,y,f,S,v,k,A,j,_,b,{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"83e3fabcd47538a643850d50617579a5",id:null,metadata:{},name:"SessionListQuery",operationKind:"query",text:"query SessionListQuery(\n  $limit: Int!\n  $offset: Int!\n  $ak: String\n  $group_id: String\n  $status: String\n  $skipClusterSize: Boolean!\n) {\n  compute_session_list(limit: $limit, offset: $offset, access_key: $ak, group_id: $group_id, status: $status) {\n    items {\n      id\n      type\n      session_id\n      name\n      image\n      architecture\n      created_at\n      terminated_at\n      status\n      status_info\n      service_ports\n      mounts\n      occupied_slots\n      resource_opts\n      access_key\n      starts_at\n      scaling_group\n      agents\n      cluster_size @skipOnClient(if: $skipClusterSize)\n      ...SessionInfoCellFragment\n    }\n  }\n}\n\nfragment SessionInfoCellFragment on ComputeSession {\n  id\n  session_id\n  name\n  status\n  user_email\n  image\n}\n"}}}();a.hash="b0859dbf2946abcb56ec83ac42d76781";const s=a},28377:(e,n,l)=>{l.r(n),l.d(n,{default:()=>W});var a=l(58879),s=l(15634),i=l(9194),t=l(41610),r=l(89130),o=l(51593),u=l(60881),d=l(7194),c=l(6597),m=l(69056),g=l(89608),p=l.n(g),x=l(43373),h=l(73689);const y=e=>{let{projectId:n,autoSelectDefault:l,filter:i,searchValue:t,onSearch:r,loading:g,...y}=e;const f=(0,a.QE)(),S=(0,s.hd)(),[v,k]=(0,o.Tw)("first"),[A,j]=(0,d.A)({value:t,onChange:r}),[_,b]=(0,d.A)(y),[I,F]=(0,x.useTransition)(),{data:N}=(0,u.nj)({queryKey:["ResourceGroupSelectQuery",S.name],queryFn:()=>{const e=new URLSearchParams;return e.set("group",S.name),Promise.all([f({method:"GET",url:`/scaling-groups?${e.toString()}`}),f({method:"GET",url:"/folders/_/hosts"})])},staleTime:0,fetchKey:v}),E=p().flatMap(null===N||void 0===N?void 0:N[1].volume_info,(e=>{var n;return null!==(n=null===e||void 0===e?void 0:e.sftp_scaling_groups)&&void 0!==n?n:[]})),T=p().filter(null===N||void 0===N?void 0:N[0].scaling_groups,(e=>!p().includes(E,e.name)&&(!i||i(e.name))));(0,x.useEffect)((()=>{_&&!p().some(T,(e=>e.name===_))&&b(void 0)}),[T,_,b]);const C=p().find(T,(e=>"default"===e.name))||T[0],L=C?{label:C.name,value:C.name}:void 0;(0,x.useEffect)((()=>{l&&L&&L.value!==y.value&&b(L.value,L)}),[l]);const R=y.showSearch?{onSearch:j,searchValue:A,showSearch:!0}:{};return(0,h.jsx)(m.A,{defaultActiveFirstOption:!0,...R,defaultValue:l?L:void 0,onDropdownVisibleChange:e=>{e&&F((()=>{k()}))},loading:I||g,options:p().map(T,(e=>({value:e.name,label:e.name}))),optionRender:e=>{var n;return(0,h.jsx)(c.A,{keyword:A,children:null===(n=e.data.value)||void 0===n?void 0:n.toString()})},...y,value:_,onChange:b})};var f=l(65666),S=l(40567),v=l(55368),k=l(33789),A=l(60822);const j=()=>{var e,n,l,o;const u=(0,s.hd)(),[d,c]=(0,x.useState)(),m=(0,x.useDeferredValue)(d),[{remaining:g,resourceLimits:p,resourceGroupResourceSize:j}]=(0,i.y)({currentProjectName:u.name,currentResourceGroup:m||"default"});return console.log(typeof g.mem,g.mem),(0,h.jsx)(v.A,{title:(0,h.jsxs)(r.A,{direction:"row",gap:"xs",children:[(0,h.jsx)(y,{showSearch:!0,autoSelectDefault:!0,style:{minWidth:100},value:d,onChange:e=>c(e),loading:d!==m,popupMatchSelectWidth:!1})," ","\ub9ac\uc18c\uc2a4 \uadf8\ub8f9 \uc0ac\uc6a9 \uac00\ub2a5\ud55c \uc790\uc6d0",(0,h.jsx)(k.A,{title:"\uc120\ud0dd\ud55c \ub9ac\uc18c\uc2a4 \uadf8\ub8f9\uc5d0\uc11c \ud604\uc7ac \uc0ac\uc6a9\uc790\uac00 \uc9c0\uae08 \ubc14\ub85c \uc0ac\uc6a9\uac00\ub2a5\ud55c \ub9ac\uc18c\uc2a4 \uc591\uc73c\ub85c \ud604\uc7ac \uc0ac\uc6a9\uc790\uc5d0\uac8c \uc801\uc6a9\ub418\ub294 \ub9ac\uc18c\uc2a4 \uc815\ucc45\uacfc \ub9ac\uc18c\uc2a4 \uadf8\ub8f9\uc758 \uac00\uc6a9\uc591\uc5d0 \ub530\ub77c \uacb0\uc815\ub429\ub2c8\ub2e4.",children:(0,h.jsx)(f.A,{})})]}),extra:[(0,h.jsx)(A.Ay,{icon:(0,h.jsx)(S.A,{}),type:"text"})],children:(0,h.jsxs)(r.A,{gap:"md",children:[(0,h.jsx)(t.A,{title:"CPU",percent:g.cpu/(p.cpu?p.cpu.max:j.cpu)*100,valueLabel:g.cpu+" Core"}),(0,h.jsx)(t.A,{title:"MEM",percent:((null===(e=(0,a.Js)(g.mem+"","m"))||void 0===e?void 0:e.number)||0)/((null===(n=(0,a.Js)((null===(l=p.mem)||void 0===l?void 0:l.max)+"","m"))||void 0===n?void 0:n.number)||1)*100,valueLabel:(null===(o=(0,a.Js)(g.mem+"","g",2))||void 0===o?void 0:o.numberFixed)+" GiB"})]})})};var _,b=l(94016),I=l(98401),F=l(16272),N=l(76604),E=l(96301),T=l(50868),C=l(23702),L=l(67378),R=l(85690),K=l(56762),w=l(88522);const G=e=>{let{sessionFrgmt:n,sessionNameList:a,onRename:s}=e;const i=(0,o.CX)(),{token:t}=T.A.useToken(),d=(0,w.useFragment)(void 0!==_?_:_=l(56702),n),c=(0,u.ET)({mutationFn:e=>{const n=i.APIMajorVersion<5?d.name:d.session_id;return i.rename(n,e)}}),m=(0,x.useRef)(null),{t:g}=(0,K.Bd)(),[y,f]=(0,x.useState)(!1),[S,v]=(0,x.useState)(d.name),k=function(){return["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(d.status||void 0)&&!function(){return["RESTARTING","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(d.status||void 0)&&i.email===d.user_email,j=c.isPending||S!==d.name;return(0,h.jsx)(C.A,{ref:m,children:y?(0,h.jsx)(C.A.Item,{style:{margin:0},name:"name",rules:[{required:!0},{max:64},{pattern:/^(?:[a-zA-Z0-9][-a-zA-Z0-9._]{2,}[a-zA-Z0-9])?$/,message:g("session.Validation.EnterValidSessionName")},()=>({validator:(e,n)=>p().without(a,d.name).includes(String(n))?Promise.reject(new Error(g("session.Validation.SessionNameAlreadyExist"))):Promise.resolve()})],children:(0,h.jsx)(L.A,{autoFocus:!0,onPressEnter:()=>(()=>{var e;null===(e=m.current)||void 0===e||e.validateFields().then((e=>{let{name:n}=e;f(!1),d.name!==n&&(v(n),c.mutate(n,{onSuccess:e=>{s&&s()},onError:e=>{v(d.name)}}))})).catch((()=>{}))})(),onKeyUp:e=>{"Escape"===e.key&&f(!1)}})}):(0,h.jsxs)(r.A,{style:{maxWidth:250},children:[(0,h.jsx)(R.A.Text,{ellipsis:{tooltip:{overlayInnerStyle:{width:"max-content"}}},style:{opacity:j?.5:1},children:S}),k&&(0,h.jsx)(A.Ay,{loading:j,type:"text",icon:(0,h.jsx)(E.A,{}),style:{color:t.colorLink},onClick:()=>{var e;null===(e=m.current)||void 0===e||e.setFieldsValue({name:d.name}),f(!0)}})]})})};var D,P=l(51786),V=l(60210),z=l(77731),$=l(15934);const U=e=>{var n;let{status:a=[],limit:s=50,currentPage:i=1,pageSize:t=50,projectId:u,filter:d,extraFetchKey:c="",...m}=e;const g=(0,o.CX)(),[y,f]=(0,o.Tw)("initial-fetch"),S=(0,x.useDeferredValue)(y+c),{t:v}=(0,K.Bd)(),{token:k}=T.A.useToken(),[,{getImageAliasName:A,getBaseVersion:j,getBaseImage:_}]=(0,o.Gj)();!g.supports("avoid-hol-blocking")&&a.includes("SCHEDULED")&&(a=a.filter((e=>"SCHEDULED"!==e)));const{compute_session_list:E}=(0,w.useLazyLoadQuery)(void 0!==D?D:D=l(89788),{limit:t,offset:(i-1)*t,status:null===(n=a)||void 0===n?void 0:n.join(","),group_id:u,skipClusterSize:!g.supports("multi-container")},{fetchKey:S,fetchPolicy:"network-only"}),C={RESTARTING:"blue",PREPARING:"blue",PULLING:"blue",RUNNING:"green",PENDING:"green",SCHEDULED:"green",ERROR:"red"},L={"idle-timeout":"green","user-requested":"green",scheduled:"green","self-terminated":"green","no-available-instances":"red","failed-to-start":"red","creation-failed":"red"},U={INTERACTIVE:"green",BATCH:"darkgreen",INFERENCE:"blue"};return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(z.A,{scroll:{x:"max-content"},columns:[{title:v("session.SessionInfo"),render:(e,n,l)=>(0,h.jsx)(G,{sessionFrgmt:n,sessionNameList:p().map(((null===E||void 0===E?void 0:E.items)||[]).filter(d)||[],"name"),onRename:()=>{f(n.session_id+(new Date).toISOString())}},n.session_id),fixed:"left"},{title:v("session.Status"),dataIndex:"status",render:(e,n)=>(0,h.jsx)(h.Fragment,{children:""!==n.status_info?(0,h.jsx)(I.A,{values:[{label:e,color:p().get(C,e)},{label:n.status_info,color:p().get(L,n.status_info)}]}):(0,h.jsx)($.A,{color:p().get(C,e),children:e})})},{title:v("general.Control")},{title:v("session.Configuration"),dataIndex:"mounts",render:(e,n)=>(0,h.jsxs)(h.Fragment,{children:[e.length>0?(0,h.jsxs)(r.A,{gap:"xxs",style:{width:200},children:[(0,h.jsx)(P.A,{}),(0,h.jsx)(R.A.Text,{ellipsis:{tooltip:{overlayInnerStyle:{width:"max-content"},title:p().map(e,(e=>(0,h.jsx)("div",{children:e})))}},children:e.join(", ")})]}):(0,h.jsxs)(r.A,{gap:"xxs",style:{color:k.colorTextDisabled},children:[(0,h.jsx)(P.A,{}),"No mount"]}),(0,h.jsxs)(r.A,{gap:"xxs",children:[(0,h.jsx)(V.A,{}),n.scaling_group]}),(0,h.jsx)(r.A,{gap:"xxs",children:n.occupied_slots&&p().map(JSON.parse(n.occupied_slots),((e,l)=>(0,h.jsx)(N.A,{type:l,value:p().toString(e),opts:{shmem:p().sum(p().map(JSON.parse(n.resource_opts),(e=>e.shmem)))}},l)))})]})},{title:v("session.Usage")},{title:v("session.Reservation"),dataIndex:"created_at",render(e,n){const l=new Date(e).toLocaleString();return(0,h.jsxs)(r.A,{direction:"column",gap:"xs",children:[l,(0,h.jsx)(I.A,{values:[v("session.ElapsedTime"),(0,h.jsx)(b.A,{callback:()=>g.utils.elapsedTime(e,n.terminated_at),delay:1e3})]})]})}},{title:v("session.EnvironmentInfo"),render:e=>(0,h.jsx)($.A,{color:"gold",children:(0,h.jsxs)(r.A,{direction:"column",children:[(0,h.jsxs)(r.A,{gap:"xxs",children:[(0,h.jsx)(F.A,{image:e.image}),(0,h.jsx)("div",{children:A(e.image)}),j(e.image)]}),(0,h.jsxs)(r.A,{gap:"xxs",children:[(0,h.jsx)("div",{children:_(e.image)}),e.architecture]})]})})},{title:v("session.SessionType"),dataIndex:"type",render:e=>(0,h.jsx)($.A,{color:p().get(U,e),children:e})},...g.is_admin||g._config.hideAgents?[{title:v("session.Agents"),dataIndex:"agents",render:e=>p().map(e,(e=>e))}]:[]],dataSource:((null===E||void 0===E?void 0:E.items)||[]).filter(d),...m})})};var B=l(68190),M=l(24337),O=l(29977),Q=l(39464),q=l(78792);const H=["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"],J={running:H,interactive:H,batch:H,inference:H,finished:["TERMINATED","CANCELLED"],others:["TERMINATING","ERROR"],default:H},W=e=>{let{children:n}=e;const{t:l}=(0,K.Bd)(),a=(0,o.CX)(),{token:i}=T.A.useToken(),t=(0,s.hd)(),u=(0,o.f0)(),[d,c]=(0,x.useState)("running"),[m,g]=(0,x.useState)("next"),[{keypair:p,keypairResourcePolicy:y}]=(0,B.y)();return(0,h.jsxs)(r.A,{direction:"column",align:"stretch",gap:"sm",children:[(0,h.jsx)(Q.A,{message:(0,h.jsxs)(r.A,{gap:"md",children:[(0,h.jsxs)(R.A.Text,{children:["This is"," ","current"===m?"current version":"NEXT generation"," ","of session list. you can switch anytime."]}),(0,h.jsx)(q.A,{options:[{label:"Current",value:"current"},{label:(0,h.jsx)(R.A.Text,{style:{color:"next"===m?i.colorPrimary:void 0},children:"Next"}),value:"next",icon:(0,h.jsx)(M.A,{twoToneColor:i.colorWarning})}],value:m,onChange:e=>g(e)})]}),type:"info",showIcon:!0}),(0,h.jsxs)(r.A,{direction:"column",align:"stretch",style:{display:"next"===m?"flex":"none"},gap:"sm",children:[(0,h.jsx)(j,{}),(0,h.jsxs)(v.A,{bodyStyle:{padding:0},tabList:[{key:"running",label:(0,h.jsx)(h.Fragment,{children:l("session.Running")+` (${p.concurrency_used}/${1e6===y.max_concurrent_sessions?"\u221e":y.max_concurrent_sessions})`})},{key:"interactive",label:l("session.Interactive")},{key:"batch",label:l("session.Batch")},...a.supports("inference-workload")?[{key:"inference",label:l("session.Inference")}]:[],{key:"finished",label:l("session.Finished")},{key:"others",label:l("session.Others")}],activeTabKey:d,onTabChange:e=>c(e),tabBarExtraContent:(0,h.jsx)(r.A,{direction:"row",gap:"sm",children:(0,h.jsx)(A.Ay,{type:"primary",icon:(0,h.jsx)(O.A,{}),onClick:()=>{u("/session/start")},children:"START"})}),children:[n,(0,h.jsx)(r.A,{direction:"column",align:"stretch",children:(0,h.jsx)(x.Suspense,{fallback:(0,h.jsx)("div",{children:"loading.."}),children:(0,h.jsx)(r.A,{direction:"column",align:"stretch",children:(0,h.jsx)(U,{projectId:t.id,style:{marginTop:1},status:J[d]||J.default,filter:e=>{var n;return!["interactive","batch","inference"].includes(d)||(null===e||void 0===e||null===(n=e.type)||void 0===n?void 0:n.toLowerCase())===d},extraFetchKey:d})})})})]})]}),(0,h.jsx)(r.A,{direction:"column",align:"stretch",style:{display:"next"===m?"none":"flex"},children:(0,h.jsx)("backend-ai-session-view",{class:"page",name:"job",active:"next"!==m||null})})]})}}}]);
//# sourceMappingURL=8377.79e5bbd8.chunk.js.map