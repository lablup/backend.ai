"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[3835],{61823:(e,n,a)=>{a.d(n,{A:()=>j});var l=a(17898),i=a(23441),s=a(7971),r=a(69949),t=a(55093);var o,d=a(88543),u=a(22407),c=a(72338),m=a(99159),g=a(14188),p=a(66596),y=a(28354),h=a(12221),v=a(92047),k=a(2556),f=a(91043),_=a(46976),F=a.n(_),S=a(61507),x=a(33364),b=a(63821),A=a(79569);const j=e=>{var n,_,j,K,T,w;let{sessionFrgmt:C,...N}=e;const L=(0,i.CX)(),{token:R}=p.A.useToken(),E=(0,s.Am)(),I=(0,b.useFragment)(void 0!==o?o:o=a(50029),C),D=(null===I||void 0===I||null===(n=I.kernel_nodes)||void 0===n||null===(_=n.edges)||void 0===_?void 0:_.map((e=>null===e||void 0===e?void 0:e.node)))||[],[M,q]=(0,t.useState)((null===(j=F().find(D,(e=>"main"===(null===e||void 0===e?void 0:e.cluster_role))))||void 0===j?void 0:j.row_id)||(null===(K=D[0])||void 0===K?void 0:K.row_id));(0,t.useEffect)((()=>{!1===N.open&&q(void 0)}),[N.open]);const{data:U,refetch:P,isPending:$,isRefetching:B,dataUpdatedAt:O}=(0,r.nN)({queryKey:["containerLog",null===I||void 0===I?void 0:I.row_id,null===I||void 0===I?void 0:I.access_key,M,N.open],queryFn:async()=>N.open&&null!==I&&void 0!==I&&I.row_id&&null!==I&&void 0!==I&&I.access_key&&M?await L.get_logs(null===I||void 0===I?void 0:I.row_id,null===I||void 0===I?void 0:I.access_key,M,15e3).then((e=>e.result.logs)):"",staleTime:5e3}),[V,{resetPrevious:G}]=function(e,n){let{initialPrev:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const l=(0,t.useRef)(a),[i,s]=(0,t.useState)({}),r=(0,t.useMemo)(e,n),o=(0,t.useMemo)((()=>l.current),[...n,i]);return(0,t.useEffect)((()=>{l.current=r}),n),[{previous:o,current:r},{resetPrevious:()=>{l.current=a,s({})}}]}((()=>(null===U||void 0===U?void 0:U.split("\n").length)||0),[U]),{md:Q}=y.Ay.useBreakpoint(),{t:W}=(0,x.Bd)();return(0,A.jsx)(d.A,{title:(0,A.jsxs)(c.A,{style:{maxWidth:"100%"},gap:"sm",children:[(0,A.jsx)(h.A.Title,{level:4,style:{margin:0,flexShrink:0},children:"Logs"}),I?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(h.A.Text,{style:{fontWeight:"normal"},ellipsis:!0,children:null===I||void 0===I?void 0:I.name}),(0,A.jsxs)(h.A.Text,{style:{fontWeight:"normal",fontFamily:"monospace"},copyable:{text:null===I||void 0===I?void 0:I.row_id,tooltips:W("button.CopySomething",{name:W("session.SessionId")})},children:["(",Q?null===I||void 0===I?void 0:I.row_id:null===I||void 0===I||null===(T=I.row_id.split("-"))||void 0===T?void 0:T[0],")"]})]}):null]}),width:"100%",styles:{header:{width:"100%"},body:{height:"calc(100vh - 100px)",maxHeight:"calc(100vh - 100px)"}},...N,footer:null,destroyOnClose:!0,children:(0,A.jsxs)(c.A,{direction:"column",align:"start",style:{height:"100%"},gap:"sm",children:[(0,A.jsxs)(c.A,{gap:"sm",wrap:"wrap",children:["Kernel Role",(0,A.jsx)(u.A,{value:M,onChange:e=>{q(e),G()},autoSelectOption:!0,options:F().chain(null===I||void 0===I||null===(w=I.kernel_nodes)||void 0===w?void 0:w.edges).sortBy((e=>{var n,a;return`${null===e||void 0===e||null===(n=e.node)||void 0===n?void 0:n.cluster_role} ${null===e||void 0===e||null===(a=e.node)||void 0===a?void 0:a.cluster_idx}`})).map((e=>{var n,a,l,i,s;return{label:(0,A.jsxs)(A.Fragment,{children:[null===e||void 0===e||null===(n=e.node)||void 0===n?void 0:n.cluster_role,"main"!==(null===e||void 0===e||null===(a=e.node)||void 0===a?void 0:a.cluster_role)?null===e||void 0===e||null===(l=e.node)||void 0===l?void 0:l.cluster_idx:"","admin"===E||"superadmin"===E?(0,A.jsxs)(h.A.Text,{style:{fontFamily:"monospace",fontSize:R.fontSizeSM},type:"secondary",children:["(",((null===e||void 0===e||null===(i=e.node)||void 0===i?void 0:i.row_id)||"").substring(0,5),")"]}):null]}),value:null===e||void 0===e||null===(s=e.node)||void 0===s?void 0:s.row_id}})).value()}),(0,A.jsx)(v.A,{type:"vertical"}),(0,A.jsx)(k.A,{title:W("button.Download"),children:(0,A.jsx)(f.Ay,{size:"middle",icon:(0,A.jsx)(S.A,{}),disabled:$||B,onClick:()=>{const e=new Blob([U||""],{type:"text/plain"});(0,l.WN)(e,`${(null===I||void 0===I?void 0:I.name)||"session"}-logs-${M}-${(new Date).toISOString()}.txt`)}})}),(0,A.jsx)(k.A,{title:W("button.Refresh"),children:(0,A.jsx)(f.Ay,{size:"middle",loading:$||B,icon:(0,A.jsx)(m.A,{}),onClick:()=>P()})})]}),(0,A.jsx)("div",{style:{height:"calc(100% - 50px)",alignSelf:"stretch",border:`1px solid ${R.colorBorder}`,overflow:"hidden"},children:(0,A.jsx)(g.jB,{startFollowing:!0,render:e=>{let{follow:n,onScroll:a}=e;return(0,A.jsx)(g.FT,{enableLinks:!0,caseInsensitive:!0,enableSearch:!0,enableSearchNavigation:!0,selectableLines:!0,text:U||"",highlight:V.previous,extraLines:1,follow:n,onScroll:a})}},O)})]})})}},26480:(e,n,a)=>{a.d(n,{A:()=>u});var l,i,s=a(66596),r=a(85540),t=a(55093),o=a(63821),d=a(79569);const u=e=>{let{component:n=r.A,sessionFrgmt:u,style:c,...m}=e;const g=(0,o.useFragment)(void 0!==l?l:l=a(33589),u),[p,y]=(0,t.useState)(g.name),{token:h}=s.A.useToken(),[v,k]=(0,o.useMutation)(void 0!==i?i:i=a(93178));return g&&(0,d.jsx)(n,{editable:k?void 0:{onChange:e=>{y(e),v({variables:{input:{id:g.id,name:e,priority:g.priority}},onCompleted(e,n){},onError(e){}})},triggerType:["icon","text"]},copyable:!0,style:{...c,color:k?h.colorTextTertiary:null===c||void 0===c?void 0:c.color},...m,children:k?p:g.name})}},63482:(e,n,a)=>{a.d(n,{A:()=>D});var l,i,s=a(61823),r=a(23441),t=a(7971),o=a(69949),d=a(25905),u=a(81530),c=a(57613),m=a(88543),g=a(72338),p=a(12221),y=a(88221),h=a(80963),v=a(77946),k=a(46976),f=a.n(k),_=a(55093),F=a(33364),S=a(63821),x=a(79569);const b=(0,v.rU)((e=>{let{css:n,token:a}=e;return{custom:n`
      ul {
        list-style-type: circle;
        padding-left: ${a.paddingMD}px;
      }
    `}})),A=async e=>{let n,a;try{"GET"===e.method&&(e.body=void 0),n=await fetch(e.uri,e);const l=n.headers.get("Content-Type");if(null===l){if(a=n.ok,!n.ok)throw new Error(n)}else a=l.startsWith("application/json")||l.startsWith("application/problem+json")?await n.json():l.startsWith("text/")?await n.text():await n.blob();if(!n.ok)throw a}catch(l){return n}return a},j=async(e,n,a)=>{let l="http://127.0.0.1:5050/";if(void 0!==globalThis.__local_proxy&&void 0!==globalThis.__local_proxy.url?l=globalThis.__local_proxy.url:void 0!==a._config.proxyURL&&(l=a._config.proxyURL),void 0!==e&&void 0!==n){const i=await(async(e,n,a)=>{if(!0===a.debug){var l,i,s,r;if(null!==(l=globalThis.appLauncher)&&void 0!==l&&null!==(i=l.forceUseV1Proxy)&&void 0!==i&&i.checked)return"v1";if(null!==(s=globalThis.appLauncher)&&void 0!==s&&null!==(r=s.forceUseV2Proxy)&&void 0!==r&&r.checked)return"v2"}return globalThis.isElectron?"v1":a.scalingGroup.getWsproxyVersion(e,n).then((e=>e.wsproxy_version))})(e,n,a);"v1"!==i&&(l=new URL(`${i}/`,l).href)}return l},K=e=>{var n;let{sessionFrgmts:s,onRequestClose:v,...k}=e;const{t:K}=(0,F.Bd)(),{styles:T}=b(),w=(0,S.useFragment)(void 0!==l?l:l=a(5136),s),[C,N]=(0,_.useState)(!1),L=(0,t.Am)(),R=(0,r.CX)(),E=(0,u.hd)(),I=(0,o.ET)({mutationFn:async e=>(async(e,n,a,l)=>{const i=await j(e.scaling_group,a,l),s={method:"GET",uri:new URL(`proxy/${n}/${e.row_id}`,i).href};return A(s).then((a=>{let l=new URL(`proxy/${n}/${e.row_id}/delete`,i);return localStorage.getItem("backendaiwebui.appproxy-permit-key")&&(l.searchParams.set("permit_key",localStorage.getItem("backendaiwebui.appproxy-permit-key")||""),l=new URL(l.href)),void 0===a||404===a.code||A({method:"GET",uri:l.href,credentials:"include",mode:"cors"})}))})(e,R._config.accessKey,E.id,R).catch((e=>({error:e}))).then((n=>{const a=null===n||void 0===n?void 0:n.error;if(void 0===a||a&&a.message&&(404===a.statusCode||500===a.statusCode))return R.destroy(e.row_id,R._config.accessKey,C);throw a}))}),D=(0,S.useRelayEnvironment)(),M=(0,c.b)(),{upsertNotification:q}=(0,d.js)();return(0,x.jsx)(m.A,{centered:!0,title:K("session.TerminateSession"),open:!1,confirmLoading:I.isPending,onOk:()=>{var e;if(null!==(e=w[0])&&void 0!==e&&e.row_id){const e=w[0];I.mutateAsync(e).then((()=>{N(!1),v(!0)})).catch((e=>{q({message:M.relieve(null===e||void 0===e?void 0:e.title),description:null===e||void 0===e?void 0:e.message,open:!0})})).finally((()=>{const n=new CustomEvent("backend-ai-session-list-refreshed",{detail:"running"});return document.dispatchEvent(n),(0,S.fetchQuery)(D,void 0!==i?i:i=a(34185),{id:e.id,project_id:E.id}).toPromise()}))}},okText:K(C?"button.ForceTerminate":"session.Terminate"),okType:"danger",okButtonProps:{type:C?"primary":"default"},onCancel:()=>{N(!1),v(!1)},...k,children:(0,x.jsxs)(g.A,{className:T.custom,direction:"column",align:"stretch",gap:"xs",children:[(0,x.jsx)(p.A.Text,{children:K("usersettings.SessionTerminationDialog")}),(0,x.jsx)(p.A.Text,{mark:!0,children:1===w.length?null===(n=w[0])||void 0===n?void 0:n.name:`${w.length} sessions`}),(0,x.jsx)(y.A,{checked:C,onChange:e=>{N(e.target.checked)},children:K("button.ForceTerminate")}),C&&(0,x.jsxs)(h.A,{children:[(0,x.jsx)(p.A.Paragraph,{type:"danger",children:K("session.ForceTerminateWarningMsg")}),(0,x.jsxs)("ul",{children:[(0,x.jsx)("li",{children:K("session.ForceTerminateWarningMsg2")}),(0,x.jsx)("li",{children:K("session.ForceTerminateWarningMsg3")})]}),"superadmin"===L&&(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(h.A,{type:"inner",title:K("session.ContainerToCleanUp"),children:f().chain(w).map((e=>{var n;return null===e||void 0===e||null===(n=e.kernel_nodes)||void 0===n?void 0:n.edges})).map((e=>null===e||void 0===e?void 0:e.map((e=>null===e||void 0===e?void 0:e.node)))).flatten().groupBy("agent_id").map(((e,n)=>(0,x.jsxs)(x.Fragment,{children:[n,(0,x.jsx)("ul",{children:e.map((e=>(0,x.jsx)("li",{children:(0,x.jsx)(p.A.Text,{copyable:!0,children:e.container_id})},e.container_id)))},n)]}))).value()})})]})]})})};var T,w=a(66596),C=a(2556),N=a(91043),L=a(6299),R=a(93340),E=a(83006);const I=e=>!["TERMINATED","CANCELLED"].includes((null===e||void 0===e?void 0:e.status)||""),D=e=>{const{token:n}=w.A.useToken(),l={runTerminal:e=>{globalThis.appLauncher.runTerminal(e)},showLauncher:e=>{}},{t:i}=(0,F.Bd)(),r=(0,S.useFragment)(void 0!==T?T:T=a(79825),e.sessionFrgmt),[t,o]=(0,_.useState)(!1),[d,u]=(0,_.useState)(!1);return r&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(C.A,{title:i("session.ExecuteTerminalApp"),children:(0,x.jsx)(N.Ay,{disabled:!I(r),icon:(0,x.jsx)(L.A,{}),onClick:()=>{l.runTerminal(null===r||void 0===r?void 0:r.row_id)}})}),(0,x.jsx)(K,{sessionFrgmts:[r],open:t,onRequestClose:()=>{o(!1)}}),(0,x.jsx)(C.A,{title:i("session.SeeContainerLogs"),children:(0,x.jsx)(N.Ay,{icon:(0,x.jsx)(R.A,{}),onClick:()=>{u(!0)}})}),(0,x.jsx)(s.A,{sessionFrgmt:r,open:d,onCancel:()=>{u(!1)}}),(0,x.jsx)(C.A,{title:i("session.TerminateSession"),children:(0,x.jsx)(N.Ay,{disabled:!I(r),icon:(0,x.jsx)(E.A,{color:I(r)?n.colorError:void 0}),onClick:()=>{o(!0)}})})]})}},61207:(e,n,a)=>{a.d(n,{A:()=>m});var l,i=a(23441),s=a(6070),r=a(91238),t=a(78502),o=a.n(t),d=(a(55093),a(33364)),u=a(63821),c=a(79569);const m=e=>{let{sessionFrgmt:n}=e;const t=(0,i.CX)(),{t:m}=(0,d.Bd)(),g=(0,u.useFragment)(void 0!==l?l:l=a(93880),n);return(0,c.jsxs)(c.Fragment,{children:[o()(g.created_at).format("lll"),(0,c.jsx)(s.A,{callback:()=>null!==g&&void 0!==g&&g.created_at?t.utils.elapsedTime(g.created_at,null===g||void 0===g?void 0:g.terminated_at):"-",delay:1e3,render:e=>(0,c.jsx)(r.A,{values:[{label:m("session.ElapsedTime")},{label:e}]})})]})}},5415:(e,n,a)=>{a.d(n,{A:()=>y});var l,i=a(72338),s=a(68260),r=a(66596),t=a(25913),o=a(46976),d=a.n(o),u=(a(55093),a(63821)),c=a(79569);const m={RESTARTING:"blue",PREPARING:"blue",PREPARED:"blue",CREATING:"blue",PULLING:"blue",RUNNING:"green",PENDING:"green",SCHEDULED:"green",ERROR:"red"},g=e=>["RESTARTING","TERMINATING","PENDING","PREPARING","CREATING","PULLING"].includes((null===e||void 0===e?void 0:e.status)||""),p={"no-available-instances":"red","failed-to-start":"red","creation-failed":"red"},y=e=>{let{sessionFrgmt:n}=e;const o=(0,u.useFragment)(void 0!==l?l:l=a(53460),n),{token:y}=r.A.useToken();return o?d().isEmpty(o.status_info)?(0,c.jsx)(t.A,{color:o.status?d().get(m,o.status):void 0,icon:g(o)?(0,c.jsx)(s.A,{spin:!0}):void 0,children:o.status||" "}):(0,c.jsxs)(i.A,{children:[(0,c.jsx)(t.A,{style:{margin:0,zIndex:1},color:o.status?d().get(m,o.status):void 0,children:o.status}),(0,c.jsx)(t.A,{style:{margin:0,marginLeft:-1,borderStyle:"dashed",color:o.status_info&&d().get(p,o.status_info)?void 0:y.colorTextSecondary},color:o.status_info?d().get(p,o.status_info):void 0,children:o.status_info})]}):null}},89953:(e,n,a)=>{a.d(n,{A:()=>u});var l,i=a(25913),s=a(46976),r=a.n(s),t=(a(55093),a(63821)),o=a(79569);const d={INTERACTIVE:"green",BATCH:"darkgreen",INFERENCE:"blue"},u=e=>{let{sessionFrgmt:n}=e;const s=(0,t.useFragment)(void 0!==l?l:l=a(15934),n);return(0,o.jsx)(i.A,{color:r().get(d,r().toUpper(s.type||"")),children:r().toUpper(s.type||"")})}},50029:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l=function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ContainerLogModalFragment",selections:[e,{kind:"RequiredField",field:n,action:"NONE",path:"row_id"},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[e,n,{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_idx",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_role",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"ComputeSessionNode",abstractKey:null}}();l.hash="59dda81185d3d874cd635adcae2ae9d4";const i=l},33589:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EditableSessionNameFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"priority",storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"c6b003f47f74148456a1d12e7ed8fba1"},i=l},93178:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"ModifyComputeSessionPayload",kind:"LinkedField",name:"modify_compute_session",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"item",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EditableSessionNameMutation",selections:n,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EditableSessionNameMutation",selections:n},params:{cacheID:"bea4b6405958ab3b9796129b5807d0fa",id:null,metadata:{},name:"EditableSessionNameMutation",operationKind:"mutation",text:"mutation EditableSessionNameMutation(\n  $input: ModifyComputeSessionInput!\n) {\n  modify_compute_session(input: $input) {\n    item {\n      id\n      name\n    }\n  }\n}\n"}}}();l.hash="92003994eaa19ceec71d4fe2efb299cd";const i=l},79825:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionActionButtonsFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},action:"NONE",path:"row_id"},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commit_status",storageKey:null},{args:null,kind:"FragmentSpread",name:"TerminateSessionModalFragment"},{args:null,kind:"FragmentSpread",name:"ContainerLogModalFragment"}],type:"ComputeSessionNode",abstractKey:null,hash:"70c38dda1f1e788529d6bfd96bbef9f5"},i=l},93880:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionReservationFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"73f2fc395c80c1bf672ef9d0fea66787"},i=l},53460:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionStatusTagFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"28d44a009b8d8ecc51f60af3fc9ef8c8"},i=l},15934:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionTypeTagFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"6d4ab2b738125ee81d47483324695349"},i=l},5136:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l={argumentDefinitions:[],kind:"Fragment",metadata:{plural:!0},name:"TerminateSessionModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},action:"NONE",path:"scaling_group"},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"agent_id",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"0987c567ddd892540d949ccabd005e2b"},i=l},34185:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"},{defaultValue:null,kind:"LocalArgument",name:"project_id"}],n=[{alias:null,args:[{kind:"Variable",name:"id",variableName:"id"},{kind:"Variable",name:"project_id",variableName:"project_id"}],concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"TerminateSessionModalRefetchQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"TerminateSessionModalRefetchQuery",selections:n},params:{cacheID:"42872ac8084736aaf26675f9531456db",id:null,metadata:{},name:"TerminateSessionModalRefetchQuery",operationKind:"query",text:"query TerminateSessionModalRefetchQuery(\n  $id: GlobalIDField!\n  $project_id: UUID!\n) {\n  compute_session_node(id: $id, project_id: $project_id) {\n    id\n    status\n  }\n}\n"}}}();l.hash="6c928af0802a6732e5237c3f6c46db99";const i=l},59737:(e,n,a)=>{a.a(e,(async(e,l)=>{try{a.d(n,{A:()=>N});var i,s,r=a(32715),t=a(72375),o=a(7971),d=a(81530),u=a(80424),c=a(26480),m=a(63482),g=a(61207),p=a(5415),y=a(89953),h=a(72338),v=a(90184),k=a(66596),f=a(28354),_=a(38398),F=a(91043),S=a(76082),x=a(12221),b=a(2556),A=a(25913),j=a(69265),K=a(33364),T=a(63821),w=a(79569),C=e([u]);u=(C.then?(await C)():C)[0];const N=e=>{var n;let{id:l,fetchKey:C="initial"}=e;const{t:N}=(0,K.Bd)(),{token:L}=k.A.useToken(),R=(0,d.hd)(),E=(0,o.Am)(),{md:I}=f.Ay.useBreakpoint(),{session_for_project_id:D}=(0,T.useLazyLoadQuery)(void 0!==i?i:i=a(66427),{uuid:l},{fetchPolicy:"network-only"}),{session:M,legacy_session:q}=(0,T.useLazyLoadQuery)(void 0!==s?s:s=a(4078),{id:(0,t.wc)("ComputeSessionNode",l),uuid:l,project_id:(null===D||void 0===D?void 0:D.group_id)||R.id},{fetchPolicy:"network-only",fetchKey:C}),U=(null===q||void 0===q?void 0:q.image)&&(null===q||void 0===q?void 0:q.architecture)&&q.image+"@"+q.architecture;return M?(0,w.jsxs)(h.A,{direction:"column",gap:"sm",align:"stretch",children:[(null===D||void 0===D?void 0:D.group_id)!==R.id&&(0,w.jsx)(_.A,{message:N("session.NotInProject"),type:"warning",showIcon:!0}),(0,w.jsxs)(h.A,{direction:"row",justify:"between",align:"start",style:{alignSelf:"stretch"},children:[(0,w.jsx)(c.A,{sessionFrgmt:M,component:j.A,level:3,style:{margin:0,flex:1},editable:!1}),(0,w.jsx)(F.Ay.Group,{size:"large",children:(0,w.jsx)(m.A,{sessionFrgmt:M})})]}),(0,w.jsxs)(S.A,{bordered:!0,column:I?2:1,children:[(0,w.jsx)(S.A.Item,{label:N("session.SessionId"),span:I?2:1,children:(0,w.jsx)(x.A.Text,{copyable:!0,style:{fontFamily:"monospace"},children:M.row_id})}),("admin"===E||"superadmin"===E)&&(0,w.jsx)(S.A.Item,{label:N("credential.UserID"),span:I?2:1,children:null===q||void 0===q?void 0:q.user_email}),(0,w.jsx)(S.A.Item,{label:N("session.Status"),contentStyle:{display:"flex",gap:L.marginSM},children:(0,w.jsx)(p.A,{sessionFrgmt:M})}),(0,w.jsx)(S.A.Item,{label:N("session.SessionType"),children:(0,w.jsx)(y.A,{sessionFrgmt:M})}),(0,w.jsx)(S.A.Item,{label:N("session.launcher.Environments"),children:U?(0,w.jsxs)(h.A,{gap:"sm",children:[(0,w.jsx)(v.A,{image:U}),(0,w.jsx)(h.A,{children:(0,w.jsx)(r.Ay,{image:U})})]}):"-"}),(0,w.jsx)(S.A.Item,{label:N("session.launcher.MountedFolders"),children:null===q||void 0===q||null===(n=q.mounts)||void 0===n?void 0:n.join(", ")}),(0,w.jsx)(S.A.Item,{label:N("session.launcher.ResourceAllocation"),children:(0,w.jsxs)(h.A,{gap:"sm",wrap:"wrap",children:[(0,w.jsx)(b.A,{title:N("session.ResourceGroup"),children:(0,w.jsx)(A.A,{children:M.scaling_group})}),(0,w.jsx)(u.ResourceNumbersOfSession,{resource:JSON.parse(M.requested_slots||"{}")})]})}),(0,w.jsx)(S.A.Item,{label:N("session.Agent"),children:M.agent_ids||"-"}),(0,w.jsx)(S.A.Item,{label:N("session.Reservation"),children:(0,w.jsx)(h.A,{gap:"xs",wrap:"wrap",children:(0,w.jsx)(g.A,{sessionFrgmt:M})})})]})]}):(0,w.jsx)(_.A,{showIcon:!0,message:N("session.SessionNotFound"),type:"error",description:l})};l()}catch(N){l(N)}}))},33835:(e,n,a)=>{a.a(e,(async(e,l)=>{try{a.d(n,{A:()=>y});var i=a(23441),s=a(59737),r=a(99159),t=a(80939),o=a(2556),d=a(91043),u=a(16954),c=a(55093),m=a(33364),g=a(79569),p=e([s]);s=(p.then?(await p)():p)[0];const y=e=>{let{sessionId:n,...a}=e;const{t:l}=(0,m.Bd)();(0,i.CX)();const[p,y]=(0,c.useTransition)(),[h,v]=(0,i.Tw)("first");return(0,g.jsx)(t.A,{title:l("session.SessionInfo"),width:800,...a,open:!!n,onClose:e=>{var n;null===(n=a.onClose)||void 0===n||n.call(a,e)},extra:(0,g.jsx)(o.A,{title:l("button.Refresh"),children:(0,g.jsx)(d.Ay,{loading:p,icon:(0,g.jsx)(r.A,{}),onClick:()=>{y((()=>{v()}))}})}),children:(0,g.jsx)(c.Suspense,{fallback:(0,g.jsx)(u.A,{}),children:n&&(0,g.jsx)(s.A,{id:n,fetchKey:h})})})};l()}catch(y){l(y)}}))},66427:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"uuid"}],n=[{kind:"Variable",name:"id",variableName:"uuid"}],a={alias:null,args:null,kind:"ScalarField",name:"group_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionDetailContentLegacyQuery",selections:[{alias:"session_for_project_id",args:n,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[a],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionDetailContentLegacyQuery",selections:[{alias:"session_for_project_id",args:n,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"1c0255a2836eb7e492954c7ab0212c7f",id:null,metadata:{},name:"SessionDetailContentLegacyQuery",operationKind:"query",text:"query SessionDetailContentLegacyQuery(\n  $uuid: UUID!\n) {\n  session_for_project_id: compute_session(id: $uuid) {\n    group_id\n    id\n  }\n}\n"}}}();l.hash="d6a0dfbccdec8393f1a058dab48a0757";const i=l},4078:(e,n,a)=>{a.r(n),a.d(n,{default:()=>i});const l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"id"},n={defaultValue:null,kind:"LocalArgument",name:"project_id"},a={defaultValue:null,kind:"LocalArgument",name:"uuid"},l=[{kind:"Variable",name:"id",variableName:"id"},{kind:"Variable",name:"project_id",variableName:"project_id"}],i={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"project_id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},m={alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image",plural:!1,selections:[i,r,c,{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null}],storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"vfolder_mounts",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"agent_ids",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"requested_slots",storageKey:null},f=[{kind:"Variable",name:"id",variableName:"uuid"}],_={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},F={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null};return{fragment:{argumentDefinitions:[e,n,a],kind:"Fragment",metadata:null,name:"SessionDetailContentQuery",selections:[{alias:"session",args:l,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[i,s,r,t,o,d,u,{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[i,m],storageKey:null}],storageKey:null}],storageKey:null},g,{kind:"RequiredField",field:p,action:"NONE",path:"session.created_at"},y,h,v,k,{args:null,kind:"FragmentSpread",name:"SessionStatusTagFragment"},{args:null,kind:"FragmentSpread",name:"SessionActionButtonsFragment"},{args:null,kind:"FragmentSpread",name:"SessionTypeTagFragment"},{args:null,kind:"FragmentSpread",name:"EditableSessionNameFragment"},{args:null,kind:"FragmentSpread",name:"SessionReservationFragment"},{args:null,kind:"FragmentSpread",name:"ContainerLogModalFragment"}],storageKey:null},{alias:"legacy_session",args:f,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[_,F,S,c],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,a,n],kind:"Operation",name:"SessionDetailContentQuery",selections:[{alias:"session",args:l,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[i,s,r,t,o,d,u,{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[i,m,{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"agent_id",storageKey:null},s,{alias:null,args:null,kind:"ScalarField",name:"cluster_idx",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_role",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},g,p,y,h,v,k,{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commit_status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"priority",storageKey:null}],storageKey:null},{alias:"legacy_session",args:f,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[_,F,S,c,i],storageKey:null}]},params:{cacheID:"baa240f530b7b96a3f423735a1c75c34",id:null,metadata:{},name:"SessionDetailContentQuery",operationKind:"query",text:"query SessionDetailContentQuery(\n  $id: GlobalIDField!\n  $uuid: UUID!\n  $project_id: UUID!\n) {\n  session: compute_session_node(id: $id, project_id: $project_id) {\n    id\n    row_id\n    name\n    project_id\n    user_id\n    resource_opts\n    status\n    kernel_nodes {\n      edges {\n        node {\n          id\n          image {\n            id\n            name\n            architecture\n            tag\n          }\n        }\n      }\n    }\n    vfolder_mounts\n    created_at\n    terminated_at\n    scaling_group\n    agent_ids\n    requested_slots\n    ...SessionStatusTagFragment\n    ...SessionActionButtonsFragment\n    ...SessionTypeTagFragment\n    ...EditableSessionNameFragment\n    ...SessionReservationFragment\n    ...ContainerLogModalFragment\n  }\n  legacy_session: compute_session(id: $uuid) {\n    image\n    mounts\n    user_email\n    architecture\n    id\n  }\n}\n\nfragment ContainerLogModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  status\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        id\n        row_id\n        container_id\n        cluster_idx\n        cluster_role\n      }\n    }\n  }\n}\n\nfragment EditableSessionNameFragment on ComputeSessionNode {\n  id\n  name\n  priority\n}\n\nfragment SessionActionButtonsFragment on ComputeSessionNode {\n  id\n  row_id\n  status\n  access_key\n  service_ports\n  commit_status\n  ...TerminateSessionModalFragment\n  ...ContainerLogModalFragment\n}\n\nfragment SessionReservationFragment on ComputeSessionNode {\n  id\n  created_at\n  terminated_at\n}\n\nfragment SessionStatusTagFragment on ComputeSessionNode {\n  id\n  name\n  status\n  status_info\n}\n\nfragment SessionTypeTagFragment on ComputeSessionNode {\n  type\n}\n\nfragment TerminateSessionModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  scaling_group\n  kernel_nodes {\n    edges {\n      node {\n        container_id\n        agent_id\n        id\n      }\n    }\n  }\n}\n"}}}();l.hash="90f5988e556db928e962ee53e579f224";const i=l},17898:(e,n,a)=>{a.d(n,{RM:()=>t,WN:()=>r});var l=a(46976),i=a.n(l);function s(e){return null===e||void 0===e?"":"number"===typeof e||"boolean"===typeof e?String(e):`"${(e=i().isString(e)?e:JSON.stringify(e)).replace(/"/g,'""')}"`}const r=(e,n)=>{const a=URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.download=n,l.click(),URL.revokeObjectURL(a)},t=(e,n,a)=>{const l=((e,n)=>{const a=i().map(e,(e=>i().omit(e,"__fragments","__fragmentOwner","__id"))),l=i().keys(a[0]),r=i().map(a,(e=>i().map(e,((e,a)=>{var l;return null!==n&&void 0!==n&&n[a]&&(null===(l=n[a])||void 0===l?void 0:l.call(n,e))||e})))).map((e=>e.map(s).join(","))).join("\n");return[l.map(s).join(","),r].join("\n")})(e,a),t=new Blob([l],{type:"text/csv"});r(t,`${n}.csv`)}},57613:(e,n,a)=>{a.d(n,{b:()=>r});var l=a(33364);const i={"Cannot read property 'map' of null":"error.APINotSupported","TypeError: NetworkError when attempting to fetch resource.":"error.NetworkConnectionFailed","Login failed. Check login information.":"error.LoginFailed","User credential mismatch.":"error.LoginFailed","Authentication failed. Check information and manager status.":"error.AuthenticationFailed","Too many failed login attempts":"error.TooManyLoginFailures","server responded failure: 400 Bad Request - The virtual folder already exists with the same name.":"error.VirtualFolderAlreadyExist","400 Bad Request - The virtual folder already exists with the same name.":"error.VirtualFolderAlreadyExist","server responded failure: 400 Bad Request - One of your accessible vfolders already has the name you requested.":"error.VirtualFolderAlreadyExist","server responded failure: 400 Bad Request - You cannot create more vfolders.":"error.MaximumVfolderCreation","server responded failure: 400 Bad Request - Missing or invalid API parameters. (You cannot create more vfolders.)":"error.MaximumVfolderCreation","server responded failure: 400 Bad Request - Cannot change the options of a vfolder that is not owned by myself.":"error.CannotChangeVirtualFolderOption","server responded failure: 403 Forbidden - Cannot share private dot-prefixed vfolders.":"error.CannotSharePrivateAutomountFolder","server responded failure: 404 Not Found - No such vfolder invitation.":"error.FolderSharingNotAvailableToUser","server responded failure: 404 Not Found - No such user.":"error.FolderSharingNotAvailableToUser","server responded failure: 412 Precondition Failed - You have reached your resource limit.":"error.ReachedResourceLimit","Cannot read property 'split' of undefined":"error.UserHasNoGroup"},s={"\\w*not found matched token with email\\w*":"error.InvalidSignupToken","\\w*Access key not found\\w*":"error.LoginInformationMismatch","\\w*401 Unauthorized - Credential/signature mismatch\\w*":"error.LoginInformationMismatch",'integrity error: duplicate key value violates unique constraint "pk_resource_presets"[\\n]DETAIL:  Key \\(name\\)=\\([\\w]+\\) already exists.[\\n]':"error.ResourcePolicyAlreadyExist",'integrity error: duplicate key value violates unique constraint "pk_scaling_groups"[\\n]DETAIL:  Key \\(name\\)=\\([\\w]+\\) already exists.[\\n]':"error.ScalingGroupAlreadyExist",'integrity error: duplicate key value violates unique constraint "uq_users_username"[\\n]DETAIL:  Key \\(username\\)=\\([\\w]+\\) already exists.[\\n]':"error.UserNameAlreadyExist","server responded failure: 400 Bad Request - Missing or invalid API parameters. (Your resource quota is exceeded. (cpu=24 mem=512g cuda.shares=80))":"error.ResourceLimitExceed",'\\w*Key \\(name\\)=\\(.+\\) is still referenced from table "keypairs"\\.\\w*':"error.ResourcePolicyStillReferenced","Your resource request is smaller than the minimum required by the image. (\\w*)":"error.SmallerResourceThenImageRequires"},r=()=>{const{t:e}=(0,l.Bd)();return{relieve:n=>{if("undefined"===typeof n)return void 0===globalThis.backendaiclient||null===globalThis.backendaiclient?"_DISCONNECTED":"Problem occurred.";if(!0===globalThis.backendaiwebui.debug)return n;if({}.hasOwnProperty.call(i,n))return e(i[n]);for(const a of Object.keys(s))if(RegExp(a).test(n))return e(s[a]);return n}}}}}]);
//# sourceMappingURL=3835.b4fc93c2.chunk.js.map