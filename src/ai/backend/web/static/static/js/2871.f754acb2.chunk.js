"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[2871],{35847:(e,n,l)=>{l.d(n,{A:()=>m});var i,t=l(51593),a=l(65666),r=l(50868),s=l(33789),o=l(60822),d=(l(43373),l(56762)),u=l(88522),c=l(73689);const m=e=>{let{endpointFrgmt:n}=e;const{t:m}=(0,d.Bd)(),{token:g}=r.A.useToken(),p=(0,t.CX)(),y=(0,u.useFragment)(void 0!==i?i:i=l(25608),n);return p.supports("model-serving-endpoint-user-info")?(null===y||void 0===y?void 0:y.created_user_email)===(null===y||void 0===y?void 0:y.session_owner_email)?(null===y||void 0===y?void 0:y.session_owner_email)||"":(0,c.jsxs)(c.Fragment,{children:[(null===y||void 0===y?void 0:y.session_owner_email)||"",(0,c.jsx)(s.A,{title:m("modelService.ServiceDelegatedFrom",{createdUser:(null===y||void 0===y?void 0:y.created_user_email)||"",sessionOwner:(null===y||void 0===y?void 0:y.session_owner_email)||""}),children:(0,c.jsx)(o.Ay,{size:"small",type:"text",icon:(0,c.jsx)(a.A,{}),style:{color:g.colorTextSecondary}})})]}):p.email||""}},66048:(e,n,l)=>{l.d(n,{A:()=>s});var i,t=l(15934),a=(l(43373),l(88522)),r=l(73689);const s=e=>{var n;let{endpointFrgmt:s}=e;const o=(0,a.useFragment)(void 0!==i?i:i=l(84865),s);let d="default";switch(null===o||void 0===o||null===(n=o.status)||void 0===n?void 0:n.toUpperCase()){case"RUNNING":case"HEALTHY":d="success"}return(0,r.jsx)(t.A,{color:d,children:null===o||void 0===o?void 0:o.status})}},30957:(e,n,l)=>{l.d(n,{A:()=>p});var i=l(94126),t=l(1499),a=l(50868),r=l(23702),s=l(67378),o=l(9833),d=l(89608),u=l.n(d),c=l(43373),m=l(56762),g=l(73689);const p=e=>{let{open:n,onRequestClose:l,columns:d,displayedColumnKeys:p,...y}=e;const v=(0,c.useRef)(null),{t:_}=(0,m.Bd)(),{token:S}=a.A.useToken(),k=d.map((e=>{return"string"===typeof e.title?{label:e.title,value:u().toString(e.key)}:"object"===typeof e.title&&"props"in e.title?{label:(n=e.title,c.Children.map(n.props.children,(e=>{if("string"===typeof e)return e}))),value:u().toString(e.key)}:{label:void 0,value:u().toString(e.key)};var n}));return(0,g.jsx)(i.A,{title:_("table.SettingTable"),open:n,destroyOnClose:!0,centered:!0,onOk:()=>{var e;null===(e=v.current)||void 0===e||e.validateFields().then((e=>{l(e)})).catch((()=>{}))},onCancel:()=>{l()},...y,children:(0,g.jsxs)(r.A,{ref:v,preserve:!1,initialValues:{selectedColumnKeys:p||k.map((e=>e.value))},layout:"vertical",children:[(0,g.jsx)(r.A.Item,{name:"searchInput",label:_("table.SelectColumnToDisplay"),style:{marginBottom:0},children:(0,g.jsx)(s.A,{prefix:(0,g.jsx)(t.A,{}),style:{marginBottom:S.marginSM},placeholder:_("table.SearchTableColumn")})}),(0,g.jsx)(r.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.searchInput!==n.searchInput,children:e=>{let{getFieldValue:n}=e;const l=n("searchInput")?u().toLower(n("searchInput")):void 0,i=k.map((e=>u().toLower(u().toString(e.label)).includes(l||"")?e:{...e,style:{display:"none"}}));return(0,g.jsx)(r.A.Item,{name:"selectedColumnKeys",style:{height:220,overflowY:"auto"},children:(0,g.jsx)(o.A.Group,{options:i,style:{flexDirection:"column"}})})}})]})})}},25608:(e,n,l)=>{l.r(n),l.d(n,{default:()=>t});const i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointOwnerInfoFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_owner_email",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"fb21a441c8873205b5092ae1a5a7157e"},t=i},84865:(e,n,l)=>{l.r(n),l.d(n,{default:()=>t});const i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointStatusTagFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"3b31efa50b55edddcb210b59003dc479"},t=i},92871:(e,n,l)=>{l.r(n),l.d(n,{default:()=>z,isDestroyingStatus:()=>V});var i,t=l(35847),a=l(66048),r=l(89130),s=l(30957),o=l(58879),d=l(51593),u=l(11899),c=l(60881),m=l(15634),g=l(81850),p=l(64703),y=l(66231),v=l(67425),_=l(40567),S=l(44954),k=l(31409),f=l(55429),h=l(44733),x=l(50868),A=l(85690),F=l(60822),b=l(2293),j=l(77731),K=l(12731),T=l.n(K),w=l(89608),C=l.n(w),E=l(43373),I=l(56762),D=l(88522),L=l(97734),O=l(73689);const V=(e,n)=>(null!==e&&void 0!==e?e:0)<0||C().includes(["DESTROYED","DESTROYING"],null!==n&&void 0!==n?n:""),z=e=>{let{children:n}=e;const{t:K}=(0,I.Bd)(),{message:w,modal:z}=h.A.useApp(),R=(0,d.CX)(),N=(0,d.f0)(),{token:P}=x.A.useToken(),$=(0,m.hd)(),[B,U]=(0,E.useState)(!1),[q,H]=(0,E.useState)("created&destroying"),Q=(0,E.useDeferredValue)(q),[Y,X]=(0,E.useState)({current:1,pageSize:10}),G=(0,E.useDeferredValue)(Y),M=q!==Q||Y!==G,W="created&destroying"===Q?'lifecycle_stage == "created" | lifecycle_stage == "destroying"':`lifecycle_stage == "${Q}"`,[J,Z]=(0,E.useTransition)(),[ee,ne]=(0,d.Tw)("initial-fetch"),[le,ie]=(0,E.useState)(),[te]=(0,u.U6)(),ae=[{title:K("modelService.EndpointName"),dataIndex:"endpoint_id",key:"endpointName",fixed:"left",render:(e,n)=>(0,O.jsx)(L.N_,{to:"/serving/"+e,children:n.name})},{title:K("modelService.EndpointId"),dataIndex:"endpoint_id",key:"endpoint_id",width:310,render:e=>(0,O.jsx)(A.A.Text,{code:!0,children:e})},{title:K("modelService.ServiceEndpoint"),dataIndex:"endpoint_id",key:"url",render:(e,n)=>n.url?(0,O.jsx)(A.A.Link,{copyable:!0,href:n.url,target:"_blank",children:n.url}):"-"},{title:K("modelService.Controls"),dataIndex:"controls",key:"controls",render:(e,n)=>(0,O.jsxs)(r.A,{direction:"row",align:"stretch",children:[(0,O.jsx)(F.Ay,{type:"text",icon:(0,O.jsx)(g.A,{}),style:V(null===n||void 0===n?void 0:n.desired_session_count,null===n||void 0===n?void 0:n.status)||n.created_user_email&&n.created_user_email!==te.email?{color:P.colorTextDisabled}:{color:P.colorInfo},disabled:V(null===n||void 0===n?void 0:n.desired_session_count,null===n||void 0===n?void 0:n.status)||!!n.created_user_email&&n.created_user_email!==te.email,onClick:()=>{N("/service/update/"+n.endpoint_id)}}),(0,O.jsx)(F.Ay,{type:"text",icon:(0,O.jsx)(p.A,{style:V(null===n||void 0===n?void 0:n.desired_session_count,null===n||void 0===n?void 0:n.status)?void 0:{color:P.colorError}}),loading:ue.isPending&&le===n.endpoint_id,disabled:V(null===n||void 0===n?void 0:n.desired_session_count,null===n||void 0===n?void 0:n.status),onClick:()=>{z.confirm({title:K("dialog.ask.DoYouWantToDeleteSomething",{name:n.name}),content:K("dialog.warning.CannotBeUndone"),okText:K("button.Delete"),okButtonProps:{danger:!0,type:"primary"},onOk:()=>{ie(n.endpoint_id),n.endpoint_id&&ue.mutate(n.endpoint_id,{onSuccess:e=>{Z((()=>{ne()})),e.success?w.success(K("modelService.ServiceTerminated",{name:null===n||void 0===n?void 0:n.name})):w.error(K("modelService.FailedToTerminateService"))},onError:e=>{w.error(K("modelService.FailedToTerminateService"))}})}})}})]})},{title:K("modelService.Status"),key:"status",render:(e,n)=>(0,O.jsx)(a.A,{endpointFrgmt:n})},...R.is_admin?[{title:K("modelService.Owner"),dataIndex:"created_user_email",key:"session_owner",render:(e,n)=>(0,O.jsx)(t.A,{endpointFrgmt:n})}]:[],{title:K("modelService.CreatedAt"),dataIndex:"created_at",key:"createdAt",render:e=>T()(e).format("ll LT"),defaultSortOrder:"descend",sortDirections:["descend","ascend","descend"],sorter:(e,n)=>{const l=T()(e.created_at),i=T()(n.created_at);return l.diff(i)}},{title:K("modelService.DesiredSessionCount"),dataIndex:"desired_session_count",key:"desiredSessionCount",render:e=>e<0?"-":e},{title:(0,O.jsxs)(r.A,{direction:"column",align:"start",children:[K("modelService.RoutingsCount"),(0,O.jsx)("br",{}),(0,O.jsxs)(A.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",K("modelService.Active/Total"),")"]})]}),key:"routingCount",render:(e,n)=>{var l;return C().filter(n.routings,(e=>"HEALTHY"===(null===e||void 0===e?void 0:e.status))).length+" / "+(null===(l=n.routings)||void 0===l?void 0:l.length)}},{title:K("modelService.Public"),key:"public",render:(e,n)=>n.open_to_public?(0,O.jsx)(y.A,{style:{color:P.colorSuccess}}):(0,O.jsx)(v.A,{style:{color:P.colorTextSecondary}})}],[re,se]=(0,f.A)("backendaiwebui.EndpointListPage.displayedColumnKeys",{defaultValue:ae.map((e=>C().toString(e.key)))});(0,k.A)((()=>{(0,E.startTransition)((()=>{ne()}))}),7e3);const{endpoint_list:oe}=(0,D.useLazyLoadQuery)(void 0!==i?i:i=l(8132),{offset:(G.current-1)*G.pageSize,limit:G.pageSize,projectID:$.id,filter:R.supports("endpoint-lifecycle-stage-filter")?W:void 0},{fetchPolicy:"network-only",fetchKey:ee}),de=C().sortBy(null===oe||void 0===oe?void 0:oe.items,"name"),ue=(0,c.ET)({mutationFn:e=>(0,o.hu)({method:"DELETE",url:"/services/"+e,client:R})});return(0,O.jsxs)(r.A,{direction:"column",align:"stretch",children:[(0,O.jsxs)(r.A,{direction:"row",justify:"between",wrap:"wrap",gap:"xs",style:{padding:P.paddingContentVertical,paddingLeft:P.paddingContentHorizontalSM,paddingRight:P.paddingContentHorizontalSM},children:[(0,O.jsx)(r.A,{direction:"column",align:"start",children:R.supports("endpoint-lifecycle-stage-filter")&&(0,O.jsx)(b.Ay.Group,{value:q,onChange:e=>{var n;H(null===(n=e.target)||void 0===n?void 0:n.value),X({current:1,pageSize:Y.pageSize})},optionType:"button",buttonStyle:"solid",options:[{label:"Active",value:"created&destroying"},{label:"Destroyed",value:"destroyed"}]})}),(0,O.jsx)(r.A,{direction:"row",gap:"xs",wrap:"wrap",style:{flexShrink:1},children:(0,O.jsxs)(r.A,{gap:"xs",children:[(0,O.jsx)(F.Ay,{icon:(0,O.jsx)(_.A,{}),loading:J,onClick:()=>{Z((()=>ne()))}}),(0,O.jsx)(F.Ay,{type:"primary",onClick:()=>{N("/service/start")},children:K("modelService.StartService")})]})})]}),(0,O.jsx)(j.A,{loading:{spinning:M,indicator:(0,O.jsx)(S.A,{})},scroll:{x:"max-content"},rowKey:"endpoint_id",dataSource:de||[],columns:ae.filter((e=>null===re||void 0===re?void 0:re.includes(C().toString(e.key)))),pagination:{pageSize:Y.pageSize,current:Y.current,pageSizeOptions:["10","20","50"],total:(null===oe||void 0===oe?void 0:oe.total_count)||0,showSizeChanger:!0,onChange(e,n){X({current:e,pageSize:n})},style:{marginRight:P.marginXS}}}),(0,O.jsx)(r.A,{justify:"end",style:{padding:P.paddingXXS},children:(0,O.jsx)(F.Ay,{type:"text",icon:(0,O.jsx)(g.A,{}),onClick:()=>{U(!0)}})}),(0,O.jsx)(s.A,{open:B,onRequestClose:e=>{(null===e||void 0===e?void 0:e.selectedColumnKeys)&&se(null===e||void 0===e?void 0:e.selectedColumnKeys),U(!B)},columns:ae,displayedColumnKeys:re||[]})]})}},8132:(e,n,l)=>{l.r(n),l.d(n,{default:()=>t});const i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"limit"},l={defaultValue:null,kind:"LocalArgument",name:"offset"},i={defaultValue:null,kind:"LocalArgument",name:"projectID"},t=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],a={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"model",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"domain",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"project",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"routing_id",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"endpoint",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"session",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"traffic_ratio",storageKey:null},x={alias:null,args:null,concreteType:"RuntimeVariantInfo",kind:"LinkedField",name:"runtime_variant",plural:!1,selections:[r,{alias:null,args:null,kind:"ScalarField",name:"human_readable_name",storageKey:null}],storageKey:null},A={alias:null,args:null,kind:"ScalarField",name:"created_user_email",storageKey:null},F={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[e,n,l,i],kind:"Fragment",metadata:null,name:"EndpointListPageQuery",selections:[{alias:null,args:t,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[a,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[r,s,o,d,u,c,m,g,p,y,v,{kind:"RequiredField",field:_,action:"NONE",path:"endpoint_list.items.desired_session_count"},{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[S,k,f,h,u],storageKey:null},x,A,{args:null,kind:"FragmentSpread",name:"EndpointOwnerInfoFragment"},{args:null,kind:"FragmentSpread",name:"EndpointStatusTagFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,n,i,e],kind:"Operation",name:"EndpointListPageQuery",selections:[{alias:null,args:t,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[a,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[r,s,o,d,u,c,m,g,p,y,v,_,{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[S,k,f,h,u,F],storageKey:null},x,A,F,{alias:null,args:null,kind:"ScalarField",name:"session_owner_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"44748285f349a9d059efd5b64975c446",id:null,metadata:{},name:"EndpointListPageQuery",operationKind:"query",text:'query EndpointListPageQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n  $filter: String\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: $filter) {\n    total_count\n    items {\n      name\n      endpoint_id\n      model\n      domain\n      status\n      project\n      resource_group\n      resource_slots\n      url\n      open_to_public\n      created_at @since(version: "23.09.0")\n      desired_session_count\n      routings {\n        routing_id\n        endpoint\n        session\n        traffic_ratio\n        status\n        id\n      }\n      runtime_variant @since(version: "24.03.5") {\n        name\n        human_readable_name\n      }\n      created_user_email @since(version: "23.09.8")\n      ...EndpointOwnerInfoFragment\n      ...EndpointStatusTagFragment\n      id\n    }\n  }\n}\n\nfragment EndpointOwnerInfoFragment on Endpoint {\n  id\n  created_user_email @since(version: "23.09.8")\n  session_owner_email @since(version: "23.09.8")\n}\n\nfragment EndpointStatusTagFragment on Endpoint {\n  id\n  status\n}\n'}}}();i.hash="114c24611862a1a2577a867b9bc71359";const t=i}}]);
//# sourceMappingURL=2871.f754acb2.chunk.js.map