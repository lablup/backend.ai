"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[500],{31500:(e,n,t)=>{t.r(n),t.d(n,{default:()=>j});var r,a=t(83468),o=t(25339),i=t(91412),l=t(29871),s=t(97041),c=t(5336),d=t(12620),u=t(50840),m=t(24717),p=t(24128),g=t(65080),v=t(36209),h=t(6932),A=t(45901),y=t.n(A),f=t(76998),k=t(77678),x=t(3606),b=t(23446);const j=e=>{let{...n}=e;const{t:A}=(0,k.Bd)(),j=(0,a.CX)(),M=f.useRef(null),w=d.A.useApp(),{token:P}=u.A.useToken(),{parsedValue:{open:I,image:N,servicePorts:C},dispatchEvent:S}=(0,i.useWebComponentInfo)(),[V,F]=(0,x.useMutation)(void 0!==r?r:r=t(23258));return(0,b.jsxs)(o.A,{destroyOnClose:!0,open:I,onOk:()=>{var e;null===(e=M.current)||void 0===e||e.validateFields().then((()=>{var e;const n=null===(e=M.current)||void 0===e?void 0:e.getFieldValue("apps").map((e=>"".concat(e.app,":").concat(e.protocol,":").concat(e.port))).join(","),t=y().map(N.labels,((e,t)=>t.includes("service-ports")?{key:t,value:n}:{key:t,value:(null===e||void 0===e?void 0:e.toString())||""})),r=()=>V({variables:{target:"".concat(N.registry,"/").concat(N.name,":").concat(N.tag),architecture:N.architecture,props:{labels:t,resource_limits:j.isManagerVersionCompatibleWith("24.03.4.*")?void 0:null}},onCompleted:(e,n)=>{n?m.Ay.error(A("dialog.ErrorOccurred")):(m.Ay.success(A("environment.DescImagePortsModified")),S("ok",null))},onError:e=>{m.Ay.error(A("dialog.ErrorOccurred"))}});N.installed?w.modal.confirm({title:"Image reinstallation required",content:(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(k.x6,{i18nKey:"environment.ModifyImageResourceLimitReinstallRequired"})}),onOk:r,getContainer:()=>document.body,closable:!0}):r()})).catch((e=>{}))},onCancel:()=>S("cancel",null),confirmLoading:F,title:A("environment.ManageApps"),...n,children:[(0,b.jsxs)(l.A,{direction:"row",style:{width:"100%",marginBottom:P.marginXS},children:[(0,b.jsx)(p.A.Text,{strong:!0,style:{width:"32%"},children:A("environment.AppName")}),(0,b.jsx)(p.A.Text,{strong:!0,style:{width:"32%"},children:A("environment.Protocol")}),(0,b.jsx)(p.A.Text,{strong:!0,style:{width:"32%"},children:A("environment.Port")}),(0,b.jsx)(l.A,{})]}),(0,b.jsx)(g.A,{ref:M,layout:"vertical",autoComplete:"off",initialValues:{apps:C},requiredMark:!1,children:(0,b.jsx)(l.A,{direction:"column",children:(0,b.jsx)(g.A.List,{name:"apps",children:(e,n)=>{let{add:t,remove:r}=n;return(0,b.jsxs)(l.A,{direction:"column",style:{width:"100%"},children:[y().map(e,((e,n)=>(0,b.jsx)(g.A.Item,{children:(0,b.jsxs)(l.A,{direction:"row",gap:"xs",children:[(0,b.jsx)(g.A.Item,{...e,name:[e.name,"app"],noStyle:!0,rules:[{required:!0,message:A("environment.AppNameMustNotBeEmpty")}],children:(0,b.jsx)(v.A,{placeholder:A("environment.AppName")})}),(0,b.jsx)(g.A.Item,{...e,name:[e.name,"protocol"],noStyle:!0,rules:[{pattern:/^(http|tcp|pty|preopen)$/,required:!0,message:A("environment.ProtocolMustBeOneOfSupported")}],children:(0,b.jsx)(v.A,{placeholder:A("environment.Protocol")})}),(0,b.jsx)(g.A.Item,{...e,name:[e.name,"port"],noStyle:!0,rules:[{validator:(e,n)=>{const t=y().isUndefined(n)||""===n?NaN:y().toNumber(n);return y().isNaN(t)||t<0||t>=65535?Promise.reject(A("environment.PortMustBeInRange")):[2e3,2001,2002,2003,2200,7681].includes(Number(t))?Promise.reject(A("environment.PortReservedForInternalUse")):Promise.resolve()}},{validator:(e,t)=>{var r;const a=null===(r=M.current)||void 0===r?void 0:r.getFieldValue("apps");return y().isString(t)&&t.length>0&&a.some(((e,r)=>r!==n&&(null===e||void 0===e?void 0:e.port)===t))?Promise.reject(A("environment.PortMustBeUnique")):Promise.resolve()}}],children:(0,b.jsx)(v.A,{placeholder:A("environment.Port")})}),(0,b.jsx)(h.Ay,{type:"text",danger:!0,onClick:()=>r(e.name),style:0===n?{width:"10%",marginTop:8}:{width:"10%"},icon:(0,b.jsx)(s.A,{})})]},e.key)}))),(0,b.jsx)(h.Ay,{type:"dashed",onClick:()=>t(),block:!0,icon:(0,b.jsx)(c.A,{}),children:A("button.Add")})]})}})})})]})}},23258:(e,n,t)=>{t.r(n),t.d(n,{default:()=>a});const r=function(){var e={defaultValue:null,kind:"LocalArgument",name:"architecture"},n={defaultValue:null,kind:"LocalArgument",name:"props"},t={defaultValue:null,kind:"LocalArgument",name:"target"},r=[{alias:null,args:[{kind:"Variable",name:"architecture",variableName:"architecture"},{kind:"Variable",name:"props",variableName:"props"},{kind:"Variable",name:"target",variableName:"target"}],concreteType:"ModifyImage",kind:"LinkedField",name:"modify_image",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n,t],kind:"Fragment",metadata:null,name:"ManageAppsModalMutation",selections:r,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[t,e,n],kind:"Operation",name:"ManageAppsModalMutation",selections:r},params:{cacheID:"b7a57119037085ec9f08346991633e0a",id:null,metadata:{},name:"ManageAppsModalMutation",operationKind:"mutation",text:"mutation ManageAppsModalMutation(\n  $target: String!\n  $architecture: String\n  $props: ModifyImageInput!\n) {\n  modify_image(target: $target, architecture: $architecture, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();r.hash="bb280196745e96f5c488d1d785a5b012";const a=r},97041:(e,n,t)=>{t.d(n,{A:()=>s});var r=t(58168),a=t(76998);const o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};var i=t(76228),l=function(e,n){return a.createElement(i.A,(0,r.A)({},e,{ref:n,icon:o}))};const s=a.forwardRef(l)}}]);
//# sourceMappingURL=500.65ddb0eb.chunk.js.map