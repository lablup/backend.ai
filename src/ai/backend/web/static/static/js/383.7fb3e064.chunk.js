"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[383,502],{61502:function(e,n,i){i.r(n),i.d(n,{default:function(){return J},useShadowRoot:function(){return Q},useWebComponentInfo:function(){return G}});var r=i(29439),t=i(74165),o=i(15861),l=i(24530),s=i(24717),a=i(61724);function u(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2?arguments[2]:void 0,r=(0,l.Qc)(e),t=(0,s.Vn)(r,{Field:{enter:function(e){var r;if(null!==e&&void 0!==e&&null!==(r=e.directives)&&void 0!==r&&r.find((function(e){var r,t,o,l,s=e.name.value,a=null===(r=e.arguments)||void 0===r?void 0:r[0].name.value,u=null===(t=e.arguments)||void 0===t||null===(o=t[0].value)||void 0===o?void 0:o.value,c=null===(l=e.arguments)||void 0===l?void 0:l[0];if("since"===s&&"version"===a){if(i(u))return!0}else if("deprecatedSince"===s&&"version"===a){var d="StringValue"===(null===c||void 0===c?void 0:c.value.kind)?null===c||void 0===c?void 0:c.value.value:n[null===c||void 0===c?void 0:c.value.name.value];if(!i(d))return!0}else if("skipOnClient"===s&&"if"===a){if("BooleanValue"===(null===c||void 0===c?void 0:c.value.kind)&&c.value.value)return!0;if("Variable"===(null===c||void 0===c?void 0:c.value.kind)&&n[c.value.name.value])return!0}return!1})))return null},leave:function(e){var n;if(e.selectionSet&&"SelectionSet"===e.selectionSet.kind&&0===(null===(n=e.selectionSet.selections)||void 0===n?void 0:n.length))return null}},Directive:{leave:function(e){var n=e.name.value;if(["since","deprecatedSince","skipOnClient"].includes(n))return null}}}),o={};return(0,s.Vn)(t,{Variable:function(e){o[e.name.value]=(o[e.name.value]||0)+1}}),t=(0,s.Vn)(t,{VariableDefinition:{enter:function(e){if(o[e.variable.name.value]<=1)return null}}}),(0,a.S)(t)}var c=i(41011);c.RelayFeatureFlags.ENABLE_RELAY_RESOLVERS=!0;var d=function(){var e=(0,o.Z)((0,t.Z)().mark((function e(n,i){var r,o,l,s,a,c;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==globalThis.backendaiclient){e.next=3;break}return e.next=3,new Promise((function(e){document.addEventListener("backend-ai-connected",(function n(){document.removeEventListener("backend-ai-connected",n),e(void 0)}))}));case 3:return l=u(n.text||"",i,(function(e){var n;return!(null!==(n=globalThis.backendaiclient)&&void 0!==n&&n.isManagerVersionCompatibleWith(e))})),s={query:l,variables:i},a=null===(r=globalThis.backendaiclient)||void 0===r?void 0:r.newSignedRequest("POST","/admin/gql",s),e.next=8,null===(o=globalThis.backendaiclient)||void 0===o?void 0:o._wrapWithPromise(a,!1,null,1e4,0).catch((function(e){}));case 8:if(e.t0=e.sent,e.t0){e.next=11;break}e.t0={};case 11:return c=e.t0,e.abrupt("return",c);case 13:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}();var m,v=new c.Environment({network:c.Network.create(d,void 0),store:new c.Store(new c.RecordSource)}),p=i(80382),h=i(27340),g=i(41239),f=i(47226),x=i(49883),y=i(66670),Z=i(99517),b=i.n(Z),j=(i(24989),i(79354)),k=i.n(j),P=i(79748),_=i.n(P),w=i(51714),F=i.n(w),S=i(63540),C=i.n(S),T=i(18272),E=i.n(T),V=i(9666),I=i.n(V),N=i(64447),M=i(13881),A=i(4519),R=i(81748),K=i(87112),O=i(16980),D=i(51843),z=i(12674),B=i(55144),q=i(73181),L=i(2556);b().extend(I()),b().extend(k()),b().extend(_()),b().extend(F()),b().extend(E()),b().extend(C());var U=A.createContext(null),W=A.createContext(null),Q=function(){return A.useContext(W)},G=function(){return A.useContext(U)},$=new K.QueryClient({defaultOptions:{queries:{suspense:!0,refetchOnWindowFocus:!1,retry:!1}}});N.ZP.use(R.Db).use(M.Z).init({backend:{loadPath:"/resources/i18n/{{lng}}.json"},lng:(null===globalThis||void 0===globalThis||null===(m=globalThis.backendaioptions)||void 0===m?void 0:m.get("current_language"))||"en",fallbackLng:"en",interpolation:{escapeValue:!1},react:{transSupportBasicHtmlNodes:!0,transKeepBasicHtmlNodesFor:["br","strong","span","code","p"]}});var H=function(){var e=(0,z.s0)();return(0,A.useLayoutEffect)((function(){var n=function(n){var i=n.detail;e(i,{replace:!0})};return document.addEventListener("react-navigate",n),function(){document.removeEventListener("react-navigate",n)}}),[e]),null},J=function(e){var n=e.children,i=e.value,t=e.styles,o=e.shadowRoot,l=e.dispatchEvent,s=(0,A.useMemo)((function(){return(0,h.Df)()}),[]),a=function(){var e,n=(0,A.useState)(null===globalThis||void 0===globalThis||null===(e=globalThis.backendaioptions)||void 0===e?void 0:e.get("current_language")),i=(0,r.Z)(n,2),t=i[0],o=i[1],l=(0,R.$G)().i18n;return(0,A.useEffect)((function(){setTimeout((function(){return null===l||void 0===l?void 0:l.changeLanguage(t)}),0),b().locale(t)}),[]),(0,A.useEffect)((function(){var e=function(e){var n,i;o(null===e||void 0===e||null===(n=e.detail)||void 0===n?void 0:n.lang);var r=(null===e||void 0===e||null===(i=e.detail)||void 0===i?void 0:i.lang)||"en";null===l||void 0===l||l.changeLanguage(r),b().locale(r)};return window.addEventListener("langChanged",e),function(){return window.removeEventListener("langChanged",e)}}),[l]),[t]}(),u=(0,r.Z)(a,1)[0],c=(0,p.x)(),d=(0,A.useMemo)((function(){return{value:i,dispatchEvent:l,moveTo:function(e,n){l("moveTo",{path:e,params:n})}}}),[i,l]);return(0,L.jsx)(L.Fragment,{children:v&&(0,L.jsx)(O.RelayEnvironmentProvider,{environment:v,children:(0,L.jsxs)(A.StrictMode,{children:[(0,L.jsxs)("style",{children:[t,".anticon {\n  display: inline-block;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n/* fix: fixed column shadow display outside of a table wrapper */\n.ant-table-wrapper {\n  border-radius: 8px 8px 0 0;\n  overflow: hidden;\n}\n\n/* fix: the tooltip does not appear in the `<Form.Item tooltip={'something'}` when the popup container is a parent node of the trigger node. */\n.ant-form-item-label {\n  overflow: unset !important;\n}\n"]}),(0,L.jsx)(K.QueryClientProvider,{client:$,children:(0,L.jsx)(W.Provider,{value:o,children:(0,L.jsx)(U.Provider,{value:d,children:(0,L.jsx)(g.ZP,{getPopupContainer:function(e){return(null===e||void 0===e?void 0:e.parentNode)||o},locale:"ko"===u?y.Z:x.Z,theme:c,children:(0,L.jsx)(f.Z,{children:(0,L.jsx)(h.V9,{container:o,cache:s,children:(0,L.jsx)(A.Suspense,{fallback:"",children:(0,L.jsx)(D.VK,{children:(0,L.jsxs)(B.QueryParamProvider,{adapter:q.Q,options:{},children:[(0,L.jsx)(H,{}),n]})})})})})})})})})]})})})}},73340:function(e,n,i){i.r(n);var r=function(){var e=[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetSelectQuery",selections:e,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ResourcePresetSelectQuery",selections:e},params:{cacheID:"bd89430b9924d926a1b8e91191746b4f",id:null,metadata:{},name:"ResourcePresetSelectQuery",operationKind:"query",text:"query ResourcePresetSelectQuery {\n  resource_presets {\n    name\n    resource_slots\n    shared_memory\n  }\n}\n"}}}();r.hash="9841642e96d89476c2848bfb093ed9c5",n.default=r},750:function(e,n,i){i.r(n);var r={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"};n.default=r},25338:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"accessKey"}],n=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"accessKey"}],concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"concurrency_used",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairQuery",selections:n},params:{cacheID:"1f8fc324e9907111de581f5cd2dc3640",id:null,metadata:{},name:"hooksUsingRelay_KeyPairQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairQuery(\n  $accessKey: String!\n) {\n  keypair(access_key: $accessKey) {\n    id\n    resource_policy\n    concurrency_used\n  }\n}\n"}}}();r.hash="d8f5c91f0fc46a3366f57566ab688d81",n.default=r},94177:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n},params:{cacheID:"ad7039c1935637fe3f3841f0ea8bf347",id:null,metadata:{},name:"hooksUsingRelay_KeyPairResourcePolicyQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairResourcePolicyQuery(\n  $name: String!\n) {\n  keypair_resource_policy(name: $name) {\n    max_containers_per_session\n    max_concurrent_sessions\n  }\n}\n"}}}();r.hash="f3f7364c63aefe9b03111b584c48c103",n.default=r},10383:function(e,n,i){i.r(n),i.d(n,{default:function(){return cn}});var r,t,o,l,s=i(74165),a=i(15861),u=i(29439),c=i(1413),d=i(44925),m=i(83249),v=i(69080),p=i(44036),h=i(92171),g=i(53066),f=i(32048),x=i.n(f),y=i(4519),Z=i(2556),b=["status","extraButtonTitle","onClickExtraButton","extra","style"],j=function(e){var n=e.status,i=void 0===n?"default":n,r=e.extraButtonTitle,t=e.onClickExtraButton,o=e.extra,l=e.style,s=(0,d.Z)(e,b),a=p.Z.useToken().token,u=o||r&&(0,Z.jsx)(h.ZP,{type:"link",icon:"error"===i?(0,Z.jsx)(m.Z,{twoToneColor:a.colorError}):"warning"===i?(0,Z.jsx)(v.Z,{twoToneColor:a.colorWarning}):void 0,onClick:t,children:r})||void 0;return(0,Z.jsx)(g.Z,(0,c.Z)({style:x().extend(l,{borderColor:"error"===i?a.colorError:"warning"===i?a.colorWarning:"success"===i?a.colorSuccess:null===l||void 0===l?void 0:l.borderColor}),extra:u},s))},k=i(42620),P=i(66957),_=i(99517),w=i.n(_),F=["value","onChange","localFormat"],S=function(e){var n=e.value,i=e.onChange,r=e.localFormat,t=(0,d.Z)(e,F),o=(0,k.Z)({value:n,onChange:i}),l=(0,u.Z)(o,2)[1];return(0,Z.jsx)(P.Z,(0,c.Z)({value:n?w()(n):void 0,onChange:function(e){var n,i=r?null===e||void 0===e?void 0:e.format():null===e||void 0===e||null===(n=e.tz())||void 0===n?void 0:n.toISOString();l(i)}},t))},C=i(61502),T=i(99277),E=i(74860),V=i(20558),I=i(57054),N=i(38818),M=i(81748),A=["formItemProps"],R=["key","name"],K=function(e){var n=e.formItemProps,i=(0,d.Z)(e,A),r=(0,y.useRef)(null),t=(0,M.$G)().t;return(0,Z.jsx)(I.Z.List,(0,c.Z)((0,c.Z)({},i),{},{children:function(e,o){var l=o.add,s=o.remove;return(0,Z.jsxs)(T.Z,{direction:"column",gap:"xs",align:"stretch",children:[e.map((function(o,l){var a=o.key,u=o.name,m=(0,d.Z)(o,R);return(0,Z.jsxs)(T.Z,{direction:"row",align:"baseline",gap:"xs",children:[(0,Z.jsx)(I.Z.Item,(0,c.Z)((0,c.Z)((0,c.Z)({},m),{},{style:{marginBottom:0,flex:1},name:[u,"variable"],rules:[{required:!0,message:t("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:t("session.launcher.EnvironmentVariableNamePatternError")},function(e){var n=e.getFieldValue;return{validator:function(e,r){var o=x().map(n(i.name),(function(e){return null===e||void 0===e?void 0:e.variable}));return o.length>0&&x().filter(o,(function(e){return e===r})).length>1?Promise.reject(t("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}]},n),{},{children:(0,Z.jsx)(N.Z,{ref:l===e.length-1?r:null,placeholder:"Variable"})})),(0,Z.jsx)(I.Z.Item,(0,c.Z)((0,c.Z)({},m),{},{name:[u,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:"Enter value"}],children:(0,Z.jsx)(N.Z,{placeholder:"Value"})})),(0,Z.jsx)(E.Z,{onClick:function(){return s(u)}})]},a)})),(0,Z.jsx)(I.Z.Item,{noStyle:!0,children:(0,Z.jsx)(h.ZP,{type:"dashed",onClick:function(){l(),setTimeout((function(){r.current&&r.current.focus()}),0)},icon:(0,Z.jsx)(V.Z,{}),block:!0,children:"Add variable"})})]})}}))},O=i(15008),D=i(14001),z=i(36459),B=i(87760),q=i(19427),L=i(82548),U=["value"],W=function(e){var n=e.value,i=(0,d.Z)(e,U),r=parseInt(n),t=r>=1024&&r<=65535;return(0,Z.jsx)(L.Z,(0,c.Z)({color:t?void 0:"red"},i))},Q=function(e){var n=Object.assign({},((0,z.Z)(e),e)),i=(0,M.$G)().t,r=(0,B.Dj)();return(0,Z.jsx)(I.Z.Item,(0,c.Z)((0,c.Z)({label:i("session.launcher.PreOpenPortTitle"),name:"ports",tooltip:(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:i("session.launcher.PreOpenPortRangeGuide"),rules:[{max:r._config.maxCountForPreopenPorts,type:"array",message:i("session.launcher.PreOpenPortMaxCountLimit",{count:r._config.maxCountForPreopenPorts})},function(e){e.getFieldValue;return{validator:function(e,n){return x().every(n,(function(e){var n=parseInt(e);return n>=1024&&n<=65535}))?Promise.resolve():Promise.reject(new Error(i("session.launcher.PreOpenPortRange")))}}}]},n),{},{children:(0,Z.jsx)(q.Z,{mode:"tags",tagRender:function(e){return(0,Z.jsx)(W,{closable:e.closable,onClose:e.onClose,onMouseDown:function(e){e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})}))},G=i(4942),$=i(43255),H=i(1839),J=i(16980),X=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fetchPolicy:"store-and-network"},n=(0,B.Kr)("first"),o=(0,u.Z)(n,2),l=o[0],s=o[1],a=(0,B.Dj)(),d=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchPolicy:"store-and-network"},t=(0,B.Kr)("first"),o=(0,u.Z)(t,2),l=o[0],s=o[1];return[(0,J.useLazyLoadQuery)(void 0!==r?r:r=i(25338),{accessKey:e},(0,c.Z)((0,c.Z)({},n),{},{fetchKey:l+n.fetchKey})).keypair,{refresh:(0,y.useCallback)((function(){s()}),[s])}]}(null===a||void 0===a?void 0:a._config.accessKey),m=(0,u.Z)(d,1)[0];return[{keypairResourcePolicy:(0,J.useLazyLoadQuery)(void 0!==t?t:t=i(94177),{name:(null===m||void 0===m?void 0:m.resource_policy)||""},(0,c.Z)((0,c.Z)({},e),{},{fetchKey:l+e.fetchKey})).keypair_resource_policy||{},keypair:m||{}},{refresh:(0,y.useCallback)((function(){s()}),[s])}]},Y=i(50164),ee=i(67668),ne=i(66653),ie=i(28499),re=["dynamicSteps","units","disableAutoUnit","min","max"],te=function(e){var n=e.dynamicSteps,i=void 0===n?[1,2,4,8,16,32,64,128,256,512]:n,r=e.units,t=void 0===r?["m","g","t","p"]:r,o=e.disableAutoUnit,l=void 0!==o&&o,s=e.min,a=void 0===s?"0m":s,m=e.max,v=void 0===m?"300p":m,p=(0,d.Z)(e,re),h=(0,k.Z)(p,{defaultValue:"0g"}),g=(0,u.Z)(h,2),f=g[0],b=g[1],j=null===f||void 0===f?[null,null]:(0,$.n2)(f),P=(0,u.Z)(j,2),_=P[0],w=P[1],F=(0,ee.Z)(w),S=w||F||t[0],C=(0,$.n2)(a),T=(0,u.Z)(C,2),E=T[0],V=T[1],I=(0,$.n2)(v),N=(0,u.Z)(I,2),M=N[0],A=N[1],R=(0,y.useRef)(null);return(0,y.useEffect)((function(){if(R.current){var e=function(e){var n,i=null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value;/^\d+(g|m)$/.test(i)&&b(i)},n=R.current;return null===n||void 0===n||n.addEventListener("input",e),function(){null===n||void 0===n||n.removeEventListener("input",e)}}}),[R,_,w,b]),(0,Z.jsx)(ne.Z,(0,c.Z)((0,c.Z)({ref:R},p),{},{value:_,onChange:function(e){b(null===e||void 0===e?e:"".concat(e).concat(S))},max:A===S?M:(0,$.PZ)(v,S).number,min:V===S?E:(0,$.PZ)(a,S).number,addonAfter:(0,Z.jsx)(q.Z,{value:S,onChange:function(e){b("".concat(_).concat(e))},onDropdownVisibleChange:function(e){(e&&null===f||void 0===f)&&b("0".concat(S))},options:x().map(t,(function(e){return{value:e,label:(0,Z.jsx)(ie.Z.Text,{style:{fontFamily:"'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace"},children:e.toUpperCase()+"iB"})}})),suffixIcon:t.length>1?void 0:null,open:t.length>1&&void 0,style:{cursor:t.length>1?void 0:"default"}}),step:0,onStep:function(e,n){var r,o=x().isNull(_)||x().isUndefined(_)?0:_,s=x().sortedIndex(x().sortBy(i),o);r="up"===n.type?o===i[s]?s+1:s:s-1;var a=t.indexOf(S);if(!l&&r<0)if(0===a)b("0".concat(S));else{var u=i[i.length-1],c=t[a-1];b("".concat(u).concat(c))}else if(!l&&r>i.length-1)if(a===t.length-1)b("".concat(o+("up"===n.type?1:-1)).concat(A));else{var d=i[0],m=t[a+1];b("".concat(d).concat(m))}else if(r>=0&&r<i.length){var v=i[r];V===S&&v<E?v=E:A===S&&v>M&&(v=M),b("".concat(v).concat(S))}}}))},oe=i(31603),le=["min","max","warn","units","extraMarks"],se=function(e){var n=e.min,i=void 0===n?"0m":n,r=e.max,t=void 0===r?"32g":r,o=e.warn,l=e.units,s=void 0===l?["m","g"]:l,a=(e.extraMarks,(0,d.Z)(e,le)),m=(0,k.Z)(a,{defaultValue:"0g"}),v=(0,u.Z)(m,2),h=v[0],g=v[1],f=p.Z.useToken().token,b=(0,y.useMemo)((function(){return(0,$.PZ)(i,"g",2)}),[i]),j=(0,y.useMemo)((function(){return(0,$.PZ)(t,"g",2)}),[t]),P=(0,y.useMemo)((function(){return(0,$.PZ)(h||"0g","g",2)}),[h]);return(0,Z.jsxs)(T.Z,{direction:"row",gap:"md",children:[(0,Z.jsx)(T.Z,{direction:"column",align:"stretch",style:{flex:3},children:(0,Z.jsx)(T.Z,{direction:"column",align:"stretch",children:(0,Z.jsx)(oe.Z,{max:null===j||void 0===j?void 0:j.number,trackStyle:o&&{backgroundColor:(0,$.p)(o,h||"0b")<0?f.colorWarning:void 0}||void 0,railStyle:{},step:.05,value:null===P||void 0===P?void 0:P.number,tooltip:{formatter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<1?"".concat((1024*e).toFixed(2)," MiB"):"".concat(e.toFixed(2)," GiB")}},onChange:function(e){null!==b&&void 0!==b&&b.number&&b.number>e?g(i):g(e<1?"".concat(1024*e,"m"):"".concat(e,"g"))},marks:(0,c.Z)((0,c.Z)({},b&&x().isNumber(null===b||void 0===b?void 0:b.number)&&(0,G.Z)({},b.number,{style:{color:f.colorTextSecondary},label:b.number+(b.number?"g":"")})),(null===j||void 0===j?void 0:j.number)&&(0,G.Z)({},j.number,{style:{color:f.colorTextSecondary},label:j.number+"g"}))})})}),(0,Z.jsx)(T.Z,{style:{flex:2,minWidth:130},direction:"column",align:"stretch",children:(0,Z.jsx)(te,(0,c.Z)((0,c.Z)({},a),{},{min:i,max:t,units:s,value:h,onChange:function(e){g(e)},style:{minWidth:130}}))})]})},ae=["min","max","step","disabled","inputNumberProps","sliderProps"],ue=function(e){var n=e.min,i=e.max,r=e.step,t=e.disabled,o=e.inputNumberProps,l=e.sliderProps,s=(0,d.Z)(e,ae),a=(0,k.Z)(s),m=(0,u.Z)(a,2),v=m[0],p=m[1];return(0,y.useEffect)((function(){1===r&&v%1!==0&&p(Math.round(v))}),[r]),(0,Z.jsxs)(T.Z,{direction:"row",gap:"md",children:[(0,Z.jsx)(T.Z,{direction:"column",align:"stretch",style:{flex:3},children:(0,Z.jsx)(oe.Z,(0,c.Z)({max:i,min:n,step:r,disabled:t,value:v,onChange:p},l))}),(0,Z.jsx)(T.Z,{style:{flex:2,minWidth:130},align:"stretch",direction:"column",children:(0,Z.jsx)(ne.Z,(0,c.Z)({max:i,min:n,step:r,disabled:t,value:v,onChange:p},o))})]})},ce=i(61815),de=i(96732),me=i(61749),ve=i(73519),pe=function(e){var n=Object.assign({},((0,z.Z)(e),e)),r=(0,B.Kr)("first"),t=(0,u.Z)(r,2),l=t[0],s=t[1],a=(0,ve.Z)(s,{wait:3e3,trailing:!1,leading:!0}).run,d=(0,H.T6)(),m=(0,u.Z)(d,1)[0],v=(0,y.useTransition)(),p=(0,u.Z)(v,2),h=p[0],g=p[1],f=(0,J.useLazyLoadQuery)(void 0!==o?o:o=i(73340),{},{fetchKey:l,fetchPolicy:"first"===l?"store-and-network":"network-only"}).resource_presets;return(0,Z.jsx)(q.Z,(0,c.Z)((0,c.Z)({loading:h,options:[{value:"custom",label:(0,Z.jsxs)(T.Z,{gap:"xs",style:{display:"inline-flex"},children:[(0,Z.jsx)(me.Z,{})," Custom"]})},{label:"Preset",options:x().map(f,(function(e,n){var i=JSON.parse(null===e||void 0===e?void 0:e.resource_slots);return{value:null===e||void 0===e?void 0:e.name,label:(0,Z.jsxs)(T.Z,{direction:"row",justify:"between",gap:"xs",children:[null===e||void 0===e?void 0:e.name,(0,Z.jsx)(T.Z,{direction:"row",gap:"xxs",style:{color:"black",opacity:1===n?.5:1},children:x().map(x().omitBy(i,(function(e,n){return x().isEmpty(m[n])})),(function(e,n){return(0,Z.jsx)(de.ZP,{type:n,value:e,hideTooltip:!0},n)}))})]}),preset:e}}))}],showSearch:!0},n),{},{onDropdownVisibleChange:function(e){e&&(console.log(e),g((function(){a()})))}}))},he=i(83799),ge=i(35492),fe=i(2704),xe=i(22733),ye=function(e){return void 0===e||"Infinity"===e||"NaN"===e?void 0:x().toNumber(e)},Ze=function(e){var n,i,r,t,o,l,d,m,v,h,f,b,j,k,P,_,w,F,S,C,E=e.enableNumOfSessions,V=I.Z.useFormInstance(),N=(0,M.$G)().t,A=p.Z.useToken().token,R=(0,B.Dj)(),K=(0,H.T6)(),O=(0,u.Z)(K,1)[0],D=x().omit(O,["cpu","mem","shmem"]),z=X(),L=(0,u.Z)(z,1)[0],U=L.keypair,W=L.keypairResourcePolicy,Q=(0,B.qh)(),J=(0,y.useState)(V.getFieldValue("resourceGroup")),ee=(0,u.Z)(J,2),ne=ee[0],ie=ee[1],re=(0,y.useTransition)(),te=(0,u.Z)(re,2),oe=te[0],le=te[1],ae=I.Z.useWatch(["environments","image"],{form:V,preserve:!0}),me=x().filter(null===ae||void 0===ae?void 0:ae.resource_limits,(function(e){return!!e&&!x().includes(["cpu","mem","shmem"],e.key)})),ve=(0,Y.h)({queryKey:["check-resets",Q.name,ne],queryFn:function(){return ne?R.resourcePreset.check({group:Q.name,scaling_group:ne}):void 0},staleTime:0,suspense:!x().isEmpty(ne)}).data,Ze=(0,c.Z)((0,c.Z)((0,c.Z)((0,c.Z)({},null!==O&&void 0!==O&&O.cpu?{cpu:{min:x().max([x().toNumber((null===(n=x().find(null===ae||void 0===ae?void 0:ae.resource_limits,(function(e){return"cpu"===(null===e||void 0===e?void 0:e.key)})))||void 0===n?void 0:n.min)||"0")]),max:x().min([R._config.maxCPUCoresPerContainer,ye(null===ve||void 0===ve?void 0:ve.keypair_limits.cpu),ye(null===ve||void 0===ve?void 0:ve.group_limits.cpu),x().isEmpty(null===ve||void 0===ve||null===(i=ve.scaling_groups[ne])||void 0===i||null===(r=i.using)||void 0===r?void 0:r.cpu)||x().isEmpty(null===ve||void 0===ve||null===(t=ve.scaling_groups[ne])||void 0===t||null===(o=t.remaining)||void 0===o?void 0:o.cpu)?void 0:x().toNumber(null===ve||void 0===ve||null===(l=ve.scaling_groups[ne])||void 0===l?void 0:l.using.cpu)+x().toNumber(null===ve||void 0===ve||null===(d=ve.scaling_groups[ne])||void 0===d?void 0:d.remaining.cpu)]),remaining:null!==(m=x().min([null===ve||void 0===ve?void 0:ve.keypair_remaining.cpu,null===ve||void 0===ve?void 0:ve.group_remaining.cpu,null===ve||void 0===ve?void 0:ve.scaling_group_remaining.cpu]))&&void 0!==m?m:Number.MAX_SAFE_INTEGER}}:{}),null!==O&&void 0!==O&&O.mem?{mem:{min:x().max([null===(v=x().find(null===ae||void 0===ae?void 0:ae.resource_limits,(function(e){return"mem"===(null===e||void 0===e?void 0:e.key)})))||void 0===v?void 0:v.min])||"0g",max:x().min([R._config.maxMemoryPerContainer,ye(null===ve||void 0===ve?void 0:ve.keypair_limits.mem)&&(null===(h=(0,$.PZ)(ye(null===ve||void 0===ve?void 0:ve.keypair_limits.mem)+"","g"))||void 0===h?void 0:h.number),ye(null===ve||void 0===ve?void 0:ve.group_limits.mem)&&(null===(f=(0,$.PZ)(ye(null===ve||void 0===ve?void 0:ve.group_limits.mem)+"","g"))||void 0===f?void 0:f.number),x().isEmpty(null===ve||void 0===ve||null===(b=ve.scaling_groups[ne])||void 0===b||null===(j=b.using)||void 0===j?void 0:j.mem)||x().isEmpty(null===ve||void 0===ve||null===(k=ve.scaling_groups[ne])||void 0===k||null===(P=k.using)||void 0===P?void 0:P.mem)||null===(_=(0,$.PZ)(x().toNumber(null===ve||void 0===ve||null===(w=ve.scaling_groups[ne])||void 0===w?void 0:w.using.mem)+x().toNumber(null===ve||void 0===ve||null===(F=ve.scaling_groups[ne])||void 0===F?void 0:F.remaining.mem)+"b","g",2))||void 0===_?void 0:_.numberFixed])+"g",remaining:null!==(S=x().min([null===ve||void 0===ve?void 0:ve.keypair_remaining.mem,null===ve||void 0===ve?void 0:ve.group_remaining.mem,null===ve||void 0===ve?void 0:ve.scaling_group_remaining.mem]))&&void 0!==S?S:Number.MAX_SAFE_INTEGER},shmem:{min:x().max([null===(C=x().find(null===ae||void 0===ae?void 0:ae.resource_limits,(function(e){return"shmem"===(null===e||void 0===e?void 0:e.key)})))||void 0===C?void 0:C.min])||"64m"}}:{}),x().reduce(D,(function(e,n,i){var r,t,o,l,s,a,u,c,d={"cuda.device":"maxCUDADevicesPerContainer","cuda.shares":"maxCUDASharesPerContainer","rocm.device":"maxROCMDevicesPerContainer","tpu.device":"maxTPUDevicesPerContainer","ipu.device":"maxIPUDevicesPerContainer","atom.device":"maxATOMDevicesPerContainer","warboy.device":"maxWarboyDevicesPerContainer"}[i]||"cuda.device";return e[i]={min:parseInt(null===(r=x().filter(me,(function(e){return(null===e||void 0===e?void 0:e.key)===i}))[0])||void 0===r?void 0:r.min)||0,max:x().min([R._config[d]||8,x().isEmpty(null===ve||void 0===ve||null===(t=ve.scaling_groups[ne])||void 0===t||null===(o=t.using)||void 0===o?void 0:o[i])||x().isEmpty(null===ve||void 0===ve||null===(l=ve.scaling_groups[ne])||void 0===l||null===(s=l.remaining)||void 0===s?void 0:s[i])?void 0:x().toNumber(null===ve||void 0===ve||null===(a=ve.scaling_groups[ne])||void 0===a?void 0:a.using[i])+x().toNumber(null===ve||void 0===ve||null===(u=ve.scaling_groups[ne])||void 0===u?void 0:u.remaining[i])]),remaining:null!==(c=x().min([x().toNumber(null===ve||void 0===ve?void 0:ve.keypair_remaining[i]),x().toNumber(null===ve||void 0===ve?void 0:ve.group_remaining[i]),x().toNumber(null===ve||void 0===ve?void 0:ve.scaling_group_remaining[i])]))&&void 0!==c?c:Number.MAX_SAFE_INTEGER},e}),{})),{},{session:{min:1,max:x().min([W.max_concurrent_sessions,3]),remaining:(W.max_concurrent_sessions||3)-(U.concurrency_used||0)}});(0,y.useEffect)((function(){var e,n,i,r,t,o,l;if(V.setFieldsValue({resource:{cpu:null===(e=Ze.cpu)||void 0===e?void 0:e.min,mem:(null===(n=(0,$.PZ)(((null===(i=(0,$.PZ)(null===(r=Ze.shmem)||void 0===r?void 0:r.min,"m"))||void 0===i?void 0:i.number)||0)+((null===(t=(0,$.PZ)(null===(o=Ze.mem)||void 0===o?void 0:o.min,"m"))||void 0===t?void 0:t.number)||0)+"m","g"))||void 0===n?void 0:n.number)+"g",shmem:null===(l=Ze.shmem)||void 0===l?void 0:l.min}}),me.length>0)if(x().find(me,(function(e){return(null===e||void 0===e?void 0:e.key)===V.getFieldValue(["resource","acceleratorType"])})))V.setFieldValue(["resource","accelerator"],Ze[V.getFieldValue(["resource","acceleratorType"])].min);else{var s,a=null===(s=x().filter(me,(function(e){return x().keys(O).includes(null===e||void 0===e?void 0:e.key)}))[0])||void 0===s?void 0:s.key;a&&(V.setFieldValue(["resource","accelerator"],Ze[a].min),V.setFieldValue(["resource","acceleratorType"],a))}V.validateFields().catch((function(){}))}),[ae]);var be=(0,c.Z)((0,c.Z)({cpu:{warningOnly:!0,validator:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n,i){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Ze.cpu&&i>Ze.cpu.remaining)){e.next=4;break}return e.abrupt("return",Promise.reject(N("session.launcher.EnqueueComputeSessionWarning")));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()},mem:{warningOnly:!0,validator:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n,i){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!x().isElement(i)&&Ze.mem&&(0,$.p)(i,Ze.mem.remaining+"b")>0)){e.next=4;break}return e.abrupt("return",Promise.reject(N("session.launcher.EnqueueComputeSessionWarning")));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}},x().reduce(D,(function(e,n,i){return(0,c.Z)((0,c.Z)({},e),{},(0,G.Z)({},i,{warningOnly:!0,validator:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Ze[i]&&r>Ze[i].remaining)){e.next=4;break}return e.abrupt("return",Promise.reject(N("session.launcher.EnqueueComputeSessionWarning")));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}))}),{})),{},{session:{warningOnly:!0,validator:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n,i){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Ze.session&&i>Ze.session.remaining)){e.next=4;break}return e.abrupt("return",Promise.reject(N("session.launcher.EnqueueComputeSessionWarning")));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()},clusterSize:{warningOnly:!0,validator:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n,i){var r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i>x().min([null===(r=Ze.cpu)||void 0===r?void 0:r.remaining,W.max_containers_per_session]))){e.next=4;break}return e.abrupt("return",Promise.reject(N("session.launcher.EnqueueComputeSessionWarning")));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}});return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(I.Z.Item,{name:"resourceGroup",label:N("session.ResourceGroup"),rules:[{required:!0}],children:(0,Z.jsx)(ce.Z,{autoSelectDefault:!0,showSearch:!0,loading:oe,onChange:function(e){le((function(){ie(e)}))}})}),(0,Z.jsx)(I.Z.Item,{label:N("resourcePreset.ResourcePresets"),name:"allocationPreset",required:!0,style:{marginBottom:A.marginXS},children:(0,Z.jsx)(pe,{onChange:function(e,n){var i,r,t,o,l=x().pick(JSON.parse((null===n||void 0===n||null===(i=n.preset)||void 0===i?void 0:i.resource_slots)||"{}"),x().keys(O));V.setFieldsValue({resource:(0,c.Z)((0,c.Z)({},l),{},{mem:null===(r=(0,$.PZ)(((null===l||void 0===l?void 0:l.mem)||0)+"b","g",2))||void 0===r?void 0:r.numberUnit,shmem:null===(t=(0,$.PZ)(((null===n||void 0===n||null===(o=n.preset)||void 0===o?void 0:o.shared_memory)||0)+"b","g",2))||void 0===t?void 0:t.numberUnit})})}})}),(0,Z.jsx)(g.Z,{style:{marginBottom:A.margin},children:(0,Z.jsx)(I.Z.Item,{shouldUpdate:function(e,n){return e.allocationPreset!==n.allocationPreset},noStyle:!0,children:function(e){var n,i,r,t,o,l,u,d=e.getFieldValue;return(0,Z.jsxs)(Z.Fragment,{children:[(null===O||void 0===O?void 0:O.cpu)&&(0,Z.jsx)(I.Z.Item,{name:["resource","cpu"],label:N("session.launcher.CPU"),tooltip:(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescCPU"}),required:!0,rules:[{required:!0},{type:"number",min:null===(n=Ze.cpu)||void 0===n?void 0:n.min},be.cpu],children:(0,Z.jsx)(ue,{inputNumberProps:{addonAfter:N("session.launcher.Core")},sliderProps:{marks:(0,c.Z)({0:{style:{color:A.colorTextSecondary},label:0}},null!==(i=Ze.cpu)&&void 0!==i&&i.max?(0,G.Z)({},null===(r=Ze.cpu)||void 0===r?void 0:r.max,{style:{color:A.colorTextSecondary},label:null===(t=Ze.cpu)||void 0===t?void 0:t.max}):{})},min:0,max:null===(o=Ze.cpu)||void 0===o?void 0:o.max})}),(null===O||void 0===O?void 0:O.mem)&&(0,Z.jsx)(I.Z.Item,{name:["resource","mem"],label:N("session.launcher.Memory"),tooltip:(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescMemory"}),rules:[{required:!0},{validator:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n,i){var r,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((0,$.p)(i||"0b",null===(r=Ze.mem)||void 0===r?void 0:r.min)<0)){e.next=2;break}return e.abrupt("return",Promise.reject(N("session.launcher.MinMemory",{size:x().toUpper(null===(t=Ze.mem)||void 0===t?void 0:t.min)})));case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()},be.mem],children:(0,Z.jsx)(se,{max:null===(l=Ze.mem)||void 0===l?void 0:l.max,min:"0g",extraMarks:null!==ve&&void 0!==ve&&ve.scaling_group_remaining.mem?(0,G.Z)({},(0,$.PZ)(null===ve||void 0===ve?void 0:ve.scaling_group_remaining.mem,"g",3).numberFixed,{label:"-"}):void 0})}),(null===O||void 0===O?void 0:O.mem)&&(0,Z.jsx)(I.Z.Item,{name:["resource","shmem"],label:N("session.launcher.SharedMemory"),tooltip:(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescSharedMemory"}),dependencies:[["resource","mem"]],rules:[{required:!0},{},{validator:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n,i){var r,t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(x().isEmpty(null===(r=d("resource"))||void 0===r?void 0:r.mem)||x().isEmpty(i)||(0,$.p)(null===(t=d("resource"))||void 0===t?void 0:t.mem,i)>=0)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:throw N("resourcePreset.SHMEMShouldBeSmallerThanMemory");case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,Z.jsx)(se,{min:"0g",max:null===(u=Ze.mem)||void 0===u?void 0:u.max})}),(0,Z.jsx)(I.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.resource)||void 0===i?void 0:i.acceleratorType)!==(null===(r=n.resource)||void 0===r?void 0:r.acceleratorType)||e.cluster_size!==n.cluster_size},children:function(e){var n,i,r,t,o=(0,e.getFieldValue)(["resource","acceleratorType"]);return(0,Z.jsx)(I.Z.Item,{name:["resource","accelerator"],label:N("session.launcher.AIAccelerator"),tooltip:{placement:"right",title:(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescAIAccelerator"})},required:!0,rules:[{required:!0},{type:"number",min:(null===(n=Ze[o])||void 0===n?void 0:n.min)||0},be[o]],children:(0,Z.jsx)(ue,{sliderProps:{marks:(0,G.Z)({0:0},null===(i=Ze[o])||void 0===i?void 0:i.max,null===(r=Ze[o])||void 0===r?void 0:r.max),tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(de.Ec[o])}}},min:0,max:null===(t=Ze[o])||void 0===t?void 0:t.max,step:x().endsWith(o,"shares")&&V.getFieldValue("cluster_size")<2?.1:1,inputNumberProps:{addonAfter:(0,Z.jsx)(I.Z.Item,{noStyle:!0,name:["resource","acceleratorType"],initialValue:x().keys(D)[0],children:(0,Z.jsx)(q.Z,{suffixIcon:x().size(D)>1?void 0:null,popupMatchSelectWidth:!1,options:x().map(D,(function(e,n){return{value:n,label:de.Ec[n]||"UNIT",disabled:me.length>0&&!x().find(me,(function(e){return(null===e||void 0===e?void 0:e.key)===n}))}}))})})}})})}}),E?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(he.Z,{children:" x "}),(0,Z.jsx)(I.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.cluster_size!==n.cluster_size},children:function(){var e,n,i,r,t,o,l;return(0,Z.jsx)(I.Z.Item,{name:["num_of_sessions"],label:N("webui.menu.Sessions"),tooltip:(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescSession"}),required:!0,rules:[{required:!0},be.session],children:(0,Z.jsx)(ue,{inputNumberProps:{addonAfter:"#"},disabled:V.getFieldValue("cluster_size")>1,sliderProps:{marks:(t={},(0,G.Z)(t,null===(e=Ze.session)||void 0===e?void 0:e.min,null===(n=Ze.session)||void 0===n?void 0:n.min),(0,G.Z)(t,null===(i=Ze.session)||void 0===i?void 0:i.max,null===(r=Ze.session)||void 0===r?void 0:r.max),t)},min:null===(o=Ze.session)||void 0===o?void 0:o.min,max:null===(l=Ze.session)||void 0===l?void 0:l.max})})}})]}):null]})}})}),R.supports("multi-container")&&(0,Z.jsx)(I.Z.Item,{label:N("session.launcher.ClusterMode"),tooltip:(0,Z.jsxs)(T.Z,{direction:"column",align:"start",children:[N("session.launcher.SingleNode"),(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescSingleNode"}),(0,Z.jsx)(he.Z,{style:{backgroundColor:A.colorBorder}}),N("session.launcher.MultiNode"),(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescMultiNode"})]}),required:!0,children:(0,Z.jsx)(g.Z,{style:{marginBottom:A.margin},children:(0,Z.jsxs)(ge.Z,{gutter:A.marginMD,children:[(0,Z.jsx)(fe.Z,{xs:24,children:(0,Z.jsx)(I.Z.Item,{name:"cluster_mode",required:!0,children:(0,Z.jsxs)(xe.ZP.Group,{onChange:function(e){V.validateFields().catch((function(){}))},children:[(0,Z.jsx)(xe.ZP.Button,{value:"single-node",children:N("session.launcher.SingleNode")}),(0,Z.jsx)(xe.ZP.Button,{value:"multi-node",children:N("session.launcher.MultiNode")})]})})}),(0,Z.jsx)(fe.Z,{xs:24,children:(0,Z.jsx)(I.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.cluster_mode!==n.cluster_mode},children:function(){var e,n=x().min([null===(e=Ze.cpu)||void 0===e?void 0:e.max,W.max_containers_per_session]),i="single-node"===V.getFieldValue("cluster_mode")?N("session.launcher.Container"):N("session.launcher.Node");return(0,Z.jsx)(I.Z.Item,{name:"cluster_size",label:N("session.launcher.ClusterSize"),required:!0,rules:[be.clusterSize],children:(0,Z.jsx)(ue,{min:1,max:n,disabled:1===n,sliderProps:{marks:(0,G.Z)({1:"1"},n,n),tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(i)}}},inputNumberProps:{addonAfter:i},onChange:function(e){e>1&&V.setFieldValue("num_of_sessions",1)}})})}})})]})})})]})},be=y.memo(Ze),je=function(e){var n=Object.assign({},((0,z.Z)(e),e)),i=(0,M.$G)().t;return(0,Z.jsx)(I.Z.Item,(0,c.Z)((0,c.Z)({label:i("session.launcher.SessionName"),name:"name",rules:[{max:64,message:i("session.Validation.SessionNameTooLong64")},{pattern:/^(?:[a-zA-Z0-9][a-zA-Z0-9._-]{2,}[a-zA-Z0-9])?$/,message:i("session.Validation.PleaseFollowSessionNameRule").toString()}]},n),{},{children:(0,Z.jsx)(N.Z,{allowClear:!0})}))},ke=i(93433),Pe=i(91278),_e=i(37007),we=function(e){var n=e.vFolderFrgmt,r=void 0===n?null:n,t=e.permission,o=(0,J.useFragment)(void 0!==l?l:l=i(750),r),s=x().chain({r:"green",w:"blue",d:"red"}).map((function(e,n){if(function(e,n){return!(null===e||void 0===e||!e.includes(n))||!(null===e||void 0===e||!e.includes("w")||"r"!==n)}((null===o||void 0===o?void 0:o.permission)||t,n))return{label:n.toUpperCase(),color:e}})).compact().value();return(0,Z.jsx)(_e.Z,{values:s})},Fe=i(56713),Se=i(50708),Ce=i(72842),Te=i(227),Ee=i(51367),Ve=["filter","showAliasInput","selectedRowKeys","onChangeSelectedRowKeys","aliasBasePath","aliasMap","onChangeAliasMap","rowKey"],Ie=function(e){var n=e.filter,i=e.showAliasInput,r=void 0!==i&&i,t=e.selectedRowKeys,o=void 0===t?[]:t,l=e.onChangeSelectedRowKeys,m=e.aliasBasePath,v=void 0===m?"/home/work/":m,p=e.aliasMap,g=e.onChangeAliasMap,f=e.rowKey,b=void 0===f?"name":f,j=(0,d.Z)(e,Ve),P=y.useMemo((function(){return function(e){return e&&e[b]}}),[b]),_=(0,k.Z)({value:o,onChange:l},{defaultValue:[]}),F=(0,u.Z)(_,2),S=F[0],E=F[1],V=(0,k.Z)({value:p,onChange:g},{defaultValue:{}}),A=(0,u.Z)(V,2),R=A[0],K=A[1],O=I.Z.useForm(),D=(0,u.Z)(O,1)[0];(0,y.useEffect)((function(){R&&(D.setFieldsValue(x().mapValues(R,(function(e){return e.startsWith(v)?e.slice(v.length):e}))),D.validateFields())}),[R,D,v]);var z=(0,M.$G)().t,q=(0,$.y3)(),L=(0,B.qh)(),U=(0,B.Kr)("first"),W=(0,u.Z)(U,2),Q=W[0],G=W[1],H=(0,y.useTransition)(),J=(0,u.Z)(H,2),X=J[0],ee=J[1],ne=(0,Y.h)({queryKey:["VFolderSelectQuery",Q],queryFn:function(){return q({method:"GET",url:"/folders?group_id=".concat(L.id)})},staleTime:0}).data,re=(0,y.useState)(""),te=(0,u.Z)(re,2),oe=te[0],le=te[1],se=x().filter(ne,(function(e){return!!S.includes(P(e))||(!n||n(e))&&(!oe||e.name.includes(oe))})),ae=function(e){null===e||void 0===e||e.preventDefault(),D.validateFields().then((function(e){})).catch((function(){})).finally((function(){K(x().mapValues(x().pickBy(D.getFieldsValue(),(function(e){return!!e})),(function(e,n){return ue(n,e)})))}))},ue=function(e,n){return x().isEmpty(n)?"".concat(v).concat(e):null!==n&&void 0!==n&&n.startsWith("/")?n:"".concat(v).concat(n)},ce=(0,C.useShadowRoot)(),de=[{title:(0,Z.jsxs)(T.Z,{direction:"row",gap:"xxs",children:[(0,Z.jsx)(ie.Z.Text,{children:z("data.folders.Name")}),r&&(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsxs)(ie.Z.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",z("session.launcher.FolderAlias")," ",(0,Z.jsx)(Te.Z,{title:(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescFolderAlias"}),style:{zIndex:1e4},getPopupContainer:function(){return ce},children:(0,Z.jsx)(Fe.Z,{})}),")"]})})]}),dataIndex:"name",sorter:function(e,n){return e.name.localeCompare(n.name)},render:function(e,n){var i=S.includes(P(n));return(0,Z.jsxs)(T.Z,{direction:"column",align:"stretch",gap:"xxs",style:r&&i?{display:"inline-flex",height:70,width:"100%"}:void 0,children:[(0,Z.jsx)(Pe.Z,{keyword:oe,children:e}),r&&i&&(0,Z.jsx)(I.Z.Item,{noStyle:!0,shouldUpdate:function(e,i){return e[P(n)]!==i[P(n)]},children:function(){var e=x()(S).reduce((function(e,n){return e[n]=(null===R||void 0===R?void 0:R[n])||ue(n,void 0),e}),{});return(0,Z.jsx)(I.Z.Item,{name:P(n),rules:[{type:"string",pattern:/^[a-zA-Z0-9_/-]*$/,message:z("session.launcher.FolderAliasInvalid")},{type:"string",validator:function(){var i=(0,a.Z)((0,s.Z)().mark((function i(r,t){return(0,s.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t||!x().some(e,(function(e,i){return i!==P(n)&&e===ue(P(n),t)}))){i.next=2;break}return i.abrupt("return",Promise.reject(z("session.launcher.FolderAliasOverlapping")));case 2:return i.abrupt("return",Promise.resolve());case 3:case"end":return i.stop()}}),i)})));return function(e,n){return i.apply(this,arguments)}}()}],extra:ue(n.name,D.getFieldValue(P(n))),children:(0,Z.jsx)(N.Z,{onClick:function(e){e.stopPropagation()},placeholder:z("session.launcher.FolderAlias"),onChange:ae,allowClear:!0})})}})]})},fixed:"left"},{title:z("data.UsageMode"),dataIndex:"usage_mode",sorter:function(e,n){return e.usage_mode.localeCompare(n.usage_mode)}},{title:z("data.Host"),dataIndex:"host"},{title:z("data.Type"),dataIndex:"type",sorter:function(e,n){return e.type.localeCompare(n.type)},render:function(e,n){return(0,Z.jsxs)(T.Z,{direction:"column",children:["user"===n.type?(0,Z.jsx)(Se.Z,{title:"User"}):(0,Z.jsx)("div",{children:"Group"}),"group"===n.type&&"(".concat(n.group_name,")")]})}},{title:z("data.Permission"),dataIndex:"permission",sorter:function(e,n){return e.permission.localeCompare(n.permission)},render:function(e,n){return(0,Z.jsx)(we,{permission:n.permission})}},{title:z("data.Created"),dataIndex:"created_at",sorter:function(e,n){return e.created_at.localeCompare(n.created_at)},render:function(e,n){return w()(e).format("L")}}];return(0,Z.jsxs)(T.Z,{direction:"column",align:"stretch",gap:"xs",children:[(0,Z.jsxs)(T.Z,{direction:"row",gap:"xs",justify:"between",children:[(0,Z.jsx)(N.Z,{value:oe,onChange:function(e){return le(e.target.value)},allowClear:!0,placeholder:z("data.SearchByName")}),(0,Z.jsx)(h.ZP,{loading:X,icon:(0,Z.jsx)(Ce.Z,{}),onClick:function(){ee((function(){G()}))}})]}),(0,Z.jsx)(I.Z,{form:D,children:(0,Z.jsx)(Ee.Z,(0,c.Z)({scroll:{x:"max-content"},rowKey:P,rowSelection:{selectedRowKeys:S,onChange:function(e){E(e),ae()}},showSorterTooltip:!1,columns:de,dataSource:se,onRow:function(e,n){return{onClick:function(n){var i,r=n.target;null!==r&&void 0!==r&&null!==(i=r.classList)&&void 0!==i&&i.contains("ant-table-selection-column")&&(n.stopPropagation(),S.includes(P(e))?E(S.filter((function(n){return n!==P(e)}))):E([].concat((0,ke.Z)(S),[P(e)])))}}}},j))})]})},Ne=function(e){var n=Object.assign({},((0,z.Z)(e),e)),i=I.Z.useFormInstance(),r=(0,M.$G)().t;return I.Z.useWatch("vfoldersAliasMap",i),(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(I.Z.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator:function(e,n){var t=x().chain(i.getFieldValue("mounts")).reduce((function(e,i){return e[i]=n[i]||"/home/work/"+i,e}),{}).values().value();return x().uniq(t).length!==t.length?Promise.reject(r("session.launcher.FolderAliasOverlapping")):Promise.resolve()}}],children:(0,Z.jsx)(N.Z,{})}),(0,Z.jsx)(I.Z.Item,(0,c.Z)((0,c.Z)({name:"mounts"},n),{},{valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,Z.jsx)(Ie,{rowKey:"name",showAliasInput:!0,aliasMap:i.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:function(e){i.setFieldValue("vfoldersAliasMap",e),i.validateFields(["vfoldersAliasMap"])},pagination:!1})}))]})},Me=i(92331),Ae=i(91428),Re=i(70442),Ke=i(84239),Oe=i(89898),De=i(99269),ze=i(90632),Be=i(46734),qe=i(88464),Le=i(60284),Ue=i(41366),We=i(14634),Qe=i(62708),Ge=i(93448),$e=i(52176),He=i(32461),Je=i(48196),Xe=i(17490),Ye=i(12674),en=i(4996),nn=i(5936),rn=i(55144),tn=(0,c.Z)({sessionType:"interactive",allocationPreset:"custom",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0},envvars:[]},{resource:{cpu:0,mem:"0g",shmem:"0g",accelerator:0},num_of_sessions:1,cluster_mode:"single-node",cluster_size:1}),on=(0,rn.withDefault)(rn.NumberParam,0),ln=(0,rn.withDefault)(rn.JsonParam,tn),sn=function(e){var n=e.form,i=e.containerCount,r=void 0===i?1:i;return(0,Z.jsxs)(Z.Fragment,{children:[x().map(x().omit(n.getFieldValue("resource"),"shmem","accelerator","acceleratorType"),(function(e,i){var t,o;return(0,Z.jsx)(de.ZP,{type:i,value:"mem"===i?((null===(t=(0,$.PZ)(e,"b"))||void 0===t?void 0:t.number)||0)*r+"":x().toNumber(e)*r+"",opts:{shmem:n.getFieldValue("resource").shmem?((null===(o=(0,$.PZ)(n.getFieldValue("resource").shmem,"b"))||void 0===o?void 0:o.number)||0)*r:void 0}},i)})),x().isNumber(n.getFieldValue(["resource","accelerator"]))&&(0,Z.jsx)(de.ZP,{type:n.getFieldValue(["resource","acceleratorType"]),value:x().toString(n.getFieldValue(["resource","accelerator"])*r)})]})},an=function(){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<8;i++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},un=function(){for(var e,n=Math.floor(52*Math.random()*52*52),i="",r=0;r<3;r++)i+=(e=n%52)<26?String.fromCharCode(65+e):String.fromCharCode(97+e-26),n=Math.floor(n/52);return i},cn=function(){var e,n,i,r,t,o,l,d="normal",m=(0,y.useState)(!1),v=(0,u.Z)(m,2),f=v[0],b=v[1],k=(0,rn.useQueryParams)({step:on,formValues:ln,redirectTo:rn.StringParam}),P=(0,u.Z)(k,2),_=P[0],F=_.step,E=_.formValues,V=_.redirectTo,A=P[1],R=(0,Ye.s0)(),z=(0,C.useWebComponentInfo)().moveTo,U=(0,B.Dj)(),G=(0,B.qh)(),H=(0,ze.Z)((function(){console.log("syncFormToURLWithDebounce",te.getFieldsValue()),A({formValues:x().omit(te.getFieldsValue(),["environments.image"])},"replaceIn")}),{leading:!1,wait:500,trailing:!0}).run,J=function(e){A({step:e},"pushIn")},X=p.Z.useToken().token,Y=(0,M.$G)().t,ee=Be.ZP.useBreakpoint(),re=I.Z.useForm(),te=(0,u.Z)(re,1)[0];(0,y.useEffect)((function(){JSON.stringify(tn)!==JSON.stringify(E)&&(te.setFieldsValue(E),te.validateFields().catch((function(e){})))}),[]),(0,y.useEffect)((function(){}),[F]);var oe=I.Z.useWatch("sessionType",{form:te,preserve:!0})||te.getFieldValue("sessionType")||E.sessionType,le=x().filter([{title:Y("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(Y("session.launcher.Environments")," & ").concat(Y("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==oe&&{title:Y("webui.menu.Data&Storage"),key:"storage"},{title:Y("session.launcher.Network"),key:"network"},{title:Y("session.launcher.ConfirmAndLaunch"),icon:(0,Z.jsx)(Me.Z,{}),key:"review"}],(function(e){return!!e})),se=null===(e=le[F])||void 0===e?void 0:e.key,ae=x().some(te.getFieldsError(),(function(e){return e.errors.length>0})),ue=function(){te.validateFields().catch((function(e){})).finally((function(){J(le.length-1)}))};return(0,Z.jsxs)(T.Z,{direction:"column",align:"stretch",style:{padding:X.paddingSM,width:"100%",justifyContent:"revert"},children:[(0,Z.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),V&&(0,Z.jsx)(Le.Z,{items:[{title:Y("webui.menu.Sessions"),onClick:function(e){e.preventDefault(),z(V)},href:V},{title:Y("session.launcher.StartNewSession")}]}),(0,Z.jsxs)(T.Z,{direction:"row",gap:"md",align:"start",children:[(0,Z.jsxs)(T.Z,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,Z.jsxs)(T.Z,{direction:"row",justify:"between",children:[(0,Z.jsx)(ie.Z.Title,{level:3,style:{marginTop:0},children:Y("session.launcher.StartNewSession")}),(0,Z.jsxs)(T.Z,{direction:"row",gap:"sm",children:[(0,Z.jsx)(Ue.Z,{title:Y("button.Reset"),description:Y("session.launcher.ResetFormConfirm"),onConfirm:function(){te.resetFields(),R("/session/start")},icon:(0,Z.jsx)(Fe.Z,{style:{color:X.colorError}}),okText:Y("button.Reset"),okButtonProps:{danger:!0},children:(0,Z.jsx)(h.ZP,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:Y("button.Reset")})}),(0,Z.jsx)(h.ZP,{type:"link",icon:(0,Z.jsx)(Ae.Z,{}),disabled:!0,style:{paddingRight:0,paddingLeft:0},children:Y("session.launcher.TemplateAndHistory")})]})]}),(0,Z.jsx)(I.Z.Provider,{onFormChange:function(e,n){H()},children:(0,Z.jsx)(I.Z,{form:te,layout:"vertical",requiredMark:"optional",initialValues:tn,children:(0,Z.jsxs)(T.Z,{direction:"column",align:"stretch",gap:"md",children:[(0,Z.jsxs)(g.Z,{title:Y("session.launcher.SessionType"),style:{display:"sessionType"===se?"block":"none"},children:[(0,Z.jsx)(I.Z.Item,{name:"sessionType",children:(0,Z.jsx)(xe.ZP.Group,{className:"session-type-radio-group",options:[{label:(0,Z.jsxs)(T.Z,{direction:"column",align:"start",style:{marginBottom:X.marginXS},children:[(0,Z.jsx)(ie.Z.Text,{strong:!0,children:"\ud83c\udfc3\u200d\u2640\ufe0f Make, test and run"}),(0,Z.jsxs)(ie.Z.Text,{type:"secondary",children:[(0,Z.jsx)(ie.Z.Text,{code:!0,children:"Interactive mode"})," ","allows you to create, test and run code interactively via jupyter notebook, visual studio code, etc."]})]}),value:"interactive"},{label:(0,Z.jsxs)(T.Z,{direction:"column",align:"start",children:[(0,Z.jsx)(ie.Z.Text,{strong:!0,children:"\u231a\ufe0f Start an long-running task"}),(0,Z.jsxs)(ie.Z.Text,{type:"secondary",children:[(0,Z.jsx)(ie.Z.Text,{code:!0,children:"Batch mode"})," ","runs your code with multiple node & clusters to scale your idea"]})]}),value:"batch"}]})}),(0,Z.jsx)(je,{})]}),"batch"===oe&&(0,Z.jsxs)(g.Z,{title:Y("session.launcher.BatchModeConfig"),style:{display:"sessionType"===se?"block":"none"},children:[(0,Z.jsx)(I.Z.Item,{label:Y("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,Z.jsx)(N.Z.TextArea,{autoSize:!0})}),(0,Z.jsx)(I.Z.Item,{label:Y("session.launcher.SessionStartTime"),children:(0,Z.jsxs)(T.Z,{direction:"row",gap:"xs",children:[(0,Z.jsx)(I.Z.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,Z.jsx)(We.Z,{onChange:function(e){e.target.checked&&x().isEmpty(te.getFieldValue(["batch","scheduleDate"]))?te.setFieldValue(["batch","scheduleDate"],w()().add(2,"minutes").toISOString()):!1===e.target.checked&&te.setFieldValue(["batch","scheduleDate"],void 0)},children:Y("session.launcher.Enable")})}),(0,Z.jsx)(I.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.batch)||void 0===i?void 0:i.enabled)!==(null===(r=n.batch)||void 0===r?void 0:r.enabled)},children:function(){var e,n=!0!==(null===(e=te.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(I.Z.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n,i){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||!w()(i).isBefore(w()())){e.next=2;break}return e.abrupt("return",Promise.reject(Y("session.launcher.StartTimeMustBeInTheFuture")));case 2:return e.abrupt("return",Promise.resolve());case 3:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,Z.jsx)(S,{disabled:n,showTime:!0,localFormat:!0,disabledDate:function(e){return e.isBefore(w()().startOf("day"))}})})})}})]})})]}),"inference"===oe&&(0,Z.jsx)(g.Z,{title:"Inference Mode Configuration",children:(0,Z.jsx)(I.Z.Item,{name:["inference","vFolderName"],label:Y("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,Z.jsx)(q.Z,{})})}),(0,Z.jsxs)(g.Z,{title:Y("session.launcher.Environments"),style:{display:"environment"===se?"block":"none"},children:[(0,Z.jsx)(Xe.SV,{fallbackRender:function(e){return console.log(e),null},children:(0,Z.jsx)(O.Z,{})}),(0,Z.jsx)(I.Z.Item,{label:"Environment Variables",children:(0,Z.jsx)(K,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,Z.jsx)(g.Z,{title:Y("session.launcher.ResourceAllocation"),style:{display:"environment"===se?"block":"none"},children:(0,Z.jsx)(be,{enableNumOfSessions:!0})}),(0,Z.jsxs)(g.Z,{title:Y("session.launcher.HPCOptimization"),style:{display:"environment"===se?"block":"none"},children:[(0,Z.jsx)(I.Z.Item,{noStyle:!0,children:(0,Z.jsxs)(T.Z,{direction:"row",gap:"sm",children:[(0,Z.jsx)(ie.Z.Text,{children:Y("session.launcher.SwitchOpenMPoptimization")}),(0,Z.jsx)(I.Z.Item,{label:Y("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,Z.jsx)(Qe.Z,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:function(e){e&&te.setFieldsValue(x().pick(tn,["hpcOptimization"]))}})})]})}),(0,Z.jsx)(I.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.hpcOptimization)||void 0===i?void 0:i.autoEnabled)!==(null===(r=n.hpcOptimization)||void 0===r?void 0:r.autoEnabled)},children:function(){var e=te.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,Z.jsxs)(ge.Z,{gutter:X.marginMD,style:{display:e?"none":void 0,marginTop:X.marginMD},children:[(0,Z.jsx)(fe.Z,{xs:24,sm:12,children:(0,Z.jsx)(I.Z.Item,{style:{flex:1},label:Y("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,Z.jsxs)(Z.Fragment,{children:[Y("session.launcher.OpenMPOptimization"),(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,Z.jsx)(ne.Z,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,Z.jsx)(fe.Z,{xs:24,sm:12,children:(0,Z.jsx)(I.Z.Item,{style:{flex:1},label:Y("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,Z.jsxs)(Z.Fragment,{children:[Y("session.launcher.OpenMPOptimization"),(0,Z.jsx)(M.cC,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,Z.jsx)(ne.Z,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,Z.jsx)(g.Z,{title:Y("webui.menu.Data&Storage"),style:{display:"storage"===se?"block":"none"},children:(0,Z.jsx)(Ne,{})}),(0,Z.jsx)(g.Z,{title:Y("session.launcher.Network"),style:{display:"network"===se?"block":"none"},children:(0,Z.jsx)(Q,{})}),"review"===se&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(j,{title:Y("session.launcher.SessionType"),size:"small",status:te.getFieldError("name").length>0||te.getFieldError(["batch","command"]).length>0||te.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:Y("button.Edit"),onClickExtraButton:function(){J(le.findIndex((function(e){return"sessionType"===e.key})))},children:(0,Z.jsxs)(Ge.Z,{size:"small",children:[(0,Z.jsx)(Ge.Z.Item,{label:Y("session.SessionType"),span:24,children:te.getFieldValue("sessionType")}),!x().isEmpty(te.getFieldValue("name"))&&(0,Z.jsx)(Ge.Z.Item,{label:Y("session.launcher.SessionName"),span:24,children:te.getFieldValue("name")}),"batch"===oe&&(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(Ge.Z.Item,{label:Y("session.launcher.StartUpCommand"),span:24,children:(0,Z.jsx)(N.Z.TextArea,{readOnly:!0,autoSize:!0,value:te.getFieldValue(["batch","command"])})}),(0,Z.jsx)(Ge.Z.Item,{label:Y("session.launcher.ScheduleTimeSimple"),span:24,children:w()(te.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)")})]})]})}),(0,Z.jsx)(j,{title:Y("session.launcher.Environments"),size:"small",status:x().some(te.getFieldValue("envvars"),(function(e,n){return te.getFieldError(["envvars",n,"variable"]).length>0||te.getFieldError(["envvars",n,"value"]).length>0}))?"error":void 0,extraButtonTitle:Y("button.Edit"),onClickExtraButton:function(){J(le.findIndex((function(e){return"environment"===e.key})))},children:(0,Z.jsxs)(Ge.Z,{size:"small",column:2,children:[(0,Z.jsx)(Ge.Z.Item,{label:Y("session.launcher.Project"),children:G.name}),(0,Z.jsx)(Ge.Z.Item,{label:Y("general.ResourceGroup"),children:te.getFieldValue("resourceGroup")}),(0,Z.jsx)(Ge.Z.Item,{label:Y("general.Image"),span:2,children:(0,Z.jsxs)(T.Z,{direction:"row",gap:"xs",style:{flex:1},children:[(0,Z.jsx)(D.Z,{image:null===(n=te.getFieldValue("environments"))||void 0===n?void 0:n.version}),(0,Z.jsx)(ie.Z.Text,{copyable:!0,code:!0,children:null===(i=te.getFieldValue("environments"))||void 0===i?void 0:i.version})]})}),(null===(r=te.getFieldValue("envvars"))||void 0===r?void 0:r.length)>0&&(0,Z.jsx)(Ge.Z.Item,{label:Y("session.launcher.EnvironmentVariable"),children:null!==(t=te.getFieldValue("envvars"))&&void 0!==t&&t.length?(0,Z.jsx)(en.Z,{style:nn.Z,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:x().map(te.getFieldValue("envvars"),(function(e){return"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"')})).join("\n")}):(0,Z.jsx)(ie.Z.Text,{type:"secondary",children:"-"})})]})}),(0,Z.jsx)(j,{title:Y("session.launcher.ResourceAllocation"),status:x().some(te.getFieldValue("resource"),(function(e,n){return te.getFieldError(["resource",n]).length>0}))?"error":void 0,size:"small",extraButtonTitle:Y("button.Edit"),onClickExtraButton:function(){J(le.findIndex((function(e){return"environment"===e.key})))},children:(0,Z.jsxs)(T.Z,{direction:"column",align:"stretch",children:[x().some(te.getFieldValue("resource"),(function(e,n){return te.getFieldWarning(["resource",n]).length>0}))&&(0,Z.jsx)($e.Z,{type:"warning",showIcon:!0,message:Y("session.launcher.EnqueueComputeSessionWarning")}),(0,Z.jsxs)(Ge.Z,{column:2,children:[(0,Z.jsx)(Ge.Z.Item,{label:Y("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,Z.jsxs)(T.Z,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===te.getFieldValue("allocationPreset")?"":(0,Z.jsx)(L.Z,{children:te.getFieldValue("allocationPreset")}),(0,Z.jsx)(sn,{form:te})]})}),(0,Z.jsx)(Ge.Z.Item,{label:Y("session.launcher.NumberOfContainer"),children:1===te.getFieldValue("cluster_size")?te.getFieldValue("num_of_sessions"):te.getFieldValue("cluster_size")}),(0,Z.jsx)(Ge.Z.Item,{label:Y("session.launcher.ClusterMode"),children:"single-node"===te.getFieldValue("cluster_mode")?Y("session.launcher.SingleNode"):Y("session.launcher.MultiNode")})]}),(0,Z.jsx)(g.Z,{size:"small",type:"inner",title:Y("session.launcher.TotalAllocation"),children:(0,Z.jsx)(T.Z,{direction:"row",gap:"xxs",children:(0,Z.jsx)(sn,{form:te,containerCount:1===te.getFieldValue("cluster_size")?te.getFieldValue("num_of_sessions"):te.getFieldValue("cluster_size")})})})]})}),(0,Z.jsx)(j,{title:Y("webui.menu.Data&Storage"),size:"small",status:te.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:Y("button.Edit"),onClickExtraButton:function(){J(le.findIndex((function(e){return"storage"===e.key})))},children:(null===(o=te.getFieldValue("mounts"))||void 0===o?void 0:o.length)>0?(0,Z.jsx)(Ee.Z,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:Y("data.folders.Name")},{dataIndex:"alias",title:Y("session.launcher.FolderAlias"),render:function(e,n){return x().isEmpty(e)?(0,Z.jsx)(ie.Z.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(n.name)}):e}}],dataSource:x().map(te.getFieldValue("mounts"),(function(e){var n;return{name:e,alias:null===(n=te.getFieldValue("vfoldersAliasMap"))||void 0===n?void 0:n[e]}}))}):(0,Z.jsx)($e.Z,{type:"warning",showIcon:!0,message:Y("session.launcher.NoFolderMounted")})}),(0,Z.jsx)(j,{title:"Network",size:"small",status:te.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:Y("button.Edit"),onClickExtraButton:function(){J(le.findIndex((function(e){return"network"===e.key})))},children:(0,Z.jsx)(Ge.Z,{size:"small",children:(0,Z.jsx)(Ge.Z.Item,{label:Y("session.launcher.PreOpenPortTitle"),children:(0,Z.jsxs)(T.Z,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[x().sortBy(te.getFieldValue("ports"),(function(e){return parseInt(e)})).map((function(e){return(0,Z.jsx)(W,{value:e,style:{margin:0},children:e})})),x().isArray(te.getFieldValue("ports"))&&0!==(null===(l=te.getFieldValue("ports"))||void 0===l?void 0:l.length)?null:(0,Z.jsx)(ie.Z.Text,{type:"secondary",children:Y("general.None")})]})})})})]}),(0,Z.jsxs)(T.Z,{direction:"row",justify:"between",children:[(0,Z.jsx)(T.Z,{gap:"sm",children:F===le.length-1&&(0,Z.jsx)(h.ZP,{icon:(0,Z.jsx)(Re.Z,{}),disabled:!0,onClick:function(){qe.ZP.info("Not implemented yet: Template edit modal")},children:"Save as a template"})}),(0,Z.jsxs)(T.Z,{direction:"row",gap:"sm",children:[F!==le.length-1&&(0,Z.jsx)(h.ZP,{onClick:ue,children:"Skip to Review"}),F>0&&(0,Z.jsx)(h.ZP,{onClick:function(){J(F-1)},icon:(0,Z.jsx)(Ke.Z,{}),disabled:f,children:"Previous"}),F===le.length-1?(0,Z.jsx)(h.ZP,{type:"primary",icon:(0,Z.jsx)(Oe.Z,{}),disabled:ae,onClick:function(){b(!0),te.validateFields().then(function(){var e=(0,a.Z)((0,s.Z)().mark((function e(n){var i,r,t,o,l,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.environments.version.split("@"),r=(0,u.Z)(i,2),t=r[0],o=r[1],l={kernelName:t,architecture:o,sessionName:x().isEmpty(n.name)?an():n.name,config:(0,c.Z)((0,c.Z)({type:n.sessionType},"batch"===n.sessionType?{startsAt:n.batch.enabled?n.batch.scheduleDate:void 0,startupCommand:n.batch.command}:{}),{},{group_name:G.name,domain:U._config.domainName,scaling_group:n.resourceGroup,cluster_mode:n.cluster_mode,cluster_size:n.cluster_size,maxWaitSeconds:15,cpu:n.resource.cpu,mem:n.resource.mem,shmem:(0,$.p)(n.resource.mem,"4g")>0&&(0,$.p)(n.resource.shmem,"1g")<0?"1g":n.resource.shmem,mounts:n.mounts,mount_map:n.vfoldersAliasMap,env:(0,c.Z)((0,c.Z)({},x().fromPairs(n.envvars.map((function(e){return[e.variable,e.value]})))),x().omit(n.hpcOptimization,"autoEnabled")),preopen_ports:x().map(n.ports,(function(e){return parseInt(e)}))})},a=x().map(x().range(n.num_of_sessions||1),(function(e){var i=(n.num_of_sessions||1)>1?"".concat(l.sessionName,"-").concat(un(),"-").concat(e):l.sessionName;return U.createIfNotExists(l.kernelName,i,l.config,2e4,l.architecture).then((function(e){return null!==e&&void 0!==e&&e.created||qe.ZP.warning(Y("session.launcher.SessionAlreadyExists")),e})).catch((function(e){throw console.log(e),e}))})),e.next=5,Promise.all(a).then((function(e){var i=(0,u.Z)(e,1)[0];if(1===n.num_of_sessions&&"batch"!==n.sessionType){var r,t=i;r="kernelId"in t?{"session-name":t.kernelId,"access-key":"",mode:d}:{"session-uuid":t.sessionId,"session-name":t.sessionName,"access-key":"",mode:d};var o=t.servicePorts;!0===Array.isArray(o)?r["app-services"]=o.map((function(e){return e.name})):r["app-services"]=[],o.length>0&&globalThis.appLauncher.showLauncher(r)}R("/job",{}),z("/job")})).catch((function(){}));case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("validation errors",e)})).finally((function(){b(!1)}))},loading:f,children:Y("session.launcher.Launch")}):(0,Z.jsxs)(h.ZP,{type:"primary",ghost:!0,onClick:function(){J(F+1)},children:["Next ",(0,Z.jsx)(De.Z,{})]})]})]})]})})})]}),ee.md&&(0,Z.jsx)(He.Z,{offsetTop:150,style:{zIndex:2},children:(0,Z.jsx)(Je.Z,{size:"small",direction:"vertical",current:F,onChange:function(e){e===le.length-1?ue():J(e)},items:x().map(le,(function(e,n){return(0,c.Z)((0,c.Z)({},e),{},{status:n===F?"process":"wait"})}))})})]})]})}}}]);
//# sourceMappingURL=383.7fb3e064.chunk.js.map