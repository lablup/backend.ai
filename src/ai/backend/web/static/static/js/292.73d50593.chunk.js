/*! For license information please see 292.73d50593.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[292],{9018:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(91726),a=n(1004),r=n(11753),i=n(43128),l=n.n(i),s=n(66845);const d=(0,r.rU)((e=>{let{css:t,token:n}=e;return{board:t`
      .bai_board_placeholder {
        border-radius: var(--token-borderRadius) !important;
      }
      .bai_board_placeholder--active {
        background-color: var(--token-colorSplit) !important ;
      }
      .bai_board_placeholder--hover {
        background-color: var(--token-colorPrimaryHover) !important ;
        // FIXME: global token doesn't exist, so opacity fits color
        opacity: 0.3;
      }
      .bai_board_handle button span {
        color: ${n.colorTextQuaternary} !important;
        padding-left: 5px !important;
      }
      .bai_board_header {
        padding: 0 !important;
        padding-top: ${n.padding-1}px !important;
      }
      .bai_board_resizer button span {
        color: ${n.colorTextQuaternary} !important;
      }
      .bai_board_container-override
        > div:first-child
        > div:nth-child(2)
        > div:first-child {
        padding: 0 !important;
      }
    `,disableResize:t`
      .bai_board_resizer {
        display: none !important;
      }
    `,disableMove:t`
      .bai_board_handle {
        display: none !important;
      }
      .bai_board_header {
        display: none !important;
      }
    `,boardItems:t`
      & > div:first-child {
        border-radius: var(--token-borderRadius) !important;
        background-color: var(--token-colorBgContainer) !important;
        border: 1px solid ${n.colorBorderSecondary} !important;
      }

      & > div:first-child > div:first-child > div:first-child {
        margin-bottom: var(--token-margin);
        background-color: var(--token-colorBgContainer) !important;
        position: absolute;
        z-index: 1;
      }
    `,disableBorder:t`
      & > div:first-child {
        border: none !important;
      }
    `}})),c=e=>{let{items:t,resizable:n=!1,movable:r=!1,bordered:i=!1,...c}=e;const{styles:u}=d();return(0,s.jsx)(o.A,{className:l()(u.board,!r&&u.disableMove,!n&&u.disableResize),empty:!0,renderItem:e=>{var t;return(0,s.jsx)(a.A,{className:l()(u.boardItems,!i&&u.disableBorder),i18nStrings:{dragHandleAriaLabel:"",dragHandleAriaDescription:"",resizeHandleAriaLabel:"",resizeHandleAriaDescription:""},...e,children:null===e||void 0===e||null===(t=e.data)||void 0===t?void 0:t.content},e.id)},items:t,i18nStrings:(()=>{const e=(e,t,n)=>[e,t.length>0?`Conflicts with ${t.map((e=>e.data.title)).join(", ")}.`:"",n.length>0?`Disturbed ${n.length} items.`:""].filter(Boolean).join(" ");return{liveAnnouncementDndStarted:e=>"resize"===e?"Resizing":"Dragging",liveAnnouncementDndItemReordered:t=>{const n=`column ${t.placement.x+1}`,o=`row ${t.placement.y+1}`;return e(`Item moved to ${"horizontal"===t.direction?n:o}.`,t.conflicts,t.disturbed)},liveAnnouncementDndItemResized:t=>{const n=t.isMinimalColumnsReached?" (minimal)":"",o=t.isMinimalRowsReached?" (minimal)":"",a="horizontal"===t.direction?`columns ${t.placement.width}${n}`:`rows ${t.placement.height}${o}`;return e(`Item resized to ${a}.`,t.conflicts,t.disturbed)},liveAnnouncementDndItemInserted:t=>{const n=`column ${t.placement.x+1}`,o=`row ${t.placement.y+1}`;return e(`Item inserted to ${n}, ${o}.`,t.conflicts,t.disturbed)},liveAnnouncementDndCommitted:e=>`${e} committed`,liveAnnouncementDndDiscarded:e=>`${e} discarded`,liveAnnouncementItemRemoved:t=>e(`Removed item ${t.item.data.title}.`,[],t.disturbed),navigationAriaLabel:"Board navigation",navigationAriaDescription:"Click on non-empty item to move focus over",navigationItemAriaLabel:e=>e?e.data.title:"Empty"}})(),...c})}},94252:(e,t,n)=>{n.d(t,{Ay:()=>b,tt:()=>h,uD:()=>p});var o=n(43224),a=n(40370),r=n(89881),i=n(85829),l=n(43749),s=n.n(l),d=(n(21481),n(51569)),c=n(66845);const u=1024,m=65535,p=e=>{let{inValid:t,value:n,...o}=e;return(0,c.jsx)(i.A,{color:!t&&g(n)?void 0:"red",...o})},g=e=>{if(v(e)){const t=e.split(":"),[n,o]=t.map((e=>parseInt(e)));return n>=u&&o<=m}return e===parseInt(e).toString()&&parseInt(e)>=u&&parseInt(e)<=m},v=e=>{const t=e.split(":");if(2===t.length){const[e,n]=t.map((e=>parseInt(e)));return e<=n}return!1},h=e=>s().flatten(s().map(e,(e=>v(e)?(e=>{const[t,n]=e.split(":").map((e=>parseInt(e)));return s().range(t,n+1)})(e):parseInt(e)))),b=e=>{let{name:t="ports",...n}=e;const{t:i}=(0,d.Bd)(),l=(0,o.CX)(),g=a.A.useFormInstance();return(0,c.jsx)(a.A.Item,{label:i("session.launcher.PreOpenPortTitle"),name:t,tooltip:(0,c.jsx)(d.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:i("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,t)=>h(t).length<=l._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(i("session.launcher.PreOpenPortMaxCountLimit",{count:l._config.maxCountForPreopenPorts})))}),()=>({validator:(e,t)=>s().every(t,(e=>parseInt(e).toString()===e||v(e)))?Promise.resolve():Promise.reject(new Error(i("session.launcher.InvalidPortFormat")))}),()=>({validator(e,t){const n=h(t);return s().every(n,(e=>e>=u&&e<=m))?Promise.resolve():Promise.reject(new Error(i("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,t){const n=h(t);return s().uniq(n).length===n.length?Promise.resolve():Promise.reject(new Error(i("session.launcher.DuplicatedPort")))}})],...n,children:(0,c.jsx)(r.A,{mode:"tags",tagRender:e=>{const n=s().filter(h(g.getFieldValue(t)),(t=>t===parseInt(e.value))).length>1;return(0,c.jsx)(p,{inValid:n,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})}},43352:(e,t,n)=>{n.d(t,{dM:()=>v,GQ:()=>h});const o=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],t=[{kind:"Variable",name:"id",variableName:"id"}],n={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useStartSessionCreationQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"BAINodeNotificationItemFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useStartSessionCreationQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[n,{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[o,a,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r,{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commit_status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"agent_id",storageKey:null},n,r,{alias:null,args:null,kind:"ScalarField",name:"cluster_idx",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_role",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_hostname",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"vfolder_mounts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_data",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"queue_position",storageKey:null}],type:"ComputeSessionNode",abstractKey:null},{kind:"InlineFragment",selections:[o,a],type:"VirtualFolderNode",abstractKey:null}],type:"Node",abstractKey:"__isNode"}],storageKey:null}]},params:{cacheID:"59d5f45d474680eabf0b7bad4126c41b",id:null,metadata:{},name:"useStartSessionCreationQuery",operationKind:"query",text:'query useStartSessionCreationQuery(\n  $id: GlobalIDField!\n) {\n  compute_session_node(id: $id) {\n    ...BAINodeNotificationItemFragment\n    id\n  }\n}\n\nfragment AppLauncherModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  service_ports\n  access_key\n}\n\nfragment BAIComputeSessionNodeNotificationItemFragment on ComputeSessionNode {\n  row_id\n  id\n  name\n  status\n  ...SessionActionButtonsFragment\n  ...SessionStatusTagFragment\n}\n\nfragment BAINodeNotificationItemFragment on Node {\n  __isNode: __typename\n  ... on ComputeSessionNode {\n    __typename\n    status\n    name\n    row_id\n    ...BAIComputeSessionNodeNotificationItemFragment\n  }\n  ... on VirtualFolderNode {\n    __typename\n    status\n  }\n  id\n}\n\nfragment ContainerCommitModalFragment on ComputeSessionNode {\n  id\n  name\n  row_id\n}\n\nfragment ContainerLogModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  status\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        id\n        row_id\n        container_id\n        cluster_idx\n        cluster_role\n        cluster_hostname\n      }\n    }\n  }\n}\n\nfragment SFTPConnectionInfoModalFragment on ComputeSessionNode {\n  row_id\n  vfolder_mounts\n}\n\nfragment SessionActionButtonsFragment on ComputeSessionNode {\n  id\n  row_id\n  type\n  status\n  access_key\n  service_ports\n  commit_status\n  user_id\n  ...TerminateSessionModalFragment\n  ...ContainerLogModalFragment\n  ...ContainerCommitModalFragment\n  ...AppLauncherModalFragment\n  ...SFTPConnectionInfoModalFragment\n  ...useBackendAIAppLauncherFragment\n}\n\nfragment SessionStatusTagFragment on ComputeSessionNode {\n  id\n  status\n  status_info\n  status_data\n  queue_position @since(version: "25.13.0")\n}\n\nfragment TerminateSessionModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  scaling_group\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        container_id\n        agent_id\n        id\n      }\n    }\n  }\n}\n\nfragment useBackendAIAppLauncherFragment on ComputeSessionNode {\n  name\n  row_id\n  vfolder_mounts\n}\n'}}}();o.hash="7a350248b5a833005f531bd8caa3adec";const a=o;var r=n(43224),i=n(41633),l=n(16507),s=n(45045),d=n(43749),c=n.n(d),u=n(51569),m=n(69775),p=n(94252),g=n(88144);const v={DUPLICATED_SESSION:"DUPLICATED_SESSION"},h=()=>{var e,t;const{t:n}=(0,u.Bd)(),o=(0,l.hd)(),{upsertNotification:d}=(0,i.js)(),h=(0,m.useRelayEnvironment)(),y=(0,r.CX)(),_=y.supports("mount-by-id"),S=null!==(e=null===y||void 0===y?void 0:y.supports("batch-timeout"))&&void 0!==e&&e,[x]=(0,l.zL)(),k={sessionType:"interactive",allocationPreset:"auto-select",hpcOptimization:{autoEnabled:!0},batch:{enabled:!1,command:void 0,scheduleDate:void 0,...S&&{timeoutEnabled:!1,timeout:void 0,timeoutUnit:"s"}},envvars:[],...(null===(t=y._config)||void 0===t?void 0:t.default_session_environment)&&{environments:f(y._config.default_session_environment)},...g.jh,resourceGroup:x||void 0},A=async e=>{var t,a,r,i,l,d,u,m,g,h,f;const x=e.environments.manual||e.environments.version,[k,A]=x?x.split("@"):["",""],w={sessionName:c().isEmpty(e.sessionName)?b():e.sessionName,kernelName:k,architecture:A,resources:{enqueueOnly:!0,group_name:null!==(t=e.owner)&&void 0!==t&&t.enabled?e.owner.project:o.name,domain:null!==(a=e.owner)&&void 0!==a&&a.enabled?e.owner.domainName:y._config.domainName,type:e.sessionType,cluster_mode:e.cluster_mode,cluster_size:e.cluster_size,maxWaitSeconds:15,...null!==(r=e.owner)&&void 0!==r&&r.enabled?{owner_access_key:e.owner.accesskey}:{},..."batch"===e.sessionType?{starts_at:e.batch.enabled?e.batch.scheduleDate:void 0,startupCommand:e.batch.command}:{},...e.bootstrap_script?{bootstrap_script:e.bootstrap_script}:{},...S&&null!==e&&void 0!==e&&null!==(i=e.batch)&&void 0!==i&&i.timeoutEnabled&&!c().isUndefined(null===e||void 0===e||null===(l=e.batch)||void 0===l?void 0:l.timeout)?{batchTimeout:c().toString(e.batch.timeout)+(null===e||void 0===e||null===(d=e.batch)||void 0===d?void 0:d.timeoutUnit)}:void 0,config:{resources:{cpu:e.resource.cpu,mem:e.resource.mem,...null!==(u=e.resource)&&void 0!==u&&u.acceleratorType&&null!==(m=e.resource)&&void 0!==m&&m.accelerator&&(null===(g=e.resource)||void 0===g?void 0:g.accelerator)>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0},scaling_group:null!==(h=e.owner)&&void 0!==h&&h.enabled?e.owner.project:e.resourceGroup,resource_opts:{shmem:e.resource.shmem},[_?"mount_ids":"mounts"]:e.mount_ids,[_?"mount_id_map":"mount_map"]:e.mount_id_map,environ:{...c().fromPairs(e.envvars.map((e=>[e.variable,e.value]))),...e.hpcOptimization.autoEnabled?{}:c().omit(e.hpcOptimization,"autoEnabled")},preopen_ports:(0,p.tt)(e.ports),...!y.supports("agent-select")||null!==y&&void 0!==y&&null!==(f=y._config)&&void 0!==f&&f.hideAgents||void 0===e.agent||c().isEqual(c().castArray(e.agent),["auto"])?void 0:{agent_list:c().chain(e.agent).castArray().filter((e=>!!e)).value()}}}},j=c().map(c().range(e.num_of_sessions||1),(t=>{const o=(e.num_of_sessions||1)>1?`${w.sessionName}-${(0,s.kX)()}-${t}`:w.sessionName;return y.createIfNotExists(w.kernelName,o,w.resources,void 0,w.architecture).then((e=>{if(null===e||void 0===e||!e.created){throw new Error(v.DUPLICATED_SESSION)}return e})).catch((e=>{var t;throw null!==e&&void 0!==e&&null!==(t=e.message)&&void 0!==t&&t.includes("The session already exists")?new Error(n("session.launcher.SessionAlreadyExists")):e}))}));return Promise.allSettled(j).then((async e=>c().groupBy(e,"status")))};return{startSession:A,startSessionWithDefault:e=>{const t=c().merge({},k,e);return A(t)},defaultFormValues:k,upsertSessionNotification:async(e,t)=>{const n=c().map(e,(e=>{const n=e.value;return(0,m.fetchQuery)(h,a,{id:(0,s.wc)("ComputeSessionNode",n.sessionId)}).toPromise().then((e=>{var o;const a=null!==(o=null===e||void 0===e?void 0:e.compute_session_node)&&void 0!==o?o:null;a&&d({key:`session-launcher:${n.sessionId}`,node:a,open:!0,duration:0,...null===t||void 0===t?void 0:t[0]},null===t||void 0===t?void 0:t[1])}))}));return Promise.allSettled(n)}}},b=()=>{let e="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<8;n++)e+=t.charAt(Math.floor(62*Math.random()));return e+"-session"},f=e=>e.includes(":")?{version:e}:{environment:e}},60292:(e,t,n)=>{n.r(t),n.d(t,{default:()=>re});var o=n(38050),a=n(43224),r=n(28380),i=n(54028),l=n(234),s=n(43749),d=n.n(s),c=n(98322),u=n(21481),m=n(66845);const p=e=>{let{...t}=e;const n=(0,a.CX)(),{token:o}=l.A.useToken(),{data:s}=(0,r.nj)({queryKey:["baiClient","service","get_announcement"],queryFn:()=>n.service.get_announcement()});return d().isEmpty(s.message)?"":(0,m.jsx)(i.A,{description:(0,m.jsx)("div",{style:{marginBottom:-1*o.marginSM},children:(0,m.jsx)(c.Ay,{options:{overrides:{p:{props:{style:{marginTop:0,marginBottom:o.marginSM}}}}},children:s.message+"<p></p>"})}),...t})};var g=n(9018),v=n(27200),h=n(40005),b=n(29040),f=n(12806),y=n(1139);const _={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"};var S=n(46361),x=function(e,t){return u.createElement(S.A,(0,y.A)({},e,{ref:t,icon:_}))};const k=u.forwardRef(x);var A=n(52688),w=n(73017),j=n(40370),F=n(60402),I=n(8334),C=n(45045),N=n(51569),$=n(43352);const R=new RegExp("^(https?)://([\\w./-]{1,}).ipynb$"),L=e=>{const t=(0,h.c)(57);let n,o;t[0]!==e?(({initialUrl:n,...o}=e),t[0]=e,t[1]=n,t[2]=o):(n=t[1],o=t[2]);const r=(0,u.useRef)(null),{t:i}=(0,N.Bd)(),l=A.A.useApp(),s=(0,a.f0)(),d=(0,a.CX)(),{startSessionWithDefault:c,upsertSessionNotification:p}=(0,$.GQ)(),{getErrorMessage:g}=(0,C.B7)();let v;t[3]!==l||t[4]!==d._config.default_import_environment||t[5]!==g||t[6]!==c||t[7]!==p||t[8]!==s?(v=async e=>{const t=(e=>(e=e.replace("/blob/","/")).replace("github.com","raw.githubusercontent.com"))(e),n=t.split("/").pop(),o={sessionName:`imported-notebook-${(0,C.kX)(5)}`,environments:{version:d._config.default_import_environment},bootstrap_script:"#!/bin/sh\ncurl -O "+t},a=await c(o);if(a.fulfilled&&a.fulfilled.length>0&&(p(a.fulfilled,[{extraData:{appName:"jupyter",urlPostfix:"&redirect=/notebooks/"+n}}]),s("/session")),null!==a&&void 0!==a&&a.rejected&&a.rejected.length>0){const e=a.rejected[0].reason;l.modal.error({title:null===e||void 0===e?void 0:e.title,content:g(e)})}},t[3]=l,t[4]=d._config.default_import_environment,t[5]=g,t[6]=c,t[7]=p,t[8]=s,t[9]=v):v=t[9];const b=v;let y,_,S,x,L,M,T,B,D,z,P,K,U,E,O,H,G,q,V,Q,X,W,J;return t[10]!==n?(y={url:n},t[10]=n,t[11]=y):y=t[11],t[12]!==b?(_=async e=>{await b(e.url)},t[12]=b,t[13]=_):_=t[13],t[14]!==i?(S=i("import.NotebookURL"),t[14]=i,t[15]=S):S=t[15],t[16]===Symbol.for("react.memo_cache_sentinel")?(x={required:!0},t[16]=x):x=t[16],t[17]!==i?(L=i("import.InvalidNotebookURL"),t[17]=i,t[18]=L):L=t[18],t[19]!==L?(M={pattern:R,message:L},t[19]=L,t[20]=M):M=t[20],t[21]===Symbol.for("react.memo_cache_sentinel")?(T={type:"string",max:2048},t[21]=T):T=t[21],t[22]!==M?(B=[x,M,T],t[22]=M,t[23]=B):B=t[23],t[24]===Symbol.for("react.memo_cache_sentinel")?(D={flex:1},t[24]=D):D=t[24],t[25]!==i?(z=i("import.NotebookURL"),t[25]=i,t[26]=z):z=t[26],t[27]!==z?(P=(0,m.jsx)(w.A,{placeholder:z}),t[27]=z,t[28]=P):P=t[28],t[29]!==P||t[30]!==S||t[31]!==B?(K=(0,m.jsx)(j.A.Item,{name:"url",label:S,rules:B,style:D,children:P}),t[29]=P,t[30]=S,t[31]=B,t[32]=K):K=t[32],t[33]===Symbol.for("react.memo_cache_sentinel")?(U=(0,m.jsx)(k,{}),t[33]=U):U=t[33],t[34]===Symbol.for("react.memo_cache_sentinel")?(E=async()=>{var e;null===(e=r.current)||void 0===e||e.submit()},t[34]=E):E=t[34],t[35]!==i?(O=i("import.GetAndRunNotebook"),t[35]=i,t[36]=O):O=t[36],t[37]!==O?(H=(0,m.jsx)(C.Fv,{icon:U,type:"primary",block:!0,action:E,children:O}),t[37]=O,t[38]=H):H=t[38],t[39]===Symbol.for("react.memo_cache_sentinel")?(G=(0,m.jsx)(F.A,{}),t[39]=G):G=t[39],t[40]!==i?(q=i("import.YouCanCreateNotebookCode"),t[40]=i,t[41]=q):q=t[41],t[42]!==q?(V=(0,m.jsx)(I.A.Paragraph,{children:q}),t[42]=q,t[43]=V):V=t[43],t[44]===Symbol.for("react.memo_cache_sentinel")?(Q=[["url"]],t[44]=Q):Q=t[44],t[45]!==i?(X=(0,m.jsx)(j.A.Item,{dependencies:Q,children:e=>{const{getFieldValue:t}=e,n=t("url")||"",o={url:n},a=encodeURIComponent(JSON.stringify(o));let r;globalThis.isElectron?r="https://cloud.backend.ai":(r=window.location.protocol+"//"+window.location.hostname,window.location.port&&(r=r+":"+window.location.port));const l=`${r}/start?type=url&data=${a}`,s=`<a href="${l}"><img src="https://www.backend.ai/assets/badge.svg" /></a>`,d=`[![Run on Backend.AI](https://www.backend.ai/assets/badge.svg)](${l})`,c=R.test(n)&&n.length<=2048,u=!n||!c;return(0,m.jsxs)(C.OO,{justify:"start",gap:"sm",wrap:"wrap",children:[(0,m.jsx)("img",{src:"/resources/badge.svg",style:{marginTop:5,marginBottom:5},width:"147"}),(0,m.jsxs)(C.OO,{gap:"sm",children:[(0,m.jsx)(f.A,{size:"small",copyable:{text:s},disabled:u,children:i("import.NotebookBadgeCodeHTML")}),(0,m.jsx)(f.A,{size:"small",copyable:{text:d},disabled:u,children:i("import.NotebookBadgeCodeMarkdown")})]})]})}}),t[45]=i,t[46]=X):X=t[46],t[47]!==V||t[48]!==X?(W=(0,m.jsxs)(C.OO,{direction:"column",wrap:"wrap","data-testid":"panel-notebook-badge-code-section",children:[G,V,X]}),t[47]=V,t[48]=X,t[49]=W):W=t[49],t[50]!==o||t[51]!==K||t[52]!==H||t[53]!==y||t[54]!==W||t[55]!==_?(J=(0,m.jsxs)(j.A,{ref:r,layout:"vertical",initialValues:y,onFinish:_,...o,children:[K,H,W]}),t[50]=o,t[51]=K,t[52]=H,t[53]=y,t[54]=W,t[55]=_,t[56]=J):J=t[56],J};L.displayName="ImportNotebookForm";const M=L;var T=n(2543),B=n(83143),D=n(104),z=n(41633);const P=(e,t,n)=>{const o=e=>`'${e.replace(/'/g,"'\\''")}'`;return["#!/bin/sh","# Create folder and download repository",`curl -o /tmp/repo.zip ${o(e)}`,`mkdir -p /home/work/${o(t)}`,`cd /home/work/${o(t)}`,"unzip -o /tmp/repo.zip",n?["# Move contents if in subfolder",`if [ -d ${o(n)} ]; then`,`  mv ${o(n)}/* .`,`  rm -rf ${o(n)}`,"fi"].join("\n"):void 0,"rm -f /tmp/repo.zip"].filter(Boolean).join("\n")},K=e=>{let{urlType:t,initialUrl:n,initialBranch:o,...r}=e;const i=(0,u.useRef)(null),l=(0,a.CX)(),{upsertNotification:s}=(0,z.js)(),d=A.A.useApp(),{getErrorMessage:c}=(0,C.B7)(),{t:p}=(0,N.Bd)(),g=(0,C.Gg)(),{startSessionWithDefault:v,upsertSessionNotification:h}=(0,$.GQ)(),b=async e=>{try{var n;const a="github"===t?await(async e=>{var t;const n=e.trim().replace(/\.git$/,"");let o;try{o=new URL(n)}catch(g){return B.Ay.error(p("import.InvalidGitHubURL")),null}const a=o.pathname.replace(/\/$/,""),r=a.split("/").filter(Boolean);if(r.length<2)return B.Ay.error(p("import.InvalidGitHubURL")),null;const i=r[0],l=r[1],s=a.match(/\/tree\/([\w./-]+)/);let d=null===s||void 0===s?void 0:s[1];if(!d){const e=`https://api.github.com/repos/${i}/${l}`;try{const t=await fetch(e);if(200!==t.status)return 404===t.status?(B.Ay.error(p("import.RepositoryNotFound")),null):(B.Ay.error(p("import.FailedToFetchRepositoryInformation")),null);d=(await t.json()).default_branch}catch(v){return B.Ay.error(p("import.FailedToFetchRepositoryInformation")),null}}const c=null!==(t=d)&&void 0!==t?t:"master",u=encodeURIComponent(c),m=c.replace(/\//g,"-");return{archiveUrl:`https://codeload.github.com/${i}/${l}/zip/${u}`,repoName:l,branch:c,extractedDirectory:`${l}-${m}`}})(e.url):"gitlab"===t?((e,t)=>{const n=e.trim().replace(/\.git$/,"");let o;try{o=new URL(n)}catch(g){return B.Ay.error(p("import.InvalidGitLabURL")),null}const a=o.pathname.replace(/\/$/,""),r=a.split("/").filter(Boolean);if(r.length<2)return B.Ay.error("Invalid GitLab URL. Must be a valid GitLab repository URL"),null;const i=r[r.length-1],l=a.match(/\/-\/tree\/([^/]+)/),s=null===l||void 0===l?void 0:l[1],d=t&&t.trim()||s||"master",c=encodeURIComponent(d),u=d.replace(/\//g,"-"),m=l?a.slice(0,a.indexOf("/-/tree/")):a;return{archiveUrl:`${o.origin}${m}/-/archive/${c}/${i}-${u}.zip`,repoName:i,branch:d,extractedDirectory:`${i}-${u}`}})(e.url,e.gitlabBranch):null;if(!a)return;const r=await g(a.repoName||"imported-from-repo"),u=await l.vfolder.create(r,e.storageHost,"",null!==(n=e.vfolder_usage_mode)&&void 0!==n?n:"general","rw");s({key:`folder-create-success-${u.id}`,icon:"folder",message:`${u.name}: ${p("data.folders.FolderCreated")}`,toText:p("data.folders.OpenAFolder"),to:{search:new URLSearchParams({folder:u.id}).toString()},open:!0,duration:0});const m={sessionName:`importing-files-to-${r}`,environments:{version:l._config.default_import_environment},sessionType:"batch",batch:{command:P(a.archiveUrl,r,a.extractedDirectory),enabled:!0},mount_ids:[u.id]},b=await v(m);var o;if(b.fulfilled&&b.fulfilled.length>0)h(b.fulfilled),null===(o=i.current)||void 0===o||o.resetFields();if(null!==b&&void 0!==b&&b.rejected&&b.rejected.length>0){const e=b.rejected[0].reason;d.modal.error({title:null===e||void 0===e?void 0:e.title,content:c(e)})}}catch(a){d.message.error(c(a))}};return(0,m.jsxs)(j.A,{ref:i,layout:"vertical",...r,initialValues:{vfolder_usage_mode:"general",url:n,gitlabBranch:o},children:[(0,m.jsx)(j.A.Item,{children:p("github"===t?"import.RepoWillBeFolder":"import.GitlabRepoWillBeFolder")}),(0,m.jsx)(j.A.Item,{name:"url",label:p("github"==t?"import.GitHubURL":"import.GitlabURL"),rules:[{required:!0},{type:"string",max:2048},{pattern:"github"===t?/^(https?):\/\/github\.com\/([\w./-]{1,})$/:/^(https?):\/\/gitlab\.com\/([\w./-]{1,})$/,message:p("import.WrongURLType")}],children:(0,m.jsx)(w.A,{})}),"gitlab"===t&&(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(j.A.Item,{name:"gitlabBranch",label:p("import.GitlabDefaultBranch"),children:(0,m.jsx)(w.A,{placeholder:"master",maxLength:200})})}),(0,m.jsx)(j.A.Item,{name:"storageHost",label:p("import.StorageHost"),rules:[{required:!0}],children:(0,m.jsx)(T.A,{showUsageStatus:!0,autoSelectType:"usage"})}),(0,m.jsx)(j.A.Item,{label:p("import.VFolderUsageMode"),name:"vfolder_usage_mode",hidden:!0!==l._config.enableModelFolders,required:!0,children:(0,m.jsxs)(D.Ay.Group,{children:[(0,m.jsx)(D.Ay,{value:"general","data-testid":"general-usage-mode",children:p("data.General")}),(0,m.jsx)(D.Ay,{value:"model","data-testid":"model-usage-mode",children:p("data.Models")})]})}),(0,m.jsx)(j.A.Item,{children:(0,m.jsx)(C.Fv,{icon:(0,m.jsx)(k,{}),action:async()=>{try{var e;const t=await(null===(e=i.current)||void 0===e?void 0:e.validateFields());if(!t)return;await b(t)}catch(t){console.error("Form validation failed:",t)}},block:!0,type:"primary",children:p("import.GetToFolder")})})]})};const U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"}}]},name:"github",theme:"outlined"};var E=function(e,t){return u.createElement(S.A,(0,y.A)({},e,{ref:t,icon:U}))};const O=u.forwardRef(E);const H={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M913.9 552.2L805 181.4v-.1c-7.6-22.9-25.7-36.5-48.3-36.5-23.4 0-42.5 13.5-49.7 35.2l-71.4 213H388.8l-71.4-213c-7.2-21.7-26.3-35.2-49.7-35.2-23.1 0-42.5 14.8-48.4 36.6L110.5 552.2c-4.4 14.7 1.2 31.4 13.5 40.7l368.5 276.4c2.6 3.6 6.2 6.3 10.4 7.8l8.6 6.4 8.5-6.4c4.9-1.7 9-4.7 11.9-8.9l368.4-275.4c12.4-9.2 18-25.9 13.6-40.6zM751.7 193.4c1-1.8 2.9-1.9 3.5-1.9 1.1 0 2.5.3 3.4 3L818 394.3H684.5l67.2-200.9zm-487.4 1c.9-2.6 2.3-2.9 3.4-2.9 2.7 0 2.9.1 3.4 1.7l67.3 201.2H206.5l57.8-200zM158.8 558.7l28.2-97.3 202.4 270.2-230.6-172.9zm73.9-116.4h122.1l90.8 284.3-212.9-284.3zM512.9 776L405.7 442.3H620L512.9 776zm157.9-333.7h119.5L580 723.1l90.8-280.8zm-40.7 293.9l207.3-276.7 29.5 99.2-236.8 177.5z"}}]},name:"gitlab",theme:"outlined"};var G=function(e,t){return u.createElement(S.A,(0,y.A)({},e,{ref:t,icon:H}))};const q=u.forwardRef(G),V=e=>{var t,n,o,a,r;const i=(0,h.c)(49);let l,s,d;i[0]!==e?(({initialTab:s,initialData:l,...d}=e),i[0]=e,i[1]=l,i[2]=s,i[3]=d):(l=i[1],s=i[2],d=i[3]);const{t:c}=(0,N.Bd)();let u;i[4]!==c?(u=c("start.StartFromURL"),i[4]=c,i[5]=u):u=i[5];const p=null===(t=l)||void 0===t?void 0:t.url;let g,v,f,y,_;i[6]!==p?(g=(0,m.jsx)(M,{initialUrl:p}),i[6]=p,i[7]=g):g=i[7],i[8]===Symbol.for("react.memo_cache_sentinel")?(v=(0,m.jsx)(C.lI,{}),i[8]=v):v=i[8],i[9]!==c?(f=c("import.ImportNotebook"),i[9]=c,i[10]=f):f=i[10],i[11]!==f?(y=(0,m.jsxs)(C.OO,{gap:"xs",children:[v," ",f]}),i[11]=f,i[12]=y):y=i[12],i[13]!==g||i[14]!==y?(_={key:"notebook",children:g,label:y},i[13]=g,i[14]=y,i[15]=_):_=i[15];const S=null===(n=l)||void 0===n?void 0:n.url,x=null===(o=l)||void 0===o?void 0:o.branch;let k,A,w,j,F;i[16]!==S||i[17]!==x?(k=(0,m.jsx)(K,{urlType:"github",initialUrl:S,initialBranch:x}),i[16]=S,i[17]=x,i[18]=k):k=i[18],i[19]===Symbol.for("react.memo_cache_sentinel")?(A=(0,m.jsx)(O,{style:{display:"inline"}}),i[19]=A):A=i[19],i[20]!==c?(w=c("import.ImportGithubRepo"),i[20]=c,i[21]=w):w=i[21],i[22]!==w?(j=(0,m.jsxs)(C.OO,{gap:"xs",children:[A,w]}),i[22]=w,i[23]=j):j=i[23],i[24]!==k||i[25]!==j?(F={key:"github",children:k,label:j},i[24]=k,i[25]=j,i[26]=F):F=i[26];const I=null===(a=l)||void 0===a?void 0:a.url,$=null===(r=l)||void 0===r?void 0:r.branch;let R,L,T,B,D,z,P,U;return i[27]!==I||i[28]!==$?(R=(0,m.jsx)(K,{urlType:"gitlab",initialUrl:I,initialBranch:$}),i[27]=I,i[28]=$,i[29]=R):R=i[29],i[30]===Symbol.for("react.memo_cache_sentinel")?(L=(0,m.jsx)(q,{style:{display:"inline"}}),i[30]=L):L=i[30],i[31]!==c?(T=c("import.ImportGitlabRepo"),i[31]=c,i[32]=T):T=i[32],i[33]!==T?(B=(0,m.jsxs)(C.OO,{gap:"xs",children:[L,T]}),i[33]=T,i[34]=B):B=i[34],i[35]!==R||i[36]!==B?(D={key:"gitlab",children:R,label:B},i[35]=R,i[36]=B,i[37]=D):D=i[37],i[38]!==F||i[39]!==D||i[40]!==_?(z=[_,F,D],i[38]=F,i[39]=D,i[40]=_,i[41]=z):z=i[41],i[42]!==s||i[43]!==z?(P=(0,m.jsx)(b.A,{defaultActiveKey:s,items:z}),i[42]=s,i[43]=z,i[44]=P):P=i[44],i[45]!==d||i[46]!==u||i[47]!==P?(U=(0,m.jsx)(C.Ib,{title:u,width:800,footer:null,...d,children:P}),i[45]=d,i[46]=u,i[47]=P,i[48]=U):U=i[48],U};var Q=n(60370),X=n(27881),W=n(73016);const J=e=>{var t;let{...n}=e;const o=(0,Q.M)(),a=(null===(t=(0,u.useContext)(W.Ay.ConfigContext).theme)||void 0===t?void 0:t.algorithm)===l.A.darkAlgorithm,r={token:{colorPrimary:(0,X.A)().secondary}};return(0,m.jsx)(W.Ay,{...n,theme:{...a?d().merge({},null===o||void 0===o?void 0:o.dark,r,n.theme):d().merge({},null===o||void 0===o?void 0:o.light,r,n.theme),algorithm:a?l.A.darkAlgorithm:l.A.defaultAlgorithm}})};var Y=n(497);const Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zm52 132H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200zM424 712H296V584c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v128H104c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h128v128c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V776h128c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"appstore-add",theme:"outlined"};var ee=function(e,t){return u.createElement(S.A,(0,y.A)({},e,{ref:t,icon:Z}))};const te=u.forwardRef(ee);var ne=n(46746),oe=n(77703),ae=n(7927);const re=()=>{var e,t,n,r,l,s;const{t:c}=(0,N.Bd)(),h=(0,a.CX)(),b=null!==(e=null===h||void 0===h||null===(t=h._config)||void 0===t?void 0:t.blockList)&&void 0!==e?e:[],f=null!==(n=null===h||void 0===h||null===(r=h._config)||void 0===r?void 0:r.inactiveList)&&void 0!==n?n:[],y=null!==(l=null===h||void 0===h||null===(s=h._config)||void 0===s?void 0:s.enableModelFolders)&&void 0!==l&&l,_=(0,a.f0)(),[S,x]=(0,u.useState)(!1),[k,A]=(0,u.useState)(!1),w=(0,ne.zy)(),[j,F]=(0,u.useState)(),{upsertNotification:I}=(0,z.js)(),[$]=(0,oe.A)(),[R,L]=(0,ae.useQueryParams)({type:(0,ae.withDefault)(ae.StringParam,void 0),data:(0,ae.withDefault)(ae.JsonParam,void 0)}),M=(0,u.useMemo)((()=>{const e=w.search.substring(1);return R.type||!e||e.includes("=")?null:e}),[w.search,R.type]),T=(0,u.useEffectEvent)((()=>{if("url"===R.type&&R.data)F({initialTab:"notebook",initialData:R.data}),A(!0),L({type:void 0,data:void 0});else if(M){F({initialTab:"notebook",initialData:{url:`https://github.com/${M}`}}),A(!0),L({type:void 0,data:void 0},"replace")}}));(0,u.useEffect)((()=>{T()}),[]),(0,u.useEffect)((()=>{$.length<=0||I({key:"invitedFolders",message:c("data.InvitedFoldersTooltip",{count:$.length}),to:{search:new URLSearchParams({invitation:"true"}).toString()},open:!0,duration:0})}),[$.length,c,I]);const B=(0,C.YM)([{id:"createFolder",requiredMenuKey:"data",rowSpan:3,columnSpan:1,columnOffset:{6:0,4:0},data:{content:(0,m.jsx)(o.A,{title:c("start.CreateFolder"),description:c("start.CreateFolderDesc"),buttonText:c("start.button.CreateFolder"),icon:(0,m.jsx)(C.cQ,{}),onClick:()=>x(!0)})}},{id:"startSession",requiredMenuKey:"job",rowSpan:3,columnSpan:1,columnOffset:{6:1,4:1},data:{content:(0,m.jsx)(o.A,{title:c("start.StartSession"),description:c("start.StartSessionDesc"),buttonText:c("start.button.StartSession"),icon:(0,m.jsx)(C.Q2,{}),onClick:()=>_("/session/start")})}},{id:"startBatchSession",requiredMenuKey:"job",rowSpan:3,columnSpan:1,columnOffset:{6:2,4:2},data:{content:(0,m.jsx)(o.A,{title:c("start.StartBatchSession"),description:c("start.StartBatchSessionDesc"),buttonText:c("start.button.StartSession"),icon:(0,m.jsx)(C.y1,{}),onClick:()=>{const e=new URLSearchParams;e.set("step","0"),e.set("formValues",JSON.stringify({sessionType:"batch"})),_(`/session/start?${e.toString()}`)}})}},y&&{id:"modelService",rowSpan:3,requiredMenuKey:"serving",columnSpan:1,columnOffset:{6:0,4:0},data:{content:(0,m.jsx)(J,{children:(0,m.jsx)(o.A,{title:c("start.ModelService"),description:c("start.ModelServiceDesc"),buttonText:c("start.button.ModelService"),icon:(0,m.jsx)(te,{}),onClick:()=>_("/service/start")})})}},{id:"importFromURL",requiredMenuKey:"import",rowSpan:3,columnSpan:1,columnOffset:{6:3,4:3},data:{content:(0,m.jsx)(o.A,{title:c("start.StartFromURL"),description:c("start.StartFromURLDesc"),buttonText:c("start.button.StartNow"),icon:(0,m.jsx)(C.xe,{}),onClick:()=>{A(!0)}})}}]).filter((e=>!d().includes([...b,...f],e.requiredMenuKey))),[D,P]=(0,Y.q)("start_page_board_items"),K=d().filter(B,(e=>!d().find(D,(t=>t.id===e.id)))),U=[...(0,C.YM)(d().map(D,(e=>{var t;const n=null===(t=d().find(B,(t=>t.id===e.id)))||void 0===t?void 0:t.data;return n?{...e,data:n}:void 0}))),...K];return(0,m.jsxs)(C.OO,{direction:"column",gap:"md",align:"stretch",children:[(0,m.jsx)(p,{showIcon:!0,closable:!0}),(0,m.jsx)(g.A,{movable:!0,items:U,onItemsChange:e=>{const t=[...e.detail.items];P(d().map(t,(e=>d().omit(e,"data"))))}}),d().isEmpty(U)&&(0,m.jsx)(i.A,{type:"info",description:c("start.NoStartItems"),showIcon:!0}),(0,m.jsx)(C.Xc,{children:(0,m.jsx)(v.A,{open:S,onRequestClose:e=>{x(!1),e&&_("/data")}})}),(0,m.jsx)(C.Xc,{children:(0,m.jsx)(V,{open:k,onCancel:()=>{A(!1),F(void 0)},initialTab:null===j||void 0===j?void 0:j.initialTab,initialData:null===j||void 0===j?void 0:j.initialData})})]})}}}]);
//# sourceMappingURL=292.73d50593.chunk.js.map