"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[4971],{24971:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var s=n(56276),i=n(48880),r=n(40690),l=n(62378),a=n(74939),c=n(23901),o=n(21590),h=n(83918),u=n(58021),f=n(16952),_=n(42338),d=n(17534),g=n(62962),m=n(89374);const b=e=>{let{status:t="default"}=e;const{t:n}=(0,g.Bd)();return(0,m.jsx)(d.Suspense,{fallback:(0,m.jsx)(f.A,{indicator:(0,m.jsx)(c.A,{spin:!0})}),children:(0,m.jsx)(_.A,{color:(e=>{switch(e){case"default":case"finished":default:return"default";case"processing":return"processing";case"error":return"error";case"success":return"success"}})(t),icon:"processing"===t?(0,m.jsx)(c.A,{spin:!0}):"finished"===t?(0,m.jsx)(o.A,{}):"error"===t?(0,m.jsx)(h.A,{}):(0,m.jsx)(u.A,{}),children:n("processing"===t?"modelService.Processing":"finished"===t?"modelService.Finished":"error"===t?"modelService.Error":"modelService.Ready")})})};var p,x,S,y,v=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e};!function(e){e[e.EOS=0]="EOS",e[e.Text=1]="Text",e[e.Incomplete=2]="Incomplete",e[e.ESC=3]="ESC",e[e.Unknown=4]="Unknown",e[e.SGR=5]="SGR",e[e.OSCURL=6]="OSCURL"}(p||(p={}));class k{constructor(){this.VERSION="6.0.6",this.setup_palettes(),this._use_classes=!1,this.bold=!1,this.faint=!1,this.italic=!1,this.underline=!1,this.fg=this.bg=null,this._buffer="",this._url_allowlist={http:1,https:1},this._escape_html=!0,this.boldStyle="font-weight:bold",this.faintStyle="opacity:0.7",this.italicStyle="font-style:italic",this.underlineStyle="text-decoration:underline"}set use_classes(e){this._use_classes=e}get use_classes(){return this._use_classes}set url_allowlist(e){this._url_allowlist=e}get url_allowlist(){return this._url_allowlist}set escape_html(e){this._escape_html=e}get escape_html(){return this._escape_html}set boldStyle(e){this._boldStyle=e}get boldStyle(){return this._boldStyle}set faintStyle(e){this._faintStyle=e}get faintStyle(){return this._faintStyle}set italicStyle(e){this._italicStyle=e}get italicStyle(){return this._italicStyle}set underlineStyle(e){this._underlineStyle=e}get underlineStyle(){return this._underlineStyle}setup_palettes(){this.ansi_colors=[[{rgb:[0,0,0],class_name:"ansi-black"},{rgb:[187,0,0],class_name:"ansi-red"},{rgb:[0,187,0],class_name:"ansi-green"},{rgb:[187,187,0],class_name:"ansi-yellow"},{rgb:[0,0,187],class_name:"ansi-blue"},{rgb:[187,0,187],class_name:"ansi-magenta"},{rgb:[0,187,187],class_name:"ansi-cyan"},{rgb:[255,255,255],class_name:"ansi-white"}],[{rgb:[85,85,85],class_name:"ansi-bright-black"},{rgb:[255,85,85],class_name:"ansi-bright-red"},{rgb:[0,255,0],class_name:"ansi-bright-green"},{rgb:[255,255,85],class_name:"ansi-bright-yellow"},{rgb:[85,85,255],class_name:"ansi-bright-blue"},{rgb:[255,85,255],class_name:"ansi-bright-magenta"},{rgb:[85,255,255],class_name:"ansi-bright-cyan"},{rgb:[255,255,255],class_name:"ansi-bright-white"}]],this.palette_256=[],this.ansi_colors.forEach((e=>{e.forEach((e=>{this.palette_256.push(e)}))}));let e=[0,95,135,175,215,255];for(let n=0;n<6;++n)for(let t=0;t<6;++t)for(let s=0;s<6;++s){let i={rgb:[e[n],e[t],e[s]],class_name:"truecolor"};this.palette_256.push(i)}let t=8;for(let n=0;n<24;++n,t+=10){let e={rgb:[t,t,t],class_name:"truecolor"};this.palette_256.push(e)}}escape_txt_for_html(e){return this._escape_html?e.replace(/[&<>"']/gm,(e=>"&"===e?"&amp;":"<"===e?"&lt;":">"===e?"&gt;":'"'===e?"&quot;":"'"===e?"&#x27;":void 0)):e}append_buffer(e){var t=this._buffer+e;this._buffer=t}get_next_packet(){var e={kind:p.EOS,text:"",url:""},t=this._buffer.length;if(0==t)return e;var n=this._buffer.indexOf("\x1b");if(-1==n)return e.kind=p.Text,e.text=this._buffer,this._buffer="",e;if(n>0)return e.kind=p.Text,e.text=this._buffer.slice(0,n),this._buffer=this._buffer.slice(n),e;if(0==n){if(t<3)return e.kind=p.Incomplete,e;var s=this._buffer.charAt(1);if("["!=s&&"]"!=s&&"("!=s)return e.kind=p.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e;if("["==s){this._csi_regex||(this._csi_regex=w(x||(x=v(["\n                        ^                           # beginning of line\n                                                    #\n                                                    # First attempt\n                        (?:                         # legal sequence\n                          \x1b[                      # CSI\n                          ([<-?]?)              # private-mode char\n                          ([d;]*)                    # any digits or semicolons\n                          ([ -/]?               # an intermediate modifier\n                          [@-~])                # the command\n                        )\n                        |                           # alternate (second attempt)\n                        (?:                         # illegal sequence\n                          \x1b[                      # CSI\n                          [ -~]*                # anything legal\n                          ([\0-\x1f:])              # anything illegal\n                        )\n                    "],["\n                        ^                           # beginning of line\n                                                    #\n                                                    # First attempt\n                        (?:                         # legal sequence\n                          \\x1b\\[                      # CSI\n                          ([\\x3c-\\x3f]?)              # private-mode char\n                          ([\\d;]*)                    # any digits or semicolons\n                          ([\\x20-\\x2f]?               # an intermediate modifier\n                          [\\x40-\\x7e])                # the command\n                        )\n                        |                           # alternate (second attempt)\n                        (?:                         # illegal sequence\n                          \\x1b\\[                      # CSI\n                          [\\x20-\\x7e]*                # anything legal\n                          ([\\x00-\\x1f:])              # anything illegal\n                        )\n                    "]))));let t=this._buffer.match(this._csi_regex);if(null===t)return e.kind=p.Incomplete,e;if(t[4])return e.kind=p.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e;""!=t[1]||"m"!=t[3]?e.kind=p.Unknown:e.kind=p.SGR,e.text=t[2];var i=t[0].length;return this._buffer=this._buffer.slice(i),e}if("]"==s){if(t<4)return e.kind=p.Incomplete,e;if("8"!=this._buffer.charAt(2)||";"!=this._buffer.charAt(3))return e.kind=p.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e;this._osc_st||(this._osc_st=function(e){let t=e.raw[0],n=/^\s+|\s+\n|\s*#[\s\S]*?\n|\n/gm,s=t.replace(n,"");return new RegExp(s,"g")}(S||(S=v(["\n                        (?:                         # legal sequence\n                          (\x1b\\)                    # ESC                           |                           # alternate\n                          (\x07)                      # BEL (what xterm did)\n                        )\n                        |                           # alternate (second attempt)\n                        (                           # illegal sequence\n                          [\0-\x06]                 # anything illegal\n                          |                           # alternate\n                          [\b-\x1a]                 # anything illegal\n                          |                           # alternate\n                          [\x1c-\x1f]                 # anything illegal\n                        )\n                    "],["\n                        (?:                         # legal sequence\n                          (\\x1b\\\\)                    # ESC \\\n                          |                           # alternate\n                          (\\x07)                      # BEL (what xterm did)\n                        )\n                        |                           # alternate (second attempt)\n                        (                           # illegal sequence\n                          [\\x00-\\x06]                 # anything illegal\n                          |                           # alternate\n                          [\\x08-\\x1a]                 # anything illegal\n                          |                           # alternate\n                          [\\x1c-\\x1f]                 # anything illegal\n                        )\n                    "])))),this._osc_st.lastIndex=0;{let t=this._osc_st.exec(this._buffer);if(null===t)return e.kind=p.Incomplete,e;if(t[3])return e.kind=p.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e}{let t=this._osc_st.exec(this._buffer);if(null===t)return e.kind=p.Incomplete,e;if(t[3])return e.kind=p.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e}this._osc_regex||(this._osc_regex=w(y||(y=v(["\n                        ^                           # beginning of line\n                                                    #\n                        \x1b]8;                    # OSC Hyperlink\n                        [ -:<-~]*       # params (excluding ;)\n                        ;                           # end of params\n                        ([!-~]{0,512})        # URL capture\n                        (?:                         # ST\n                          (?:\x1b\\)                  # ESC                           |                           # alternate\n                          (?:\x07)                    # BEL (what xterm did)\n                        )\n                        ([ -~]+)              # TEXT capture\n                        \x1b]8;;                   # OSC Hyperlink End\n                        (?:                         # ST\n                          (?:\x1b\\)                  # ESC                           |                           # alternate\n                          (?:\x07)                    # BEL (what xterm did)\n                        )\n                    "],["\n                        ^                           # beginning of line\n                                                    #\n                        \\x1b\\]8;                    # OSC Hyperlink\n                        [\\x20-\\x3a\\x3c-\\x7e]*       # params (excluding ;)\n                        ;                           # end of params\n                        ([\\x21-\\x7e]{0,512})        # URL capture\n                        (?:                         # ST\n                          (?:\\x1b\\\\)                  # ESC \\\n                          |                           # alternate\n                          (?:\\x07)                    # BEL (what xterm did)\n                        )\n                        ([\\x20-\\x7e]+)              # TEXT capture\n                        \\x1b\\]8;;                   # OSC Hyperlink End\n                        (?:                         # ST\n                          (?:\\x1b\\\\)                  # ESC \\\n                          |                           # alternate\n                          (?:\\x07)                    # BEL (what xterm did)\n                        )\n                    "]))));let n=this._buffer.match(this._osc_regex);if(null===n)return e.kind=p.ESC,e.text=this._buffer.slice(0,1),this._buffer=this._buffer.slice(1),e;e.kind=p.OSCURL,e.url=n[1],e.text=n[2];i=n[0].length;return this._buffer=this._buffer.slice(i),e}if("("==s)return e.kind=p.Unknown,this._buffer=this._buffer.slice(3),e}}ansi_to_html(e){this.append_buffer(e);for(var t=[];;){var n=this.get_next_packet();if(n.kind==p.EOS||n.kind==p.Incomplete)break;n.kind!=p.ESC&&n.kind!=p.Unknown&&(n.kind==p.Text?t.push(this.transform_to_html(this.with_state(n))):n.kind==p.SGR?this.process_ansi(n):n.kind==p.OSCURL&&t.push(this.process_hyperlink(n)))}return t.join("")}with_state(e){return{bold:this.bold,faint:this.faint,italic:this.italic,underline:this.underline,fg:this.fg,bg:this.bg,text:e.text}}process_ansi(e){let t=e.text.split(";");for(;t.length>0;){let e=t.shift(),n=parseInt(e,10);if(isNaN(n)||0===n)this.fg=null,this.bg=null,this.bold=!1,this.faint=!1,this.italic=!1,this.underline=!1;else if(1===n)this.bold=!0;else if(2===n)this.faint=!0;else if(3===n)this.italic=!0;else if(4===n)this.underline=!0;else if(21===n)this.bold=!1;else if(22===n)this.faint=!1,this.bold=!1;else if(23===n)this.italic=!1;else if(24===n)this.underline=!1;else if(39===n)this.fg=null;else if(49===n)this.bg=null;else if(n>=30&&n<38)this.fg=this.ansi_colors[0][n-30];else if(n>=40&&n<48)this.bg=this.ansi_colors[0][n-40];else if(n>=90&&n<98)this.fg=this.ansi_colors[1][n-90];else if(n>=100&&n<108)this.bg=this.ansi_colors[1][n-100];else if((38===n||48===n)&&t.length>0){let e=38===n,s=t.shift();if("5"===s&&t.length>0){let n=parseInt(t.shift(),10);n>=0&&n<=255&&(e?this.fg=this.palette_256[n]:this.bg=this.palette_256[n])}if("2"===s&&t.length>2){let n=parseInt(t.shift(),10),s=parseInt(t.shift(),10),i=parseInt(t.shift(),10);if(n>=0&&n<=255&&s>=0&&s<=255&&i>=0&&i<=255){let t={rgb:[n,s,i],class_name:"truecolor"};e?this.fg=t:this.bg=t}}}}}transform_to_html(e){let t=e.text;if(0===t.length)return t;if(t=this.escape_txt_for_html(t),!e.bold&&!e.italic&&!e.faint&&!e.underline&&null===e.fg&&null===e.bg)return t;let n=[],s=[],i=e.fg,r=e.bg;e.bold&&n.push(this._boldStyle),e.faint&&n.push(this._faintStyle),e.italic&&n.push(this._italicStyle),e.underline&&n.push(this._underlineStyle),this._use_classes?(i&&("truecolor"!==i.class_name?s.push("".concat(i.class_name,"-fg")):n.push("color:rgb(".concat(i.rgb.join(","),")"))),r&&("truecolor"!==r.class_name?s.push("".concat(r.class_name,"-bg")):n.push("background-color:rgb(".concat(r.rgb.join(","),")")))):(i&&n.push("color:rgb(".concat(i.rgb.join(","),")")),r&&n.push("background-color:rgb(".concat(r.rgb,")")));let l="",a="";return s.length&&(l=' class="'.concat(s.join(" "),'"')),n.length&&(a=' style="'.concat(n.join(";"),'"')),"<span".concat(a).concat(l,">").concat(t,"</span>")}process_hyperlink(e){let t=e.url.split(":");return t.length<1?"":this._url_allowlist[t[0]]?'<a href="'.concat(this.escape_txt_for_html(e.url),'">').concat(this.escape_txt_for_html(e.text),"</a>"):""}}function w(e){let t=e.raw[0].replace(/^\s+|\s+\n|\s*#[\s\S]*?\n|\n/gm,"");return new RegExp(t)}var E=n(76591),C=n(66597),j=n(67631),O=n(8905),T=n.n(O),A=n(17749),I=n(47699),R=n.n(I);const L=e=>{let{serviceData:t}=e;const{t:n}=(0,g.Bd)(),{token:c}=E.A.useToken(),{message:o}=C.A.useApp(),{getErrorMessage:h}=(0,j.B7)(),[u,f]=(0,d.useState)(""),[p,x]=(0,d.useState)(""),[S,y]=(0,d.useState)("Before validation"),v=(0,r.CX)(),w=(0,r.eZ)();async function O(e){return v.get_logs(e,v._config.accessKey).then((e=>(new k).ansi_to_html(e.result.logs)))}const I=(0,l.ET)({mutationFn:e=>{var t,n,r,l,a,c,o,h;const u="".concat(null===(t=e.environments.image)||void 0===t?void 0:t.registry,"/").concat(null!==(n=null===(r=e.environments.image)||void 0===r?void 0:r.namespace)&&void 0!==n?n:null===(l=e.environments.image)||void 0===l?void 0:l.name,":").concat(null===(a=e.environments.image)||void 0===a?void 0:a.tag),f=(0,s.A)((0,s.A)({name:e.serviceName},v.supports("replicas")?{replicas:e.replicas}:{desired_session_count:e.replicas}),{},{image:u,runtime_variant:e.runtimeVariant,architecture:null===(c=e.environments.image)||void 0===c?void 0:c.architecture,group:v.current_group,domain:w,cluster_size:e.cluster_size,cluster_mode:e.cluster_mode,open_to_public:e.openToPublic,config:(0,s.A)({model:e.vFolderID,model_version:1,extra_mounts:R().reduce(e.mount_ids,((t,n)=>(t[n]=(0,s.A)((0,s.A)({},e.mount_id_map[n]&&{mount_destination:e.mount_id_map[n]}),{},{type:"bind"}),t)),{}),model_definition_path:e.modelDefinitionPath,model_mount_destination:e.modelMountDestination,environ:{},scaling_group:e.resourceGroup,resources:(0,s.A)({cpu:e.resource.cpu.toString(),mem:e.resource.mem},null!==(o=e.resource)&&void 0!==o&&o.acceleratorType&&null!==(h=e.resource)&&void 0!==h&&h.accelerator&&e.resource.accelerator>0?{[e.resource.acceleratorType]:e.resource.accelerator.toString()}:void 0)},e.resource.shmem&&{shmem:(0,i.Mh)(e.resource.mem,"4g")>0&&(0,i.Mh)(e.resource.shmem,"1g")<0?"1g":e.resource.shmem})});return(0,i.hu)({method:"POST",url:"/services/_/try",body:f,client:v})}}),L=(0,d.useRef)(!1);return(0,d.useEffect)((()=>{if(L.current)return;const e=T()().format("LLL");I.mutateAsync(t).then((t=>{y(e);const s=setTimeout((()=>{f("error"),o.error(n("modelService.CannotValidateNow"))}),6e4),r={onUpdated:async(e,t)=>{try{f("processing");const i=JSON.parse(e.message);if("session_cancelled"===i.event)f("error"),o.error(n("modelService.CannotValidateNow")),null===t||void 0===t||t.abort(),clearTimeout(s);else if("session_started"===i.event||"session_terminated"===i.event){const e=await O(i.session_id);x(e)}}catch(i){return}},onDone:()=>{f("finished"),clearTimeout(s)},onFailed:async e=>{const t=await O(JSON.parse(e.message).session_id).catch((()=>{}));throw null!==t&&void 0!==t||x(t),f("error"),new Error(JSON.parse(e.message).event)},onTaskCancelled:e=>{throw f("error"),new Error(JSON.parse(e.message).event)},onTaskFailed:e=>{throw f("error"),new Error(JSON.parse(e.message).event)}};(0,i.OR)(t.task_id,r)})).catch((e=>{o.error(h(e)||n("modelService.FormValidationFailed"))})).finally((()=>{L.current=!1})),L.current=!0}),[]),(0,m.jsxs)(d.Suspense,{fallback:(0,m.jsx)(a.A,{}),children:[(0,m.jsxs)(j.OO,{direction:"row",justify:"between",align:"center",children:[(0,m.jsx)("h3",{children:n("modelService.Result")}),(0,m.jsx)(b,{status:u})]}),(0,m.jsxs)(j.OO,{direction:"row",justify:"between",align:"center",children:[(0,m.jsx)("h3",{children:n("modelService.TimeStamp")}),(0,m.jsx)(_.A,{children:S})]}),(0,m.jsx)("h3",{children:n("modelService.SeeContainerLogs")}),(0,m.jsx)(j.OO,{direction:"column",justify:"start",align:"start",style:{overflowX:"scroll",color:"white",backgroundColor:"black",padding:c.paddingSM,borderRadius:c.borderRadius},children:(0,m.jsx)("pre",{dangerouslySetInnerHTML:{__html:A.A.sanitize(p)}})})]})}}}]);
//# sourceMappingURL=4971.73ae699f.chunk.js.map