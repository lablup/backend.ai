"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[20],{14749:function(e,n,a){var l,i=a(1413),t=a(29439),r=a(44925),o=a(40406),s=a(50164),u=a(77758),d=a(99277),c=a(44036),m=a(57054),p=a(88464),g=a(39883),f=a(42272),v=a(70389),y=a(38818),k=(a(4519),a(81748)),S=a(87112),b=a(16980),h=a(2556),F=["userFrgmt","onRequestClose"];n.Z=function(e){var n=e.userFrgmt,Z=void 0===n?null:n,_=e.onRequestClose,T=(0,r.Z)(e,F),x=(0,k.$G)().t,j=c.Z.useToken().token,K=m.Z.useForm(),w=(0,t.Z)(K,1)[0],N=(0,b.useFragment)(void 0!==l?l:l=a(78067),Z),P=(0,o.Dj)(),U=(0,S.useQuery)({queryKey:["initialize_totp",null===P||void 0===P?void 0:P.email,T.open],queryFn:function(){return(null===N||void 0===N?void 0:N.email)!==(null===P||void 0===P?void 0:P.email)||null!==N&&void 0!==N&&N.totp_activated||!T.open?null:P.initialize_totp()},suspense:!1,staleTime:0,cacheTime:0}),M=(0,s.Y)({mutationFn:function(e){return P.activate_totp(e.OTP)}});return(0,h.jsx)(u.Z,(0,i.Z)((0,i.Z)({title:x("webui.menu.SetupTotp"),maskClosable:!1,confirmLoading:M.isLoading,onOk:function(){w.validateFields().then((function(e){M.mutate(e,{onSuccess:function(){p.ZP.success(x("totp.TotpSetupCompleted")),_(!0)},onError:function(){p.ZP.error(x("totp.InvalidTotpCode"))}}),new Promise((function(e,n){})).then((function(){_(!0)}))})).catch((function(){}))},onCancel:function(){_()}},T),{},{children:U.isLoading?(0,h.jsx)(d.Z,{justify:"center",direction:"row",children:(0,h.jsx)(g.Z,{})}):U.data?(0,h.jsxs)(h.Fragment,{children:[x("totp.ScanQRToEnable"),(0,h.jsx)(d.Z,{justify:"center",style:{margin:j.marginSM,gap:j.margin},children:(0,h.jsx)(f.Z,{value:U.data.totp_uri})}),x("totp.TypeInAuthKey"),(0,h.jsx)(d.Z,{justify:"center",style:{margin:j.marginSM,gap:j.margin},children:(0,h.jsx)(v.Z.Text,{copyable:!0,code:!0,children:U.data.totp_key})}),x("totp.EnterConfirmationCode"),(0,h.jsx)(m.Z,{preserve:!1,form:w,validateTrigger:["onChange","onBlur"],children:(0,h.jsx)(d.Z,{justify:"center",style:{margin:j.marginSM,gap:j.margin},children:(0,h.jsx)(m.Z.Item,{name:"OTP",rules:[{required:!0,message:x("totp.RequireOTP")},{pattern:/^[0-9]+$/,message:x("credential.validation.NumbersOnly")}],children:(0,h.jsx)(y.Z,{maxLength:6,allowClear:!0,placeholder:"000000",style:{maxWidth:150}})})})})]}):(0,h.jsx)(d.Z,{justify:"center",direction:"row",children:x("totp.TotpSetupNotAvailable")})}))}},75020:function(e,n,a){a.r(n);var l,i,t=a(74165),r=a(1413),o=a(15861),s=a(29439),u=a(44925),d=a(40406),c=a(50164),m=a(77758),p=a(85911),g=a(14749),f=a(88724),v=a(63703),y=a(65113),k=a(57054),S=a(88464),b=a(38818),h=a(72887),F=a(62708),Z=a(70389),_=a(32048),T=a.n(_),x=a(4519),j=a(81748),K=a(87112),w=a(16980),N=a(2556),P=["extraFetchKey"];n.default=function(e){var n,_,U=e.extraFetchKey,M=void 0===U?"":U,C=(0,u.Z)(e,P),I=(0,j.$G)().t,L=(0,p.useWebComponentInfo)(),O=L.value,A=L.dispatchEvent;try{_=JSON.parse(O||"")}catch(ke){_={open:!1,userEmail:""}}var E,$=_,V=$.open,D=$.userEmail,R=y.Z.useModal(),q=(0,s.Z)(R,2),B=q[0],Q=q[1],z=k.Z.useForm(),G=(0,s.Z)(z,1)[0],Y={superadmin:["superadmin","admin","user","monitor"],admin:["admin","user","monitor"]},W=(0,d.Kr)("initial-fetch"),J=(0,s.Z)(W,2),H=J[0],X=J[1],ee=(0,x.useDeferredValue)(H+M),ne=(0,d.Dj)(),ae=null===ne||void 0===ne?void 0:ne.supports("sudo-session-enabled"),le=(0,K.useQuery)("isManagerSupportingTOTP",(function(){return ne.isManagerSupportingTOTP()}),{suspense:!1}),ie=le.data,te=le.isLoading;E=(null===ne||void 0===ne?void 0:ne.supports("2FA"))&&ie;var re=(0,w.useLazyLoadQuery)(void 0!==l?l:l=a(76912),{email:D,isNotSupportSudoSessionEnabled:!ae,isNotSupportTotp:!E,loggedInUserEmail:null!==(n=null===ne||void 0===ne?void 0:ne.email)&&void 0!==n?n:""},{fetchKey:ee,fetchPolicy:"network-only"}),oe=re.user,se=re.loggedInUser,ue=(0,w.useMutation)(void 0!==i?i:i=a(21325)),de=(0,s.Z)(ue,2),ce=de[0],me=de[1],pe=(0,c.Y)({mutationFn:function(e){return ne.remove_totp(e)}}),ge=(0,v.Z)(!1),fe=(0,s.Z)(ge,2),ve=fe[0],ye=fe[1].toggle;return(0,N.jsxs)(m.Z,(0,r.Z)((0,r.Z)({open:V,onCancel:function(){A("cancel",null)},centered:!0,title:I("credential.ModifyUserDetail"),destroyOnClose:!0,onOk:function(){G.validateFields().then(function(){var e=(0,o.Z)((0,t.Z)().mark((function e(n){var a,l,i;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete(a=(0,r.Z)({},n)).email,a=T().omit(a,["password_confirm"]),a=T().omitBy(a,(function(e){return void 0===e||""===e})),ae||null===(l=a)||void 0===l||delete l.sudo_session_enabled,E||null===(i=a)||void 0===i||delete i.totp_activated,ce({variables:{email:(null===n||void 0===n?void 0:n.email)||"",props:a,isNotSupportSudoSessionEnabled:!ae,isNotSupportTotp:!E},onCompleted:function(e){var n,a;null!==e&&void 0!==e&&null!==(n=e.modify_user)&&void 0!==n&&n.ok?S.ZP.success(I("environment.SuccessfullyModified")):S.ZP.error(null===e||void 0===e||null===(a=e.modify_user)||void 0===a?void 0:a.msg);A("ok",null)},onError:function(e){S.ZP.error(null===e||void 0===e?void 0:e.message)}});case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())},confirmLoading:me},C),{},{children:[(0,N.jsxs)(k.Z,{preserve:!1,form:G,labelCol:{span:10},wrapperCol:{span:20},validateTrigger:["onChange","onBlur"],style:{marginBottom:40,marginTop:20},initialValues:(0,r.Z)({},oe),children:[(0,N.jsx)(k.Z.Item,{name:"email",label:I("credential.UserID"),children:(0,N.jsx)(b.Z,{disabled:!0})}),(0,N.jsx)(k.Z.Item,{name:"username",label:I("credential.UserName"),children:(0,N.jsx)(b.Z,{placeholder:I("maxLength.64chars")})}),(0,N.jsx)(k.Z.Item,{name:"full_name",label:I("credential.FullName"),children:(0,N.jsx)(b.Z,{placeholder:I("maxLength.64chars")})}),(0,N.jsx)(k.Z.Item,{name:"password",label:I("general.NewPassword"),rules:[{pattern:/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,message:I("webui.menu.InvalidPasswordMessage")}],children:(0,N.jsx)(b.Z.Password,{})}),(0,N.jsx)(k.Z.Item,{name:"password_confirm",dependencies:["password"],label:I("webui.menu.NewPasswordAgain"),rules:[function(e){var n=e.getFieldValue;return{validator:function(e,a){return!a&&n("password")?Promise.reject(new Error(I("webui.menu.PleaseConfirmYourPassword"))):a&&n("password")!==a?Promise.reject(new Error(I("environment.PasswordsDoNotMatch"))):Promise.resolve()}}}],children:(0,N.jsx)(b.Z.Password,{})}),(0,N.jsx)(k.Z.Item,{name:"description",label:I("credential.Description"),children:(0,N.jsx)(b.Z.TextArea,{placeholder:I("maxLength.500chars")})}),(0,N.jsx)(k.Z.Item,{name:"status",label:I("credential.UserStatus"),children:(0,N.jsx)(h.Z,{options:T().map({active:"Active",inactive:"Inactive","before-verification":"Before Verification",deleted:"Deleted"},(function(e,n){return{value:n,label:e}}))})}),!(null===oe||void 0===oe||!oe.role)&&!(null===se||void 0===se||!se.role)&&se.role in Y&&(0,N.jsx)(k.Z.Item,{name:"role",label:I("credential.Role"),children:(0,N.jsx)(h.Z,{options:T().map(Y[se.role],(function(e){return{value:e,label:e}}))})}),(0,N.jsx)(k.Z.Item,{name:"need_password_change",label:I("credential.DescRequirePasswordChange"),valuePropName:"checked",children:(0,N.jsx)(F.Z,{})}),!!ae&&(0,N.jsx)(k.Z.Item,{name:"sudo_session_enabled",label:I("credential.EnableSudoSession"),valuePropName:"checked",children:(0,N.jsx)(F.Z,{})}),!!E&&(0,N.jsx)(k.Z.Item,{name:"totp_activated",label:I("webui.menu.TotpActivated"),valuePropName:"checked",extra:(null===oe||void 0===oe?void 0:oe.email)!==(null===ne||void 0===ne?void 0:ne.email)&&(0,N.jsx)(Z.Z.Text,{type:"secondary",style:{fontSize:12},children:I("credential.AdminCanOnlyRemoveTotp")}),children:(0,N.jsx)(F.Z,{loading:te||pe.isLoading,disabled:(null===oe||void 0===oe?void 0:oe.email)!==(null===ne||void 0===ne?void 0:ne.email)&&!(null!==oe&&void 0!==oe&&oe.totp_activated),onChange:function(e){e?ye():null!==oe&&void 0!==oe&&oe.totp_activated&&(G.setFieldValue("totp_activated",!0),B.confirm({title:I("totp.TurnOffTotp"),icon:(0,N.jsx)(f.Z,{}),content:I("totp.ConfirmTotpRemovalBody"),okText:I("button.Yes"),okType:"danger",cancelText:I("button.No"),onOk:function(){pe.mutate((null===oe||void 0===oe?void 0:oe.email)||"",{onSuccess:function(){S.ZP.success(I("totp.RemoveTotpSetupCompleted")),X(),G.setFieldValue("totp_activated",!1)},onError:function(e){console.log(e)}})},onCancel:function(){G.setFieldValue("totp_activated",!0)}}))}})})]}),!!E&&(0,N.jsx)(g.Z,{userFrgmt:oe,open:ve,onRequestClose:function(e){e?X():G.setFieldValue("totp_activated",!1),ye()}}),Q]}))}},78067:function(e,n,a){a.r(n);var l={argumentDefinitions:[{kind:"RootArgument",name:"isNotSupportTotp"}],kind:"Fragment",metadata:null,name:"TOTPActivateModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null}],type:"User",abstractKey:null,hash:"f5da6b3094f7d70bef9373d9c907955c"};n.default=l},21325:function(e,n,a){a.r(n);var l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"email"},n={defaultValue:null,kind:"LocalArgument",name:"isNotSupportSudoSessionEnabled"},a={defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},l={defaultValue:null,kind:"LocalArgument",name:"props"},i=[{kind:"Variable",name:"email",variableName:"email"},{kind:"Variable",name:"props",variableName:"props"}],t={alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},v={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[o,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:[e,n,a,l],kind:"Fragment",metadata:null,name:"UserSettingModalMutation",selections:[{alias:null,args:i,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[t,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[o,s,u,d,c,m,p,g,f,v,y,k,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],storageKey:null}],type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,l,n,a],kind:"Operation",name:"UserSettingModalMutation",selections:[{alias:null,args:i,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[t,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[o,s,u,d,c,m,p,g,f,v,y,k],storageKey:null}],storageKey:null}]},params:{cacheID:"9b1a3e23ee391f117fee34e25b6fbf05",id:null,metadata:{},name:"UserSettingModalMutation",operationKind:"mutation",text:"mutation UserSettingModalMutation(\n  $email: String!\n  $props: ModifyUserInput!\n  $isNotSupportSudoSessionEnabled: Boolean!\n  $isNotSupportTotp: Boolean!\n) {\n  modify_user(email: $email, props: $props) {\n    ok\n    msg\n    user {\n      id\n      email\n      username\n      need_password_change\n      full_name\n      description\n      status\n      domain_name\n      role\n      groups {\n        id\n        name\n      }\n      sudo_session_enabled @skipOnClient(if: $isNotSupportSudoSessionEnabled)\n      totp_activated @skipOnClient(if: $isNotSupportTotp)\n      ...TOTPActivateModalFragment\n    }\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();l.hash="b7bb2083b30dea10ff3f89197e67e2cb",n.default=l},76912:function(e,n,a){a.r(n);var l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportSudoSessionEnabled"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},{defaultValue:null,kind:"LocalArgument",name:"loggedInUserEmail"}],n=[{kind:"Variable",name:"email",variableName:"email"}],a={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},c={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[d,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null},g=[{kind:"Variable",name:"email",variableName:"loggedInUserEmail"}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[a,l,i,t,r,o,s,u,c,m,p,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null},{alias:"loggedInUser",args:g,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[u],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[a,l,i,t,r,o,s,u,c,m,p,d],storageKey:null},{alias:"loggedInUser",args:g,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[u,d],storageKey:null}]},params:{cacheID:"55fb94209e66cec0a1a802ff12b18c64",id:null,metadata:{},name:"UserSettingModalQuery",operationKind:"query",text:"query UserSettingModalQuery(\n  $email: String\n  $isNotSupportSudoSessionEnabled: Boolean!\n  $isNotSupportTotp: Boolean!\n  $loggedInUserEmail: String\n) {\n  user(email: $email) {\n    email\n    username\n    need_password_change\n    full_name\n    description\n    status\n    domain_name\n    role\n    groups {\n      id\n      name\n    }\n    sudo_session_enabled @skipOnClient(if: $isNotSupportSudoSessionEnabled)\n    totp_activated @skipOnClient(if: $isNotSupportTotp)\n    ...TOTPActivateModalFragment\n    id\n  }\n  loggedInUser: user(email: $loggedInUserEmail) {\n    role\n    id\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();l.hash="139401e06fdc036b1235475a82fd4397",n.default=l}}]);
//# sourceMappingURL=20.9c91ec7d.chunk.js.map