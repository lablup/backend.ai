"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[4045],{7860:(e,n,s)=>{s.d(n,{A:()=>m});var t=s(43742),i=s(72079),l=s(52530),o=s.n(l),r=s(64428),a=s.n(r),d=s(55202),c=s(52426);const u=d.forwardRef(((e,n)=>{let{value:s,onChange:l,localFormat:r,...d}=e;const[,u]=(0,t.A)({value:s,onChange:l});return(0,c.jsx)(i.A,{ref:n,value:s?o()(s):void 0,onChange:e=>{var n,s,t;a().isArray(e)&&(e=e[0]);const i=r?null===(n=e)||void 0===n?void 0:n.format():null===(s=e)||void 0===s||null===(t=s.tz())||void 0===t?void 0:t.toISOString();u(i)},...d})}));u.displayName="DatePickerISO";const m=u},31050:(e,n,s)=>{s.d(n,{A:()=>o});var t=s(79837),i=s(55202),l=s(52426);const o=e=>{let{value:n,...s}=e;const o=t.A.useFormInstance();return(0,i.useEffect)((()=>{o.setFieldValue(s.name,n)}),[n,o,s.name]),(0,l.jsx)(t.A.Item,{...s,hidden:!0})}},20103:(e,n,s)=>{s.d(n,{A:()=>c,j:()=>d});var t=s(79837),i=s(294),l=s(64428),o=s.n(l),r=(s(55202),s(44617)),a=s(52426);const d=e=>[{min:4,message:e("session.validation.SessionNameTooShort")},{max:64,message:e("session.validation.SessionNameTooLong64")},{validator:(n,s)=>o().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/^[\w.-]*$/.test(s)?!/\w$/.test(s)&&s.length>=4?Promise.reject(e("session.validation.SessionNameShouldEndWith")):Promise.resolve():Promise.reject(e("session.validation.SessionNameInvalidCharacter")):Promise.reject(e("session.validation.SessionNameShouldStartWith"))}],c=e=>{let{...n}=e;const{t:s}=(0,r.Bd)();return(0,a.jsx)(t.A.Item,{label:s("session.launcher.SessionName"),name:"sessionName",rules:d(s),...n,children:(0,a.jsx)(i.A,{allowClear:!0,autoComplete:"off"})})}},97364:(e,n,s)=>{s.r(n),s.d(n,{default:()=>i});const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],s={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},l={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},i],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,l],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s,i],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,l,i],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();t.hash="ba086835ea654ab889e0e6aaefa0abfe";const i=t},24045:(e,n,s)=>{s.r(n),s.d(n,{ResourceNumbersOfSession:()=>Ue,default:()=>We});var t=s(60729),i=s(7860),l=s(23671),o=s(96520),r=s(24721),a=s(44527),d=s(81751),c=s(79837),u=s(41961),m=s(36290),h=s(64428),p=s.n(h),v=s(55202),g=s(44617),x=s(52426);const A=1024,y=65535,j=e=>{let{inValid:n,value:s,...t}=e;return(0,x.jsx)(m.A,{color:!n&&b(s)?void 0:"red",...t})},b=e=>{if(F(e)){const n=e.split(":"),[s,t]=n.map((e=>parseInt(e)));return s>=A&&t<=y}return e===parseInt(e).toString()&&parseInt(e)>=A&&parseInt(e)<=y},F=e=>{const n=e.split(":");if(2===n.length){const[e,s]=n.map((e=>parseInt(e)));return e<=s}return!1},w=e=>p().flatten(p().map(e,(e=>F(e)?(e=>{const[n,s]=e.split(":").map((e=>parseInt(e)));return p().range(n,s+1)})(e):parseInt(e)))),f=e=>{let{name:n="ports",...s}=e;const{t:t}=(0,g.Bd)(),i=(0,d.CX)(),l=c.A.useFormInstance();return(0,x.jsx)(c.A.Item,{label:t("session.launcher.PreOpenPortTitle"),name:n,tooltip:(0,x.jsx)(g.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:t("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,n)=>w(n).length<=i._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortMaxCountLimit",{count:i._config.maxCountForPreopenPorts})))}),()=>({validator:(e,n)=>p().every(n,(e=>parseInt(e).toString()===e||F(e)))?Promise.resolve():Promise.reject(new Error(t("session.launcher.InvalidPortFormat")))}),()=>({validator(e,n){const s=w(n);return p().every(s,(e=>e>=A&&e<=y))?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,n){const s=w(n);return p().uniq(s).length===s.length?Promise.resolve():Promise.reject(new Error(t("session.launcher.DuplicatedPort")))}})],...s,children:(0,x.jsx)(u.A,{mode:"tags",tagRender:e=>{const s=p().filter(w(l.getFieldValue(n)),(n=>n===parseInt(e.value))).length>1;return(0,x.jsx)(j,{inValid:s,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})};var S=s(32847),k=s(62010),E=s(79678),T=s(47987);const V=e=>{let{open:n,onClose:s,...t}=e;const{t:i}=(0,g.Bd)(),[l,o]=(0,E.q)("has_opened_tour_neo_session_validation"),r=[{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.FixErrorFieldByModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,x.jsx)(T.A,{steps:r,onClose:e=>{null===s||void 0===s||s(e),o(!0)},open:!l&&n,...t})};var I,N=s(77813),P=s(43992),_=s(6871),C=s(4335),O=s(34384),D=s(51598),M=s(3413),B=s(78909),z=s(7885),R=s(76385),L=s(31050),q=s(92560),G=s(37090),U=s(70554),K=s(34589),W=s(294),H=s(90086),$=s(4828),J=s(56222),Q=s(69788),X=s(10898),Y=s(18139);const Z=e=>{const{t:n}=(0,g.Bd)(),s=c.A.useFormInstance(),t=c.A.useWatch(["owner","enabled"],s),i=(0,B.Am)();return("admin"===i||"superadmin"===i)&&t&&(0,x.jsx)(C.A,{title:n("session.launcher.SetSessionOwner"),showDivider:!0,size:"small",status:s.getFieldError(["owner","email"]).length>0||s.getFieldError(["owner","accesskey"]).length>0||s.getFieldError(["owner","project"]).length>0||s.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit"),...e,children:(0,x.jsxs)(Q.A,{size:"small",column:1,children:[(0,x.jsx)(Q.A.Item,{label:n("session.launcher.OwnerEmail"),children:s.getFieldValue(["owner","email"])}),(0,x.jsx)(Q.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:s.getFieldValue(["owner","accesskey"])}),(0,x.jsx)(Q.A.Item,{label:n("session.launcher.OwnerGroup"),children:s.getFieldValue(["owner","project"])}),(0,x.jsx)(Q.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:s.getFieldValue(["owner","resourceGroup"])})]})})},ee=e=>{const{t:n}=(0,g.Bd)(),{token:t}=G.A.useToken(),i=c.A.useFormInstance(),l=c.A.useWatch(["owner","enabled"],i),[r,a]=(0,v.useState)(),d=(0,Y.useRelayEnvironment)(),{data:m,isFetching:h}=(0,z.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",r],queryFn:()=>{const e=i.getFieldValue(["owner","email"]);if(!e)return;const n=void 0!==I?I:I=s(97364);return(0,Y.fetchQuery)(d,n,{email:e}).toPromise()},enabled:!!r}),A=i.getFieldValue(["owner","email"])?null===m||void 0===m?void 0:m.keypairs:void 0,y=i.getFieldValue(["owner","email"])?null===m||void 0===m?void 0:m.user:void 0,j=!h&&r&&!y;return(0,x.jsxs)(U.A,{title:n("session.launcher.SetSessionOwner"),extra:(0,x.jsx)(c.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,x.jsx)(K.A,{})}),styles:l?void 0:{header:{borderBottom:"none"},body:{display:l?"block":"none"}},...e,children:[(0,x.jsx)(L.A,{name:["owner","domainName"],value:null===y||void 0===y?void 0:y.domain_name}),(0,x.jsx)(c.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(o.A,{children:(0,x.jsx)(c.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:l},{type:"email",message:n("credential.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:j?"error":void 0,help:j?n("credential.NoUserToDisplay"):void 0,children:(0,x.jsx)(W.A.Search,{onSearch:e=>{i.validateFields([["owner","email"]]).then((()=>{a(e)})).catch((()=>{}))},onChange:()=>{a(""),i.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:h,enterButton:!h&&y?(0,x.jsx)(H.Ay,{icon:(0,x.jsx)(X.A,{})}):void 0})})}),(0,x.jsx)(c.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:s(["owner","enabled"])}],children:(0,x.jsx)(R.A,{options:p().map(A,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:p().isEmpty(r)||h})}),(0,x.jsxs)($.A,{gutter:t.marginSM,children:[(0,x.jsx)(J.A,{span:12,children:(0,x.jsx)(c.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,x.jsx)(R.A,{options:p().map(null===y||void 0===y?void 0:y.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:p().isEmpty(r)||h})})}),(0,x.jsx)(J.A,{span:12,children:(0,x.jsx)(c.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,x.jsx)(v.Suspense,{fallback:(0,x.jsx)(c.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,x.jsx)(u.A,{loading:!0})}),children:(0,x.jsx)(c.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:s(["owner","project"])?(0,x.jsx)(q.A,{projectName:s(["owner","project"]),disabled:p().isEmpty(r)||h,autoSelectDefault:!0}):(0,x.jsx)(u.A,{disabled:!0})})})}})})]})]})}})]})};var ne=s(85763),se=s(18959),te=s(55616),ie=s(43299),le=s(56909),oe=s(52530),re=s.n(oe),ae=s(22532),de=s(17763);const ce=e=>{var n,s,t,i,l,r,a,u,h,v,A,y,b,F,w,f,S,k,E,T,V,I,B,z,R,L,q,K,W,H,X,Y,ee,oe,ce,ue;let{onClickEditStep:me}=e;const{t:he}=(0,g.Bd)(),pe=c.A.useFormInstance(),{token:ve}=G.A.useToken(),ge=(0,d.CX)(),xe=c.A.useWatch("sessionType",{form:pe,preserve:!0}),Ae=null!==(n=null===ge||void 0===ge?void 0:ge.supports("batch-timeout"))&&void 0!==n&&n,ye=null!==(s=null===ge||void 0===ge?void 0:ge.supports("extended-image-info"))&&void 0!==s&&s,je=(0,P.hd)(),[,{getBaseVersion:be,getBaseImage:Fe,tagAlias:we}]=(0,d.Gj)(),{isDarkMode:fe}=(0,_.e)();return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(C.A,{title:he("session.launcher.SessionType"),showDivider:!0,size:"small",status:pe.getFieldError("sessionName").length>0||pe.getFieldError(["batch","command"]).length>0||pe.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("sessionType")},children:(0,x.jsxs)(Q.A,{size:"small",column:1,children:[(0,x.jsx)(Q.A.Item,{label:he("session.SessionType"),children:pe.getFieldValue("sessionType")}),!p().isEmpty(pe.getFieldValue("sessionName"))&&(0,x.jsx)(Q.A.Item,{label:he("session.launcher.SessionName"),children:pe.getFieldValue("sessionName")}),"batch"===xe&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(Q.A.Item,{label:he("session.launcher.StartUpCommand"),labelStyle:{whiteSpace:"nowrap"},contentStyle:{overflow:"auto"},children:pe.getFieldValue(["batch","command"])?(0,x.jsx)(ne.A,{language:"shell",children:pe.getFieldValue(["batch","command"])}):(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})}),(0,x.jsx)(Q.A.Item,{label:he("session.launcher.SessionStartTime"),children:pe.getFieldValue(["batch","scheduleDate"])?re()(pe.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})}),Ae?(0,x.jsx)(Q.A.Item,{label:he("session.launcher.BatchJobTimeoutDuration"),children:pe.getFieldValue(["batch","timeout"])?(0,x.jsxs)(se.A.Text,{children:[pe.getFieldValue(["batch","timeout"]),pe.getFieldValue(["batch","timeoutUnit"])||"s"]}):(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})}):null]})]})}),(0,x.jsx)(Z,{onClickExtraButton:()=>{me("sessionType")}}),(0,x.jsx)(C.A,{title:he("session.launcher.Environments"),showDivider:!0,size:"small",status:p().some(pe.getFieldValue("envvars"),((e,n)=>pe.getFieldError(["envvars",n,"variable"]).length>0||pe.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("environment")},children:(0,x.jsxs)(Q.A,{size:"small",column:1,children:[(0,x.jsx)(Q.A.Item,{label:he("session.launcher.Project"),children:je.name}),(0,x.jsx)(Q.A.Item,{label:he("general.Image"),children:ye?(0,x.jsxs)($.A,{style:{flexFlow:"nowrap"},children:[(0,x.jsx)(J.A,{children:(0,x.jsx)(D.A,{image:(null===(t=pe.getFieldValue("environments"))||void 0===t?void 0:t.version)||(null===(i=pe.getFieldValue("environments"))||void 0===i?void 0:i.manual),style:{marginRight:ve.marginXS}})}),(0,x.jsx)(J.A,{children:(0,x.jsx)(o.A,{direction:"row",wrap:"wrap",children:null!==(l=pe.getFieldValue("environments"))&&void 0!==l&&l.manual?(0,x.jsx)(se.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(r=pe.getFieldValue("environments"))||void 0===r?void 0:r.manual},children:null===(a=pe.getFieldValue("environments"))||void 0===a?void 0:a.manual}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(se.A.Text,{children:we(null===(u=pe.getFieldValue("environments"))||void 0===u||null===(h=u.image)||void 0===h?void 0:h.base_image_name)}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(se.A.Text,{children:null===(v=pe.getFieldValue("environments"))||void 0===v||null===(A=v.image)||void 0===A?void 0:A.version}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(se.A.Text,{children:null===(y=pe.getFieldValue("environments"))||void 0===y||null===(b=y.image)||void 0===b?void 0:b.architecture}),(0,x.jsx)(te.A,{type:"vertical"}),p().map(null===(F=pe.getFieldValue("environments"))||void 0===F||null===(w=F.image)||void 0===w?void 0:w.tags,(e=>{var n,s,t;const i=p().includes(e.key,"customized_"),l=i?null===(n=p().find(null===(s=pe.getFieldValue("environments"))||void 0===s||null===(t=s.image)||void 0===t?void 0:t.labels,{key:"ai.backend.customized-image.name"}))||void 0===n?void 0:n.value:e.value,o=we(e.key+l);return p().isEqual(o,(0,N.WY)(e.key+l))||i?(0,x.jsx)(O.A,{values:[{label:we(e.key),color:i?"cyan":"blue"},{label:l,color:i?"cyan":"blue"}]},e.key):(0,x.jsx)(m.A,{color:i?"cyan":"blue",children:o},e.key)})),(0,x.jsx)(se.A.Text,{style:{color:ve.colorPrimary},copyable:{text:(0,N.A_)(null===(f=pe.getFieldValue("environments"))||void 0===f?void 0:f.image)||(null===(S=pe.getFieldValue("environments"))||void 0===S?void 0:S.version)}})]})})})]}):(0,x.jsxs)($.A,{style:{flexFlow:"nowrap",gap:ve.sizeXS},children:[(0,x.jsx)(J.A,{children:(0,x.jsx)(D.A,{image:(null===(k=pe.getFieldValue("environments"))||void 0===k?void 0:k.version)||(null===(E=pe.getFieldValue("environments"))||void 0===E?void 0:E.manual)})}),(0,x.jsx)(J.A,{children:(0,x.jsx)(o.A,{direction:"row",wrap:"wrap",children:null!==(T=pe.getFieldValue("environments"))&&void 0!==T&&T.manual?(0,x.jsx)(se.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(V=pe.getFieldValue("environments"))||void 0===V?void 0:V.manual},children:null===(I=pe.getFieldValue("environments"))||void 0===I?void 0:I.manual}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(se.A.Text,{children:we(Fe(null===(B=pe.getFieldValue("environments"))||void 0===B?void 0:B.version))}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(se.A.Text,{children:be(null===(z=pe.getFieldValue("environments"))||void 0===z?void 0:z.version)}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(se.A.Text,{children:null===(R=pe.getFieldValue("environments"))||void 0===R||null===(L=R.image)||void 0===L?void 0:L.architecture}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(M.Jj,{tag:pe.getFieldValue(["environments","image","tag"]),labels:null===(q=pe.getFieldValue("environments"))||void 0===q||null===(K=q.image)||void 0===K?void 0:K.labels}),(0,x.jsx)(se.A.Text,{style:{color:ve.colorPrimary},copyable:{text:(0,N.A_)(null===(W=pe.getFieldValue("environments"))||void 0===W?void 0:W.image)||(null===(H=pe.getFieldValue("environments"))||void 0===H?void 0:H.version)}})]})})})]})}),(null===(X=pe.getFieldValue("envvars"))||void 0===X?void 0:X.length)>0&&(0,x.jsx)(Q.A.Item,{label:he("session.launcher.EnvironmentVariable"),children:null!==(Y=pe.getFieldValue("envvars"))&&void 0!==Y&&Y.length?(0,x.jsx)(ae.A,{style:fe?de.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:p().map(pe.getFieldValue("envvars"),(e=>`${(null===e||void 0===e?void 0:e.variable)||""}="${(null===e||void 0===e?void 0:e.value)||""}"`)).join("\n")}):(0,x.jsx)(se.A.Text,{type:"secondary",children:"-"})})]})}),(0,x.jsx)(C.A,{title:he("session.launcher.ResourceAllocation"),showDivider:!0,status:p().some(pe.getFieldValue("resource"),((e,n)=>pe.getFieldError(["resource",n]).length>0))||pe.getFieldError(["num_of_sessions"]).length>0||pe.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("environment")},children:(0,x.jsxs)(o.A,{direction:"column",align:"stretch",children:[p().some(pe.getFieldValue("resource"),((e,n)=>pe.getFieldWarning(["resource",n]).length>0))&&(0,x.jsx)(ie.A,{type:"warning",showIcon:!0,message:he("session.launcher.EnqueueComputeSessionWarning")}),(0,x.jsxs)(Q.A,{column:2,children:[(0,x.jsx)(Q.A.Item,{label:he("general.ResourceGroup"),span:2,children:pe.getFieldValue("resourceGroup")||(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})}),(0,x.jsx)(Q.A.Item,{label:he("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,x.jsxs)(o.A,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===pe.getFieldValue("allocationPreset")?"":(0,x.jsx)(m.A,{children:pe.getFieldValue("allocationPreset")}),(0,x.jsx)(Ue,{resource:pe.getFieldValue("resource")})]})}),ge.supports("agent-select")&&!(null!==ge&&void 0!==ge&&null!==(ee=ge._config)&&void 0!==ee&&ee.hideAgents)&&(0,x.jsx)(Q.A.Item,{label:he("session.launcher.AgentNode"),children:pe.getFieldValue("agent")||he("session.launcher.AutoSelect")}),(0,x.jsx)(Q.A.Item,{label:he("session.launcher.NumberOfContainer"),children:1===pe.getFieldValue("cluster_size")?pe.getFieldValue("num_of_sessions"):pe.getFieldValue("cluster_size")}),(0,x.jsx)(Q.A.Item,{label:he("session.launcher.ClusterMode"),children:"single-node"===pe.getFieldValue("cluster_mode")?he("session.launcher.SingleNode"):he("session.launcher.MultiNode")})]}),(0,x.jsx)(U.A,{size:"small",type:"inner",title:he("session.launcher.TotalAllocation"),children:(0,x.jsx)(o.A,{direction:"row",gap:"xxs",children:(0,x.jsx)(Ue,{resource:pe.getFieldValue("resource"),containerCount:1===pe.getFieldValue("cluster_size")?pe.getFieldValue("num_of_sessions"):pe.getFieldValue("cluster_size")})})})]})}),(0,x.jsx)(C.A,{title:he("webui.menu.Data&Storage"),showDivider:!0,size:"small",status:pe.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("storage")},children:(0,x.jsxs)(o.A,{direction:"column",align:"stretch",gap:"xs",children:[(null===(oe=pe.getFieldValue("mounts"))||void 0===oe?void 0:oe.length)>0?(0,x.jsx)(le.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:he("data.folders.Name")},{dataIndex:"alias",title:he("session.launcher.FolderAlias"),render:(e,n)=>p().isEmpty(e)?(0,x.jsx)(se.A.Text,{type:"secondary",style:{opacity:.7},children:`/home/work/${n.name}`}):e}],dataSource:p().map(pe.getFieldValue("mounts"),(e=>{var n;return{name:e,alias:null===(n=pe.getFieldValue("vfoldersAliasMap"))||void 0===n?void 0:n[e]}}))}):(0,x.jsx)(ie.A,{type:"warning",showIcon:!0,message:he("session.launcher.NoFolderMounted")}),(null===(ce=pe.getFieldValue("autoMountedFolderNames"))||void 0===ce?void 0:ce.length)>0?(0,x.jsx)(Q.A,{size:"small",children:(0,x.jsx)(Q.A.Item,{label:he("data.AutomountFolders"),children:p().map(pe.getFieldValue("autoMountedFolderNames"),(e=>(0,x.jsx)(m.A,{children:e})))})}):null]})}),(0,x.jsx)(C.A,{title:"Network",showDivider:!0,size:"small",status:pe.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("network")},children:(0,x.jsx)(Q.A,{size:"small",children:(0,x.jsx)(Q.A.Item,{label:he("session.launcher.PreOpenPortTitle"),children:(0,x.jsxs)(o.A,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[p().sortBy(pe.getFieldValue("ports"),(e=>parseInt(e))).map(((e,n)=>(0,x.jsx)(j,{value:e,style:{margin:0},children:e},n+e))),p().isArray(pe.getFieldValue("ports"))&&0!==(null===(ue=pe.getFieldValue("ports"))||void 0===ue?void 0:ue.length)?null:(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})]})})})})]})};var ue=s(20103),me=s(62424);const he=()=>{const[e,n]=(0,E.q)("recentSessionHistory"),s=(0,me.E)((s=>{let{id:t,params:i,createdAt:l,name:o}=s;const r={id:null!==t&&void 0!==t?t:(0,N.kX)(8),params:i,createdAt:null!==l&&void 0!==l?l:(new Date).toISOString(),name:o},a=p().sortBy([r,...e||[]],"-createdAt").slice(0,5);n(a)})),t=(0,me.E)((()=>n([]))),i=(0,me.E)((s=>{const t=(e||[]).filter((e=>e.id!==s));n(t)})),l=(0,me.E)(((s,t)=>{const i=(e||[]).map((e=>e.id===s?{...e,name:t}:e));n(i)}));return[e,{push:s,clear:t,remove:i,update:l}]};var pe=s(54145),ve=s(38053),ge=s(38773),xe=s(81081),Ae=s(86663),ye=s(17914),je=s(3257);const be=(0,ye.rU)((e=>{let{token:n,css:s}=e;return{fixEditableVerticalAlign:s`
    & {
      margin-top: 0px !important;
    }
  `}})),Fe=e=>{let{...n}=e;const{t:s}=(0,g.Bd)(),{styles:t}=be(),[i,{update:l}]=he(),[r,a]=(0,v.useState)(null),[,{getImageAliasName:c,getBaseVersion:u}]=(0,d.Gj)(),[m,{pin:h,unpin:A,update:y}]=(()=>{const[e,n]=(0,E.q)("pinnedSessionHistory"),[s]=(0,E.q)("recentSessionHistory"),t=(0,me.E)((t=>{const i=(s||[]).find((e=>e.id===t));i&&n([...e||[],i])})),i=(0,me.E)((s=>{const t=(e||[]).filter((e=>e.id!==s));n(t)})),l=(0,me.E)(((s,t)=>{const i=(e||[]).map((e=>e.id===s?{...e,name:t}:e));n(i)}));return[e,{pin:t,unpin:i,update:l}]})(),[,j]=(0,v.useState)(),{token:b}=G.A.useToken(),F=(0,v.useMemo)((()=>{const e=(e,n)=>{const s=new URLSearchParams(e.params);return{...JSON.parse(s.get("formValues")||"{}"),pinned:n,name:e.name}},n=p().map(i,(n=>({...n,...e(n,!1)}))),s=p().map(m,(n=>({...n,...e(n,!0)})));return p().chain([...s,...n]).unionBy("id").value()}),[i,m]);return(0,x.jsx)(ve.A,{width:800,title:s("session.launcher.RecentHistory"),footer:null,onCancel:()=>{j(void 0),n.onRequestClose()},...n,children:(0,x.jsxs)(o.A,{direction:"column",align:"stretch",gap:"sm",children:[(0,x.jsx)(se.A.Text,{children:s("session.launcher.YouCanStartWithHistory")}),(0,x.jsx)(ge.A,{rowSelection:{selectedRowKeys:null===m||void 0===m?void 0:m.map((e=>e.id)),columnWidth:0,hideSelectAll:!0,renderCell:()=>null},scroll:{x:"max-content"},dataSource:F,pagination:!1,onRow:e=>({onMouseEnter:()=>a(e.id),onMouseLeave:()=>a(null)}),rowKey:e=>e.id,columns:[{title:(0,x.jsxs)(o.A,{gap:"xxs",children:[(0,x.jsx)(je.A,{}),(0,x.jsx)(xe.A,{title:s("session.launcher.PinnedHistoryTooltip")})]}),dataIndex:"pinned",width:40,render:(e,n)=>{const s=!!n.pinned,t=r===n.id;return s?(0,x.jsx)(H.Ay,{size:"small",onClick:()=>{A(n.id)},type:"link",children:(0,x.jsx)(je.A,{})}):(0,x.jsx)(H.Ay,{size:"small",onClick:()=>h(n.id),type:"link",children:(0,x.jsx)(je.A,{style:{color:t?b.colorTextQuaternary:"transparent"}})})}},{title:s("session.launcher.SessionNameShort"),dataIndex:"name",render:(e,s)=>{const o=e||s.id.split("-")[0];return(0,x.jsx)(se.A.Link,{className:t.fixEditableVerticalAlign,editable:{onChange(e){p().isEmpty(e)||(l(s.id,e),s.pinned&&y(s.id,e))},text:o},children:(0,x.jsx)(pe.A,{type:"hover",onClick:()=>{var e,t;const l=null===(e=p().find(i,{id:s.id}))||void 0===e?void 0:e.params;null===(t=n.onRequestClose)||void 0===t||t.call(n,JSON.parse(new URLSearchParams(l).get("formValues")||"{}"))},children:o})})}},{title:s("session.launcher.Environments"),dataIndex:["environments","version"],render:(e,n)=>{const s=n.environments.version||n.environments.manual;return s&&(0,x.jsx)(Ae.A,{title:s,placement:"right",children:(0,x.jsxs)(o.A,{gap:"xxs",children:[(0,x.jsx)(D.A,{image:s}),(0,x.jsxs)(se.A.Text,{children:[c(s)," ",u(s)]})]})})},onCell:()=>({style:{maxWidth:250,textOverflow:"ellipsis"}})},{title:s("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,x.jsx)(o.A,{gap:"xs",children:(0,x.jsx)(Ue,{resource:e})})},{title:s("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>re()(e).fromNow()}]})]})})};var we=s(82213),fe=s(6017);var Se=s(14895),ke=s(58915),Ee=s(31535),Te=s(55027),Ve=s(56079),Ie=s(39271),Ne=s(82844),Pe=s(27119),_e=s(24480),Ce=s(40152),Oe=s(30416),De=s(36256),Me=s(23917),Be=s(39979),ze=s(64545),Re=s(26881),Le=s(22688),qe=s(83902),Ge=s(47174);const Ue=e=>{let{resource:n,containerCount:s=1}=e;return(0,x.jsxs)(x.Fragment,{children:[p().map(p().omit(n,"shmem","accelerator","acceleratorType"),((e,t)=>{var i,l;return"0"===e?null:(0,x.jsx)(k.A,{type:t,value:"mem"===t?((null===(i=(0,N.Is)(e.toString(),"b"))||void 0===i?void 0:i.number)||0)*s+"":p().toNumber(e)*s+"",opts:{shmem:n.shmem?((null===(l=(0,N.Is)(n.shmem,"b"))||void 0===l?void 0:l.number)||0)*s:void 0}},t)})),n&&n.accelerator&&n.acceleratorType&&p().isNumber(n.accelerator)?(0,x.jsx)(k.A,{type:n.acceleratorType,value:p().toString(n.accelerator*s)}):null]})},Ke=()=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<8;s++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},We=()=>{var e,n,s;const m=_e.A.useApp();let h="normal";const A=(0,Re.md)(a.i7),y=(0,d.CX)(),j=(0,B.Am)(),[b,F]=(0,P.zL)(),k=null!==(e=null===y||void 0===y?void 0:y.supports("batch-timeout"))&&void 0!==e&&e,[E,T]=(0,v.useState)(!1),I=(0,v.useMemo)((()=>{var e,n;return{sessionType:"interactive",allocationPreset:"auto-select",hpcOptimization:{autoEnabled:!0},batch:{enabled:!1,command:void 0,scheduleDate:void 0,...k&&{timeoutEnabled:!1,timeout:void 0,timeoutUnit:"s"}},envvars:[],...(null===(e=y._config)||void 0===e?void 0:e.default_session_environment)&&{environments:{environment:null===(n=y._config)||void 0===n?void 0:n.default_session_environment}},...S.jh,resourceGroup:b||void 0}}),[null===(n=y._config)||void 0===n?void 0:n.default_session_environment,b,k]),_=(0,Ge.withDefault)(Ge.NumberParam,0),C=(0,Ge.withDefault)(Ge.JsonParam,I),O=(0,Ge.withDefault)(Ge.JsonParam,{}),[{step:D,formValues:M,redirectTo:z,appOption:R},L]=(0,Ge.useQueryParams)({step:_,formValues:C,redirectTo:Ge.StringParam,appOption:O}),{search:q}=(0,qe.zy)(),Q=(0,d.f0)(),X=(0,P.hd)(),[Y,{toggle:Z}]=(0,Ne.A)(),{upsertNotification:ne}=(0,fe.js)(),[,{push:te}]=he(),{run:ie}=(0,Pe.A)((()=>{const e=me.getFieldsValue();L({formValues:p().extend(p().omit(me.getFieldsValue(),["environments.image"],["environments.customizedTag"],["autoMountedFolderNames"],["owner"],["envvars"]),{envvars:(0,l.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),le=e=>{L({step:e},"pushIn")},{token:oe}=G.A.useToken(),{t:ae}=(0,g.Bd)(),de=Ce.Ay.useBreakpoint(),[me]=c.A.useForm();(0,v.useEffect)((()=>{p().isEmpty(M)||me.validateFields().catch((e=>{}))}),[]);const pe=(0,v.useMemo)((()=>p().merge({},I,M)),[I,M]);(0,v.useEffect)((()=>{var e;null===(e=A.current)||void 0===e||e.scrollTo(0,0)}),[D]);const ve=c.A.useWatch("sessionType",{form:me,preserve:!0})||me.getFieldValue("sessionType")||M.sessionType,ge=(0,N.LY)([{title:ae("session.launcher.SessionType"),key:"sessionType"},{title:`${ae("session.launcher.Environments")} & ${ae("session.launcher.ResourceAllocation")} `,key:"environment"},"inference"!==ve&&{title:ae("webui.menu.Data&Storage"),key:"storage"},{title:ae("session.launcher.Network"),key:"network"},{title:ae("session.launcher.ConfirmAndLaunch"),icon:(0,x.jsx)(Se.A,{}),key:"review"}]),xe=null===(s=ge[D])||void 0===s?void 0:s.key,ye=p().some(me.getFieldsError(),(e=>e.errors.length>0)),[je,be]=(0,d.Tw)("first");(0,v.useEffect)((()=>{D===ge.length-1&&me.validateFields().catch((e=>{})).finally((()=>be()))}),[D,me,be,ge.length]),(0,v.useEffect)((()=>{"first"!==je&&We(!!ye)}),[je,ye]);const[Ue,We]=(0,v.useState)(!1),[He,$e]=(0,v.useState)(!1);return(0,v.useLayoutEffect)((()=>{He&&(me.resetFields(),$e(!1))}),[He,me]),(0,x.jsxs)(o.A,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,x.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,x.jsxs)(o.A,{direction:"row",gap:"md",align:"start",children:[(0,x.jsxs)(o.A,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,x.jsxs)(o.A,{direction:"row",justify:"between",children:[(0,x.jsx)(se.A.Title,{level:4,style:{marginTop:0},children:ae("session.launcher.StartNewSession")}),(0,x.jsx)(o.A,{direction:"row",gap:"sm",children:(0,x.jsx)(H.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>Z(),children:ae("session.launcher.RecentHistory")})})]}),(0,x.jsx)(c.A.Provider,{onFormChange:(e,n)=>{ie()},children:(0,x.jsx)(c.A,{form:me,layout:"vertical",requiredMark:"optional",initialValues:pe,children:(0,x.jsxs)(o.A,{direction:"column",align:"stretch",gap:"md",children:[(0,x.jsxs)(U.A,{title:ae("session.launcher.SessionType"),style:{display:"sessionType"===xe?"block":"none"},children:[(0,x.jsx)(c.A.Item,{name:"sessionType",children:(0,x.jsx)(Oe.Ay.Group,{options:[{label:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(se.A.Text,{code:!0,children:ae("session.launcher.InteractiveMode")})," ",(0,x.jsx)(se.A.Text,{type:"secondary",children:ae("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(se.A.Text,{code:!0,children:ae("session.launcher.BatchMode")})," ",(0,x.jsx)(se.A.Text,{type:"secondary",children:ae("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,x.jsx)(ue.A,{}),(0,x.jsx)(c.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,x.jsx)(W.A,{})})]}),"batch"===ve&&(0,x.jsxs)(U.A,{title:ae("session.launcher.BatchModeConfig"),style:{display:"sessionType"===xe?"block":"none"},children:[(0,x.jsx)(c.A.Item,{label:ae("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,x.jsx)(W.A.TextArea,{autoSize:!0})}),(0,x.jsx)(c.A.Item,{noStyle:!0,dependencies:[["batch","scheduleDate"]],children:()=>{const e=me.getFieldValue(["batch","scheduleDate"]);return(0,x.jsx)(t.A,{delay:1e3,callback:()=>{const e=me.getFieldValue(["batch","scheduleDate"]);return e?re()(e).isBefore(re()())?void(0===me.getFieldError(["batch","scheduleDate"]).length&&me.validateFields([["batch","scheduleDate"]])):re()(e).fromNow():void 0},triggerKey:e||"none",render:e=>(0,x.jsx)(c.A.Item,{label:ae("session.launcher.SessionStartTime"),extra:e,children:(0,x.jsxs)(o.A,{direction:"row",gap:"xs",children:[(0,x.jsx)(c.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,x.jsx)(De.A,{onChange:e=>{e.target.checked&&p().isEmpty(me.getFieldValue(["batch","scheduleDate"]))?me.setFieldValue(["batch","scheduleDate"],re()().add(2,"minutes").toISOString()):!1===e.target.checked&&me.setFieldValue(["batch","scheduleDate"],void 0),me.validateFields([["batch","scheduleDate"]])},children:ae("session.launcher.Enable")})}),(0,x.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,t;return(null===(s=e.batch)||void 0===s?void 0:s.enabled)!==(null===(t=n.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const n=!0!==(null===(e=me.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(c.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&re()(n).isBefore(re()())?Promise.reject(ae("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,x.jsx)(i.A,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(re()().startOf("day"))})})})}})]})})})}}),k?(0,x.jsx)(c.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"],["batch","timeoutUnit"]],children:()=>{const e=me.getFieldValue(["batch","timeout"]),n=me.getFieldValue(["batch","timeoutUnit"]),s=re().duration(e,null!==n&&void 0!==n?n:"s"),t=(0,N.a3)(s,ae),i=!p().isNull(e)&&p().toFinite(e)>0?t:null;return(0,x.jsx)(c.A.Item,{label:ae("session.launcher.BatchJobTimeoutDuration"),tooltip:ae("session.launcher.BatchJobTimeoutDurationDesc"),help:i,children:(0,x.jsxs)(o.A,{direction:"row",gap:"xs",children:[(0,x.jsx)(c.A.Item,{noStyle:!0,name:["batch","timeoutEnabled"],valuePropName:"checked",children:(0,x.jsx)(De.A,{onChange:e=>{!1===e.target.checked&&me.setFieldValue(["batch","timeout"],void 0),me.validateFields([["batch","timeout"]])},children:ae("session.launcher.Enable")})}),(0,x.jsx)(c.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"]],children:()=>{const e=!0!==me.getFieldValue(["batch","timeoutEnabled"]);return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(c.A.Item,{name:["batch","timeout"],label:ae("session.launcher.BatchJobTimeoutDuration"),noStyle:!0,rules:[{min:0,type:"number",message:ae("error.AllowsPositiveNumberOnly")},{required:!e}],children:(0,x.jsx)(Me.A,{disabled:e,min:1,addonAfter:(0,x.jsx)(c.A.Item,{noStyle:!0,name:["batch","timeoutUnit"],children:(0,x.jsx)(u.A,{tabIndex:-1,style:{minWidth:75},options:[{label:ae("time.Sec"),value:"s"},{label:ae("time.Min"),value:"m"},{label:ae("time.Hour"),value:"h"},{label:ae("time.Day"),value:"d"},{label:ae("time.Week"),value:"w"}]})})})})})}})]})})}}):null]}),("admin"===j||"superadmin"===j)&&(0,x.jsx)(ee,{style:{display:"sessionType"===xe?"block":"none"}}),"inference"===ve&&(0,x.jsx)(U.A,{title:"Inference Mode Configuration",children:(0,x.jsx)(c.A.Item,{name:["inference","vFolderName"],label:ae("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,x.jsx)(u.A,{})})}),(0,x.jsxs)(U.A,{title:ae("session.launcher.Environments"),style:{display:"environment"===xe?"block":"none"},children:[(0,x.jsx)(Le.tH,{fallbackRender:e=>(console.log(e),null),children:(0,x.jsx)(r.A,{})}),(0,x.jsx)(c.A.Item,{label:ae("session.launcher.EnvironmentVariable"),children:(0,x.jsx)(l.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,x.jsx)(U.A,{title:ae("session.launcher.ResourceAllocation"),style:{display:"environment"===xe?"block":"none"},children:(0,x.jsx)(S.Ay,{enableAgentSelect:!y._config.hideAgents&&y.supports("agent-select"),enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,x.jsxs)(U.A,{title:ae("session.launcher.HPCOptimization"),style:{display:"environment"===xe?"block":"none"},children:[(0,x.jsx)(c.A.Item,{noStyle:!0,children:(0,x.jsxs)(o.A,{direction:"row",gap:"sm",children:[(0,x.jsx)(se.A.Text,{children:ae("session.launcher.SwitchOpenMPoptimization")}),(0,x.jsx)(c.A.Item,{label:ae("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,x.jsx)(K.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e?me.setFieldsValue({hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:void 0,OPENBLAS_NUM_THREADS:void 0}}):me.setFieldsValue({hpcOptimization:{autoEnabled:!1,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"}})}})})]})}),(0,x.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,t;return(null===(s=e.hpcOptimization)||void 0===s?void 0:s.autoEnabled)!==(null===(t=n.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=me.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,x.jsxs)($.A,{gutter:oe.marginMD,style:{display:e?"none":void 0,marginTop:oe.marginMD},children:[(0,x.jsx)(J.A,{xs:24,sm:12,children:(0,x.jsx)(c.A.Item,{style:{flex:1},label:ae("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,x.jsxs)(x.Fragment,{children:[ae("session.launcher.OpenMPOptimization"),(0,x.jsx)(g.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,x.jsx)(Me.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,x.jsx)(J.A,{xs:24,sm:12,children:(0,x.jsx)(c.A.Item,{style:{flex:1},label:ae("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,x.jsxs)(x.Fragment,{children:[ae("session.launcher.OpenMPOptimization"),(0,x.jsx)(g.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,x.jsx)(Me.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,x.jsx)(U.A,{title:ae("webui.menu.Data&Storage"),style:{display:"storage"===xe?"block":"none"},children:(0,x.jsx)(c.A.Item,{noStyle:!0,dependencies:["owner"],children:e=>{let{getFieldValue:n}=e;const s=n("owner"),t=(null===s||void 0===s?void 0:s.enabled)&&p().every(p().omit(s,"enabled"),((e,n)=>void 0!==e));return(0,x.jsx)(we.A,{filter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))},tableProps:{ownerEmail:t?null===s||void 0===s?void 0:s.email:void 0}})}})}),(0,x.jsx)(U.A,{title:ae("session.launcher.Network"),style:{display:"network"===xe?"block":"none"},children:(0,x.jsx)(f,{})}),"review"===xe&&(0,x.jsx)(ce,{onClickEditStep:e=>{const n=p().findIndex(ge,{key:e});le(n)}}),(0,x.jsxs)(o.A,{direction:"row",justify:"between",children:[(0,x.jsx)(o.A,{gap:"sm",children:(0,x.jsx)(Be.A,{title:ae("button.Reset"),description:ae("session.launcher.ResetFormConfirm"),onConfirm:()=>{L({},"replace"),$e(!0)},icon:(0,x.jsx)(ke.A,{style:{color:oe.colorError}}),okText:ae("button.Reset"),okButtonProps:{danger:!0},children:(0,x.jsx)(H.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:ae("button.Reset")})})}),(0,x.jsxs)(o.A,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[D>0&&(0,x.jsx)(H.Ay,{onClick:()=>{le(D-1)},icon:(0,x.jsx)(Ee.A,{}),disabled:E,children:ae("button.Previous")}),D===ge.length-1?(0,x.jsx)(Ae.A,{title:ye?ae("session.launcher.PleaseCompleteForm"):void 0,children:(0,x.jsx)(H.Ay,{type:"primary",icon:(0,x.jsx)(Te.A,{}),disabled:ye,onClick:()=>{T(!0);const e=q;me.validateFields().then((async n=>{var s,t,i,l,o,r;if(p().isEmpty(n.mounts)||0===n.mounts.length){if(!await new Promise((e=>{m.modal.confirm({title:ae("session.launcher.NoFolderMounted"),content:(0,x.jsxs)(x.Fragment,{children:[ae("session.launcher.HomeDirectoryDeletionDialog"),(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),ae("session.launcher.LaunchConfirmationDialog"),(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),ae("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:ae("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const a=n.environments.manual||n.environments.version;let[d,c]=a?a.split("@"):["",""];const u=p().isEmpty(n.sessionName)?Ke():n.sessionName,v={kernelName:d,architecture:c,sessionName:u,...k&&null!==n&&void 0!==n&&null!==(s=n.batch)&&void 0!==s&&s.timeoutEnabled&&!p().isUndefined(null===n||void 0===n||null===(t=n.batch)||void 0===t?void 0:t.timeout)?{batchTimeout:p().toString(n.batch.timeout)+(null===n||void 0===n||null===(i=n.batch)||void 0===i?void 0:i.timeoutUnit)}:void 0,config:{...!y.supports("agent-select")||null!==y&&void 0!==y&&null!==(l=y._config)&&void 0!==l&&l.hideAgents||"auto"===n.agent?void 0:{agent_list:[n.agent].filter((e=>!!e))},type:n.sessionType,...p().isEmpty(n.bootstrap_script)?{}:{bootstrap_script:n.bootstrap_script},..."batch"===n.sessionType?{startsAt:n.batch.enabled?n.batch.scheduleDate:void 0,startupCommand:n.batch.command}:{},...null!==(o=n.owner)&&void 0!==o&&o.enabled?{group_name:n.owner.project,domain:n.owner.domainName,scaling_group:n.owner.project,owner_access_key:n.owner.accesskey}:{group_name:X.name,domain:y._config.domainName,scaling_group:n.resourceGroup},cluster_mode:n.cluster_mode,cluster_size:n.cluster_size,maxWaitSeconds:15,cpu:n.resource.cpu,mem:n.resource.mem,shmem:(0,N.Mh)(n.resource.mem,"4g")>0&&(0,N.Mh)(n.resource.shmem,"1g")<0?"1g":n.resource.shmem,...n.resource.accelerator>0?{[n.resource.acceleratorType]:n.resource.accelerator}:void 0,mounts:n.mounts,mount_map:n.vfoldersAliasMap,env:{...p().fromPairs(n.envvars.map((e=>[e.variable,e.value]))),...n.hpcOptimization.autoEnabled?{}:p().omit(n.hpcOptimization,"autoEnabled")},preopen_ports:w(n.ports),...!y.supports("agent-select")||null!==y&&void 0!==y&&null!==(r=y._config)&&void 0!==r&&r.hideAgents||"auto"===n.agent?void 0:{agent_list:[n.agent].filter((e=>!!e))}}},g=p().map(p().range(n.num_of_sessions||1),(e=>{const s=(n.num_of_sessions||1)>1?`${v.sessionName}-${(0,N.kX)()}-${e}`:v.sessionName;return y.createIfNotExists(v.kernelName,s,v.config,void 0,v.architecture,v.batchTimeout).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(ae("session.launcher.SessionAlreadyExists"));if("CANCELLED"===(null===e||void 0===e?void 0:e.status))throw new Error(ae("session.launcher.FailedToStartNewSession"));return e})).catch((e=>{var n;throw null!==e&&void 0!==e&&null!==(n=e.message)&&void 0!==n&&n.includes("The session already exists")?new Error(ae("session.launcher.SessionAlreadyExists")):e}))}));F(n.resourceGroup);const A=window.location.pathname+window.location.search;Q(z||"/job"),ne({key:"session-launcher:"+u,backgroundTask:{promise:Promise.all(g),status:"pending",onChange:{pending:ae("session.PreparingSession"),resolved:ae("eduapi.ComputeSessionPrepared")}},duration:0,message:ae("general.Session")+": "+u,open:!0}),te({params:e,name:u}),await Promise.all(g).then((e=>{let[s]=e;if(ne({key:"session-launcher:"+u,to:`/session?sessionDetail=${s.sessionId}`}),1===n.num_of_sessions&&"batch"!==n.sessionType){const e=s;let n=p().cloneDeep(R);n="kernelId"in e?p().extend(n,{"session-name":e.kernelId,"access-key":"",mode:h}):p().extend(n,{"session-uuid":e.sessionId,"session-name":e.sessionName,"access-key":"",mode:h});const t=e.servicePorts;!0===Array.isArray(t)?n["app-services"]=t.map((e=>e.name)):n["app-services"]=[],t.length>0&&globalThis.appLauncher.showLauncher(n)}})).catch((()=>{ne({key:"session-launcher:"+u,to:A,toText:ae("button.Edit")})}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{T(!1)}))},loading:E,children:ae("session.launcher.Launch")})}):(0,x.jsxs)(H.Ay,{type:"primary",ghost:!0,onClick:()=>{le(D+1)},children:[ae("button.Next")," ",(0,x.jsx)(Ve.A,{})]}),D!==ge.length-1&&(0,x.jsxs)(H.Ay,{onClick:()=>{le(ge.length-1)},children:[ae("session.launcher.SkipToConfirmAndLaunch"),(0,x.jsx)(Ie.A,{})]})]})]})]})})})]}),de.lg&&(0,x.jsx)(o.A,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,x.jsx)(ze.A,{size:"small",direction:"vertical",current:D,onChange:e=>{le(e)},items:p().map(ge,((e,n)=>({...e,status:n===D?"process":"wait"})))})})]}),(0,x.jsx)(Fe,{onRequestClose:e=>{if(e){const n=p().merge({sessionName:"",ports:[],mounts:[],vfoldersAliasMap:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0},agent:"auto"},e);p().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,N.kX)(4)),me.setFieldsValue(n),le(ge.length-1),me.validateFields().catch((()=>{}))}Z()},open:Y}),D===ge.length-1?(0,x.jsx)(Le.tH,{fallback:null,children:(0,x.jsx)(V,{open:Ue,onClose:()=>{We(!1)},scrollIntoViewOptions:!0})}):void 0]})}}}]);
//# sourceMappingURL=4045.bbb61bea.chunk.js.map