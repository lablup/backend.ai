"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[4132],{7786:(e,n,s)=>{s.d(n,{A:()=>u});var t=s(51847),l=s(10353),i=s(78502),o=s.n(i),r=s(46976),a=s.n(r),d=s(53350),c=s(60598);const u=d.forwardRef(((e,n)=>{let{value:s,onChange:i,localFormat:r,...d}=e;const[,u]=(0,t.A)({value:s,onChange:i});return(0,c.jsx)(l.A,{ref:n,value:s?o()(s):void 0,onChange:e=>{var n,s,t;a().isArray(e)&&(e=e[0]);const l=r?null===(n=e)||void 0===n?void 0:n.format():null===(s=e)||void 0===s||null===(t=s.tz())||void 0===t?void 0:t.toISOString();u(l)},...d})}))},9328:(e,n,s)=>{s.d(n,{A:()=>o});var t=s(13170),l=s(53350),i=s(60598);const o=e=>{let{value:n,...s}=e;const o=t.A.useFormInstance();return(0,l.useEffect)((()=>{o.setFieldValue(s.name,n)}),[n,o,s.name]),(0,i.jsx)(t.A.Item,{...s,hidden:!0})}},60661:(e,n,s)=>{s.d(n,{A:()=>c,j:()=>d});var t=s(13170),l=s(83978),i=s(46976),o=s.n(i),r=(s(53350),s(91788)),a=s(60598);const d=e=>[{min:4,message:e("session.validation.SessionNameTooShort")},{max:64,message:e("session.validation.SessionNameTooLong64")},{validator:(n,s)=>o().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/^[\w.-]*$/.test(s)?!/\w$/.test(s)&&s.length>=4?Promise.reject(e("session.validation.SessionNameShouldEndWith")):Promise.resolve():Promise.reject(e("session.validation.SessionNameInvalidCharacter")):Promise.reject(e("session.validation.SessionNameShouldStartWith"))}],c=e=>{let{...n}=e;const{t:s}=(0,r.Bd)();return(0,a.jsx)(t.A.Item,{label:s("session.launcher.SessionName"),name:"sessionName",rules:d(s),...n,children:(0,a.jsx)(l.A,{allowClear:!0,autoComplete:"off"})})}},60726:(e,n,s)=>{s.r(n),s.d(n,{default:()=>l});const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],s={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},l],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,i],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s,l],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,i,l],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();t.hash="ba086835ea654ab889e0e6aaefa0abfe";const l=t},94132:(e,n,s)=>{s.r(n),s.d(n,{ResourceNumbersOfSession:()=>Be,default:()=>Re});var t=s(30331),l=s(7786),i=s(4101),o=s(72338),r=s(60828),a=s(26672),d=s(23441),c=s(13170),u=s(1581),m=s(24798),h=s(46976),v=s.n(h),p=s(53350),g=s(91788),x=s(60598);const A=1024,y=65535,j=e=>{let{inValid:n,value:s,...t}=e;return(0,x.jsx)(m.A,{color:!n&&b(s)?void 0:"red",...t})},b=e=>{if(F(e)){const n=e.split(":"),[s,t]=n.map((e=>parseInt(e)));return s>=A&&t<=y}return e===parseInt(e).toString()&&parseInt(e)>=A&&parseInt(e)<=y},F=e=>{const n=e.split(":");if(2===n.length){const[e,s]=n.map((e=>parseInt(e)));return e<=s}return!1},w=e=>v().flatten(v().map(e,(e=>F(e)?(e=>{const[n,s]=e.split(":").map((e=>parseInt(e)));return v().range(n,s+1)})(e):parseInt(e)))),f=e=>{let{name:n="ports",...s}=e;const{t:t}=(0,g.Bd)(),l=(0,d.CX)(),i=c.A.useFormInstance();return(0,x.jsx)(c.A.Item,{label:t("session.launcher.PreOpenPortTitle"),name:n,tooltip:(0,x.jsx)(g.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:t("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,n)=>w(n).length<=l._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortMaxCountLimit",{count:l._config.maxCountForPreopenPorts})))}),()=>({validator:(e,n)=>v().every(n,(e=>parseInt(e).toString()===e||F(e)))?Promise.resolve():Promise.reject(new Error(t("session.launcher.InvalidPortFormat")))}),()=>({validator(e,n){const s=w(n);return v().every(s,(e=>e>=A&&e<=y))?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,n){const s=w(n);return v().uniq(s).length===s.length?Promise.resolve():Promise.reject(new Error(t("session.launcher.DuplicatedPort")))}})],...s,children:(0,x.jsx)(u.A,{mode:"tags",tagRender:e=>{const s=v().filter(w(i.getFieldValue(n)),(n=>n===parseInt(e.value))).length>1;return(0,x.jsx)(j,{inValid:s,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})};var S=s(26141),k=s(34363),T=s(39768),E=s(15324);const V=e=>{let{open:n,onClose:s,...t}=e;const{t:l}=(0,g.Bd)(),[i,o]=(0,T.q)("has_opened_tour_neo_session_validation"),r=[{title:l("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:l("tourGuide.neoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:l("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:l("tourGuide.neoSessionLauncher.FixErrorFieldByModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:l("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:l("tourGuide.neoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,x.jsx)(E.A,{steps:r,onClose:e=>{null===s||void 0===s||s(e),o(!0)},open:!i&&n,...t})};var I,N=s(72375),_=s(81530),P=s(23524),C=s(29217),O=s(91238),D=s(90184),M=s(32715),B=s(7971),z=s(73e3),R=s(22407),L=s(9328),q=s(87258),G=s(9571),K=s(20418),U=s(77109),W=s(83978),H=s(52335),$=s(92351),J=s(56625),X=s(8227),Q=s(31456),Y=s(22018);const Z=e=>{const{t:n}=(0,g.Bd)(),s=c.A.useFormInstance(),t=c.A.useWatch(["owner","enabled"],s),l=(0,B.Am)();return("admin"===l||"superadmin"===l)&&t&&(0,x.jsx)(C.A,{title:n("session.launcher.SetSessionOwner"),showDivider:!0,size:"small",status:s.getFieldError(["owner","email"]).length>0||s.getFieldError(["owner","accesskey"]).length>0||s.getFieldError(["owner","project"]).length>0||s.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit"),...e,children:(0,x.jsxs)(X.A,{size:"small",column:1,children:[(0,x.jsx)(X.A.Item,{label:n("session.launcher.OwnerEmail"),children:s.getFieldValue(["owner","email"])}),(0,x.jsx)(X.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:s.getFieldValue(["owner","accesskey"])}),(0,x.jsx)(X.A.Item,{label:n("session.launcher.OwnerGroup"),children:s.getFieldValue(["owner","project"])}),(0,x.jsx)(X.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:s.getFieldValue(["owner","resourceGroup"])})]})})},ee=e=>{const{t:n}=(0,g.Bd)(),{token:t}=G.A.useToken(),l=c.A.useFormInstance(),i=c.A.useWatch(["owner","enabled"],l),[r,a]=(0,p.useState)(),d=(0,Y.useRelayEnvironment)(),{data:m,isFetching:h}=(0,z.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",r],queryFn:()=>{const e=l.getFieldValue(["owner","email"]);if(!e)return;const n=void 0!==I?I:I=s(60726);return(0,Y.fetchQuery)(d,n,{email:e}).toPromise()},enabled:!!r}),A=l.getFieldValue(["owner","email"])?null===m||void 0===m?void 0:m.keypairs:void 0,y=l.getFieldValue(["owner","email"])?null===m||void 0===m?void 0:m.user:void 0,j=!h&&r&&!y;return(0,x.jsxs)(K.A,{title:n("session.launcher.SetSessionOwner"),extra:(0,x.jsx)(c.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,x.jsx)(U.A,{})}),styles:i?void 0:{header:{borderBottom:"none"},body:{display:i?"block":"none"}},...e,children:[(0,x.jsx)(L.A,{name:["owner","domainName"],value:null===y||void 0===y?void 0:y.domain_name}),(0,x.jsx)(c.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(o.A,{children:(0,x.jsx)(c.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:i},{type:"email",message:n("credential.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:j?"error":void 0,help:j?n("credential.NoUserToDisplay"):void 0,children:(0,x.jsx)(W.A.Search,{onSearch:e=>{l.validateFields([["owner","email"]]).then((()=>{a(e)})).catch((()=>{}))},onChange:()=>{a(""),l.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:h,enterButton:!h&&y?(0,x.jsx)(H.Ay,{icon:(0,x.jsx)(Q.A,{})}):void 0})})}),(0,x.jsx)(c.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:s(["owner","enabled"])}],children:(0,x.jsx)(R.A,{options:v().map(A,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:v().isEmpty(r)||h})}),(0,x.jsxs)($.A,{gutter:t.marginSM,children:[(0,x.jsx)(J.A,{span:12,children:(0,x.jsx)(c.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,x.jsx)(R.A,{options:v().map(null===y||void 0===y?void 0:y.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:v().isEmpty(r)||h})})}),(0,x.jsx)(J.A,{span:12,children:(0,x.jsx)(c.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,x.jsx)(p.Suspense,{fallback:(0,x.jsx)(c.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,x.jsx)(u.A,{loading:!0})}),children:(0,x.jsx)(c.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:s(["owner","project"])?(0,x.jsx)(q.A,{projectName:s(["owner","project"]),disabled:v().isEmpty(r)||h,autoSelectDefault:!0}):(0,x.jsx)(u.A,{disabled:!0})})})}})})]})]})}})]})};var ne=s(80060),se=s(50128),te=s(40056),le=s(58325),ie=s(37826),oe=s(78502),re=s.n(oe),ae=s(51355),de=s(81911);const ce=e=>{var n,s,t,l,i,r,a,u,h,p,A,y,b,F,w,f,S,k,T,E,V,I,B,z,R,L,q,U,W,H,Q,Y,ee,oe,ce,ue;let{onClickEditStep:me}=e;const{t:he}=(0,g.Bd)(),ve=c.A.useFormInstance(),{token:pe}=G.A.useToken(),ge=(0,d.CX)(),xe=c.A.useWatch("sessionType",{form:ve,preserve:!0}),Ae=null!==(n=null===ge||void 0===ge?void 0:ge.supports("batch-timeout"))&&void 0!==n&&n,ye=null!==(s=null===ge||void 0===ge?void 0:ge.supports("extended-image-info"))&&void 0!==s&&s,je=(0,_.hd)(),[,{getBaseVersion:be,getBaseImage:Fe,tagAlias:we}]=(0,d.Gj)(),{isDarkMode:fe}=(0,P.e)();return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(C.A,{title:he("session.launcher.SessionType"),showDivider:!0,size:"small",status:ve.getFieldError("sessionName").length>0||ve.getFieldError(["batch","command"]).length>0||ve.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("sessionType")},children:(0,x.jsxs)(X.A,{size:"small",column:1,children:[(0,x.jsx)(X.A.Item,{label:he("session.SessionType"),children:ve.getFieldValue("sessionType")}),!v().isEmpty(ve.getFieldValue("sessionName"))&&(0,x.jsx)(X.A.Item,{label:he("session.launcher.SessionName"),children:ve.getFieldValue("sessionName")}),"batch"===xe&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(X.A.Item,{label:he("session.launcher.StartUpCommand"),labelStyle:{whiteSpace:"nowrap"},contentStyle:{overflow:"auto"},children:ve.getFieldValue(["batch","command"])?(0,x.jsx)(ne.A,{language:"shell",children:ve.getFieldValue(["batch","command"])}):(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})}),(0,x.jsx)(X.A.Item,{label:he("session.launcher.SessionStartTime"),children:ve.getFieldValue(["batch","scheduleDate"])?re()(ve.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})}),Ae?(0,x.jsx)(X.A.Item,{label:he("session.launcher.BatchJobTimeoutDuration"),children:ve.getFieldValue(["batch","timeout"])?(0,x.jsxs)(se.A.Text,{children:[ve.getFieldValue(["batch","timeout"]),ve.getFieldValue(["batch","timeoutUnit"])||"s"]}):(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})}):null]})]})}),(0,x.jsx)(Z,{onClickExtraButton:()=>{me("sessionType")}}),(0,x.jsx)(C.A,{title:he("session.launcher.Environments"),showDivider:!0,size:"small",status:v().some(ve.getFieldValue("envvars"),((e,n)=>ve.getFieldError(["envvars",n,"variable"]).length>0||ve.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("environment")},children:(0,x.jsxs)(X.A,{size:"small",column:1,children:[(0,x.jsx)(X.A.Item,{label:he("session.launcher.Project"),children:je.name}),(0,x.jsx)(X.A.Item,{label:he("general.Image"),children:ye?(0,x.jsxs)($.A,{style:{flexFlow:"nowrap"},children:[(0,x.jsx)(J.A,{children:(0,x.jsx)(D.A,{image:(null===(t=ve.getFieldValue("environments"))||void 0===t?void 0:t.version)||(null===(l=ve.getFieldValue("environments"))||void 0===l?void 0:l.manual),style:{marginRight:pe.marginXS}})}),(0,x.jsx)(J.A,{children:(0,x.jsx)(o.A,{direction:"row",wrap:"wrap",children:null!==(i=ve.getFieldValue("environments"))&&void 0!==i&&i.manual?(0,x.jsx)(se.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(r=ve.getFieldValue("environments"))||void 0===r?void 0:r.manual},children:null===(a=ve.getFieldValue("environments"))||void 0===a?void 0:a.manual}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(se.A.Text,{children:we(null===(u=ve.getFieldValue("environments"))||void 0===u||null===(h=u.image)||void 0===h?void 0:h.base_image_name)}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(se.A.Text,{children:null===(p=ve.getFieldValue("environments"))||void 0===p||null===(A=p.image)||void 0===A?void 0:A.version}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(se.A.Text,{children:null===(y=ve.getFieldValue("environments"))||void 0===y||null===(b=y.image)||void 0===b?void 0:b.architecture}),(0,x.jsx)(te.A,{type:"vertical"}),v().map(null===(F=ve.getFieldValue("environments"))||void 0===F||null===(w=F.image)||void 0===w?void 0:w.tags,(e=>{var n,s,t;const l=v().includes(e.key,"customized_"),i=l?null===(n=v().find(null===(s=ve.getFieldValue("environments"))||void 0===s||null===(t=s.image)||void 0===t?void 0:t.labels,{key:"ai.backend.customized-image.name"}))||void 0===n?void 0:n.value:e.value,o=we(e.key+i);return v().isEqual(o,(0,N.WY)(e.key+i))?(0,x.jsx)(O.A,{values:[{label:we(e.key),color:l?"cyan":"blue"},{label:i,color:l?"cyan":"blue"}]},e.key):(0,x.jsx)(m.A,{color:l?"cyan":"blue",children:o},e.key)})),(0,x.jsx)(se.A.Text,{style:{color:pe.colorPrimary},copyable:{text:(0,N.A_)(null===(f=ve.getFieldValue("environments"))||void 0===f?void 0:f.image)||(null===(S=ve.getFieldValue("environments"))||void 0===S?void 0:S.version)}})]})})})]}):(0,x.jsxs)($.A,{style:{flexFlow:"nowrap",gap:pe.sizeXS},children:[(0,x.jsx)(J.A,{children:(0,x.jsx)(D.A,{image:(null===(k=ve.getFieldValue("environments"))||void 0===k?void 0:k.version)||(null===(T=ve.getFieldValue("environments"))||void 0===T?void 0:T.manual)})}),(0,x.jsx)(J.A,{children:(0,x.jsx)(o.A,{direction:"row",wrap:"wrap",children:null!==(E=ve.getFieldValue("environments"))&&void 0!==E&&E.manual?(0,x.jsx)(se.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(V=ve.getFieldValue("environments"))||void 0===V?void 0:V.manual},children:null===(I=ve.getFieldValue("environments"))||void 0===I?void 0:I.manual}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(se.A.Text,{children:we(Fe(null===(B=ve.getFieldValue("environments"))||void 0===B?void 0:B.version))}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(se.A.Text,{children:be(null===(z=ve.getFieldValue("environments"))||void 0===z?void 0:z.version)}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(se.A.Text,{children:null===(R=ve.getFieldValue("environments"))||void 0===R||null===(L=R.image)||void 0===L?void 0:L.architecture}),(0,x.jsx)(te.A,{type:"vertical"}),(0,x.jsx)(M.Jj,{tag:ve.getFieldValue(["environments","image","tag"]),labels:null===(q=ve.getFieldValue("environments"))||void 0===q||null===(U=q.image)||void 0===U?void 0:U.labels}),(0,x.jsx)(se.A.Text,{style:{color:pe.colorPrimary},copyable:{text:(0,N.A_)(null===(W=ve.getFieldValue("environments"))||void 0===W?void 0:W.image)||(null===(H=ve.getFieldValue("environments"))||void 0===H?void 0:H.version)}})]})})})]})}),(null===(Q=ve.getFieldValue("envvars"))||void 0===Q?void 0:Q.length)>0&&(0,x.jsx)(X.A.Item,{label:he("session.launcher.EnvironmentVariable"),children:null!==(Y=ve.getFieldValue("envvars"))&&void 0!==Y&&Y.length?(0,x.jsx)(ae.A,{style:fe?de.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:v().map(ve.getFieldValue("envvars"),(e=>`${(null===e||void 0===e?void 0:e.variable)||""}="${(null===e||void 0===e?void 0:e.value)||""}"`)).join("\n")}):(0,x.jsx)(se.A.Text,{type:"secondary",children:"-"})})]})}),(0,x.jsx)(C.A,{title:he("session.launcher.ResourceAllocation"),showDivider:!0,status:v().some(ve.getFieldValue("resource"),((e,n)=>ve.getFieldError(["resource",n]).length>0))||ve.getFieldError(["num_of_sessions"]).length>0||ve.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("environment")},children:(0,x.jsxs)(o.A,{direction:"column",align:"stretch",children:[v().some(ve.getFieldValue("resource"),((e,n)=>ve.getFieldWarning(["resource",n]).length>0))&&(0,x.jsx)(le.A,{type:"warning",showIcon:!0,message:he("session.launcher.EnqueueComputeSessionWarning")}),(0,x.jsxs)(X.A,{column:2,children:[(0,x.jsx)(X.A.Item,{label:he("general.ResourceGroup"),span:2,children:ve.getFieldValue("resourceGroup")||(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})}),(0,x.jsx)(X.A.Item,{label:he("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,x.jsxs)(o.A,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===ve.getFieldValue("allocationPreset")?"":(0,x.jsx)(m.A,{children:ve.getFieldValue("allocationPreset")}),(0,x.jsx)(Be,{resource:ve.getFieldValue("resource")})]})}),ge.supports("agent-select")&&!(null!==ge&&void 0!==ge&&null!==(ee=ge._config)&&void 0!==ee&&ee.hideAgents)&&(0,x.jsx)(X.A.Item,{label:he("session.launcher.AgentNode"),children:ve.getFieldValue("agent")||he("session.launcher.AutoSelect")}),(0,x.jsx)(X.A.Item,{label:he("session.launcher.NumberOfContainer"),children:1===ve.getFieldValue("cluster_size")?ve.getFieldValue("num_of_sessions"):ve.getFieldValue("cluster_size")}),(0,x.jsx)(X.A.Item,{label:he("session.launcher.ClusterMode"),children:"single-node"===ve.getFieldValue("cluster_mode")?he("session.launcher.SingleNode"):he("session.launcher.MultiNode")})]}),(0,x.jsx)(K.A,{size:"small",type:"inner",title:he("session.launcher.TotalAllocation"),children:(0,x.jsx)(o.A,{direction:"row",gap:"xxs",children:(0,x.jsx)(Be,{resource:ve.getFieldValue("resource"),containerCount:1===ve.getFieldValue("cluster_size")?ve.getFieldValue("num_of_sessions"):ve.getFieldValue("cluster_size")})})})]})}),(0,x.jsx)(C.A,{title:he("webui.menu.Data&Storage"),showDivider:!0,size:"small",status:ve.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("storage")},children:(0,x.jsxs)(o.A,{direction:"column",align:"stretch",gap:"xs",children:[(null===(oe=ve.getFieldValue("mounts"))||void 0===oe?void 0:oe.length)>0?(0,x.jsx)(ie.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:he("data.folders.Name")},{dataIndex:"alias",title:he("session.launcher.FolderAlias"),render:(e,n)=>v().isEmpty(e)?(0,x.jsx)(se.A.Text,{type:"secondary",style:{opacity:.7},children:`/home/work/${n.name}`}):e}],dataSource:v().map(ve.getFieldValue("mounts"),(e=>{var n;return{name:e,alias:null===(n=ve.getFieldValue("vfoldersAliasMap"))||void 0===n?void 0:n[e]}}))}):(0,x.jsx)(le.A,{type:"warning",showIcon:!0,message:he("session.launcher.NoFolderMounted")}),(null===(ce=ve.getFieldValue("autoMountedFolderNames"))||void 0===ce?void 0:ce.length)>0?(0,x.jsx)(X.A,{size:"small",children:(0,x.jsx)(X.A.Item,{label:he("data.AutomountFolders"),children:v().map(ve.getFieldValue("autoMountedFolderNames"),(e=>(0,x.jsx)(m.A,{children:e})))})}):null]})}),(0,x.jsx)(C.A,{title:"Network",showDivider:!0,size:"small",status:ve.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{me("network")},children:(0,x.jsx)(X.A,{size:"small",children:(0,x.jsx)(X.A.Item,{label:he("session.launcher.PreOpenPortTitle"),children:(0,x.jsxs)(o.A,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[v().sortBy(ve.getFieldValue("ports"),(e=>parseInt(e))).map((e=>(0,x.jsx)(j,{value:e,style:{margin:0},children:e}))),v().isArray(ve.getFieldValue("ports"))&&0!==(null===(ue=ve.getFieldValue("ports"))||void 0===ue?void 0:ue.length)?null:(0,x.jsx)(se.A.Text,{type:"secondary",children:he("general.None")})]})})})})]})};var ue=s(60661),me=s(68098);const he=()=>{const[e,n]=(0,T.q)("recentSessionHistory"),s=(0,me.E)((s=>{let{id:t,params:l,createdAt:i}=s;const o=[{id:null!==t&&void 0!==t?t:(0,N.kX)(8),params:l,createdAt:null!==i&&void 0!==i?i:(new Date).toISOString()},...e||[]].slice(0,5);n(o)})),t=(0,me.E)((()=>n([]))),l=(0,me.E)((s=>{const t=(e||[]).filter((e=>e.id!==s));n(t)}));return[e,{push:s,clear:t,remove:l}]};var ve=s(9189);const pe=e=>{let{...n}=e;const{t:s}=(0,g.Bd)(),[t]=he(),[,{getImageAliasName:l,getBaseVersion:i}]=(0,d.Gj)(),[r,a]=(0,p.useState)(),c=(0,p.useMemo)((()=>v().map(t,(e=>{const n=new URLSearchParams(e.params),s=JSON.parse(n.get("formValues")||"{}");return{...e,...s}}))),[t]);return(0,x.jsxs)(ve.A,{width:800,title:s("session.launcher.RecentHistory"),okButtonProps:{disabled:!r},okText:s("button.Apply"),...n,onOk:e=>{var s,l;const i=null===(s=v().find(t,{id:r}))||void 0===s?void 0:s.params;null===(l=n.onRequestClose)||void 0===l||l.call(n,JSON.parse(new URLSearchParams(i).get("formValues")||"{}"))},onCancel:()=>{a(void 0),n.onRequestClose()},children:[(0,x.jsx)(te.A,{style:{margin:0}}),(0,x.jsx)(ie.A,{showHeader:!1,scroll:{x:"max-content"},dataSource:c,pagination:!1,rowSelection:{type:"radio",selectedRowKeys:r?[r]:[],onSelect:e=>{a(e.id)}},onRow:e=>({onClick:()=>{a(e.id)}}),rowKey:e=>e.id,columns:[{title:s("general.Image"),dataIndex:["environments","version"],render:(e,n)=>{const s=n.environments.version||n.environments.manual;return!!s&&(0,x.jsxs)(o.A,{gap:"xs",children:[(0,x.jsx)(D.A,{image:s}),(0,x.jsx)(se.A.Text,{children:l(s)}),(0,x.jsx)(se.A.Text,{children:i(s)}),(0,x.jsx)(se.A.Text,{children:n.sessionName?`(${n.sessionName})`:null})]})}},{title:s("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,x.jsx)(o.A,{children:(0,x.jsx)(Be,{resource:e})})},{title:s("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>re()(e).fromNow()}]})]})};var ge=s(19528),xe=s(25905);var Ae=s(73247),ye=s(30351),je=s(23374),be=s(71945),Fe=s(57849),we=s(25834),fe=s(40915),Se=s(67316),ke=s(67710),Te=s(9769),Ee=s(58668),Ve=s(92280),Ie=s(88005),Ne=s(24034),_e=s(82919),Pe=s(24551),Ce=s(7322),Oe=s(82454),De=s(50423),Me=s(32043);const Be=e=>{let{resource:n,containerCount:s=1}=e;return(0,x.jsxs)(x.Fragment,{children:[v().map(v().omit(n,"shmem","accelerator","acceleratorType"),((e,t)=>{var l,i;return"0"===e?null:(0,x.jsx)(k.A,{type:t,value:"mem"===t?((null===(l=(0,N.Is)(e.toString(),"b"))||void 0===l?void 0:l.number)||0)*s+"":v().toNumber(e)*s+"",opts:{shmem:n.shmem?((null===(i=(0,N.Is)(n.shmem,"b"))||void 0===i?void 0:i.number)||0)*s:void 0}},t)})),n&&n.accelerator&&n.acceleratorType&&v().isNumber(n.accelerator)?(0,x.jsx)(k.A,{type:n.acceleratorType,value:v().toString(n.accelerator*s)}):null]})},ze=()=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<8;s++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},Re=()=>{var e,n,s;const m=ke.A.useApp();let h="normal";const A=(0,Ce.md)(a.i7),y=(0,d.CX)(),j=(0,B.Am)(),[b,F]=(0,_.zL)(),k=null!==(e=null===y||void 0===y?void 0:y.supports("batch-timeout"))&&void 0!==e&&e,[T,E]=(0,p.useState)(!1),I=(0,p.useMemo)((()=>{var e,n;return{sessionType:"interactive",allocationPreset:"auto-select",hpcOptimization:{autoEnabled:!0},batch:{enabled:!1,command:void 0,scheduleDate:void 0,...k&&{timeoutEnabled:!1,timeout:void 0,timeoutUnit:"s"}},envvars:[],...(null===(e=y._config)||void 0===e?void 0:e.default_session_environment)&&{environments:{environment:null===(n=y._config)||void 0===n?void 0:n.default_session_environment}},...S.jh,resourceGroup:b||void 0}}),[null===(n=y._config)||void 0===n?void 0:n.default_session_environment,b,k]),P=(0,Me.withDefault)(Me.NumberParam,0),C=(0,Me.withDefault)(Me.JsonParam,I),O=(0,Me.withDefault)(Me.JsonParam,{}),[{step:D,formValues:M,redirectTo:z,appOption:R},L]=(0,Me.useQueryParams)({step:P,formValues:C,redirectTo:Me.StringParam,appOption:O}),{search:q}=(0,De.zy)(),X=(0,d.f0)(),Q=(0,_.hd)(),[Y,{toggle:Z}]=(0,fe.A)(),{upsertNotification:ne}=(0,xe.js)(),[,{push:te}]=he(),{run:le}=(0,Se.A)((()=>{const e=me.getFieldsValue();L({formValues:v().extend(v().omit(me.getFieldsValue(),["environments.image"],["environments.customizedTag"],["autoMountedFolderNames"],["owner"],["envvars"]),{envvars:(0,i.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),ie=e=>{L({step:e},"pushIn")},{token:oe}=G.A.useToken(),{t:ae}=(0,g.Bd)(),de=Te.Ay.useBreakpoint(),[me]=c.A.useForm();(0,p.useEffect)((()=>{v().isEmpty(M)||me.validateFields().catch((e=>{}))}),[]);const ve=(0,p.useMemo)((()=>v().merge({},I,M)),[I,M]);(0,p.useEffect)((()=>{var e;null===(e=A.current)||void 0===e||e.scrollTo(0,0)}),[D]);const Be=c.A.useWatch("sessionType",{form:me,preserve:!0})||me.getFieldValue("sessionType")||M.sessionType,Re=(0,N.LY)([{title:ae("session.launcher.SessionType"),key:"sessionType"},{title:`${ae("session.launcher.Environments")} & ${ae("session.launcher.ResourceAllocation")} `,key:"environment"},"inference"!==Be&&{title:ae("webui.menu.Data&Storage"),key:"storage"},{title:ae("session.launcher.Network"),key:"network"},{title:ae("session.launcher.ConfirmAndLaunch"),icon:(0,x.jsx)(Ae.A,{}),key:"review"}]),Le=null===(s=Re[D])||void 0===s?void 0:s.key,qe=v().some(me.getFieldsError(),(e=>e.errors.length>0)),[Ge,Ke]=(0,d.Tw)("first");(0,p.useEffect)((()=>{D===Re.length-1&&me.validateFields().catch((e=>{})).finally((()=>Ke()))}),[D,me,Ke,Re.length]),(0,p.useEffect)((()=>{"first"!==Ge&&We(!!qe)}),[Ge,qe]);const[Ue,We]=(0,p.useState)(!1),[He,$e]=(0,p.useState)(!1);return(0,p.useLayoutEffect)((()=>{He&&(me.resetFields(),$e(!1))}),[He,me]),(0,x.jsxs)(o.A,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,x.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,x.jsxs)(o.A,{direction:"row",gap:"md",align:"start",children:[(0,x.jsxs)(o.A,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,x.jsxs)(o.A,{direction:"row",justify:"between",children:[(0,x.jsx)(se.A.Title,{level:4,style:{marginTop:0},children:ae("session.launcher.StartNewSession")}),(0,x.jsx)(o.A,{direction:"row",gap:"sm",children:(0,x.jsx)(H.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>Z(),children:ae("session.launcher.RecentHistory")})})]}),(0,x.jsx)(c.A.Provider,{onFormChange:(e,n)=>{le()},children:(0,x.jsx)(c.A,{form:me,layout:"vertical",requiredMark:"optional",initialValues:ve,children:(0,x.jsxs)(o.A,{direction:"column",align:"stretch",gap:"md",children:[(0,x.jsxs)(K.A,{title:ae("session.launcher.SessionType"),style:{display:"sessionType"===Le?"block":"none"},children:[(0,x.jsx)(c.A.Item,{name:"sessionType",children:(0,x.jsx)(Ee.Ay.Group,{options:[{label:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(se.A.Text,{code:!0,children:ae("session.launcher.InteractiveMode")})," ",(0,x.jsx)(se.A.Text,{type:"secondary",children:ae("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(se.A.Text,{code:!0,children:ae("session.launcher.BatchMode")})," ",(0,x.jsx)(se.A.Text,{type:"secondary",children:ae("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,x.jsx)(ue.A,{}),(0,x.jsx)(c.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,x.jsx)(W.A,{})})]}),"batch"===Be&&(0,x.jsxs)(K.A,{title:ae("session.launcher.BatchModeConfig"),style:{display:"sessionType"===Le?"block":"none"},children:[(0,x.jsx)(c.A.Item,{label:ae("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,x.jsx)(W.A.TextArea,{autoSize:!0})}),(0,x.jsx)(c.A.Item,{noStyle:!0,dependencies:[["batch","scheduleDate"]],children:()=>{const e=me.getFieldValue(["batch","scheduleDate"]);return(0,x.jsx)(t.A,{delay:1e3,callback:()=>{const e=me.getFieldValue(["batch","scheduleDate"]);return e?re()(e).isBefore(re()())?void(0===me.getFieldError(["batch","scheduleDate"]).length&&me.validateFields([["batch","scheduleDate"]])):re()(e).fromNow():void 0},triggerKey:e||"none",render:e=>(0,x.jsx)(c.A.Item,{label:ae("session.launcher.SessionStartTime"),extra:e,children:(0,x.jsxs)(o.A,{direction:"row",gap:"xs",children:[(0,x.jsx)(c.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,x.jsx)(Ve.A,{onChange:e=>{e.target.checked&&v().isEmpty(me.getFieldValue(["batch","scheduleDate"]))?me.setFieldValue(["batch","scheduleDate"],re()().add(2,"minutes").toISOString()):!1===e.target.checked&&me.setFieldValue(["batch","scheduleDate"],void 0),me.validateFields([["batch","scheduleDate"]])},children:ae("session.launcher.Enable")})}),(0,x.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,t;return(null===(s=e.batch)||void 0===s?void 0:s.enabled)!==(null===(t=n.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const n=!0!==(null===(e=me.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(c.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&re()(n).isBefore(re()())?Promise.reject(ae("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,x.jsx)(l.A,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(re()().startOf("day"))})})})}})]})})})}}),k?(0,x.jsx)(c.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"],["batch","timeoutUnit"]],children:()=>{const e=me.getFieldValue(["batch","timeout"]),n=me.getFieldValue(["batch","timeoutUnit"]),s=re().duration(e,null!==n&&void 0!==n?n:"s"),t=(0,N.a3)(s,ae),l=!v().isNull(e)&&v().toFinite(e)>0?t:null;return(0,x.jsx)(c.A.Item,{label:ae("session.launcher.BatchJobTimeoutDuration"),tooltip:ae("session.launcher.BatchJobTimeoutDurationDesc"),help:l,children:(0,x.jsxs)(o.A,{direction:"row",gap:"xs",children:[(0,x.jsx)(c.A.Item,{noStyle:!0,name:["batch","timeoutEnabled"],valuePropName:"checked",children:(0,x.jsx)(Ve.A,{onChange:e=>{!1===e.target.checked&&me.setFieldValue(["batch","timeout"],void 0),me.validateFields([["batch","timeout"]])},children:ae("session.launcher.Enable")})}),(0,x.jsx)(c.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"]],children:()=>{const e=!0!==me.getFieldValue(["batch","timeoutEnabled"]);return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(c.A.Item,{name:["batch","timeout"],label:ae("session.launcher.BatchJobTimeoutDuration"),noStyle:!0,rules:[{min:0,type:"number",message:ae("error.AllowsPositiveNumberOnly")},{required:!e}],children:(0,x.jsx)(Ie.A,{disabled:e,min:1,addonAfter:(0,x.jsx)(c.A.Item,{noStyle:!0,name:["batch","timeoutUnit"],children:(0,x.jsx)(u.A,{tabIndex:-1,style:{minWidth:75},options:[{label:ae("time.Sec"),value:"s"},{label:ae("time.Min"),value:"m"},{label:ae("time.Hour"),value:"h"},{label:ae("time.Day"),value:"d"},{label:ae("time.Week"),value:"w"}]})})})})})}})]})})}}):null]}),("admin"===j||"superadmin"===j)&&(0,x.jsx)(ee,{style:{display:"sessionType"===Le?"block":"none"}}),"inference"===Be&&(0,x.jsx)(K.A,{title:"Inference Mode Configuration",children:(0,x.jsx)(c.A.Item,{name:["inference","vFolderName"],label:ae("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,x.jsx)(u.A,{})})}),(0,x.jsxs)(K.A,{title:ae("session.launcher.Environments"),style:{display:"environment"===Le?"block":"none"},children:[(0,x.jsx)(Oe.tH,{fallbackRender:e=>(console.log(e),null),children:(0,x.jsx)(r.A,{})}),(0,x.jsx)(c.A.Item,{label:ae("session.launcher.EnvironmentVariable"),children:(0,x.jsx)(i.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,x.jsx)(K.A,{title:ae("session.launcher.ResourceAllocation"),style:{display:"environment"===Le?"block":"none"},children:(0,x.jsx)(S.Ay,{enableAgentSelect:!y._config.hideAgents&&y.supports("agent-select"),enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,x.jsxs)(K.A,{title:ae("session.launcher.HPCOptimization"),style:{display:"environment"===Le?"block":"none"},children:[(0,x.jsx)(c.A.Item,{noStyle:!0,children:(0,x.jsxs)(o.A,{direction:"row",gap:"sm",children:[(0,x.jsx)(se.A.Text,{children:ae("session.launcher.SwitchOpenMPoptimization")}),(0,x.jsx)(c.A.Item,{label:ae("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,x.jsx)(U.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e?me.setFieldsValue({hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:void 0,OPENBLAS_NUM_THREADS:void 0}}):me.setFieldsValue({hpcOptimization:{autoEnabled:!1,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"}})}})})]})}),(0,x.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,t;return(null===(s=e.hpcOptimization)||void 0===s?void 0:s.autoEnabled)!==(null===(t=n.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=me.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,x.jsxs)($.A,{gutter:oe.marginMD,style:{display:e?"none":void 0,marginTop:oe.marginMD},children:[(0,x.jsx)(J.A,{xs:24,sm:12,children:(0,x.jsx)(c.A.Item,{style:{flex:1},label:ae("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,x.jsxs)(x.Fragment,{children:[ae("session.launcher.OpenMPOptimization"),(0,x.jsx)(g.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,x.jsx)(Ie.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,x.jsx)(J.A,{xs:24,sm:12,children:(0,x.jsx)(c.A.Item,{style:{flex:1},label:ae("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,x.jsxs)(x.Fragment,{children:[ae("session.launcher.OpenMPOptimization"),(0,x.jsx)(g.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,x.jsx)(Ie.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,x.jsx)(K.A,{title:ae("webui.menu.Data&Storage"),style:{display:"storage"===Le?"block":"none"},children:(0,x.jsx)(ge.A,{filter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))}})}),(0,x.jsx)(K.A,{title:ae("session.launcher.Network"),style:{display:"network"===Le?"block":"none"},children:(0,x.jsx)(f,{})}),"review"===Le&&(0,x.jsx)(ce,{onClickEditStep:e=>{const n=v().findIndex(Re,{key:e});ie(n)}}),(0,x.jsxs)(o.A,{direction:"row",justify:"between",children:[(0,x.jsx)(o.A,{gap:"sm",children:(0,x.jsx)(Ne.A,{title:ae("button.Reset"),description:ae("session.launcher.ResetFormConfirm"),onConfirm:()=>{L({},"replace"),$e(!0)},icon:(0,x.jsx)(ye.A,{style:{color:oe.colorError}}),okText:ae("button.Reset"),okButtonProps:{danger:!0},children:(0,x.jsx)(H.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:ae("button.Reset")})})}),(0,x.jsxs)(o.A,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[D>0&&(0,x.jsx)(H.Ay,{onClick:()=>{ie(D-1)},icon:(0,x.jsx)(je.A,{}),disabled:T,children:ae("button.Previous")}),D===Re.length-1?(0,x.jsx)(_e.A,{title:qe?ae("session.launcher.PleaseCompleteForm"):void 0,children:(0,x.jsx)(H.Ay,{type:"primary",icon:(0,x.jsx)(be.A,{}),disabled:qe,onClick:()=>{E(!0);const e=q;me.validateFields().then((async n=>{var s,t,l,i,o,r;if(v().isEmpty(n.mounts)||0===n.mounts.length){if(!await new Promise((e=>{m.modal.confirm({title:ae("session.launcher.NoFolderMounted"),content:(0,x.jsxs)(x.Fragment,{children:[ae("session.launcher.HomeDirectoryDeletionDialog"),(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),ae("session.launcher.LaunchConfirmationDialog"),(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),ae("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:ae("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const a=n.environments.manual||n.environments.version;let[d,c]=a?a.split("@"):["",""];const u=v().isEmpty(n.sessionName)?ze():n.sessionName,p={kernelName:d,architecture:c,sessionName:u,...k&&null!==n&&void 0!==n&&null!==(s=n.batch)&&void 0!==s&&s.timeoutEnabled&&!v().isUndefined(null===n||void 0===n||null===(t=n.batch)||void 0===t?void 0:t.timeout)?{batchTimeout:v().toString(n.batch.timeout)+(null===n||void 0===n||null===(l=n.batch)||void 0===l?void 0:l.timeoutUnit)}:void 0,config:{...!y.supports("agent-select")||null!==y&&void 0!==y&&null!==(i=y._config)&&void 0!==i&&i.hideAgents||"auto"===n.agent?void 0:{agent_list:[n.agent].filter((e=>!!e))},type:n.sessionType,...v().isEmpty(n.bootstrap_script)?{}:{bootstrap_script:n.bootstrap_script},..."batch"===n.sessionType?{startsAt:n.batch.enabled?n.batch.scheduleDate:void 0,startupCommand:n.batch.command}:{},...null!==(o=n.owner)&&void 0!==o&&o.enabled?{group_name:n.owner.project,domain:n.owner.domainName,scaling_group:n.owner.project,owner_access_key:n.owner.accesskey}:{group_name:Q.name,domain:y._config.domainName,scaling_group:n.resourceGroup},cluster_mode:n.cluster_mode,cluster_size:n.cluster_size,maxWaitSeconds:15,cpu:n.resource.cpu,mem:n.resource.mem,shmem:(0,N.Mh)(n.resource.mem,"4g")>0&&(0,N.Mh)(n.resource.shmem,"1g")<0?"1g":n.resource.shmem,...n.resource.accelerator>0?{[n.resource.acceleratorType]:n.resource.accelerator}:void 0,mounts:n.mounts,mount_map:n.vfoldersAliasMap,env:{...v().fromPairs(n.envvars.map((e=>[e.variable,e.value]))),...n.hpcOptimization.autoEnabled?{}:v().omit(n.hpcOptimization,"autoEnabled")},preopen_ports:w(n.ports),...!y.supports("agent-select")||null!==y&&void 0!==y&&null!==(r=y._config)&&void 0!==r&&r.hideAgents||"auto"===n.agent?void 0:{agent_list:[n.agent].filter((e=>!!e))}}},g=v().map(v().range(n.num_of_sessions||1),(e=>{const s=(n.num_of_sessions||1)>1?`${p.sessionName}-${(0,N.kX)()}-${e}`:p.sessionName;return y.createIfNotExists(p.kernelName,s,p.config,void 0,p.architecture,p.batchTimeout).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(ae("session.launcher.SessionAlreadyExists"));if("CANCELLED"===(null===e||void 0===e?void 0:e.status))throw new Error(ae("session.launcher.FailedToStartNewSession"));return e})).catch((e=>{var n;throw null!==e&&void 0!==e&&null!==(n=e.message)&&void 0!==n&&n.includes("The session already exists")?new Error(ae("session.launcher.SessionAlreadyExists")):e}))}));F(n.resourceGroup);const A=window.location.pathname+window.location.search;X(z||"/job"),ne({key:"session-launcher:"+u,backgroundTask:{promise:Promise.all(g),status:"pending",onChange:{pending:ae("session.PreparingSession"),resolved:ae("eduapi.ComputeSessionPrepared")}},duration:0,message:ae("general.Session")+": "+u,open:!0}),await Promise.all(g).then((s=>{let[t]=s;if(ne({key:"session-launcher:"+u,to:`/session?sessionDetail=${t.sessionId}`}),te({id:t.sessionId,params:e,name:t.sessionName}),1===n.num_of_sessions&&"batch"!==n.sessionType){const e=t;let n=v().cloneDeep(R);n="kernelId"in e?v().extend(n,{"session-name":e.kernelId,"access-key":"",mode:h}):v().extend(n,{"session-uuid":e.sessionId,"session-name":e.sessionName,"access-key":"",mode:h});const s=e.servicePorts;!0===Array.isArray(s)?n["app-services"]=s.map((e=>e.name)):n["app-services"]=[],s.length>0&&globalThis.appLauncher.showLauncher(n)}})).catch((()=>{ne({key:"session-launcher:"+u,to:A,toText:ae("button.Edit")})}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{E(!1)}))},loading:T,children:ae("session.launcher.Launch")})}):(0,x.jsxs)(H.Ay,{type:"primary",ghost:!0,onClick:()=>{ie(D+1)},children:[ae("button.Next")," ",(0,x.jsx)(Fe.A,{})]}),D!==Re.length-1&&(0,x.jsxs)(H.Ay,{onClick:()=>{ie(Re.length-1)},children:[ae("session.launcher.SkipToConfirmAndLaunch"),(0,x.jsx)(we.A,{})]})]})]})]})})})]}),de.lg&&(0,x.jsx)(o.A,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,x.jsx)(Pe.A,{size:"small",direction:"vertical",current:D,onChange:e=>{ie(e)},items:v().map(Re,((e,n)=>({...e,status:n===D?"process":"wait"})))})})]}),(0,x.jsx)(pe,{onRequestClose:e=>{if(e){const n=v().merge({sessionName:"",ports:[],mounts:[],vfoldersAliasMap:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0},agent:"auto"},e);v().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,N.kX)(4)),me.setFieldsValue(n),ie(Re.length-1),me.validateFields().catch((()=>{}))}Z()},open:Y}),D===Re.length-1?(0,x.jsx)(Oe.tH,{fallback:null,children:(0,x.jsx)(V,{open:Ue,onClose:()=>{We(!1)},scrollIntoViewOptions:!0})}):void 0]})}}}]);
//# sourceMappingURL=4132.947fa79a.chunk.js.map