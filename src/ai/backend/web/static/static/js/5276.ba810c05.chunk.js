"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[5276],{59078:(e,n,l)=>{l.d(n,{Ay:()=>j,z7:()=>_});var a=l(56276),i=l(11863),r=l(15584),o=l(4740),s=l(37499),t=l(99910),d=l(37717),u=l(66203),m=l(91129),c=l(7265),v=l(60669),g=l.n(v),p=l(29262),h=l(99118),y=l(26862);const A=["formItemProps","requiredEnvVars","optionalEnvVars"],f=["key","name"],x=[/AUTH/i,/ACCESS/i,/SECRET/i,/_KEY/i,/PASSWORD/i,/PASSWD/i,/PWD/i,/TOKEN/i,/PRIVATE/i,/CREDENTIAL/i,/JWT/i,/KEYPAIR/i,/CERTIFICATE/i,/SSH/i,/ENCRYPT/i,/SIGNATURE/i,/SALT/i,/PIN/i,/PASSPHRASE/i,/OAUTH/i];function _(e){return g().map(e,(e=>{return e&&(n=e.variable,g().some(x,(e=>e.test(n))))?(0,a.A)((0,a.A)({},e),{},{value:""}):e;var n}))}const j=e=>{const n=(0,r.c)(17),{formItemProps:l,requiredEnvVars:v,optionalEnvVars:x}=e,_=(0,i.A)(e,A),j=(0,p.useRef)(null),{t:I}=(0,h.Bd)(),K=u.A.useFormInstance();let E;n[0]!==x||n[1]!==v?(E=[...g().filter(v||[],k),...g().filter(x||[],F)],n[0]=x,n[1]=v,n[2]=E):E=n[2];const O=E;let T;n[3]!==O||n[4]!==I?(T=e=>{if(!e||!O.length)return I("session.launcher.EnvironmentVariableValue");const n=g().find(O,(n=>n&&n.variable===e));return(null===n||void 0===n?void 0:n.placeholder)||I("session.launcher.EnvironmentVariableValue")},n[3]=O,n[4]=I,n[5]=T):T=n[5];const C=T,N=()=>{const e=K.getFieldValue(_.name)||[],n=g().map(g().filter(e,b),"variable");return g().map(g().filter([...x||[],...v||[]],(e=>null!=e&&!!e.variable&&!g().includes(n,e.variable))),w)};let P,M;return n[6]!==v||n[7]!==I?(P={validator:async(e,n)=>{if(v&&v.length>0){const e=g().filter(v,(e=>!g().some(n,(n=>n&&n.variable===e.variable&&""!==n.value.trim()))));if(e.length>0)return Promise.reject(I("session.launcher.MissingRequiredEnvironmentVariables",{vars:g().map(e,"variable").join(", ")}))}}},n[6]=v,n[7]=I,n[8]=P):P=n[8],n[9]!==K||n[10]!==l||n[11]!==N||n[12]!==C||n[13]!==x||n[14]!==_||n[15]!==I?(M=(e,n,r)=>{const{add:v,remove:p}=n,{errors:h}=r;return(0,y.jsxs)(c.OOm,{direction:"column",gap:"xs",align:"stretch",children:[e.map(((n,r)=>{const{key:s,name:d}=n,v=(0,i.A)(n,f);return(0,y.jsxs)(c.OOm,{direction:"row",align:"baseline",gap:"xs",children:[(0,y.jsx)(u.A.Item,(0,a.A)((0,a.A)((0,a.A)({},v),{},{style:{marginBottom:0,flex:1},name:[d,"variable"],rules:[...(null===l||void 0===l?void 0:l.rules)||[],{required:!0,message:I("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:I("session.launcher.EnvironmentVariableNamePatternError")},e=>{const{getFieldValue:n}=e;return{validator(e,l){const a=g().map(n(_.name),S);return!g().isEmpty(l)&&a.length>0&&g().filter(a,(e=>e===l)).length>1?Promise.reject(I("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}]},l),{},{children:x&&N().length>0?(0,y.jsx)(t.A,{placeholder:I("session.launcher.EnvironmentVariable"),options:N(),onChange:()=>{const n=e.map(((e,n)=>[_.name,n,"variable"]));K.validateFields(n)},filterOption:V}):(0,y.jsx)(m.A,{ref:r===e.length-1?j:null,placeholder:I("session.launcher.EnvironmentVariable"),onChange:()=>{const n=e.map(((e,n)=>[_.name,n,"variable"]));K.validateFields(n)}})})),(0,y.jsx)(u.A.Item,(0,a.A)((0,a.A)({},v),{},{name:[d,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:I("session.launcher.EnvironmentVariableValueRequired")}],validateTrigger:["onChange","onBlur"],dependencies:[[_.name,d,"variable"]],children:(0,y.jsx)(m.A,{placeholder:C(K.getFieldValue([_.name,d,"variable"]))})})),(0,y.jsx)(o.A,{onClick:()=>p(d)})]},s)})),(0,y.jsx)(u.A.Item,{noStyle:!0,children:(0,y.jsx)(d.Ay,{type:"dashed",onClick:()=>{v(),setTimeout((()=>{j.current&&j.current.focus()}),0)},icon:(0,y.jsx)(s.A,{}),block:!0,children:I("session.launcher.AddEnvironmentVariable")})}),(0,y.jsx)(u.A.ErrorList,{errors:h})]})},n[9]=K,n[10]=l,n[11]=N,n[12]=C,n[13]=x,n[14]=_,n[15]=I,n[16]=M):M=n[16],(0,y.jsx)(u.A.List,(0,a.A)((0,a.A)({},_),{},{rules:[..._.rules||[],P],children:M}))};function k(e){return null!=e&&!!e.variable}function F(e){return null!=e&&!!e.variable}function b(e){return null!=e&&"string"===typeof e.variable&&""!==e.variable.trim()}function w(e){return{value:e.variable,label:e.variable}}function S(e){return null===e||void 0===e?void 0:e.variable}function V(e,n){var l;return-1!==(null===n||void 0===n||null===(l=n.value)||void 0===l?void 0:l.toLowerCase().indexOf(e.toLowerCase()))}},74833:(e,n,l)=>{l.d(n,{A:()=>U});var a=l(56276),i=l(11863);const r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domain_name"},{defaultValue:null,kind:"LocalArgument",name:"group_id"},{defaultValue:null,kind:"LocalArgument",name:"keypair_resource_policy_name"}],n=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],l=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domain_name"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domain_name"},{kind:"Variable",name:"id",variableName:"group_id"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"keypair_resource_policy_name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:n,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderTableProjectQuery",selections:l,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderTableProjectQuery",selections:l},params:{cacheID:"2c2ce905afd89e93c6d761f22ed59f3d",id:null,metadata:{},name:"VFolderTableProjectQuery",operationKind:"query",text:"query VFolderTableProjectQuery(\n  $domain_name: String!\n  $group_id: UUID!\n  $keypair_resource_policy_name: String!\n) {\n  domain(name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  group(id: $group_id, domain_name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $keypair_resource_policy_name) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();r.hash="ccdbaa52a63c2ea005423e7c541eff80";const o=r;var s=l(31871),t=l(37138),d=l(10970),u=l(63590),m=l(28529),c=l(52053),v=l(54585),g=l(40720),p=l(49272);const h={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"},y=h;var A=l(7265),f=l(60669),x=l.n(f),_=l(29262),j=l(84372),k=l(26862);const F=e=>{let{vFolderFrgmt:n=null,permission:l}=e;const a=(0,j.useFragment)(y,n),i=x().chain({r:"green",w:"blue",d:"red"}).map(((e,n)=>{if(((e,n)=>!(null===e||void 0===e||!e.includes(n))||!(null===e||void 0===e||!e.includes("w")||"r"!==n))((null===a||void 0===a?void 0:a.permission)||l,n))return{label:n.toUpperCase(),color:e}})).compact().value();return(0,k.jsx)(A.qnQ,{values:i})};var b=l(78175),w=l(43014),S=l(53156),V=l(66203),I=l(87272),K=l(69319),E=l(69266),O=l(91129),T=l(37717),C=l(49969),N=l(86425),P=l(47671),M=l.n(P),R=l(87894),L=l(99118);const q=["rowFilter","showAliasInput","selectedRowKeys","onChangeSelectedRowKeys","aliasBasePath","aliasMap","onChangeAliasMap","rowKey","onChangeAutoMountedFolders","showAutoMountedFoldersSection","ownerEmail","onValidateSelectedRowKeys"],Q=/^[a-zA-Z0-9_/.-]*$/,z="/home/work/",B=e=>{let{rowFilter:n,showAliasInput:l=!1,selectedRowKeys:r=[],onChangeSelectedRowKeys:h,aliasBasePath:y=z,aliasMap:f,onChangeAliasMap:P,rowKey:B="name",onChangeAutoMountedFolders:D,showAutoMountedFoldersSection:G,ownerEmail:U,onValidateSelectedRowKeys:W}=e,$=(0,i.A)(e,q);const{generateFolderPath:J}=(0,g.useFolderExplorerOpener)(),H=_.useMemo((()=>e=>e&&e[B]),[B]),[Y,X]=(0,_.useState)(!1),[Z,ee]=(0,m.A)({value:r,onChange:e=>{const n=x().filter(Fe,(n=>x().includes(e,H(n))));null===h||void 0===h||h(e,n)}},{defaultValue:[]}),[ne,le]=(0,m.A)({value:f,onChange:P},{defaultValue:{}}),ae=(0,t.CX)(),[ie]=(0,d.x)(null===ae||void 0===ae?void 0:ae._config.accessKey),[re]=V.A.useForm();(0,_.useEffect)((()=>{ne&&(re.setFieldsValue(x().mapValues(ne,(e=>e.startsWith(y)?e.slice(y.length):e))),re.validateFields())}),[ne,re,y]);const{t:oe}=(0,L.Bd)(),{token:se}=I.A.useToken(),te=(0,s.QE)(),de=(0,c.hd)(),[ue,me]=(0,A.TwB)("first"),[ce,ve]=(0,_.useTransition)(),{data:ge}=(0,u.nj)({queryKey:["VFolderSelectQuery",ue,de.id,U],queryFn:()=>{const e=new URLSearchParams;return U&&e.set("owner_user_email",U),te({method:"GET",url:"/folders?".concat(e.toString())})},staleTime:1e3}),{domain:pe,group:he,keypair_resource_policy:ye}=(0,j.useLazyLoadQuery)(o,{domain_name:ae._config.domainName,group_id:de.id,keypair_resource_policy_name:(null===ie||void 0===ie?void 0:ie.resource_policy)||""},{fetchPolicy:"store-and-network",fetchKey:ue}),Ae=(0,_.useMemo)((()=>{const e=JSON.parse((null===pe||void 0===pe?void 0:pe.allowed_vfolder_hosts)||"{}"),n=JSON.parse((null===he||void 0===he?void 0:he.allowed_vfolder_hosts)||"{}"),l=JSON.parse((null===ye||void 0===ye?void 0:ye.allowed_vfolder_hosts)||"{}"),a=x().merge({},e,n,l);return Object.keys(a).filter((e=>a[e].includes("mount-in-session")))}),[pe,he,ye]),fe=(0,_.useMemo)((()=>(null===ge||void 0===ge?void 0:ge.filter((e=>"user"===e.ownership_type||!e.group||e.group===de.id)))||[]),[ge,de.id]),xe=(0,_.useMemo)((()=>fe.filter((e=>Ae.includes(e.host)))),[fe,Ae]);(0,_.useEffect)((()=>{const e=x().difference(Z,xe.map((e=>H(e))));null===W||void 0===W||W(e,x().filter(xe,(e=>x().includes(Z,H(e)))))}),[xe,H,W,JSON.stringify(Z)]);const _e=(0,_.useMemo)((()=>x().chain(xe).filter((e=>{var n;return"ready"===e.status&&(null===(n=e.name)||void 0===n?void 0:n.startsWith("."))})).map((e=>e.name)).value()),[xe]);(0,_.useEffect)((()=>{x().isFunction(D)&&D(_e)}),[_e]),(0,_.useEffect)((()=>{r&&0!==r.length||ee([])}),[de.id]);const[je,ke]=(0,_.useState)(""),Fe=(0,_.useMemo)((()=>x().chain(xe).filter((e=>!(n&&!n(e))&&(!!Z.includes(H(e))||(!je||e.name.includes(je))))).value()),[xe,n,Z,H,je]),be=(0,_.useCallback)(((e,n)=>void 0===n||""===n?"".concat(y).concat(e):n.startsWith("/")?n:"".concat(y).concat(n)),[y]),we=(0,A.EQ6)((()=>{le(x().mapValues(x().pickBy(re.getFieldsValue({strict:!1}),(e=>!!e)),((e,n)=>be(n,e)))),re.validateFields().catch((()=>{}))}));(0,_.useEffect)((()=>{we()}),[JSON.stringify(Z),we]);const Se=[{title:(0,k.jsxs)(A.OOm,{direction:"row",gap:"xxs",children:[(0,k.jsx)(K.A.Text,{children:oe("data.folders.Name")}),l&&(0,k.jsx)(k.Fragment,{children:(0,k.jsxs)(K.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",oe("session.launcher.FolderAlias")," ",(0,k.jsx)(E.A,{title:(0,k.jsx)(L.x6,{i18nKey:"session.launcher.DescFolderAlias"}),children:(0,k.jsx)(b.A,{})}),")"]})})]}),dataIndex:"name",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n)=>{const a=Z.includes(H(n));return(0,k.jsxs)(A.OOm,{direction:"column",align:"start",gap:"xxs",style:l&&a?{display:"inline-flex",height:70,width:"100%"}:{maxWidth:200},children:[(0,k.jsx)(A.rmy,{type:"hover",to:J(n.id),children:(0,k.jsx)(p.A,{keyword:je,children:e})}),l&&a&&(0,k.jsx)(V.A.Item,{noStyle:!0,shouldUpdate:(e,l)=>e[H(n)]!==l[H(n)],children:()=>{const e=x()(Z).reduce(((e,n)=>(e[n]=(null===ne||void 0===ne?void 0:ne[n])||be(n,void 0),e)),{});return(0,k.jsx)(V.A.Item,{name:H(n),rules:[{type:"string",pattern:Q,message:oe("session.launcher.FolderAliasInvalid")},{type:"string",validator:async(l,a)=>a&&x().some(e,((e,l)=>l!==H(n)&&e===be(H(n),a)))?Promise.reject(oe("session.launcher.FolderAliasOverlapping")):Promise.resolve()},{type:"string",validator:async(e,l)=>{const a=be(H(n),l);return l&&x().map(_e,(e=>be("",e))).includes(a)?Promise.reject(oe("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],extra:be(n.name,re.getFieldValue(H(n))),children:(0,k.jsx)(O.A,{onClick:e=>{e.stopPropagation()},placeholder:oe("session.launcher.FolderAlias"),allowClear:!0,onChange:()=>{we()}})})}})]})}},{title:oe("data.UsageMode"),dataIndex:"usage_mode",sorter:(e,n)=>e.usage_mode.localeCompare(n.usage_mode)},{title:oe("data.Host"),dataIndex:"host"},{title:oe("data.Type"),dataIndex:"type",sorter:(e,n)=>e.type.localeCompare(n.type),render:(e,n)=>(0,k.jsx)(A.OOm,{direction:"column",children:"user"===n.ownership_type?(0,k.jsxs)(A.OOm,{gap:"xs",children:[(0,k.jsx)(K.A.Text,{children:oe("data.User")}),(0,k.jsx)(w.A,{style:{color:se.colorTextTertiary}})]}):(0,k.jsxs)(A.OOm,{gap:"xs",children:[(0,k.jsx)(K.A.Text,{children:oe("data.Project")}),(0,k.jsx)(A.ObC,{style:{color:se.colorTextTertiary}})]})})},{title:oe("data.Permission"),dataIndex:"permission",sorter:(e,n)=>e.permission.localeCompare(n.permission),render:(e,n)=>(0,k.jsx)(F,{permission:n.permission})},{title:oe("data.Created"),dataIndex:"created_at",sorter:(e,n)=>e.created_at.localeCompare(n.created_at),render:e=>M()(e).format("L"),defaultSortOrder:"descend"}];return(0,k.jsxs)(A.OOm,{direction:"column",align:"stretch",gap:"xs",children:[(0,k.jsxs)(A.OOm,{direction:"row",gap:"xs",justify:"between",children:[(0,k.jsx)(O.A,{value:je,onChange:e=>ke(e.target.value),allowClear:!0,placeholder:oe("data.SearchByName")}),(0,k.jsx)(E.A,{title:oe("button.Refresh"),children:(0,k.jsx)(T.Ay,{loading:ce,icon:(0,k.jsx)(S.A,{}),onClick:()=>{ve((()=>{me()}))}})}),(0,k.jsx)(E.A,{title:oe("data.CreateANewStorageFolder"),children:(0,k.jsx)(T.Ay,{icon:(0,k.jsx)(R.A,{}),type:"primary",ghost:!0,onClick:()=>{X(!0)}})})]}),(0,k.jsx)(V.A,{form:re,component:!1,preserve:!1,children:(0,k.jsx)(A.zxw,(0,a.A)({scroll:{x:"max-content"},rowKey:H,rowSelection:{selectedRowKeys:Z,onChange:e=>{ee(e),we()}},showSorterTooltip:!1,columns:Se,dataSource:Fe,onRow:e=>({onClick:n=>{var l;const a=n.target;null!==a&&void 0!==a&&null!==(l=a.classList)&&void 0!==l&&l.contains("ant-table-selection-column")&&(n.stopPropagation(),Z.includes(H(e))?ee(Z.filter((n=>n!==H(e)))):ee([...Z,H(e)]))}})},$))}),G&&_e.length>0?(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(C.A,{size:"small",children:(0,k.jsx)(C.A.Item,{label:oe("data.AutomountFolders"),children:x().map(_e,(e=>(0,k.jsx)(N.A,{children:e},e)))})})}):null,(0,k.jsx)(v.A,{open:Y,onRequestClose:e=>{X(!1),e&&ve((()=>{me(),ee((n=>[...n,e[B]]))}))}})]})};var D=l(36961);const G=["rowFilter","rowKey","tableProps"],U=e=>{let{rowFilter:n,rowKey:l="name",tableProps:r}=e,o=(0,i.A)(e,G);const s=V.A.useFormInstance(),{t:t}=(0,L.Bd)(),{message:d}=D.A.useApp();return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(V.A.Item,{hidden:!0,name:"mount_id_map",rules:[{validator(e,n){const l=x().chain(s.getFieldValue("mount_ids")).reduce(((e,l)=>(e[l]=n[l]||"/home/work/"+l,e)),{}).values().value();return x().uniq(l).length!==l.length?Promise.reject(t("session.launcher.FolderAliasOverlapping")):x().some(l,(e=>!Q.test(e)))?Promise.reject(t("session.launcher.FolderAliasInvalid")):x().some(s.getFieldValue("autoMountedFolderNames"),(e=>l.includes(z+e)))?Promise.reject(t("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],children:(0,k.jsx)(O.A,{})}),(0,k.jsx)(V.A.Item,{hidden:!0,name:"mounts",children:(0,k.jsx)("div",{})}),(0,k.jsx)(V.A.Item,{hidden:!0,name:"autoMountedFolderNames",children:(0,k.jsx)("div",{})}),(0,k.jsx)(V.A.Item,{hidden:!0,name:"vfoldersNameMap",children:(0,k.jsx)("div",{})}),(0,k.jsx)(V.A.Item,(0,a.A)((0,a.A)({name:"mount_ids"},o),{},{valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,k.jsx)(B,(0,a.A)({rowKey:l,showAliasInput:!0,aliasMap:s.getFieldValue("mount_id_map"),onChangeAliasMap:(0,A.EQ6)((e=>{s.setFieldValue("mount_id_map",e),s.validateFields(["mount_id_map"])})),pagination:!1,rowFilter:n,showAutoMountedFoldersSection:!0,onChangeAutoMountedFolders:(0,A.EQ6)((e=>{s.setFieldValue("autoMountedFolderNames",e)})),onValidateSelectedRowKeys:(0,A.EQ6)(((e,n)=>{s.setFieldValue("mount_ids",x().difference(s.getFieldValue("mount_ids"),e)),s.setFieldValue("mount_id_map",x().omitBy(s.getFieldValue("mount_id_map"),((n,l)=>e.includes(l)))),s.setFieldValue("vfoldersNameMap",x().reduce(n,((e,n)=>(e[n[l]]=n.name,e)),{})),e.length>0&&d.warning(t("session.launcher.InvalidMountsSelectionWarning"))}))},r),null===r||void 0===r?void 0:r.ownerEmail)}))]})}},77085:(e,n,l)=>{l.d(n,{A:()=>b});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},l=[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base_image_name",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"version",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"supported_accelerators",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:a},params:{cacheID:"192812639ccebbee01e918cbd60b8816",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:'query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    name @deprecatedSince(version: "24.12.0")\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n    namespace @since(version: "24.12.0")\n    base_image_name @since(version: "24.12.0")\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    version @since(version: "24.12.0")\n    supported_accelerators\n  }\n}\n'}}}();a.hash="cd124d0155c7eab304c2d3b6dc75074a";const i=a;var r=l(31871),o=l(37138),s=l(42829),t=l(74065),d=l(93594),u=l(49272),m=l(66203),c=l(87272),v=l(69319),g=l(29268),p=l(86425),h=l(90464),y=l(91129),A=l(7265),f=l(60669),x=l.n(f),_=l(29262),j=l(99118),k=l(84372),F=l(26862);const b=e=>{var n;let{filter:l,showPrivate:a}=e;const f=m.A.useFormInstance(),b=m.A.useWatch("environments",{form:f,preserve:!0}),w=(0,o.CX)(),S=null===w||void 0===w?void 0:w.supports("extended-image-info"),[V,I]=(0,_.useState)(""),[K,E]=(0,_.useState)(""),{t:O}=(0,j.Bd)(),[T,{getBaseVersion:C,getImageMeta:N,tagAlias:P}]=(0,o.Gj)(),{token:M}=c.A.useToken(),{isDarkMode:R}=(0,s.e)(),L=(0,_.useRef)(null),q=(0,_.useRef)(null),Q=null!==w&&void 0!==w&&null!==(n=w._config)&&void 0!==n&&n.showNonInstalledImages?{}:{installed:!0},{images:z}=(0,k.useLazyLoadQuery)(i,Q,{fetchPolicy:"store-and-network"});(0,_.useEffect)((()=>{var e,n,l;if(!x().isEmpty(null===b||void 0===b?void 0:b.manual))return void((b.environment||b.version)&&f.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}}));let a,i,o,s,t=null===(e=f.getFieldValue("environments"))||void 0===e?void 0:e.version;var d,u;(t&&t.indexOf("@")<0&&(t+="@x86_64"),t&&x().find(B,(e=>(a=x().find(e.environmentGroups,(e=>(i=x().find(e.images,(e=>(0,r.A_)(e)===t)),!!i))),!!a))),a?(o=a,s=i):f.getFieldValue(["environments","environment"])&&x().find(B,(e=>{var n;return o=x().find(e.environmentGroups,(e=>e.environmentName===f.getFieldValue(["environments","environment"]))),s=null===(n=o)||void 0===n?void 0:n.images[0],!!o})),o&&s)||(o=null===(d=B[0])||void 0===d?void 0:d.environmentGroups[0],s=null===(u=o)||void 0===u?void 0:u.images[0]);const m=null===(n=x().find(null===(l=s)||void 0===l?void 0:l.labels,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key))))||void 0===n?void 0:n.value;s?!a&&w._config.allow_manual_image_name_for_session&&t?f.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0,manual:t,customizedTag:null!==m&&void 0!==m?m:void 0}}):f.setFieldsValue({environments:{environment:o.environmentName,version:(0,r.A_)(s),image:s,customizedTag:null!==m&&void 0!==m?m:void 0}}):w._config.allow_manual_image_name_for_session&&f.setFieldValue(["environments","manual"],t)}),[null===b||void 0===b?void 0:b.version,null===b||void 0===b?void 0:b.manual]);const B=(0,_.useMemo)((()=>x().chain(z).filter((e=>(!!a||!(e=>x().some(null===e||void 0===e?void 0:e.labels,(e=>{var n;return"ai.backend.features"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.split(" ").includes("private"))})))(e))&&(!l||l(e)))).groupBy((e=>{var n;return(null===T||void 0===T||null===(n=T.imageInfo[N((0,r.A_)(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map(((e,n)=>{var l;return{groupName:n,groupSortKey:(null===T||void 0===T||null===(l=T.groupSortKeyMap)||void 0===l?void 0:l[n])||n,environmentGroups:x().chain(e).groupBy((e=>"".concat(null===e||void 0===e?void 0:e.registry,"/").concat(S?null===e||void 0===e?void 0:e.namespace:null===e||void 0===e?void 0:e.name))).map(((e,n)=>{var l,a;const i=null===(l=n.split("/"))||void 0===l?void 0:l[2],o=i&&(null===T||void 0===T||null===(a=T.imageInfo[i])||void 0===a?void 0:a.name)||x().last(n.split("/"));return{environmentName:n,displayName:o,prefix:x().chain(n).split("/").drop(1).dropRight(1).join("/").value(),images:e.sort(((e,n)=>{var l,a,i,o,s,t;return function(e,n){const l=e.split(".").map(Number),a=n.split(".").map(Number);for(let i=0;i<Math.max(l.length,a.length);i++){const e=l[i]||0,n=a[i]||0;if(e>n)return 1;if(e<n)return-1}return 0}(null!==(l=null===n||void 0===n||null===(a=n.tag)||void 0===a||null===(i=a.split("-"))||void 0===i?void 0:i[0])&&void 0!==l?l:"",null!==(o=null===e||void 0===e||null===(s=e.tag)||void 0===s||null===(t=s.split("-"))||void 0===t?void 0:t[0])&&void 0!==o?o:"")||(0,r._f)(null===e||void 0===e?void 0:e.architecture,null===n||void 0===n?void 0:n.architecture)}))}})).sortBy((e=>e.displayName)).value()}})).sortBy((e=>e.groupSortKey)).value()),[z,T,l,a]),{fullNameMatchedImage:D}=(0,_.useMemo)((()=>{let e,n;return V.length&&x().chain(B.flatMap((e=>e.environmentGroups)).find((l=>(n=l,e=x().find(l.images,(e=>(0,r.A_)(e)===V)),!!e)))).value(),{fullNameMatchedImage:e,fullNameMatchedImageGroup:n}}),[V,B]);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(m.A.Item,{className:"image-environment-select-form-item",name:["environments","environment"],label:(0,F.jsxs)(v.A.Text,{copyable:{text:(0,r.A_)(f.getFieldValue(["environments","image"]))},children:[O("session.launcher.Environments")," /"," ",O("session.launcher.Version")]}),rules:[{required:x().isEmpty(null===b||void 0===b?void 0:b.manual),message:O("general.ValueRequired",{name:O("session.launcher.Environments")})}],style:{marginBottom:10},children:(0,F.jsx)(A.xrr,{ref:L,showSearch:{searchValue:V,onSearch:I,optionFilterProp:"filterValue"},popupMatchSelectWidth:!1,defaultActiveFirstOption:!0,onChange:e=>{if(D)f.setFieldsValue({environments:{environment:(S?null===D||void 0===D?void 0:D.namespace:null===D||void 0===D?void 0:D.name)||"",version:(0,r.A_)(D),image:D}});else{const n=B.flatMap((e=>e.environmentGroups)).filter((n=>n.environmentName===e))[0].images[0];f.setFieldsValue({environments:{environment:(S?null===n||void 0===n?void 0:n.namespace:null===n||void 0===n?void 0:n.name)||"",version:(0,r.A_)(n),image:n}})}},disabled:w._config.allow_manual_image_name_for_session&&!x().isEmpty(null===b||void 0===b?void 0:b.manual),children:D?(0,F.jsx)(g.A.Option,{value:S?null===D||void 0===D?void 0:D.namespace:null===D||void 0===D?void 0:D.name,filterValue:(0,r.A_)(D),children:(0,F.jsxs)(A.OOm,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,F.jsx)(t.A,{image:(0,r.A_)(D)||"",style:{width:15,height:15}}),(0,r.A_)(D)]})}):x().map(B,(e=>(0,F.jsx)(g.A.OptGroup,{label:e.groupName,children:x().map(e.environmentGroups,(e=>{var n;const l=e.images[0],a=null===T||void 0===T?void 0:T.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[2]],i=[];let o=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(i.push(e.prefix),o=(0,F.jsx)(p.A,{color:"purple",children:(0,F.jsx)(u.A,{keyword:V,children:e.prefix})}));const s=x().map(null===a||void 0===a?void 0:a.label,(e=>x().isUndefined(e.category)&&e.tag&&e.color?(i.push(e.tag),(0,F.jsx)(p.A,{color:e.color,children:(0,F.jsx)(u.A,{keyword:V,children:e.tag},e.tag)},e.tag)):null));return(0,F.jsx)(g.A.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+i.join("\t"),children:(0,F.jsxs)(A.OOm,{direction:"row",justify:"between",children:[(0,F.jsxs)(A.OOm,{direction:"row",align:"center",gap:"xs",children:[(0,F.jsx)(t.A,{image:(0,r.A_)(l)||"",style:{width:15,height:15}}),(0,F.jsx)(u.A,{keyword:V,children:e.displayName})]}),(0,F.jsxs)(A.OOm,{direction:"row",className:R?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:M.marginXS,flexShrink:1},gap:"xs",children:[o,s]})]})},e.environmentName)}))},e.groupName)))})}),(0,F.jsx)(m.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var l,a;return(null===(l=e.environments)||void 0===l?void 0:l.environment)!==(null===(a=n.environments)||void 0===a?void 0:a.environment)},children:e=>{var n;let l,{getFieldValue:a}=e;return x().find(B,(e=>x().find(e.environmentGroups,(e=>{var n;return e.environmentName===(null===(n=a("environments"))||void 0===n?void 0:n.environment)&&(l=e,!0)})))),(0,F.jsx)(m.A.Item,{className:"image-environment-select-form-item",name:["environments","version"],rules:[{required:x().isEmpty(null===b||void 0===b?void 0:b.manual),message:O("general.ValueRequired",{name:O("session.launcher.Version")})}],children:(0,F.jsx)(A.xrr,{ref:q,popupMatchSelectWidth:!1,onChange:e=>{const n=x().find(z,(n=>(0,r.A_)(n)===e));f.setFieldValue(["environments","image"],n)},showSearch:{searchValue:K,onSearch:E,optionFilterProp:"filterValue"},popupRender:e=>(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(A.OOm,{style:{fontWeight:M.fontWeightStrong,paddingLeft:M.paddingSM},children:[O("session.launcher.Version"),(0,F.jsx)(h.A,{type:"vertical"}),O("session.launcher.Architecture"),(0,F.jsx)(h.A,{type:"vertical"}),O("session.launcher.Tags")]}),(0,F.jsx)(h.A,{style:{margin:"8px 0"}}),e]}),disabled:w._config.allow_manual_image_name_for_session&&!x().isEmpty(null===b||void 0===b?void 0:b.manual),children:x().map(x().uniqBy(null===(n=l)||void 0===n?void 0:n.images,"id"),(e=>{var n;const[l,a,...i]=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""];let o=null===T||void 0===T?void 0:T.tagAlias[a];if(!o){for(const[e,n]of Object.entries((null===T||void 0===T?void 0:T.tagReplace)||{})){const l=new RegExp(e);l.test(a)&&(o=null===a||void 0===a?void 0:a.replace(l,n))}o||(o=a)}const s=[],t=x().chain(i).filter((e=>!e.startsWith("customized_"))).map(((e,n)=>(0,F.jsx)(A.qnQ,{values:x().split((null===T||void 0===T?void 0:T.tagAlias[e])||e,":").map((e=>(s.push(e),{label:e,highlightKeyword:K})))},n))).value(),m=null===e||void 0===e?void 0:e.labels;if(m){const e=x().findIndex(m,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key)));if(e&&m[e]){var c;const n=(null===(c=m[e])||void 0===c?void 0:c.value)||"";s.push("Customized"),s.push(n),t.push((0,F.jsx)(A.qnQ,{highlightKeyword:K,values:[{label:"Customized",color:"cyan"},{label:null!==n&&void 0!==n?n:"",color:"cyan"}]},t.length+1))}}return(0,F.jsx)(g.A.Option,{value:(0,r.A_)(e),filterValue:[l,o,null===e||void 0===e?void 0:e.architecture,...s].join("\t"),children:S?(0,F.jsxs)(A.OOm,{direction:"row",children:[(0,F.jsx)(u.A,{keyword:K,children:null===e||void 0===e?void 0:e.version}),(0,F.jsx)(h.A,{orientation:"vertical"}),(0,F.jsx)(u.A,{keyword:K,children:null===e||void 0===e?void 0:e.architecture}),(0,F.jsx)(h.A,{orientation:"vertical"}),(0,F.jsx)(A.OOm,{direction:"row",align:"start",gap:"xs",children:x().map(null===e||void 0===e?void 0:e.tags,(n=>{var l;const a=x().includes(n.key,"customized_"),i=a?null===(l=x().find(null===e||void 0===e?void 0:e.labels,{key:"ai.backend.customized-image.name"}))||void 0===l?void 0:l.value:n.value,o=P(n.key+i);return x().isEqual(o,(0,r.WY)(n.key+i))||a?(0,F.jsx)(A.qnQ,{highlightKeyword:K,values:[{label:P(n.key),color:a?"cyan":"blue"},{label:null!==i&&void 0!==i?i:"",color:a?"cyan":"blue"}]},n.key):(0,F.jsx)(p.A,{color:a?"cyan":"blue",children:(0,F.jsx)(u.A,{keyword:K,children:o})},n.key)}))})]}):(0,F.jsx)(A.OOm,{direction:"row",justify:"between",children:(0,F.jsxs)(A.OOm,{direction:"row",children:[(0,F.jsx)(u.A,{keyword:K,children:C((0,r.A_)(e)||"")}),(0,F.jsx)(h.A,{orientation:"vertical"}),(0,F.jsx)(u.A,{keyword:K,children:null===e||void 0===e?void 0:e.architecture}),(0,F.jsx)(h.A,{orientation:"vertical"}),(0,F.jsx)(d.J,{tag:(null===e||void 0===e?void 0:e.tag)||"",highlightKeyword:K,labels:null===e||void 0===e?void 0:e.labels})]})})},null===e||void 0===e?void 0:e.id)}))})})}}),(0,F.jsx)(m.A.Item,{label:O("session.launcher.ManualImageName"),name:["environments","manual"],style:{display:w._config.allow_manual_image_name_for_session?"block":"none"},children:(0,F.jsx)(y.A,{allowClear:!0,onChange:e=>{x().isEmpty(e)||f.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}})}})}),(0,F.jsx)(m.A.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,F.jsx)(y.A,{})})]})}},93594:(e,n,l)=>{l.d(n,{J:()=>S,e:()=>V});var a=l(56276),i=l(11863);const r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"uuid"}],n=[{kind:"Variable",name:"id",variableName:"uuid"}],l={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageTagsUNSAFELazySessionImageTagQuery",selections:[{alias:null,args:n,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[l,a,i],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageTagsUNSAFELazySessionImageTagQuery",selections:[{alias:null,args:n,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[l,a,i,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"561670e250a47b880df70cc432c19049",id:null,metadata:{},name:"ImageTagsUNSAFELazySessionImageTagQuery",operationKind:"query",text:"query ImageTagsUNSAFELazySessionImageTagQuery(\n  $uuid: UUID!\n) {\n  compute_session(id: $uuid) {\n    image\n    mounts\n    architecture\n    id\n  }\n}\n"}}}();r.hash="20cd966dac98c484e7c795ff3d7e78a4";const o=r;var s=l(31871),t=l(37138),d=l(74065),u=l(49272),m=l(86425),c=l(87272),v=l(7265),g=l(60669),p=l.n(g),h=l(29262),y=l(84372),A=l(26862);const f=["image"],x=["image"],_=["image"],j=["tag","labels","highlightKeyword"],k=e=>{let{image:n}=e,l=(0,i.A)(e,f);n=n||"";const[,{getImageAliasName:r,getBaseVersion:o,tagAlias:s}]=(0,t.Gj)();return(0,A.jsx)(v.qnQ,(0,a.A)({values:[{label:s(r(n)),color:"blue"},{label:o(n),color:"green"}]},l))},F=e=>{let{image:n}=e,l=(0,i.A)(e,x);n=n||"";const[,{getBaseImage:r,tagAlias:o}]=(0,t.Gj)();return p().isEmpty(o(r(n)))?null:(0,A.jsx)(m.A,(0,a.A)((0,a.A)({color:"green"},l),{},{children:o(r(n))}))},b=e=>{let{image:n}=e,l=(0,i.A)(e,_);n=n||"";const[,{getArchitecture:r,tagAlias:o}]=(0,t.Gj)();return p().isEmpty(o(r(n)))?null:(0,A.jsx)(m.A,(0,a.A)((0,a.A)({color:"green"},l),{},{children:r(n)}))},w=h.memo((function(e){let{image:n}=e;return n=n||"",(0,A.jsxs)(v.OOm,{gap:"xs",wrap:"wrap",children:[(0,A.jsx)(k,{image:n}),(0,A.jsx)(F,{image:n}),(0,A.jsx)(b,{image:n})]})})),S=e=>{let{tag:n,labels:l,highlightKeyword:r}=e,o=(0,i.A)(e,j);l=l||[];const[,{getTags:d,tagAlias:c}]=(0,t.Gj)(),g=d(n,l);return(0,A.jsx)(h.Fragment,(0,a.A)((0,a.A)({},o),{},{children:p().map(g,((e,n)=>{const l="Customized"===e.key,a=c(e.key+e.value);return p().isEqual(a,(0,s.WY)(e.key+e.value))?(0,A.jsx)(v.qnQ,{highlightKeyword:r,values:[{label:c(e.key),color:l?"cyan":"blue"},{label:e.value,color:l?"cyan":"blue"}]},e.key):(0,A.jsx)(m.A,{color:l?"cyan":"blue",children:(0,A.jsx)(u.A,{keyword:r,children:a},n)},e.key)}))}))},V=e=>{let{sessionId:n}=e;const{token:l}=c.A.useToken(),{compute_session:a}=(0,y.useLazyLoadQuery)(o,{uuid:n||""},{fetchPolicy:n?"store-or-network":"store-only"}),i=(null===a||void 0===a?void 0:a.image)&&(null===a||void 0===a?void 0:a.architecture)&&a.image+"@"+a.architecture;return i?(0,A.jsxs)(v.OOm,{gap:["xs",0],wrap:"wrap",children:[(0,A.jsx)(d.A,{image:i,style:{marginRight:l.marginXS}}),(0,A.jsx)(w,{image:i})]}):null}}}]);
//# sourceMappingURL=5276.ba810c05.chunk.js.map