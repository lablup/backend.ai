"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[959],{4101:(e,n,l)=>{l.d(n,{Ay:()=>h,z7:()=>p});var a=l(72338),i=l(67483),r=l(53051),t=l(13170),o=l(83978),s=l(52335),d=l(46976),u=l.n(d),m=l(53350),c=l(91788),v=l(60598);const g=[/AUTH/i,/ACCESS/i,/SECRET/i,/_KEY/i,/PASSWORD/i,/PASSWD/i,/PWD/i,/TOKEN/i,/PRIVATE/i,/CREDENTIAL/i,/JWT/i,/KEYPAIR/i,/CERTIFICATE/i,/SSH/i,/ENCRYPT/i,/SIGNATURE/i,/SALT/i,/PIN/i,/PASSPHRASE/i,/OAUTH/i];function p(e){return u().map(e,(e=>{return e&&(n=e.variable,g.some((e=>e.test(n))))?{...e,value:""}:e;var n}))}const h=e=>{let{formItemProps:n,...l}=e;const d=(0,m.useRef)(null),{t:g}=(0,c.Bd)(),p=t.A.useFormInstance();return(0,v.jsx)(t.A.List,{...l,children:(e,m)=>{let{add:c,remove:h}=m;return(0,v.jsxs)(a.A,{direction:"column",gap:"xs",align:"stretch",children:[e.map(((r,s)=>{let{key:m,name:c,...y}=r;return(0,v.jsxs)(a.A,{direction:"row",align:"baseline",gap:"xs",children:[(0,v.jsx)(t.A.Item,{...y,style:{marginBottom:0,flex:1},name:[c,"variable"],rules:[{required:!0,message:g("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:g("session.launcher.EnvironmentVariableNamePatternError")},e=>{let{getFieldValue:n}=e;return{validator(e,a){const i=u().map(n(l.name),(e=>null===e||void 0===e?void 0:e.variable));return!u().isEmpty(a)&&i.length>0&&u().filter(i,(e=>e===a)).length>1?Promise.reject(g("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}],...n,children:(0,v.jsx)(o.A,{ref:s===e.length-1?d:null,placeholder:"Variable",onChange:()=>{const n=e.map(((e,n)=>[l.name,n,"variable"]));p.validateFields(n)}})}),(0,v.jsx)(t.A.Item,{...y,name:[c,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:g("session.launcher.EnvironmentVariableValueRequired")}],validateTrigger:["onChange","onBlur"],children:(0,v.jsx)(o.A,{placeholder:"Value"})}),(0,v.jsx)(i.A,{onClick:()=>h(c)})]},m)})),(0,v.jsx)(t.A.Item,{noStyle:!0,children:(0,v.jsx)(s.Ay,{type:"dashed",onClick:()=>{c(),setTimeout((()=>{d.current&&d.current.focus()}),0)},icon:(0,v.jsx)(r.A,{}),block:!0,children:g("session.launcher.AddEnvironmentVariable")})})]})}})}},60828:(e,n,l)=>{l.d(n,{A:()=>F});var a=l(72375),i=l(23441),r=l(23524),t=l(91238),o=l(72338);var s,d=l(90184),u=l(32715),m=l(96141),c=l(13170),v=l(9571),g=l(50128),p=l(1581),h=l(24798),y=l(40056),f=l(83978),A=l(46976),x=l.n(A),j=l(53350),_=l(91788),k=l(22018),b=l(60598);const F=e=>{var n;let{filter:A,showPrivate:F}=e;const w=c.A.useFormInstance(),S=c.A.useWatch("environments",{form:w,preserve:!0}),V=(0,i.CX)(),I=null===V||void 0===V?void 0:V.supports("extended-image-info"),[K,C]=(0,j.useState)(""),[N,E]=(0,j.useState)(""),{t:P}=(0,_.Bd)(),[T,{getBaseVersion:M,getImageMeta:R,tagAlias:L}]=(0,i.Gj)(),{token:O}=v.A.useToken(),{isDarkMode:B}=(0,r.e)(),G=(0,j.useRef)(null),z=(0,j.useRef)(null),$=null!==V&&void 0!==V&&null!==(n=V._config)&&void 0!==n&&n.showNonInstalledImages?{}:{installed:!0},{images:q}=(0,k.useLazyLoadQuery)(void 0!==s?s:s=l(3796),$,{fetchPolicy:"store-and-network"});(0,j.useEffect)((()=>{var e,n,l;if(!x().isEmpty(null===S||void 0===S?void 0:S.manual))return void((S.environment||S.version)&&w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}}));let i,r,t,o,s=null===(e=w.getFieldValue("environments"))||void 0===e?void 0:e.version;var d,u;(s&&s.indexOf("@")<0&&(s+="@x86_64"),s&&x().find(D,(e=>(i=x().find(e.environmentGroups,(e=>(r=x().find(e.images,(e=>(0,a.A_)(e)===s)),!!r))),!!i))),i?(t=i,o=r):w.getFieldValue(["environments","environment"])&&x().find(D,(e=>{var n;return t=x().find(e.environmentGroups,(e=>e.environmentName===w.getFieldValue(["environments","environment"]))),o=null===(n=t)||void 0===n?void 0:n.images[0],!!t})),t&&o)||(t=null===(d=D[0])||void 0===d?void 0:d.environmentGroups[0],o=null===(u=t)||void 0===u?void 0:u.images[0]);const m=null===(n=x().find(null===(l=o)||void 0===l?void 0:l.labels,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key))))||void 0===n?void 0:n.value;o?!i&&V._config.allow_manual_image_name_for_session&&s?w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0,manual:s,customizedTag:null!==m&&void 0!==m?m:void 0}}):w.setFieldsValue({environments:{environment:t.environmentName,version:(0,a.A_)(o),image:o,customizedTag:null!==m&&void 0!==m?m:void 0}}):V._config.allow_manual_image_name_for_session&&w.setFieldValue(["environments","manual"],s)}),[null===S||void 0===S?void 0:S.version,null===S||void 0===S?void 0:S.manual]);const D=(0,j.useMemo)((()=>x().chain(q).filter((e=>(!!F||!(e=>x().some(null===e||void 0===e?void 0:e.labels,(e=>{var n;return"ai.backend.features"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.split(" ").includes("private"))})))(e))&&(!A||A(e)))).groupBy((e=>{var n;return(null===T||void 0===T||null===(n=T.imageInfo[R((0,a.A_)(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map(((e,n)=>({groupName:n,environmentGroups:x().chain(e).groupBy((e=>`${null===e||void 0===e?void 0:e.registry}/${I?null===e||void 0===e?void 0:e.namespace:null===e||void 0===e?void 0:e.name}`)).map(((e,n)=>{var l,i;const r=null===(l=n.split("/"))||void 0===l?void 0:l[2];return{environmentName:n,displayName:r&&(null===T||void 0===T||null===(i=T.imageInfo[r])||void 0===i?void 0:i.name)||x().last(n.split("/")),prefix:x().chain(n).split("/").drop(1).dropRight(1).join("/").value(),images:e.sort(((e,n)=>{var l,i,r,t,o,s;return function(e,n){const l=e.split(".").map(Number),a=n.split(".").map(Number);for(let i=0;i<Math.max(l.length,a.length);i++){const e=l[i]||0,n=a[i]||0;if(e>n)return 1;if(e<n)return-1}return 0}(null!==(l=null===n||void 0===n||null===(i=n.tag)||void 0===i||null===(r=i.split("-"))||void 0===r?void 0:r[0])&&void 0!==l?l:"",null!==(t=null===e||void 0===e||null===(o=e.tag)||void 0===o||null===(s=o.split("-"))||void 0===s?void 0:s[0])&&void 0!==t?t:"")||(0,a._f)(null===e||void 0===e?void 0:e.architecture,null===n||void 0===n?void 0:n.architecture)}))}})).sortBy((e=>e.displayName)).value()}))).sortBy((e=>e.groupName)).value()),[q,T,A,F]),{fullNameMatchedImage:W}=(0,j.useMemo)((()=>{let e,n;return K.length&&x().chain(D.flatMap((e=>e.environmentGroups)).find((l=>(n=l,e=x().find(l.images,(e=>(0,a.A_)(e)===K)),!!e)))).value(),{fullNameMatchedImage:e,fullNameMatchedImageGroup:n}}),[K,D]);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("style",{children:"/* Change the image and tags of the select option when the selection is opened  */\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  img,\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  span.ant-tag {\n  opacity: 0.5;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-light {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-dark {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px; /* Width of the transparent gradient area */\n  background: linear-gradient(\n    to right,\n    rgba(255, 255, 255, 0),\n    rgba(255, 255, 255, 1)\n  );\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px;\n  background: linear-gradient(\n    to right,\n    rgba(20, 20, 20, 0),\n    rgba(20, 20, 20, 1)\n  );\n}\n"}),(0,b.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","environment"],label:(0,b.jsxs)(g.A.Text,{copyable:{text:(0,a.A_)(w.getFieldValue(["environments","image"]))},children:[P("session.launcher.Environments")," /"," ",P("session.launcher.Version")]}),rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],style:{marginBottom:10},children:(0,b.jsx)(p.A,{ref:G,showSearch:!0,searchValue:K,onSearch:C,defaultActiveFirstOption:!0,optionFilterProp:"filterValue",onChange:e=>{if(W)w.setFieldsValue({environments:{environment:(I?null===W||void 0===W?void 0:W.namespace:null===W||void 0===W?void 0:W.name)||"",version:(0,a.A_)(W),image:W}});else{const n=D.flatMap((e=>e.environmentGroups)).filter((n=>n.environmentName===e))[0].images[0];w.setFieldsValue({environments:{environment:(I?null===n||void 0===n?void 0:n.namespace:null===n||void 0===n?void 0:n.name)||"",version:(0,a.A_)(n),image:n}})}},disabled:V._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:W?(0,b.jsx)(p.A.Option,{value:I?null===W||void 0===W?void 0:W.namespace:null===W||void 0===W?void 0:W.name,filterValue:(0,a.A_)(W),children:(0,b.jsxs)(o.A,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,b.jsx)(d.A,{image:(0,a.A_)(W)||"",style:{width:15,height:15}}),(0,a.A_)(W)]})}):x().map(D,(e=>(0,b.jsx)(p.A.OptGroup,{label:e.groupName,children:x().map(e.environmentGroups,(e=>{var n;const l=e.images[0],i=null===T||void 0===T?void 0:T.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[2]],r=[];let t=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(r.push(e.prefix),t=(0,b.jsx)(h.A,{color:"purple",children:(0,b.jsx)(m.A,{keyword:K,children:e.prefix})}));const s=x().map(null===i||void 0===i?void 0:i.label,(e=>x().isUndefined(e.category)&&e.tag&&e.color?(r.push(e.tag),(0,b.jsx)(h.A,{color:e.color,children:(0,b.jsx)(m.A,{keyword:K,children:e.tag},e.tag)},e.tag)):null));return(0,b.jsx)(p.A.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+r.join("\t"),children:(0,b.jsxs)(o.A,{direction:"row",justify:"between",children:[(0,b.jsxs)(o.A,{direction:"row",align:"center",gap:"xs",children:[(0,b.jsx)(d.A,{image:(0,a.A_)(l)||"",style:{width:15,height:15}}),(0,b.jsx)(m.A,{keyword:K,children:e.displayName})]}),(0,b.jsxs)(o.A,{direction:"row",className:B?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:O.marginXS,flexShrink:1},children:[t,s]})]})},e.environmentName)}))},e.groupName)))})}),(0,b.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var l,a;return(null===(l=e.environments)||void 0===l?void 0:l.environment)!==(null===(a=n.environments)||void 0===a?void 0:a.environment)},children:e=>{var n;let l,{getFieldValue:i}=e;return x().find(D,(e=>x().find(e.environmentGroups,(e=>{var n;return e.environmentName===(null===(n=i("environments"))||void 0===n?void 0:n.environment)&&(l=e,!0)})))),(0,b.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","version"],rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],children:(0,b.jsx)(p.A,{ref:z,onChange:e=>{const n=x().find(q,(n=>(0,a.A_)(n)===e));w.setFieldValue(["environments","image"],n)},showSearch:!0,searchValue:N,onSearch:E,optionFilterProp:"filterValue",dropdownRender:e=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(o.A,{style:{fontWeight:O.fontWeightStrong,paddingLeft:O.paddingSM},children:[P("session.launcher.Version"),(0,b.jsx)(y.A,{type:"vertical"}),P("session.launcher.Architecture"),(0,b.jsx)(y.A,{type:"vertical"}),P("session.launcher.Tags")]}),(0,b.jsx)(y.A,{style:{margin:"8px 0"}}),e]}),disabled:V._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:x().map(x().uniqBy(null===(n=l)||void 0===n?void 0:n.images,"id"),(e=>{var n;const[l,i,...r]=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""];let s=null===T||void 0===T?void 0:T.tagAlias[i];if(!s){for(const[e,n]of Object.entries((null===T||void 0===T?void 0:T.tagReplace)||{})){const l=new RegExp(e);l.test(i)&&(s=null===i||void 0===i?void 0:i.replace(l,n))}s||(s=i)}const d=[],c=x().chain(r).filter((e=>!e.startsWith("customized_"))).map(((e,n)=>(0,b.jsx)(t.A,{values:x().split((null===T||void 0===T?void 0:T.tagAlias[e])||e,":").map((e=>(d.push(e),{label:e,highlightKeyword:N})))},n))).value(),v=null===e||void 0===e?void 0:e.labels;if(v){const e=x().findIndex(v,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key)));if(e&&v[e]){var g;const n=(null===(g=v[e])||void 0===g?void 0:g.value)||"";d.push("Customized"),d.push(n),c.push((0,b.jsx)(t.A,{highlightKeyword:N,values:[{label:"Customized",color:"cyan"},{label:null!==n&&void 0!==n?n:"",color:"cyan"}]},c.length+1))}}return(0,b.jsx)(p.A.Option,{value:(0,a.A_)(e),filterValue:[l,s,null===e||void 0===e?void 0:e.architecture,...d].join("\t"),children:I?(0,b.jsxs)(o.A,{direction:"row",children:[(0,b.jsx)(m.A,{keyword:N,children:null===e||void 0===e?void 0:e.version}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(m.A,{keyword:N,children:null===e||void 0===e?void 0:e.architecture}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(o.A,{direction:"row",align:"start",children:x().map(null===e||void 0===e?void 0:e.tags,(n=>{var l;const i=x().includes(n.key,"customized_"),r=i?null===(l=x().find(null===e||void 0===e?void 0:e.labels,{key:"ai.backend.customized-image.name"}))||void 0===l?void 0:l.value:n.value,o=L(n.key+r);return x().isEqual(o,(0,a.WY)(n.key+r))?(0,b.jsx)(t.A,{highlightKeyword:N,values:[{label:L(n.key),color:i?"cyan":"blue"},{label:null!==r&&void 0!==r?r:"",color:i?"cyan":"blue"}]},n.key):(0,b.jsx)(h.A,{color:i?"cyan":"blue",children:(0,b.jsx)(m.A,{keyword:N,children:o})},n.key)}))})]}):(0,b.jsx)(o.A,{direction:"row",justify:"between",children:(0,b.jsxs)(o.A,{direction:"row",children:[(0,b.jsx)(m.A,{keyword:N,children:M((0,a.A_)(e)||"")}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(m.A,{keyword:N,children:null===e||void 0===e?void 0:e.architecture}),(0,b.jsx)(y.A,{type:"vertical"}),(0,b.jsx)(u.Jj,{tag:(null===e||void 0===e?void 0:e.tag)||"",highlightKeyword:N,labels:null===e||void 0===e?void 0:e.labels})]})})},null===e||void 0===e?void 0:e.id)}))})})}}),(0,b.jsx)(c.A.Item,{label:P("session.launcher.ManualImageName"),name:["environments","manual"],style:{display:V._config.allow_manual_image_name_for_session?"block":"none"},children:(0,b.jsx)(f.A,{allowClear:!0,onChange:e=>{x().isEmpty(e)||w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}})}})}),(0,b.jsx)(c.A.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,b.jsx)(f.A,{})})]})}},90184:(e,n,l)=>{l.d(n,{A:()=>o});var a=l(23441),i=l(53350),r=l(60598);const t=e=>{let{image:n,style:l={},alt:i=""}=e;const[,{getImageIcon:t}]=(0,a.Gj)();return(0,r.jsx)("img",{src:t(n),style:{width:"1em",height:"1em",...l},alt:i})},o=i.memo(t)},32715:(e,n,l)=>{l.d(n,{Ay:()=>h,Jj:()=>y});var a=l(72375),i=l(23441),r=l(91238),t=(l(72338),l(96141)),o=l(24798),s=l(46976),d=l.n(s),u=l(53350),m=l(60598);const c=e=>{let{image:n,...l}=e;n=n||"";const[,{getImageAliasName:a,getBaseVersion:t,tagAlias:o}]=(0,i.Gj)();return(0,m.jsx)(r.A,{values:[{label:o(a(n)),color:"blue"},{label:t(n),color:"green"}],...l})},v=e=>{let{image:n,...l}=e;n=n||"";const[,{getBaseImage:a,tagAlias:r}]=(0,i.Gj)();return d().isEmpty(r(a(n)))?null:(0,m.jsx)(o.A,{color:"green",...l,children:r(a(n))})},g=e=>{let{image:n,...l}=e;n=n||"";const[,{getArchitecture:a,tagAlias:r}]=(0,i.Gj)();return d().isEmpty(r(a(n)))?null:(0,m.jsx)(o.A,{color:"green",...l,children:a(n)})},p=e=>{let{image:n}=e;return n=n||"",(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c,{image:n}),(0,m.jsx)(v,{image:n}),(0,m.jsx)(g,{image:n})]})},h=u.memo(p),y=e=>{let{tag:n,labels:l,highlightKeyword:s,...u}=e;l=l||[];const[,{getTags:c,tagAlias:v}]=(0,i.Gj)(),g=c(n,l);return(0,m.jsx)(m.Fragment,{children:d().map(g,((e,n)=>{const l="Customized"===e.key,i=v(e.key+e.value);return d().isEqual(i,(0,a.WY)(e.key+e.value))?(0,m.jsx)(r.A,{highlightKeyword:s,values:[{label:v(e.key),color:l?"cyan":"blue"},{label:e.value,color:l?"cyan":"blue"}]},e.key):(0,m.jsx)(o.A,{color:l?"cyan":"blue",children:(0,m.jsx)(t.A,{keyword:s,children:i},n)},e.key)}))})}},19528:(e,n,l)=>{l.d(n,{A:()=>$});var a,i=l(72375),r=l(23441),t=l(6742),o=l(73e3),s=l(85730),d=l(81530),u=l(68098),m=l(97759),c=l(10345),v=l(72338),g=l(10144),p=l(75863),h=l(96141),y=l(91238),f=l(46976),A=l.n(f),x=l(53350),j=l(22018),_=l(60598);const k=e=>{let{vFolderFrgmt:n=null,permission:i}=e;const r=(0,j.useFragment)(void 0!==a?a:a=l(13182),n),t=A().chain({r:"green",w:"blue",d:"red"}).map(((e,n)=>{if(((e,n)=>!(null===e||void 0===e||!e.includes(n))||!(null===e||void 0===e||!e.includes("w")||"r"!==n))((null===r||void 0===r?void 0:r.permission)||i,n))return{label:n.toUpperCase(),color:e}})).compact().value();return(0,_.jsx)(y.A,{values:t})};var b,F=l(30351),w=l(11504),S=l(43622),V=l(13170),I=l(50128),K=l(82919),C=l(83978),N=l(52335),E=l(37826),P=l(8227),T=l(24798),M=l(78502),R=l.n(M),L=l(85202),O=l(91788);const B=/^[a-zA-Z0-9_/.-]*$/,G="/home/work/",z=e=>{let{filter:n,showAliasInput:a=!1,selectedRowKeys:y=[],onChangeSelectedRowKeys:f,aliasBasePath:M=G,aliasMap:z,onChangeAliasMap:$,rowKey:q="name",onChangeAutoMountedFolders:D,showAutoMountedFoldersSection:W,...Q}=e;const{generateFolderPath:U}=(0,p.useFolderExplorerOpener)(),J=x.useMemo((()=>e=>e&&e[q]),[q]),[H,Y]=(0,x.useState)(!1),[X,Z]=(0,s.A)({value:y,onChange:f},{defaultValue:[]}),[ee,ne]=(0,s.A)({value:z,onChange:$},{defaultValue:{}}),le=(0,r.CX)(),[ae]=(0,t.x)(null===le||void 0===le?void 0:le._config.accessKey),[ie]=V.A.useForm();(0,x.useEffect)((()=>{ee&&(ie.setFieldsValue(A().mapValues(ee,(e=>e.startsWith(M)?e.slice(M.length):e))),ie.validateFields())}),[ee,ie,M]);const{t:re}=(0,O.Bd)(),te=(0,i.QE)(),oe=(0,d.hd)(),[se,de]=(0,r.Tw)("first"),[ue,me]=(0,x.useTransition)(),{data:ce}=(0,o.nj)({queryKey:["VFolderSelectQuery",se,oe.id],queryFn:()=>{const e=new URLSearchParams;return e.set("group_id",oe.id),te({method:"GET",url:`/folders?${e.toString()}`})},staleTime:1e3}),{domain:ve,group:ge,keypair_resource_policy:pe}=(0,j.useLazyLoadQuery)(void 0!==b?b:b=l(37449),{domain_name:le._config.domainName,group_id:oe.id,keypair_resource_policy_name:(null===ae||void 0===ae?void 0:ae.resource_policy)||""},{fetchPolicy:"store-and-network",fetchKey:se}),he=(0,x.useMemo)((()=>{const e=JSON.parse((null===ve||void 0===ve?void 0:ve.allowed_vfolder_hosts)||"{}"),n=JSON.parse((null===ge||void 0===ge?void 0:ge.allowed_vfolder_hosts)||"{}"),l=JSON.parse((null===pe||void 0===pe?void 0:pe.allowed_vfolder_hosts)||"{}"),a=A().merge({},e,n,l),i=Object.keys(a).filter((e=>a[e].includes("mount-in-session")));return null===ce||void 0===ce?void 0:ce.filter((e=>i.includes(e.host)))}),[ve,ge,pe,ce]),ye=(0,x.useMemo)((()=>A().chain(he).filter((e=>{var n;return"ready"===e.status&&(null===(n=e.name)||void 0===n?void 0:n.startsWith("."))})).map((e=>e.name)).value()),[he]);(0,x.useEffect)((()=>{A().isFunction(D)&&D(ye)}),[ye]);const[fe,Ae]=(0,x.useState)(""),xe=A().chain(he).filter((e=>!n||n(e))).filter((e=>!!X.includes(J(e))||(!fe||e.name.includes(fe)))).value(),je=(0,x.useCallback)(((e,n)=>void 0===n||""===n?`${M}${e}`:n.startsWith("/")?n:`${M}${n}`),[M]),_e=(0,u.E)((()=>{ne(A().mapValues(A().pickBy(ie.getFieldsValue({strict:!1}),(e=>!!e)),((e,n)=>je(n,e)))),ie.validateFields().catch((()=>{}))}));(0,x.useEffect)((()=>{_e()}),[JSON.stringify(X),_e]);const ke=(0,c.useShadowRoot)(),be=[{title:(0,_.jsxs)(v.A,{direction:"row",gap:"xxs",children:[(0,_.jsx)(I.A.Text,{children:re("data.folders.Name")}),a&&(0,_.jsx)(_.Fragment,{children:(0,_.jsxs)(I.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",re("session.launcher.FolderAlias")," ",(0,_.jsx)(K.A,{title:(0,_.jsx)(O.x6,{i18nKey:"session.launcher.DescFolderAlias"}),getPopupContainer:()=>ke,children:(0,_.jsx)(F.A,{})}),")"]})})]}),dataIndex:"name",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n)=>{const l=X.includes(J(n));return(0,_.jsxs)(v.A,{direction:"column",align:"start",gap:"xxs",style:a&&l?{display:"inline-flex",height:70,width:"100%"}:{maxWidth:200},children:[(0,_.jsx)(m.A,{type:"hover",to:U(n.id),children:(0,_.jsx)(h.A,{keyword:fe,children:e})}),a&&l&&(0,_.jsx)(V.A.Item,{noStyle:!0,shouldUpdate:(e,l)=>e[J(n)]!==l[J(n)],children:()=>{const e=A()(X).reduce(((e,n)=>(e[n]=(null===ee||void 0===ee?void 0:ee[n])||je(n,void 0),e)),{});return(0,_.jsx)(V.A.Item,{name:J(n),rules:[{type:"string",pattern:B,message:re("session.launcher.FolderAliasInvalid")},{type:"string",validator:async(l,a)=>a&&A().some(e,((e,l)=>l!==J(n)&&e===je(J(n),a)))?Promise.reject(re("session.launcher.FolderAliasOverlapping")):Promise.resolve()},{type:"string",validator:async(e,l)=>{const a=je(J(n),l);return l&&A().map(ye,(e=>je("",e))).includes(a)?Promise.reject(re("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],extra:je(n.name,ie.getFieldValue(J(n))),children:(0,_.jsx)(C.A,{onClick:e=>{e.stopPropagation()},placeholder:re("session.launcher.FolderAlias"),allowClear:!0,onChange:()=>{_e()}})})}})]})}},{title:re("data.UsageMode"),dataIndex:"usage_mode",sorter:(e,n)=>e.usage_mode.localeCompare(n.usage_mode)},{title:re("data.Host"),dataIndex:"host"},{title:re("data.Type"),dataIndex:"type",sorter:(e,n)=>e.type.localeCompare(n.type),render:(e,n)=>(0,_.jsxs)(v.A,{direction:"column",children:["user"===n.type?(0,_.jsx)(w.A,{title:"User"}):(0,_.jsx)("div",{children:"Group"}),"group"===n.type&&`(${n.group_name})`]})},{title:re("data.Permission"),dataIndex:"permission",sorter:(e,n)=>e.permission.localeCompare(n.permission),render:(e,n)=>(0,_.jsx)(k,{permission:n.permission})},{title:re("data.Created"),dataIndex:"created_at",sorter:(e,n)=>e.created_at.localeCompare(n.created_at),render:(e,n)=>R()(e).format("L"),defaultSortOrder:"descend"}];return(0,_.jsxs)(v.A,{direction:"column",align:"stretch",gap:"xs",children:[(0,_.jsxs)(v.A,{direction:"row",gap:"xs",justify:"between",children:[(0,_.jsx)(C.A,{value:fe,onChange:e=>Ae(e.target.value),allowClear:!0,placeholder:re("data.SearchByName")}),(0,_.jsx)(K.A,{title:re("button.Refresh"),children:(0,_.jsx)(N.Ay,{loading:ue,icon:(0,_.jsx)(S.A,{}),onClick:()=>{me((()=>{de()}))}})}),(0,_.jsx)(K.A,{title:re("data.CreateANewStorageFolder"),children:(0,_.jsx)(N.Ay,{icon:(0,_.jsx)(L.A,{}),type:"primary",ghost:!0,onClick:()=>{Y(!0)}})})]}),(0,_.jsx)(V.A,{form:ie,component:!1,preserve:!1,children:(0,_.jsx)(E.A,{scroll:{x:"max-content"},rowKey:J,rowSelection:{selectedRowKeys:X,onChange:e=>{Z(e),_e()}},showSorterTooltip:!1,columns:be,dataSource:xe,onRow:(e,n)=>({onClick:n=>{var l;const a=n.target;null!==a&&void 0!==a&&null!==(l=a.classList)&&void 0!==l&&l.contains("ant-table-selection-column")&&(n.stopPropagation(),X.includes(J(e))?Z(X.filter((n=>n!==J(e)))):Z([...X,J(e)]))}}),sortDirections:["ascend","descend"],...Q})}),W&&ye.length>0?(0,_.jsx)(_.Fragment,{children:(0,_.jsx)(P.A,{size:"small",children:(0,_.jsx)(P.A.Item,{label:re("data.AutomountFolders"),children:A().map(ye,(e=>(0,_.jsx)(T.A,{children:e},e)))})})}):null,(0,_.jsx)(g.A,{open:H,onRequestClose:e=>{Y(!1),e&&me((()=>{de(),Z((n=>[...n,e[q]]))}))}})]})},$=e=>{let{filter:n,rowKey:l="name",tableProps:a,...i}=e;const r=V.A.useFormInstance(),{t:t}=(0,O.Bd)();return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(V.A.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator(e,n){const l=A().chain(r.getFieldValue("mounts")).reduce(((e,l)=>(e[l]=n[l]||"/home/work/"+l,e)),{}).values().value();return A().uniq(l).length!==l.length?Promise.reject(t("session.launcher.FolderAliasOverlapping")):A().some(l,(e=>!B.test(e)))?Promise.reject(t("session.launcher.FolderAliasInvalid")):A().some(r.getFieldValue("autoMountedFolderNames"),(e=>l.includes(G+e)))?Promise.reject(t("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],children:(0,_.jsx)(C.A,{})}),(0,_.jsx)(V.A.Item,{hidden:!0,name:"autoMountedFolderNames"}),(0,_.jsx)(V.A.Item,{name:"mounts",...i,valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,_.jsx)(z,{rowKey:l,showAliasInput:!0,aliasMap:r.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:e=>{r.setFieldValue("vfoldersAliasMap",e),r.validateFields(["vfoldersAliasMap"])},pagination:!1,filter:n,showAutoMountedFoldersSection:!0,onChangeAutoMountedFolders:e=>{r.setFieldValue("autoMountedFolderNames",e)},...a})})]})}},3796:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},l=[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base_image_name",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"version",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:a,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:a},params:{cacheID:"9ff1339a66b7da77df70de956e3c7dd8",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:'query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    name @deprecatedSince(version: "24.12.0")\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n    namespace @since(version: "24.12.0")\n    base_image_name @since(version: "24.12.0")\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    version @since(version: "24.12.0")\n  }\n}\n'}}}();a.hash="40b2d995106300fffb0c3a5d66103d38";const i=a},13182:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"},i=a},37449:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domain_name"},{defaultValue:null,kind:"LocalArgument",name:"group_id"},{defaultValue:null,kind:"LocalArgument",name:"keypair_resource_policy_name"}],n=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],l=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domain_name"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domain_name"},{kind:"Variable",name:"id",variableName:"group_id"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"keypair_resource_policy_name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:n,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderTableProjectQuery",selections:l,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderTableProjectQuery",selections:l},params:{cacheID:"2c2ce905afd89e93c6d761f22ed59f3d",id:null,metadata:{},name:"VFolderTableProjectQuery",operationKind:"query",text:"query VFolderTableProjectQuery(\n  $domain_name: String!\n  $group_id: UUID!\n  $keypair_resource_policy_name: String!\n) {\n  domain(name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  group(id: $group_id, domain_name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $keypair_resource_policy_name) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();a.hash="ccdbaa52a63c2ea005423e7c541eff80";const i=a}}]);
//# sourceMappingURL=959.c41f94e0.chunk.js.map