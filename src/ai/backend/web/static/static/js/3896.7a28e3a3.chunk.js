"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[3896],{93896:(e,a,n)=>{n.r(a),n.d(a,{StorageStatusPanelFallback:()=>T,default:()=>Q});var l,i=n(72375),r=n(23441),o=n(7971),s=n(73e3),t=n(81530),d=n(72338),u=n(81654),c=n(93488),p=n(9571),m=n(24713),_=n(50128),y=n(53350),g=n(91788),k=n(22018),v=n(60598);const x=e=>{var a,r,o,s,t;let{usageProgressFrgmt:u}=e;const{t:c}=(0,g.Bd)(),{token:y}=p.A.useToken(),x=(0,k.useFragment)(void 0!==l?l:l=n(92),u),h=parseFloat(null===x||void 0===x||null===(a=x.details)||void 0===a?void 0:a.usage_bytes)||0,j=parseFloat(null===x||void 0===x||null===(r=x.details)||void 0===r?void 0:r.hard_limit_bytes)||0,S=j>0?null===(o=h/j*100)||void 0===o?void 0:o.toFixed(2):0;return(0,v.jsxs)(d.A,{direction:"column",children:[(0,v.jsx)(m.A,{size:[180,15],percent:S,strokeColor:(0,i.yc)(S),status:S>=100?"exception":"normal"}),(0,v.jsxs)(d.A,{direction:"row",gap:y.marginXXS,style:{fontSize:12},children:[(0,v.jsxs)(_.A.Text,{type:"secondary",style:{fontSize:12},children:[c("data.Used"),":"]}),(0,i.wb)(null===x||void 0===x||null===(s=x.details)||void 0===s?void 0:s.usage_bytes)," GB",(0,v.jsx)(_.A.Text,{type:"secondary",style:{fontSize:12},children:" / "}),(0,v.jsxs)(_.A.Text,{type:"secondary",style:{fontSize:12},children:[c("data.Limit"),":"]}),(0,i.wb)(null===x||void 0===x||null===(t=x.details)||void 0===t?void 0:t.hard_limit_bytes)," GB"]})]})};var h,j,S=n(38639),f=n(40056),b=n(82919),F=n(52335),A=n(4833),P=n(20418),w=n(8227),q=n(91867),K=n(46976),L=n.n(K);const T=()=>{const{t:e}=(0,g.Bd)();return(0,v.jsx)(P.A,{size:"small",title:e("data.StorageStatus"),children:(0,v.jsx)(q.A,{active:!0})})},Q=e=>{var a,l,q,K;let{fetchKey:T}=e;const{t:Q}=(0,g.Bd)(),{token:V}=p.A.useToken(),$=(0,r.CX)(),R=(0,t.hd)(),D=(0,o.Am)(),[N,U]=(0,y.useState)(),z=(0,y.useDeferredValue)(N),C=(0,y.useDeferredValue)(T),X=e=>L().includes(["delete-ongoing","delete-complete","delete-error"],e),{data:B}=(0,s.nj)({queryKey:["vfolders",{deferredFetchKey:C}],queryFn:()=>$.vfolder.list(null===R||void 0===R?void 0:R.id)}),I=null===B||void 0===B?void 0:B.filter((e=>e.is_owner&&"user"===e.ownership_type&&!X(e.status))).length,E=null===B||void 0===B?void 0:B.filter((e=>"group"===e.ownership_type&&!X(e.status))).length,H=null===B||void 0===B?void 0:B.filter((e=>!e.is_owner&&"user"===e.ownership_type&&!X(e.status))).length,{keypair:Z,user:G}=(0,k.useLazyLoadQuery)(void 0!==h?h:h=n(32914),{domain_name:(0,r.eZ)(),email:null===$||void 0===$?void 0:$.email,access_key:null===$||void 0===$?void 0:$._config.accessKey}),{user_resource_policy:O,project_resource_policy:W,keypair_resource_policy:M,project_quota_scope:J,user_quota_scope:Y}=(0,k.useLazyLoadQuery)(void 0!==j?j:j=n(92689),{user_RP_name:null===G||void 0===G?void 0:G.resource_policy,project_RP_name:null!==(a=null===R||void 0===R?void 0:R.name)&&void 0!==a?a:"",keypair_resource_policy_name:null===Z||void 0===Z?void 0:Z.resource_policy,project_quota_scope_id:(0,i.sZ)("project",null===R||void 0===R?void 0:R.id),user_quota_scope_id:(0,i.sZ)("user",(null===G||void 0===G?void 0:G.id)||""),storage_host_name:(null===z||void 0===z?void 0:z.id)||"",skipQuotaScope:void 0===(null===R||void 0===R?void 0:R.id)||void 0===(null===G||void 0===G?void 0:G.id)||!(null!==z&&void 0!==z&&z.id)});let ee;ee=null!==$&&void 0!==$&&$.supports("max-vfolder-count-in-user-and-project-resource-policy")?(null===O||void 0===O?void 0:O.max_vfolder_count)||0:(null===M||void 0===M?void 0:M.max_vfolder_count)||0;const ae=ee||0===ee?ee>0?null===(l=I/ee*100)||void 0===l?void 0:l.toFixed(2):0:null,ne=[{key:"totalFolders",label:Q("data.NumberOfFolders"),children:(0,v.jsxs)(v.Fragment,{children:[ae||0===ae?(0,v.jsx)(m.A,{size:[200,15],percent:ae,strokeColor:(0,i.yc)(ae),style:{width:"95%"},status:ae>=100?"exception":"normal"}):null,(0,v.jsxs)(d.A,{direction:"row",gap:V.marginXXS,wrap:"wrap",children:[(0,v.jsxs)(_.A.Text,{type:"secondary",children:[Q("data.Created"),":"]}),I,ee||0===ee?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(_.A.Text,{type:"secondary",children:" / "}),(0,v.jsxs)(_.A.Text,{type:"secondary",children:[Q("data.Limit"),":"]}),0===ee?"\u221e":ee]}):null]}),(0,v.jsx)(f.A,{style:{margin:"12px auto"}}),(0,v.jsxs)(d.A,{direction:"row",wrap:"wrap",justify:"between",children:[(0,v.jsxs)(d.A,{gap:V.marginXXS,children:[(0,v.jsxs)(_.A.Text,{type:"secondary",children:[Q("data.ProjectFolder"),":"]}),E,("admin"===D||"superadmin"===D)&&(null!==(q=null===W||void 0===W?void 0:W.max_vfolder_count)&&void 0!==q?q:-1)>=0?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(_.A.Text,{type:"secondary",children:" / "}),(0,v.jsxs)(_.A.Text,{type:"secondary",children:[Q("data.Limit"),":"]}),0===(null===W||void 0===W?void 0:W.max_vfolder_count)?"\u221e":null===W||void 0===W?void 0:W.max_vfolder_count]}):null]}),(0,v.jsxs)(d.A,{gap:V.marginXXS,style:{marginRight:30},children:[(0,v.jsxs)(_.A.Text,{type:"secondary",children:[Q("data.Invited"),":"]}),H]})]})]})},{key:"quotaPerStorageVolume",label:(0,v.jsxs)("div",{children:[Q("data.QuotaPerStorageVolume"),(0,v.jsx)(b.A,{title:Q("data.HostDetails"),children:(0,v.jsx)(F.Ay,{type:"link",icon:(0,v.jsx)(S.A,{})})})]}),children:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(d.A,{wrap:"wrap",justify:"between",direction:"row",style:{minWidth:"25vw"},children:[(0,v.jsx)(_.A.Text,{type:"secondary",children:Q("data.Host")}),(0,v.jsx)(c.A,{value:null===N||void 0===N?void 0:N.id,onChange:(e,a)=>{U(a)},autoSelectType:"usage",showUsageStatus:!0,showSearch:!0,allowClear:!0})]}),N!==z?(0,v.jsx)(u.A,{style:{minHeight:120}}):null!==N&&void 0!==N&&null!==(K=N.capabilities)&&void 0!==K&&K.includes("quota")?(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(d.A,{style:{margin:"15px auto"},justify:"between",wrap:"wrap",children:[(0,v.jsxs)(_.A.Text,{type:"secondary",style:{wordBreak:"keep-all",wordWrap:"break-word"},children:[Q("data.Project"),(0,v.jsx)("br",{}),"(",null===R||void 0===R?void 0:R.name,")"]}),(0,v.jsx)(x,{usageProgressFrgmt:J||null})]}),(0,v.jsxs)(d.A,{justify:"between",wrap:"wrap",children:[(0,v.jsxs)(_.A.Text,{type:"secondary",style:{wordBreak:"keep-all",wordWrap:"break-word"},children:[Q("data.User"),(0,v.jsx)("br",{}),"(",null===$||void 0===$?void 0:$.email,")"]}),(0,v.jsx)(x,{usageProgressFrgmt:Y||null})]})]}):(0,v.jsx)(A.A,{image:A.A.PRESENTED_IMAGE_SIMPLE,description:Q("storageHost.QuotaDoesNotSupported"),style:{margin:"25px auto"}})]})},{key:"userQuotaScopeId",label:Q("data.UserQuotaScopeId"),children:(0,v.jsx)(_.A.Text,{copyable:!0,children:(0,i.sZ)("user",(null===G||void 0===G?void 0:G.id)||"")})}];return(0,v.jsx)(P.A,{size:"small",title:Q("data.StorageStatus"),children:(0,v.jsx)(w.A,{bordered:!0,column:{xxl:2,xl:2,lg:2,md:1,sm:1,xs:1},size:"small",items:ne})})}},32914:(e,a,n)=>{n.r(a),n.d(a,{default:()=>i});const l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"access_key"},a={defaultValue:null,kind:"LocalArgument",name:"domain_name"},n={defaultValue:null,kind:"LocalArgument",name:"email"},l={kind:"Variable",name:"domain_name",variableName:"domain_name"},i=[{kind:"Variable",name:"access_key",variableName:"access_key"},l],r={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:[l,{kind:"Variable",name:"email",variableName:"email"}],concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[o,r],storageKey:null};return{fragment:{argumentDefinitions:[e,a,n],kind:"Fragment",metadata:null,name:"StorageStatusPanelKeypairQuery",selections:[{alias:null,args:i,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[r],storageKey:null},s],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,n,e],kind:"Operation",name:"StorageStatusPanelKeypairQuery",selections:[{alias:null,args:i,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[r,o],storageKey:null},s]},params:{cacheID:"95e9a2aff9ba76edfc0781be14e9263f",id:null,metadata:{},name:"StorageStatusPanelKeypairQuery",operationKind:"query",text:'query StorageStatusPanelKeypairQuery(\n  $domain_name: String\n  $email: String\n  $access_key: String\n) {\n  keypair(domain_name: $domain_name, access_key: $access_key) {\n    resource_policy\n    id\n  }\n  user(domain_name: $domain_name, email: $email) {\n    id\n    resource_policy @since(version: "23.09.0")\n  }\n}\n'}}}();l.hash="356fec51b64103fba9f667dba1713774";const i=l},92689:(e,a,n)=>{n.r(a),n.d(a,{default:()=>i});const l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"keypair_resource_policy_name"},a={defaultValue:null,kind:"LocalArgument",name:"project_RP_name"},n={defaultValue:null,kind:"LocalArgument",name:"project_quota_scope_id"},l={defaultValue:null,kind:"LocalArgument",name:"skipQuotaScope"},i={defaultValue:null,kind:"LocalArgument",name:"storage_host_name"},r={defaultValue:null,kind:"LocalArgument",name:"user_RP_name"},o={defaultValue:null,kind:"LocalArgument",name:"user_quota_scope_id"},s=[{kind:"Variable",name:"name",variableName:"user_RP_name"}],t={alias:null,args:null,kind:"ScalarField",name:"max_vfolder_count",storageKey:null},d=[t],u=[{kind:"Variable",name:"name",variableName:"project_RP_name"}],c={alias:null,args:[{kind:"Variable",name:"name",variableName:"keypair_resource_policy_name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:d,storageKey:null},p={kind:"Variable",name:"storage_host_name",variableName:"storage_host_name"},m=[{kind:"Variable",name:"quota_scope_id",variableName:"project_quota_scope_id"},p],_=[{args:null,kind:"FragmentSpread",name:"UsageProgressFragment_usageFrgmt"}],y=[{kind:"Variable",name:"quota_scope_id",variableName:"user_quota_scope_id"},p],g={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},k=[t,g],v=[{alias:null,args:null,concreteType:"QuotaDetails",kind:"LinkedField",name:"details",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"usage_bytes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hard_limit_bytes",storageKey:null}],storageKey:null},g];return{fragment:{argumentDefinitions:[e,a,n,l,i,r,o],kind:"Fragment",metadata:null,name:"StorageStatusPanelQuery",selections:[{alias:null,args:s,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policy",plural:!1,selections:d,storageKey:null},{alias:null,args:u,concreteType:"ProjectResourcePolicy",kind:"LinkedField",name:"project_resource_policy",plural:!1,selections:d,storageKey:null},c,{condition:"skipQuotaScope",kind:"Condition",passingValue:!1,selections:[{alias:"project_quota_scope",args:m,concreteType:"QuotaScope",kind:"LinkedField",name:"quota_scope",plural:!1,selections:_,storageKey:null},{alias:"user_quota_scope",args:y,concreteType:"QuotaScope",kind:"LinkedField",name:"quota_scope",plural:!1,selections:_,storageKey:null}]}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[r,a,e,n,o,i,l],kind:"Operation",name:"StorageStatusPanelQuery",selections:[{alias:null,args:s,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policy",plural:!1,selections:k,storageKey:null},{alias:null,args:u,concreteType:"ProjectResourcePolicy",kind:"LinkedField",name:"project_resource_policy",plural:!1,selections:k,storageKey:null},c,{condition:"skipQuotaScope",kind:"Condition",passingValue:!1,selections:[{alias:"project_quota_scope",args:m,concreteType:"QuotaScope",kind:"LinkedField",name:"quota_scope",plural:!1,selections:v,storageKey:null},{alias:"user_quota_scope",args:y,concreteType:"QuotaScope",kind:"LinkedField",name:"quota_scope",plural:!1,selections:v,storageKey:null}]}]},params:{cacheID:"2c62e20fea60ae39e607be391ca36756",id:null,metadata:{},name:"StorageStatusPanelQuery",operationKind:"query",text:'query StorageStatusPanelQuery(\n  $user_RP_name: String\n  $project_RP_name: String!\n  $keypair_resource_policy_name: String\n  $project_quota_scope_id: String!\n  $user_quota_scope_id: String!\n  $storage_host_name: String!\n  $skipQuotaScope: Boolean!\n) {\n  user_resource_policy(name: $user_RP_name) @since(version: "23.09.6") {\n    max_vfolder_count\n    id\n  }\n  project_resource_policy(name: $project_RP_name) @since(version: "23.09.1") {\n    max_vfolder_count\n    id\n  }\n  keypair_resource_policy(name: $keypair_resource_policy_name) @deprecatedSince(version: "23.09.4") {\n    max_vfolder_count\n  }\n  project_quota_scope: quota_scope(quota_scope_id: $project_quota_scope_id, storage_host_name: $storage_host_name) @skip(if: $skipQuotaScope) {\n    ...UsageProgressFragment_usageFrgmt\n    id\n  }\n  user_quota_scope: quota_scope(quota_scope_id: $user_quota_scope_id, storage_host_name: $storage_host_name) @skip(if: $skipQuotaScope) {\n    ...UsageProgressFragment_usageFrgmt\n    id\n  }\n}\n\nfragment UsageProgressFragment_usageFrgmt on QuotaScope {\n  details {\n    usage_bytes\n    hard_limit_bytes\n  }\n}\n'}}}();l.hash="0bad5a3f57d0dad70587152931566e8c";const i=l},92:(e,a,n)=>{n.r(a),n.d(a,{default:()=>i});const l={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UsageProgressFragment_usageFrgmt",selections:[{alias:null,args:null,concreteType:"QuotaDetails",kind:"LinkedField",name:"details",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"usage_bytes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"hard_limit_bytes",storageKey:null}],storageKey:null}],type:"QuotaScope",abstractKey:null,hash:"1ba87b250f2a0161ecee7ba88d54c85c"},i=l}}]);
//# sourceMappingURL=3896.7a28e3a3.chunk.js.map