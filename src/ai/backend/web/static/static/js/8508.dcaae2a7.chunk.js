"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[8508],{83286:(e,n,s)=>{s.d(n,{A:()=>m});var l=s(18554),t=s(87955),i=s(4994),a=s.n(i),o=s(8348),r=s.n(o),d=s(66610),u=s(66906);const c=d.forwardRef(((e,n)=>{let{value:s,onChange:i,localFormat:o,...d}=e;const[,c]=(0,l.A)({value:s,onChange:i});return(0,u.jsx)(t.A,{ref:n,value:s?a()(s):void 0,onChange:e=>{var n,s,l;r().isArray(e)&&(e=e[0]);const t=o?null===(n=e)||void 0===n?void 0:n.format():null===(s=e)||void 0===s||null===(l=s.tz())||void 0===l?void 0:l.toISOString();c(t)},...d})}));c.displayName="DatePickerISO";const m=c},98220:(e,n,s)=>{s.d(n,{A:()=>a});var l=s(78375),t=s(66610),i=s(66906);const a=e=>{let{value:n,...s}=e;const a=l.A.useFormInstance();return(0,t.useEffect)((()=>{a.setFieldValue(s.name,n)}),[n,a,s.name]),(0,i.jsx)(l.A.Item,{...s,hidden:!0,children:(0,i.jsx)("div",{})})}},68554:(e,n,s)=>{s.d(n,{f:()=>c});const l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"projectId"},s=[{alias:null,args:[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"project_id",variableName:"projectId"}],concreteType:"ComputeSessionConnection",kind:"LinkedField",name:"compute_session_nodes",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"count",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n],kind:"Fragment",metadata:null,name:"useValidateSessionNameQuery",selections:s,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e],kind:"Operation",name:"useValidateSessionNameQuery",selections:s},params:{cacheID:"2392cc957c8d4e1b5ff8eb0717faa135",id:null,metadata:{},name:"useValidateSessionNameQuery",operationKind:"query",text:"query useValidateSessionNameQuery(\n  $projectId: UUID!\n  $filter: String\n) {\n  compute_session_nodes(project_id: $projectId, filter: $filter) {\n    count\n  }\n}\n"}}}();l.hash="4384b91173f16b29861a6bb9cfa6cbfa";const t=l;var i=s(71526),a=s(8348),o=s.n(a),r=s(66610),d=s(54070),u=s(89737);const c=e=>{const{t:n}=(0,d.Bd)(),s=(0,u.useRelayEnvironment)(),l=(0,i.hd)();return(0,r.useMemo)((()=>[{min:4,message:n("session.validation.SessionNameTooShort")},{max:64,message:n("session.validation.SessionNameTooLong64")},{validator:(e,s)=>o().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/\w$/.test(s)?/^[\w.-]*$/.test(s)?Promise.resolve():Promise.reject(n("session.validation.SessionNameInvalidCharacter")):Promise.reject(n("session.validation.SessionNameShouldEndWith")):Promise.reject(n("session.validation.SessionNameShouldStartWith"))},{validator:async(i,a)=>a!==e&&a?(0,u.fetchQuery)(s,t,{projectId:l.id,filter:`status != "TERMINATED" & status != "CANCELLED" & name == "${a}"`}).toPromise().catch((e=>{})).then((e=>{var s,l;if((null!==(s=null===e||void 0===e||null===(l=e.compute_session_nodes)||void 0===l?void 0:l.count)&&void 0!==s?s:0)>0)return Promise.reject(n("session.launcher.SessionAlreadyExists"))})):Promise.resolve()},e?{required:!0}:{}]),[e,s,l.id,n])}},98508:(e,n,s)=>{s.r(n),s.d(n,{ResourceNumbersOfSession:()=>We,SESSION_LAUNCHER_NOTI_PREFIX:()=>Ue,default:()=>Qe});const l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],n=[{kind:"Variable",name:"id",variableName:"id"}],s={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionLauncherPageAfterCreationQuery",selections:[{alias:null,args:n,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"BAINodeNotificationItemFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionLauncherPageAfterCreationQuery",selections:[{alias:null,args:n,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[s,{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[l,t,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},i,{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commit_status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"agent_id",storageKey:null},s,i,{alias:null,args:null,kind:"ScalarField",name:"cluster_idx",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_role",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_hostname",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"vfolder_mounts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_data",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"queue_position",storageKey:null}],type:"ComputeSessionNode",abstractKey:null},{kind:"InlineFragment",selections:[l,t],type:"VirtualFolderNode",abstractKey:null}],type:"Node",abstractKey:"__isNode"}],storageKey:null}]},params:{cacheID:"38a763d21085b81a39791f715aa0fff9",id:null,metadata:{},name:"SessionLauncherPageAfterCreationQuery",operationKind:"query",text:'query SessionLauncherPageAfterCreationQuery(\n  $id: GlobalIDField!\n) {\n  compute_session_node(id: $id) {\n    ...BAINodeNotificationItemFragment\n    id\n  }\n}\n\nfragment AppLauncherModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  service_ports\n  access_key\n}\n\nfragment BAIComputeSessionNodeNotificationItemFragment on ComputeSessionNode {\n  row_id\n  id\n  name\n  status\n  ...SessionActionButtonsFragment\n  ...SessionStatusTagFragment\n}\n\nfragment BAINodeNotificationItemFragment on Node {\n  __isNode: __typename\n  ... on ComputeSessionNode {\n    __typename\n    status\n    name\n    row_id\n    ...BAIComputeSessionNodeNotificationItemFragment\n  }\n  ... on VirtualFolderNode {\n    __typename\n    status\n  }\n  id\n}\n\nfragment ContainerCommitModalFragment on ComputeSessionNode {\n  id\n  name\n  row_id\n}\n\nfragment ContainerLogModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  status\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        id\n        row_id\n        container_id\n        cluster_idx\n        cluster_role\n        cluster_hostname\n      }\n    }\n  }\n}\n\nfragment SFTPConnectionInfoModalFragment on ComputeSessionNode {\n  row_id\n  vfolder_mounts\n}\n\nfragment SessionActionButtonsFragment on ComputeSessionNode {\n  id\n  row_id\n  type\n  status\n  access_key\n  service_ports\n  commit_status\n  user_id\n  ...TerminateSessionModalFragment\n  ...ContainerLogModalFragment\n  ...ContainerCommitModalFragment\n  ...AppLauncherModalFragment\n  ...SFTPConnectionInfoModalFragment\n  ...useBackendAIAppLauncherFragment\n}\n\nfragment SessionStatusTagFragment on ComputeSessionNode {\n  id\n  status\n  status_info\n  status_data\n  queue_position @since(version: "25.13.0")\n}\n\nfragment TerminateSessionModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  scaling_group\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        container_id\n        agent_id\n        id\n      }\n    }\n  }\n}\n\nfragment useBackendAIAppLauncherFragment on ComputeSessionNode {\n  row_id\n  vfolder_mounts\n}\n'}}}();l.hash="f405c371be78f406d1270a88b3c43b2a";const t=l;var i=s(49135),a=s(83286),o=s(94985),r=s(89349),d=s(90183),u=s(19885),c=s(78375),m=s(49061),h=s(10760),g=s(8348),p=s.n(g),v=s(66610),x=s(54070),y=s(66906);const j=1024,A=65535,b=e=>{let{inValid:n,value:s,...l}=e;return(0,y.jsx)(h.A,{color:!n&&F(s)?void 0:"red",...l})},F=e=>{if(f(e)){const n=e.split(":"),[s,l]=n.map((e=>parseInt(e)));return s>=j&&l<=A}return e===parseInt(e).toString()&&parseInt(e)>=j&&parseInt(e)<=A},f=e=>{const n=e.split(":");if(2===n.length){const[e,s]=n.map((e=>parseInt(e)));return e<=s}return!1},S=e=>p().flatten(p().map(e,(e=>f(e)?(e=>{const[n,s]=e.split(":").map((e=>parseInt(e)));return p().range(n,s+1)})(e):parseInt(e)))),k=e=>{let{name:n="ports",...s}=e;const{t:l}=(0,x.Bd)(),t=(0,u.CX)(),i=c.A.useFormInstance();return(0,y.jsx)(c.A.Item,{label:l("session.launcher.PreOpenPortTitle"),name:n,tooltip:(0,y.jsx)(x.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:l("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,n)=>S(n).length<=t._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(l("session.launcher.PreOpenPortMaxCountLimit",{count:t._config.maxCountForPreopenPorts})))}),()=>({validator:(e,n)=>p().every(n,(e=>parseInt(e).toString()===e||f(e)))?Promise.resolve():Promise.reject(new Error(l("session.launcher.InvalidPortFormat")))}),()=>({validator(e,n){const s=S(n);return p().every(s,(e=>e>=j&&e<=A))?Promise.resolve():Promise.reject(new Error(l("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,n){const s=S(n);return p().uniq(s).length===s.length?Promise.resolve():Promise.reject(new Error(l("session.launcher.DuplicatedPort")))}})],...s,children:(0,y.jsx)(m.A,{mode:"tags",tagRender:e=>{const s=p().filter(S(i.getFieldValue(n)),(n=>n===parseInt(e.value))).length>1;return(0,y.jsx)(b,{inValid:s,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})};var w=s(213),_=s(52885),I=s(2212),N=s(77654);const E=e=>{let{open:n,onClose:s,...l}=e;const{t:t}=(0,x.Bd)(),[i,a]=(0,I.q)("has_opened_tour_neo_session_validation"),o=[{title:t("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:t("tourGuide.neoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:t("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:t("tourGuide.neoSessionLauncher.FixErrorFieldByModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:t("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:t("tourGuide.neoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,y.jsx)(N.A,{steps:o,onClose:e=>{null===s||void 0===s||s(e),a(!0)},open:!i&&n,...l})};var O=s(18682);const T=e=>{let{form:n}=e;const s=c.A.useWatch("mounts",n),l=O.A.useApp(),{t:t}=(0,x.Bd)(),i=(0,v.useMemo)((()=>p().isArray(s)&&s.length>0),[s]);return(0,v.useEffect)((()=>{i&&(l.message.warning(t("session.launcher.InvalidMountsSelectionWarning"),5),n.setFieldValue("mounts",void 0))}),[i,t,l.message,n]),null};var V=s(2156),C=s(71526),P=s(77950),D=s(54802),M=s(652),B=s(67208);const K=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],s={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},t],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,i],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s,t],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,i,t],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();K.hash="ba086835ea654ab889e0e6aaefa0abfe";const L=K;var z=s(37615),R=s(17457),q=s(61659),G=s(98220),U=s(15366),W=s(44163),$=s(97124),Q=s(86320),H=s(46551),J=s(33403),X=s(81014),Z=s(40260),Y=s(80503),ee=s(63872),ne=s(36415),se=s(89737);const le=e=>{const{t:n}=(0,x.Bd)(),s=c.A.useFormInstance(),l=c.A.useWatch(["owner","enabled"],s),t=(0,z.Am)();return("admin"===t||"superadmin"===t)&&l&&(0,y.jsx)(ee.Zu,{title:n("session.launcher.SetSessionOwner"),showDivider:!0,size:"small",status:s.getFieldError(["owner","email"]).length>0||s.getFieldError(["owner","accesskey"]).length>0||s.getFieldError(["owner","project"]).length>0||s.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit"),...e,children:(0,y.jsxs)(Y.A,{size:"small",column:1,children:[(0,y.jsx)(Y.A.Item,{label:n("session.launcher.OwnerEmail"),children:s.getFieldValue(["owner","email"])}),(0,y.jsx)(Y.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:s.getFieldValue(["owner","accesskey"])}),(0,y.jsx)(Y.A.Item,{label:n("session.launcher.OwnerGroup"),children:s.getFieldValue(["owner","project"])}),(0,y.jsx)(Y.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:s.getFieldValue(["owner","resourceGroup"])})]})})},te=e=>{const{t:n}=(0,x.Bd)(),{token:s}=W.A.useToken(),l=c.A.useFormInstance(),t=c.A.useWatch(["owner","enabled"],l),[i,a]=(0,v.useState)(),o=(0,se.useRelayEnvironment)(),{data:r,isFetching:d}=(0,R.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",i],queryFn:()=>{const e=l.getFieldValue(["owner","email"]);if(!e)return;const n=L;return(0,se.fetchQuery)(o,n,{email:e}).toPromise()},enabled:!!i}),u=l.getFieldValue(["owner","email"])?null===r||void 0===r?void 0:r.keypairs:void 0,h=l.getFieldValue(["owner","email"])?null===r||void 0===r?void 0:r.user:void 0,g=!d&&i&&!h;return(0,y.jsxs)($.A,{title:n("session.launcher.SetSessionOwner"),extra:(0,y.jsx)(c.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,y.jsx)(Q.A,{})}),styles:t?void 0:{header:{borderBottom:"none"},body:{display:t?"block":"none"}},...e,children:[(0,y.jsx)(G.A,{name:["owner","domainName"],value:null===h||void 0===h?void 0:h.domain_name}),(0,y.jsx)(c.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:o}=e;return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(ee.OO,{children:(0,y.jsx)(c.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:t},{type:"email",message:n("general.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:g?"error":void 0,help:g?n("credential.NoUserToDisplay"):void 0,children:(0,y.jsx)(H.A.Search,{onSearch:e=>{l.validateFields([["owner","email"]]).then((()=>{a(e)})).catch((()=>{}))},onChange:()=>{a(""),l.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:d,enterButton:!d&&h?(0,y.jsx)(J.Ay,{icon:(0,y.jsx)(ne.A,{})}):void 0})})}),(0,y.jsx)(c.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:o(["owner","enabled"])}],children:(0,y.jsx)(q.A,{options:p().map(u,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:p().isEmpty(i)||d})}),(0,y.jsxs)(X.A,{gutter:s.marginSM,children:[(0,y.jsx)(Z.A,{span:12,children:(0,y.jsx)(c.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:o(["owner","enabled"])}],children:(0,y.jsx)(q.A,{options:p().map(null===h||void 0===h?void 0:h.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:p().isEmpty(i)||d})})}),(0,y.jsx)(Z.A,{span:12,children:(0,y.jsx)(c.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,y.jsx)(v.Suspense,{fallback:(0,y.jsx)(c.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,y.jsx)(m.A,{loading:!0})}),children:(0,y.jsx)(c.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:s(["owner","project"])?(0,y.jsx)(U.A,{projectName:s(["owner","project"]),disabled:p().isEmpty(i)||d,autoSelectDefault:!0}):(0,y.jsx)(m.A,{disabled:!0})})})}})})]})]})}})]})};var ie=s(33670),ae=s(89214),oe=s(90077),re=s(12991),de=s(3115),ue=s(4994),ce=s.n(ue),me=s(86230),he=s(60307);const ge=e=>{var n,s,l,t,i,a,o,r,d,m,g,v,j,A,F,f,S,k,w,_,I,N,E,O,T,K,L,z,R,q,G,U,Q,H,J,ne;let{onClickEditStep:se}=e;const{t:te}=(0,x.Bd)(),ue=c.A.useFormInstance(),{token:ge}=W.A.useToken(),pe=(0,u.CX)(),ve=c.A.useWatch("sessionType",{form:ue,preserve:!0}),xe=null!==(n=null===pe||void 0===pe?void 0:pe.supports("batch-timeout"))&&void 0!==n&&n,ye=null!==(s=null===pe||void 0===pe?void 0:pe.supports("extended-image-info"))&&void 0!==s&&s,je=(0,C.hd)(),[,{getBaseVersion:Ae,getBaseImage:be,tagAlias:Fe}]=(0,u.Gj)(),{isDarkMode:fe}=(0,P.e)();return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(ee.Zu,{title:te("session.launcher.SessionType"),showDivider:!0,size:"small",status:ue.getFieldError("sessionName").length>0||ue.getFieldError(["batch","command"]).length>0||ue.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:te("button.Edit"),onClickExtraButton:()=>{se("sessionType")},children:(0,y.jsxs)(Y.A,{size:"small",column:1,children:[(0,y.jsx)(Y.A.Item,{label:te("session.SessionType"),children:ue.getFieldValue("sessionType")}),!p().isEmpty(ue.getFieldValue("sessionName"))&&(0,y.jsx)(Y.A.Item,{label:te("session.launcher.SessionName"),children:ue.getFieldValue("sessionName")}),"batch"===ve&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(Y.A.Item,{label:te("session.launcher.StartUpCommand"),styles:{label:{whiteSpace:"nowrap"},content:{overflow:"auto"}},children:ue.getFieldValue(["batch","command"])?(0,y.jsx)(ie.A,{language:"shell",children:ue.getFieldValue(["batch","command"])}):(0,y.jsx)(ae.A.Text,{type:"secondary",children:te("general.None")})}),(0,y.jsx)(Y.A.Item,{label:te("session.launcher.SessionStartTime"),children:ue.getFieldValue(["batch","scheduleDate"])?ce()(ue.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,y.jsx)(ae.A.Text,{type:"secondary",children:te("general.None")})}),xe?(0,y.jsx)(Y.A.Item,{label:te("session.launcher.BatchJobTimeoutDuration"),children:ue.getFieldValue(["batch","timeout"])?(0,y.jsxs)(ae.A.Text,{children:[ue.getFieldValue(["batch","timeout"]),ue.getFieldValue(["batch","timeoutUnit"])||"s"]}):(0,y.jsx)(ae.A.Text,{type:"secondary",children:te("general.None")})}):null]})]})}),(0,y.jsx)(le,{onClickExtraButton:()=>{se("sessionType")}}),(0,y.jsx)(ee.Zu,{title:te("session.launcher.Environments"),showDivider:!0,size:"small",status:p().some(ue.getFieldValue("envvars"),((e,n)=>ue.getFieldError(["envvars",n,"variable"]).length>0||ue.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:te("button.Edit"),onClickExtraButton:()=>{se("environment")},children:(0,y.jsxs)(Y.A,{size:"small",column:1,children:[(0,y.jsx)(Y.A.Item,{label:te("session.launcher.Project"),children:je.name}),(0,y.jsx)(Y.A.Item,{label:te("general.Image"),children:ye?(0,y.jsxs)(X.A,{style:{flexFlow:"nowrap"},children:[(0,y.jsx)(Z.A,{children:(0,y.jsx)(M.A,{image:(null===(l=ue.getFieldValue("environments"))||void 0===l?void 0:l.version)||(null===(t=ue.getFieldValue("environments"))||void 0===t?void 0:t.manual),style:{marginRight:ge.marginXS}})}),(0,y.jsx)(Z.A,{children:(0,y.jsx)(ee.OO,{direction:"row",wrap:"wrap",children:null!==(i=ue.getFieldValue("environments"))&&void 0!==i&&i.manual?(0,y.jsx)(ae.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(a=ue.getFieldValue("environments"))||void 0===a?void 0:a.manual},children:null===(o=ue.getFieldValue("environments"))||void 0===o?void 0:o.manual}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(ae.A.Text,{children:Fe(null===(r=ue.getFieldValue("environments"))||void 0===r||null===(d=r.image)||void 0===d?void 0:d.base_image_name)}),(0,y.jsx)(oe.A,{type:"vertical"}),(0,y.jsx)(ae.A.Text,{children:null===(m=ue.getFieldValue("environments"))||void 0===m||null===(g=m.image)||void 0===g?void 0:g.version}),(0,y.jsx)(oe.A,{type:"vertical"}),(0,y.jsx)(ae.A.Text,{children:null===(v=ue.getFieldValue("environments"))||void 0===v||null===(j=v.image)||void 0===j?void 0:j.architecture}),(0,y.jsx)(oe.A,{type:"vertical"}),p().map(null===(A=ue.getFieldValue("environments"))||void 0===A||null===(F=A.image)||void 0===F?void 0:F.tags,(e=>{var n,s,l;const t=p().includes(e.key,"customized_"),i=t?null===(n=p().find(null===(s=ue.getFieldValue("environments"))||void 0===s||null===(l=s.image)||void 0===l?void 0:l.labels,{key:"ai.backend.customized-image.name"}))||void 0===n?void 0:n.value:e.value,a=Fe(e.key+i);return p().isEqual(a,(0,V.WY)(e.key+i))||t?(0,y.jsx)(D.A,{values:[{label:Fe(e.key),color:t?"cyan":"blue"},{label:i,color:t?"cyan":"blue"}]},e.key):(0,y.jsx)(h.A,{color:t?"cyan":"blue",children:a},e.key)})),(0,y.jsx)(ae.A.Text,{style:{color:ge.colorPrimary},copyable:{text:(0,V.A_)(null===(f=ue.getFieldValue("environments"))||void 0===f?void 0:f.image)||(null===(S=ue.getFieldValue("environments"))||void 0===S?void 0:S.version)}})]})})})]}):(0,y.jsxs)(X.A,{style:{flexFlow:"nowrap",gap:ge.sizeXS},children:[(0,y.jsx)(Z.A,{children:(0,y.jsx)(M.A,{image:(null===(k=ue.getFieldValue("environments"))||void 0===k?void 0:k.version)||(null===(w=ue.getFieldValue("environments"))||void 0===w?void 0:w.manual)})}),(0,y.jsx)(Z.A,{children:(0,y.jsx)(ee.OO,{direction:"row",wrap:"wrap",children:null!==(_=ue.getFieldValue("environments"))&&void 0!==_&&_.manual?(0,y.jsx)(ae.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(I=ue.getFieldValue("environments"))||void 0===I?void 0:I.manual},children:null===(N=ue.getFieldValue("environments"))||void 0===N?void 0:N.manual}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(ae.A.Text,{children:Fe(be(null===(E=ue.getFieldValue("environments"))||void 0===E?void 0:E.version))}),(0,y.jsx)(oe.A,{type:"vertical"}),(0,y.jsx)(ae.A.Text,{children:Ae(null===(O=ue.getFieldValue("environments"))||void 0===O?void 0:O.version)}),(0,y.jsx)(oe.A,{type:"vertical"}),(0,y.jsx)(ae.A.Text,{children:null===(T=ue.getFieldValue("environments"))||void 0===T||null===(K=T.image)||void 0===K?void 0:K.architecture}),(0,y.jsx)(oe.A,{type:"vertical"}),(0,y.jsx)(B.J,{tag:ue.getFieldValue(["environments","image","tag"]),labels:null===(L=ue.getFieldValue("environments"))||void 0===L||null===(z=L.image)||void 0===z?void 0:z.labels}),(0,y.jsx)(ae.A.Text,{style:{color:ge.colorPrimary},copyable:{text:(0,V.A_)(null===(R=ue.getFieldValue("environments"))||void 0===R?void 0:R.image)||(null===(q=ue.getFieldValue("environments"))||void 0===q?void 0:q.version)}})]})})})]})}),(null===(G=ue.getFieldValue("envvars"))||void 0===G?void 0:G.length)>0&&(0,y.jsx)(Y.A.Item,{label:te("session.launcher.EnvironmentVariable"),children:null!==(U=ue.getFieldValue("envvars"))&&void 0!==U&&U.length?(0,y.jsx)(me.A,{style:fe?he.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:p().map(ue.getFieldValue("envvars"),(e=>`${(null===e||void 0===e?void 0:e.variable)||""}="${(null===e||void 0===e?void 0:e.value)||""}"`)).join("\n")}):(0,y.jsx)(ae.A.Text,{type:"secondary",children:"-"})})]})}),(0,y.jsx)(ee.Zu,{title:te("session.launcher.ResourceAllocation"),showDivider:!0,status:p().some(ue.getFieldValue("resource"),((e,n)=>ue.getFieldError(["resource",n]).length>0))||ue.getFieldError(["num_of_sessions"]).length>0||ue.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:te("button.Edit"),onClickExtraButton:()=>{se("environment")},children:(0,y.jsxs)(ee.OO,{direction:"column",align:"stretch",children:[p().some(ue.getFieldValue("resource"),((e,n)=>ue.getFieldWarning(["resource",n]).length>0))&&(0,y.jsx)(re.A,{type:"warning",showIcon:!0,message:te("session.launcher.EnqueueComputeSessionWarning")}),(0,y.jsxs)(Y.A,{column:2,children:[(0,y.jsx)(Y.A.Item,{label:te("general.ResourceGroup"),span:2,children:ue.getFieldValue("resourceGroup")||(0,y.jsx)(ae.A.Text,{type:"secondary",children:te("general.None")})}),(0,y.jsx)(Y.A.Item,{label:te("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,y.jsxs)(ee.OO,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===ue.getFieldValue("allocationPreset")?"":(0,y.jsx)(h.A,{children:ue.getFieldValue("allocationPreset")}),(0,y.jsx)(We,{resource:ue.getFieldValue("resource")})]})}),pe.supports("agent-select")&&!(null!==pe&&void 0!==pe&&null!==(Q=pe._config)&&void 0!==Q&&Q.hideAgents)&&(0,y.jsx)(Y.A.Item,{label:te("session.launcher.AgentNode"),children:ue.getFieldValue("agent")||te("session.launcher.AutoSelect")}),(0,y.jsx)(Y.A.Item,{label:te("session.launcher.NumberOfContainer"),children:1===ue.getFieldValue("cluster_size")?ue.getFieldValue("num_of_sessions"):ue.getFieldValue("cluster_size")}),(0,y.jsx)(Y.A.Item,{label:te("session.launcher.ClusterMode"),children:"single-node"===ue.getFieldValue("cluster_mode")?te("session.launcher.SingleNode"):te("session.launcher.MultiNode")})]}),(0,y.jsx)($.A,{size:"small",type:"inner",title:te("session.launcher.TotalAllocation"),children:(0,y.jsx)(ee.OO,{direction:"row",gap:"xxs",children:(0,y.jsx)(We,{resource:ue.getFieldValue("resource"),containerCount:1===ue.getFieldValue("cluster_size")?ue.getFieldValue("num_of_sessions"):ue.getFieldValue("cluster_size")})})})]})}),(0,y.jsx)(ee.Zu,{title:te("webui.menu.Data&Storage"),showDivider:!0,size:"small",status:ue.getFieldError("mount_id_map").length>0?"error":void 0,extraButtonTitle:te("button.Edit"),onClickExtraButton:()=>{se("storage")},children:(0,y.jsxs)(ee.OO,{direction:"column",align:"stretch",gap:"xs",children:[(null===(H=ue.getFieldValue("mount_ids"))||void 0===H?void 0:H.length)>0?(0,y.jsx)(de.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:te("data.folders.Name")},{dataIndex:"alias",title:te("session.launcher.FolderAlias"),render:(e,n)=>p().isEmpty(e)?(0,y.jsx)(ae.A.Text,{type:"secondary",style:{opacity:.7},children:`/home/work/${n.name}`}):e}],dataSource:p().map(ue.getFieldValue("mount_ids"),(e=>{var n,s;return{name:(null===(n=ue.getFieldValue("vfoldersNameMap"))||void 0===n?void 0:n[e])||e,alias:null===(s=ue.getFieldValue("mount_id_map"))||void 0===s?void 0:s[e]}}))}):(0,y.jsx)(re.A,{type:"warning",showIcon:!0,message:te("session.launcher.NoFolderMounted")}),(null===(J=ue.getFieldValue("autoMountedFolderNames"))||void 0===J?void 0:J.length)>0?(0,y.jsx)(Y.A,{size:"small",children:(0,y.jsx)(Y.A.Item,{label:te("data.AutomountFolders"),children:p().map(ue.getFieldValue("autoMountedFolderNames"),(e=>(0,y.jsx)(h.A,{children:e})))})}):null]})}),(0,y.jsx)(ee.Zu,{title:"Network",showDivider:!0,size:"small",status:ue.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:te("button.Edit"),onClickExtraButton:()=>{se("network")},children:(0,y.jsx)(Y.A,{size:"small",children:(0,y.jsx)(Y.A.Item,{label:te("session.launcher.PreOpenPortTitle"),children:(0,y.jsxs)(ee.OO,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[p().sortBy(ue.getFieldValue("ports"),(e=>parseInt(e))).map(((e,n)=>(0,y.jsx)(b,{value:e,style:{margin:0},children:e},n+e))),p().isArray(ue.getFieldValue("ports"))&&0!==(null===(ne=ue.getFieldValue("ports"))||void 0===ne?void 0:ne.length)?null:(0,y.jsx)(ae.A.Text,{type:"secondary",children:te("general.None")})]})})})})]})};var pe=s(68554);const ve=e=>{let{...n}=e;const{t:s}=(0,x.Bd)(),l=(0,pe.f)();return(0,y.jsx)(c.A.Item,{label:s("session.launcher.SessionName"),name:"sessionName",validateDebounce:200,rules:l,...n,children:(0,y.jsx)(H.A,{allowClear:!0,autoComplete:"off"})})};var xe=s(92526);const ye=()=>{const[e,n]=(0,I.q)("recentSessionHistory"),s=(0,xe.E)((s=>{let{id:l,params:t,createdAt:i,name:a}=s;const o={id:null!==l&&void 0!==l?l:(0,V.kX)(8),params:t,createdAt:null!==i&&void 0!==i?i:(new Date).toISOString(),name:a},r=p().sortBy([o,...e||[]],"-createdAt").slice(0,5);n(r)})),l=(0,xe.E)((()=>n([]))),t=(0,xe.E)((s=>{const l=(e||[]).filter((e=>e.id!==s));n(l)})),i=(0,xe.E)(((s,l)=>{const t=(e||[]).map((e=>e.id===s?{...e,name:l}:e));n(t)}));return[e,{push:s,clear:l,remove:t,update:i}]};var je=s(92491),Ae=s(56761),be=s(17505),Fe=s(2228);const fe=(0,be.rU)((e=>{let{token:n,css:s}=e;return{fixEditableVerticalAlign:s`
    & {
      margin-top: 0px !important;
    }
  `}})),Se=e=>{let{...n}=e;const{t:s}=(0,x.Bd)(),{styles:l}=fe(),[t,{update:i}]=ye(),[a,o]=(0,v.useState)(null),[,{getImageAliasName:r,getBaseVersion:d}]=(0,u.Gj)(),[c,{pin:m,unpin:h,update:g}]=(()=>{const[e,n]=(0,I.q)("pinnedSessionHistory"),[s]=(0,I.q)("recentSessionHistory"),l=(0,xe.E)((l=>{const t=(s||[]).find((e=>e.id===l));t&&n([...e||[],t])})),t=(0,xe.E)((s=>{const l=(e||[]).filter((e=>e.id!==s));n(l)})),i=(0,xe.E)(((s,l)=>{const t=(e||[]).map((e=>e.id===s?{...e,name:l}:e));n(t)}));return[e,{pin:l,unpin:t,update:i}]})(),[,j]=(0,v.useState)(),{token:A}=W.A.useToken(),b=(0,v.useMemo)((()=>{const e=(e,n)=>{const s=new URLSearchParams(e.params);return{...JSON.parse(s.get("formValues")||"{}"),pinned:n,name:e.name}},n=p().map(t,(n=>({...n,...e(n,!1)}))),s=p().map(c,(n=>({...n,...e(n,!0)})));return p().chain([...s,...n]).unionBy("id").value()}),[t,c]);return(0,y.jsx)(ee.Ib,{width:800,title:s("session.launcher.RecentHistory"),footer:null,onCancel:()=>{j(void 0),n.onRequestClose()},...n,children:(0,y.jsxs)(ee.OO,{direction:"column",align:"stretch",gap:"sm",children:[(0,y.jsx)(ae.A.Text,{children:s("session.launcher.YouCanStartWithHistory")}),(0,y.jsx)(ee.zx,{rowSelection:{selectedRowKeys:null===c||void 0===c?void 0:c.map((e=>e.id)),columnWidth:0,hideSelectAll:!0,renderCell:()=>null},scroll:{x:"max-content"},dataSource:b,pagination:!1,onRow:e=>({onMouseEnter:()=>o(e.id),onMouseLeave:()=>o(null)}),rowKey:e=>e.id,columns:[{title:(0,y.jsxs)(ee.OO,{gap:"xxs",children:[(0,y.jsx)(Fe.A,{}),(0,y.jsx)(je.A,{title:s("session.launcher.PinnedHistoryTooltip")})]}),dataIndex:"pinned",width:40,render:(e,n)=>{const s=!!n.pinned,l=a===n.id;return s?(0,y.jsx)(J.Ay,{size:"small",onClick:()=>{h(n.id)},type:"link",children:(0,y.jsx)(Fe.A,{})}):(0,y.jsx)(J.Ay,{size:"small",onClick:()=>m(n.id),type:"link",children:(0,y.jsx)(Fe.A,{style:{color:l?A.colorTextQuaternary:"transparent"}})})}},{title:s("session.launcher.SessionNameShort"),dataIndex:"name",render:(e,s)=>{const t=e||s.id.split("-")[0];return(0,y.jsx)(ae.A.Text,{className:l.fixEditableVerticalAlign,editable:{onChange(e){p().isEmpty(e)||(i(s.id,e),s.pinned&&g(s.id,e))},text:t},children:(0,y.jsx)(ee.rm,{type:"hover",onClick:()=>{var e;null===(e=n.onRequestClose)||void 0===e||e.call(n,JSON.parse(new URLSearchParams(s.params||"").get("formValues")||"{}"))},children:t})})}},{title:s("session.launcher.Environments"),dataIndex:["environments","version"],render:(e,n)=>{const s=n.environments.version||n.environments.manual;return s&&(0,y.jsx)(Ae.A,{title:s,placement:"right",children:(0,y.jsxs)(ee.OO,{gap:"xxs",children:[(0,y.jsx)(M.A,{image:s}),(0,y.jsxs)(ae.A.Text,{children:[r(s)," ",d(s)]})]})})},onCell:()=>({style:{maxWidth:250,textOverflow:"ellipsis"}})},{title:s("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,y.jsx)(ee.OO,{gap:"xs",children:(0,y.jsx)(We,{resource:e})})},{title:s("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>ce()(e).fromNow()}]})]})})};var ke=s(23886),we=s(82860);var _e=s(82317),Ie=s(46936),Ne=s(10342),Ee=s(18540),Oe=s(22617),Te=s(72270),Ve=s(89644),Ce=s(7839),Pe=s(75706),De=s(21603),Me=s(84235),Be=s(92417),Ke=s(61300),Le=s(79015),ze=s(81501),Re=s(83088),qe=s(19022),Ge=s(83203);const Ue="session-launcher:",We=e=>{let{resource:n,containerCount:s=1}=e;return(0,y.jsxs)(y.Fragment,{children:[p().map(p().omit(n,"shmem","accelerator","acceleratorType"),((e,l)=>{var t,i;return"0"===e?null:(0,y.jsx)(w.A,{type:l,value:"mem"===l?((null===(t=(0,V.mv)(e.toString(),""))||void 0===t?void 0:t.number)||0)*s+"":p().toNumber(e)*s+"",opts:{shmem:n.shmem?((null===(i=(0,V.mv)(n.shmem,""))||void 0===i?void 0:i.number)||0)*s:void 0}},l)})),n&&n.accelerator&&n.acceleratorType&&p().isNumber(n.accelerator)?(0,y.jsx)(w.A,{type:n.acceleratorType,value:p().toString(n.accelerator*s)}):null]})},$e=()=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<8;s++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},Qe=()=>{var e,n,s;const l=O.A.useApp(),h=(0,se.useRelayEnvironment)(),g=(0,ze.md)(d.i7),j=(0,u.CX)(),A=j.supports("mount-by-id"),b=(0,z.Am)(),[F,f]=(0,C.zL)(),w=null!==(e=null===j||void 0===j?void 0:j.supports("batch-timeout"))&&void 0!==e&&e,[I,N]=(0,v.useState)(!1),P=(0,v.useMemo)((()=>{var e,n;return{sessionType:"interactive",allocationPreset:"auto-select",hpcOptimization:{autoEnabled:!0},batch:{enabled:!1,command:void 0,scheduleDate:void 0,...w&&{timeoutEnabled:!1,timeout:void 0,timeoutUnit:"s"}},envvars:[],...(null===(e=j._config)||void 0===e?void 0:e.default_session_environment)&&{environments:{environment:null===(n=j._config)||void 0===n?void 0:n.default_session_environment}},..._.jh,resourceGroup:F||void 0}}),[null===(n=j._config)||void 0===n?void 0:n.default_session_environment,F,w]),D=(0,Ge.withDefault)(Ge.NumberParam,0),M=(0,Ge.withDefault)(Ge.JsonParam,P),B=(0,Ge.withDefault)(Ge.JsonParam,{}),[{step:K,formValues:L,redirectTo:R},q]=(0,Ge.useQueryParams)({step:D,formValues:M,redirectTo:Ge.StringParam,appOption:B}),{search:G}=(0,qe.zy)(),U=(0,u.f0)(),Y=(0,C.hd)(),[ne,{toggle:le}]=(0,Ve.A)(),{upsertNotification:ie}=(0,we.js)(),[,{push:oe}]=ye(),{run:re}=(0,Ce.A)((()=>{const e=pe.getFieldsValue();q({formValues:p().assign(p().omit(pe.getFieldsValue(),["environments.image","environments.customizedTag","autoMountedFolderNames","owner","envvars"]),{envvars:(0,o.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),de=e=>{q({step:e},"pushIn")},{token:ue}=W.A.useToken(),{t:me}=(0,x.Bd)(),he=Pe.Ay.useBreakpoint(),[pe]=c.A.useForm();(0,v.useEffect)((()=>{p().isEmpty(L)||pe.validateFields().catch((e=>{}))}),[]);const xe=(0,v.useMemo)((()=>p().merge({},P,L)),[P,L]);(0,v.useEffect)((()=>{var e;null===(e=g.current)||void 0===e||e.scrollTo(0,0)}),[K]);const je=c.A.useWatch("sessionType",{form:pe,preserve:!0})||pe.getFieldValue("sessionType")||L.sessionType,be=(0,ee.YM)([{title:me("session.launcher.SessionType"),key:"sessionType"},{title:`${me("session.launcher.Environments")} & ${me("session.launcher.ResourceAllocation")} `,key:"environment"},"inference"!==je&&{title:me("webui.menu.Data&Storage"),key:"storage"},{title:me("session.launcher.Network"),key:"network"},{title:me("session.launcher.ConfirmAndLaunch"),icon:(0,y.jsx)(_e.A,{}),key:"review"}]),Fe=null===(s=be[K])||void 0===s?void 0:s.key,fe=p().some(pe.getFieldsError(),(e=>e.errors.length>0)),[We,Qe]=(0,u.Tw)("first");(0,v.useEffect)((()=>{K===be.length-1&&pe.validateFields().catch((e=>{})).finally((()=>Qe()))}),[K,pe,Qe,be.length]),(0,v.useEffect)((()=>{"first"!==We&&Je(!!fe)}),[We,fe]);const[He,Je]=(0,v.useState)(!1),[Xe,Ze]=(0,v.useState)(!1);return(0,v.useLayoutEffect)((()=>{Xe&&(pe.resetFields(),Ze(!1))}),[Xe,pe]),(0,y.jsxs)(ee.OO,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,y.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,y.jsxs)(ee.OO,{direction:"row",gap:"md",align:"start",children:[(0,y.jsxs)(ee.OO,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,y.jsxs)(ee.OO,{direction:"row",justify:"between",children:[(0,y.jsx)(ae.A.Title,{level:4,style:{marginTop:0},children:me("session.launcher.StartNewSession")}),(0,y.jsx)(ee.OO,{direction:"row",gap:"sm",children:(0,y.jsx)(J.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>le(),children:me("session.launcher.RecentHistory")})})]}),(0,y.jsx)(c.A.Provider,{onFormChange:(e,n)=>{re()},children:(0,y.jsxs)(c.A,{form:pe,layout:"vertical",initialValues:xe,children:[(0,y.jsx)(T,{form:pe}),(0,y.jsxs)(ee.OO,{direction:"column",align:"stretch",gap:"md",children:[(0,y.jsxs)($.A,{title:me("session.launcher.SessionType"),style:{display:"sessionType"===Fe?"block":"none"},children:[(0,y.jsx)(c.A.Item,{name:"sessionType",children:(0,y.jsx)(De.Ay.Group,{options:[{label:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(ae.A.Text,{code:!0,children:me("session.launcher.InteractiveMode")})," ",(0,y.jsx)(ae.A.Text,{type:"secondary",children:me("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(ae.A.Text,{code:!0,children:me("session.launcher.BatchMode")})," ",(0,y.jsx)(ae.A.Text,{type:"secondary",children:me("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,y.jsx)(ve,{}),(0,y.jsx)(c.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,y.jsx)(H.A,{})})]}),"batch"===je&&(0,y.jsxs)($.A,{title:me("session.launcher.BatchModeConfig"),style:{display:"sessionType"===Fe?"block":"none"},children:[(0,y.jsx)(c.A.Item,{label:me("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,y.jsx)(H.A.TextArea,{autoSize:!0})}),(0,y.jsx)(c.A.Item,{noStyle:!0,dependencies:[["batch","scheduleDate"]],children:()=>{const e=pe.getFieldValue(["batch","scheduleDate"]);return(0,y.jsx)(i.A,{delay:1e3,callback:()=>{const e=pe.getFieldValue(["batch","scheduleDate"]);return e?ce()(e).isBefore(ce()())?void(0===pe.getFieldError(["batch","scheduleDate"]).length&&pe.validateFields([["batch","scheduleDate"]])):ce()(e).fromNow():void 0},triggerKey:e||"none",render:e=>(0,y.jsx)(c.A.Item,{label:me("session.launcher.SessionStartTime"),extra:e,children:(0,y.jsxs)(ee.OO,{direction:"row",gap:"xs",children:[(0,y.jsx)(c.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,y.jsx)(Me.A,{onChange:e=>{e.target.checked&&p().isEmpty(pe.getFieldValue(["batch","scheduleDate"]))?pe.setFieldValue(["batch","scheduleDate"],ce()().add(2,"minutes").toISOString()):!1===e.target.checked&&pe.setFieldValue(["batch","scheduleDate"],void 0),pe.validateFields([["batch","scheduleDate"]])},children:me("session.launcher.Enable")})}),(0,y.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,l;return(null===(s=e.batch)||void 0===s?void 0:s.enabled)!==(null===(l=n.batch)||void 0===l?void 0:l.enabled)},children:()=>{var e;const n=!0!==(null===(e=pe.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(c.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&ce()(n).isBefore(ce()())?Promise.reject(me("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,y.jsx)(a.A,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(ce()().startOf("day"))})})})}})]})})})}}),w?(0,y.jsx)(c.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"],["batch","timeoutUnit"]],children:()=>{const e=pe.getFieldValue(["batch","timeout"]),n=pe.getFieldValue(["batch","timeoutUnit"]),s=ce().duration(e,null!==n&&void 0!==n?n:"s"),l=(0,V.a3)(s,me),t=!p().isNull(e)&&p().toFinite(e)>0?l:null;return(0,y.jsx)(c.A.Item,{label:me("session.launcher.BatchJobTimeoutDuration"),tooltip:me("session.launcher.BatchJobTimeoutDurationDesc"),help:t,children:(0,y.jsxs)(ee.OO,{direction:"row",gap:"xs",children:[(0,y.jsx)(c.A.Item,{noStyle:!0,name:["batch","timeoutEnabled"],valuePropName:"checked",children:(0,y.jsx)(Me.A,{onChange:e=>{!1===e.target.checked&&pe.setFieldValue(["batch","timeout"],void 0),pe.validateFields([["batch","timeout"]])},children:me("session.launcher.Enable")})}),(0,y.jsx)(c.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"]],children:()=>{const e=!0!==pe.getFieldValue(["batch","timeoutEnabled"]);return(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(c.A.Item,{name:["batch","timeout"],label:me("session.launcher.BatchJobTimeoutDuration"),noStyle:!0,rules:[{min:0,type:"number",message:me("error.AllowsPositiveNumberOnly")},{required:!e}],children:(0,y.jsx)(Be.A,{disabled:e,min:1,addonAfter:(0,y.jsx)(c.A.Item,{noStyle:!0,name:["batch","timeoutUnit"],children:(0,y.jsx)(m.A,{tabIndex:-1,style:{minWidth:75},options:[{label:me("time.Sec"),value:"s"},{label:me("time.Min"),value:"m"},{label:me("time.Hour"),value:"h"},{label:me("time.Day"),value:"d"},{label:me("time.Week"),value:"w"}]})})})})})}})]})})}}):null]}),("admin"===b||"superadmin"===b)&&(0,y.jsx)(te,{style:{display:"sessionType"===Fe?"block":"none"}}),"inference"===je&&(0,y.jsx)($.A,{title:"Inference Mode Configuration",children:(0,y.jsx)(c.A.Item,{name:["inference","vFolderName"],label:me("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,y.jsx)(m.A,{})})}),(0,y.jsxs)($.A,{title:me("session.launcher.Environments"),style:{display:"environment"===Fe?"block":"none"},children:[(0,y.jsx)(Re.tH,{fallbackRender:e=>(console.log(e),null),children:(0,y.jsx)(r.A,{})}),(0,y.jsx)(c.A.Item,{label:me("session.launcher.EnvironmentVariable"),children:(0,y.jsx)(o.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,y.jsx)($.A,{title:me("session.launcher.ResourceAllocation"),style:{display:"environment"===Fe?"block":"none"},children:(0,y.jsx)(_.Ay,{enableAgentSelect:!j._config.hideAgents&&j.supports("agent-select"),enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,y.jsxs)($.A,{title:me("session.launcher.HPCOptimization"),style:{display:"environment"===Fe?"block":"none"},children:[(0,y.jsx)(c.A.Item,{noStyle:!0,children:(0,y.jsxs)(ee.OO,{direction:"row",gap:"sm",children:[(0,y.jsx)(ae.A.Text,{children:me("session.launcher.SwitchOpenMPoptimization")}),(0,y.jsx)(c.A.Item,{label:me("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,y.jsx)(Q.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e?pe.setFieldsValue({hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:void 0,OPENBLAS_NUM_THREADS:void 0}}):pe.setFieldsValue({hpcOptimization:{autoEnabled:!1,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"}})}})})]})}),(0,y.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,l;return(null===(s=e.hpcOptimization)||void 0===s?void 0:s.autoEnabled)!==(null===(l=n.hpcOptimization)||void 0===l?void 0:l.autoEnabled)},children:()=>{const e=pe.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,y.jsxs)(X.A,{gutter:ue.marginMD,style:{display:e?"none":void 0,marginTop:ue.marginMD},children:[(0,y.jsx)(Z.A,{xs:24,sm:12,children:(0,y.jsx)(c.A.Item,{style:{flex:1},label:me("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,y.jsxs)(y.Fragment,{children:[me("session.launcher.OpenMPOptimization"),(0,y.jsx)(x.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,y.jsx)(Be.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,y.jsx)(Z.A,{xs:24,sm:12,children:(0,y.jsx)(c.A.Item,{style:{flex:1},label:me("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,y.jsxs)(y.Fragment,{children:[me("session.launcher.OpenMPOptimization"),(0,y.jsx)(x.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,y.jsx)(Be.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,y.jsx)($.A,{title:me("webui.menu.Data&Storage"),style:{display:"storage"===Fe?"block":"none"},children:(0,y.jsx)(c.A.Item,{noStyle:!0,dependencies:["owner"],children:e=>{let{getFieldValue:n}=e;const s=n("owner"),l=(null===s||void 0===s?void 0:s.enabled)&&p().every(p().omit(s,"enabled"),((e,n)=>void 0!==e));return(0,y.jsx)(ke.A,{rowKey:A?"id":"name",rowFilter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))},tableProps:{ownerEmail:l?null===s||void 0===s?void 0:s.email:void 0}})}})}),(0,y.jsx)($.A,{title:me("session.launcher.Network"),style:{display:"network"===Fe?"block":"none"},children:(0,y.jsx)(k,{})}),"review"===Fe&&(0,y.jsx)(ge,{onClickEditStep:e=>{const n=p().findIndex(be,{key:e});de(n)}}),(0,y.jsxs)(ee.OO,{direction:"row",justify:"between",children:[(0,y.jsx)(ee.OO,{gap:"sm",children:(0,y.jsx)(Ke.A,{title:me("button.Reset"),description:me("session.launcher.ResetFormConfirm"),onConfirm:()=>{q({},"replace"),Ze(!0)},icon:(0,y.jsx)(Ie.A,{style:{color:ue.colorError}}),okText:me("button.Reset"),okButtonProps:{danger:!0},children:(0,y.jsx)(J.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:me("button.Reset")})})}),(0,y.jsxs)(ee.OO,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[K>0&&(0,y.jsx)(J.Ay,{onClick:()=>{de(K-1)},icon:(0,y.jsx)(Ne.A,{}),disabled:I,children:me("button.Previous")}),K===be.length-1?(0,y.jsx)(Ae.A,{title:fe?me("session.launcher.PleaseCompleteForm"):void 0,children:(0,y.jsx)(J.Ay,{type:"primary",icon:(0,y.jsx)(Ee.A,{}),disabled:fe,onClick:()=>{N(!0);const e=G;pe.validateFields().then((async n=>{var s,i,a,o,r,d,u,c,m;if(p().isEmpty(n.mount_ids)||0===(null===(s=n.mount_ids)||void 0===s?void 0:s.length)){if(!await new Promise((e=>{l.modal.confirm({title:me("session.launcher.NoFolderMounted"),content:(0,y.jsxs)(y.Fragment,{children:[me("session.launcher.HomeDirectoryDeletionDialog"),(0,y.jsx)("br",{}),(0,y.jsx)("br",{}),me("session.launcher.LaunchConfirmationDialog"),(0,y.jsx)("br",{}),(0,y.jsx)("br",{}),me("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:me("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const g=n.environments.manual||n.environments.version;let[v,x]=g?g.split("@"):["",""];const b=p().isEmpty(n.sessionName)?$e():n.sessionName,F={sessionName:b,kernelName:v,architecture:x,resources:{enqueueOnly:!0,group_name:null!==(i=n.owner)&&void 0!==i&&i.enabled?n.owner.project:Y.name,domain:null!==(a=n.owner)&&void 0!==a&&a.enabled?n.owner.domainName:j._config.domainName,type:n.sessionType,cluster_mode:n.cluster_mode,cluster_size:n.cluster_size,maxWaitSeconds:15,...null!==(o=n.owner)&&void 0!==o&&o.enabled?{owner_access_key:n.owner.accesskey}:{},..."batch"===n.sessionType?{starts_at:n.batch.enabled?n.batch.scheduleDate:void 0,startupCommand:n.batch.command}:{},...n.bootstrap_script?{bootstrap_script:n.bootstrap_script}:{},...w&&null!==n&&void 0!==n&&null!==(r=n.batch)&&void 0!==r&&r.timeoutEnabled&&!p().isUndefined(null===n||void 0===n||null===(d=n.batch)||void 0===d?void 0:d.timeout)?{batchTimeout:p().toString(n.batch.timeout)+(null===n||void 0===n||null===(u=n.batch)||void 0===u?void 0:u.timeoutUnit)}:void 0,config:{resources:{cpu:n.resource.cpu,mem:n.resource.mem,...n.resource.accelerator>0?{[n.resource.acceleratorType]:n.resource.accelerator}:void 0},scaling_group:null!==(c=n.owner)&&void 0!==c&&c.enabled?n.owner.project:n.resourceGroup,resource_opts:{shmem:n.resource.shmem},[A?"mount_ids":"mounts"]:n.mount_ids,[A?"mount_id_map":"mount_map"]:n.mount_id_map,environ:{...p().fromPairs(n.envvars.map((e=>[e.variable,e.value]))),...n.hpcOptimization.autoEnabled?{}:p().omit(n.hpcOptimization,"autoEnabled")},preopen_ports:S(n.ports),...!j.supports("agent-select")||null!==j&&void 0!==j&&null!==(m=j._config)&&void 0!==m&&m.hideAgents||"auto"===n.agent?void 0:{agent_list:[n.agent].filter((e=>!!e))}}}},k=p().map(p().range(n.num_of_sessions||1),(e=>{const s=(n.num_of_sessions||1)>1?`${F.sessionName}-${(0,V.kX)()}-${e}`:F.sessionName;return j.createIfNotExists(F.kernelName,s,F.resources,void 0,F.architecture).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(me("session.launcher.SessionAlreadyExists"));if("CANCELLED"===(null===e||void 0===e?void 0:e.status))throw new Error(me("session.launcher.FailedToStartNewSession"));return e})).catch((e=>{var n;throw null!==e&&void 0!==e&&null!==(n=e.message)&&void 0!==n&&n.includes("The session already exists")?new Error(me("session.launcher.SessionAlreadyExists")):e}))}));f(n.resourceGroup),oe({params:e,name:b}),await Promise.allSettled(k).then((async e=>{p().every(e,{status:"rejected"})||(U(R||"/job"),p().map(e,(async e=>{if("fulfilled"===e.status){var n;const s=e.value,l=await(0,se.fetchQuery)(h,t,{id:(0,ee.wc)("ComputeSessionNode",s.sessionId)}).toPromise().catch((()=>null)),i=null!==(n=null===l||void 0===l?void 0:l.compute_session_node)&&void 0!==n?n:null;i&&ie({key:`${Ue}${s.sessionId}`,node:i,open:!0,duration:0})}})))})).catch((()=>{}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{N(!1)}))},loading:I,children:me("session.launcher.Launch")})}):(0,y.jsxs)(J.Ay,{type:"primary",ghost:!0,onClick:()=>{de(K+1)},children:[me("button.Next")," ",(0,y.jsx)(Oe.A,{})]}),K!==be.length-1&&(0,y.jsxs)(J.Ay,{onClick:()=>{de(be.length-1)},children:[me("session.launcher.SkipToConfirmAndLaunch"),(0,y.jsx)(Te.A,{})]})]})]})]})]})})]}),he.lg&&(0,y.jsx)(ee.OO,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,y.jsx)(Le.A,{size:"small",direction:"vertical",current:K,onChange:e=>{de(e)},items:p().map(be,((e,n)=>({...e,status:n===K?"process":"wait"})))})})]}),(0,y.jsx)(Se,{onRequestClose:e=>{if(e){const n=p().merge({sessionName:"",ports:[],vfoldersNameMap:{},mount_ids:[],mount_id_map:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0},agent:"auto"},e);p().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,V.kX)(4)),pe.setFieldsValue(n),de(be.length-1),pe.validateFields().catch((()=>{}))}le()},open:ne}),K===be.length-1?(0,y.jsx)(Re.tH,{fallback:null,children:(0,y.jsx)(E,{open:He,onClose:()=>{Je(!1)},scrollIntoViewOptions:!0})}):void 0]})}}}]);
//# sourceMappingURL=8508.dcaae2a7.chunk.js.map