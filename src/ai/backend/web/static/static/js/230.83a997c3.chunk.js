"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[230],{38540:function(e,n,t){t.r(n),t.d(n,{passwordPattern:function(){return h}});var a=t(29439),r=t(43255),o=t(87760),s=t(50164),i=t(61502),u=t(99277),l=t(69080),d=t(44036),c=t(57054),m=t(65113),f=t(28499),p=t(38818),w=t(92171),g=t(4519),v=t(81748),P=t(2556),h=/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/;n.default=function(){var e,n=(0,i.useWebComponentInfo)(),t=n.value,_=n.dispatchEvent;try{e=JSON.parse(t||"")}catch(N){e={open:!1,currentPassword:"",username:"",api_endpoint:""}}var y=e,Z=y.open,b=y.currentPassword,k=y.username,j=y.api_endpoint,F=d.Z.useToken().token,S=c.Z.useForm(),x=(0,a.Z)(S,1)[0],C=(0,v.$G)().t;(0,g.useEffect)((function(){Z&&x.resetFields()}),[Z,x]);var T=(0,o.M)({api_endpoint:j}),M=(0,s.Y)({mutationFn:function(e){return(0,r.Lc)({method:"POST",url:"/server/update-password-no-auth",body:e,client:T})}}),E=function(){x.validateFields().then((function(e){M.mutate({username:k,current_password:b,new_password:e.newPassword},{onSuccess:function(e,n,t){_("ok",null)},onError:function(e,n,t){}})}))};return(0,P.jsx)(m.Z,{open:Z,centered:!0,mask:!1,onCancel:function(){_("cancel",null)},keyboard:!1,maskClosable:!1,footer:null,width:450,destroyOnClose:!0,forceRender:!0,children:(0,P.jsxs)(u.Z,{direction:"column",justify:"start",align:"stretch",gap:"md",style:{alignSelf:"stretch",paddingTop:F.paddingMD,paddingBottom:F.paddingMD},children:[(0,P.jsxs)(f.Z.Title,{level:3,style:{margin:0},children:[(0,P.jsx)(l.Z,{twoToneColor:F.colorWarning})," ",C("webui.menu.PleaseChangeYourPassword")]}),C("webui.menu.YouMushChangeYourPassword"),(0,P.jsxs)(c.Z,{form:x,layout:"vertical",initialValues:{currentPassword:b},disabled:M.isLoading,children:[(0,P.jsx)(c.Z.Item,{name:"newPassword",label:C("webui.menu.NewPassword"),rules:[{required:!0},{pattern:h,message:C("webui.menu.InvalidPasswordMessage").toString()},function(){return{validator:function(e,n){return b===n?Promise.reject(new Error(C("webui.menu.NewPasswordCannotBeSame").toString())):Promise.resolve()}}}],hasFeedback:!0,children:(0,P.jsx)(p.Z.Password,{})}),(0,P.jsx)(c.Z.Item,{name:"confirm",label:C("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0},function(e){var n=e.getFieldValue;return{validator:function(e,t){return t&&n("newPassword")!==t?Promise.reject(new Error(C("environment.PasswordsDoNotMatch").toString())):Promise.resolve()}}}],children:(0,P.jsx)(p.Z.Password,{onPressEnter:E})})]}),(0,P.jsx)(w.ZP,{type:"primary",onClick:E,loading:M.isLoading,children:C("webui.menu.Update")})]})})}},51230:function(e,n,t){t.r(n),t.d(n,{default:function(){return x}});var a,r=t(1413),o=t(29439),s=t(44925),i=t(87760),u=t(1839),l=t(50164),d=t(77758),c=t(38540),m=t(14749),f=t(88724),p=t(63703),w=t(57054),g=t(88464),v=t(65113),P=t(38818),h=t(19427),_=t(62708),y=t(32048),Z=t.n(y),b=t(4519),k=t(81748),j=t(16980),F=t(2556),S=["onRequestClose"],x=function(e){var n=e.onRequestClose,y=(0,s.Z)(e,S),x=(0,k.$G)().t,C=w.Z.useForm(),T=(0,o.Z)(C,1)[0],M=g.ZP.useMessage(),E=(0,o.Z)(M,2),N=E[0],O=E[1],I=v.Z.useModal(),L=(0,o.Z)(I,2),V=L[0],A=L[1],z=(0,p.Z)(!1),K=(0,o.Z)(z,2),U=K[0],q=K[1].toggle,D=(0,i.Dj)(),$=(0,l.h)("isManagerSupportingTOTP",(function(){return D.isManagerSupportingTOTP()}),{suspense:!0}).data,R=D.supports("2FA")&&$,Y=(0,u.jC)(),Q=(0,o.Z)(Y,2),B=Q[0],W=Q[1],G=(0,i.Kr)("initial-fetch"),H=(0,o.Z)(G,2),J=H[0],X=H[1],ee=(0,b.useDeferredValue)(J),ne=(0,j.useLazyLoadQuery)(void 0!==a?a:a=t(57555),{email:B.email,isNotSupportTotp:!R},{fetchPolicy:"network-only",fetchKey:ee}).user,te=(0,l.h)("baiClient.keypair.list",(function(){return D.keypair.list(B.email,["access_key","secret_key"],!0).then((function(e){return e.keypairs}))}),{suspense:!0}).data,ae=(0,l.Y)({mutationFn:function(){return D.remove_totp()}});return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("style",{children:".disabled_style_readonly,\n.disabled_style_readonly input {\n  background-color: #f5f5f5;\n}\n"}),(0,F.jsxs)(d.Z,(0,r.Z)((0,r.Z)({},y),{},{okText:x("webui.menu.Update"),cancelText:x("webui.menu.Cancel"),onCancel:function(){n()},confirmLoading:B.isPendingMutation,onOk:function(){T.validateFields().then((function(e){W.updateFullName(e.full_name,{onSuccess:function(t){t!==B.full_name&&N.open({type:"success",content:x("webui.menu.FullnameUpdated")}),e.newPassword&&e.newPasswordConfirm&&e.originalPassword?W.updatePassword({new_password:e.newPassword,new_password2:e.newPasswordConfirm,old_password:e.originalPassword},{onSuccess:function(){N.open({type:"success",content:x("webui.menu.PasswordUpdated")}),n(!0)},onError:function(e){N.open({type:"error",content:e.message})}}):n(!0)},onError:function(e){N.open({type:"error",content:e.message})}})}))},centered:!0,destroyOnClose:!0,title:x("webui.menu.MyAccountInformation"),children:[(0,F.jsxs)(w.Z,{layout:"horizontal",labelCol:{span:8},form:T,initialValues:{full_name:B.full_name,totp_activated:(null===ne||void 0===ne?void 0:ne.totp_activated)||!1,access_key:null===te||void 0===te?void 0:te[0].access_key},preserve:!1,children:[(0,F.jsx)(w.Z.Item,{name:"full_name",label:x("webui.menu.FullName"),rules:[function(){return{validator:function(e,n){return n&&n.length<65?Promise.resolve():Promise.reject(new Error(x("webui.menu.FullNameInvalid")))}}}],children:(0,F.jsx)(P.Z,{})}),(0,F.jsx)(w.Z.Item,{name:"access_key",label:x("general.AccessKey"),children:(0,F.jsx)(h.Z,{options:Z().map(te,(function(e){return{value:e.access_key}}))})}),(0,F.jsx)(w.Z.Item,{label:x("general.SecretKey"),shouldUpdate:function(e,n){return e.access_key!==n.access_key},children:function(e){var n,t=e.getFieldValue;return(0,F.jsx)(P.Z.Password,{value:null===(n=Z().find(te,["access_key",t("access_key")]))||void 0===n?void 0:n.secret_key,className:"disabled_style_readonly",readOnly:!0})}}),(0,F.jsx)(w.Z.Item,{name:"originalPassword",label:x("webui.menu.OriginalPassword"),rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return t||!n("newPassword")&&!n("newPasswordConfirm")?Promise.resolve():Promise.reject(new Error(x("webui.menu.InputOriginalPassword")))}}}],dependencies:["newPassword","newPasswordConfirm"],children:(0,F.jsx)(P.Z.Password,{})}),(0,F.jsx)(w.Z.Item,{name:"newPassword",label:x("webui.menu.NewPassword"),rules:[{pattern:c.passwordPattern,message:x("webui.menu.InvalidPasswordMessage")}],children:(0,F.jsx)(P.Z.Password,{})}),(0,F.jsx)(w.Z.Item,{name:"newPasswordConfirm",label:x("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return t&&n("newPassword")!==t?Promise.reject(new Error(x("webui.menu.NewPasswordMismatch"))):Promise.resolve()}}}],children:(0,F.jsx)(P.Z.Password,{})}),!!R&&(0,F.jsx)(w.Z.Item,{name:"totp_activated",label:x("webui.menu.TotpActivated"),valuePropName:"checked",children:(0,F.jsx)(_.Z,{onChange:function(e){e?q():null!==ne&&void 0!==ne&&ne.totp_activated&&(T.setFieldValue("totp_activated",!0),V.confirm({title:x("totp.TurnOffTotp"),icon:(0,F.jsx)(f.Z,{}),content:x("totp.ConfirmTotpRemovalBody"),okText:x("button.Yes"),okType:"danger",cancelText:x("button.No"),onOk:function(){ae.mutate(void 0,{onSuccess:function(){g.ZP.success(x("totp.RemoveTotpSetupCompleted")),X(),T.setFieldValue("totp_activated",!1)},onError:function(e){g.ZP.error(e.message)}})},onCancel:function(){T.setFieldValue("totp_activated",!0)}}))}})})]}),!!R&&(0,F.jsx)(m.Z,{userFrgmt:ne,open:U,onRequestClose:function(e){e?X():T.setFieldValue("totp_activated",!1),q()}})]})),O,A]})}},57555:function(e,n,t){t.r(n);var a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"}],n=[{kind:"Variable",name:"email",variableName:"email"}],t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserProfileSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,a,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserProfileSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,a,{alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null}],storageKey:null}]},params:{cacheID:"b0c9773ff4a3e759f0f9822463daa757",id:null,metadata:{},name:"UserProfileSettingModalQuery",operationKind:"query",text:"query UserProfileSettingModalQuery(\n  $email: String!\n  $isNotSupportTotp: Boolean!\n) {\n  user(email: $email) {\n    id\n    totp_activated @skipOnClient(if: $isNotSupportTotp)\n    ...TOTPActivateModalFragment\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();a.hash="c87e74dfaa01d51a1697e67df81e101b",n.default=a},1839:function(e,n,t){t.d(n,{T6:function(){return c},jC:function(){return m}});var a=t(1413),r=t(29439),o=t(87760),s=t(43255),i=t(50164),u=t(32048),l=t.n(u),d=t(4519),c=function(){var e=(0,o.Kr)("first"),n=(0,r.Z)(e,2),t=n[0],a=n[1],s=(0,o.Dj)();return[(0,i.h)({queryKey:["useResourceSlots",t],queryFn:function(){return s.get_resource_slots()},staleTime:0}).data,{refresh:function(){return a()}}]},m=function(){var e=(0,o.Dj)(),n=(0,d.useState)({full_name:e.full_name,email:e.email}),t=(0,r.Z)(n,2),u=t[0],c=t[1];(0,d.useEffect)((function(){var n=function(n){if(e.supports("change-user-name")){var t=n.detail;c((function(e){return(0,a.Z)((0,a.Z)({},e),{},{full_name:t})}))}};return document.addEventListener("current-user-info-changed",n),function(){document.removeEventListener("current-user-info-changed",n)}}),[e]);var m=(0,i.Y)({mutationFn:function(n){return e.update_full_name(n.email,n.full_name)}}),f=(0,i.Y)({mutationFn:function(n){return e.update_password(n.old_password,n.new_password,n.new_password2)}});return[(0,a.Z)((0,a.Z)({},u),{},{username:function(){var n=l().trim(u.full_name).length>0?u.full_name:u.email;if(e._config.maskUserInfo){var t=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(n)?n.split("@")[0].length-2:n.length-2;n=(0,s.Cd)(n,"*",2,t)}return n}(),isPendingMutation:m.isLoading||f.isLoading}),{updateFullName:function(n,t){m.mutate({full_name:n,email:e.email},{onSuccess:function(){(null===t||void 0===t?void 0:t.onSuccess)&&t.onSuccess(n),document.dispatchEvent(new CustomEvent("current-user-info-changed",{detail:n})),c((function(e){return(0,a.Z)((0,a.Z)({},e),{},{full_name:n})}))},onError:function(e){(null===t||void 0===t?void 0:t.onError)&&t.onError(e)}})},updatePassword:function(e,n){f.mutate(e,{onSuccess:function(){(null===n||void 0===n?void 0:n.onSuccess)&&n.onSuccess(void 0)},onError:function(e){(null===n||void 0===n?void 0:n.onError)&&n.onError(e)}})}}]}},69080:function(e,n,t){t.d(n,{Z:function(){return u}});var a=t(87462),r=t(4519),o={icon:function(e,n){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z",fill:e}},{tag:"path",attrs:{d:"M172.2 828.1h679.6L512 239.9 172.2 828.1zM560 720a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm-16-304v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8z",fill:n}},{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z",fill:e}}]}},name:"warning",theme:"twotone"},s=t(9491),i=function(e,n){return r.createElement(s.Z,(0,a.Z)({},e,{ref:n,icon:o}))};var u=r.forwardRef(i)}}]);
//# sourceMappingURL=230.83a997c3.chunk.js.map