"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[1329,7569],{27569:(e,l,a)=>{a.r(l),a.d(l,{default:()=>w,useFileUploadManager:()=>j});const n=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"vfolderGlobalId"}],l=[{kind:"Variable",name:"id",variableName:"vfolderGlobalId"}],a={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"FileUploadManagerQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[{kind:"RequiredField",field:a,action:"THROW"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"FileUploadManagerQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"da162cec4ce77cdb6fcdd31a87d2f135",id:null,metadata:{},name:"FileUploadManagerQuery",operationKind:"query",text:"query FileUploadManagerQuery(\n  $vfolderGlobalId: String!\n) {\n  vfolder_node(id: $vfolderGlobalId) {\n    name\n    id\n  }\n}\n"}}}();n.hash="1f3a6bd97dae542b3c85605ab9a61d03";const r=n;var i=a(1394),o=a(30167),s=a(28299),d=a(68144),t=a(28599),u=a(91313),c=a(85395),m=a(23403),g=a(66033),p=a(8348),y=a.n(p),F=a(35543),f=a(84100),v=a(81291),k=a(85724),h=a(19885),S=a(2212),x=a(29951),_=a(7960);const b=(0,c.eU)([]),K=(0,c.eU)({}),N=(0,g.Iz)((e=>(0,c.eU)((l=>l(K)[e]),((l,a,n)=>{const r=l(K);a(K,{...r,[e]:n})})))),w=()=>{const{t:e}=(0,v.Bd)(),{token:l}=d.A.useToken(),a=(0,h.CX)(),{upsertNotification:n,destroyNotification:r}=(0,o.js)(),{generateFolderPath:i}=(0,s.useFolderExplorerOpener)(),[c,g]=(0,m.fp)(b),[p,k]=(0,m.fp)(K),[x]=(0,S.q)("max_concurrent_uploads"),N=new F.A({concurrency:x||2}),w=(0,f.useRef)({}),j=y().throttle(((a,r)=>{const i=w.current[a]||0;w.current[a]=0,k((o=>{var s,d,c,m,g,p,y,F,f,v;const k=(null===(s=o[a])||void 0===s||null===(d=s.completedFiles)||void 0===d?void 0:d.length)||0,h=((null===(c=o[a])||void 0===c||null===(m=c.completedFiles)||void 0===m?void 0:m.length)||0)+((null===(g=o[a])||void 0===g||null===(p=g.failedFiles)||void 0===p?void 0:p.length)||0)+((null===(y=o[a])||void 0===y||null===(F=y.pendingFiles)||void 0===F?void 0:F.length)||0),S=(null===(f=o[a])||void 0===f?void 0:f.totalExpectedSize)||0,x=((null===(v=o[a])||void 0===v?void 0:v.completedBytes)||0)+i;return n({key:"upload:"+a,backgroundTask:{status:"pending",percent:S>0?x/S*100:0,onChange:{pending:{description:(0,_.jsxs)(u.OO,{direction:"column",align:"start",children:[(0,_.jsxs)(t.A.Text,{children:[e("explorer.UploadingFiles")," ( ",k," /"," ",h," )"]}),(0,_.jsx)(t.A.Text,{ellipsis:!0,type:"secondary",style:{fontSize:l.fontSizeSM,maxWidth:"300px"},children:r})]})}}}}),{...o,[a]:{...o[a],completedBytes:x}}}))}),200,{leading:!0,trailing:!0});return(0,f.useEffect)((()=>{0!==c.length&&a&&(c.forEach((l=>{const{vFolderId:a,vFolderName:o,uploadFileInfo:s}=l,d=y().sumBy(s,(e=>e.file.size));k((l=>{var t,c,m,g,p,y;const F=!l[a],f=((null===(t=l[a])||void 0===t?void 0:t.totalExpectedSize)||0)+d,v=F?0:((null===(c=l[a])||void 0===c?void 0:c.completedBytes)||0)/f*100;return n({key:"upload:"+a,open:!0,message:(0,_.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,_.jsx)(u.rm,{style:{fontWeight:"normal"},to:i(a),onClick:()=>{r("upload:"+a)},children:`${o}`})]}),backgroundTask:{status:"pending",percent:v,onChange:{pending:e("explorer.ProcessingUpload")}},duration:0}),{...l,[a]:{vFolderName:o,pendingFiles:[...(null===(m=l[a])||void 0===m?void 0:m.pendingFiles)||[],...s.map((e=>e.file.webkitRelativePath||e.file.name))],completedFiles:(null===(g=l[a])||void 0===g?void 0:g.completedFiles)||[],failedFiles:(null===(p=l[a])||void 0===p?void 0:p.failedFiles)||[],completedBytes:(null===(y=l[a])||void 0===y?void 0:y.completedBytes)||0,totalExpectedSize:f}}})),s.forEach((e=>{let{file:l,startFunction:n}=e;N.add((async()=>{const e=l.webkitRelativePath||l.name;let r=0;try{await n({onProgress:(e,l,n)=>{const i=e-r;r=e,w.current[a]=(w.current[a]||0)+i,j(a,n)}}),j.flush(),delete w.current[a],k((l=>{var n;return{...l,[a]:{...l[a],pendingFiles:l[a].pendingFiles.filter((l=>l!==e)),completedFiles:[...(null===(n=l[a])||void 0===n?void 0:n.completedFiles)||[],e]}}}))}catch(i){j.flush(),delete w.current[a],k((l=>{var n;return{...l,[a]:{...l[a],pendingFiles:l[a].pendingFiles.filter((l=>l!==e)),failedFiles:[...(null===(n=l[a])||void 0===n?void 0:n.failedFiles)||[],e]}}}))}}))}))})),g([]))}),[c]),(0,f.useEffect)((()=>{Object.entries(p).forEach((l=>{let[a,o]=l;y().isEmpty(null===o||void 0===o?void 0:o.pendingFiles)&&(y().isEmpty(null===o||void 0===o?void 0:o.failedFiles)?y().isEmpty(null===o||void 0===o?void 0:o.completedFiles)||(n({key:"upload:"+a,open:!0,message:(0,_.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,_.jsx)(u.rm,{style:{fontWeight:"normal"},to:i(a),onClick:()=>{r("upload:"+a)},children:`${null===o||void 0===o?void 0:o.vFolderName}`})]}),backgroundTask:{status:"resolved",percent:100,onChange:{resolved:e("explorer.SuccessfullyUploadedToFolder")}},duration:3}),k((e=>({...e,[a]:{...e[a],completedFiles:[],completedBytes:0,totalExpectedSize:0}})))):n({key:"upload:"+a,open:!0,message:e("explorer.UploadFailed",{folderName:null===o||void 0===o?void 0:o.vFolderName}),backgroundTask:{status:"rejected",percent:0,onChange:{rejected:e("explorer.FileUploadFailed",{folderName:null===o||void 0===o?void 0:o.vFolderName})}},extraDescription:y().join(null===o||void 0===o?void 0:o.failedFiles,", ")}))}))}),[p]),null},j=e=>{const l=(0,i.c)(21),a=(0,u.kq)(),{t:n}=(0,v.Bd)(),{upsertNotification:s}=(0,o.js)(),[d,t]=(e=>(0,m.fp)(N(e)))(e),c=(0,m.Xr)(b);let g,p,F;l[0]===Symbol.for("react.memo_cache_sentinel")?(g=r,l[0]=g):g=l[0],l[1]!==e?(p=(0,u.wc)("VirtualFolderNode",e),l[1]=e,l[2]=p):p=l[2],l[3]!==p?(F={vfolderGlobalId:p},l[3]=p,l[4]=F):F=l[4];const f=e?"network-only":"store-only";let h;l[5]!==f?(h={fetchPolicy:f},l[5]=f,l[6]=h):h=l[6];const{vfolder_node:S}=(0,k.useLazyLoadQuery)(g,F,h);let _;l[7]!==a||l[8]!==n||l[9]!==s||l[10]!==(null===S||void 0===S?void 0:S.name)?(_=(e,l)=>{const r=a._config.maxFileUploadSize,i=y().map(e,P).reduce(A,0);var o;return!(r>0&&i>r)||(s({open:!0,key:"upload:"+l,message:n("explorer.UploadFailed",{folderName:null!==(o=null===S||void 0===S?void 0:S.name)&&void 0!==o?o:""}),description:n("data.explorer.FileUploadSizeLimit"),duration:3,toText:n("data.folders.OpenAFolder"),to:{search:new URLSearchParams({folder:l}).toString()}}),!1)},l[7]=a,l[8]=n,l[9]=s,l[10]=null===S||void 0===S?void 0:S.name,l[11]=_):_=l[11];const K=_;let w;l[12]!==a||l[13]!==c||l[14]!==K||l[15]!==(null===S||void 0===S?void 0:S.name)?(w=async(e,l,n)=>{var r;if(!K(e,l))return;const i=[],o=y().map(e,(e=>(i.push(e),async r=>{const i=e.webkitRelativePath||e.name;try{const o=[n,i].filter(Boolean).join("/"),s=await a.vfolder.create_upload_session(o,e,l);return await new Promise(((l,a)=>{try{new x._O(e,{endpoint:s,uploadUrl:s,retryDelays:[0,3e3,5e3,1e4,2e4],chunkSize:V(e.size),storeFingerprintForResuming:!1,metadata:{filename:e.name,filetype:e.type},onProgress:(e,l)=>{var a;null===r||void 0===r||null===(a=r.onProgress)||void 0===a||a.call(r,e,l,i)},onSuccess:()=>{l({name:i,bytes:e.size})},onError:e=>{a(new Error(`Upload failed for ${i}`))}}).start()}catch(n){a(new Error(`Failed to initialize upload for ${i}`))}}))}catch(I){throw new Error(`Failed to prepare upload for ${i}`)}}))),s={vFolderId:l,vFolderName:null!==(r=null===S||void 0===S?void 0:S.name)&&void 0!==r?r:"",uploadFileInfo:y().zipWith(i,o,z)};c((e=>[...e,s]))},l[12]=a,l[13]=c,l[14]=K,l[15]=null===S||void 0===S?void 0:S.name,l[16]=w):w=l[16];const j=w;let I;return l[17]!==t||l[18]!==j||l[19]!==d?(I={uploadStatus:d,setUploadStatus:t,uploadFiles:j},l[17]=t,l[18]=j,l[19]=d,l[20]=I):I=l[20],I},V=e=>{const l=1048576;return e>=5120*l?200*l:e>=1024*l?100*l:e>=100*l?50*l:15*l};function P(e){return e.size}function A(e,l){return Math.max(e,l)}function z(e,l){return{file:e,startFunction:l}}},51329:(e,l,a)=>{a.r(l),a.d(l,{default:()=>ne});const n=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"vfolderGlobalId"}],l=[{kind:"Variable",name:"id",variableName:"vfolderGlobalId"}],a={alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"FolderExplorerModalQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,n,r,i,{args:null,kind:"FragmentSpread",name:"FolderExplorerHeaderFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeDescriptionFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"FolderExplorerModalQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,n,r,i,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},r],storageKey:null}]},params:{cacheID:"8610785ad6909de4c0539cc2dd1aa871",id:null,metadata:{},name:"FolderExplorerModalQuery",operationKind:"query",text:'query FolderExplorerModalQuery(\n  $vfolderGlobalId: String!\n) {\n  vfolder_node(id: $vfolderGlobalId) {\n    group\n    unmanaged_path @since(version: "25.04.0")\n    permissions\n    host\n    ...FolderExplorerHeaderFragment\n    ...VFolderNodeDescriptionFragment\n    ...VFolderNameTitleNodeFragment\n    id\n  }\n}\n\nfragment EditableVFolderNameFragment on VirtualFolderNode {\n  id\n  name\n  user\n  group\n  status\n}\n\nfragment FolderExplorerHeaderFragment on VirtualFolderNode {\n  id\n  user\n  permission\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderNameTitleNodeFragment\n  ...VFolderNodeIdenticonFragment\n  ...EditableVFolderNameFragment\n}\n\nfragment VFolderNameTitleNodeFragment on VirtualFolderNode {\n  name\n}\n\nfragment VFolderNodeDescriptionFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderPermissionCellFragment\n  ...useVirtualFolderNodePathFragment\n}\n\nfragment VFolderNodeIdenticonFragment on VirtualFolderNode {\n  id\n}\n\nfragment VFolderPermissionCellFragment on VirtualFolderNode {\n  permissions\n}\n\nfragment useVirtualFolderNodePathFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n}\n'}}}();n.hash="21f3dea0f55bfb287970c707120d8bf8";const r=n;var i=a(27569);const o={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FolderExplorerHeaderFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeIdenticonFragment"},{args:null,kind:"FragmentSpread",name:"EditableVFolderNameFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"b034e00d5b8454a58e6ebb66a4d821a1"},s=o;var d=a(56457),t=a(61973),u=a(68144),c=a(80125),m=a(28599),g=a(6534),p=a(46038),y=a(29410),F=a(91313),f=a(84100),v=a(81291),k=a(85724),h=a(7960);const S=e=>{let{vfolderNodeFrgmt:l,folderExplorerRef:a,titleStyle:n}=e;const{t:r}=(0,v.Bd)(),{token:i}=u.A.useToken(),{lg:o}=c.Ay.useBreakpoint(),f=(0,k.useFragment)(s,l);return(0,h.jsxs)(F.OO,{"data-testid":"folder-explorer-header",justify:"between",gap:i.marginMD,style:{width:"100%"},children:[(0,h.jsxs)(F.OO,{"data-testid":"folder-explorer-title",gap:"xs",style:{flex:1,...n},children:[f?(0,h.jsx)(t.A,{vfolderNodeIdenticonFrgmt:f,style:{fontSize:i.fontSizeHeading4}}):(0,h.jsx)(F.OO,{style:{borderColor:i.colorBorderSecondary,borderWidth:1,borderStyle:"solid",width:i.fontSizeHeading3,height:i.fontSizeHeading3,borderRadius:i.borderRadius}}),f&&(0,h.jsx)(d.A,{vfolderFrgmt:f,enableLink:!1,component:m.A.Title,level:3,style:{margin:0,width:"100%"},ellipsis:!0,editable:{triggerType:["icon","text"]},inputProps:{size:"large"}})]}),(0,h.jsx)(F.OO,{"data-testid":"folder-explorer-actions",justify:"end",gap:i.marginSM,children:null!==f&&void 0!==f&&f.unmanaged_path?null:(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(g.A,{title:!o&&r("data.explorer.ExecuteFileBrowser"),children:(0,h.jsx)(p.Ay,{icon:(0,h.jsx)(y.A,{width:"18px",src:"/resources/icons/filebrowser.svg",alt:"File Browser",preview:!1}),onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e._executeFileBrowser()},children:o&&r("data.explorer.ExecuteFileBrowser")})}),(0,h.jsx)(g.A,{title:!o&&r("data.explorer.RunSSH/SFTPserver"),children:(0,h.jsx)(p.Ay,{icon:(0,h.jsx)(y.A,{width:"18px",src:"/resources/icons/sftp.png",alt:"SSH / SFTP",preview:!1}),onClick:()=>{var e;null===(e=a.current)||void 0===e||e._executeSSHProxyAgent()},children:o&&r("data.explorer.RunSSH/SFTPserver")})})]})})]})},x=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],l=[{kind:"Variable",name:"id",variableName:"id"}],a={alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,n],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,n,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"3aee063a4b508648c2365ba6c7f0f44a",id:null,metadata:{},name:"VFolderNodeDescriptionPermissionRefreshQuery",operationKind:"query",text:"query VFolderNodeDescriptionPermissionRefreshQuery(\n  $id: String!\n) {\n  vfolder_node(id: $id) {\n    permission\n    permissions\n    id\n  }\n}\n"}}}();x.hash="36063c8300310d9ef6c369b49127a2a2";const _=x,b={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderPermissionCellFragment"},{args:null,kind:"FragmentSpread",name:"useVirtualFolderNodePathFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"f4ca4470ea635f85c8c346eed0a5fe8c"},K=b;var N=a(2156),w=a(19885),j=a(37615),V=a(79887),P=a(71526);const A={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useVirtualFolderNodePathFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"439221036e87c57ca3ec1ce737e0cdf7"},z=A;var I=a(8348),T=a.n(I);const O=e=>{const l=(0,k.useFragment)(z,e),[a,n]=T().split(null===l||void 0===l?void 0:l.quota_scope_id,":"),r=(0,F.om)(null===l||void 0===l?void 0:l.id),i=r.slice(0,2),o=r.slice(2,4),s=r.slice(4),d=`${n.replaceAll("-","")}/${i}/${o}/${s.replaceAll("-","")}`;return{quotaScopeType:a,quotaScopeIdWithoutType:n,vfolderId:r,vfolderIdPrefix1:i,vfolderIdPrefix2:o,vfolderIdRest:s,vfolderPath:d}};var Q=a(61659),R=a(14659),E=a(13225);const D=e=>{let{vfolderNodeFrgmt:l}=e;const{quotaScopeType:a,quotaScopeIdWithoutType:n,vfolderId:r,vfolderIdPrefix1:i,vfolderIdPrefix2:o,vfolderIdRest:s}=O(l),{token:d}=u.A.useToken();return(0,h.jsxs)(F.OO,{direction:"row",align:"start",justify:"start",wrap:"wrap",gap:3,children:[(0,h.jsx)(F.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"(root)"}),(0,h.jsx)(F.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,h.jsxs)(F.OO,{direction:"column",align:"start",justify:"start",children:[(0,h.jsx)(F.mQ,{monospace:!0,copyable:{text:n},style:{fontSize:"0.9em"},children:T().truncate(n.replaceAll("-",""),{length:15})}),(0,h.jsxs)(F.mQ,{type:"secondary",style:{fontSize:d.fontSizeSM},children:["Quota Scope ID (",T().upperFirst(a),")"]})]}),(0,h.jsx)(F.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,h.jsxs)(F.OO,{direction:"column",align:"start",justify:"start",children:[(0,h.jsxs)(F.OO,{gap:3,children:[(0,h.jsx)(F.mQ,{monospace:!0,style:{fontSize:"0.9em"},children:i}),(0,h.jsx)(F.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,h.jsx)(F.mQ,{monospace:!0,style:{fontSize:"0.9em"},children:o}),(0,h.jsx)(F.mQ,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,h.jsx)(F.mQ,{monospace:!0,copyable:{text:r},style:{fontSize:"0.9em"},children:T().truncate(s.replaceAll("-",""),{length:7})})]}),(0,h.jsx)(F.mQ,{type:"secondary",style:{fontSize:d.fontSizeSM},children:"VFolder ID"})]})]})};var q=a(44013),H=a(96182),M=a(83925),L=a(31370),U=a(77629),B=a.n(U);const C=e=>{var l;let{vfolderNodeFrgmt:a,onRequestRefresh:n,...r}=e;const{t:i}=(0,v.Bd)(),{token:o}=u.A.useToken(),{message:s}=M.A.useApp(),{getErrorMessage:d}=(0,F.B7)(),t=(0,k.useRelayEnvironment)(),c=(0,P.hd)(),g=(0,w.CX)(),[p]=(0,j.U6)(),y=(0,V.ET)({mutationFn:e=>{let{permission:l,id:a}=e;return g.vfolder.update_folder({permission:l},a)}}),f=(0,k.useFragment)(K,a),{vfolderPath:S}=O(f),x=(0,F.om)(f.id),b=(0,F.YM)([!(null!==f&&void 0!==f&&f.unmanaged_path)&&{key:"path",label:(0,h.jsx)(m.A.Text,{copyable:{text:S},style:{color:o.colorTextLabel},children:i("data.folders.Path")}),children:(0,h.jsx)(D,{vfolderNodeFrgmt:f})},{key:"status",label:i("data.folders.Status"),children:(0,h.jsx)(R.A,{color:f.status?E.C[f.status]:void 0,children:T().toUpper(f.status||"")})},{key:"host",label:i("data.Host"),children:f.host},{key:"ownership_type",label:i("data.folders.Ownership"),children:"user"===(null===f||void 0===f?void 0:f.ownership_type)?(0,h.jsxs)(F.OO,{gap:"xs",children:[(0,h.jsx)(m.A.Text,{children:i("data.User")}),(0,h.jsx)(q.A,{style:{color:o.colorTextTertiary}})]}):(0,h.jsxs)(F.OO,{gap:"xs",children:[(0,h.jsx)(m.A.Text,{children:i("data.Project")}),(0,h.jsx)(F.Ob,{style:{color:o.colorTextTertiary}})]})},((null===f||void 0===f?void 0:f.user)===p.uuid||g.is_admin&&(null===f||void 0===f?void 0:f.group)===(null===c||void 0===c?void 0:c.id))&&{key:"permission",label:i("data.folders.MountPermission"),children:(0,h.jsx)(Q.A,{defaultValue:"wd"===f.permission?"rw":f.permission,options:[{value:"ro",label:i("data.ReadOnly")},{value:"rw",label:i("data.ReadWrite")}],onChange:e=>{y.mutate({permission:e,id:x},{onSuccess:()=>{s.success(i("data.permission.PermissionModified")),document.dispatchEvent(new CustomEvent("backend-ai-folder-updated")),(0,k.fetchQuery)(t,_,{id:f.id}).toPromise(),null===n||void 0===n||n()},onError:e=>{s.error(d(e))}})},popupMatchSelectWidth:!1})},{key:"owner",label:i("data.folders.Owner"),children:(null===f||void 0===f?void 0:f.user)===(null===p||void 0===p?void 0:p.uuid)||g.is_admin&&(null===f||void 0===f?void 0:f.group)===(null===c||void 0===c?void 0:c.id)?(0,h.jsx)(F.OO,{justify:"start",children:(0,h.jsx)(H.A,{})}):null},null!==f.user_email&&{key:"user_email",label:i("data.User"),children:(0,h.jsx)(m.A.Text,{copyable:!0,children:f.user_email})},null!==f.group_name&&{key:"group_name",label:i("data.Project"),children:f.group_name},{key:"cloneable",label:i("data.folders.Cloneable"),children:f.cloneable?(0,h.jsx)(F.OO,{justify:"start",children:(0,h.jsx)(H.A,{})}):null},{key:"max_size",label:i("data.folders.MaxSize"),children:f.max_size?null===(l=(0,N.Gh)(f.max_size,"g",2))||void 0===l?void 0:l.displayValue:"\u221e"},{key:"usage",label:i("data.UsageMode"),children:f.usage_mode},{key:"created_at",label:i("data.folders.CreatedAt"),children:B()(f.created_at).format("lll")}]);return(0,h.jsx)(L.A,{bordered:!0,column:1,size:"small",items:b,styles:{content:{wordBreak:"break-word",overflowWrap:"break-word"}},...r})};var $=a(98840),G=a(32501),W=a(36830),X=a(6975);const J=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domainName"},{defaultValue:null,kind:"LocalArgument",name:"projectId"},{defaultValue:null,kind:"LocalArgument",name:"resourcePolicyName"}],l=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domainName"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domainName"},{kind:"Variable",name:"id",variableName:"projectId"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"resourcePolicyName"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:l,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:a},params:{cacheID:"f7d16150a7d77cb465733a2933a08261",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery(\n  $domainName: String\n  $projectId: UUID!\n  $resourcePolicyName: String\n) {\n  domain(name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  group(id: $projectId, domain_name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $resourcePolicyName) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();J.hash="616594ca9d6c787458c32688c1a25b1f";const Y=J,Z=function(){var e={defaultValue:null,kind:"LocalArgument",name:"accessKey"},l={defaultValue:null,kind:"LocalArgument",name:"domainName"},a=[{kind:"Variable",name:"access_key",variableName:"accessKey"},{kind:"Variable",name:"domain_name",variableName:"domainName"}],n={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null};return{fragment:{argumentDefinitions:[e,l],kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{kind:"RequiredField",field:{alias:null,args:a,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{kind:"RequiredField",field:n,action:"THROW"}],storageKey:null},action:"THROW"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,e],kind:"Operation",name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{alias:null,args:a,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"ca4270af888b8158a6bbb4fe9dc305ca",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_KeypairQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_KeypairQuery(\n  $domainName: String!\n  $accessKey: String\n) {\n  keypair(domain_name: $domainName, access_key: $accessKey) {\n    resource_policy\n    id\n  }\n}\n"}}}();Z.hash="43280e755e9e0f52dcd74eb7aa29d60c";const ee=Z;var le=a(7980);const ae=(0,X.rU)((e=>{let{css:l}=e;return{baiModalHeader:l`
    .ant-modal-title {
      width: 100%;
    }
  `}})),ne=e=>{var l,a;let{vfolderID:n,onRequestClose:o,...s}=e;const{t:d}=(0,v.Bd)(),{token:t}=u.A.useToken(),{xl:m}=c.Ay.useBreakpoint(),{styles:g}=ae(),p=(0,f.useRef)(null),{uploadStatus:y,uploadFiles:x}=(0,i.useFileUploadManager)(n),[_,b]=(0,w.zu)(),K=(0,w.CX)(),N=(0,w.eZ)(),j=(0,P.hd)(),V=null===K||void 0===K||null===(l=K._config)||void 0===l?void 0:l.accessKey,{unitedAllowedPermissionByVolume:A}=((e,l,a)=>{var n,r,i;const o=(0,w.CX)(),{keypair:s}=(0,k.useLazyLoadQuery)(ee,{domainName:e,accessKey:a},{fetchPolicy:"store-or-network"}),d=(0,k.useLazyLoadQuery)(Y,{domainName:e,projectId:l,resourcePolicyName:null===s||void 0===s?void 0:s.resource_policy},{fetchPolicy:"store-or-network"}),t=JSON.parse((null===d||void 0===d||null===(n=d.domain)||void 0===n?void 0:n.allowed_vfolder_hosts)||"{}"),u=JSON.parse((null===d||void 0===d||null===(r=d.group)||void 0===r?void 0:r.allowed_vfolder_hosts)||"{}"),c=JSON.parse((null===d||void 0===d||null===(i=d.keypair_resource_policy)||void 0===i?void 0:i.allowed_vfolder_hosts)||"{}"),{data:m}=(0,le.U)({queryKey:["vhostInfo"],queryFn:async()=>await o.vfolder.list_hosts(),staleTime:3e5,gcTime:0}),g=Object.assign({},...m.allowed.map((e=>{return{[e]:(l=[t[e],u[e],c[e]],[...new Set([].concat(...l.filter(Boolean)))])};var l})));return{StorageHostPermissionByDomain:t,StorageHostPermissionByGroup:u,StorageHostPermissionByResourcePolicy:c,unitedAllowedPermissionByVolume:g}})(N,j.id,V),z=(0,f.useRef)(null);(0,f.useEffect)((()=>{y&&T().isEmpty(null===y||void 0===y?void 0:y.pendingFiles)&&b()}),[y,b]);const{vfolder_node:I}=(0,k.useLazyLoadQuery)(r,{vfolderGlobalId:(0,F.wc)("VirtualFolderNode",n)},{fetchPolicy:s.open?"network-only":"store-only"}),O=T().includes(A[null!==(a=null===I||void 0===I?void 0:I.host)&&void 0!==a?a:""],"download-file"),Q=T().includes(null===I||void 0===I?void 0:I.permissions,"delete_content"),R=T().includes(null===I||void 0===I?void 0:I.permissions,"write_content"),E=null!==I&&void 0!==I&&I.unmanaged_path?(0,h.jsx)($.A,{message:d("explorer.NoExplorerSupportForUnmanagedFolder"),showIcon:!0}):(0,h.jsx)(F.Gt,{targetVFolderId:n,fetchKey:_,onUpload:(e,l)=>{x(e,n,l)},enableDownload:O,enableDelete:Q,enableWrite:R,tableProps:{scroll:m?{x:"max-content"}:{x:"max-content",y:"calc(100vh - 400px)"}},style:{paddingBottom:m?t.paddingLG:0},fileDropContainerRef:z}),D=I?(0,h.jsx)(C,{vfolderNodeFrgmt:I,onRequestRefresh:()=>{var e;null===(e=p.current)||void 0===e||e._fetchVFolder()}}):null;return(0,h.jsx)(F.Ib,{className:g.baiModalHeader,width:"90%",centered:!0,keyboard:!0,destroyOnHidden:!0,footer:null,title:I?(0,h.jsx)(S,{titleStyle:{zIndex:t.zIndexPopupBase+2},vfolderNodeFrgmt:I,folderExplorerRef:p}):null,bodyProps:{ref:z},onCancel:()=>{o()},...s,children:(0,h.jsxs)(F.OO,{direction:"column",gap:"lg",align:"stretch",children:[I?(null===j||void 0===j?void 0:j.id)!==(null===I||void 0===I?void 0:I.group)&&null!==I&&void 0!==I&&I.group?(0,h.jsx)($.A,{message:d("data.NotInProject"),type:"warning",showIcon:!0}):null:(0,h.jsx)($.A,{message:d("explorer.FolderNotFoundOrNoAccess"),type:"error",showIcon:!0}),m?(0,h.jsxs)(G.A,{style:{gap:t.size},layout:m?"horizontal":"vertical",children:[(0,h.jsx)(G.A.Panel,{resizable:!1,children:E}),(0,h.jsx)(G.A.Panel,{defaultSize:500,children:D})]},m?"large":"small"):(0,h.jsxs)(F.OO,{direction:"column",align:"stretch",children:[E,(0,h.jsx)(W.A,{style:{borderColor:t.colorBorderSecondary}}),D]}),(0,h.jsx)("div",{style:{display:"none"},children:(0,h.jsx)("backend-ai-folder-explorer",{ref:p,active:!0,vfolderID:n})})]})})}}}]);
//# sourceMappingURL=1329.22c089d5.chunk.js.map