{"version":3,"file":"static/js/7474.d12d2db3.chunk.js","mappings":"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","sources":["components/ResetPasswordRequired.tsx"],"sourcesContent":["import { baiSignedRequestWithPromise } from '../helper';\nimport { useAnonymousBackendaiClient } from '../hooks';\nimport { useTanMutation } from '../hooks/reactQueryAlias';\nimport { useWebComponentInfo } from './DefaultProviders';\nimport Flex from './Flex';\nimport { WarningTwoTone } from '@ant-design/icons';\nimport { Button, Form, Modal, Typography, Input, theme } from 'antd';\nimport { useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\n// src/components/backend-ai-common-utils.ts\nexport const passwordPattern = /^(?=.*\\d)(?=.*[a-zA-Z])(?=.*[_\\W]).{8,}$/;\n\nconst ResetPasswordRequired = () => {\n  const { value, dispatchEvent } = useWebComponentInfo();\n  let parsedValue: {\n    open: boolean;\n    currentPassword: string;\n    username: string;\n    api_endpoint: string;\n  };\n  try {\n    parsedValue = JSON.parse(value || '');\n  } catch (error) {\n    parsedValue = {\n      open: false,\n      currentPassword: '',\n      username: '',\n      api_endpoint: '',\n    };\n  }\n  const { open, currentPassword, username, api_endpoint } = parsedValue;\n\n  const { token } = theme.useToken();\n  const [form] = Form.useForm<{\n    newPassword: string;\n    confirm: string;\n  }>();\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    if (open) {\n      form.resetFields();\n    }\n  }, [open, form]);\n\n  const anonymousBaiClient = useAnonymousBackendaiClient({ api_endpoint });\n\n  const mutation = useTanMutation({\n    mutationFn: (body: {\n      username: string;\n      current_password: string;\n      new_password: string;\n    }) => {\n      return baiSignedRequestWithPromise({\n        method: 'POST',\n        url: '/server/update-password-no-auth',\n        body,\n        client: anonymousBaiClient,\n      });\n    },\n  });\n\n  const onSubmit = () => {\n    form.validateFields().then((values) => {\n      mutation.mutate(\n        {\n          username: username,\n          current_password: currentPassword,\n          new_password: values.newPassword,\n        },\n        {\n          onSuccess(data, variables, context) {\n            dispatchEvent('ok', null);\n          },\n          onError(error, variables, context) {},\n        },\n      );\n    });\n  };\n\n  return (\n    <Modal\n      open={open}\n      centered\n      mask={false}\n      onCancel={() => {\n        dispatchEvent('cancel', null);\n      }}\n      keyboard={false}\n      maskClosable={false}\n      footer={null}\n      width={450}\n      destroyOnClose={true}\n      forceRender\n    >\n      <Flex\n        direction=\"column\"\n        justify=\"start\"\n        align=\"stretch\"\n        gap={'md'}\n        style={{\n          alignSelf: 'stretch',\n          paddingTop: token.paddingMD,\n          paddingBottom: token.paddingMD,\n        }}\n      >\n        <Typography.Title level={3} style={{ margin: 0 }}>\n          <WarningTwoTone twoToneColor={token.colorWarning} />{' '}\n          {t('webui.menu.PleaseChangeYourPassword')}\n        </Typography.Title>\n        {t('webui.menu.YouMushChangeYourPassword')}\n        <Form\n          form={form}\n          layout=\"vertical\"\n          initialValues={{\n            currentPassword: currentPassword,\n          }}\n          disabled={mutation.isPending}\n        >\n          <Form.Item\n            name=\"newPassword\"\n            label={t('webui.menu.NewPassword')}\n            rules={[\n              {\n                required: true,\n              },\n              {\n                pattern: passwordPattern,\n                message: t('webui.menu.InvalidPasswordMessage').toString(),\n              },\n              () => ({\n                validator(_, value) {\n                  if (currentPassword === value) {\n                    return Promise.reject(\n                      new Error(\n                        t('webui.menu.NewPasswordCannotBeSame').toString(),\n                      ),\n                    );\n                  }\n                  return Promise.resolve();\n                },\n              }),\n            ]}\n            hasFeedback\n          >\n            <Input.Password />\n          </Form.Item>\n\n          <Form.Item\n            name=\"confirm\"\n            label={t('webui.menu.NewPasswordAgain')}\n            dependencies={['newPassword']}\n            hasFeedback\n            rules={[\n              {\n                required: true,\n              },\n              ({ getFieldValue }) => ({\n                validator(_, value) {\n                  if (!value || getFieldValue('newPassword') === value) {\n                    return Promise.resolve();\n                  }\n                  return Promise.reject(\n                    new Error(t('environment.PasswordsDoNotMatch').toString()),\n                  );\n                },\n              }),\n            ]}\n          >\n            <Input.Password onPressEnter={onSubmit} />\n          </Form.Item>\n        </Form>\n        <Button type=\"primary\" onClick={onSubmit} loading={mutation.isPending}>\n          {t('webui.menu.Update')}\n        </Button>\n      </Flex>\n    </Modal>\n  );\n};\n\nexport default ResetPasswordRequired;\n"],"names":["passwordPattern","ResetPasswordRequired","value","dispatchEvent","useWebComponentInfo","parsedValue","JSON","parse","error","open","currentPassword","username","api_endpoint","token","theme","useToken","form","Form","useForm","t","useTranslation","useEffect","resetFields","anonymousBaiClient","useAnonymousBackendaiClient","mutation","useTanMutation","mutationFn","body","baiSignedRequestWithPromise","method","url","client","onSubmit","validateFields","then","values","mutate","current_password","new_password","newPassword","onSuccess","data","variables","context","onError","_jsx","Modal","centered","mask","onCancel","keyboard","maskClosable","footer","width","destroyOnClose","forceRender","children","_jsxs","Flex","direction","justify","align","gap","style","alignSelf","paddingTop","paddingMD","paddingBottom","Typography","Title","level","margin","WarningTwoTone","twoToneColor","colorWarning","layout","initialValues","disabled","isPending","Item","name","label","rules","required","pattern","message","toString","validator","_","Promise","reject","Error","resolve","hasFeedback","Input","Password","dependencies","_ref","getFieldValue","onPressEnter","Button","type","onClick","loading"],"sourceRoot":""}