"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[1902],{71801:(e,n,t)=>{t.d(n,{A:()=>c});var i=t(40691),l=t(89939),o=t(9571),a=t(52335),d=t(20418),s=t(46976),r=t.n(s),u=(t(53350),t(60598));const c=e=>{let{status:n="default",extraButtonTitle:t,onClickExtraButton:s,extra:c,style:p,styles:m,showDivider:g,...h}=e;const{token:y}=o.A.useToken(),v=c||t&&(0,u.jsx)(a.Ay,{type:"link",icon:"error"===n?(0,u.jsx)(i.A,{twoToneColor:y.colorError}):"warning"===n?(0,u.jsx)(l.A,{twoToneColor:y.colorWarning}):void 0,onClick:s,children:t})||void 0;return(0,u.jsx)(d.A,{className:"error"===n?"bai-card-error":"",style:r().extend(p,{borderColor:"error"===n?y.colorError:"warning"===n?y.colorWarning:"success"===n?y.colorSuccess:null===p||void 0===p?void 0:p.borderColor}),styles:r().merge(g?{}:{header:{borderBottom:"none"},body:{paddingTop:y.marginXS}},m),extra:v,...h})}},97855:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointLLMChatCard_endpoint",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"d5fbaab35efda649f9f7847ee51028b6"},l=i},90003:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"endpoint_id"},n={defaultValue:null,kind:"LocalArgument",name:"filter"},t={defaultValue:null,kind:"LocalArgument",name:"limit"},i={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"projectID"},o={defaultValue:null,kind:"LocalArgument",name:"skipEndpoint"},a=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],d={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},c={args:null,kind:"FragmentSpread",name:"EndpointLLMChatCard_endpoint"},p=[{kind:"Variable",name:"endpoint_id",variableName:"endpoint_id"}],m=[s,r,u,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:[e,n,t,i,l,o],kind:"Fragment",metadata:null,name:"EndpointSelectQuery",selections:[{alias:null,args:a,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[d,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[s,r,u,c],storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[s,r,c],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[i,t,l,n,e,o],kind:"Operation",name:"EndpointSelectQuery",selections:[{alias:null,args:a,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[d,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:m,storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:m,storageKey:null}]},params:{cacheID:"4ed77e0d8d228a82aa36a46316bc28ca",id:null,metadata:{},name:"EndpointSelectQuery",operationKind:"query",text:"query EndpointSelectQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n  $filter: String\n  $endpoint_id: UUID!\n  $skipEndpoint: Boolean!\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: $filter) {\n    total_count\n    items {\n      name\n      endpoint_id\n      url\n      ...EndpointLLMChatCard_endpoint\n      id\n    }\n  }\n  endpoint(endpoint_id: $endpoint_id) @skipOnClient(if: $skipEndpoint) {\n    name\n    endpoint_id\n    ...EndpointLLMChatCard_endpoint\n    id\n  }\n}\n\nfragment EndpointLLMChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="bc98e0b499fc7a18b88e87841f5e6e47";const l=i},21902:(e,n,t)=>{t.r(n),t.d(n,{default:()=>$e});var i,l=t(71801),o=t(23441),a=t(73e3),d=t(51847),s=t(1581),r=t(46976),u=t.n(r),c=t(53350),p=t(22018),m=t(60598);const g=e=>{let{fetchKey:n,lifecycleStageFilter:l=["created"],loading:a,...r}=e;const g=(0,o.CX)(),[h,y]=(0,d.A)(r),[v,x]=(0,c.useState)(),[f,k]=(0,c.useTransition)(),j=l.map((e=>`lifecycle_stage == "${e}"`)).join(" | "),{endpoint_list:A,endpoint:b}=(0,p.useLazyLoadQuery)(void 0!==i?i:i=t(90003),{limit:10,offset:0,filter:g.supports("endpoint-lifecycle-stage-filter")?[j,v].filter(Boolean).map((e=>`(${e})`)).join(" & "):void 0,endpoint_id:h,skipEndpoint:!h},{fetchKey:n}),C=b?u().map(u().uniqBy(u().concat(null===A||void 0===A?void 0:A.items,b),"endpoint_id"),(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e}))):u().map(null===A||void 0===A?void 0:A.items,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e})));return(0,m.jsx)(s.A,{showSearch:!0,onSearch:e=>{k((()=>{x(e&&`name ilike "%${e}%"`)}))},filterOption:!1,loading:f||a,options:C,...r,value:h,onChange:(e,n)=>{var t;y(e,null===(t=u().castArray(n))||void 0===t?void 0:t[0].endpoint)}})};var h=t(72375);const y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[n,i]=(0,c.useState)(0);return(0,c.useEffect)((()=>{(0,c.startTransition)((()=>{(async e=>{const{encode:n}=await t.e(2471).then(t.bind(t,32471));return n(e).length})(e).then(i).catch((()=>{i(e.length)}))}))}),[e]),n};var v=t(72338),x=t(11383);const f=e=>{let{style:n,loading:t,autoFocus:i,onStop:l,onSend:o,...a}=e;const d=(0,c.useRef)(null);return(0,c.useEffect)((()=>{i&&d.current&&d.current.focus()}),[i]),(0,m.jsx)(x.A,{ref:d,...a,loading:t,onSubmit:()=>{null===o||void 0===o||o()},onCancel:()=>{null===l||void 0===l||l()},submitType:"enter"})};var k=t(91788);const j=e=>{let{models:n,allowCustomModel:t,...i}=e;const{t:l}=(0,k.Bd)();return(0,m.jsx)(s.A,{placeholder:l("chatui.SelectModel"),style:{fontWeight:"normal"},showSearch:!0,options:u().concat(t?[{label:"Custom",value:"custom"}]:[],u().chain(n).groupBy("group").mapValues((e=>u().map(e,(e=>({label:e.label,value:e.name}))))).map(((e,n)=>({label:"undefined"===n?"Others":n,options:e}))).value()),popupMatchSelectWidth:!1,...i})};var A=t(82919),b=t(52335),C=t(31456),S=t(167),L=t(37542);const E=e=>{let{copyable:n,defaultIcon:t,...i}=e;const[l,o]=(0,c.useState)(!1);return(0,c.useEffect)((()=>{if(l){const e=setTimeout((()=>{o(!1)}),2e3);return()=>clearTimeout(e)}}),[l]),(0,m.jsx)(A.A,{title:l?"Copied!":"Copy",open:!!l||void 0,children:(0,m.jsx)(L.CopyToClipboard,{text:(null===n||void 0===n?void 0:n.text)||"",onCopy:async()=>{o(!0)},children:(0,m.jsx)(b.Ay,{icon:l?(0,m.jsx)(C.A,{}):t||(0,m.jsx)(S.A,{}),...i})})})};var w=t(50128),T=t(20418),_=(t(92134),t(23409)),I=t(28304),M=t(83376),F=t(22608),D=t(80557),K=t(52737);const{Text:R}=w.A,B=e=>{let{children:n}=e;return(0,m.jsx)(_.o,{remarkPlugins:[D.A,K.A],rehypePlugins:[F.A],components:{p(e){let{node:n,...t}=e;return(0,m.jsx)("p",{...t,style:{whiteSpace:"pre-wrap"}})},code(e){const{children:n,className:t,node:i,ref:l,...o}=e,a=/language-(\w+)/.exec(t||""),d=String(n).replace(/\n$/,"");return a?(0,m.jsx)(T.A,{title:(0,m.jsx)(R,{style:{fontWeight:"normal"},type:"secondary",children:a[1]}),type:"inner",size:"small",extra:(0,m.jsx)(E,{type:"text",copyable:{text:"s"}}),styles:{body:{padding:0},header:{margin:0}},children:(0,m.jsx)("div",{style:{margin:"-0.5em 0",width:"100%"},children:(0,m.jsx)($,{ref:l,...o,PreTag:"div",language:a[1],style:M.A,wrapLongLines:!0,wrapLines:!0,children:d})})}):(0,m.jsx)("code",{...o,className:t,children:n})}},children:n})},U=e=>{let{children:n,...t}=e;return(0,m.jsx)(I.A,{...t,children:n})},$=c.memo(U),V=c.memo(B);var z=t(79429),q=t(65839),H=t(9571),P=t(69546),Q=t(38385),O=t(85391),N=t(49978),W=t(78502),J=t.n(W),X=t(48787),Y=t.n(X),G=t(2660),Z=t.n(G);J().extend(Y()),J().extend(Z());const ee=e=>{let{extra:n,message:t,placement:i="left",containerStyle:l,enableExtraHover:o,isStreaming:a}=e;const{token:d}=H.A.useToken(),{t:s}=(0,k.Bd)(),[r,p]=(0,c.useState)(!1),g=(0,q.A)(t.reasoning,{wait:50}),h=(0,q.A)(t.content,{wait:50});return(0,m.jsxs)(v.A,{direction:"left"===i?"row":"row-reverse",justify:"start",align:"baseline",style:{marginLeft:"left"===i?"0":"15%",marginRight:"right"===i?"0":20,...l},gap:"sm",onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:["user"!==t.role?(0,m.jsx)(P.A,{icon:"\ud83e\udd16",style:{fontSize:d.fontSizeHeading3}}):null,(0,m.jsxs)(v.A,{direction:"column",align:"left"===i?"start":"end",wrap:"wrap",style:{flex:1},gap:"xs",children:[u().map(t.experimental_attachments,((e,n)=>u().includes(null===e||void 0===e?void 0:e.contentType,"image/")?(0,m.jsx)(v.A,{style:{border:"none",textAlign:"end"},align:"end",children:(0,m.jsx)(Q.A,{src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name,style:{maxWidth:"50vw",maxHeight:"12vh",borderRadius:d.borderRadius}},`${null===t||void 0===t?void 0:t.id}-${n}`)}):(0,m.jsx)(z.A.FileCard,{item:{uid:`${null===t||void 0===t?void 0:t.id}-${n}`,name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.url),type:null===e||void 0===e?void 0:e.contentType,description:null===e||void 0===e?void 0:e.name,url:null===e||void 0===e?void 0:e.url}},n))),(0,m.jsxs)(v.A,{align:"stretch",direction:"column",style:{borderRadius:d.borderRadius,borderColor:d.colorBorderSecondary,borderWidth:d.lineWidth,padding:"1em",paddingTop:0,paddingBottom:0,backgroundColor:"user"!==t.role?d.colorBgContainer:d.colorBgContainerDisabled,maxWidth:"100%",width:u().trim(t.reasoning)?"100%":"auto"},children:[u().trim(t.reasoning)&&(0,m.jsx)(O.A,{style:{marginTop:d.margin,width:"100%"},items:[{key:"reasoning",label:u().isEmpty(h)?(0,m.jsxs)(v.A,{gap:"xs",children:[(0,m.jsx)(w.A.Text,{children:s("chatui.Thinking")}),(0,m.jsx)(N.A,{size:"small"})]}):(0,m.jsx)(w.A.Text,{children:s("chatui.ViewReasoning")}),children:(0,m.jsx)(V,{children:g})}]}),(0,m.jsx)(V,{children:h+(a?"\n\u25cf":"")})]}),(0,m.jsx)(v.A,{style:{fontSize:d.fontSizeSM,...o?{opacity:r?1:0,transition:"opacity 0.2s",transitionDelay:r?"0s":"0.2s"}:{}},children:n})]})]})};var ne=t(68098),te=t(7126);const ie=e=>{let{autoScroll:n,atBottom:t,lastMessageContent:i,...l}=e;const o=(0,ne.E)(l.onScrollToBottom);return(0,c.useEffect)((()=>{t&&n&&(null===o||void 0===o||o("auto"))}),[t,n,i,o]),(0,m.jsx)(b.Ay,{icon:(0,m.jsx)(te.A,{}),shape:"circle",onClick:()=>{o&&o("click")}})};var le=t(85064),oe=t(2646);const ae=e=>{let{messages:n,isStreaming:t}=e;const i=(0,c.useRef)(null),[l,o]=(0,c.useState)(!0),{token:a}=H.A.useToken(),d="undefined"!==typeof window?1.5*window.innerHeight:0;return(0,m.jsxs)(v.A,{direction:"column",align:"stretch",style:{height:"100%",flex:1},children:[(0,m.jsx)(oe.aY,{atBottomStateChange:o,atBottomThreshold:60,computeItemKey:(e,n)=>n.id,data:n,followOutput:"auto",initialTopMostItemIndex:(null===n||void 0===n?void 0:n.length)-1,itemContent:(e,i)=>(0,m.jsx)(ee,{message:i,placement:"user"===i.role?"right":"left",containerStyle:{paddingLeft:a.paddingMD,paddingRight:a.paddingMD,paddingTop:0===e?a.paddingMD:0,paddingBottom:e===n.length-1?a.paddingMD:0},isStreaming:"user"!==i.role&&t&&e===n.length-1,enableExtraHover:"user"===i.role,extra:"user"!==i.role?(0,m.jsx)(le.Ay,{children:(0,m.jsx)(E,{type:"text",size:"small",copyable:{text:i.content}})}):(0,m.jsx)(le.Ay,{children:null})},i.id),overscan:d,ref:i}),(0,m.jsx)("div",{style:{position:"absolute",right:"50%",transform:"translateX(+50%)",bottom:a.marginSM,opacity:l?0:1,transition:"opacity 0.2s",transitionDelay:l?"0s":"0.2s"},children:(0,m.jsx)(ie,{atBottom:l,autoScroll:t,onScrollToBottom:e=>{const n=i.current;switch(e){case"auto":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"auto",index:"LAST"});break;case"click":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"smooth",index:"LAST"})}},lastMessageContent:u().get(u().last(n),"content")})})]})};var de=t(93232),se=t(46538),re=t(10424),ue=t(51282),ce=t(27319),pe=t(12943),me=t(56431),ge=t(27857),he=t(79773),ye=t(9712),ve=t(13170),xe=t(83978),fe=t(58325),ke=t(24798),je=t(2822);const Ae=e=>{var n;let{models:t=[],endpointId:i,baseURL:l,headers:a,credentials:s,apiKey:r,fetchOnClient:p,allowCustomModel:g,alert:A,leftExtra:C,inputMessage:S,inputAttachment:L,submitKey:E,onInputChange:_,onAttachmentChange:I,onSubmitChange:M,showCompareMenuItem:F,modelToken:D,...K}=e;const R=(0,o.f0)(),[B,U]=(0,c.useState)(!1),[$,V]=(0,c.useState)([]),[q,P]=(0,d.A)(K,{valuePropName:"modelId",trigger:"onModelChange",defaultValue:null===t||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id}),Q=(0,c.useRef)(null),O=(0,c.useRef)(null),{messages:N,error:W,input:J,setInput:X,stop:Y,isLoading:G,append:Z,setMessages:ee}=(0,se.Y_)({api:l,headers:a,credentials:s,body:{modelId:q},fetch:async(e,n)=>{if(p||"custom"===q){var t,i,o;const e=JSON.parse(null===n||void 0===n?void 0:n.body),a=(0,de.r)({baseURL:g?null===(t=Q.current)||void 0===t?void 0:t.getFieldValue("baseURL"):l,apiKey:(g?null===(i=Q.current)||void 0===i?void 0:i.getFieldValue("token"):r)||"dummy"}),d=(0,ge.gM)({abortSignal:(null===n||void 0===n?void 0:n.signal)||void 0,model:(0,ge.ae)({model:a(g?null===(o=Q.current)||void 0===o?void 0:o.getFieldValue("modelId"):q),middleware:(0,ge.Ol)({tagName:"think"})}),messages:null===e||void 0===e?void 0:e.messages});return le(Date.now()),d.toDataStreamResponse({sendReasoning:!0})}return fetch(e,n)}}),{token:ne}=H.A.useToken(),{t:te}=(0,k.Bd)(),[ie,le]=(0,c.useState)(null);(0,c.useEffect)((()=>{u().isUndefined(S)||X(S)}),[S,X]);(0,c.useEffect)((()=>{(e=>{u().isUndefined(e)||u().isEqual($,e)||(V(e),U(!0))})(L)}),[L]),(0,c.useEffect)((()=>{if(!u().isUndefined(E)&&J){const e={};u().isEmpty($)||(e.experimental_attachments=(0,h.bJ)($)),Z({role:"user",content:J},e)}}),[E]);const oe=y(J),Ae=(0,c.useMemo)((()=>u().map(N,(e=>null===e||void 0===e?void 0:e.content)).join("")),[N]),be=oe+y(Ae),Ce=(0,c.useMemo)((()=>{const e=u().last(N);return"assistant"===(null===e||void 0===e?void 0:e.role)?null===e||void 0===e?void 0:e.content:""}),[N]),Se=y(Ce),Le=(0,c.useMemo)((()=>Se>0&&ie?Se/((Date.now()-ie)/1e3):0),[Se,ie]),Ee=(0,h.LY)([F&&{key:"compare",label:te("chatui.CompareWithOtherModels"),icon:(0,m.jsx)(je.A,{}),onClick:()=>{R(`/serving?tab=chatting&endpointId=${i}&modelId=${q}`)}},F&&{type:"divider"},{key:"clear",danger:!0,label:te("chatui.DeleteChatHistory"),icon:(0,m.jsx)(re.A,{}),onClick:()=>{ee([])}}]);return(0,m.jsxs)(T.A,{ref:O,bordered:!0,extra:[],...K,title:(0,m.jsx)(v.A,{direction:"column",align:"stretch",gap:"sm",children:(0,m.jsxs)(v.A,{direction:"row",gap:"xs",children:[C,(0,m.jsx)(j,{models:t,value:q,onChange:P,allowCustomModel:g}),(0,m.jsx)(he.A,{menu:{items:Ee},trigger:["click"],children:(0,m.jsx)(b.Ay,{type:"link",onClick:e=>e.preventDefault(),icon:(0,m.jsx)(ue.A,{}),style:{color:ne.colorTextSecondary,width:ne.sizeMS}})})]})}),style:{height:"100%",width:"100%",display:"flex",flexDirection:"column"},styles:{body:{backgroundColor:ne.colorFillQuaternary,borderRadius:0,flex:1,display:"flex",flexDirection:"column",padding:0,height:"50%",position:"relative"},actions:{paddingLeft:ne.paddingContentHorizontal,paddingRight:ne.paddingContentHorizontal},header:{zIndex:1}},actions:[(0,m.jsx)(f,{autoFocus:!0,value:J,placeholder:"Say something...",header:(0,m.jsx)(x.A.Header,{closable:!1,title:te("chatui.Attachments"),open:!!B&&!u().isEmpty($),onOpenChange:U,styles:{content:{padding:0}},children:(0,m.jsx)(z.A,{beforeUpload:()=>!1,getDropContainer:()=>O.current,accept:"image/*,text/*",items:$,onChange:e=>{let{fileList:n}=e;V(n),null===I||void 0===I||I(n)},placeholder:e=>"drop"===e?{title:te("chatui.DropFileHere")}:{icon:(0,m.jsx)(ce.A,{}),title:te("chatui.UploadFiles"),description:te("chatui.UploadFilesDescription")}})}),prefix:(0,m.jsx)(z.A,{beforeUpload:()=>!1,getDropContainer:()=>O.current,accept:"image/*,text/*",items:$,onChange:e=>{let{fileList:n}=e;V(n),null===I||void 0===I||I(n),U(!0)},placeholder:e=>"drop"===e?{title:te("chatui.DropFileHere")}:{icon:(0,m.jsx)(ce.A,{}),title:te("chatui.UploadFiles"),description:te("chatui.UploadFilesDescription")},children:(0,m.jsx)(ye.A,{dot:!u().isEmpty($)&&!B,children:(0,m.jsx)(b.Ay,{type:"text",icon:(0,m.jsx)(pe.A,{})})})}),onChange:e=>{X(e),_&&_(e)},loading:G,onStop:()=>{Y()},onSend:()=>{if(J||!u().isEmpty($)){const e={};u().isEmpty($)||(e.experimental_attachments=(0,h.bJ)($)),Z({role:"user",content:J},e),setTimeout((()=>{X(""),V([]),U(!1)}),0),null===M||void 0===M||M()}},style:{flex:1}})],children:[(0,m.jsx)(v.A,{direction:"row",style:{padding:ne.paddingSM,paddingRight:ne.paddingContentHorizontalLG,paddingLeft:ne.paddingContentHorizontalLG,backgroundColor:ne.colorBgContainer,display:g&&"custom"===q?"flex":"none"},children:(0,m.jsxs)(ve.A,{ref:Q,layout:"horizontal",size:"small",requiredMark:"optional",style:{flex:1},initialValues:{baseURL:l,token:D},children:[A?(0,m.jsx)("div",{style:{marginBottom:ne.size},children:A}):null,(0,m.jsx)(ve.A.Item,{label:"baseURL",name:"baseURL",rules:[{type:"url"},{required:!0}],children:(0,m.jsx)(xe.A,{placeholder:"https://domain/v1"})}),(0,m.jsx)(ve.A.Item,{label:"Model ID",name:"modelId",rules:[{required:!0}],children:(0,m.jsx)(xe.A,{placeholder:"llm-model"})}),(0,m.jsx)(ve.A.Item,{label:"Token",name:"token",children:(0,m.jsx)(xe.A,{})})]},l)}),u().isEmpty(null===W||void 0===W?void 0:W.message)?null:(0,m.jsx)(fe.A,{message:null===W||void 0===W?void 0:W.message,type:"error",showIcon:!0,style:{margin:ne.marginSM},closable:!0}),(0,m.jsx)(ae,{messages:N,isStreaming:G}),(0,m.jsx)(v.A,{justify:"end",align:"end",style:{margin:ne.marginSM},children:(0,m.jsx)(ke.A,{children:(0,m.jsxs)(v.A,{gap:"xs",children:[(0,m.jsx)(me.A,{}),(0,m.jsxs)(v.A,{gap:"xxs",children:[(0,m.jsx)(w.A.Text,{children:Le.toFixed(2)}),(0,m.jsx)(w.A.Text,{type:"secondary",children:"tok/s"})]}),(0,m.jsxs)(v.A,{gap:"xxs",children:[(0,m.jsx)(w.A.Text,{children:be}),(0,m.jsx)(w.A.Text,{type:"secondary",children:"total tokens"})]})]})})})]})};var be,Ce=t(59203),Se=t(43622),Le=t(24034),Ee=t(21110),we=t(7322);const Te=(0,Ee.eU)(""),_e=(0,Ee.eU)(),Ie=(0,Ee.eU)(void 0),Me=e=>{var n,i,l,d;let{basePath:s="v1",closable:r,defaultModelId:h,defaultEndpoint:y,isSynchronous:v,onRequestClose:x,onModelChange:f,...j}=e;const{t:A}=(0,k.Bd)(),{token:C}=H.A.useToken(),[S,L]=(0,o.Tw)("first"),[E,w]=(0,c.useState)(y||null),T=(0,p.useFragment)(void 0!==be?be:be=t(97855),E),[_,I]=(0,c.useState)(T),[M,F]=(0,we.fp)(Te),[D,K]=(0,we.fp)(_e),[R,B]=(0,we.fp)(Ie),{data:U}=(0,a.nj)({queryKey:["models",S,null===T||void 0===T?void 0:T.endpoint_id],queryFn:()=>{var e;return null!==T&&void 0!==T&&T.url?fetch(new URL(s+"/models",null!==(e=null===T||void 0===T?void 0:T.url)&&void 0!==e?e:void 0).toString()).then((e=>e.json())).catch((e=>({data:[]}))):Promise.resolve({data:[]})}}),$=u().map(null===U||void 0===U?void 0:U.data,(e=>({id:e.id,name:e.id}))),V=(0,c.useId)();return(0,m.jsx)(Ae,{...j,baseURL:null!==T&&void 0!==T&&T.url?new URL(s,null!==(n=null===T||void 0===T?void 0:T.url)&&void 0!==n?n:void 0).toString():void 0,models:$,fetchOnClient:!0,leftExtra:(0,m.jsx)(g,{placeholder:A("chatui.SelectEndpoint"),style:{fontWeight:"normal"},fetchKey:S,showSearch:!0,loading:(null===_||void 0===_?void 0:_.endpoint_id)!==(null===T||void 0===T?void 0:T.endpoint_id),onChange:(e,n)=>{I(n),(0,c.startTransition)((()=>{w(n)}))},value:null===T||void 0===T?void 0:T.endpoint_id,popupMatchSelectWidth:!1}),modelId:h&&u().includes(u().map(null===U||void 0===U?void 0:U.data,"id"),h)?h:null!==(i=null===U||void 0===U||null===(l=U.data)||void 0===l||null===(d=l[0])||void 0===d?void 0:d.id)&&void 0!==i?i:"custom",extra:r?(0,m.jsx)(Le.A,{title:A("chatui.DeleteChattingSession"),description:A("chatui.DeleteChattingSessionDescription"),onConfirm:()=>{null===x||void 0===x||x()},okText:A("button.Delete"),okButtonProps:{danger:!0},children:(0,m.jsx)(b.Ay,{icon:(0,m.jsx)(Ce.A,{}),type:"text",style:{color:C.colorIcon}})}):void 0,allowCustomModel:u().isEmpty($),alert:u().isEmpty($)&&(0,m.jsx)(fe.A,{type:"warning",showIcon:!0,message:A("chatui.CannotFindModel"),action:(0,m.jsx)(b.Ay,{icon:(0,m.jsx)(Se.A,{}),onClick:()=>{L()},children:A("button.Refresh")})}),inputMessage:v?M:void 0,onInputChange:e=>{F(e)},inputAttachment:v?D:void 0,onAttachmentChange:e=>{K(e)},submitKey:(null===R||void 0===R?void 0:R.id)===V||null===R||void 0===R?void 0:R.key,onSubmitChange:()=>{F(""),K([]),v&&B({id:V,key:(new Date).toString()})}})};var Fe,De=t(53051),Ke=t(9184),Re=t(77109),Be=t(91867),Ue=t(32043);const $e=e=>{let{...n}=e;const{token:i}=H.A.useToken(),{t:o}=(0,k.Bd)(),{list:a,remove:d,getKey:s,push:r}=(0,Ke.A)(["0"]),[g,h]=(0,c.useState)(!1),[y]=(0,Ue.useQueryParam)("endpointId",Ue.StringParam),[x]=(0,Ue.useQueryParam)("modelId",Ue.StringParam),f=!y,{endpoint:j,endpoint_list:A}=(0,p.useLazyLoadQuery)(void 0!==Fe?Fe:Fe=t(85849),{endpointId:y||"",isEmptyEndpointId:f});return(0,m.jsx)(l.A,{title:o("webui.menu.Chat"),styles:{body:{padding:0,paddingTop:1,overflow:"hidden"}},extra:(0,m.jsx)(v.A,{direction:"row",gap:"xs",wrap:"wrap",style:{flexShrink:1},children:(0,m.jsxs)(v.A,{gap:"xs",children:[(0,m.jsx)(w.A.Text,{type:"secondary",children:o("chatui.SyncInput")}),(0,m.jsx)(Re.A,{value:g,onClick:e=>{h(e)}}),(0,m.jsx)(b.Ay,{onClick:()=>{r((new Date).toString())},icon:(0,m.jsx)(De.A,{})})]})}),children:(0,m.jsx)(v.A,{direction:"column",align:"stretch",gap:"xs",style:{padding:i.paddingContentVertical,paddingLeft:i.paddingContentHorizontalSM,paddingRight:i.paddingContentHorizontalSM},children:(0,m.jsx)(v.A,{gap:"xs",direction:"row",style:{margin:i.margin,marginTop:0,overflow:"auto",height:"calc(100vh - 215px)"},align:"stretch",children:u().map(a,((e,n)=>{var t;return(0,m.jsx)(c.Suspense,{fallback:(0,m.jsx)(T.A,{bordered:!0,style:{width:"100%",display:"flex",flexDirection:"column"},children:(0,m.jsx)(Be.A,{active:!0})}),children:(0,m.jsx)(Me,{defaultModelId:0===n&&j&&x?x:void 0,defaultEndpoint:0===n&&j?j:(null===A||void 0===A||null===(t=A.items)||void 0===t?void 0:t[0])||void 0,style:{flex:1},onRequestClose:()=>{d(n)},closable:a.length>1,isSynchronous:g},s(n))},s(n))}))})})})}},85849:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpointId"},{defaultValue:null,kind:"LocalArgument",name:"isEmptyEndpointId"}],n=[{kind:"Variable",name:"endpoint_id",variableName:"endpointId"}],t=[{args:null,kind:"FragmentSpread",name:"EndpointLLMChatCard_endpoint"}],i=[{kind:"Literal",name:"limit",value:1},{kind:"Literal",name:"offset",value:0}],l=[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatPageQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:t,storageKey:null},{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:t,storageKey:null}],storageKey:"endpoint_list(limit:1,offset:0)"}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatPageQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:l,storageKey:null},{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:l,storageKey:null}],storageKey:"endpoint_list(limit:1,offset:0)"}]},params:{cacheID:"b78052a376d66eed6b273f0ababb32fc",id:null,metadata:{},name:"ChatPageQuery",operationKind:"query",text:"query ChatPageQuery(\n  $endpointId: UUID!\n  $isEmptyEndpointId: Boolean!\n) {\n  endpoint(endpoint_id: $endpointId) @skipOnClient(if: $isEmptyEndpointId) {\n    ...EndpointLLMChatCard_endpoint\n    id\n  }\n  endpoint_list(limit: 1, offset: 0) {\n    items {\n      ...EndpointLLMChatCard_endpoint\n      id\n    }\n  }\n}\n\nfragment EndpointLLMChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="83c2a6211dc82404eeaf586c3a040cbb";const l=i}}]);
//# sourceMappingURL=1902.bc17beb8.chunk.js.map