"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[3209],{98401:(e,i,n)=>{n.d(i,{A:()=>t});var l=n(89130),o=n(15934),r=n(89608),s=n.n(r),u=n(43373),a=n(73689);const t=e=>{let i,{values:n=[]}=e;return 0===n.length?null:(i=n[0]&&("string"===typeof n[0]||u.isValidElement(n[0]))?n.map((e=>({label:e,color:"blue"}))):n,(0,a.jsx)(l.A,{direction:"row",children:s().map(i,((e,n)=>(0,a.jsx)(o.A,{style:s().last(i)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:e.label},n)))}))}},40471:(e,i,n)=>{n.d(i,{A:()=>v});var l=n(58879),o=n(7194),r=n(27666),s=n(86917),u=n(69056),a=n(85690),t=n(89608),d=n.n(t),c=n(43373),m=n(73689);const v=e=>{let{dynamicSteps:i=[1,2,4,8,16,32,64,128,256,512],units:n=["m","g","t","p"],disableAutoUnit:t=!1,min:v="0m",max:g="300p",roundStep:p,...h}=e;const[y,x]=(0,o.A)(h,{defaultValue:"0g"}),[b,f]=null===y||void 0===y?[null,null]:(0,l.E8)(y),_=(0,r.A)(f),A=f||_||n[0],[j,k]=(0,l.E8)(v),[S,P]=(0,l.E8)(g),N=(0,c.useRef)(null);return(0,c.useEffect)((()=>{if(N.current){const e=e=>{var i;const n=null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.value;/^\d+(g|m)$/.test(n)&&x(n)},i=N.current;return null===i||void 0===i||i.addEventListener("input",e),()=>{null===i||void 0===i||i.removeEventListener("input",e)}}}),[N,b,f,x]),(0,m.jsx)(s.A,{ref:N,...h,onBlur:()=>{if(d().isNumber(p)&&p>0){var e,i,n;const l=(null===(e=p.toString().split(".")[1])||void 0===e?void 0:e.length)||0;if(isNaN(Math.round(d().toNumber((null===(i=N.current)||void 0===i?void 0:i.value)||"0")/p)*p))return;x(`${(Math.round(d().toNumber((null===(n=N.current)||void 0===n?void 0:n.value)||"0")/p)*p).toFixed(l)}${A}`)}},value:b,onChange:e=>{x(null===e||void 0===e?e:`${e}${A}`)},max:P===A?S:(0,l.Js)(g,A).number,min:k===A?j:(0,l.Js)(v,A).number,addonAfter:(0,m.jsx)(u.A,{tabIndex:-1,value:A,onChange:e=>{x(`${b}${e}`)},onDropdownVisibleChange:e=>{(e&&null===y||void 0===y)&&x(`0${A}`)},options:d().map(n,(e=>({value:e,label:(0,m.jsx)(a.A.Text,{style:{fontFamily:"'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace"},children:e.toUpperCase()+"iB"})}))),suffixIcon:n.length>1?void 0:null,open:n.length>1&&void 0,style:{cursor:n.length>1?void 0:"default"}}),step:0,onStep:(e,l)=>{const o=d().isNull(b)||d().isUndefined(b)?0:b,r=d().sortedIndex(d().sortBy(i),o);let s;s="up"===l.type?o===i[r]?r+1:r:r-1;const u=n.indexOf(A);if(!t&&s<0)if(0===u)x(`0${A}`);else{const e=i[i.length-1],l=n[u-1];x(`${e}${l}`)}else if(!t&&s>i.length-1)if(u===n.length-1)x(`${o+("up"===l.type?1:-1)}${P}`);else{const e=i[0],l=n[u+1];x(`${e}${l}`)}else if(s>=0&&s<i.length){let e=i[s];k===A&&e<j?e=j:P===A&&e>S&&(e=S),x(`${e}${A}`)}}})}},16272:(e,i,n)=>{n.d(i,{A:()=>u});var l=n(51593),o=n(43373),r=n(73689);const s=function(e,i){let{image:n,style:o={}}=e,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const[,{getImageIcon:u}]=(0,l.Gj)();return(0,r.jsx)("img",{src:u(n),style:{width:"1em",height:"1em",...o},alt:s})},u=o.memo(s)},74019:(e,i,n)=>{n.d(i,{A:()=>m});var l=n(51593),o=n(7194),r=n(89130),s=n(86917),u=n(87298),a=n(89608),t=n.n(a),d=n(43373),c=n(73689);const m=e=>{let{min:i,max:n,step:a,disabled:m,inputNumberProps:v,sliderProps:g,...p}=e;const[h,y]=(0,o.A)(p),x=d.useRef(null);(0,d.useEffect)((()=>{1===a&&h%1!==0&&y(t().max([Math.round(h),i]))}),[a]);const[b,f]=(0,l.Tw)("first");return(0,d.useEffect)((()=>{setTimeout((()=>{f(h)}),0)}),[]),(0,c.jsxs)(r.A,{direction:"row",gap:"md",children:[(0,c.jsx)(r.A,{style:{flex:2,minWidth:190},align:"stretch",direction:"column",children:(0,c.jsx)(s.A,{ref:x,max:n,min:i,step:null!==a&&void 0!==a?a:void 0,disabled:m,value:h,onChange:y,onBlur:()=>{if(t().isNumber(a)&&a>0){var e,l,o;if(t().isNumber(n)&&n<t().toNumber((null===(e=x.current)||void 0===e?void 0:e.value)||"0"))return;const r=(null===(l=a.toString().split(".")[1])||void 0===l?void 0:l.length)||0;y(t().max([t().toNumber((Math.round(t().toNumber((null===(o=x.current)||void 0===o?void 0:o.value)||"0")/a)*a).toFixed(r)),i]))}},...v},b)}),(0,c.jsx)(r.A,{direction:"column",align:"stretch",style:{flex:3},children:(0,c.jsx)(u.A,{max:n,min:0,step:a,disabled:m,value:h,onChange:e=>{void 0!==i&&e<i||y(e)},...g,marks:t().omitBy(null===g||void 0===g?void 0:g.marks,((e,i)=>!!t().isNumber(n)&&t().parseInt(i)>n))})})]})}},39428:(e,i,n)=>{n.d(i,{t2:()=>z,jh:()=>B,Ay:()=>Q});var l=n(58879),o=n(51593),r=n(11899),s=n(68190),u=n(15634),a=n(60266),t=n(9194),d=n(7194),c=n(40471),m=n(89130),v=n(50868),g=n(87298),p=n(89608),h=n.n(p),y=n(43373),x=n(73689);const b=e=>{let{min:i="0m",max:n="32g",warn:r,units:s=["m","g"],extraMarks:u,hideSlider:a,step:t=.05,...p}=e;const[b,f]=(0,d.A)(p,{defaultValue:"0g"}),{token:_}=v.A.useToken(),A=(0,y.useMemo)((()=>(0,l.Js)(i,"g",2)),[i]),j=(0,y.useMemo)((()=>(0,l.Js)(n,"g",2)),[n]),k=(0,y.useMemo)((()=>(0,l.Js)(b||"0g","g",2)),[b]),[S,P]=(0,o.Tw)("first");(0,y.useEffect)((()=>{setTimeout((()=>{P(null===b||void 0===b?void 0:b.toString())}),0)}),[]);const N=h().isNumber(null===A||void 0===A?void 0:A.number)&&h().isNumber(null===j||void 0===j?void 0:j.number)&&(null===A||void 0===A?void 0:A.number)>(null===j||void 0===j?void 0:j.number);return(0,x.jsxs)(m.A,{direction:"row",gap:"md",children:[(0,x.jsx)(m.A,{style:{flex:2,minWidth:190},direction:"column",align:"stretch",children:(0,y.createElement)(c.A,{...p,key:S,min:i,max:n,units:s,value:b,onChange:e=>{f(e)},style:{minWidth:130},roundStep:t,changeOnBlur:!N})}),(0,x.jsx)(m.A,{direction:"column",align:"stretch",style:{flex:3,...a&&{visibility:"hidden",height:0}},children:(0,x.jsx)(m.A,{direction:"column",align:"stretch",children:(0,x.jsx)(g.A,{max:null===j||void 0===j?void 0:j.number,styles:{track:r&&{backgroundColor:(0,l.Mh)(r,b||"0b")<0?_.colorWarning:void 0}||void 0,rail:{}},step:t,value:N?0:null===k||void 0===k?void 0:k.number,disabled:N,tooltip:{formatter:N?null:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<1?`${(1024*e).toFixed(2)} MiB`:`${e.toFixed(2)} GiB`}},onChange:e=>{null!==A&&void 0!==A&&A.number&&A.number>e?f(i):f(e<1?1024*e+"m":`${e}g`)},marks:(F={...A&&h().isNumber(null===A||void 0===A?void 0:A.number)&&{[A.number]:{style:{color:_.colorTextSecondary},label:0===A.number?A.number:A.number>=1?A.number+"g":1024*A.number+"m"}},...h().omitBy(u,((e,i)=>!!h().isNumber(null===j||void 0===j?void 0:j.number)&&h().parseInt(i)>(null===j||void 0===j?void 0:j.number))),...(null===j||void 0===j?void 0:j.number)&&{[j.number]:{style:{color:_.colorTextSecondary},label:0===j.number?j.number:j.number>=1?j.number+"g":1024*j.number+"m"}}},h().omitBy({...F},((e,i)=>{const n=parseFloat(i);return A&&j&&((null===A||void 0===A?void 0:A.number)>n||(null===j||void 0===j?void 0:j.number)<n)})))})})})]});var F};var f,_=n(74019),A=n(41618),j=n(76604),k=n(96301),S=n(74539),P=n(88319),N=n(69056),F=n(33789),w=n(56762),C=n(88522);const M=e=>{let{allocatablePresetNames:i,showCustom:s,showMinimumRequired:u,...a}=e;const[t,c]=(0,o.Tw)("first"),{run:g}=(0,P.A)(c,{wait:3e3,trailing:!1,leading:!0}),[p]=(0,r.bL)(),{t:b}=(0,w.Bd)(),{token:_}=v.A.useToken(),[A,M]=(0,y.useTransition)(),[V,E]=(0,d.A)(a),{resource_presets:R}=(0,C.useLazyLoadQuery)(void 0!==f?f:f=n(76409),{},{fetchKey:t,fetchPolicy:"first"===t?"store-and-network":"network-only"});return(0,x.jsx)(N.A,{loading:A,options:[...s?[{value:"custom",label:(0,x.jsxs)(m.A,{gap:"xs",style:{display:"inline-flex"},children:[(0,x.jsx)(k.A,{})," ",b("session.launcher.CustomAllocation")]}),selectedLabel:b("session.launcher.CustomAllocation")}]:[],...u?[{value:"minimum-required",label:(0,x.jsxs)(m.A,{gap:"xs",children:[b("session.launcher.MiniumAllocation"),(0,x.jsx)(F.A,{title:b("session.launcher.MiniumAllocationTooltip"),children:(0,x.jsx)(S.A,{style:{color:_.colorTextSecondary}})})]}),selectedLabel:b("session.launcher.MiniumAllocation")}]:[],{label:"Preset",options:h().map(R,((e,n)=>{const l=JSON.parse(null===e||void 0===e?void 0:e.resource_slots),o=i?!i.includes((null===e||void 0===e?void 0:e.name)||""):void 0;return{value:null===e||void 0===e?void 0:e.name,label:(0,x.jsxs)(m.A,{direction:"row",justify:"between",gap:"xs",children:[null===e||void 0===e?void 0:e.name,(0,x.jsx)(m.A,{direction:"row",gap:"xxs",style:{},children:h().map(h().omitBy(l,((e,i)=>h().isEmpty(p[i]))),((e,i)=>(0,x.jsx)(j.A,{type:i,value:e,hideTooltip:!0},i)))})]}),preset:e,disabled:o}})).sort(((e,i)=>e.disabled===i.disabled?0:e.disabled?1:-1)).sort(((e,i)=>(0,l._f)(e.value,i.value)))}],showSearch:!0,...a,value:V,onChange:E,optionLabelProp:h().includes(["custom","minimum-required"],V)?"selectedLabel":"label",onDropdownVisibleChange:e=>{a.onDropdownVisibleChange&&a.onDropdownVisibleChange(e),e&&M((()=>{g()}))}})};var V=n(31897),E=n(23702),R=n(55368),I=n(15480),T=n(96799),K=n(98038),q=n(52932),$=n(2293);const z="64m",B={resource:{cpu:0,mem:"0g",shmem:"0g",accelerator:0},num_of_sessions:1,cluster_mode:"single-node",cluster_size:1,enabledAutomaticShmem:!0},L=(e,i)=>e>=i,U=e=>{let{enableNumOfSessions:i,enableResourcePresets:n,forceImageMinValues:d=!1,showRemainingWarning:c=!1}=e;const g=E.A.useFormInstance(),{t:p}=(0,w.Bd)(),{token:f}=v.A.useToken(),j=(0,o.CX)(),[{keypairResourcePolicy:k,sessionLimitAndRemaining:S}]=(0,s.y)(),P=(0,u.hd)(),F=(0,u.Nw)(),C=E.A.useWatch(["environments","image"],{form:g,preserve:!0}),V=E.A.useWatch(["allocationPreset"],{form:g,preserve:!0}),[{currentImageMinM:B,remaining:U,resourceLimits:Q,checkPresetInfo:W}]=(0,t.y)({currentProjectName:P.name,currentResourceGroup:F||void 0,currentImage:C}),{mergedResourceSlots:O,resourceSlotsInRG:G}=(0,r.Hv)(F||void 0),X=h().omitBy(G,((e,i)=>{var n,l;return!!["cpu","mem","shmem"].includes(i)||(null===(n=Q.accelerators[i])||void 0===n||!n.max||0===(null===(l=Q.accelerators[i])||void 0===l?void 0:l.max))})),H=(0,y.useMemo)((()=>h().filter(null===C||void 0===C?void 0:C.resource_limits,(e=>!!e&&!h().includes(["cpu","mem","shmem"],e.key)))),[null===C||void 0===C?void 0:C.resource_limits]),Z={min:1,max:S.max,remaining:S.remaining},Y=(0,y.useMemo)((()=>J(null===W||void 0===W?void 0:W.presets,Q,C)),[null===W||void 0===W?void 0:W.presets,Q,C]),ee=(0,a.E)((()=>{const e=g.getFieldValue(["resource","acceleratorType"]),i=X[e]?e:h().keys(X)[0];g.setFieldsValue({resource:{acceleratorType:i||e}})})),ie=(0,a.E)((()=>{if(h().includes(["custom","minimum-required"],g.getFieldValue("allocationPreset")));else if(Y.includes(g.getFieldValue("allocationPreset")));else if(n&&Y[0]){const e=h().sortBy(Y)[0];g.setFieldsValue({allocationPreset:e}),le(e)}else g.setFieldsValue({allocationPreset:"custom"});ee(),g.validateFields(["resource"],{recursive:!0}).catch((()=>{}))}));(0,y.useEffect)((()=>{"auto-select"===V&&F&&ie()}),[F,ie,V]),(0,y.useEffect)((()=>{F&&ie()}),[F,ie,C]);const ne=e=>{var i,n,o,r,s,u;const a={cpu:null===(i=Q.cpu)||void 0===i?void 0:i.min,mem:(null===(n=(0,l.Js)(((null===(o=(0,l.Js)(null===(r=Q.shmem)||void 0===r?void 0:r.min,"m"))||void 0===o?void 0:o.number)||0)+((null===(s=(0,l.Js)(null===(u=Q.mem)||void 0===u?void 0:u.min,"m"))||void 0===s?void 0:s.number)||0)+"m","g"))||void 0===n?void 0:n.number)+"g"};if(H.length>0)if(h().find(H,(e=>(null===e||void 0===e?void 0:e.key)===g.getFieldValue(["resource","acceleratorType"])))){var t;a.acceleratorType=g.getFieldValue(["resource","acceleratorType"]),a.accelerator=null===(t=Q.accelerators[g.getFieldValue(["resource","acceleratorType"])])||void 0===t?void 0:t.min}else{var c;const e=null===(c=h().filter(H,(e=>h().keys(G).includes(null===e||void 0===e?void 0:e.key)))[0])||void 0===c?void 0:c.key;var m;if(e)a.accelerator=null===(m=Q.accelerators[e])||void 0===m?void 0:m.min,a.acceleratorType=e}else a.accelerator=0;d||e||(["cpu","accelerator"].forEach((e=>{const i=a[e];h().isNumber(i)&&i<g.getFieldValue(["resource",e])&&delete a[e]})),["mem","shmem"].forEach((e=>{const i=a[e];h().isString(i)&&(0,l.Mh)(i,g.getFieldValue(["resource",e]))<0&&delete a[e]}))),g.setFieldsValue({resource:{...a}}),C&&0===H.length&&g.setFieldValue(["resource","accelerator"],0),g.getFieldValue("enabledAutomaticShmem")&&oe(g.getFieldValue(["resource","mem"])||"0g"),g.validateFields(["resource"],{recursive:!0}).catch((()=>{}))};(0,y.useEffect)((()=>{ne()}),[C]);const le=e=>{var i,n;const o=h().find(null===W||void 0===W?void 0:W.presets,(i=>i.name===e)),r=h().pick(null===o||void 0===o?void 0:o.resource_slots,h().keys(G)),s=null===(i=(0,l.Js)(((null===r||void 0===r?void 0:r.mem)||0)+"b","g",2))||void 0===i?void 0:i.numberUnit,u=h().omit(r,["cpu","mem","shmem"]),a=h().find(h().keys(X),(e=>void 0!==u[e]));let t={accelerator:0};a&&(t={acceleratorType:a,accelerator:Number(u[a]||0)}),g.setFieldsValue({resource:{...t,mem:s,shmem:null===(n=(0,l.Js)(((null===o||void 0===o?void 0:o.shared_memory)||0)+"b","g",2))||void 0===n?void 0:n.numberUnit,cpu:parseInt((null===r||void 0===r?void 0:r.cpu)||"0")||0}}),oe(s||"0g"),g.validateFields(["resource"],{recursive:!0}).catch((()=>{}))},oe=e=>{(0,l.Mh)(e,"4g")>=0&&(0,l.Mh)(e,(0,l.sL)(B,"1g")||"0b")>=0&&(0,l.Mh)("1g",z)>0?g.setFieldValue(["resource","shmem"],"1g"):g.setFieldValue(["resource","shmem"],z)};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(E.A.Item,{name:"resourceGroup",label:p("session.ResourceGroup"),rules:[{required:!0}],children:(0,x.jsx)(A.A,{projectName:P.name,showSearch:!0})}),n?(0,x.jsx)(E.A.Item,{label:p("resourcePreset.ResourcePresets"),name:"allocationPreset",required:!0,style:{marginBottom:f.marginXS},children:(0,x.jsx)(M,{showCustom:j._config.allowCustomResourceAllocation,showMinimumRequired:j._config.allowCustomResourceAllocation,onChange:(e,i)=>{switch(e){case"custom":break;case"minimum-required":g.setFieldValue("enabledAutomaticShmem",!0),ne(!0);break;default:g.setFieldValue("enabledAutomaticShmem",!0),le(e)}},allocatablePresetNames:Y})}):null,(0,x.jsx)(R.A,{style:{marginBottom:f.margin,display:j._config.allowCustomResourceAllocation?"block":"none"},children:(0,x.jsx)(E.A.Item,{shouldUpdate:(e,i)=>e.allocationPreset!==i.allocationPreset,noStyle:!0,children:e=>{var i,n,o,r,s,u,a,t,d,v,y,A;let{getFieldValue:j}=e;return(0,x.jsxs)(x.Fragment,{children:[(null===G||void 0===G?void 0:G.cpu)&&(0,x.jsx)(E.A.Item,{name:["resource","cpu"],label:(null===O||void 0===O||null===(i=O.cpu)||void 0===i?void 0:i.human_readable_name)||"CPU",tooltip:{placement:"right",title:(0,x.jsx)(w.x6,{i18nKey:"session.launcher.DescCPU"})},required:!0,rules:[{required:!0},{type:"number",min:null===(n=Q.cpu)||void 0===n?void 0:n.min},{type:"number",max:null===(o=Q.cpu)||void 0===o?void 0:o.max},{warningOnly:!0,validator:async(e,i)=>{var n,l,o,r;return h().isNumber(null===(n=Q.cpu)||void 0===n?void 0:n.min)&&h().isNumber(null===(l=Q.cpu)||void 0===l?void 0:l.max)&&L(null===(o=Q.cpu)||void 0===o?void 0:o.min,null===(r=Q.cpu)||void 0===r?void 0:r.max)?Promise.reject(p("session.launcher.InsufficientAllocationOfResourcesWarning")):c&&h().isNumber(U.cpu)&&i>U.cpu?Promise.reject(p("session.launcher.EnqueueComputeSessionWarning")):Promise.resolve()}}],children:(0,x.jsx)(_.A,{inputNumberProps:{addonAfter:(null===O||void 0===O||null===(r=O.cpu)||void 0===r?void 0:r.display_unit)||p("session.launcher.Core")},sliderProps:{marks:{...U.cpu?{[U.cpu]:{label:(0,x.jsx)(D,{})}}:{},...null!==(s=Q.cpu)&&void 0!==s&&s.min?{[null===(u=Q.cpu)||void 0===u?void 0:u.min]:null===(a=Q.cpu)||void 0===a?void 0:a.min}:{},...null!==(t=Q.cpu)&&void 0!==t&&t.max?{[null===(d=Q.cpu)||void 0===d?void 0:d.max]:{style:{color:f.colorTextSecondary},label:null===(v=Q.cpu)||void 0===v?void 0:v.max}}:{}}},min:null===(y=Q.cpu)||void 0===y?void 0:y.min,max:null===(A=Q.cpu)||void 0===A?void 0:A.max,step:1,onChange:()=>{g.setFieldValue("allocationPreset","custom")}})}),(null===G||void 0===G?void 0:G.mem)&&(0,x.jsxs)(E.A.Item,{label:p("session.launcher.Memory"),tooltip:{placement:"right",props:{onClick:e=>e.preventDefault()},title:(0,x.jsx)(m.A,{direction:"column",onClick:e=>e.preventDefault(),children:(0,x.jsx)(w.x6,{i18nKey:"session.launcher.DescMemory"})})},required:!0,children:[(0,x.jsx)(E.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.resource.shmem!==i.resource.shmem,children:()=>{var e,i,n;return(0,x.jsx)(E.A.Item,{name:["resource","mem"],noStyle:!0,rules:[{required:!0},{validator:async(e,i)=>{var n,o,r;return h().isString(i)&&null!==(n=Q.mem)&&void 0!==n&&n.max&&(0,l.Mh)(i,null===(o=Q.mem)||void 0===o?void 0:o.max)>0?Promise.reject(p("general.MaxValueNotification",{name:p("session.launcher.Memory"),max:h().toUpper((null===(r=Q.mem)||void 0===r?void 0:r.max)||"0g")+"iB"})):Promise.resolve()}},{validator:async(e,i)=>{var n,o,r;return!h().isElement(i)&&null!==(n=Q.mem)&&void 0!==n&&n.min&&(0,l.Mh)(i,(null===(o=Q.mem)||void 0===o?void 0:o.min)||"0g")<0?Promise.reject(p("session.launcher.MinMemory",{size:h().toUpper((null===(r=Q.mem)||void 0===r?void 0:r.min)||"0g")})):Promise.resolve()}},{warningOnly:!0,validator:async(e,i)=>{var n,o;return(0,l.Mh)(null===(n=Q.mem)||void 0===n?void 0:n.min,null===(o=Q.mem)||void 0===o?void 0:o.max)>0?Promise.reject(p("session.launcher.InsufficientAllocationOfResourcesWarning")):c&&!h().isElement(i)&&Q.mem&&(0,l.Mh)(i,U.mem+"b")>0?Promise.reject(p("session.launcher.EnqueueComputeSessionWarning")):Promise.resolve()}}],children:(0,x.jsx)(b,{max:null===(e=Q.mem)||void 0===e?void 0:e.max,min:null===(i=Q.mem)||void 0===i?void 0:i.min,addonBefore:"MEM",extraMarks:{...U.mem?{[null===(n=(0,l.Js)(U.mem+"b","g",3))||void 0===n?void 0:n.numberFixed]:{label:(0,x.jsx)(D,{})}}:{}},onChange:e=>{e&&g.getFieldValue("enabledAutomaticShmem")&&(oe(e),g.setFieldValue("allocationPreset","custom"))}})})}}),(0,x.jsxs)(m.A,{direction:"column",gap:"xxs",align:"start",children:[(0,x.jsxs)(m.A,{direction:"row",gap:"xs",children:[p("session.launcher.EnableAutomaticMiniumShmem")," ",(0,x.jsx)(E.A.Item,{noStyle:!0,name:"enabledAutomaticShmem",valuePropName:"checked",children:(0,x.jsx)(I.A,{size:"small",onChange:e=>{e&&oe(g.getFieldValue(["resource","mem"])||"0g"),g.setFieldValue("allocationPreset","custom")}})})]}),(0,x.jsx)(E.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.resource.mem!==i.resource.mem||e.enabledAutomaticShmem!==i.enabledAutomaticShmem,children:()=>{var e;return(0,x.jsx)(E.A.Item,{noStyle:!0,name:["resource","shmem"],hidden:g.getFieldValue("enabledAutomaticShmem"),tooltip:(0,x.jsx)(w.x6,{i18nKey:"session.launcher.DescSharedMemory"}),dependencies:[["resource","mem"]],rules:[{required:!0},{},{validator:async(e,i)=>{var n,o;if(h().isEmpty(null===(n=j("resource"))||void 0===n?void 0:n.mem)||h().isEmpty(i)||(0,l.Mh)(null===(o=j("resource"))||void 0===o?void 0:o.mem,i)>=0)return Promise.resolve();throw p("resourcePreset.SHMEMShouldBeSmallerThanMemory")}}],children:(0,x.jsx)(b,{min:null===(e=Q.shmem)||void 0===e?void 0:e.min,addonBefore:"SHM",max:g.getFieldValue(["resource","mem"])||"0g",hideSlider:!0,onChange:()=>{g.setFieldValue("allocationPreset","custom")}})})}})]})]}),(0,x.jsx)(E.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>{var n,l;return(null===(n=e.resource)||void 0===n?void 0:n.acceleratorType)!==(null===(l=i.resource)||void 0===l?void 0:l.acceleratorType)||e.cluster_size!==i.cluster_size},children:e=>{var i,n,l,o,r,s;let{getFieldValue:u}=e;const a=u(["resource","acceleratorType"]);return(0,x.jsx)(E.A.Item,{name:["resource","accelerator"],label:p("session.launcher.AIAccelerator"),tooltip:{placement:"right",title:(0,x.jsx)(w.x6,{i18nKey:"session.launcher.DescAIAccelerator"})},rules:[{required:H.length>0},{type:"number",min:(null===(i=Q.accelerators[a])||void 0===i?void 0:i.min)||0,max:null===(n=Q.accelerators[a])||void 0===n?void 0:n.max},{validator:async(e,i)=>h().endsWith(a,"shares")&&g.getFieldValue("cluster_size")>=2&&i%1!==0?Promise.reject(p("session.launcher.OnlyAllowsDiscreteNumberByClusterSize")):Promise.resolve()},{warningOnly:!0,validator:async(e,i)=>{var n,l,o,r;return h().isNumber(null===(n=Q.accelerators[a])||void 0===n?void 0:n.min)&&h().isNumber(null===(l=Q.accelerators[a])||void 0===l?void 0:l.max)&&L(null===(o=Q.accelerators[a])||void 0===o?void 0:o.min,null===(r=Q.accelerators[a])||void 0===r?void 0:r.max)?Promise.reject(p("session.launcher.InsufficientAllocationOfResourcesWarning")):c&&h().isNumber(U.accelerators[a])&&i>U.accelerators[a]?Promise.reject(p("session.launcher.EnqueueComputeSessionWarning")):Promise.resolve()}}],children:(0,x.jsx)(_.A,{sliderProps:{marks:{0:0,...U.accelerators[a]?{[U.accelerators[a]]:{label:(0,x.jsx)(D,{})}}:{},...h().isNumber(null===(l=Q.accelerators[a])||void 0===l?void 0:l.max)?{[null===(o=Q.accelerators[a])||void 0===o?void 0:o.max]:null===(r=Q.accelerators[a])||void 0===r?void 0:r.max}:{}},tooltip:{formatter:function(){var e;return`${arguments.length>0&&void 0!==arguments[0]?arguments[0]:0} ${(null===O||void 0===O||null===(e=O[a])||void 0===e?void 0:e.display_unit)||""}`},open:!(H.length<=0)&&void 0}},disabled:0===H.length&&h().isEmpty(g.getFieldValue(["environments","manual"])),min:0,max:null===(s=Q.accelerators[a])||void 0===s?void 0:s.max,step:h().endsWith(a,"shares")&&g.getFieldValue("cluster_size")<2?.1:1,onChange:()=>{g.setFieldValue("allocationPreset","custom")},inputNumberProps:{addonAfter:(0,x.jsx)(E.A.Item,{noStyle:!0,name:["resource","acceleratorType"],initialValue:h().keys(X)[0],children:(0,x.jsx)(N.A,{tabIndex:-1,disabled:0===H.length&&h().isEmpty(g.getFieldValue(["environments","manual"])),suffixIcon:h().size(X)>1?void 0:null,popupMatchSelectWidth:!1,options:h().map(X,((e,i)=>{var n;return{value:i,label:(null===O||void 0===O||null===(n=O[i])||void 0===n?void 0:n.display_unit)||"UNIT",disabled:H.length>0&&!h().find(H,(e=>(null===e||void 0===e?void 0:e.key)===i))}}))})})}})})}})]})}})}),i?(0,x.jsx)(R.A,{style:{marginBottom:f.margin},children:(0,x.jsx)(E.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.cluster_size!==i.cluster_size,children:()=>(0,x.jsx)(E.A.Item,{name:["num_of_sessions"],label:p("webui.menu.Sessions"),tooltip:(0,x.jsx)(w.x6,{i18nKey:"session.launcher.DescSession"}),required:!0,rules:[{required:!0},{warningOnly:!0,validator:async(e,i)=>c&&Z&&i>Z.remaining?Promise.reject(p("session.launcher.EnqueueComputeSessionWarning")):Promise.resolve()}],children:(0,x.jsx)(_.A,{inputNumberProps:{addonAfter:"#"},disabled:g.getFieldValue("cluster_size")>1,sliderProps:{marks:{[null===Z||void 0===Z?void 0:Z.min]:null===Z||void 0===Z?void 0:Z.min,...null!==Z&&void 0!==Z&&Z.remaining?{[null===Z||void 0===Z?void 0:Z.remaining]:{label:(0,x.jsx)(D,{})}}:{},[null===Z||void 0===Z?void 0:Z.max]:null===Z||void 0===Z?void 0:Z.max}},min:null===Z||void 0===Z?void 0:Z.min,max:null===Z||void 0===Z?void 0:Z.max})})})}):null,j.supports("multi-container")&&(0,x.jsx)(E.A.Item,{label:p("session.launcher.ClusterMode"),tooltip:(0,x.jsxs)(m.A,{direction:"column",align:"start",children:[p("session.launcher.SingleNode"),(0,x.jsx)(w.x6,{i18nKey:"session.launcher.DescSingleNode"}),(0,x.jsx)(T.A,{style:{backgroundColor:f.colorBorder}}),p("session.launcher.MultiNode"),(0,x.jsx)(w.x6,{i18nKey:"session.launcher.DescMultiNode"})]}),required:!0,children:(0,x.jsx)(R.A,{style:{marginBottom:f.margin},children:(0,x.jsxs)(K.A,{gutter:f.marginMD,children:[(0,x.jsx)(q.A,{xs:24,children:(0,x.jsx)(E.A.Item,{name:"cluster_mode",required:!0,children:(0,x.jsxs)($.Ay.Group,{onChange:e=>{g.validateFields().catch((()=>{}))},children:[(0,x.jsx)($.Ay.Button,{value:"single-node",children:p("session.launcher.SingleNode")}),(0,x.jsx)($.Ay.Button,{value:"multi-node",children:p("session.launcher.MultiNode")})]})})}),(0,x.jsx)(q.A,{xs:24,children:(0,x.jsx)(E.A.Item,{noStyle:!0,shouldUpdate:(e,i)=>e.cluster_mode!==i.cluster_mode,children:()=>{var e;const i=h().min([null===(e=Q.cpu)||void 0===e?void 0:e.max,k.max_containers_per_session]),n="single-node"===g.getFieldValue("cluster_mode")?p("session.launcher.Container"):p("session.launcher.Node");return(0,x.jsx)(E.A.Item,{name:"cluster_size",label:p("session.launcher.ClusterSize"),required:!0,rules:[{warningOnly:!0,validator:async(e,i)=>{if(c){const e=h().min([U.cpu,k.max_containers_per_session]);if(h().isNumber(e)&&i>e)return Promise.reject(p("session.launcher.EnqueueComputeSessionWarning"))}return Promise.resolve()}}],children:(0,x.jsx)(_.A,{min:1,step:1,max:h().isNumber(i)?i:void 0,disabled:1===i,sliderProps:{marks:{1:"1",...U.cpu?{[U.cpu]:{label:(0,x.jsx)(D,{})}}:{},...h().isNumber(i)?{[i]:i}:{}},tooltip:{formatter:function(){return`${arguments.length>0&&void 0!==arguments[0]?arguments[0]:0} ${n}`}}},inputNumberProps:{addonAfter:n},onChange:e=>{e>1&&g.setFieldValue("num_of_sessions",1)}})})}})})]})})})]})},D=()=>{const{token:e}=v.A.useToken();return(0,x.jsx)(m.A,{style:{position:"absolute",top:-24,transform:"translateX(-50%)",color:e.colorSuccess,opacity:.5},children:(0,x.jsx)(V.A,{})})},Q=y.memo(U),J=(e,i,n)=>{const o=h().filter(null===n||void 0===n?void 0:n.resource_limits,(e=>!!e&&!h().includes(["cpu","mem","shmem"],e.key))),r=h().filter(e,(e=>h().every(e.resource_slots,((n,o)=>{if("mem"===o){var r,s,u;return!!("string"!==typeof(null===(r=i[o])||void 0===r?void 0:r.max))||"string"===typeof e.resource_slots[o]&&"string"===typeof(null===(s=i[o])||void 0===s?void 0:s.max)&&(0,l.Mh)(e.resource_slots[o],null===(u=i[o])||void 0===u?void 0:u.max)<=0}if("shmem"===o)return!0;if("cpu"===o){var a,t;return!!h().isNaN(h().toNumber(null===(a=i[o])||void 0===a?void 0:a.max))||(h().toNumber(e.resource_slots[o])||0)<=h().toNumber(null===(t=i[o])||void 0===t?void 0:t.max)}var d,c;return!!h().isNaN(h().toNumber(null===(d=i.accelerators[o])||void 0===d?void 0:d.max))||(h().toNumber(e.resource_slots[o])||0)<=h().toNumber(null===(c=i.accelerators[o])||void 0===c?void 0:c.max)})))).map((e=>e.name)),s=h().filter(e,(e=>{const i=h().omitBy(e.resource_slots,((e,i)=>{if(["mem","cpu","shmem"].includes(i))return!0}));return 0===o.length?!!h().isEmpty(i):h().some(o,(e=>(null===e||void 0===e?void 0:e.key)&&i[null===e||void 0===e?void 0:e.key]&&h().toNumber(i[null===e||void 0===e?void 0:e.key])>=h().toNumber(null===e||void 0===e?void 0:e.min)))})).map((e=>e.name));return 0===o.length?r:h().intersection(r,s)}},41618:(e,i,n)=>{n.d(i,{A:()=>v});var l=n(58879),o=n(51593),r=n(60881),s=n(7194),u=n(6597),a=n(69056),t=n(89608),d=n.n(t),c=n(43373),m=n(73689);const v=e=>{let{projectName:i,autoSelectDefault:n,filter:t,searchValue:v,onSearch:g,loading:p,...h}=e;const y=(0,l.QE)(),[x]=(0,o.Tw)("first"),[b,f]=(0,s.A)({value:v,onChange:g}),[_,A]=(0,s.A)(h),{data:j}=(0,r.nj)({queryKey:["ResourceGroupSelectQuery",i],queryFn:()=>{const e=new URLSearchParams;return e.set("group",i),Promise.all([y({method:"GET",url:`/scaling-groups?${e.toString()}`}),y({method:"GET",url:"/folders/_/hosts"})])},staleTime:0,fetchKey:x}),k=d().flatMap(null===j||void 0===j?void 0:j[1].volume_info,(e=>{var i;return null!==(i=null===e||void 0===e?void 0:e.sftp_scaling_groups)&&void 0!==i?i:[]})),S=d().filter(null===j||void 0===j?void 0:j[0].scaling_groups,(e=>!d().includes(k,e.name)&&(!t||t(e.name))));(0,c.useEffect)((()=>{_&&!d().some(S,(e=>e.name===_))&&A(void 0)}),[S,_,A]);const P=d().find(S,(e=>"default"===e.name))||S[0],N=P?{label:P.name,value:P.name}:void 0;(0,c.useEffect)((()=>{n&&N&&N.value!==h.value&&A(N.value,N)}),[n]);const F=h.showSearch?{onSearch:f,searchValue:b,showSearch:!0}:{};return(0,m.jsx)(a.A,{defaultActiveFirstOption:!0,...F,defaultValue:n?N:void 0,onDropdownVisibleChange:e=>{},loading:p,options:d().map(S,(e=>({value:e.name,label:e.name}))),optionRender:e=>{var i;return(0,m.jsx)(u.A,{keyword:b,children:null===(i=e.data.value)||void 0===i?void 0:i.toString()})},...h,value:_,onChange:A})}},76604:(e,i,n)=>{n.d(i,{A:()=>x,s:()=>y});var l=n(58879),o=n(11899),r=n(15634),s=n(89130),u=n(50868),a=n(85690),t=n(33789),d=n(89608),c=n.n(d),m=n(8652),v=n(43373),g=n(73689);const p=e=>{var i,n;let{type:t,value:d,extra:m,opts:v,hideTooltip:p=!1,max:h}=e;const{token:x}=u.A.useToken(),b=(0,r.Nw)(),{mergedResourceSlots:f}=(0,o.Hv)(b||void 0),_=e=>{var i,n,o;return null!==f&&void 0!==f&&null!==(i=f[t])&&void 0!==i&&i.number_format.binary?Number(null===(n=(0,l.Js)(e,"g",3,!0))||void 0===n?void 0:n.numberFixed).toString():((null===f||void 0===f||null===(o=f[t])||void 0===o?void 0:o.number_format.round_length)||0)>0?parseFloat(e).toFixed(2):e};return(0,g.jsxs)(s.A,{direction:"row",gap:"xxs",children:[null!==f&&void 0!==f&&f[t]?(0,g.jsx)(y,{type:t,showTooltip:!p}):t,(0,g.jsxs)(a.A.Text,{children:[_(d),c().isUndefined(h)?null:"Infinity"===h?"~\u221e":`~${_(h)}`]}),(0,g.jsx)(a.A.Text,{type:"secondary",children:(null===f||void 0===f||null===(i=f[t])||void 0===i?void 0:i.display_unit)||""}),"mem"===t&&null!==v&&void 0!==v&&v.shmem&&(null===v||void 0===v?void 0:v.shmem)>0?(0,g.jsxs)(a.A.Text,{type:"secondary",style:{fontSize:x.fontSizeSM},children:["(SHM: ",null===(n=(0,l.Js)(v.shmem+"b","g",2,!0))||void 0===n?void 0:n.numberFixed,"GiB)"]}):null,m]})},h=e=>{let{size:i=16,children:n}=e;return(0,g.jsx)("mwc-icon",{style:{"--mdc-icon-size":`${i+2}px`,width:i,height:i},children:n})},y=e=>{var i;let{type:n,size:l=16,showIcon:o=!0,showUnit:r=!0,showTooltip:u=!0,...a}=e;const d={cpu:(0,g.jsx)(h,{size:l,children:"developer_board"}),mem:(0,g.jsx)(h,{size:l,children:"memory"}),"cuda.device":"/resources/icons/file_type_cuda.svg","cuda.shares":"/resources/icons/file_type_cuda.svg","rocm.device":"/resources/icons/rocm.svg","tpu.device":(0,g.jsx)(h,{size:l,children:"view_module"}),"ipu.device":(0,g.jsx)(h,{size:l,children:"view_module"}),"atom.device":"/resources/icons/rebel.svg","atom-plus.device":"/resources/icons/rebel.svg","gaudi2.device":"/resources/icons/gaudi.svg","warboy.device":"/resources/icons/furiosa.svg","hyperaccel-lpu.device":"/resources/icons/npu_generic.svg"},c=null!==(i=d[n])&&void 0!==i?i:(0,g.jsx)(m.A,{}),v="string"===typeof c?(0,g.jsx)("img",{...a,style:{height:l,alignSelf:"center",...a.style||{}},src:d[n]||"",alt:n}):(0,g.jsx)(s.A,{style:{width:16,height:16},children:c||n});return u?(0,g.jsx)(t.A,{title:n,children:v}):(0,g.jsx)(s.A,{style:{pointerEvents:"none"},children:v})},x=v.memo(p)},76409:(e,i,n)=>{n.r(i),n.d(i,{default:()=>o});const l=function(){var e=[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetSelectQuery",selections:e,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ResourcePresetSelectQuery",selections:e},params:{cacheID:"bd89430b9924d926a1b8e91191746b4f",id:null,metadata:{},name:"ResourcePresetSelectQuery",operationKind:"query",text:"query ResourcePresetSelectQuery {\n  resource_presets {\n    name\n    resource_slots\n    shared_memory\n  }\n}\n"}}}();l.hash="9841642e96d89476c2848bfb093ed9c5";const o=l},60157:(e,i,n)=>{n.d(i,{o:()=>l,z:()=>o});const l=1e6,o=1e6},8157:(e,i,n)=>{n.r(i),n.d(i,{default:()=>o});const l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"accessKey"}],i=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"accessKey"}],concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"concurrency_used",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairQuery",selections:i,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairQuery",selections:i},params:{cacheID:"1f8fc324e9907111de581f5cd2dc3640",id:null,metadata:{},name:"hooksUsingRelay_KeyPairQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairQuery(\n  $accessKey: String!\n) {\n  keypair(access_key: $accessKey) {\n    id\n    resource_policy\n    concurrency_used\n  }\n}\n"}}}();l.hash="d8f5c91f0fc46a3366f57566ab688d81";const o=l},48387:(e,i,n)=>{n.r(i),n.d(i,{default:()=>o});const l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],i=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:i,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:i},params:{cacheID:"ad7039c1935637fe3f3841f0ea8bf347",id:null,metadata:{},name:"hooksUsingRelay_KeyPairResourcePolicyQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairResourcePolicyQuery(\n  $name: String!\n) {\n  keypair_resource_policy(name: $name) {\n    max_containers_per_session\n    max_concurrent_sessions\n  }\n}\n"}}}();l.hash="f3f7364c63aefe9b03111b584c48c103";const o=l},68190:(e,i,n)=>{n.d(i,{x:()=>c,y:()=>m});var l,o,r=n(51593),s=n(60157),u=n(89608),a=n.n(u),t=n(43373),d=n(88522);const c=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchPolicy:"store-and-network"};const[o,s]=(0,r.Tw)("first"),{keypair:u}=(0,d.useLazyLoadQuery)(void 0!==l?l:l=n(8157),{accessKey:e},{...i,fetchKey:o+i.fetchKey});return[u,{refresh:(0,t.useCallback)((()=>{s()}),[s])}]},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fetchPolicy:"store-and-network"};const[i,l]=(0,r.Tw)("first"),u=(0,r.CX)(),[m]=c(null===u||void 0===u?void 0:u._config.accessKey),{keypair_resource_policy:v}=(0,d.useLazyLoadQuery)(void 0!==o?o:o=n(48387),{name:(null===m||void 0===m?void 0:m.resource_policy)||""},{...e,fetchKey:i+e.fetchKey}),g=(0,t.useCallback)((()=>{l()}),[l]);return[{keypairResourcePolicy:v||{},keypair:m||{},sessionLimitAndRemaining:{max:a().min([(v||{}).max_concurrent_sessions||s.z,3]),remaining:((v||{}).max_concurrent_sessions||3)-((m||{}).concurrency_used||0)}},{refresh:g}]}},9194:(e,i,n)=>{n.d(i,{y:()=>m});var l=n(51593),o=n(39428),r=n(58879),s=n(11899),u=n(60881),a=n(89608),t=n.n(a),d=n(43373);const c=/^max([A-Za-z0-9]+)PerContainer$/,m=e=>{var i,n,a,m,g,p,h,y,x,b,f,_,A,j,k,S,P,N,F,w,C;let{currentImage:M,currentResourceGroup:V="",currentProjectName:E,ignorePerContainerConfig:R=!1}=e;const I=(0,l.CX)(),[T]=(0,s.bL)(),K=t().omit(T,["cpu","mem","shmem"]),{data:q,refetch:$,isRefetching:z}=(0,u.nj)({queryKey:["check-presets",E,V],queryFn:()=>V?I.resourcePreset.check({group:E,scaling_group:V}).catch((()=>{})):void 0,staleTime:1e3}),B=(null===(i=t().find(null===M||void 0===M?void 0:M.resource_limits,(e=>"mem"===(null===e||void 0===e?void 0:e.key))))||void 0===i?void 0:i.min)||"0g",L={cpu:t().isEmpty(null===q||void 0===q||null===(n=q.scaling_groups[V])||void 0===n||null===(a=n.using)||void 0===a?void 0:a.cpu)||t().isEmpty(null===q||void 0===q||null===(m=q.scaling_groups[V])||void 0===m||null===(g=m.remaining)||void 0===g?void 0:g.cpu)?void 0:t().toNumber(null===q||void 0===q||null===(p=q.scaling_groups[V])||void 0===p?void 0:p.using.cpu)+t().toNumber(null===q||void 0===q||null===(h=q.scaling_groups[V])||void 0===h?void 0:h.remaining.cpu),mem:t().isEmpty(null===q||void 0===q||null===(y=q.scaling_groups[V])||void 0===y||null===(x=y.using)||void 0===x?void 0:x.mem)||t().isEmpty(null===q||void 0===q||null===(b=q.scaling_groups[V])||void 0===b||null===(f=b.remaining)||void 0===f?void 0:f.mem)?void 0:(null===(_=(0,r.Js)(t().toNumber(null===q||void 0===q||null===(A=q.scaling_groups[V])||void 0===A?void 0:A.using.mem)+t().toNumber(null===q||void 0===q||null===(j=q.scaling_groups[V])||void 0===j?void 0:j.remaining.mem)+"b","g",2))||void 0===_?void 0:_.numberFixed)+"g",accelerators:t().reduce(K,((e,i,n)=>{var l,o,r,s,u,a;return e[n]=t().isEmpty(null===q||void 0===q||null===(l=q.scaling_groups[V])||void 0===l||null===(o=l.using)||void 0===o?void 0:o[n])||t().isEmpty(null===q||void 0===q||null===(r=q.scaling_groups[V])||void 0===r||null===(s=r.remaining)||void 0===s?void 0:s[n])?void 0:t().toNumber(null===q||void 0===q||null===(u=q.scaling_groups[V])||void 0===u?void 0:u.using[n])+t().toNumber(null===q||void 0===q||null===(a=q.scaling_groups[V])||void 0===a?void 0:a.remaining[n]),e}),{})},U=(0,d.useMemo)((()=>t().omitBy(I._config,((e,i)=>!c.test(i)))),[I._config]);return[{resourceGroupResourceSize:L,resourceLimits:{cpu:void 0===(null===T||void 0===T?void 0:T.cpu)?void 0:{min:t().max([t().toNumber((null===(k=t().find(null===M||void 0===M?void 0:M.resource_limits,(e=>"cpu"===(null===e||void 0===e?void 0:e.key))))||void 0===k?void 0:k.min)||"0")]),max:t().min([R?void 0:I._config.maxCPUCoresPerContainer,v(null===q||void 0===q?void 0:q.keypair_limits.cpu),v(null===q||void 0===q?void 0:q.group_limits.cpu)])},mem:void 0===(null===T||void 0===T?void 0:T.mem)?void 0:{min:(0,r.sL)(t().max([null===(S=(0,r.Js)(B,"b"))||void 0===S?void 0:S.number,null===(P=(0,r.Js)(o.t2,"b"))||void 0===P?void 0:P.number,0])+"b",o.t2),max:t().min([R?void 0:I._config.maxMemoryPerContainer,v(null===q||void 0===q?void 0:q.keypair_limits.mem)&&(null===(N=(0,r.Js)(v(null===q||void 0===q?void 0:q.keypair_limits.mem)+"","g"))||void 0===N?void 0:N.number),v(null===q||void 0===q?void 0:q.group_limits.mem)&&(null===(F=(0,r.Js)(v(null===q||void 0===q?void 0:q.group_limits.mem)+"","g"))||void 0===F?void 0:F.number)])+"g"},accelerators:t().reduce(K,((e,i,n)=>{var l,o,r;const s=null!==(l=t().find(U,((e,i)=>((e,i)=>{const n=e.match(c);if(n){const e=n[1].toLowerCase(),l=i.replaceAll(/[.-]/g,"").toLowerCase();return e===l||e===l+"s"}return!1})(i,n))))&&void 0!==l?l:I._config["cuda.device"];return e[n]={min:parseInt((null===(o=t().filter(null===M||void 0===M?void 0:M.resource_limits,(e=>(null===e||void 0===e?void 0:e.key)===n)))||void 0===o||null===(r=o[0])||void 0===r?void 0:r.min)||"0"),max:t().min([s||8,v(null===q||void 0===q?void 0:q.keypair_limits[n]),v(null===q||void 0===q?void 0:q.group_limits[n])])},e}),{})},remaining:{accelerators:t().reduce(K,((e,i,n)=>{var l;return e[n]=null!==(l=t().min([t().toNumber(null===q||void 0===q?void 0:q.keypair_remaining[n]),t().toNumber(null===q||void 0===q?void 0:q.group_remaining[n]),t().toNumber(null===q||void 0===q?void 0:q.scaling_group_remaining[n])]))&&void 0!==l?l:Number.MAX_SAFE_INTEGER,e}),{}),cpu:null!==(w=t().min([v(null===q||void 0===q?void 0:q.keypair_remaining.cpu),v(null===q||void 0===q?void 0:q.group_remaining.cpu),v(null===q||void 0===q?void 0:q.scaling_group_remaining.cpu)]))&&void 0!==w?w:Number.MAX_SAFE_INTEGER,mem:null!==(C=t().min([v(null===q||void 0===q?void 0:q.keypair_remaining.mem),v(null===q||void 0===q?void 0:q.group_remaining.mem),v(null===q||void 0===q?void 0:q.scaling_group_remaining.mem)]))&&void 0!==C?C:Number.MAX_SAFE_INTEGER},currentImageMinM:B,isRefetching:z,checkPresetInfo:q},{refetch:$}]},v=e=>void 0===e||"Infinity"===e||"NaN"===e?void 0:t().toNumber(e)}}]);
//# sourceMappingURL=3209.85ef89f4.chunk.js.map