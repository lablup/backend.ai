"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[2451],{71809:(e,l,n)=>{n.r(l),n.d(l,{default:()=>re});var a=n(56276);const i=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpoint_id"},{defaultValue:null,kind:"LocalArgument",name:"props"}],l=[{kind:"Variable",name:"endpoint_id",variableName:"endpoint_id"},{kind:"Variable",name:"props",variableName:"props"}],n={alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"replicas",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"cluster_mode",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"model",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"is_local",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},F={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},b={alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[F,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},K={alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[F,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"size_bytes",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"supported_accelerators",storageKey:null},A={alias:null,args:null,kind:"ScalarField",name:"model_definition_path",storageKey:null},P={alias:null,args:null,kind:"ScalarField",name:"model_mount_destination",storageKey:null},L={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},I={alias:null,args:null,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"extra_mounts",plural:!0,selections:[L,{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},v,{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null},w={alias:null,args:null,concreteType:"RuntimeVariantInfo",kind:"LinkedField",name:"runtime_variant",plural:!1,selections:[v,{alias:null,args:null,kind:"ScalarField",name:"human_readable_name",storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ServiceLauncherPageContentModifyMutation",selections:[{alias:null,args:l,concreteType:"ModifyEndpoint",kind:"LinkedField",name:"modify_endpoint",plural:!1,selections:[n,a,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[i,r,o,s,t,u,d,c,m,g,{alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image_object",plural:!1,selections:[v,p,_,y,h,f,S,k,b,K,x,j],storageKey:null},v,A,P,I,w],storageKey:null}],storageKey:null}],type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ServiceLauncherPageContentModifyMutation",selections:[{alias:null,args:l,concreteType:"ModifyEndpoint",kind:"LinkedField",name:"modify_endpoint",plural:!1,selections:[n,a,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[i,r,o,s,t,u,d,c,m,g,{alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image_object",plural:!1,selections:[v,p,_,y,h,f,S,k,b,K,x,j,L],storageKey:null},v,A,P,I,w,L],storageKey:null}],storageKey:null}]},params:{cacheID:"6e4e20e60305351f47a87be19f8d6a86",id:null,metadata:{},name:"ServiceLauncherPageContentModifyMutation",operationKind:"mutation",text:'mutation ServiceLauncherPageContentModifyMutation(\n  $endpoint_id: UUID!\n  $props: ModifyEndpointInput!\n) {\n  modify_endpoint(endpoint_id: $endpoint_id, props: $props) {\n    ok\n    msg\n    endpoint {\n      endpoint_id\n      desired_session_count @deprecatedSince(version: "24.12.0")\n      replicas @since(version: "24.12.0")\n      resource_group\n      resource_slots\n      resource_opts\n      cluster_mode\n      cluster_size\n      open_to_public\n      model\n      image_object @since(version: "23.09.9") {\n        name @deprecatedSince(version: "24.12.0")\n        namespace @since(version: "24.12.0")\n        humanized_name\n        tag\n        registry\n        architecture\n        is_local\n        digest\n        resource_limits {\n          key\n          min\n          max\n        }\n        labels {\n          key\n          value\n        }\n        size_bytes\n        supported_accelerators\n        id\n      }\n      name\n      model_definition_path @since(version: "24.03.4")\n      model_mount_destination @since(version: "24.03.4")\n      extra_mounts @since(version: "24.03.4") {\n        id\n        host\n        quota_scope_id\n        name\n        user\n        user_email\n        group\n        group_name\n        creator\n        unmanaged_path\n        usage_mode\n        permission\n        ownership_type\n        max_files\n        max_size\n        created_at\n        last_used\n        num_files\n        cur_size\n        cloneable\n        status\n      }\n      runtime_variant @since(version: "24.03.5") {\n        name\n        human_readable_name\n      }\n      id\n    }\n  }\n}\n'}}}();i.hash="a63a50401ffb00cb96aa893c9536b016";const r=i,o=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"user_RP_name"}],l=[{kind:"Variable",name:"name",variableName:"user_RP_name"}],n={alias:null,args:null,kind:"ScalarField",name:"max_session_count_per_model_session",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ServiceLauncherPageContent_UserResourcePolicyQuery",selections:[{alias:null,args:l,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policy",plural:!1,selections:[n],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ServiceLauncherPageContent_UserResourcePolicyQuery",selections:[{alias:null,args:l,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policy",plural:!1,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"9521f8ab6e4190bdffb95e25ce45d8c3",id:null,metadata:{},name:"ServiceLauncherPageContent_UserResourcePolicyQuery",operationKind:"query",text:'query ServiceLauncherPageContent_UserResourcePolicyQuery(\n  $user_RP_name: String\n) {\n  user_resource_policy(name: $user_RP_name) @since(version: "23.09.6") {\n    max_session_count_per_model_session\n    id\n  }\n}\n'}}}();o.hash="2625e741ab935b9160f781d3aba13067";const s=o,t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domain_name"},{defaultValue:null,kind:"LocalArgument",name:"email"}],l=[{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domain_name"},{kind:"Variable",name:"email",variableName:"email"}],concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ServiceLauncherPageContent_UserInfoQuery",selections:l,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ServiceLauncherPageContent_UserInfoQuery",selections:l},params:{cacheID:"bd463b860cd7ab56a302e7f1dc7b2611",id:null,metadata:{},name:"ServiceLauncherPageContent_UserInfoQuery",operationKind:"query",text:'query ServiceLauncherPageContent_UserInfoQuery(\n  $domain_name: String\n  $email: String\n) {\n  user(domain_name: $domain_name, email: $email) {\n    id\n    resource_policy @since(version: "23.09.0")\n  }\n}\n'}}}();t.hash="6c33adac7ab1ae44cf36f91363ec7dbf";const u=t,d=function(){var e={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ServiceLauncherPageContentFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"replicas",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"model",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"model_mount_destination",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"model_definition_path",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"environ",storageKey:null},{alias:null,args:null,concreteType:"RuntimeVariantInfo",kind:"LinkedField",name:"runtime_variant",plural:!1,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"human_readable_name",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"extra_mounts",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},e],storageKey:null},{alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image_object",plural:!1,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_local",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"size_bytes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"supported_accelerators",storageKey:null}],storageKey:null},e],type:"Endpoint",abstractKey:null}}();d.hash="94cbb7504efa704a02c71affc0c33ce8";const c=d;var m=n(48880),g=n(40690),v=n(62378),p=n(81109);const _=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},l={defaultValue:null,kind:"LocalArgument",name:"limit"},n={defaultValue:null,kind:"LocalArgument",name:"offset"},a={defaultValue:null,kind:"LocalArgument",name:"projectID"},i=[{alias:null,args:[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,l,n,a],kind:"Fragment",metadata:null,name:"useValidateServiceNameQuery",selections:i,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,e,n,l],kind:"Operation",name:"useValidateServiceNameQuery",selections:i},params:{cacheID:"30593ccd7db40f50bf74aaecbae29ccf",id:null,metadata:{},name:"useValidateServiceNameQuery",operationKind:"query",text:"query useValidateServiceNameQuery(\n  $projectID: UUID!\n  $filter: String\n  $offset: Int!\n  $limit: Int!\n) {\n  endpoint_list(project: $projectID, filter: $filter, offset: $offset, limit: $limit) {\n    total_count\n  }\n}\n"}}}();_.hash="941c25547ab1d1d93c0181fcde27f16c";const y=_;var h=n(47699),f=n.n(h),S=n(17534),k=n(62962),F=n(46336);var b=n(52038),K=n(15621),x=n(94986),j=n(42159),A=n(85653),P=n(93097),L=n(11863),I=n(66673),w=n(94538),D=n(66800),T=n(30782),C=n(20714),N=n(8343),V=n(67631),O=n(52866),M=n(89374);const E=["autoSelectDefault","allowFolderExplorer","allowCreateFolder","valuePropName","filter"],R=e=>{var l,n;let{autoSelectDefault:i,allowFolderExplorer:r,allowCreateFolder:o,valuePropName:s="name",filter:t}=e,u=(0,L.A)(e,E);const d=(0,p.hd)(),c=(0,m.QE)(),{generateFolderPath:_}=(0,D.useFolderExplorerOpener)(),{t:y}=(0,k.Bd)(),[h,F]=(0,I.A)(u),[b,K]=(0,g.Tw)("first"),[x,j]=(0,S.useState)(!1),{data:A}=(0,v.nj)({queryKey:["VFolderSelectQuery",b],queryFn:()=>{const e=new URLSearchParams;return e.set("group_id",d.id),c({method:"GET",url:"/folders?".concat(e.toString())})},staleTime:0}),P=t?f().filter(A,t):A,R=f().first(P)?{label:null===(l=f().first(P))||void 0===l?void 0:l.name,value:null===(n=f().first(P))||void 0===n?void 0:n[s]}:void 0;return(0,S.useEffect)((()=>{i&&R&&F(R.value,R)}),[i]),(0,M.jsxs)(V.OO,{gap:"xs",children:[(0,M.jsx)(T.A,(0,a.A)((0,a.A)({showSearch:!0,optionFilterProp:"label"},u),{},{value:h,labelRender:e=>{let{label:l,value:n}=e;return r?(0,M.jsx)(V.rm,{type:"hover",to:_(f().toString(n)),onClick:e=>{e.stopPropagation()},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},children:l}):l},onChange:F,onOpenChange:e=>{e&&(0,S.startTransition)((()=>{K()}))},options:f().map(P,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e[s]})))})),o?(0,M.jsx)(C.A,{title:y("data.CreateANewStorageFolder"),children:(0,M.jsx)(N.Ay,{icon:(0,M.jsx)(O.A,{}),type:"primary",ghost:!0,onClick:()=>{j(!0)}})}):null,(0,M.jsx)(w.A,{usageMode:"model",open:x,onRequestClose:e=>{j(!1),e&&(0,S.startTransition)((()=>{K(),F(e.id,f().map(P,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e[s]}))))}))}})]})};var z=n(18676),q=n(1139);const Q={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H152c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h720c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"minus",theme:"outlined"};var U=n(5436),$=function(e,l){return S.createElement(U.A,(0,q.A)({},e,{ref:l,icon:Q}))};const J=S.forwardRef($);var G=n(70024),B=n(76591),W=n(66597),H=n(94010),X=n(31035),Z=n(99901),Y=n(90711),ee=n(82609),le=n(30332),ne=n(42338),ae=n(73233);const ie=S.lazy((()=>n.e(4971).then(n.bind(n,24971)))),re=e=>{var l,n,i,o,t,d,_,h,L,I,w,D,O,E,q,Q,U,$,re,oe,se;let{endpointFrgmt:te=null}=e;const{logger:ue}=(0,V.Q7)(),{token:de}=B.A.useToken(),{message:ce}=W.A.useApp(),{t:me}=(0,k.Bd)(),ge=(0,ae.withDefault)(ae.JsonParam,{}),[{model:ve,formValues:pe},_e]=(0,ae.useQueryParams)({model:ae.StringParam,formValues:ge}),ye=(0,g.f0)(),he=(0,g.CX)(),fe=(0,m.QE)(),Se=(0,g.eZ)(),ke=(()=>{const{t:e}=(0,k.Bd)(),l=(0,F.useRelayEnvironment)(),n=(0,p.hd)();return(0,S.useMemo)((()=>[{min:4,message:e("modelService.ServiceNameMinLength")},{max:24,message:e("modelService.ServiceNameMaxLength"),type:"string"},{validator:(l,n)=>f().isEmpty(n)?Promise.resolve():/^\w/.test(n)?/\w$/.test(n)?/^[\w-]*$/.test(n)?Promise.resolve():Promise.reject(e("modelService.ServiceNameInvalidCharacter")):Promise.reject(e("modelService.ServiceNameShouldEndWith")):Promise.reject(e("modelService.ServiceNameShouldStartWith"))},{validator:async(a,i)=>i?(0,F.fetchQuery)(l,y,{projectID:n.id,filter:'lifecycle_stage != "destroyed" & name == "'.concat(i,'"'),offset:0,limit:1}).toPromise().catch((()=>Promise.resolve())).then((l=>{var n,a;if((null!==(n=null===l||void 0===l||null===(a=l.endpoint_list)||void 0===a?void 0:a.total_count)&&void 0!==n?n:0)>0)return Promise.reject(e("modelService.ServiceAlreadyExists"))})):Promise.resolve()},{required:!0}]),[l,n.id,e])})(),[Fe,be]=(0,S.useState)(!1),[Ke]=H.A.useForm(),[xe,je]=(0,S.useState)(!1),[Ae,Pe]=(0,p.zL)(),{getErrorMessage:Le}=(0,V.B7)(),Ie=(0,F.useFragment)(c,te),{data:we}=(0,v.nj)({queryKey:["baiClient.modelService.runtime.list"],queryFn:()=>fe({method:"GET",url:"/services/_/runtimes"}),staleTime:1e3}),De=function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&e&&!f().isEmpty(e)},Te=function(){var e,l,n,a,i;let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1?arguments[1]:void 0;return{image:{name:r?null===(e=o.environments.manual)||void 0===e?void 0:e.split("@")[0]:o.environments.version.split("@")[0],architecture:r?null===(l=o.environments.manual)||void 0===l?void 0:l.split("@")[1]:null===(n=o.environments.image)||void 0===n?void 0:n.architecture,registry:r?null===(a=o.environments.manual)||void 0===a?void 0:a.split("/")[0]:null===(i=o.environments.image)||void 0===i?void 0:i.registry}}},Ce=(0,v.ET)({mutationFn:e=>{var l,n,i,r,o;const s={};e.envvars&&e.envvars.forEach((e=>s[e.variable]=e.value));const t=(0,a.A)((0,a.A)({name:e.serviceName,desired_session_count:e.replicas},function(){var e,l,n,a;let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1?arguments[1]:void 0;return{image:i?null===(e=r.environments.manual)||void 0===e?void 0:e.split("@")[0]:null===(l=r.environments.version)||void 0===l?void 0:l.split("@")[0],architecture:i?null===(n=r.environments.manual)||void 0===n?void 0:n.split("@")[1]:null===(a=r.environments.image)||void 0===a?void 0:a.architecture}}(De(he._config.allow_manual_image_name_for_session,null===(l=e.environments)||void 0===l?void 0:l.manual),e)),{},{runtime_variant:e.runtimeVariant,group:he.current_group,domain:Se,cluster_size:e.cluster_size,cluster_mode:e.cluster_mode,open_to_public:e.openToPublic,config:(0,a.A)({model:e.vFolderID,model_version:1,extra_mounts:f().reduce(e.mount_ids,((l,n)=>(l[n]=(0,a.A)((0,a.A)({},e.mount_id_map[n]&&{mount_destination:e.mount_id_map[n]}),{},{type:"bind"}),l)),{}),model_definition_path:e.modelDefinitionPath,model_mount_destination:""!==e.modelMountDestination?e.modelMountDestination:"/models",environ:s,scaling_group:e.resourceGroup,resources:(0,a.A)({cpu:null===(n=e.resource.cpu)||void 0===n?void 0:n.toString(),mem:e.resource.mem},null!==(i=e.resource)&&void 0!==i&&i.acceleratorType&&null!==(r=e.resource)&&void 0!==r&&r.accelerator&&e.resource.accelerator>0?{[e.resource.acceleratorType]:null===(o=e.resource.accelerator)||void 0===o?void 0:o.toString()}:void 0)},e.resource.shmem&&{shmem:(0,m.Mh)(e.resource.mem,"4g")>0&&(0,m.Mh)(e.resource.shmem,"1g")<0?"1g":e.resource.shmem})});return(0,m.hu)({method:"POST",url:"/services",body:t,client:he})}}),{user:Ne}=(0,F.useLazyLoadQuery)(u,{domain_name:(0,g.eZ)(),email:null===he||void 0===he?void 0:he.email}),{user_resource_policy:Ve}=(0,F.useLazyLoadQuery)(s,{user_RP_name:null===Ne||void 0===Ne?void 0:Ne.resource_policy}),[Oe]=(0,F.useMutation)(r),[Me,Ee]=(0,S.useState)(),{run:Re}=(0,G.A)((()=>{const e=Ke.getFieldsValue();_e({formValues:f().assign(f().omit(e,["environments.image","environments.customizedTag","vfoldersAliasMap","envvars"]),{envvars:(0,b.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),ze=Ie?{serviceName:null===Ie||void 0===Ie?void 0:Ie.name,resourceGroup:null===Ie||void 0===Ie?void 0:Ie.resource_group,allocationPreset:"custom",replicas:null!==(l=null!==(n=null===Ie||void 0===Ie?void 0:Ie.replicas)&&void 0!==n?n:null===Ie||void 0===Ie?void 0:Ie.desired_session_count)&&void 0!==l?l:1,resource:(0,a.A)({cpu:parseInt(null===(i=JSON.parse((null===Ie||void 0===Ie?void 0:Ie.resource_slots)||"{}"))||void 0===i?void 0:i.cpu),mem:null===(o=(0,m.mv)(null===(t=JSON.parse((null===Ie||void 0===Ie?void 0:Ie.resource_slots)||"{}"))||void 0===t?void 0:t.mem,"g",3,!0))||void 0===o?void 0:o.value,shmem:null===(d=(0,m.mv)((null===(_=JSON.parse((null===Ie||void 0===Ie?void 0:Ie.resource_opts)||"{}"))||void 0===_?void 0:_.shmem)||A.t2,"g",3,!0))||void 0===d?void 0:d.value},(e=>{if(Object.keys(e).length<=0)return;const l=Object.keys(e)[0];return{acceleratorType:l,accelerator:"string"===typeof e[l]?"cuda.shares"===l?parseFloat(e[l]):parseInt(e[l]):e[l]}})(f().omit(JSON.parse((null===Ie||void 0===Ie?void 0:Ie.resource_slots)||"{}"),["cpu","mem"]))),cluster_mode:"MULTI_NODE"===(null===Ie||void 0===Ie?void 0:Ie.cluster_mode)?"multi-node":"single-node",cluster_size:null===Ie||void 0===Ie?void 0:Ie.cluster_size,openToPublic:null===Ie||void 0===Ie?void 0:Ie.open_to_public,environments:{environment:null!==(h=null===Ie||void 0===Ie||null===(L=Ie.image_object)||void 0===L?void 0:L.namespace)&&void 0!==h?h:null===Ie||void 0===Ie||null===(I=Ie.image_object)||void 0===I?void 0:I.name,version:"".concat(null===Ie||void 0===Ie||null===(w=Ie.image_object)||void 0===w?void 0:w.registry,"/").concat(null!==(D=null===Ie||void 0===Ie||null===(O=Ie.image_object)||void 0===O?void 0:O.namespace)&&void 0!==D?D:null===Ie||void 0===Ie||null===(E=Ie.image_object)||void 0===E?void 0:E.name,":").concat(null===Ie||void 0===Ie||null===(q=Ie.image_object)||void 0===q?void 0:q.tag,"@").concat(null===Ie||void 0===Ie||null===(Q=Ie.image_object)||void 0===Q?void 0:Q.architecture),image:null===Ie||void 0===Ie?void 0:Ie.image_object},vFolderID:null===Ie||void 0===Ie?void 0:Ie.model,mount_ids:f().map(null===Ie||void 0===Ie?void 0:Ie.extra_mounts,(e=>{var l;return null===e||void 0===e||null===(l=e.row_id)||void 0===l?void 0:l.replaceAll("-","")})),modelMountDestination:null===Ie||void 0===Ie?void 0:Ie.model_mount_destination,modelDefinitionPath:null===Ie||void 0===Ie?void 0:Ie.model_definition_path,runtimeVariant:null===Ie||void 0===Ie||null===(U=Ie.runtime_variant)||void 0===U?void 0:U.name,envvars:f().map(JSON.parse((null===Ie||void 0===Ie?void 0:Ie.environ)||"{}"),((e,l)=>({variable:l,value:e})))}:(0,a.A)((0,a.A)((0,a.A)({replicas:1,runtimeVariant:"custom"},A.jh),(null===($=he._config)||void 0===$?void 0:$.default_session_environment)&&{environments:{environment:null===(re=he._config)||void 0===re?void 0:re.default_session_environment}}),{},{vFolderID:ve||(f().get(pe,"vFolderID")||void 0),resourceGroup:Ae,allocationPreset:"auto-select",mount_ids:[],mount_id_map:{}}),qe=f().merge({},ze,pe);return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(V.OO,{direction:"column",align:"stretch",style:{justifyContent:"revert"},children:(0,M.jsx)(V.OO,{direction:"row",gap:"md",align:"start",children:(0,M.jsxs)(V.OO,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},wrap:"nowrap",children:[f().filter((0,V.f)(null===Ie||void 0===Ie?void 0:Ie.extra_mounts),(e=>(null===e||void 0===e?void 0:e.name)&&!(null!==e&&void 0!==e&&e.name.startsWith(".")))).length>0&&(0,M.jsx)(X.A,{message:me("modelService.ExtraMountsWarning"),type:"warning",showIcon:!0,style:{marginBottom:de.marginMD}}),(0,M.jsx)(H.A.Provider,{onFormChange:()=>{Re()},children:(0,M.jsx)(H.A,{form:Ke,disabled:Ce.isPending,layout:"vertical",labelCol:{span:12},initialValues:qe,children:(0,M.jsxs)(V.OO,{direction:"column",gap:"md",align:"stretch",children:[(0,M.jsx)(Z.A,{children:(he.supports("modify-endpoint")||!Ie)&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(H.A.Item,{label:me("modelService.ServiceName"),name:"serviceName",validateDebounce:500,rules:Ie?[]:ke,children:(0,M.jsx)(Y.A,{disabled:!!Ie})}),(0,M.jsx)(H.A.Item,{name:"openToPublic",valuePropName:"checked",children:(0,M.jsx)(ee.A,{disabled:!!Ie,children:me("modelService.OpenToPublic")})}),Ie?(null===Ie||void 0===Ie?void 0:Ie.model)&&(0,M.jsx)(H.A.Item,{name:"vFolderID",label:me("session.launcher.ModelStorageToMount"),required:!0,children:(0,M.jsx)(S.Suspense,{fallback:(0,M.jsx)(le.A.Input,{active:!0}),children:(0,M.jsx)(P.A,{uuid:null===Ie||void 0===Ie?void 0:Ie.model})})}):(0,M.jsx)(H.A.Item,{name:"vFolderID",label:me("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,M.jsx)(R,{filter:e=>"model"===e.usage_mode&&"ready"===e.status&&"group"!==e.ownership_type,valuePropName:"id",autoSelectDefault:!ve&&!pe.vFolderID,disabled:!!Ie,allowFolderExplorer:!0,allowCreateFolder:!0})}),(0,M.jsx)(H.A.Item,{name:"runtimeVariant",required:!0,label:me("modelService.RuntimeVariant"),children:(0,M.jsx)(T.A,{defaultActiveFirstOption:!0,showSearch:!0,options:f().map(null===we||void 0===we?void 0:we.runtimes,(e=>({value:e.name,label:e.human_readable_name})))})}),(0,M.jsx)(H.A.Item,{dependencies:["runtimeVariant"],noStyle:!0,children:e=>{let{getFieldValue:l}=e;return"custom"===l("runtimeVariant")&&(0,M.jsxs)(V.OO,{direction:"row",gap:"xxs",align:"stretch",justify:"between",children:[(0,M.jsx)(H.A.Item,{name:"modelMountDestination",label:me("modelService.ModelMountDestination"),style:{width:"50%"},labelCol:{style:{flex:1}},children:(0,M.jsx)(Y.A,{allowClear:!0,placeholder:"/models",disabled:!!Ie})}),(0,M.jsx)(J,{style:{fontSize:de.fontSizeXL,color:de.colorTextDisabled},rotate:290}),(0,M.jsx)(H.A.Item,{name:"modelDefinitionPath",label:me("modelService.ModelDefinitionPath"),style:{width:"50%"},labelCol:{style:{flex:1}},children:(0,M.jsx)(Y.A,{allowClear:!0,placeholder:null!==Ie&&void 0!==Ie&&Ie.model_definition_path?null===Ie||void 0===Ie?void 0:Ie.model_definition_path:"model-definition.yaml"})})]})}}),(0,M.jsx)(H.A.Item,{noStyle:!0,dependencies:["vFolderID"],children:e=>{let{getFieldValue:l}=e;return(0,M.jsx)(z.A,{rowKey:"id",label:me("modelService.AdditionalMounts"),rowFilter:e=>{var n;return e.id!==l("vFolderID")&&"ready"===e.status&&"model"!==e.usage_mode&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))},tableProps:{size:"small"}})}})]})}),(0,M.jsx)(Z.A,{children:(he.supports("modify-endpoint")||!Ie)&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(H.A.Item,{label:me("modelService.NumberOfReplicas"),name:"replicas",rules:[{required:!0},{type:"number",min:0},{type:"number",max:null!==(oe=null===Ve||void 0===Ve?void 0:Ve.max_session_count_per_model_session)&&void 0!==oe?oe:0}],children:(0,M.jsx)(x.A,{inputContainerMinWidth:190,min:0,max:null!==(se=null===Ve||void 0===Ve?void 0:Ve.max_session_count_per_model_session)&&void 0!==se?se:0,inputNumberProps:{addonAfter:"#"},step:1})}),(0,M.jsx)(K.A,{}),Ie&&!xe&&!he._config.allowCustomResourceAllocation&&(0,M.jsx)(H.A.Item,{label:(0,M.jsxs)(M.Fragment,{children:[me("modelService.Resources"),(0,M.jsx)(N.Ay,{type:"link",onClick:()=>{Ke.setFieldsValue({allocationPreset:"auto-select"}),je(!0)},children:me("general.Change")})]}),required:!0,children:(0,M.jsxs)(V.OO,{gap:"xs",children:[(0,M.jsx)(C.A,{title:me("session.ResourceGroup"),children:(0,M.jsx)(ne.A,{children:null===Ie||void 0===Ie?void 0:Ie.resource_group})}),f().map(JSON.parse((null===Ie||void 0===Ie?void 0:Ie.resource_slots)||"{}"),((e,l)=>(0,M.jsx)(j.A,{type:l,value:e,opts:JSON.parse((null===Ie||void 0===Ie?void 0:Ie.resource_opts)||"{}")},l)))]})}),(0,M.jsx)("div",{style:{display:!Ie||xe||he._config.allowCustomResourceAllocation?"block":"none"},children:(0,M.jsx)(A.Ay,{enableResourcePresets:!0})}),(0,M.jsx)(H.A.Item,{label:me("session.launcher.EnvironmentVariable"),children:(0,M.jsx)(b.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]})}),(0,M.jsxs)(V.OO,{direction:"row",justify:"between",align:"end",gap:"xs",children:[(0,M.jsx)(V.OO,{children:(0,M.jsx)(N.Ay,{onClick:()=>{Ke.validateFields().then((e=>{Ee(e),be(!0)})).catch((e=>{ue.error(e.message),ce.error(me("modelService.FormValidationFailed"))}))},children:me("modelService.Validate")})}),(0,M.jsx)(V.OO,{gap:"sm",children:(0,M.jsx)(N.Ay,{type:"primary",onClick:()=>{Ke.validateFields().then((e=>{if(Ie){var l,n,i;const r={endpoint_id:(null===Ie||void 0===Ie?void 0:Ie.endpoint_id)||"",props:(0,a.A)((0,a.A)((0,a.A)({resource_slots:JSON.stringify((0,a.A)({cpu:e.resource.cpu,mem:e.resource.mem},null!==(l=e.resource)&&void 0!==l&&l.acceleratorType&&null!==(n=e.resource)&&void 0!==n&&n.accelerator&&e.resource.accelerator>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0)),resource_opts:JSON.stringify({shmem:e.resource.shmem}),cluster_mode:"single-node"===e.cluster_mode?"SINGLE_NODE":"MULTI_NODE",cluster_size:e.cluster_size},he.supports("replicas")?{replicas:e.replicas}:{desired_session_count:e.replicas}),Te(De(he._config.allow_manual_image_name_for_session,null===(i=e.environments)||void 0===i?void 0:i.manual),e)),{},{extra_mounts:f().map(e.mount_ids,(l=>(0,a.A)({vfolder_id:l},e.mount_id_map[l]&&{mount_destination:e.mount_id_map[l]}))),name:e.serviceName,resource_group:e.resourceGroup,model_definition_path:e.modelDefinitionPath,runtime_variant:e.runtimeVariant})},o={};e.envvars&&e.envvars.forEach((e=>o[e.variable]=e.value)),r.props.environ=JSON.stringify(o),Oe({variables:r,onCompleted:(e,l)=>{var n,a,i;if(null!==(n=e.modify_endpoint)&&void 0!==n&&n.ok){var r;const l=null===(r=e.modify_endpoint)||void 0===r?void 0:r.endpoint;return ce.success(me("modelService.ServiceUpdated",{name:null===l||void 0===l?void 0:l.name})),void ye("/serving/".concat(null===Ie||void 0===Ie?void 0:Ie.endpoint_id))}if(null!==(a=e.modify_endpoint)&&void 0!==a&&a.msg)ce.error(null===(i=e.modify_endpoint)||void 0===i?void 0:i.msg);else if(l&&(null===l||void 0===l?void 0:l.length)>0){const e=f().map(l,(e=>e.message));for(const l of e)ce.error(l)}},onError:e=>{e.message?ce.error(e.message):ce.error(me("modelService.FailedToUpdateService"))}})}else Ce.mutate(e,{onSuccess:()=>{Pe(e.resourceGroup),ce.success(me("modelService.ServiceCreated",{name:e.serviceName})),ye("/serving")},onError:e=>{const l=me(Ie?"modelService.FailedToUpdateService":"modelService.FailedToStartService");ce.error(Le(e,l))}})})).catch((e=>{var l,n;(null===e||void 0===e||null===(l=e.errorFields)||void 0===l||null===(n=l[0])||void 0===n?void 0:n.name)&&Ke.scrollToField(e.errorFields[0].name,{behavior:"smooth",block:"center"})}))},children:me(Ie?"button.Update":"button.Create")})})]})]})})})]})})}),(0,M.jsx)(V.Ib,{width:1e3,title:me("modelService.ValidationInfo"),open:Fe,destroyOnHidden:!0,onCancel:()=>{be(!Fe)},okButtonProps:{style:{display:"none"}},cancelText:me("button.Close"),maskClosable:!1,children:(0,M.jsx)(ie,{serviceData:Me})})]})}},72627:(e,l,n)=>{n.d(l,{A:()=>t});var a=n(1139),i=n(17534);const r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h368c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"minus-circle",theme:"outlined"};var o=n(5436),s=function(e,l){return i.createElement(o.A,(0,a.A)({},e,{ref:l,icon:r}))};const t=i.forwardRef(s)},93097:(e,l,n)=>{n.d(l,{A:()=>c});var a=n(48880),i=n(40690),r=n(62378),o=n(81109),s=n(11640),t=n(96223),u=(n(17534),n(40720)),d=n(89374);const c=e=>{let{uuid:l,clickable:n}=e;const c=(0,o.hd)(),m=(0,a.QE)(),g=(0,u.zy)(),v=(0,i.f0)(),{data:p}=(0,r.nj)({queryKey:["VFolderSelectQuery"],queryFn:()=>{const e=new URLSearchParams;return e.set("group_id",c.id),m({method:"GET",url:"/folders?".concat(e.toString())})},staleTime:1e3}),_=null===p||void 0===p?void 0:p.find((e=>e.id===(null===l||void 0===l?void 0:l.replaceAll("-",""))));return _&&(n?(0,d.jsxs)(t.A.Link,{onClick:()=>{v({pathname:g.pathname,search:new URLSearchParams({folder:_.id}).toString()})},children:[(0,d.jsx)(s.A,{})," ",_.name]}):(0,d.jsxs)("div",{children:[(0,d.jsx)(s.A,{})," ",_.name]}))}}}]);
//# sourceMappingURL=2451.6289c539.chunk.js.map