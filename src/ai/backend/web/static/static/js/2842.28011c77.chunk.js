"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[2842],{82842:(e,l,n)=>{n.r(l),n.d(l,{default:()=>P});var a,i=n(51593),s=n(11899),r=n(60881),o=n(94126),t=n(45719),u=n(11393),d=n(58879),c=n(69056),m=n(89608),p=n.n(m),g=n(56762),y=n(88522),v=n(73689);const _=e=>{let{...l}=e;const{t:i}=(0,g.Bd)(),{user_resource_policies:s}=(0,y.useLazyLoadQuery)(void 0!==a?a:a=n(14648),{},{fetchPolicy:"store-and-network"});return(0,v.jsx)(c.A,{showSearch:!0,placeholder:i("credential.SelectPolicy"),options:p().map(s,(e=>({value:null===e||void 0===e?void 0:e.name,label:null===e||void 0===e?void 0:e.name}))).sort(((e,l)=>(0,d._f)(null===e||void 0===e?void 0:e.label,null===l||void 0===l?void 0:l.label))),...l})};var k,S,f=n(67592),b=n(55731),F=n(96358),h=n(85029),A=n(23702),K=n(67378),x=n(15480),T=n(85690),U=n(43373);const P=e=>{var l;let{extraFetchKey:a="",...d}=e;const{t:m}=(0,g.Bd)(),{value:P,dispatchEvent:w}=(0,t.useWebComponentInfo)();let j;try{j=JSON.parse(P||"")}catch(Z){j={open:!1,userEmail:""}}const{open:N,userEmail:M}=j,[I,L]=F.A.useModal(),C=(0,U.useRef)(null),E={superadmin:["superadmin","admin","user","monitor"],admin:["admin","user","monitor"]},[O,R]=(0,i.Tw)("initial-fetch"),V=(0,U.useDeferredValue)(O+a),$=(0,i.CX)(),D=null===$||void 0===$?void 0:$.supports("sudo-session-enabled"),{isTOTPSupported:q,isLoading:Q}=(0,s.F4)(),{user:B,loggedInUser:z}=(0,y.useLazyLoadQuery)(void 0!==k?k:k=n(95842),{email:M,isNotSupportSudoSessionEnabled:!D,isNotSupportTotp:!q,loggedInUserEmail:null!==(l=null===$||void 0===$?void 0:$.email)&&void 0!==l?l:""},{fetchKey:V,fetchPolicy:"network-only"}),[G,W]=(0,y.useMutation)(void 0!==S?S:S=n(77277)),Y=(0,r.ET)({mutationFn:e=>$.remove_totp(e)}),[J,{toggle:X}]=(0,b.A)(!1);return(0,v.jsxs)(o.A,{open:N,onCancel:()=>{w("cancel",null)},centered:!0,title:m("credential.ModifyUserDetail"),destroyOnClose:!0,onOk:()=>{var e;null===(e=C.current)||void 0===e||e.validateFields().then((async e=>{let l={...e};var n,a;(delete l.email,l=p().omit(l,["password_confirm"]),l=p().omitBy(l,(e=>void 0===e||""===e)),D)||(null===(n=l)||void 0===n||delete n.sudo_session_enabled);q||(null===(a=l)||void 0===a||delete a.totp_activated);G({variables:{email:(null===e||void 0===e?void 0:e.email)||"",props:l,isNotSupportSudoSessionEnabled:!D,isNotSupportTotp:!q},onCompleted(e){var l,n;null!==e&&void 0!==e&&null!==(l=e.modify_user)&&void 0!==l&&l.ok?h.Ay.success(m("environment.SuccessfullyModified")):h.Ay.error(null===e||void 0===e||null===(n=e.modify_user)||void 0===n?void 0:n.msg);w("ok",null)},onError(e){h.Ay.error(null===e||void 0===e?void 0:e.message)}})}))},confirmLoading:W,...d,children:[(0,v.jsxs)(A.A,{ref:C,preserve:!1,labelCol:{span:10},wrapperCol:{span:20},validateTrigger:["onChange","onBlur"],style:{marginBottom:40,marginTop:20},initialValues:{...B},children:[(0,v.jsx)(A.A.Item,{name:"email",label:m("credential.UserID"),children:(0,v.jsx)(K.A,{disabled:!0})}),(0,v.jsx)(A.A.Item,{name:"username",label:m("credential.UserName"),children:(0,v.jsx)(K.A,{placeholder:m("maxLength.64chars")})}),(0,v.jsx)(A.A.Item,{name:"full_name",label:m("credential.FullName"),children:(0,v.jsx)(K.A,{placeholder:m("maxLength.64chars")})}),(0,v.jsx)(A.A.Item,{name:"password",label:m("general.NewPassword"),rules:[{pattern:/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,message:m("webui.menu.InvalidPasswordMessage")}],children:(0,v.jsx)(K.A.Password,{})}),(0,v.jsx)(A.A.Item,{name:"password_confirm",dependencies:["password"],label:m("webui.menu.NewPasswordAgain"),rules:[e=>{let{getFieldValue:l}=e;return{validator:(e,n)=>!n&&l("password")?Promise.reject(new Error(m("webui.menu.PleaseConfirmYourPassword"))):n&&l("password")!==n?Promise.reject(new Error(m("environment.PasswordsDoNotMatch"))):Promise.resolve()}}],children:(0,v.jsx)(K.A.Password,{})}),(0,v.jsx)(A.A.Item,{name:"description",label:m("credential.Description"),children:(0,v.jsx)(K.A.TextArea,{placeholder:m("maxLength.500chars")})}),(0,v.jsx)(A.A.Item,{name:"status",label:m("credential.UserStatus"),children:(0,v.jsx)(c.A,{options:p().map({active:"Active",inactive:"Inactive","before-verification":"Before Verification",deleted:"Deleted"},((e,l)=>({value:l,label:e})))})}),!(null===B||void 0===B||!B.role)&&!(null===z||void 0===z||!z.role)&&z.role in E&&(0,v.jsx)(A.A.Item,{name:"role",label:m("credential.Role"),children:(0,v.jsx)(c.A,{options:p().map(E[z.role],(e=>({value:e,label:e})))})}),(0,v.jsx)(A.A.Item,{name:"need_password_change",label:m("credential.DescRequirePasswordChange"),valuePropName:"checked",children:(0,v.jsx)(x.A,{})}),!!D&&(0,v.jsx)(A.A.Item,{name:"sudo_session_enabled",label:m("credential.EnableSudoSession"),valuePropName:"checked",children:(0,v.jsx)(x.A,{})}),!!q&&(0,v.jsx)(A.A.Item,{name:"totp_activated",label:m("webui.menu.TotpActivated"),valuePropName:"checked",extra:(null===B||void 0===B?void 0:B.email)!==(null===$||void 0===$?void 0:$.email)&&(0,v.jsx)(T.A.Text,{type:"secondary",style:{fontSize:12},children:m("credential.AdminCanOnlyRemoveTotp")}),children:(0,v.jsx)(x.A,{loading:Q||Y.isPending,disabled:(null===B||void 0===B?void 0:B.email)!==(null===$||void 0===$?void 0:$.email)&&!(null!==B&&void 0!==B&&B.totp_activated),onChange:e=>{var l;e?X():null!==B&&void 0!==B&&B.totp_activated&&(null===(l=C.current)||void 0===l||l.setFieldValue("totp_activated",!0),I.confirm({title:m("totp.TurnOffTotp"),icon:(0,v.jsx)(f.A,{}),content:m("totp.ConfirmTotpRemovalBody"),okText:m("button.Yes"),okType:"danger",cancelText:m("button.No"),onOk(){Y.mutate((null===B||void 0===B?void 0:B.email)||"",{onSuccess:()=>{var e;h.Ay.success(m("totp.RemoveTotpSetupCompleted")),R(),null===(e=C.current)||void 0===e||e.setFieldValue("totp_activated",!1)},onError:e=>{console.log(e)}})},onCancel(){var e;null===(e=C.current)||void 0===e||e.setFieldValue("totp_activated",!0)}}))}})}),(0,v.jsx)(A.A.Item,{name:"resource_policy",label:m("resourcePolicy.ResourcePolicy"),children:(0,v.jsx)(_,{})})]}),!!q&&(0,v.jsx)(u.A,{userFrgmt:B,open:J,onRequestClose:e=>{var l;e?R():null===(l=C.current)||void 0===l||l.setFieldValue("totp_activated",!1);X()}}),L]})}},14648:(e,l,n)=>{n.r(l),n.d(l,{default:()=>i});const a=function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"max_vfolder_count",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"max_session_count_per_model_session",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"max_quota_scope_size",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"max_customized_image_count",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UserResourcePolicySelectorQuery",selections:[{alias:null,args:null,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policies",plural:!0,selections:[e,l,n,a,i,s,r,{args:null,kind:"FragmentSpread",name:"UserResourcePolicySettingModalFragment"}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"UserResourcePolicySelectorQuery",selections:[{alias:null,args:null,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policies",plural:!0,selections:[e,l,n,a,i,s,r],storageKey:null}]},params:{cacheID:"5c0bb0244594feb3fc33aadcac7ffb2f",id:null,metadata:{},name:"UserResourcePolicySelectorQuery",operationKind:"query",text:'query UserResourcePolicySelectorQuery {\n  user_resource_policies {\n    id\n    name\n    created_at\n    max_vfolder_count @since(version: "23.09.6")\n    max_session_count_per_model_session @since(version: "23.09.10")\n    max_quota_scope_size @since(version: "23.09.2")\n    max_customized_image_count @since(version: "24.03.0")\n    ...UserResourcePolicySettingModalFragment\n  }\n}\n\nfragment UserResourcePolicySettingModalFragment on UserResourcePolicy {\n  id\n  name\n  max_vfolder_count @since(version: "23.09.6")\n  max_session_count_per_model_session @since(version: "23.09.10")\n  max_quota_scope_size @since(version: "23.09.2")\n  max_customized_image_count @since(version: "24.03.0")\n}\n'}}}();a.hash="df2a28e16edd8e8b4791053a89f9917f";const i=a},77277:(e,l,n)=>{n.r(l),n.d(l,{default:()=>i});const a=function(){var e={defaultValue:null,kind:"LocalArgument",name:"email"},l={defaultValue:null,kind:"LocalArgument",name:"isNotSupportSudoSessionEnabled"},n={defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},a={defaultValue:null,kind:"LocalArgument",name:"props"},i=[{kind:"Variable",name:"email",variableName:"email"},{kind:"Variable",name:"props",variableName:"props"}],s={alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},v={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[o,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:[e,l,n,a],kind:"Fragment",metadata:null,name:"UserSettingModalMutation",selections:[{alias:null,args:i,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[s,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[o,t,u,d,c,m,p,g,y,v,_,k,S,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],storageKey:null}],type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,a,l,n],kind:"Operation",name:"UserSettingModalMutation",selections:[{alias:null,args:i,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[s,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[o,t,u,d,c,m,p,g,y,v,_,k,S],storageKey:null}],storageKey:null}]},params:{cacheID:"ffc26918232a32159a0a24c8a97cf055",id:null,metadata:{},name:"UserSettingModalMutation",operationKind:"mutation",text:"mutation UserSettingModalMutation(\n  $email: String!\n  $props: ModifyUserInput!\n  $isNotSupportSudoSessionEnabled: Boolean!\n  $isNotSupportTotp: Boolean!\n) {\n  modify_user(email: $email, props: $props) {\n    ok\n    msg\n    user {\n      id\n      email\n      username\n      need_password_change\n      full_name\n      description\n      status\n      domain_name\n      role\n      groups {\n        id\n        name\n      }\n      resource_policy\n      sudo_session_enabled @skipOnClient(if: $isNotSupportSudoSessionEnabled)\n      totp_activated @skipOnClient(if: $isNotSupportTotp)\n      ...TOTPActivateModalFragment\n    }\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();a.hash="4d04bd91001af5818b1795c33987c2a2";const i=a},95842:(e,l,n)=>{n.r(l),n.d(l,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportSudoSessionEnabled"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},{defaultValue:null,kind:"LocalArgument",name:"loggedInUserEmail"}],l=[{kind:"Variable",name:"email",variableName:"email"}],n={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},c={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[d,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null},y=[{kind:"Variable",name:"email",variableName:"loggedInUserEmail"}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserSettingModalQuery",selections:[{alias:null,args:l,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[n,a,i,s,r,o,t,u,c,m,p,g,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null},{alias:"loggedInUser",args:y,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[u],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserSettingModalQuery",selections:[{alias:null,args:l,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[n,a,i,s,r,o,t,u,c,m,p,g,d],storageKey:null},{alias:"loggedInUser",args:y,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[u,d],storageKey:null}]},params:{cacheID:"87def03a87c2b5dca015b7998ead900f",id:null,metadata:{},name:"UserSettingModalQuery",operationKind:"query",text:"query UserSettingModalQuery(\n  $email: String\n  $isNotSupportSudoSessionEnabled: Boolean!\n  $isNotSupportTotp: Boolean!\n  $loggedInUserEmail: String\n) {\n  user(email: $email) {\n    email\n    username\n    need_password_change\n    full_name\n    description\n    status\n    domain_name\n    role\n    groups {\n      id\n      name\n    }\n    resource_policy\n    sudo_session_enabled @skipOnClient(if: $isNotSupportSudoSessionEnabled)\n    totp_activated @skipOnClient(if: $isNotSupportTotp)\n    ...TOTPActivateModalFragment\n    id\n  }\n  loggedInUser: user(email: $loggedInUserEmail) {\n    role\n    id\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();a.hash="4b64b81b0ac93f9380101ea79e795050";const i=a}}]);
//# sourceMappingURL=2842.28011c77.chunk.js.map