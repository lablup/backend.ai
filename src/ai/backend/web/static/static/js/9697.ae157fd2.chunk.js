"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[9697],{9697:(e,n,r)=>{r.r(n),r.d(n,{default:()=>$});var o,l,i,a,t=r(75045),s=r(32967),d=r(88653),c=r(88616),u=r(47639),g=r(58452),p=r(82929),m=r(90840),v=r(46841),f=r(8265),y=r(90030),b=r(19985),x=r(59571),w=r(45300),S=r(73552),h=r(89097),k=r(64181),A=r(24764),F=r(20818),C=r(70468),I=r(3730),j=r(29107),E=r(1426),L=r(9976),N=r(18347),M=r(42906);const D=(0,j.rU)((e=>{let{token:n,css:r}=e;return{baiModalHeader:r`
    .ant-modal-title {
      width: 100%;
      margin-right: ${n.marginXXL}px;
    }
  `}})),O=e=>{let{vfolderFrgmt:n,vfolderNodeFrgmt:o,...l}=e;const{token:t}=x.A.useToken(),s=(0,N.useFragment)(void 0!==i?i:i=r(3716),n),d=(0,N.useFragment)(void 0!==a?a:a=r(58072),o),c=(null===d||void 0===d?void 0:d.name)||(null===s||void 0===s?void 0:s.name)||"";return(0,M.jsx)(C.A,{title:c,children:(0,M.jsx)(I.A.Title,{level:3,style:{marginTop:t.marginSM},ellipsis:!0,children:c})})},$=e=>{let{vfolderID:n,onRequestClose:i,...a}=e;const{t:C}=(0,L.Bd)(),{token:I}=x.A.useToken(),{styles:j}=D(),{lg:$}=w.Ay.useBreakpoint(),{message:T}=S.A.useApp(),[z]=(0,d.U6)(),[P,V]=(0,E.useState)(!1),[R,K]=(0,E.useState)(!1),U=(0,E.useRef)(null),_=(0,s.CX)(),Q=(0,u.b)(),B=(0,N.useRelayEnvironment)();(0,s.CX)(),(0,E.useEffect)((()=>{const e=e=>{V(e.detail||!1)},n=e=>{K(e.detail||!1)};return document.addEventListener("folderExplorer:connected",e),document.addEventListener("folderExplorer:columnSelected",n),()=>{document.removeEventListener("folderExplorer:connected",e),document.removeEventListener("folderExplorer:columnSelected",n)}}),[]);const{vfolder:X,vfolder_node:Y}=(0,N.useLazyLoadQuery)(void 0!==o?o:o=r(78802),{vfolderID:n,vfolderUUID:(0,t.wc)("VirtualFolderNode",n)},{fetchPolicy:a.open?"network-only":"store-only"}),H=(0,c.ET)({mutationFn:e=>{let{permission:n,id:r}=e;return _.vfolder.update_folder({permission:n},r)}});return(0,M.jsxs)(g.A,{className:j.baiModalHeader,centered:!0,width:1200,destroyOnClose:!0,footer:null,title:(0,M.jsxs)(m.A,{justify:"between",gap:I.marginMD,style:{width:"100%"},children:[(0,M.jsx)(m.A,{gap:I.marginMD,style:{flex:1},children:(0,M.jsx)(E.Suspense,{fallback:(0,M.jsx)(h.A.Input,{active:!0}),children:(0,M.jsx)(O,{vfolderFrgmt:null!==X&&void 0!==X?X:void 0,vfolderNodeFrgmt:null!==Y&&void 0!==Y?Y:void 0})})}),(0,M.jsxs)(m.A,{justify:"end",gap:I.marginSM,style:{flex:$?2:1},children:[(0,M.jsx)(k.Ay,{icon:(0,M.jsx)(A.A,{width:"18px",src:"/resources/icons/filebrowser.svg",alt:"File Browser",preview:!1}),onClick:()=>{var e;return null===(e=U.current)||void 0===e?void 0:e._executeFileBrowser()},children:$&&C("data.explorer.ExecuteFileBrowser")}),(0,M.jsx)(k.Ay,{icon:(0,M.jsx)(A.A,{width:"18px",src:"/resources/icons/sftp.png",alt:"SSH / SFTP",preview:!1}),onClick:()=>{var e;null===(e=U.current)||void 0===e||e._executeSSHProxyAgent()},children:$&&C("data.explorer.RunSSH/SFTPserver")}),(null===Y||void 0===Y?void 0:Y.user)===z.uuid&&(0,M.jsx)(p.A,{tooltip:C("data.folders.MountPermission"),defaultValue:(null===Y||void 0===Y?void 0:Y.permission)||(null===X||void 0===X?void 0:X.permission),options:[{value:"ro",label:C("data.ReadOnly")},{value:"rw",label:C("data.ReadWrite")}],onChange:e=>{H.mutate({permission:e,id:n},{onSuccess:()=>{var e;T.success(C("data.permission.PermissionModified")),document.dispatchEvent(new CustomEvent("backend-ai-folder-updated")),(0,N.fetchQuery)(B,void 0!==l?l:l=r(55352),{id:Y.id}).toPromise(),null===(e=U.current)||void 0===e||e._fetchVFolder()},onError:e=>{T.error(Q.relieve(null===e||void 0===e?void 0:e.message))}})},popupMatchSelectWidth:!1})]})]}),onCancel:()=>{i()},...a,children:[(0,M.jsxs)(m.A,{justify:"end",gap:I.marginSM,style:{position:"absolute",top:"calc(var(--general-modal-header-height, 69px) + 9px)",right:I.paddingLG},children:[(0,M.jsx)(k.Ay,{danger:!0,disabled:!R||!P,icon:(0,M.jsx)(v.A,{}),onClick:()=>{var e;null===(e=U.current)||void 0===e||e._openDeleteMultipleFileDialog()},children:$&&C("button.Delete")}),(0,M.jsx)(k.Ay,{disabled:!P,icon:(0,M.jsx)(f.A,{}),onClick:()=>{var e;null===(e=U.current)||void 0===e||e.openMkdirDialog()},children:$&&C("button.Create")}),(0,M.jsx)(F.A,{disabled:!P,menu:{items:[{key:"upload files",label:C("data.explorer.UploadFiles"),icon:(0,M.jsx)(y.A,{}),onClick:()=>{var e;null===(e=U.current)||void 0===e||e.handleUpload("file")}},{key:"upload folder",label:C("data.explorer.UploadFolder"),icon:(0,M.jsx)(f.A,{}),onClick:()=>{var e;null===(e=U.current)||void 0===e||e.handleUpload("folder")}}]},children:(0,M.jsx)(k.Ay,{icon:(0,M.jsx)(b.A,{}),children:$&&"Upload"})})]}),(0,M.jsx)("backend-ai-folder-explorer",{ref:U,active:!0,vfolderID:n})]})}},55352:(e,n,r)=>{r.r(n),r.d(n,{default:()=>l});const o=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],n=[{kind:"Variable",name:"id",variableName:"id"}],r={alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"LegacyFolderExplorerPermissionRefreshQuery",selections:[{alias:null,args:n,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[r,o],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"LegacyFolderExplorerPermissionRefreshQuery",selections:[{alias:null,args:n,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[r,o,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"17314dde5774ca1138e2dd2fe2de3ed5",id:null,metadata:{},name:"LegacyFolderExplorerPermissionRefreshQuery",operationKind:"query",text:"query LegacyFolderExplorerPermissionRefreshQuery(\n  $id: String!\n) {\n  vfolder_node(id: $id) {\n    permission\n    permissions\n    id\n  }\n}\n"}}}();o.hash="ade27c6d362e78425d85a2252aca2474";const l=o},78802:(e,n,r)=>{r.r(n),r.d(n,{default:()=>l});const o=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"vfolderID"},{defaultValue:null,kind:"LocalArgument",name:"vfolderUUID"}],n=[{kind:"Variable",name:"id",variableName:"vfolderID"}],r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},l=[{kind:"Variable",name:"id",variableName:"vfolderUUID"}],i={alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"LegacyFolderExplorerQuery",selections:[{alias:null,args:n,concreteType:"VirtualFolder",kind:"LinkedField",name:"vfolder",plural:!1,selections:[r,o,{args:null,kind:"FragmentSpread",name:"LegacyFolderExplorerVFolderFragment"}],storageKey:null},{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[r,i,o,{args:null,kind:"FragmentSpread",name:"LegacyFolderExplorerVFolderNodeFragment"}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"LegacyFolderExplorerQuery",selections:[{alias:null,args:n,concreteType:"VirtualFolder",kind:"LinkedField",name:"vfolder",plural:!1,selections:[r,o,a],storageKey:null},{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[r,i,o,a],storageKey:null}]},params:{cacheID:"8c077b15b4760cc27c1ba841b2a61c32",id:null,metadata:{},name:"LegacyFolderExplorerQuery",operationKind:"query",text:'query LegacyFolderExplorerQuery(\n  $vfolderID: String\n  $vfolderUUID: String!\n) {\n  vfolder(id: $vfolderID) @deprecatedSince(version: "24.03.4") {\n    id\n    permission\n    ...LegacyFolderExplorerVFolderFragment\n  }\n  vfolder_node(id: $vfolderUUID) @since(version: "24.03.4") {\n    id\n    user\n    permission\n    ...LegacyFolderExplorerVFolderNodeFragment\n  }\n}\n\nfragment LegacyFolderExplorerVFolderFragment on VirtualFolder {\n  id\n  name\n}\n\nfragment LegacyFolderExplorerVFolderNodeFragment on VirtualFolderNode {\n  id\n  name\n}\n'}}}();o.hash="9ded3fc41b00aaf0cc7a273a3ee1b564";const l=o},3716:(e,n,r)=>{r.r(n),r.d(n,{default:()=>l});const o={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"LegacyFolderExplorerVFolderFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"5cdf367fb7b2b81f92fcfa75747bcca7"},l=o},58072:(e,n,r)=>{r.r(n),r.d(n,{default:()=>l});const o={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"LegacyFolderExplorerVFolderNodeFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"c5e03778a59203c323cdfc9c4fde574f"},l=o},24764:(e,n,r)=>{r.d(n,{A:()=>K});var o=r(1426),l=r(45611),i=r(36443),a=r.n(i),t=r(3096),s=r(6387),d=r(85387),c=r(54375),u=r(24966),g=r(52595),p=r(32017),m=r(31887),v=r(29100),f=r(14518),y=r(45115),b=r(95399),x=r(55248),w=r(78830),S=r(42822),h=r(13691),k=r(41111),A=r(81713),F=r(42117),C=r(71720),I=r(57710),j=r(33541);const E=e=>({position:e||"absolute",inset:0}),L=e=>{const{iconCls:n,motionDurationSlow:r,paddingXXS:o,marginXXS:l,prefixCls:i,colorTextLightSolid:a}=e;return{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",color:a,background:new h.FastColor("#000").setA(.5).toRgbString(),cursor:"pointer",opacity:0,transition:`opacity ${r}`,[`.${i}-mask-info`]:Object.assign(Object.assign({},A.L9),{padding:`0 ${(0,S.unit)(o)}`,[n]:{marginInlineEnd:l,svg:{verticalAlign:"baseline"}}})}},N=e=>{const{previewCls:n,modalMaskBg:r,paddingSM:o,marginXL:l,margin:i,paddingLG:a,previewOperationColorDisabled:t,previewOperationHoverColor:s,motionDurationSlow:d,iconCls:c,colorTextLightSolid:u}=e,g=new h.FastColor(r).setA(.1),p=g.clone().setA(.2);return{[`${n}-footer`]:{position:"fixed",bottom:l,left:{_skip_check_:!0,value:"50%"},display:"flex",flexDirection:"column",alignItems:"center",color:e.previewOperationColor,transform:"translateX(-50%)"},[`${n}-progress`]:{marginBottom:i},[`${n}-close`]:{position:"fixed",top:l,right:{_skip_check_:!0,value:l},display:"flex",color:u,backgroundColor:g.toRgbString(),borderRadius:"50%",padding:o,outline:0,border:0,cursor:"pointer",transition:`all ${d}`,"&:hover":{backgroundColor:p.toRgbString()},[`& > ${c}`]:{fontSize:e.previewOperationSize}},[`${n}-operations`]:{display:"flex",alignItems:"center",padding:`0 ${(0,S.unit)(a)}`,backgroundColor:g.toRgbString(),borderRadius:100,"&-operation":{marginInlineStart:o,padding:o,cursor:"pointer",transition:`all ${d}`,userSelect:"none",[`&:not(${n}-operations-operation-disabled):hover > ${c}`]:{color:s},"&-disabled":{color:t,cursor:"not-allowed"},"&:first-of-type":{marginInlineStart:0},[`& > ${c}`]:{fontSize:e.previewOperationSize}}}}},M=e=>{const{modalMaskBg:n,iconCls:r,previewOperationColorDisabled:o,previewCls:l,zIndexPopup:i,motionDurationSlow:a}=e,t=new h.FastColor(n).setA(.1),s=t.clone().setA(.2);return{[`${l}-switch-left, ${l}-switch-right`]:{position:"fixed",insetBlockStart:"50%",zIndex:e.calc(i).add(1).equal(),display:"flex",alignItems:"center",justifyContent:"center",width:e.imagePreviewSwitchSize,height:e.imagePreviewSwitchSize,marginTop:e.calc(e.imagePreviewSwitchSize).mul(-1).div(2).equal(),color:e.previewOperationColor,background:t.toRgbString(),borderRadius:"50%",transform:"translateY(-50%)",cursor:"pointer",transition:`all ${a}`,userSelect:"none","&:hover":{background:s.toRgbString()},"&-disabled":{"&, &:hover":{color:o,background:"transparent",cursor:"not-allowed",[`> ${r}`]:{cursor:"not-allowed"}}},[`> ${r}`]:{fontSize:e.previewOperationSize}},[`${l}-switch-left`]:{insetInlineStart:e.marginSM},[`${l}-switch-right`]:{insetInlineEnd:e.marginSM}}},D=e=>{const{motionEaseOut:n,previewCls:r,motionDurationSlow:o,componentCls:l}=e;return[{[`${l}-preview-root`]:{[r]:{height:"100%",textAlign:"center",pointerEvents:"none"},[`${r}-body`]:Object.assign(Object.assign({},E()),{overflow:"hidden"}),[`${r}-img`]:{maxWidth:"100%",maxHeight:"70%",verticalAlign:"middle",transform:"scale3d(1, 1, 1)",cursor:"grab",transition:`transform ${o} ${n} 0s`,userSelect:"none","&-wrapper":Object.assign(Object.assign({},E()),{transition:`transform ${o} ${n} 0s`,display:"flex",justifyContent:"center",alignItems:"center","& > *":{pointerEvents:"auto"},"&::before":{display:"inline-block",width:1,height:"50%",marginInlineEnd:-1,content:'""'}})},[`${r}-moving`]:{[`${r}-preview-img`]:{cursor:"grabbing","&-wrapper":{transitionDuration:"0s"}}}}},{[`${l}-preview-root`]:{[`${r}-wrap`]:{zIndex:e.zIndexPopup}}},{[`${l}-preview-operations-wrapper`]:{position:"fixed",zIndex:e.calc(e.zIndexPopup).add(1).equal()},"&":[N(e),M(e)]}]},O=e=>{const{componentCls:n}=e;return{[n]:{position:"relative",display:"inline-block",[`${n}-img`]:{width:"100%",height:"auto",verticalAlign:"middle"},[`${n}-img-placeholder`]:{backgroundColor:e.colorBgContainerDisabled,backgroundImage:"url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTQuNSAyLjVoLTEzQS41LjUgMCAwIDAgMSAzdjEwYS41LjUgMCAwIDAgLjUuNWgxM2EuNS41IDAgMCAwIC41LS41VjNhLjUuNSAwIDAgMC0uNS0uNXpNNS4yODEgNC43NWExIDEgMCAwIDEgMCAyIDEgMSAwIDAgMSAwLTJ6bTguMDMgNi44M2EuMTI3LjEyNyAwIDAgMS0uMDgxLjAzSDIuNzY5YS4xMjUuMTI1IDAgMCAxLS4wOTYtLjIwN2wyLjY2MS0zLjE1NmEuMTI2LjEyNiAwIDAgMSAuMTc3LS4wMTZsLjAxNi4wMTZMNy4wOCAxMC4wOWwyLjQ3LTIuOTNhLjEyNi4xMjYgMCAwIDEgLjE3Ny0uMDE2bC4wMTUuMDE2IDMuNTg4IDQuMjQ0YS4xMjcuMTI3IDAgMCAxLS4wMi4xNzV6IiBmaWxsPSIjOEM4QzhDIiBmaWxsLXJ1bGU9Im5vbnplcm8iLz48L3N2Zz4=')",backgroundRepeat:"no-repeat",backgroundPosition:"center center",backgroundSize:"30%"},[`${n}-mask`]:Object.assign({},L(e)),[`${n}-mask:hover`]:{opacity:1},[`${n}-placeholder`]:Object.assign({},E())}}},$=e=>{const{previewCls:n}=e;return{[`${n}-root`]:(0,F.aB)(e,"zoom"),"&":(0,C.p9)(e,!0)}},T=(0,I.OF)("Image",(e=>{const n=`${e.componentCls}-preview`,r=(0,j.mergeToken)(e,{previewCls:n,modalMaskBg:new h.FastColor("#000").setA(.45).toRgbString(),imagePreviewSwitchSize:e.controlHeightLG});return[O(r),D(r),(0,k.Dk)((0,j.mergeToken)(r,{componentCls:n})),$(r)]}),(e=>({zIndexPopup:e.zIndexPopupBase+80,previewOperationColor:new h.FastColor(e.colorTextLightSolid).setA(.65).toRgbString(),previewOperationHoverColor:new h.FastColor(e.colorTextLightSolid).setA(.85).toRgbString(),previewOperationColorDisabled:new h.FastColor(e.colorTextLightSolid).setA(.25).toRgbString(),previewOperationSize:1.5*e.fontSizeIcon})));var z=function(e,n){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var l=0;for(o=Object.getOwnPropertySymbols(e);l<o.length;l++)n.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(e,o[l])&&(r[o[l]]=e[o[l]])}return r};const P={rotateLeft:o.createElement(f.A,null),rotateRight:o.createElement(y.A,null),zoomIn:o.createElement(x.A,null),zoomOut:o.createElement(w.A,null),close:o.createElement(p.A,null),left:o.createElement(m.A,null),right:o.createElement(v.A,null),flipX:o.createElement(b.A,null),flipY:o.createElement(b.A,{rotate:90})};var V=function(e,n){var r={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&n.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var l=0;for(o=Object.getOwnPropertySymbols(e);l<o.length;l++)n.indexOf(o[l])<0&&Object.prototype.propertyIsEnumerable.call(e,o[l])&&(r[o[l]]=e[o[l]])}return r};const R=e=>{const{prefixCls:n,preview:r,className:i,rootClassName:p,style:m}=e,v=V(e,["prefixCls","preview","className","rootClassName","style"]),{getPrefixCls:f,getPopupContainer:y,className:b,style:x,preview:w}=(0,c.TP)("image"),[S]=(0,g.A)("Image"),h=f("image",n),k=f(),A=(0,u.A)(h),[F,C,I]=T(h,A),j=a()(p,C,I,A),E=a()(i,C,b),[L]=(0,s.YK)("ImagePreview","object"===typeof r?r.zIndex:void 0),N=o.useMemo((()=>{if(!1===r)return r;const e="object"===typeof r?r:{},{getContainer:n,closeIcon:i,rootClassName:t}=e,s=V(e,["getContainer","closeIcon","rootClassName"]);return Object.assign(Object.assign({mask:o.createElement("div",{className:`${h}-mask-info`},o.createElement(l.A,null),null===S||void 0===S?void 0:S.preview),icons:P},s),{rootClassName:a()(j,t),getContainer:null!==n&&void 0!==n?n:y,transitionName:(0,d.b)(k,"zoom",e.transitionName),maskTransitionName:(0,d.b)(k,"fade",e.maskTransitionName),zIndex:L,closeIcon:null!==i&&void 0!==i?i:null===w||void 0===w?void 0:w.closeIcon})}),[r,S,null===w||void 0===w?void 0:w.closeIcon]),M=Object.assign(Object.assign({},x),m);return F(o.createElement(t.default,Object.assign({prefixCls:h,preview:N,rootClassName:j,className:E,style:M},v)))};R.PreviewGroup=e=>{var{previewPrefixCls:n,preview:r}=e,l=z(e,["previewPrefixCls","preview"]);const{getPrefixCls:i}=o.useContext(c.QO),g=i("image",n),p=`${g}-preview`,m=i(),v=(0,u.A)(g),[f,y,b]=T(g,v),[x]=(0,s.YK)("ImagePreview","object"===typeof r?r.zIndex:void 0),w=o.useMemo((()=>{var e;if(!1===r)return r;const n="object"===typeof r?r:{},o=a()(y,b,v,null!==(e=n.rootClassName)&&void 0!==e?e:"");return Object.assign(Object.assign({},n),{transitionName:(0,d.b)(m,"zoom",n.transitionName),maskTransitionName:(0,d.b)(m,"fade",n.maskTransitionName),rootClassName:o,zIndex:x})}),[r]);return f(o.createElement(t.default.PreviewGroup,Object.assign({preview:w,previewPrefixCls:p,icons:P},l)))};const K=R}}]);
//# sourceMappingURL=9697.ae157fd2.chunk.js.map