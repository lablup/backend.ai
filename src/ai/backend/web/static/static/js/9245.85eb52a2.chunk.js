"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[9245],{21817:(e,n,s)=>{s.d(n,{A:()=>m});var t=s(24180),l=s(91439),i=s(70127),a=s.n(i),o=s(43749),r=s.n(o),d=s(21481),u=s(66845);const c=d.forwardRef(((e,n)=>{let{value:s,onChange:i,localFormat:o,...d}=e;const[,c]=(0,t.A)({value:s,onChange:i});return(0,u.jsx)(l.A,{ref:n,value:s?a()(s):void 0,onChange:e=>{var n,s,t;r().isArray(e)&&(e=e[0]);const l=o?null===(n=e)||void 0===n?void 0:n.format():null===(s=e)||void 0===s||null===(t=s.tz())||void 0===t?void 0:t.toISOString();c(l)},...d})}));c.displayName="DatePickerISO";const m=c},69589:(e,n,s)=>{s.d(n,{A:()=>a});var t=s(40370),l=s(21481),i=s(66845);const a=e=>{let{value:n,...s}=e;const a=t.A.useFormInstance();return(0,l.useEffect)((()=>{a.setFieldValue(s.name,n)}),[n,a,s.name]),(0,i.jsx)(t.A.Item,{...s,hidden:!0,children:(0,i.jsx)("div",{})})}},94252:(e,n,s)=>{s.d(n,{Ay:()=>x,tt:()=>v,uD:()=>h});var t=s(43224),l=s(40370),i=s(89881),a=s(85829),o=s(43749),r=s.n(o),d=(s(21481),s(51569)),u=s(66845);const c=1024,m=65535,h=e=>{let{inValid:n,value:s,...t}=e;return(0,u.jsx)(a.A,{color:!n&&p(s)?void 0:"red",...t})},p=e=>{if(g(e)){const n=e.split(":"),[s,t]=n.map((e=>parseInt(e)));return s>=c&&t<=m}return e===parseInt(e).toString()&&parseInt(e)>=c&&parseInt(e)<=m},g=e=>{const n=e.split(":");if(2===n.length){const[e,s]=n.map((e=>parseInt(e)));return e<=s}return!1},v=e=>r().flatten(r().map(e,(e=>g(e)?(e=>{const[n,s]=e.split(":").map((e=>parseInt(e)));return r().range(n,s+1)})(e):parseInt(e)))),x=e=>{let{name:n="ports",...s}=e;const{t:a}=(0,d.Bd)(),o=(0,t.CX)(),p=l.A.useFormInstance();return(0,u.jsx)(l.A.Item,{label:a("session.launcher.PreOpenPortTitle"),name:n,tooltip:(0,u.jsx)(d.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:a("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,n)=>v(n).length<=o._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(a("session.launcher.PreOpenPortMaxCountLimit",{count:o._config.maxCountForPreopenPorts})))}),()=>({validator:(e,n)=>r().every(n,(e=>parseInt(e).toString()===e||g(e)))?Promise.resolve():Promise.reject(new Error(a("session.launcher.InvalidPortFormat")))}),()=>({validator(e,n){const s=v(n);return r().every(s,(e=>e>=c&&e<=m))?Promise.resolve():Promise.reject(new Error(a("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,n){const s=v(n);return r().uniq(s).length===s.length?Promise.resolve():Promise.reject(new Error(a("session.launcher.DuplicatedPort")))}})],...s,children:(0,u.jsx)(i.A,{mode:"tags",tagRender:e=>{const s=r().filter(v(p.getFieldValue(n)),(n=>n===parseInt(e.value))).length>1;return(0,u.jsx)(h,{inValid:s,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})}},43352:(e,n,s)=>{s.d(n,{dM:()=>g,GQ:()=>v});const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],n=[{kind:"Variable",name:"id",variableName:"id"}],s={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useStartSessionCreationQuery",selections:[{alias:null,args:n,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"BAINodeNotificationItemFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useStartSessionCreationQuery",selections:[{alias:null,args:n,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[s,{kind:"InlineFragment",selections:[{kind:"InlineFragment",selections:[t,l,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},i,{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commit_status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"agent_id",storageKey:null},s,i,{alias:null,args:null,kind:"ScalarField",name:"cluster_idx",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_role",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_hostname",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"vfolder_mounts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_data",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"queue_position",storageKey:null}],type:"ComputeSessionNode",abstractKey:null},{kind:"InlineFragment",selections:[t,l],type:"VirtualFolderNode",abstractKey:null}],type:"Node",abstractKey:"__isNode"}],storageKey:null}]},params:{cacheID:"f782d7867b29fc40f57266d16809b260",id:null,metadata:{},name:"useStartSessionCreationQuery",operationKind:"query",text:'query useStartSessionCreationQuery(\n  $id: GlobalIDField!\n) {\n  compute_session_node(id: $id) {\n    ...BAINodeNotificationItemFragment\n    id\n  }\n}\n\nfragment AppLauncherModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  service_ports\n  access_key\n}\n\nfragment BAIComputeSessionNodeNotificationItemFragment on ComputeSessionNode {\n  row_id\n  id\n  name\n  status\n  ...SessionActionButtonsFragment\n  ...SessionStatusTagFragment\n}\n\nfragment BAINodeNotificationItemFragment on Node {\n  __isNode: __typename\n  ... on ComputeSessionNode {\n    __typename\n    status\n    name\n    row_id\n    ...BAIComputeSessionNodeNotificationItemFragment\n  }\n  ... on VirtualFolderNode {\n    __typename\n    status\n  }\n  id\n}\n\nfragment ContainerCommitModalFragment on ComputeSessionNode {\n  id\n  name\n  row_id\n}\n\nfragment ContainerLogModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  status\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        id\n        row_id\n        container_id\n        cluster_idx\n        cluster_role\n        cluster_hostname\n      }\n    }\n  }\n}\n\nfragment SFTPConnectionInfoModalFragment on ComputeSessionNode {\n  row_id\n  vfolder_mounts\n}\n\nfragment SessionActionButtonsFragment on ComputeSessionNode {\n  id\n  name\n  row_id\n  type\n  status\n  access_key\n  service_ports\n  commit_status\n  user_id\n  ...TerminateSessionModalFragment\n  ...ContainerLogModalFragment\n  ...ContainerCommitModalFragment\n  ...AppLauncherModalFragment\n  ...SFTPConnectionInfoModalFragment\n  ...useBackendAIAppLauncherFragment\n}\n\nfragment SessionStatusTagFragment on ComputeSessionNode {\n  id\n  status\n  status_info\n  status_data\n  queue_position @since(version: "25.13.0")\n}\n\nfragment TerminateSessionModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  scaling_group\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        container_id\n        agent_id\n        id\n      }\n    }\n  }\n}\n\nfragment useBackendAIAppLauncherFragment on ComputeSessionNode {\n  name\n  row_id\n  vfolder_mounts\n}\n'}}}();t.hash="7a350248b5a833005f531bd8caa3adec";const l=t;var i=s(43224),a=s(41633),o=s(16507),r=s(45045),d=s(43749),u=s.n(d),c=s(51569),m=s(69775),h=s(94252),p=s(88144);const g={DUPLICATED_SESSION:"DUPLICATED_SESSION"},v=()=>{var e,n;const{t:s}=(0,c.Bd)(),t=(0,o.hd)(),{upsertNotification:d}=(0,a.js)(),v=(0,m.useRelayEnvironment)(),j=(0,i.CX)(),A=j.supports("mount-by-id"),b=null!==(e=null===j||void 0===j?void 0:j.supports("batch-timeout"))&&void 0!==e&&e,[F]=(0,o.zL)(),S={sessionType:"interactive",allocationPreset:"auto-select",hpcOptimization:{autoEnabled:!0},batch:{enabled:!1,command:void 0,scheduleDate:void 0,...b&&{timeoutEnabled:!1,timeout:void 0,timeoutUnit:"s"}},envvars:[],...(null===(n=j._config)||void 0===n?void 0:n.default_session_environment)&&{environments:y(j._config.default_session_environment)},...p.jh,resourceGroup:F||void 0},f=async e=>{var n,l,i,a,o,d,c,m,p,v,y;const F=e.environments.manual||e.environments.version,[S,f]=F?F.split("@"):["",""],k={sessionName:u().isEmpty(e.sessionName)?x():e.sessionName,kernelName:S,architecture:f,resources:{enqueueOnly:!0,group_name:null!==(n=e.owner)&&void 0!==n&&n.enabled?e.owner.project:t.name,domain:null!==(l=e.owner)&&void 0!==l&&l.enabled?e.owner.domainName:j._config.domainName,type:e.sessionType,cluster_mode:e.cluster_mode,cluster_size:e.cluster_size,maxWaitSeconds:15,...null!==(i=e.owner)&&void 0!==i&&i.enabled?{owner_access_key:e.owner.accesskey}:{},..."batch"===e.sessionType?{starts_at:e.batch.enabled?e.batch.scheduleDate:void 0,startupCommand:e.batch.command}:{},...e.bootstrap_script?{bootstrap_script:e.bootstrap_script}:{},...b&&null!==e&&void 0!==e&&null!==(a=e.batch)&&void 0!==a&&a.timeoutEnabled&&!u().isUndefined(null===e||void 0===e||null===(o=e.batch)||void 0===o?void 0:o.timeout)?{batchTimeout:u().toString(e.batch.timeout)+(null===e||void 0===e||null===(d=e.batch)||void 0===d?void 0:d.timeoutUnit)}:void 0,config:{resources:{cpu:e.resource.cpu,mem:e.resource.mem,...null!==(c=e.resource)&&void 0!==c&&c.acceleratorType&&null!==(m=e.resource)&&void 0!==m&&m.accelerator&&(null===(p=e.resource)||void 0===p?void 0:p.accelerator)>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0},scaling_group:null!==(v=e.owner)&&void 0!==v&&v.enabled?e.owner.project:e.resourceGroup,resource_opts:{shmem:e.resource.shmem},[A?"mount_ids":"mounts"]:e.mount_ids,[A?"mount_id_map":"mount_map"]:e.mount_id_map,environ:{...u().fromPairs(e.envvars.map((e=>[e.variable,e.value]))),...e.hpcOptimization.autoEnabled?{}:u().omit(e.hpcOptimization,"autoEnabled")},preopen_ports:(0,h.tt)(e.ports),...!j.supports("agent-select")||null!==j&&void 0!==j&&null!==(y=j._config)&&void 0!==y&&y.hideAgents||void 0===e.agent||u().isEqual(u().castArray(e.agent),["auto"])?void 0:{agent_list:u().chain(e.agent).castArray().filter((e=>!!e)).value()}}}},w=u().map(u().range(e.num_of_sessions||1),(n=>{const t=(e.num_of_sessions||1)>1?`${k.sessionName}-${(0,r.kX)()}-${n}`:k.sessionName;return j.createIfNotExists(k.kernelName,t,k.resources,void 0,k.architecture).then((e=>{if(null===e||void 0===e||!e.created){throw new Error(g.DUPLICATED_SESSION)}return e})).catch((e=>{var n;throw null!==e&&void 0!==e&&null!==(n=e.message)&&void 0!==n&&n.includes("The session already exists")?new Error(s("session.launcher.SessionAlreadyExists")):e}))}));return Promise.allSettled(w).then((async e=>u().groupBy(e,"status")))};return{startSession:f,startSessionWithDefault:e=>{const n=u().merge({},S,e);return f(n)},defaultFormValues:S,upsertSessionNotification:async(e,n)=>{const s=u().map(e,(e=>{const s=e.value;return(0,m.fetchQuery)(v,l,{id:(0,r.wc)("ComputeSessionNode",s.sessionId)}).toPromise().then((e=>{var t;const l=null!==(t=null===e||void 0===e?void 0:e.compute_session_node)&&void 0!==t?t:null;l&&d({key:`session-launcher:${s.sessionId}`,node:l,open:!0,duration:0,...null===n||void 0===n?void 0:n[0]},null===n||void 0===n?void 0:n[1])}))}));return Promise.allSettled(s)}}},x=()=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<8;s++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},y=e=>e.includes(":")?{version:e}:{environment:e}},43699:(e,n,s)=>{s.d(n,{f:()=>c});const t=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"projectId"},s=[{alias:null,args:[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"project_id",variableName:"projectId"}],concreteType:"ComputeSessionConnection",kind:"LinkedField",name:"compute_session_nodes",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"count",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n],kind:"Fragment",metadata:null,name:"useValidateSessionNameQuery",selections:s,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e],kind:"Operation",name:"useValidateSessionNameQuery",selections:s},params:{cacheID:"2392cc957c8d4e1b5ff8eb0717faa135",id:null,metadata:{},name:"useValidateSessionNameQuery",operationKind:"query",text:"query useValidateSessionNameQuery(\n  $projectId: UUID!\n  $filter: String\n) {\n  compute_session_nodes(project_id: $projectId, filter: $filter) {\n    count\n  }\n}\n"}}}();t.hash="4384b91173f16b29861a6bb9cfa6cbfa";const l=t;var i=s(16507),a=s(43749),o=s.n(a),r=s(21481),d=s(51569),u=s(69775);const c=e=>{const{t:n}=(0,d.Bd)(),s=(0,u.useRelayEnvironment)(),t=(0,i.hd)();return(0,r.useMemo)((()=>[{min:4,message:n("session.validation.SessionNameTooShort")},{max:64,message:n("session.validation.SessionNameTooLong64")},{validator:(e,s)=>o().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/\w$/.test(s)?/^[\w.-]*$/.test(s)?Promise.resolve():Promise.reject(n("session.validation.SessionNameInvalidCharacter")):Promise.reject(n("session.validation.SessionNameShouldEndWith")):Promise.reject(n("session.validation.SessionNameShouldStartWith"))},{validator:async(i,a)=>a!==e&&a?(0,u.fetchQuery)(s,l,{projectId:t.id,filter:`status != "TERMINATED" & status != "CANCELLED" & name == "${a}"`}).toPromise().catch((()=>{})).then((e=>{var s,t;if((null!==(s=null===e||void 0===e||null===(t=e.compute_session_nodes)||void 0===t?void 0:t.count)&&void 0!==s?s:0)>0)return Promise.reject(n("session.launcher.SessionAlreadyExists"))})):Promise.resolve()},e?{required:!0}:{}]),[e,s,t.id,n])}},19245:(e,n,s)=>{s.r(n),s.d(n,{ResourceNumbersOfSession:()=>Me,default:()=>Ke});var t=s(78524),l=s(21817),i=s(62448),a=s(28902),o=s(61421),r=s(94252),d=s(1809),u=s(88144),c=s(497),m=s(65319),h=s(21481),p=s(51569),g=s(66845);const v=e=>{let{open:n,onClose:s,...t}=e;const{t:l}=(0,p.Bd)(),[i,a]=(0,c.q)("has_opened_tour_neo_session_validation"),o=[{title:l("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:l("tourGuide.neoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:l("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:l("tourGuide.neoSessionLauncher.FixErrorFieldByModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:l("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:l("tourGuide.neoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,g.jsx)(m.A,{steps:o,onClose:e=>{null===s||void 0===s||s(e),a(!0)},open:!i&&n,...t})};var x=s(40370),y=s(52688),j=s(43749),A=s.n(j);const b=e=>{let{form:n}=e;const s=x.A.useWatch("mounts",n),t=y.A.useApp(),{t:l}=(0,p.Bd)(),i=(0,h.useMemo)((()=>A().isArray(s)&&s.length>0),[s]);return(0,h.useEffect)((()=>{i&&(t.message.warning(l("session.launcher.InvalidMountsSelectionWarning"),5),n.setFieldValue("mounts",void 0))}),[i,l,t.message,n]),null};var F=s(92882),S=s(43224),f=s(16507),k=s(11271),w=s(54028),_=s(80785),I=s(143),N=s(61862);const E=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],s={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},l],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,i],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s,l],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,i,l],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();E.hash="ba086835ea654ab889e0e6aaefa0abfe";const V=E;var O=s(23054),T=s(28380),C=s(38728),P=s(69589),D=s(20753),B=s(234),M=s(77264),K=s(50069),L=s(73017),z=s(93685),R=s(84928),q=s(57442),U=s(89881),G=s(77419),W=s(45045),Q=s(68619),$=s(69775);const H=e=>{const{t:n}=(0,p.Bd)(),s=x.A.useFormInstance(),t=x.A.useWatch(["owner","enabled"],s),l=(0,O.Am)();return("admin"===l||"superadmin"===l)&&t&&(0,g.jsx)(W.Zu,{title:n("session.launcher.SetSessionOwner"),showDivider:!0,size:"small",status:s.getFieldError(["owner","email"]).length>0||s.getFieldError(["owner","accesskey"]).length>0||s.getFieldError(["owner","project"]).length>0||s.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit"),...e,children:(0,g.jsxs)(G.A,{size:"small",column:1,children:[(0,g.jsx)(G.A.Item,{label:n("session.launcher.OwnerEmail"),children:s.getFieldValue(["owner","email"])}),(0,g.jsx)(G.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:s.getFieldValue(["owner","accesskey"])}),(0,g.jsx)(G.A.Item,{label:n("session.launcher.OwnerGroup"),children:s.getFieldValue(["owner","project"])}),(0,g.jsx)(G.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:s.getFieldValue(["owner","resourceGroup"])})]})})},J=e=>{const{t:n}=(0,p.Bd)(),{token:s}=B.A.useToken(),t=x.A.useFormInstance(),l=x.A.useWatch(["owner","enabled"],t),[i,a]=(0,h.useState)(),o=(0,$.useRelayEnvironment)(),{data:r,isFetching:d}=(0,T.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",i],queryFn:()=>{const e=t.getFieldValue(["owner","email"]);if(!e)return;const n=V;return(0,$.fetchQuery)(o,n,{email:e}).toPromise()},enabled:!!i}),u=t.getFieldValue(["owner","email"])?null===r||void 0===r?void 0:r.keypairs:void 0,c=t.getFieldValue(["owner","email"])?null===r||void 0===r?void 0:r.user:void 0,m=!d&&i&&!c;return(0,g.jsxs)(M.A,{title:n("session.launcher.SetSessionOwner"),extra:(0,g.jsx)(x.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,g.jsx)(K.A,{})}),styles:l?void 0:{header:{borderBottom:"none"},body:{display:l?"block":"none"}},...e,children:[(0,g.jsx)(P.A,{name:["owner","domainName"],value:null===c||void 0===c?void 0:c.domain_name}),(0,g.jsx)(x.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:o}=e;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(W.OO,{children:(0,g.jsx)(x.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:l},{type:"email",message:n("general.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:m?"error":void 0,help:m?n("credential.NoUserToDisplay"):void 0,children:(0,g.jsx)(L.A.Search,{onSearch:e=>{t.validateFields([["owner","email"]]).then((()=>{a(e)})).catch((()=>{}))},onChange:()=>{a(""),t.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:d,enterButton:!d&&c?(0,g.jsx)(z.Ay,{icon:(0,g.jsx)(Q.A,{})}):void 0})})}),(0,g.jsx)(x.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:o(["owner","enabled"])}],children:(0,g.jsx)(C.A,{options:A().map(u,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:A().isEmpty(i)||d})}),(0,g.jsxs)(R.A,{gutter:s.marginSM,children:[(0,g.jsx)(q.A,{span:12,children:(0,g.jsx)(x.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:o(["owner","enabled"])}],children:(0,g.jsx)(C.A,{options:A().map(null===c||void 0===c?void 0:c.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:A().isEmpty(i)||d})})}),(0,g.jsx)(q.A,{span:12,children:(0,g.jsx)(x.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,g.jsx)(h.Suspense,{fallback:(0,g.jsx)(x.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,g.jsx)(U.A,{loading:!0})}),children:(0,g.jsx)(x.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:s(["owner","project"])?(0,g.jsx)(D.A,{projectName:s(["owner","project"]),disabled:A().isEmpty(i)||d,autoSelectDefault:!0}):(0,g.jsx)(U.A,{disabled:!0})})})}})})]})]})}})]})};var X=s(60597),Z=s(8334),Y=s(60402),ee=s(85829),ne=s(54575),se=s(15717),te=s(70127),le=s.n(te),ie=s(38715),ae=s(29949);const oe=e=>{var n,s,t,l,i,a,o,d,u,c,m,h,v,j,b,E,V,O,T,C,P,D,K,L,U,Q,$,J,te,oe,re,de,ue,ce,me,he;let{onClickEditStep:pe}=e;const ge=y.A.useApp(),{t:ve}=(0,p.Bd)(),xe=x.A.useFormInstance(),{token:ye}=B.A.useToken(),je=(0,S.CX)(),Ae=x.A.useWatch("sessionType",{form:xe,preserve:!0}),be=null!==(n=null===je||void 0===je?void 0:je.supports("batch-timeout"))&&void 0!==n&&n,Fe=null!==(s=null===je||void 0===je?void 0:je.supports("extended-image-info"))&&void 0!==s&&s,Se=(0,f.hd)(),[,{getBaseVersion:fe,getBaseImage:ke,tagAlias:we}]=(0,S.Gj)(),{isDarkMode:_e}=(0,k.e)();return(0,g.jsxs)(g.Fragment,{children:[xe.getFieldValue("bootstrap_script")&&(0,g.jsx)(w.A,{description:ve("session.launcher.UsingBootstrapScriptInfo"),ghostInfoBg:!1,action:(0,g.jsx)(z.Ay,{size:"small",type:"text",onClick:()=>{ge.modal.info({title:ve("session.launcher.BootstrapScriptDetail"),content:(0,g.jsxs)(W.OO,{direction:"column",align:"start",children:[(0,g.jsx)(Z.A.Paragraph,{children:ve("userSettings.BootstrapScriptDescription")}),(0,g.jsx)(X.A,{wordWrap:!0,language:"shell",children:xe.getFieldValue("bootstrap_script")})]}),width:800})},children:ve("notification.SeeDetail")}),type:"info",showIcon:!0}),(0,g.jsx)(W.Zu,{title:ve("session.launcher.SessionType"),showDivider:!0,size:"small",status:xe.getFieldError("sessionName").length>0||xe.getFieldError(["batch","command"]).length>0||xe.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{pe("sessionType")},children:(0,g.jsxs)(G.A,{size:"small",column:1,children:[(0,g.jsx)(G.A.Item,{label:ve("session.SessionType"),children:xe.getFieldValue("sessionType")}),!A().isEmpty(xe.getFieldValue("sessionName"))&&(0,g.jsx)(G.A.Item,{label:ve("session.launcher.SessionName"),children:xe.getFieldValue("sessionName")}),"batch"===Ae&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(G.A.Item,{label:ve("session.launcher.StartUpCommand"),styles:{label:{whiteSpace:"nowrap"},content:{overflow:"auto"}},children:xe.getFieldValue(["batch","command"])?(0,g.jsx)(X.A,{language:"shell",children:xe.getFieldValue(["batch","command"])}):(0,g.jsx)(Z.A.Text,{type:"secondary",children:ve("general.None")})}),(0,g.jsx)(G.A.Item,{label:ve("session.launcher.SessionStartTime"),children:xe.getFieldValue(["batch","scheduleDate"])?le()(xe.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,g.jsx)(Z.A.Text,{type:"secondary",children:ve("general.None")})}),be?(0,g.jsx)(G.A.Item,{label:ve("session.launcher.BatchJobTimeoutDuration"),children:xe.getFieldValue(["batch","timeout"])?(0,g.jsxs)(Z.A.Text,{children:[xe.getFieldValue(["batch","timeout"]),xe.getFieldValue(["batch","timeoutUnit"])||"s"]}):(0,g.jsx)(Z.A.Text,{type:"secondary",children:ve("general.None")})}):null]})]})}),(0,g.jsx)(H,{onClickExtraButton:()=>{pe("sessionType")}}),(0,g.jsx)(W.Zu,{title:ve("session.launcher.Environments"),showDivider:!0,size:"small",status:A().some(xe.getFieldValue("envvars"),((e,n)=>xe.getFieldError(["envvars",n,"variable"]).length>0||xe.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{pe("environment")},children:(0,g.jsxs)(G.A,{size:"small",column:1,children:[(0,g.jsx)(G.A.Item,{label:ve("session.launcher.Project"),children:Se.name}),(0,g.jsx)(G.A.Item,{label:ve("general.Image"),children:Fe?(0,g.jsxs)(R.A,{style:{flexFlow:"nowrap"},children:[(0,g.jsx)(q.A,{children:(0,g.jsx)(I.A,{image:(null===(t=xe.getFieldValue("environments"))||void 0===t?void 0:t.version)||(null===(l=xe.getFieldValue("environments"))||void 0===l?void 0:l.manual),style:{marginRight:ye.marginXS}})}),(0,g.jsx)(q.A,{children:(0,g.jsx)(W.OO,{direction:"row",wrap:"wrap",children:null!==(i=xe.getFieldValue("environments"))&&void 0!==i&&i.manual?(0,g.jsx)(Z.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(a=xe.getFieldValue("environments"))||void 0===a?void 0:a.manual},children:null===(o=xe.getFieldValue("environments"))||void 0===o?void 0:o.manual}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(Z.A.Text,{children:we(null===(d=xe.getFieldValue("environments"))||void 0===d||null===(u=d.image)||void 0===u?void 0:u.base_image_name)}),(0,g.jsx)(Y.A,{type:"vertical"}),(0,g.jsx)(Z.A.Text,{children:null===(c=xe.getFieldValue("environments"))||void 0===c||null===(m=c.image)||void 0===m?void 0:m.version}),(0,g.jsx)(Y.A,{type:"vertical"}),(0,g.jsx)(Z.A.Text,{children:null===(h=xe.getFieldValue("environments"))||void 0===h||null===(v=h.image)||void 0===v?void 0:v.architecture}),(0,g.jsx)(Y.A,{type:"vertical"}),A().map(null===(j=xe.getFieldValue("environments"))||void 0===j||null===(b=j.image)||void 0===b?void 0:b.tags,(e=>{var n,s,t;const l=A().includes(e.key,"customized_"),i=l?null===(n=A().find(null===(s=xe.getFieldValue("environments"))||void 0===s||null===(t=s.image)||void 0===t?void 0:t.labels,{key:"ai.backend.customized-image.name"}))||void 0===n?void 0:n.value:e.value,a=we(e.key+i);return A().isEqual(a,(0,F.WY)(e.key+i))||l?(0,g.jsx)(_.A,{values:[{label:we(e.key),color:l?"cyan":"blue"},{label:i,color:l?"cyan":"blue"}]},e.key):(0,g.jsx)(ee.A,{color:l?"cyan":"blue",children:a},e.key)})),(0,g.jsx)(Z.A.Text,{style:{color:ye.colorPrimary},copyable:{text:(0,F.A_)(null===(E=xe.getFieldValue("environments"))||void 0===E?void 0:E.image)||(null===(V=xe.getFieldValue("environments"))||void 0===V?void 0:V.version)}})]})})})]}):(0,g.jsxs)(R.A,{style:{flexFlow:"nowrap",gap:ye.sizeXS},children:[(0,g.jsx)(q.A,{children:(0,g.jsx)(I.A,{image:(null===(O=xe.getFieldValue("environments"))||void 0===O?void 0:O.version)||(null===(T=xe.getFieldValue("environments"))||void 0===T?void 0:T.manual)})}),(0,g.jsx)(q.A,{children:(0,g.jsx)(W.OO,{direction:"row",wrap:"wrap",children:null!==(C=xe.getFieldValue("environments"))&&void 0!==C&&C.manual?(0,g.jsx)(Z.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(P=xe.getFieldValue("environments"))||void 0===P?void 0:P.manual},children:null===(D=xe.getFieldValue("environments"))||void 0===D?void 0:D.manual}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(Z.A.Text,{children:we(ke(null===(K=xe.getFieldValue("environments"))||void 0===K?void 0:K.version))}),(0,g.jsx)(Y.A,{type:"vertical"}),(0,g.jsx)(Z.A.Text,{children:fe(null===(L=xe.getFieldValue("environments"))||void 0===L?void 0:L.version)}),(0,g.jsx)(Y.A,{type:"vertical"}),(0,g.jsx)(Z.A.Text,{children:null===(U=xe.getFieldValue("environments"))||void 0===U||null===(Q=U.image)||void 0===Q?void 0:Q.architecture}),(0,g.jsx)(Y.A,{type:"vertical"}),(0,g.jsx)(N.J,{tag:xe.getFieldValue(["environments","image","tag"]),labels:null===($=xe.getFieldValue("environments"))||void 0===$||null===(J=$.image)||void 0===J?void 0:J.labels}),(0,g.jsx)(Z.A.Text,{style:{color:ye.colorPrimary},copyable:{text:(0,F.A_)(null===(te=xe.getFieldValue("environments"))||void 0===te?void 0:te.image)||(null===(oe=xe.getFieldValue("environments"))||void 0===oe?void 0:oe.version)}})]})})})]})}),(null===(re=xe.getFieldValue("envvars"))||void 0===re?void 0:re.length)>0&&(0,g.jsx)(G.A.Item,{label:ve("session.launcher.EnvironmentVariable"),children:null!==(de=xe.getFieldValue("envvars"))&&void 0!==de&&de.length?(0,g.jsx)(ie.A,{style:_e?ae.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:A().map(xe.getFieldValue("envvars"),(e=>`${(null===e||void 0===e?void 0:e.variable)||""}="${(null===e||void 0===e?void 0:e.value)||""}"`)).join("\n")}):(0,g.jsx)(Z.A.Text,{type:"secondary",children:"-"})})]})}),(0,g.jsx)(W.Zu,{title:ve("session.launcher.ResourceAllocation"),showDivider:!0,status:A().some(xe.getFieldValue("resource"),((e,n)=>xe.getFieldError(["resource",n]).length>0))||xe.getFieldError(["num_of_sessions"]).length>0||xe.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{pe("environment")},children:(0,g.jsxs)(W.OO,{direction:"column",align:"stretch",children:[A().some(xe.getFieldValue("resource"),((e,n)=>xe.getFieldWarning(["resource",n]).length>0))&&(0,g.jsx)(ne.A,{type:"warning",showIcon:!0,message:ve("session.launcher.EnqueueComputeSessionWarning")}),(0,g.jsxs)(G.A,{column:2,children:[(0,g.jsx)(G.A.Item,{label:ve("general.ResourceGroup"),span:2,children:xe.getFieldValue("resourceGroup")||(0,g.jsx)(Z.A.Text,{type:"secondary",children:ve("general.None")})}),(0,g.jsx)(G.A.Item,{label:ve("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,g.jsxs)(W.OO,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===xe.getFieldValue("allocationPreset")?"":(0,g.jsx)(ee.A,{children:xe.getFieldValue("allocationPreset")}),(0,g.jsx)(Me,{resource:xe.getFieldValue("resource")})]})}),je.supports("agent-select")&&!(null!==je&&void 0!==je&&null!==(ue=je._config)&&void 0!==ue&&ue.hideAgents)&&(0,g.jsx)(G.A.Item,{label:ve("session.launcher.AgentNode"),children:A().castArray(xe.getFieldValue("agent")).join(", ")||ve("session.launcher.AutoSelect")}),(0,g.jsx)(G.A.Item,{label:ve("session.launcher.NumberOfContainer"),children:1===xe.getFieldValue("cluster_size")?xe.getFieldValue("num_of_sessions"):xe.getFieldValue("cluster_size")}),(0,g.jsx)(G.A.Item,{label:ve("session.launcher.ClusterMode"),children:"single-node"===xe.getFieldValue("cluster_mode")?ve("session.launcher.SingleNode"):ve("session.launcher.MultiNode")})]}),(0,g.jsx)(M.A,{size:"small",type:"inner",title:ve("session.launcher.TotalAllocation"),children:(0,g.jsx)(W.OO,{direction:"row",gap:"xxs",children:(0,g.jsx)(Me,{resource:xe.getFieldValue("resource"),containerCount:1===xe.getFieldValue("cluster_size")?xe.getFieldValue("num_of_sessions"):xe.getFieldValue("cluster_size")})})})]})}),(0,g.jsx)(W.Zu,{title:ve("webui.menu.Data&Storage"),showDivider:!0,size:"small",status:xe.getFieldError("mount_id_map").length>0?"error":void 0,extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{pe("storage")},children:(0,g.jsxs)(W.OO,{direction:"column",align:"stretch",gap:"xs",children:[(null===(ce=xe.getFieldValue("mount_ids"))||void 0===ce?void 0:ce.length)>0?(0,g.jsx)(se.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:ve("data.folders.Name")},{dataIndex:"alias",title:ve("session.launcher.FolderAlias"),render:(e,n)=>A().isEmpty(e)?(0,g.jsx)(Z.A.Text,{type:"secondary",style:{opacity:.7},children:`/home/work/${n.name}`}):e}],dataSource:A().map(xe.getFieldValue("mount_ids"),(e=>{var n,s;return{name:(null===(n=xe.getFieldValue("vfoldersNameMap"))||void 0===n?void 0:n[e])||e,alias:null===(s=xe.getFieldValue("mount_id_map"))||void 0===s?void 0:s[e]}}))}):(0,g.jsx)(ne.A,{type:"warning",showIcon:!0,message:ve("session.launcher.NoFolderMounted")}),(null===(me=xe.getFieldValue("autoMountedFolderNames"))||void 0===me?void 0:me.length)>0?(0,g.jsx)(G.A,{size:"small",children:(0,g.jsx)(G.A.Item,{label:ve("data.AutomountFolders"),children:A().map(xe.getFieldValue("autoMountedFolderNames"),(e=>(0,g.jsx)(ee.A,{children:e})))})}):null]})}),(0,g.jsx)(W.Zu,{title:"Network",showDivider:!0,size:"small",status:xe.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{pe("network")},children:(0,g.jsx)(G.A,{size:"small",children:(0,g.jsx)(G.A.Item,{label:ve("session.launcher.PreOpenPortTitle"),children:(0,g.jsxs)(W.OO,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[A().sortBy(xe.getFieldValue("ports"),(e=>parseInt(e))).map(((e,n)=>(0,g.jsx)(r.uD,{value:e,style:{margin:0},children:e},n+e))),A().isArray(xe.getFieldValue("ports"))&&0!==(null===(he=xe.getFieldValue("ports"))||void 0===he?void 0:he.length)?null:(0,g.jsx)(Z.A.Text,{type:"secondary",children:ve("general.None")})]})})})})]})};var re=s(43699);const de=e=>{let{...n}=e;const{t:s}=(0,p.Bd)(),t=(0,re.f)();return(0,g.jsx)(x.A.Item,{label:s("session.launcher.SessionName"),name:"sessionName",validateDebounce:200,rules:t,...n,children:(0,g.jsx)(L.A,{allowClear:!0,autoComplete:"off",count:{max:64,show:!0}})})};var ue=s(23359);const ce=()=>{const[e,n]=(0,c.q)("recentSessionHistory"),s=(0,ue.E)((s=>{let{id:t,params:l,createdAt:i,name:a}=s;const o={id:null!==t&&void 0!==t?t:(0,W.kX)(8),params:l,createdAt:null!==i&&void 0!==i?i:(new Date).toISOString(),name:a},r=A().sortBy([o,...e||[]],"-createdAt").slice(0,5);n(r)})),t=(0,ue.E)((()=>n([]))),l=(0,ue.E)((s=>{const t=(e||[]).filter((e=>e.id!==s));n(t)})),i=(0,ue.E)(((s,t)=>{const l=(e||[]).map((e=>e.id===s?{...e,name:t}:e));n(l)}));return[e,{push:s,clear:t,remove:l,update:i}]};var me=s(76324),he=s(91454),pe=s(11753),ge=s(44336);const ve=(0,pe.rU)((e=>{let{css:n}=e;return{fixEditableVerticalAlign:n`
    & {
      margin-top: 0px !important;
    }
  `}})),xe=e=>{let{...n}=e;const{t:s}=(0,p.Bd)(),{styles:t}=ve(),[l,{update:i}]=ce(),[a,o]=(0,h.useState)(null),[,{getImageAliasName:r,getBaseVersion:d}]=(0,S.Gj)(),[u,{pin:m,unpin:v,update:x}]=(()=>{const[e,n]=(0,c.q)("pinnedSessionHistory"),[s]=(0,c.q)("recentSessionHistory"),t=(0,ue.E)((t=>{const l=(s||[]).find((e=>e.id===t));l&&n([...e||[],l])})),l=(0,ue.E)((s=>{const t=(e||[]).filter((e=>e.id!==s));n(t)})),i=(0,ue.E)(((s,t)=>{const l=(e||[]).map((e=>e.id===s?{...e,name:t}:e));n(l)}));return[e,{pin:t,unpin:l,update:i}]})(),[,y]=(0,h.useState)(),{token:j}=B.A.useToken(),b=(0,h.useMemo)((()=>{const e=(e,n)=>{const s=new URLSearchParams(e.params);return{...JSON.parse(s.get("formValues")||"{}"),pinned:n,name:e.name}},n=A().map(l,(n=>({...n,...e(n,!1)}))),s=A().map(u,(n=>({...n,...e(n,!0)})));return A().chain([...s,...n]).unionBy("id").value()}),[l,u]);return(0,g.jsx)(W.Ib,{width:800,title:s("session.launcher.RecentHistory"),footer:null,onCancel:()=>{y(void 0),n.onRequestClose()},...n,children:(0,g.jsxs)(W.OO,{direction:"column",align:"stretch",gap:"sm",children:[(0,g.jsx)(Z.A.Text,{children:s("session.launcher.YouCanStartWithHistory")}),(0,g.jsx)(W.zx,{rowSelection:{selectedRowKeys:null===u||void 0===u?void 0:u.map((e=>e.id)),columnWidth:0,hideSelectAll:!0,renderCell:()=>null},scroll:{x:"max-content"},dataSource:b,pagination:!1,onRow:e=>({onMouseEnter:()=>o(e.id),onMouseLeave:()=>o(null)}),rowKey:e=>e.id,columns:[{title:(0,g.jsxs)(W.OO,{gap:"xxs",children:[(0,g.jsx)(ge.A,{}),(0,g.jsx)(me.A,{title:s("session.launcher.PinnedHistoryTooltip")})]}),dataIndex:"pinned",width:40,render:(e,n)=>{const s=!!n.pinned,t=a===n.id;return s?(0,g.jsx)(z.Ay,{size:"small",onClick:()=>{v(n.id)},type:"link",children:(0,g.jsx)(ge.A,{})}):(0,g.jsx)(z.Ay,{size:"small",onClick:()=>m(n.id),type:"link",children:(0,g.jsx)(ge.A,{style:{color:t?j.colorTextQuaternary:"transparent"}})})}},{title:s("session.launcher.SessionNameShort"),dataIndex:"name",render:(e,s)=>{const l=e||s.id.split("-")[0];return(0,g.jsx)(Z.A.Text,{className:t.fixEditableVerticalAlign,editable:{onChange(e){A().isEmpty(e)||(i(s.id,e),s.pinned&&x(s.id,e))},text:l},children:(0,g.jsx)(W.rm,{type:"hover",onClick:()=>{var e;null===(e=n.onRequestClose)||void 0===e||e.call(n,JSON.parse(new URLSearchParams(s.params||"").get("formValues")||"{}"))},children:l})})}},{title:s("session.launcher.Environments"),dataIndex:["environments","version"],render:(e,n)=>{const s=n.environments.version||n.environments.manual;return s&&(0,g.jsx)(he.A,{title:s,placement:"right",children:(0,g.jsxs)(W.OO,{gap:"xxs",children:[(0,g.jsx)(I.A,{image:s}),(0,g.jsxs)(Z.A.Text,{children:[r(s)," ",d(s)]})]})})},onCell:()=>({style:{maxWidth:250,textOverflow:"ellipsis"}})},{title:s("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,g.jsx)(W.OO,{gap:"xs",children:(0,g.jsx)(Me,{resource:e})})},{title:s("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>le()(e).fromNow()}]})]})})};var ye=s(34905);var je=s(5282),Ae=s(70203),be=s(7830),Fe=s(44970),Se=s(15974),fe=s(83296),ke=s(60854),we=s(58541),_e=s(94916),Ie=s(104),Ne=s(17707),Ee=s(26918),Ve=s(33112),Oe=s(38344),Te=s(39758),Ce=s(74468),Pe=s(46746),De=s(43352),Be=s(7927);const Me=e=>{let{resource:n,containerCount:s=1}=e;return(0,g.jsxs)(g.Fragment,{children:[A().map(A().omit(n,"shmem","accelerator","acceleratorType"),((e,t)=>{var l,i;return"0"===e?null:(0,g.jsx)(d.A,{type:t,value:"mem"===t?((null===(l=(0,F.mv)(e.toString(),""))||void 0===l?void 0:l.number)||0)*s+"":A().toNumber(e)*s+"",opts:{shmem:n.shmem?((null===(i=(0,F.mv)(n.shmem,""))||void 0===i?void 0:i.number)||0)*s:void 0}},t)})),n&&n.accelerator&&n.acceleratorType&&A().isNumber(n.accelerator)?(0,g.jsx)(d.A,{type:n.acceleratorType,value:A().toString(n.accelerator*s)}):null]})},Ke=()=>{var e,n;const s=y.A.useApp(),{getErrorMessage:d}=(0,W.B7)(),c=(0,Te.md)(o.i7),m=(0,S.CX)(),j=m.supports("mount-by-id"),k=null!==(e=null===m||void 0===m?void 0:m.supports("batch-timeout"))&&void 0!==e&&e,w=(0,O.Am)(),[,_]=(0,f.zL)(),{startSession:I,defaultFormValues:N,upsertSessionNotification:E}=(0,De.GQ)(),V=(0,Be.withDefault)(Be.NumberParam,0),T=(0,Be.withDefault)(Be.JsonParam,N),C=(0,Be.withDefault)(Be.JsonParam,{}),[{step:P,formValues:D,redirectTo:G},Q]=(0,Be.useQueryParams)({step:V,formValues:T,redirectTo:Be.StringParam,appOption:C}),{search:$}=(0,Pe.zy)(),H=(0,S.f0)(),[X,{toggle:Y}]=(0,ke.A)(),[,{push:ee}]=ce(),{run:ne}=(0,we.A)((()=>{const e=re.getFieldsValue();Q({formValues:A().assign(A().omit(re.getFieldsValue(),["environments.image","environments.customizedTag","autoMountedFolderNames","owner","envvars"]),{envvars:(0,i.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),se=e=>{Q({step:e},"pushIn")},{token:te}=B.A.useToken(),{t:ie}=(0,p.Bd)(),ae=_e.Ay.useBreakpoint(),[re]=x.A.useForm();(0,h.useEffect)((()=>{A().isEmpty(D)||re.validateFields().catch((()=>{}))}),[]);const ue=(0,h.useMemo)((()=>A().merge({},N,D)),[N,D]);(0,h.useEffect)((()=>{var e;null===(e=c.current)||void 0===e||e.scrollTo(0,0)}),[P]);const me=x.A.useWatch("sessionType",{form:re,preserve:!0})||re.getFieldValue("sessionType")||D.sessionType,pe=(0,W.YM)([{title:ie("session.launcher.SessionType"),key:"sessionType"},{title:`${ie("session.launcher.Environments")} & ${ie("session.launcher.ResourceAllocation")} `,key:"environment"},"inference"!==me&&{title:ie("webui.menu.Data&Storage"),key:"storage"},{title:ie("session.launcher.Network"),key:"network"},{title:ie("session.launcher.ConfirmAndLaunch"),icon:(0,g.jsx)(je.A,{}),key:"review"}]),ge=null===(n=pe[P])||void 0===n?void 0:n.key,ve=A().some(re.getFieldsError(),(e=>e.errors.length>0)),[Me,Ke]=(0,S.Tw)("first");(0,h.useEffect)((()=>{P===pe.length-1&&re.validateFields().catch((()=>{})).finally((()=>Ke()))}),[P,re,Ke,pe.length]),(0,h.useEffect)((()=>{"first"!==Me&&ze(!!ve)}),[Me,ve]);const[Le,ze]=(0,h.useState)(!1),[Re,qe]=(0,h.useState)(!1);return(0,h.useLayoutEffect)((()=>{Re&&(re.resetFields(),qe(!1))}),[Re,re]),(0,g.jsxs)(W.OO,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,g.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,g.jsxs)(W.OO,{direction:"row",gap:"md",align:"start",children:[(0,g.jsxs)(W.OO,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,g.jsxs)(W.OO,{direction:"row",justify:"between",children:[(0,g.jsx)(Z.A.Title,{level:4,style:{marginTop:0},children:ie("session.launcher.StartNewSession")}),(0,g.jsx)(W.OO,{direction:"row",gap:"sm",children:(0,g.jsx)(z.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>Y(),children:ie("session.launcher.RecentHistory")})})]}),(0,g.jsx)(x.A.Provider,{onFormChange:()=>{ne()},children:(0,g.jsxs)(x.A,{form:re,layout:"vertical",initialValues:ue,children:[(0,g.jsx)(b,{form:re}),(0,g.jsxs)(W.OO,{direction:"column",align:"stretch",gap:"md",children:[(0,g.jsxs)(M.A,{title:ie("session.launcher.SessionType"),style:{display:"sessionType"===ge?"block":"none"},children:[(0,g.jsx)(x.A.Item,{name:"sessionType",children:(0,g.jsx)(Ie.Ay.Group,{options:[{label:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(Z.A.Text,{code:!0,children:ie("session.launcher.InteractiveMode")})," ",(0,g.jsx)(Z.A.Text,{type:"secondary",children:ie("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(Z.A.Text,{code:!0,children:ie("session.launcher.BatchMode")})," ",(0,g.jsx)(Z.A.Text,{type:"secondary",children:ie("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,g.jsx)(de,{}),(0,g.jsx)(x.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,g.jsx)(L.A,{})})]}),"batch"===me&&(0,g.jsxs)(M.A,{title:ie("session.launcher.BatchModeConfig"),style:{display:"sessionType"===ge?"block":"none"},children:[(0,g.jsx)(x.A.Item,{label:ie("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,g.jsx)(L.A.TextArea,{autoSize:!0})}),(0,g.jsx)(x.A.Item,{noStyle:!0,dependencies:[["batch","scheduleDate"]],children:()=>{const e=re.getFieldValue(["batch","scheduleDate"]);return(0,g.jsx)(t.A,{delay:1e3,callback:()=>{const e=re.getFieldValue(["batch","scheduleDate"]);return e?le()(e).isBefore(le()())?void(0===re.getFieldError(["batch","scheduleDate"]).length&&re.validateFields([["batch","scheduleDate"]])):le()(e).fromNow():void 0},triggerKey:e||"none",render:e=>(0,g.jsx)(x.A.Item,{label:ie("session.launcher.SessionStartTime"),extra:e,children:(0,g.jsxs)(W.OO,{direction:"row",gap:"xs",children:[(0,g.jsx)(x.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,g.jsx)(Ne.A,{onChange:e=>{e.target.checked&&A().isEmpty(re.getFieldValue(["batch","scheduleDate"]))?re.setFieldValue(["batch","scheduleDate"],le()().add(2,"minutes").toISOString()):!1===e.target.checked&&re.setFieldValue(["batch","scheduleDate"],void 0),re.validateFields([["batch","scheduleDate"]])},children:ie("session.launcher.Enable")})}),(0,g.jsx)(x.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,t;return(null===(s=e.batch)||void 0===s?void 0:s.enabled)!==(null===(t=n.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const n=!0!==(null===(e=re.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(x.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&le()(n).isBefore(le()())?Promise.reject(ie("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,g.jsx)(l.A,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(le()().startOf("day"))})})})}})]})})})}}),k?(0,g.jsx)(x.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"],["batch","timeoutUnit"]],children:()=>{const e=re.getFieldValue(["batch","timeout"]),n=re.getFieldValue(["batch","timeoutUnit"]),s=le().duration(e,null!==n&&void 0!==n?n:"s"),t=(0,F.a3)(s,ie),l=!A().isNull(e)&&A().toFinite(e)>0?t:null;return(0,g.jsx)(x.A.Item,{label:ie("session.launcher.BatchJobTimeoutDuration"),tooltip:ie("session.launcher.BatchJobTimeoutDurationDesc"),help:l,children:(0,g.jsxs)(W.OO,{direction:"row",gap:"xs",children:[(0,g.jsx)(x.A.Item,{noStyle:!0,name:["batch","timeoutEnabled"],valuePropName:"checked",children:(0,g.jsx)(Ne.A,{onChange:e=>{!1===e.target.checked&&re.setFieldValue(["batch","timeout"],void 0),re.validateFields([["batch","timeout"]])},children:ie("session.launcher.Enable")})}),(0,g.jsx)(x.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"]],children:()=>{const e=!0!==re.getFieldValue(["batch","timeoutEnabled"]);return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(x.A.Item,{name:["batch","timeout"],label:ie("session.launcher.BatchJobTimeoutDuration"),noStyle:!0,rules:[{min:0,type:"number",message:ie("error.AllowsPositiveNumberOnly")},{required:!e}],children:(0,g.jsx)(Ee.A,{disabled:e,min:1,addonAfter:(0,g.jsx)(x.A.Item,{noStyle:!0,name:["batch","timeoutUnit"],children:(0,g.jsx)(U.A,{tabIndex:-1,style:{minWidth:75},options:[{label:ie("time.Sec"),value:"s"},{label:ie("time.Min"),value:"m"},{label:ie("time.Hour"),value:"h"},{label:ie("time.Day"),value:"d"},{label:ie("time.Week"),value:"w"}]})})})})})}})]})})}}):null]}),("admin"===w||"superadmin"===w)&&(0,g.jsx)(J,{style:{display:"sessionType"===ge?"block":"none"}}),"inference"===me&&(0,g.jsx)(M.A,{title:"Inference Mode Configuration",children:(0,g.jsx)(x.A.Item,{name:["inference","vFolderName"],label:ie("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,g.jsx)(U.A,{})})}),(0,g.jsxs)(M.A,{title:ie("session.launcher.Environments"),style:{display:"environment"===ge?"block":"none"},children:[(0,g.jsx)(Ce.tH,{fallbackRender:()=>null,children:(0,g.jsx)(a.A,{})}),(0,g.jsx)(x.A.Item,{label:ie("session.launcher.EnvironmentVariable"),children:(0,g.jsx)(i.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,g.jsx)(M.A,{title:ie("session.launcher.ResourceAllocation"),style:{display:"environment"===ge?"block":"none"},children:(0,g.jsx)(u.Ay,{enableAgentSelect:!m._config.hideAgents&&m.supports("agent-select"),enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,g.jsxs)(M.A,{title:ie("session.launcher.HPCOptimization"),style:{display:"environment"===ge?"block":"none"},children:[(0,g.jsx)(x.A.Item,{noStyle:!0,children:(0,g.jsxs)(W.OO,{direction:"row",gap:"sm",children:[(0,g.jsx)(Z.A.Text,{children:ie("session.launcher.SwitchOpenMPoptimization")}),(0,g.jsx)(x.A.Item,{label:ie("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,g.jsx)(K.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e?re.setFieldsValue({hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:void 0,OPENBLAS_NUM_THREADS:void 0}}):re.setFieldsValue({hpcOptimization:{autoEnabled:!1,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"}})}})})]})}),(0,g.jsx)(x.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,t;return(null===(s=e.hpcOptimization)||void 0===s?void 0:s.autoEnabled)!==(null===(t=n.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=re.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,g.jsxs)(R.A,{gutter:te.marginMD,style:{display:e?"none":void 0,marginTop:te.marginMD},children:[(0,g.jsx)(q.A,{xs:24,sm:12,children:(0,g.jsx)(x.A.Item,{style:{flex:1},label:ie("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,g.jsxs)(g.Fragment,{children:[ie("session.launcher.OpenMPOptimization"),(0,g.jsx)(p.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,g.jsx)(Ee.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,g.jsx)(q.A,{xs:24,sm:12,children:(0,g.jsx)(x.A.Item,{style:{flex:1},label:ie("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,g.jsxs)(g.Fragment,{children:[ie("session.launcher.OpenMPOptimization"),(0,g.jsx)(p.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,g.jsx)(Ee.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,g.jsx)(M.A,{title:ie("webui.menu.Data&Storage"),style:{display:"storage"===ge?"block":"none"},children:(0,g.jsx)(x.A.Item,{noStyle:!0,dependencies:["owner"],children:e=>{let{getFieldValue:n}=e;const s=n("owner"),t=(null===s||void 0===s?void 0:s.enabled)&&A().every(A().omit(s,"enabled"),(e=>void 0!==e));return(0,g.jsx)(ye.A,{rowKey:j?"id":"name",rowFilter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))},tableProps:{ownerEmail:t?null===s||void 0===s?void 0:s.email:void 0}})}})}),(0,g.jsx)(M.A,{title:ie("session.launcher.Network"),style:{display:"network"===ge?"block":"none"},children:(0,g.jsx)(r.Ay,{})}),"review"===ge&&(0,g.jsx)(oe,{onClickEditStep:e=>{const n=A().findIndex(pe,{key:e});se(n)}}),(0,g.jsxs)(W.OO,{direction:"row",justify:"between",children:[(0,g.jsx)(W.OO,{gap:"sm",children:(0,g.jsx)(Ve.A,{title:ie("button.Reset"),description:ie("session.launcher.ResetFormConfirm"),onConfirm:()=>{Q({},"replace"),qe(!0)},icon:(0,g.jsx)(Ae.A,{style:{color:te.colorError}}),okText:ie("button.Reset"),okButtonProps:{danger:!0},children:(0,g.jsx)(z.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:ie("button.Reset")})})}),(0,g.jsxs)(W.OO,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[P>0&&(0,g.jsx)(z.Ay,{onClick:()=>{se(P-1)},icon:(0,g.jsx)(be.A,{}),children:ie("button.Previous")}),P===pe.length-1?(0,g.jsx)(he.A,{title:ve?ie("session.launcher.PleaseCompleteForm"):void 0,children:(0,g.jsx)(W.Fv,{type:"primary",icon:(0,g.jsx)(Fe.A,{}),disabled:ve,action:async()=>{var e;const n=$,t=await re.validateFields().catch((e=>{console.error("validation errors",e)}));if(t){if(A().isEmpty(t.mount_ids)||0===(null===(e=t.mount_ids)||void 0===e?void 0:e.length)){if(!await s.modal.confirm({title:ie("session.launcher.NoFolderMounted"),content:(0,g.jsxs)(g.Fragment,{children:[ie("session.launcher.HomeDirectoryDeletionDialog"),(0,g.jsx)("br",{}),(0,g.jsx)("br",{}),ie("session.launcher.LaunchConfirmationDialog"),(0,g.jsx)("br",{}),(0,g.jsx)("br",{}),ie("dialog.ask.DoYouWantToProceed")]}),okText:ie("session.launcher.Start"),closable:!0}))return}await I(t).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&(E(e.fulfilled),_(t.resourceGroup),ee({params:n,name:e.fulfilled[0].value.sessionName})),null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&H(G||"/job"),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const n=e.rejected[0].reason;s.modal.error({title:null===n||void 0===n?void 0:n.title,content:d(n)})}})).catch((e=>{console.error("Unexpected error during session creation:",e),s.message.error(ie("error.UnexpectedError"))}))}},children:ie("session.launcher.Launch")})}):(0,g.jsxs)(z.Ay,{type:"primary",ghost:!0,onClick:()=>{se(P+1)},children:[ie("button.Next")," ",(0,g.jsx)(Se.A,{})]}),P!==pe.length-1&&(0,g.jsxs)(z.Ay,{onClick:()=>{se(pe.length-1)},children:[ie("session.launcher.SkipToConfirmAndLaunch"),(0,g.jsx)(fe.A,{})]})]})]})]})]})})]}),ae.lg&&(0,g.jsx)(W.OO,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,g.jsx)(Oe.A,{size:"small",direction:"vertical",current:P,onChange:e=>{se(e)},items:A().map(pe,((e,n)=>({...e,status:n===P?"process":"wait"})))})})]}),(0,g.jsx)(xe,{onRequestClose:e=>{if(e){const n=A().merge({sessionName:"",ports:[],vfoldersNameMap:{},mount_ids:[],mount_id_map:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0},agent:["auto"]},e);A().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,W.kX)(4)),re.setFieldsValue(n),se(pe.length-1),re.validateFields().catch((()=>{}))}Y()},open:X}),P===pe.length-1?(0,g.jsx)(Ce.tH,{fallback:null,children:(0,g.jsx)(v,{open:Le,onClose:()=>{ze(!1)},scrollIntoViewOptions:!0})}):void 0]})}}}]);
//# sourceMappingURL=9245.85eb52a2.chunk.js.map