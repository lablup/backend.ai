"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[424],{71801:(e,n,s)=>{s.d(n,{A:()=>u});var t=s(80404),l=s(70899),i=s(66596),o=s(99142),r=s(80963),a=s(46976),d=s.n(a),c=(s(55093),s(79569));const u=e=>{let{status:n="default",extraButtonTitle:s,onClickExtraButton:a,extra:u,style:m,...h}=e;const{token:v}=i.A.useToken(),p=u||s&&(0,c.jsx)(o.Ay,{type:"link",icon:"error"===n?(0,c.jsx)(t.A,{twoToneColor:v.colorError}):"warning"===n?(0,c.jsx)(l.A,{twoToneColor:v.colorWarning}):void 0,onClick:a,children:s})||void 0;return(0,c.jsx)(r.A,{className:"error"===n?"bai-card-error":"",style:d().extend(m,{borderColor:"error"===n?v.colorError:"warning"===n?v.colorWarning:"success"===n?v.colorSuccess:null===m||void 0===m?void 0:m.borderColor}),extra:p,...h})}},7786:(e,n,s)=>{s.d(n,{A:()=>u});var t=s(62976),l=s(80899),i=s(78502),o=s.n(i),r=s(46976),a=s.n(r),d=s(55093),c=s(79569);const u=d.forwardRef(((e,n)=>{let{value:s,onChange:i,localFormat:r,...d}=e;const[,u]=(0,t.A)({value:s,onChange:i});return(0,c.jsx)(l.A,{ref:n,value:s?o()(s):void 0,onChange:e=>{var n,s,t;a().isArray(e)&&(e=e[0]);const l=r?null===(n=e)||void 0===n?void 0:n.format():null===(s=e)||void 0===s||null===(t=s.tz())||void 0===t?void 0:t.toISOString();u(l)},...d})}))},9328:(e,n,s)=>{s.d(n,{A:()=>o});var t=s(79597),l=s(55093),i=s(79569);const o=e=>{let{value:n,...s}=e;const o=t.A.useFormInstance();return(0,l.useEffect)((()=>{o.setFieldValue(s.name,n)}),[n,o,s.name]),(0,i.jsx)(t.A.Item,{...s,hidden:!0})}},44913:(e,n,s)=>{s.d(n,{Ay:()=>x,tt:()=>g,uD:()=>h});var t=s(23441),l=s(79597),i=s(47543),o=s(25913),r=s(46976),a=s.n(r),d=(s(55093),s(33364)),c=s(79569);const u=1024,m=65535,h=e=>{let{inValid:n,value:s,...t}=e;return(0,c.jsx)(o.A,{color:!n&&v(s)?void 0:"red",...t})},v=e=>{if(p(e)){const n=e.split(":"),[s,t]=n.map((e=>parseInt(e)));return s>=u&&t<=m}return e===parseInt(e).toString()&&parseInt(e)>=u&&parseInt(e)<=m},p=e=>{const n=e.split(":");if(2===n.length){const[e,s]=n.map((e=>parseInt(e)));return e<=s}return!1},g=e=>a().flatten(a().map(e,(e=>p(e)?(e=>{const[n,s]=e.split(":").map((e=>parseInt(e)));return a().range(n,s+1)})(e):parseInt(e)))),x=e=>{let{name:n="ports",...s}=e;const{t:o}=(0,d.Bd)(),r=(0,t.CX)(),v=l.A.useFormInstance();return(0,c.jsx)(l.A.Item,{label:o("session.launcher.PreOpenPortTitle"),name:n,tooltip:(0,c.jsx)(d.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:o("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,n)=>g(n).length<=r._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(o("session.launcher.PreOpenPortMaxCountLimit",{count:r._config.maxCountForPreopenPorts})))}),()=>({validator:(e,n)=>a().every(n,(e=>parseInt(e).toString()===e||p(e)))?Promise.resolve():Promise.reject(new Error(o("session.launcher.InvalidPortFormat")))}),()=>({validator(e,n){const s=g(n);return a().every(s,(e=>e>=u&&e<=m))?Promise.resolve():Promise.reject(new Error(o("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,n){const s=g(n);return a().uniq(s).length===s.length?Promise.resolve():Promise.reject(new Error(o("session.launcher.DuplicatedPort")))}})],...s,children:(0,c.jsx)(i.A,{mode:"tags",tagRender:e=>{const s=a().filter(g(v.getFieldValue(n)),(n=>n===parseInt(e.value))).length>1;return(0,c.jsx)(h,{inValid:s,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})}},69305:(e,n,s)=>{s.a(e,(async(e,t)=>{try{s.d(n,{A:()=>d});var l=s(39768),i=s(95462),o=(s(55093),s(33364)),r=s(79569),a=e([l]);l=(a.then?(await a)():a)[0];const d=e=>{let{open:n,onClose:s,...t}=e;const{t:a}=(0,o.Bd)(),[d,c]=(0,l.q)("has_opened_tour_neo_session_validation"),u=[{title:a("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:a("tourGuide.neoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:a("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:a("tourGuide.neoSessionLauncher.FixErrorFieldByModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:a("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:a("tourGuide.neoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,r.jsx)(i.A,{steps:u,onClose:e=>{null===s||void 0===s||s(e),c(!0)},open:!d&&n,...t})};t()}catch(d){t(d)}}))},34475:(e,n,s)=>{s.a(e,(async(e,t)=>{try{s.d(n,{A:()=>B});var l=s(72375),i=s(23441),o=s(81530),r=s(97094),a=s(80424),d=s(71801),c=s(91238),u=s(72338),m=s(90184),h=s(32715),v=s(44913),p=s(39217),g=s(13287),x=s(79597),A=s(66596),y=s(76082),j=s(12221),b=s(38926),F=s(63340),w=s(92047),f=s(25913),S=s(38398),k=s(80963),T=s(8656),E=s(78502),V=s.n(E),I=s(46976),N=s.n(I),C=s(33364),P=s(75882),_=s(38114),O=s(79569),D=e([a]);a=(D.then?(await D)():D)[0];const B=e=>{var n,s,t,E,I,D,B,M,z,R,L,q,G,K,U,W,$,H,J,X,Q,Y,Z,ee,ne,se,te,le,ie,oe,re,ae,de,ce,ue,me;let{onClickEditStep:he}=e;const{t:ve}=(0,C.Bd)(),pe=x.A.useFormInstance(),{token:ge}=A.A.useToken(),xe=(0,i.CX)(),Ae=x.A.useWatch("sessionType",{form:pe,preserve:!0}),ye=null!==(n=null===xe||void 0===xe?void 0:xe.supports("batch-timeout"))&&void 0!==n&&n,je=null!==(s=null===xe||void 0===xe?void 0:xe.supports("extended-image-info"))&&void 0!==s&&s,be=(0,o.hd)(),[,{getBaseVersion:Fe,getBaseImage:we,tagAlias:fe}]=(0,i.Gj)(),{isDarkMode:Se}=(0,r.e)();return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(d.A,{title:ve("session.launcher.SessionType"),size:"small",status:pe.getFieldError("sessionName").length>0||pe.getFieldError(["batch","command"]).length>0||pe.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{he("sessionType")},children:(0,O.jsxs)(y.A,{size:"small",column:1,children:[(0,O.jsx)(y.A.Item,{label:ve("session.SessionType"),children:pe.getFieldValue("sessionType")}),!N().isEmpty(pe.getFieldValue("sessionName"))&&(0,O.jsx)(y.A.Item,{label:ve("session.launcher.SessionName"),children:pe.getFieldValue("sessionName")}),"batch"===Ae&&(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(y.A.Item,{label:ve("session.launcher.StartUpCommand"),labelStyle:{whiteSpace:"nowrap"},contentStyle:{overflow:"auto"},children:pe.getFieldValue(["batch","command"])?(0,O.jsx)(g.A,{language:"shell",children:pe.getFieldValue(["batch","command"])}):(0,O.jsx)(j.A.Text,{type:"secondary",children:ve("general.None")})}),(0,O.jsx)(y.A.Item,{label:ve("session.launcher.SessionStartTime"),children:pe.getFieldValue(["batch","scheduleDate"])?V()(pe.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,O.jsx)(j.A.Text,{type:"secondary",children:ve("general.None")})}),ye?(0,O.jsx)(y.A.Item,{label:ve("session.launcher.BatchJobTimeoutDuration"),children:pe.getFieldValue(["batch","timeout"])?(0,O.jsxs)(j.A.Text,{children:[pe.getFieldValue(["batch","timeout"]),pe.getFieldValue(["batch","timeoutUnit"])||"s"]}):(0,O.jsx)(j.A.Text,{type:"secondary",children:ve("general.None")})}):null]})]})}),(0,O.jsx)(p.h,{onClickExtraButton:()=>{he("sessionType")}}),(0,O.jsx)(d.A,{title:ve("session.launcher.Environments"),size:"small",status:N().some(pe.getFieldValue("envvars"),((e,n)=>pe.getFieldError(["envvars",n,"variable"]).length>0||pe.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{he("environment")},children:(0,O.jsxs)(y.A,{size:"small",column:1,children:[(0,O.jsx)(y.A.Item,{label:ve("session.launcher.Project"),children:be.name}),(0,O.jsx)(y.A.Item,{label:ve("general.Image"),children:je?(0,O.jsxs)(b.A,{style:{flexFlow:"nowrap"},children:[(0,O.jsx)(F.A,{children:(0,O.jsx)(m.A,{image:(null===(t=pe.getFieldValue("environments"))||void 0===t?void 0:t.version)||(null===(E=pe.getFieldValue("environments"))||void 0===E?void 0:E.manual),style:{marginRight:ge.marginXS}})}),(0,O.jsx)(F.A,{children:(0,O.jsx)(u.A,{direction:"row",wrap:"wrap",children:null!==(I=pe.getFieldValue("environments"))&&void 0!==I&&I.manual?(0,O.jsx)(j.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(D=pe.getFieldValue("environments"))||void 0===D?void 0:D.manual},children:null===(B=pe.getFieldValue("environments"))||void 0===B?void 0:B.manual}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(j.A.Text,{children:fe(null===(M=pe.getFieldValue("environments"))||void 0===M||null===(z=M.image)||void 0===z?void 0:z.base_image_name)}),(0,O.jsx)(w.A,{type:"vertical"}),(0,O.jsx)(j.A.Text,{children:null===(R=pe.getFieldValue("environments"))||void 0===R||null===(L=R.image)||void 0===L?void 0:L.version}),(0,O.jsx)(w.A,{type:"vertical"}),(0,O.jsx)(j.A.Text,{children:null===(q=pe.getFieldValue("environments"))||void 0===q||null===(G=q.image)||void 0===G?void 0:G.architecture}),(0,O.jsx)(w.A,{type:"vertical"}),N().map(null===(K=pe.getFieldValue("environments"))||void 0===K||null===(U=K.image)||void 0===U?void 0:U.tags,(e=>{var n,s,t;const i=N().includes(e.key,"customized_"),o=i?null===(n=N().find(null===(s=pe.getFieldValue("environments"))||void 0===s||null===(t=s.image)||void 0===t?void 0:t.labels,{key:"ai.backend.customized-image.name"}))||void 0===n?void 0:n.value:e.value,r=fe(e.key+o);return N().isEqual(r,(0,l.WY)(e.key+o))?(0,O.jsx)(c.A,{values:[{label:fe(e.key),color:i?"cyan":"blue"},{label:o,color:i?"cyan":"blue"}]},e.key):(0,O.jsx)(f.A,{color:i?"cyan":"blue",children:r},e.key)})),(0,O.jsx)(j.A.Text,{style:{color:ge.colorPrimary},copyable:{text:(0,l.A_)(null===(W=pe.getFieldValue("environments"))||void 0===W?void 0:W.image)||(null===($=pe.getFieldValue("environments"))||void 0===$?void 0:$.version)}})]})})})]}):(0,O.jsxs)(b.A,{style:{flexFlow:"nowrap",gap:ge.sizeXS},children:[(0,O.jsx)(F.A,{children:(0,O.jsx)(m.A,{image:(null===(H=pe.getFieldValue("environments"))||void 0===H?void 0:H.version)||(null===(J=pe.getFieldValue("environments"))||void 0===J?void 0:J.manual)})}),(0,O.jsx)(F.A,{children:(0,O.jsx)(u.A,{direction:"row",wrap:"wrap",children:null!==(X=pe.getFieldValue("environments"))&&void 0!==X&&X.manual?(0,O.jsx)(j.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(Q=pe.getFieldValue("environments"))||void 0===Q?void 0:Q.manual},children:null===(Y=pe.getFieldValue("environments"))||void 0===Y?void 0:Y.manual}):(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(j.A.Text,{children:fe(we(null===(Z=pe.getFieldValue("environments"))||void 0===Z?void 0:Z.version))}),(0,O.jsx)(w.A,{type:"vertical"}),(0,O.jsx)(j.A.Text,{children:Fe(null===(ee=pe.getFieldValue("environments"))||void 0===ee?void 0:ee.version)}),(0,O.jsx)(w.A,{type:"vertical"}),(0,O.jsx)(j.A.Text,{children:null===(ne=pe.getFieldValue("environments"))||void 0===ne||null===(se=ne.image)||void 0===se?void 0:se.architecture}),(0,O.jsx)(w.A,{type:"vertical"}),(0,O.jsx)(h.Jj,{tag:pe.getFieldValue(["environments","image","tag"]),labels:null===(te=pe.getFieldValue("environments"))||void 0===te||null===(le=te.image)||void 0===le?void 0:le.labels}),(0,O.jsx)(j.A.Text,{style:{color:ge.colorPrimary},copyable:{text:(0,l.A_)(null===(ie=pe.getFieldValue("environments"))||void 0===ie?void 0:ie.image)||(null===(oe=pe.getFieldValue("environments"))||void 0===oe?void 0:oe.version)}})]})})})]})}),(null===(re=pe.getFieldValue("envvars"))||void 0===re?void 0:re.length)>0&&(0,O.jsx)(y.A.Item,{label:ve("session.launcher.EnvironmentVariable"),children:null!==(ae=pe.getFieldValue("envvars"))&&void 0!==ae&&ae.length?(0,O.jsx)(P.A,{style:Se?_.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:N().map(pe.getFieldValue("envvars"),(e=>`${(null===e||void 0===e?void 0:e.variable)||""}="${(null===e||void 0===e?void 0:e.value)||""}"`)).join("\n")}):(0,O.jsx)(j.A.Text,{type:"secondary",children:"-"})})]})}),(0,O.jsx)(d.A,{title:ve("session.launcher.ResourceAllocation"),status:N().some(pe.getFieldValue("resource"),((e,n)=>pe.getFieldError(["resource",n]).length>0))||pe.getFieldError(["num_of_sessions"]).length>0||pe.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{he("environment")},children:(0,O.jsxs)(u.A,{direction:"column",align:"stretch",children:[N().some(pe.getFieldValue("resource"),((e,n)=>pe.getFieldWarning(["resource",n]).length>0))&&(0,O.jsx)(S.A,{type:"warning",showIcon:!0,message:ve("session.launcher.EnqueueComputeSessionWarning")}),(0,O.jsxs)(y.A,{column:2,children:[(0,O.jsx)(y.A.Item,{label:ve("general.ResourceGroup"),span:2,children:pe.getFieldValue("resourceGroup")||(0,O.jsx)(j.A.Text,{type:"secondary",children:ve("general.None")})}),(0,O.jsx)(y.A.Item,{label:ve("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,O.jsxs)(u.A,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===pe.getFieldValue("allocationPreset")?"":(0,O.jsx)(f.A,{children:pe.getFieldValue("allocationPreset")}),(0,O.jsx)(a.ResourceNumbersOfSession,{resource:pe.getFieldValue("resource")})]})}),xe.supports("agent-select")&&!(null!==xe&&void 0!==xe&&null!==(de=xe._config)&&void 0!==de&&de.hideAgents)&&(0,O.jsx)(y.A.Item,{label:ve("session.launcher.AgentNode"),children:pe.getFieldValue("agent")||ve("session.launcher.AutoSelect")}),(0,O.jsx)(y.A.Item,{label:ve("session.launcher.NumberOfContainer"),children:1===pe.getFieldValue("cluster_size")?pe.getFieldValue("num_of_sessions"):pe.getFieldValue("cluster_size")}),(0,O.jsx)(y.A.Item,{label:ve("session.launcher.ClusterMode"),children:"single-node"===pe.getFieldValue("cluster_mode")?ve("session.launcher.SingleNode"):ve("session.launcher.MultiNode")})]}),(0,O.jsx)(k.A,{size:"small",type:"inner",title:ve("session.launcher.TotalAllocation"),children:(0,O.jsx)(u.A,{direction:"row",gap:"xxs",children:(0,O.jsx)(a.ResourceNumbersOfSession,{resource:pe.getFieldValue("resource"),containerCount:1===pe.getFieldValue("cluster_size")?pe.getFieldValue("num_of_sessions"):pe.getFieldValue("cluster_size")})})})]})}),(0,O.jsx)(d.A,{title:ve("webui.menu.Data&Storage"),size:"small",status:pe.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{he("storage")},children:(0,O.jsxs)(u.A,{direction:"column",align:"stretch",gap:"xs",children:[(null===(ce=pe.getFieldValue("mounts"))||void 0===ce?void 0:ce.length)>0?(0,O.jsx)(T.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:ve("data.folders.Name")},{dataIndex:"alias",title:ve("session.launcher.FolderAlias"),render:(e,n)=>N().isEmpty(e)?(0,O.jsx)(j.A.Text,{type:"secondary",style:{opacity:.7},children:`/home/work/${n.name}`}):e}],dataSource:N().map(pe.getFieldValue("mounts"),(e=>{var n;return{name:e,alias:null===(n=pe.getFieldValue("vfoldersAliasMap"))||void 0===n?void 0:n[e]}}))}):(0,O.jsx)(S.A,{type:"warning",showIcon:!0,message:ve("session.launcher.NoFolderMounted")}),(null===(ue=pe.getFieldValue("autoMountedFolderNames"))||void 0===ue?void 0:ue.length)>0?(0,O.jsx)(y.A,{size:"small",children:(0,O.jsx)(y.A.Item,{label:ve("data.AutomountFolders"),children:N().map(pe.getFieldValue("autoMountedFolderNames"),(e=>(0,O.jsx)(f.A,{children:e})))})}):null]})}),(0,O.jsx)(d.A,{title:"Network",size:"small",status:pe.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:ve("button.Edit"),onClickExtraButton:()=>{he("network")},children:(0,O.jsx)(y.A,{size:"small",children:(0,O.jsx)(y.A.Item,{label:ve("session.launcher.PreOpenPortTitle"),children:(0,O.jsxs)(u.A,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[N().sortBy(pe.getFieldValue("ports"),(e=>parseInt(e))).map((e=>(0,O.jsx)(v.uD,{value:e,style:{margin:0},children:e}))),N().isArray(pe.getFieldValue("ports"))&&0!==(null===(me=pe.getFieldValue("ports"))||void 0===me?void 0:me.length)?null:(0,O.jsx)(j.A.Text,{type:"secondary",children:ve("general.None")})]})})})})]})};t()}catch(B){t(B)}}))},60661:(e,n,s)=>{s.d(n,{A:()=>c,j:()=>d});var t=s(79597),l=s(1364),i=s(46976),o=s.n(i),r=(s(55093),s(33364)),a=s(79569);const d=e=>[{min:4,message:e("session.validation.SessionNameTooShort")},{max:64,message:e("session.validation.SessionNameTooLong64")},{validator:(n,s)=>o().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/^[\w.-]*$/.test(s)?!/\w$/.test(s)&&s.length>=4?Promise.reject(e("session.validation.SessionNameShouldEndWith")):Promise.resolve():Promise.reject(e("session.validation.SessionNameInvalidCharacter")):Promise.reject(e("session.validation.SessionNameShouldStartWith"))}],c=e=>{let{...n}=e;const{t:s}=(0,r.Bd)();return(0,a.jsx)(t.A.Item,{label:s("session.launcher.SessionName"),name:"sessionName",rules:d(s),...n,children:(0,a.jsx)(l.A,{allowClear:!0,autoComplete:"off"})})}},39217:(e,n,s)=>{s.d(n,{A:()=>V,h:()=>E});var t,l=s(7971),i=s(69949),o=s(71801),r=s(22407),a=s(72338),d=s(9328),c=s(87258),u=s(66596),m=s(79597),h=s(80963),v=s(47149),p=s(1364),g=s(99142),x=s(38926),A=s(63340),y=s(47543),j=s(76082),b=s(46976),F=s.n(b),w=s(18939),f=s(55093),S=s(33364),k=s(63821),T=s(79569);const E=e=>{const{t:n}=(0,S.Bd)(),s=m.A.useFormInstance(),t=m.A.useWatch(["owner","enabled"],s),i=(0,l.Am)();return("admin"===i||"superadmin"===i)&&t&&(0,T.jsx)(o.A,{title:n("session.launcher.SetSessionOwner"),size:"small",status:s.getFieldError(["owner","email"]).length>0||s.getFieldError(["owner","accesskey"]).length>0||s.getFieldError(["owner","project"]).length>0||s.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit"),...e,children:(0,T.jsxs)(j.A,{size:"small",column:1,children:[(0,T.jsx)(j.A.Item,{label:n("session.launcher.OwnerEmail"),children:s.getFieldValue(["owner","email"])}),(0,T.jsx)(j.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:s.getFieldValue(["owner","accesskey"])}),(0,T.jsx)(j.A.Item,{label:n("session.launcher.OwnerGroup"),children:s.getFieldValue(["owner","project"])}),(0,T.jsx)(j.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:s.getFieldValue(["owner","resourceGroup"])})]})})},V=e=>{const{t:n}=(0,S.Bd)(),{token:l}=u.A.useToken(),o=m.A.useFormInstance(),j=m.A.useWatch(["owner","enabled"],o),[b,E]=(0,f.useState)(),V=(0,k.useRelayEnvironment)(),{data:I,isFetching:N}=(0,i.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",b],queryFn:()=>{const e=o.getFieldValue(["owner","email"]);if(!e)return;const n=void 0!==t?t:t=s(60726);return(0,k.fetchQuery)(V,n,{email:e}).toPromise()},enabled:!!b}),C=o.getFieldValue(["owner","email"])?null===I||void 0===I?void 0:I.keypairs:void 0,P=o.getFieldValue(["owner","email"])?null===I||void 0===I?void 0:I.user:void 0,_=!N&&b&&!P;return(0,T.jsxs)(h.A,{title:n("session.launcher.SetSessionOwner"),extra:(0,T.jsx)(m.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,T.jsx)(v.A,{})}),styles:j?void 0:{header:{borderBottom:"none"},body:{display:j?"block":"none"}},...e,children:[(0,T.jsx)(d.A,{name:["owner","domainName"],value:null===P||void 0===P?void 0:P.domain_name}),(0,T.jsx)(m.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(a.A,{children:(0,T.jsx)(m.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:j},{type:"email",message:n("credential.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:_?"error":void 0,help:_?n("credential.NoUserToDisplay"):void 0,children:(0,T.jsx)(p.A.Search,{onSearch:e=>{o.validateFields([["owner","email"]]).then((()=>{E(e)})).catch((()=>{}))},onChange:()=>{E(""),o.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:N,enterButton:!N&&P?(0,T.jsx)(g.Ay,{icon:(0,T.jsx)(w.A,{})}):void 0})})}),(0,T.jsx)(m.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:s(["owner","enabled"])}],children:(0,T.jsx)(r.A,{options:F().map(C,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:F().isEmpty(b)||N})}),(0,T.jsxs)(x.A,{gutter:l.marginSM,children:[(0,T.jsx)(A.A,{span:12,children:(0,T.jsx)(m.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,T.jsx)(r.A,{options:F().map(null===P||void 0===P?void 0:P.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:F().isEmpty(b)||N})})}),(0,T.jsx)(A.A,{span:12,children:(0,T.jsx)(m.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,T.jsx)(f.Suspense,{fallback:(0,T.jsx)(m.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,T.jsx)(y.A,{loading:!0})}),children:(0,T.jsx)(m.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:s(["owner","enabled"])}],children:s(["owner","project"])?(0,T.jsx)(c.A,{projectName:s(["owner","project"]),disabled:F().isEmpty(b)||N,autoSelectDefault:!0}):(0,T.jsx)(y.A,{disabled:!0})})})}})})]})]})}})]})}},79226:(e,n,s)=>{s.a(e,(async(e,t)=>{try{s.d(n,{A:()=>b});var l=s(23441),i=s(83621),o=s(80424),r=s(88543),a=s(72338),d=s(90184),c=s(92047),u=s(8656),m=s(12221),h=s(78502),v=s.n(h),p=s(46976),g=s.n(p),x=s(55093),A=s(33364),y=s(79569),j=e([i,o]);[i,o]=j.then?(await j)():j;const b=e=>{let{...n}=e;const{t:s}=(0,A.Bd)(),[t]=(0,i.b)(),[,{getImageAliasName:h,getBaseVersion:p}]=(0,l.Gj)(),[j,b]=(0,x.useState)(),F=(0,x.useMemo)((()=>g().map(t,(e=>{const n=new URLSearchParams(e.params),s=JSON.parse(n.get("formValues")||"{}");return{...e,...s}}))),[t]);return(0,y.jsxs)(r.A,{width:800,title:s("session.launcher.RecentHistory"),okButtonProps:{disabled:!j},okText:s("button.Apply"),...n,onOk:e=>{var s,l;const i=null===(s=g().find(t,{id:j}))||void 0===s?void 0:s.params;null===(l=n.onRequestClose)||void 0===l||l.call(n,JSON.parse(new URLSearchParams(i).get("formValues")||"{}"))},onCancel:()=>{b(void 0),n.onRequestClose()},children:[(0,y.jsx)(c.A,{style:{margin:0}}),(0,y.jsx)(u.A,{showHeader:!1,scroll:{x:"max-content"},dataSource:F,pagination:!1,rowSelection:{type:"radio",selectedRowKeys:j?[j]:[],onSelect:e=>{b(e.id)}},onRow:e=>({onClick:()=>{b(e.id)}}),rowKey:e=>e.id,columns:[{title:s("general.Image"),dataIndex:["environments","version"],render:(e,n)=>{const s=n.environments.version||n.environments.manual;return!!s&&(0,y.jsxs)(a.A,{gap:"xs",children:[(0,y.jsx)(d.A,{image:s}),(0,y.jsx)(m.A.Text,{children:h(s)}),(0,y.jsx)(m.A.Text,{children:p(s)}),(0,y.jsx)(m.A.Text,{children:n.sessionName?`(${n.sessionName})`:null})]})}},{title:s("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,y.jsx)(a.A,{children:(0,y.jsx)(o.ResourceNumbersOfSession,{resource:e})})},{title:s("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>v()(e).fromNow()}]})]})};t()}catch(b){t(b)}}))},60726:(e,n,s)=>{s.r(n),s.d(n,{default:()=>l});const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],s={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},l],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,i],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[s,l],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,i,l],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();t.hash="ba086835ea654ab889e0e6aaefa0abfe";const l=t},83621:(e,n,s)=>{s.a(e,(async(e,t)=>{try{s.d(n,{b:()=>a});var l=s(72375),i=s(39768),o=s(68098),r=e([i]);i=(r.then?(await r)():r)[0];const a=()=>{const[e,n]=(0,i.q)("recentSessionHistory"),s=(0,o.E)((s=>{let{id:t,params:i,createdAt:o}=s;const r=[{id:null!==t&&void 0!==t?t:(0,l.kX)(8),params:i,createdAt:null!==o&&void 0!==o?o:(new Date).toISOString()},...e||[]].slice(0,5);n(r)})),t=(0,o.E)((()=>n([]))),r=(0,o.E)((s=>{const t=(e||[]).filter((e=>e.id!==s));n(t)}));return[e,{push:s,clear:t,remove:r}]};t()}catch(a){t(a)}}))},80424:(e,n,s)=>{s.a(e,(async(e,t)=>{try{s.r(n),s.d(n,{ResourceNumbersOfSession:()=>ue,default:()=>he});var l=s(6070),i=s(7786),o=s(4101),r=s(72338),a=s(60828),d=s(58082),c=s(44913),u=s(7208),m=s(42388),h=s(69305),v=s(34475),p=s(60661),g=s(39217),x=s(79226),A=s(83770),y=s(72375),j=s(23441),b=s(7971),F=s(25905),w=s(81530),f=s(83621),S=s(37903),k=s(41007),T=s(42927),E=s(79267),V=s(35739),I=s(37821),N=s(47879),C=s(11956),P=s(37367),_=s(67089),O=s(66596),D=s(28354),B=s(79597),M=s(12221),z=s(99142),R=s(80963),L=s(84039),q=s(1364),G=s(88221),K=s(40806),U=s(47543),W=s(47149),$=s(38926),H=s(63340),J=s(25951),X=s(2556),Q=s(96551),Y=s(78502),Z=s.n(Y),ee=s(96067),ne=s(46976),se=s.n(ne),te=s(55093),le=s(13399),ie=s(33364),oe=s(42588),re=s(2647),ae=s(79569),de=e([d,h,v,x,A,f]);[d,h,v,x,A,f]=de.then?(await de)():de;const ce=()=>{var e,n,s;const t=_.A.useApp();let m="normal";const Y=(0,ee.md)(d.i7),ne=(0,j.CX)(),de=(0,b.Am)(),[ce,ue]=(0,w.zL)(),he=null!==(e=null===ne||void 0===ne?void 0:ne.supports("batch-timeout"))&&void 0!==e&&e,[ve,pe]=(0,te.useState)(!1),ge=(0,te.useMemo)((()=>{var e,n;return{sessionType:"interactive",allocationPreset:"auto-select",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0,...he&&{timeoutEnabled:!1,timeout:void 0,timeoutUnit:"s"}},envvars:[],...(null===(e=ne._config)||void 0===e?void 0:e.default_session_environment)&&{environments:{environment:null===(n=ne._config)||void 0===n?void 0:n.default_session_environment}},...u.jh,resourceGroup:ce||void 0}}),[null===(n=ne._config)||void 0===n?void 0:n.default_session_environment,ce,he]),xe=(0,re.withDefault)(re.NumberParam,0),Ae=(0,re.withDefault)(re.JsonParam,ge),ye=(0,re.withDefault)(re.JsonParam,{}),[{step:je,formValues:be,redirectTo:Fe,appOption:we},fe]=(0,re.useQueryParams)({step:xe,formValues:Ae,redirectTo:re.StringParam,appOption:ye}),{search:Se}=(0,oe.zy)(),ke=(0,j.f0)(),Te=(0,w.hd)(),[Ee,{toggle:Ve}]=(0,C.A)(),{upsertNotification:Ie}=(0,F.js)(),[,{push:Ne}]=(0,f.b)(),{run:Ce}=(0,P.A)((()=>{const e=Be.getFieldsValue();fe({formValues:se().extend(se().omit(Be.getFieldsValue(),["environments.image"],["environments.customizedTag"],["autoMountedFolderNames"],["owner"],["envvars"]),{envvars:(0,o.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),Pe=e=>{fe({step:e},"pushIn")},{token:_e}=O.A.useToken(),{t:Oe}=(0,ie.Bd)(),De=D.Ay.useBreakpoint(),[Be]=B.A.useForm();(0,te.useEffect)((()=>{se().isEmpty(be)||Be.validateFields().catch((e=>{}))}),[]);const Me=(0,te.useMemo)((()=>se().merge({},ge,be)),[ge,be]);(0,te.useEffect)((()=>{var e;null===(e=Y.current)||void 0===e||e.scrollTo(0,0)}),[je]);const ze=B.A.useWatch("sessionType",{form:Be,preserve:!0})||Be.getFieldValue("sessionType")||be.sessionType,Re=(0,y.LY)([{title:Oe("session.launcher.SessionType"),key:"sessionType"},{title:`${Oe("session.launcher.Environments")} & ${Oe("session.launcher.ResourceAllocation")} `,key:"environment"},"inference"!==ze&&{title:Oe("webui.menu.Data&Storage"),key:"storage"},{title:Oe("session.launcher.Network"),key:"network"},{title:Oe("session.launcher.ConfirmAndLaunch"),icon:(0,ae.jsx)(k.A,{}),key:"review"}]),Le=null===(s=Re[je])||void 0===s?void 0:s.key,qe=se().some(Be.getFieldsError(),(e=>e.errors.length>0)),[Ge,Ke]=(0,j.Tw)("first");(0,te.useEffect)((()=>{je===Re.length-1&&Be.validateFields().catch((e=>{})).finally((()=>Ke()))}),[je,Be,Ke,Re.length]),(0,te.useEffect)((()=>{"first"!==Ge&&We(!!qe)}),[Ge,qe]);const[Ue,We]=(0,te.useState)(!1),[$e,He]=(0,te.useState)(!1);return(0,te.useLayoutEffect)((()=>{$e&&(Be.resetFields(),He(!1))}),[$e,Be]),(0,ae.jsxs)(r.A,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,ae.jsx)("style",{children:S}),(0,ae.jsxs)(r.A,{direction:"row",gap:"md",align:"start",children:[(0,ae.jsxs)(r.A,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,ae.jsxs)(r.A,{direction:"row",justify:"between",children:[(0,ae.jsx)(M.A.Title,{level:4,style:{marginTop:0},children:Oe("session.launcher.StartNewSession")}),(0,ae.jsx)(r.A,{direction:"row",gap:"sm",children:(0,ae.jsx)(z.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>Ve(),children:Oe("session.launcher.RecentHistory")})})]}),(0,ae.jsx)(B.A.Provider,{onFormChange:(e,n)=>{Ce()},children:(0,ae.jsx)(B.A,{form:Be,layout:"vertical",requiredMark:"optional",initialValues:Me,children:(0,ae.jsxs)(r.A,{direction:"column",align:"stretch",gap:"md",children:[(0,ae.jsxs)(R.A,{title:Oe("session.launcher.SessionType"),style:{display:"sessionType"===Le?"block":"none"},children:[(0,ae.jsx)(B.A.Item,{name:"sessionType",children:(0,ae.jsx)(L.Ay.Group,{options:[{label:(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)(M.A.Text,{code:!0,children:Oe("session.launcher.InteractiveMode")})," ",(0,ae.jsx)(M.A.Text,{type:"secondary",children:Oe("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,ae.jsxs)(ae.Fragment,{children:[(0,ae.jsx)(M.A.Text,{code:!0,children:Oe("session.launcher.BatchMode")})," ",(0,ae.jsx)(M.A.Text,{type:"secondary",children:Oe("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,ae.jsx)(p.A,{}),(0,ae.jsx)(B.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,ae.jsx)(q.A,{})})]}),"batch"===ze&&(0,ae.jsxs)(R.A,{title:Oe("session.launcher.BatchModeConfig"),style:{display:"sessionType"===Le?"block":"none"},children:[(0,ae.jsx)(B.A.Item,{label:Oe("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,ae.jsx)(q.A.TextArea,{autoSize:!0})}),(0,ae.jsx)(B.A.Item,{noStyle:!0,dependencies:[["batch","scheduleDate"]],children:()=>{const e=Be.getFieldValue(["batch","scheduleDate"]);return(0,ae.jsx)(l.A,{delay:1e3,callback:()=>{const e=Be.getFieldValue(["batch","scheduleDate"]);return e?Z()(e).isBefore(Z()())?void(0===Be.getFieldError(["batch","scheduleDate"]).length&&Be.validateFields([["batch","scheduleDate"]])):Z()(e).fromNow():void 0},triggerKey:e||"none",render:e=>(0,ae.jsx)(B.A.Item,{label:Oe("session.launcher.SessionStartTime"),extra:e,children:(0,ae.jsxs)(r.A,{direction:"row",gap:"xs",children:[(0,ae.jsx)(B.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,ae.jsx)(G.A,{onChange:e=>{e.target.checked&&se().isEmpty(Be.getFieldValue(["batch","scheduleDate"]))?Be.setFieldValue(["batch","scheduleDate"],Z()().add(2,"minutes").toISOString()):!1===e.target.checked&&Be.setFieldValue(["batch","scheduleDate"],void 0),Be.validateFields([["batch","scheduleDate"]])},children:Oe("session.launcher.Enable")})}),(0,ae.jsx)(B.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,t;return(null===(s=e.batch)||void 0===s?void 0:s.enabled)!==(null===(t=n.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const n=!0!==(null===(e=Be.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,ae.jsx)(ae.Fragment,{children:(0,ae.jsx)(B.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&Z()(n).isBefore(Z()())?Promise.reject(Oe("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,ae.jsx)(i.A,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(Z()().startOf("day"))})})})}})]})})})}}),he?(0,ae.jsx)(B.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"],["batch","timeoutUnit"]],children:()=>{const e=Be.getFieldValue(["batch","timeout"]),n=Be.getFieldValue(["batch","timeoutUnit"]),s=Z().duration(e,null!==n&&void 0!==n?n:"s"),t=(0,y.a3)(s,Oe),l=!se().isNull(e)&&se().toFinite(e)>0?t:null;return(0,ae.jsx)(B.A.Item,{label:Oe("session.launcher.BatchJobTimeoutDuration"),tooltip:Oe("session.launcher.BatchJobTimeoutDurationDesc"),help:l,children:(0,ae.jsxs)(r.A,{direction:"row",gap:"xs",children:[(0,ae.jsx)(B.A.Item,{noStyle:!0,name:["batch","timeoutEnabled"],valuePropName:"checked",children:(0,ae.jsx)(G.A,{onChange:e=>{!1===e.target.checked&&Be.setFieldValue(["batch","timeout"],void 0),Be.validateFields([["batch","timeout"]])},children:Oe("session.launcher.Enable")})}),(0,ae.jsx)(B.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"]],children:()=>{const e=!0!==Be.getFieldValue(["batch","timeoutEnabled"]);return(0,ae.jsx)(ae.Fragment,{children:(0,ae.jsx)(B.A.Item,{name:["batch","timeout"],label:Oe("session.launcher.BatchJobTimeoutDuration"),noStyle:!0,rules:[{min:0,type:"number",message:Oe("error.AllowsPositiveNumberOnly")},{required:!e}],children:(0,ae.jsx)(K.A,{disabled:e,min:1,addonAfter:(0,ae.jsx)(B.A.Item,{noStyle:!0,name:["batch","timeoutUnit"],children:(0,ae.jsx)(U.A,{tabIndex:-1,style:{minWidth:75},options:[{label:Oe("time.Sec"),value:"s"},{label:Oe("time.Min"),value:"m"},{label:Oe("time.Hour"),value:"h"},{label:Oe("time.Day"),value:"d"},{label:Oe("time.Week"),value:"w"}]})})})})})}})]})})}}):null]}),("admin"===de||"superadmin"===de)&&(0,ae.jsx)(g.A,{style:{display:"sessionType"===Le?"block":"none"}}),"inference"===ze&&(0,ae.jsx)(R.A,{title:"Inference Mode Configuration",children:(0,ae.jsx)(B.A.Item,{name:["inference","vFolderName"],label:Oe("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,ae.jsx)(U.A,{})})}),(0,ae.jsxs)(R.A,{title:Oe("session.launcher.Environments"),style:{display:"environment"===Le?"block":"none"},children:[(0,ae.jsx)(le.tH,{fallbackRender:e=>(console.log(e),null),children:(0,ae.jsx)(a.A,{})}),(0,ae.jsx)(B.A.Item,{label:Oe("session.launcher.EnvironmentVariable"),children:(0,ae.jsx)(o.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,ae.jsx)(R.A,{title:Oe("session.launcher.ResourceAllocation"),style:{display:"environment"===Le?"block":"none"},children:(0,ae.jsx)(u.Ay,{enableAgentSelect:!ne._config.hideAgents&&ne.supports("agent-select"),enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,ae.jsxs)(R.A,{title:Oe("session.launcher.HPCOptimization"),style:{display:"environment"===Le?"block":"none"},children:[(0,ae.jsx)(B.A.Item,{noStyle:!0,children:(0,ae.jsxs)(r.A,{direction:"row",gap:"sm",children:[(0,ae.jsx)(M.A.Text,{children:Oe("session.launcher.SwitchOpenMPoptimization")}),(0,ae.jsx)(B.A.Item,{label:Oe("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,ae.jsx)(W.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e&&Be.setFieldsValue(se().pick(ge,["hpcOptimization"]))}})})]})}),(0,ae.jsx)(B.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var s,t;return(null===(s=e.hpcOptimization)||void 0===s?void 0:s.autoEnabled)!==(null===(t=n.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=Be.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,ae.jsxs)($.A,{gutter:_e.marginMD,style:{display:e?"none":void 0,marginTop:_e.marginMD},children:[(0,ae.jsx)(H.A,{xs:24,sm:12,children:(0,ae.jsx)(B.A.Item,{style:{flex:1},label:Oe("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,ae.jsxs)(ae.Fragment,{children:[Oe("session.launcher.OpenMPOptimization"),(0,ae.jsx)(ie.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,ae.jsx)(K.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,ae.jsx)(H.A,{xs:24,sm:12,children:(0,ae.jsx)(B.A.Item,{style:{flex:1},label:Oe("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,ae.jsxs)(ae.Fragment,{children:[Oe("session.launcher.OpenMPOptimization"),(0,ae.jsx)(ie.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,ae.jsx)(K.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,ae.jsx)(R.A,{title:Oe("webui.menu.Data&Storage"),style:{display:"storage"===Le?"block":"none"},children:(0,ae.jsx)(A.A,{filter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))}})}),(0,ae.jsx)(R.A,{title:Oe("session.launcher.Network"),style:{display:"network"===Le?"block":"none"},children:(0,ae.jsx)(c.Ay,{})}),"review"===Le&&(0,ae.jsx)(v.A,{onClickEditStep:e=>{const n=se().findIndex(Re,{key:e});Pe(n)}}),(0,ae.jsxs)(r.A,{direction:"row",justify:"between",children:[(0,ae.jsx)(r.A,{gap:"sm",children:(0,ae.jsx)(J.A,{title:Oe("button.Reset"),description:Oe("session.launcher.ResetFormConfirm"),onConfirm:()=>{fe({},"replace"),He(!0)},icon:(0,ae.jsx)(T.A,{style:{color:_e.colorError}}),okText:Oe("button.Reset"),okButtonProps:{danger:!0},children:(0,ae.jsx)(z.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:Oe("button.Reset")})})}),(0,ae.jsxs)(r.A,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[je>0&&(0,ae.jsx)(z.Ay,{onClick:()=>{Pe(je-1)},icon:(0,ae.jsx)(E.A,{}),disabled:ve,children:Oe("button.Previous")}),je===Re.length-1?(0,ae.jsx)(X.A,{title:qe?Oe("session.launcher.PleaseCompleteForm"):void 0,children:(0,ae.jsx)(z.Ay,{type:"primary",icon:(0,ae.jsx)(V.A,{}),disabled:qe,onClick:()=>{pe(!0);const e=Se;Be.validateFields().then((async n=>{var s,l,i,o,r,a;if(se().isEmpty(n.mounts)||0===n.mounts.length){if(!await new Promise((e=>{t.modal.confirm({title:Oe("session.launcher.NoFolderMounted"),content:(0,ae.jsxs)(ae.Fragment,{children:[Oe("session.launcher.HomeDirectoryDeletionDialog"),(0,ae.jsx)("br",{}),(0,ae.jsx)("br",{}),Oe("session.launcher.LaunchConfirmationDialog"),(0,ae.jsx)("br",{}),(0,ae.jsx)("br",{}),Oe("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:Oe("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const d=n.environments.manual||n.environments.version;let[u,h]=d?d.split("@"):["",""];const v=se().isEmpty(n.sessionName)?me():n.sessionName,p={kernelName:u,architecture:h,sessionName:v,...he&&null!==n&&void 0!==n&&null!==(s=n.batch)&&void 0!==s&&s.timeoutEnabled&&!se().isUndefined(null===n||void 0===n||null===(l=n.batch)||void 0===l?void 0:l.timeout)?{batchTimeout:se().toString(n.batch.timeout)+(null===n||void 0===n||null===(i=n.batch)||void 0===i?void 0:i.timeoutUnit)}:void 0,config:{...!ne.supports("agent-select")||null!==ne&&void 0!==ne&&null!==(o=ne._config)&&void 0!==o&&o.hideAgents||"auto"===n.agent?void 0:{agent_list:[n.agent].filter((e=>!!e))},type:n.sessionType,...se().isEmpty(n.bootstrap_script)?{}:{bootstrap_script:n.bootstrap_script},..."batch"===n.sessionType?{startsAt:n.batch.enabled?n.batch.scheduleDate:void 0,startupCommand:n.batch.command}:{},...null!==(r=n.owner)&&void 0!==r&&r.enabled?{group_name:n.owner.project,domain:n.owner.domainName,scaling_group:n.owner.project,owner_access_key:n.owner.accesskey}:{group_name:Te.name,domain:ne._config.domainName,scaling_group:n.resourceGroup},cluster_mode:n.cluster_mode,cluster_size:n.cluster_size,maxWaitSeconds:15,cpu:n.resource.cpu,mem:n.resource.mem,shmem:(0,y.Mh)(n.resource.mem,"4g")>0&&(0,y.Mh)(n.resource.shmem,"1g")<0?"1g":n.resource.shmem,...n.resource.accelerator>0?{[n.resource.acceleratorType]:n.resource.accelerator}:void 0,mounts:n.mounts,mount_map:n.vfoldersAliasMap,env:{...se().fromPairs(n.envvars.map((e=>[e.variable,e.value]))),...se().omit(n.hpcOptimization,"autoEnabled")},preopen_ports:(0,c.tt)(n.ports),...!ne.supports("agent-select")||null!==ne&&void 0!==ne&&null!==(a=ne._config)&&void 0!==a&&a.hideAgents||"auto"===n.agent?void 0:{agent_list:[n.agent].filter((e=>!!e))}}},g=se().map(se().range(n.num_of_sessions||1),(e=>{const s=(n.num_of_sessions||1)>1?`${p.sessionName}-${(0,y.kX)()}-${e}`:p.sessionName;return ne.createIfNotExists(p.kernelName,s,p.config,3e4,p.architecture,p.batchTimeout).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(Oe("session.launcher.SessionAlreadyExists"));if("CANCELLED"===(null===e||void 0===e?void 0:e.status))throw new Error(Oe("session.launcher.FailedToStartNewSession"));return e})).catch((e=>{var n;throw null!==e&&void 0!==e&&null!==(n=e.message)&&void 0!==n&&n.includes("The session already exists")?new Error(Oe("session.launcher.SessionAlreadyExists")):e}))}));ue(n.resourceGroup);const x=window.location.pathname+window.location.search;ke(Fe||"/job"),Ie({key:"session-launcher:"+v,backgroundTask:{promise:Promise.all(g),status:"pending",statusDescriptions:{pending:Oe("session.PreparingSession"),resolved:Oe("eduapi.ComputeSessionPrepared")}},duration:0,message:Oe("general.Session")+": "+v,open:!0}),await Promise.all(g).then((s=>{let[t]=s;if(Ie({key:"session-launcher:"+v,to:`/session?sessionDetail=${t.sessionId}`}),Ne({id:t.sessionId,params:e,name:t.sessionName}),1===n.num_of_sessions&&"batch"!==n.sessionType){const e=t;let n=se().cloneDeep(we);n="kernelId"in e?se().extend(n,{"session-name":e.kernelId,"access-key":"",mode:m}):se().extend(n,{"session-uuid":e.sessionId,"session-name":e.sessionName,"access-key":"",mode:m});const s=e.servicePorts;!0===Array.isArray(s)?n["app-services"]=s.map((e=>e.name)):n["app-services"]=[],s.length>0&&globalThis.appLauncher.showLauncher(n)}})).catch((()=>{Ie({key:"session-launcher:"+v,to:x,toText:Oe("button.Edit")})}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{pe(!1)}))},loading:ve,children:Oe("session.launcher.Launch")})}):(0,ae.jsxs)(z.Ay,{type:"primary",ghost:!0,onClick:()=>{Pe(je+1)},children:[Oe("button.Next")," ",(0,ae.jsx)(I.A,{})]}),je!==Re.length-1&&(0,ae.jsxs)(z.Ay,{onClick:()=>{Pe(Re.length-1)},children:[Oe("session.launcher.SkipToConfirmAndLaunch"),(0,ae.jsx)(N.A,{})]})]})]})]})})})]}),De.lg&&(0,ae.jsx)(r.A,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,ae.jsx)(Q.A,{size:"small",direction:"vertical",current:je,onChange:e=>{Pe(e)},items:se().map(Re,((e,n)=>({...e,status:n===je?"process":"wait"})))})})]}),(0,ae.jsx)(x.A,{onRequestClose:e=>{if(e){const n=se().merge({sessionName:"",ports:[],mounts:[],vfoldersAliasMap:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0},agent:"auto"},e);se().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,y.kX)(4)),Be.setFieldsValue(n),Pe(Re.length-1),Be.validateFields().catch((()=>{}))}Ve()},open:Ee}),je===Re.length-1?(0,ae.jsx)(le.tH,{fallback:null,children:(0,ae.jsx)(h.A,{open:Ue,onClose:()=>{We(!1)},scrollIntoViewOptions:!0})}):void 0]})},ue=e=>{let{resource:n,containerCount:s=1}=e;return(0,ae.jsxs)(ae.Fragment,{children:[se().map(se().omit(n,"shmem","accelerator","acceleratorType"),((e,t)=>{var l,i;return"0"===e?null:(0,ae.jsx)(m.A,{type:t,value:"mem"===t?((null===(l=(0,y.Is)(e.toString(),"b"))||void 0===l?void 0:l.number)||0)*s+"":se().toNumber(e)*s+"",opts:{shmem:n.shmem?((null===(i=(0,y.Is)(n.shmem,"b"))||void 0===i?void 0:i.number)||0)*s:void 0}},t)})),n&&n.accelerator&&n.acceleratorType&&se().isNumber(n.accelerator)?(0,ae.jsx)(m.A,{type:n.acceleratorType,value:se().toString(n.accelerator*s)}):null]})},me=()=>{let e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let s=0;s<8;s++)e+=n.charAt(Math.floor(62*Math.random()));return e+"-session"},he=ce;t()}catch(ce){t(ce)}}))},37903:e=>{e.exports=".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}}]);
//# sourceMappingURL=424.a04604de.chunk.js.map