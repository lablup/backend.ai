"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[497],{88630:function(e,l,n){var a,i=n(40406),r=n(56713),o=n(44036),s=n(227),t=n(38812),u=(n(4519),n(81748)),d=n(16980),c=n(2556);l.Z=function(e){var l=e.endpointFrgmt,m=(0,u.$G)().t,g=o.Z.useToken().token,v=(0,i.Dj)(),p=(0,d.useFragment)(void 0!==a?a:a=n(76480),l);return v.supports("model-serving-endpoint-user-info")?(null===p||void 0===p?void 0:p.created_user_email)===(null===p||void 0===p?void 0:p.session_owner_email)?(null===p||void 0===p?void 0:p.session_owner_email)||"":(0,c.jsxs)(c.Fragment,{children:[(null===p||void 0===p?void 0:p.session_owner_email)||"",(0,c.jsx)(s.Z,{title:m("modelService.ServiceDelegatedFrom",{createdUser:(null===p||void 0===p?void 0:p.created_user_email)||"",sessionOwner:(null===p||void 0===p?void 0:p.session_owner_email)||""}),children:(0,c.jsx)(t.ZP,{size:"small",type:"text",icon:(0,c.jsx)(r.Z,{}),style:{color:g.colorTextSecondary}})})]}):v.email||""}},96451:function(e,l,n){var a,i=n(82548),r=(n(4519),n(16980)),o=n(2556);l.Z=function(e){var l,s=e.endpointFrgmt,t=(0,r.useFragment)(void 0!==a?a:a=n(58393),s),u="default";switch(null===t||void 0===t||null===(l=t.status)||void 0===l?void 0:l.toUpperCase()){case"RUNNING":case"HEALTHY":u="success"}return(0,o.jsx)(i.Z,{color:u,children:null===t||void 0===t?void 0:t.status})}},38252:function(e,l,n){n.d(l,{Z:function(){return D}});var a,i,r=n(37762),o=n(4942),s=n(1413),t=n(29439),u=n(44925),d=n(20328),c=n(43255),m=n(40406),g=n(50164),v=n(77758),p=n(99277),_=n(46228),y=n(15008),f=n(17913),k=n(72887),S=n(32048),F=n.n(S),h=n(4519),b=n(2556),K=["filter","autoSelectDefault"],Z=function(e){var l,n,a=e.filter,i=e.autoSelectDefault,r=(0,u.Z)(e,K),o=(0,m.qh)(),d=(0,c.y3)(),v=(0,m.Kr)("first"),p=(0,t.Z)(v,2),_=p[0],y=p[1],f=(0,g.h)({queryKey:["VFolderSelectQuery",_],queryFn:function(){return d({method:"GET",url:"/folders?group_id=".concat(o.id)})},staleTime:0}).data,S=a?F().filter(f,a):f,Z=F().first(S)?{label:null===(l=F().first(S))||void 0===l?void 0:l.name,value:null===(n=F().first(S))||void 0===n?void 0:n.name}:void 0;return(0,h.useEffect)((function(){var e;i&&Z&&(null===(e=r.onChange)||void 0===e||e.call(r,Z.value,Z))}),[i]),(0,b.jsx)(k.Z,(0,s.Z)((0,s.Z)({showSearch:!0},r),{},{onDropdownVisibleChange:function(e){e&&(0,h.startTransition)((function(){y()}))},children:F().map(S,(function(e){return(0,b.jsx)(k.Z.Option,{value:null===e||void 0===e?void 0:e.name,children:null===e||void 0===e?void 0:e.name},null===e||void 0===e?void 0:e.id)}))}))},j=n(44036),x=n(57054),T=n(88464),P=n(14027),N=n(38812),L=n(38818),M=n(62708),C=n(86199),E=n(81748),w=n(16980),O=["extraP","endpointFrgmt","onRequestClose"],D=function(e){e.extraP;var l,k,S,K,D,z,I,U,R,q,V=e.endpointFrgmt,G=void 0===V?null:V,$=e.onRequestClose,J=(0,u.Z)(e,O),A=(0,E.$G)().t,Y=j.Z.useToken().token,H=(0,m.Dj)(),Q=(0,m.tQ)(),B=x.Z.useForm(),W=(0,t.Z)(B,1)[0],X=(0,w.useFragment)(void 0!==a?a:a=n(32183),G),ee=function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&e&&!F().isEmpty(e)},le=function(){var e,l,n,a,i,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1?arguments[1]:void 0;return{image:{name:r?null===(e=o.environments.manual)||void 0===e?void 0:e.split("@")[0]:o.environments.version.split("@")[0],architecture:r?null===(l=o.environments.manual)||void 0===l?void 0:l.split("@")[1]:null===(n=o.environments.image)||void 0===n?void 0:n.architecture,registry:r?null===(a=o.environments.manual)||void 0===a?void 0:a.split("/")[0]:null===(i=o.environments.image)||void 0===i?void 0:i.registry}}},ne=(0,g.Y)({mutationFn:function(e){var l={to:e.desiredRoutingCount};return(0,c.Lc)({method:"POST",url:"/services/".concat(null===X||void 0===X?void 0:X.endpoint_id,"/scale"),body:l,client:H})}}),ae=(0,g.Y)({mutationFn:function(e){var l,n=(0,s.Z)((0,s.Z)({name:e.serviceName,desired_session_count:e.desiredRoutingCount},function(){var e,l,n,a,i,r,o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],s=arguments.length>1?arguments[1]:void 0;return{image:o?null===(e=s.environments.manual)||void 0===e?void 0:e.split("@")[0]:"".concat(null===(l=s.environments.image)||void 0===l?void 0:l.registry,"/").concat(null===(n=s.environments.image)||void 0===n?void 0:n.name,":").concat(null===(a=s.environments.image)||void 0===a?void 0:a.tag),architecture:o?null===(i=s.environments.manual)||void 0===i?void 0:i.split("@")[1]:null===(r=s.environments.image)||void 0===r?void 0:r.architecture}}(ee(H._config.allow_manual_image_name_for_session,null===(l=e.environments)||void 0===l?void 0:l.manual),e)),{},{group:H.current_group,domain:Q,cluster_size:e.cluster_size,cluster_mode:e.cluster_mode,open_to_public:e.openToPublic,config:{model:e.vFolderName,model_mount_destination:"/models",environ:{},scaling_group:e.resourceGroup,resources:(0,s.Z)({cpu:e.resource.cpu.toString(),mem:e.resource.mem},e.resource.accelerator>0?(0,o.Z)({},e.resource.acceleratorType,e.resource.accelerator.toString()):void 0),resource_opts:{shmem:(0,c.p)(e.resource.mem,"4g")>0&&(0,c.p)(e.resource.shmem,"1g")<0?"1g":e.resource.shmem}}});return(0,c.Lc)({method:"POST",url:"/services",body:n,client:H})}}),ie=(0,w.useMutation)(void 0!==i?i:i=n(22545)),re=(0,t.Z)(ie,1)[0],oe=function(){W.validateFields().then((function(e){if(X)if(H.supports("modify-endpoint")){var l,n={endpoint_id:(null===X||void 0===X?void 0:X.endpoint_id)||"",props:(0,s.Z)((0,s.Z)({resource_slots:JSON.stringify((0,s.Z)({cpu:e.resource.cpu,mem:e.resource.mem},e.resource.accelerator>0?(0,o.Z)({},e.resource.acceleratorType,e.resource.accelerator):void 0)),resource_opts:JSON.stringify({shmem:e.resource.shmem}),cluster_mode:"single-node"===e.cluster_mode?"SINGLE_NODE":"MULTI_NODE",cluster_size:e.cluster_size,desired_session_count:e.desiredRoutingCount},le(ee(H._config.allow_manual_image_name_for_session,null===(l=e.environments)||void 0===l?void 0:l.manual),e)),{},{name:e.serviceName,resource_group:e.resourceGroup})};re({variables:n,onCompleted:function(e,l){if(l&&(null===l||void 0===l?void 0:l.length)>0){var n,a=l.map((function(e){return e.message})),i=(0,r.Z)(a);try{for(i.s();!(n=i.n()).done;){var o=n.value;T.ZP.error(o,2.5)}}catch(u){i.e(u)}finally{i.f()}}else{var s,t=null===(s=e.modify_endpoint)||void 0===s?void 0:s.endpoint;T.ZP.success(A("modelService.ServiceUpdated",{name:null===t||void 0===t?void 0:t.name})),$(!0)}},onError:function(e){e.message?T.ZP.error(e.message):T.ZP.error(A("modelService.FailedToUpdateService"))}})}else ne.mutate(e,{onSuccess:function(){T.ZP.success(A("modelService.ServiceUpdated",{name:X.name})),$(!0)},onError:function(e){console.log(e),T.ZP.error(A("modelService.FailedToUpdateService"))}});else ae.mutate(e,{onSuccess:function(){T.ZP.success(A("modelService.ServiceCreated",{name:e.serviceName})),$(!0)},onError:function(e){null!==e&&void 0!==e&&e.message?T.ZP.error(F().truncate(null===e||void 0===e?void 0:e.message,{length:200})):X?T.ZP.error(A("modelService.FailedToUpdateService")):T.ZP.error(A("modelService.FailedToStartService"))}})})).catch((function(e){var l;(null===(l=e.errorFields)||void 0===l?void 0:l.length)>0?e.errorFields.forEach((function(e){T.ZP.error(e.errors)})):e.message?T.ZP.error(e.message):T.ZP.error(A("modelService.FormValidationFailed"))}))},se=function(){W.resetFields(),$()};return(0,b.jsx)(v.Z,(0,s.Z)((0,s.Z)({title:A(X?"modelService.EditModelService":"modelService.StartNewServing"),destroyOnClose:!0,maskClosable:!1,footer:function(){return(0,b.jsx)(p.Z,{direction:"row",justify:"end",align:"end",children:(0,b.jsxs)(P.Z,{size:"small",children:[(0,b.jsx)(N.ZP,{onClick:se,children:A("button.Cancel")}),(0,b.jsx)(N.ZP,{type:"primary",onClick:oe,children:A(X?"button.Update":"button.Create")})]})})},confirmLoading:ae.isLoading},J),{},{children:(0,b.jsx)(h.Suspense,{fallback:(0,b.jsx)(_.Z,{}),children:(0,b.jsxs)(x.Z,{disabled:ae.isLoading,form:W,preserve:!1,layout:"vertical",labelCol:{span:12},initialValues:X?{serviceName:null===X||void 0===X?void 0:X.name,resourceGroup:null===X||void 0===X?void 0:X.resource_group,desiredRoutingCount:(null===X||void 0===X?void 0:X.desired_session_count)||0,resource:(0,s.Z)({cpu:parseInt(null===(l=JSON.parse(null===X||void 0===X?void 0:X.resource_slots))||void 0===l?void 0:l.cpu),mem:null===(k=(0,c.PZ)((null===(S=JSON.parse(null===X||void 0===X?void 0:X.resource_slots))||void 0===S?void 0:S.mem)+"b","g",3,!0))||void 0===k?void 0:k.numberUnit,shmem:null===(K=(0,c.PZ)((null===(D=JSON.parse(null===X||void 0===X?void 0:X.resource_opts))||void 0===D?void 0:D.shmem)||d.A9,"g",3,!0))||void 0===K?void 0:K.numberUnit},function(e){if(!(Object.keys(e).length<=0)){var l=Object.keys(e)[0];return{acceleratorType:l,accelerator:"string"===typeof e[l]?"cuda.shares"===l?parseFloat(e[l]):parseInt(e[l]):e[l]}}}(F().omit(JSON.parse(null===X||void 0===X?void 0:X.resource_slots),["cpu","mem"]))),cluster_mode:"MULTI_NODE"===(null===X||void 0===X?void 0:X.cluster_mode)?"multi-node":"single-node",cluster_size:null===X||void 0===X?void 0:X.cluster_size,openToPublic:null===X||void 0===X?void 0:X.open_to_public,environments:{environment:null===X||void 0===X||null===(z=X.image_object)||void 0===z?void 0:z.name,version:"".concat(null===X||void 0===X||null===(I=X.image_object)||void 0===I?void 0:I.registry,"/").concat(null===X||void 0===X||null===(U=X.image_object)||void 0===U?void 0:U.name,":").concat(null===X||void 0===X||null===(R=X.image_object)||void 0===R?void 0:R.tag,"@").concat(null===X||void 0===X||null===(q=X.image_object)||void 0===q?void 0:q.architecture),image:null===X||void 0===X?void 0:X.image_object}}:(0,s.Z)({desiredRoutingCount:1},d.ds),requiredMark:"optional",children:[(H.supports("modify-endpoint")||!X)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x.Z.Item,{label:A("modelService.ServiceName"),name:"serviceName",rules:[{pattern:/^(?=.{4,24}$)\w[\w.-]*\w$/,message:A("modelService.ServiceNameRule")},{required:!0}],children:(0,b.jsx)(L.Z,{disabled:!!X})}),(0,b.jsx)(x.Z.Item,{name:"openToPublic",label:A("modelService.OpenToPublic"),valuePropName:"checked",children:(0,b.jsx)(M.Z,{disabled:!!X})}),(0,b.jsx)(x.Z.Item,{name:"vFolderName",label:A("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,b.jsx)(Z,{filter:function(e){return"model"===e.usage_mode},autoSelectDefault:!0,disabled:!!X})})]}),(0,b.jsx)(x.Z.Item,{label:A("modelService.DesiredRoutingCount"),name:"desiredRoutingCount",rules:[{required:!0,min:0,max:10,type:"number"}],children:(0,b.jsx)(f.Z,{min:0,max:10,inputNumberProps:{addonAfter:"#"},step:1})}),(H.supports("modify-endpoint")||!X)&&(0,b.jsxs)(C.Z,{style:{marginBottom:Y.margin},children:[(0,b.jsx)(y.Z,{}),(0,b.jsx)(d.ZP,{})]})]})})}))}},76480:function(e,l,n){n.r(l);var a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointOwnerInfoFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_owner_email",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"fb21a441c8873205b5092ae1a5a7157e"};l.default=a},58393:function(e,l,n){n.r(l);var a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointStatusTagFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"3b31efa50b55edddcb210b59003dc479"};l.default=a},32183:function(e,l,n){n.r(l);var a=function(){var e={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ServiceLauncherModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},{alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image_object",plural:!1,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_local",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"size_bytes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"supported_accelerators",storageKey:null}],storageKey:null},e],type:"Endpoint",abstractKey:null}}();a.hash="10c724f32d55db74673d172e9e93c609",l.default=a},22545:function(e,l,n){n.r(l);var a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpoint_id"},{defaultValue:null,kind:"LocalArgument",name:"props"}],l=[{kind:"Variable",name:"endpoint_id",variableName:"endpoint_id"},{kind:"Variable",name:"props",variableName:"props"}],n={alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"cluster_mode",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"is_local",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},S={alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[k,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},F={alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[k,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"size_bytes",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"supported_accelerators",storageKey:null},K={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ServiceLauncherModalModifyMutation",selections:[{alias:null,args:l,concreteType:"ModifyEndpoint",kind:"LinkedField",name:"modify_endpoint",plural:!1,selections:[n,a,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[i,r,o,s,t,u,d,c,{alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image_object",plural:!1,selections:[m,g,v,p,_,y,f,S,F,h,b],storageKey:null},m],storageKey:null}],storageKey:null}],type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ServiceLauncherModalModifyMutation",selections:[{alias:null,args:l,concreteType:"ModifyEndpoint",kind:"LinkedField",name:"modify_endpoint",plural:!1,selections:[n,a,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[i,r,o,s,t,u,d,c,{alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image_object",plural:!1,selections:[m,g,v,p,_,y,f,S,F,h,b,K],storageKey:null},m,K],storageKey:null}],storageKey:null}]},params:{cacheID:"09d6869b22966d8e2d161c95fc14da93",id:null,metadata:{},name:"ServiceLauncherModalModifyMutation",operationKind:"mutation",text:'mutation ServiceLauncherModalModifyMutation(\n  $endpoint_id: UUID!\n  $props: ModifyEndpointInput!\n) {\n  modify_endpoint(endpoint_id: $endpoint_id, props: $props) {\n    ok\n    msg\n    endpoint {\n      endpoint_id\n      desired_session_count\n      resource_group\n      resource_slots\n      resource_opts\n      cluster_mode\n      cluster_size\n      open_to_public\n      image_object @since(version: "23.09.9") {\n        name\n        humanized_name\n        tag\n        registry\n        architecture\n        is_local\n        digest\n        resource_limits {\n          key\n          min\n          max\n        }\n        labels {\n          key\n          value\n        }\n        size_bytes\n        supported_accelerators\n        id\n      }\n      name\n      id\n    }\n  }\n}\n'}}}();a.hash="b85185e800a0eec6328dc99bdb72c3a4",l.default=a}}]);
//# sourceMappingURL=497.20fb1462.chunk.js.map