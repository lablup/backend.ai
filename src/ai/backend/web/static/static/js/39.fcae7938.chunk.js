"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[39],{7007:function(e,n,i){var t=i(5870),r=i(9277),l=i(2048),a=i.n(l),o=i(2556);n.Z=function(e){var n,i=e.values,l=void 0===i?[]:i;return 0===l.length?null:(n=a().isString(l[0])?l.map((function(e){return{label:e,color:"blue"}})):l,(0,o.jsx)(r.Z,{direction:"row",children:a().map(n,(function(e,i){return(0,o.jsx)(t.Z,{style:a().last(n)===e?void 0:{margin:0,marginRight:-1,zIndex:1},children:e.label},i)}))}))}},9277:function(e,n,i){var t=i(1413),r=i(4925),l=i(4036),a=(i(4519),i(2556)),o=["direction","wrap","justify","align","gap","style","children"];n.Z=function(e){var n=e.direction,i=void 0===n?"row":n,s=e.wrap,u=void 0===s?"nowrap":s,d=e.justify,c=void 0===d?"flex-start":d,m=e.align,g=void 0===m?"center":m,v=e.gap,f=void 0===v?0:v,p=e.style,h=e.children,y=(0,r.Z)(e,o),x=l.Z.useToken().token,b=[c,g],k=null===b||void 0===b?void 0:b.map((function(e){var n;switch(e){case"start":n="flex-start";break;case"end":n="flex-end";break;case"between":n="space-between";break;case"around":n="space-around";break;default:n=e}return n})),Z=(0,t.Z)({display:"flex",flexDirection:i,flexWrap:u,justifyContent:k[0],alignItems:k[1]},p);return(0,a.jsx)("div",(0,t.Z)((0,t.Z)({style:(0,t.Z)({alignItems:"stretch",backgroundColor:"transparent",border:"0 solid black",boxSizing:"border-box",display:"flex",flexBasis:"auto",flexDirection:"column",flexShrink:0,listStyle:"none",margin:0,minHeight:0,minWidth:0,padding:0,position:"relative",textDecoration:"none",gap:"string"===typeof f?x["padding"+f.toUpperCase()]:f},Z)},y),{},{children:h}))}},6228:function(e,n,i){var t=i(1413),r=i(9277),l=i(2064),a=i(7171),o=(i(4519),i(2556));n.Z=function(e){var n=e.style,i=e.children;return(0,o.jsxs)(r.Z,{direction:"row",justify:"center",align:"center",style:(0,t.Z)({width:"100%",height:"100%"},n),children:[(0,o.jsx)(a.Z,{indicator:(0,o.jsx)(l.Z,{spin:!0})}),i]})}},4001:function(e,n,i){var t=i(1413),r=i(9439),l=i(4519),a=i(7760),o=i(2556),s=function(e,n){var i=e.image,l=e.style,s=void 0===l?{}:l,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=(0,a.dS)(),c=(0,r.Z)(d,2)[1].getImageIcon;return(0,o.jsx)("img",{src:c(i),style:(0,t.Z)({width:"1.5em",height:"1.5em"},s),alt:u})};n.Z=l.memo(s)},1947:function(e,n,i){i.r(n);var t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},i=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:i,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:i},params:{cacheID:"ea71f4a3948d4742dd6bb11ef80a8300",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:"query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    name\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n  }\n}\n"}}}();t.hash="33367bd6e1532b42b61629ef9d3dc46b",n.default=t},6326:function(e,n,i){i.r(n);var t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ModelServiceSettingModal_endpoint",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"881f18324b27eba6ff0fcfb83ae241d2"};n.default=t},3255:function(e,n,i){i.d(n,{Hz:function(){return u},Lc:function(){return a},Uz:function(){return d},VQ:function(){return c},We:function(){return l},en:function(){return s},lA:function(){return m},y3:function(){return o}});var t=i(7760),r=i(2556),l=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:/(<br\s*\/?>|\n)/;return e.split(n).map((function(e,i){return e.match(n)?(0,r.jsx)("br",{},i):e}))},a=function(e){var n=e.method,i=e.url,t=e.body,r=void 0===t?null:t,l=e.client,a=null===l||void 0===l?void 0:l.newSignedRequest(n,i,r,null);return null===l||void 0===l?void 0:l._wrapWithPromise(a)},o=function(){var e=(0,t.Dj)();return function(n){var i=n.method,t=n.url,r=n.body;return a({method:i,url:t,body:void 0===r?null:r,client:e})}},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===e)return"0 Bytes";var i=Math.pow(10,3);n=n<0?0:n;var t=Math.floor(Math.log(Math.round(e))/Math.log(i));return t=t<0?0:t,parseFloat((e/Math.pow(i,t)).toFixed(n))+" "+["Bytes","KB","MB","GB","TB","PB"][t]},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=Math.pow(10,9);return Math.round(n*e)},d=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return null===e||void 0===e?arguments.length>2&&void 0!==arguments[2]?arguments[2]:"-":e?(e/Math.pow(10,9)).toFixed(n):e},c=function(e,n){return""===n||void 0===n?"":n.startsWith("".concat(e,":"))?n:"".concat(e,":").concat(n)},m=function(e){return e<70?"rgba(58, 178, 97, 1)":e<90?"rgb(223, 179, 23)":"#ef5350"}},7760:function(e,n,i){i.d(n,{Dj:function(){return d},Kr:function(){return a},M:function(){return u},dS:function(){return c},qh:function(){return s},tQ:function(){return o}});var t=i(9439),r=i(4519),l=i(7112),a=function(e){return function(e){var n=(0,r.useState)(e||(new Date).toISOString()),i=(0,t.Z)(n,2),l=i[0],a=i[1];return[l,function(e){a(e||(new Date).toISOString())}]}(e)},o=function(){return d()._config.domainName},s=function(){var e=d(),n=(0,r.useState)({name:e.current_group,id:e.groupIds[e.current_group]}),i=(0,t.Z)(n,2),l=i[0],a=i[1];return(0,r.useEffect)((function(){var n=function(n){var i=n.detail;a({name:i,id:e.groupIds[i]})};return document.addEventListener("backend-ai-group-changed",n),function(){document.removeEventListener("backend-ai-group-changed",n)}})),l},u=function(e){var n=e.api_endpoint;return(0,r.useMemo)((function(){var e=new globalThis.BackendAIClientConfig("","",n,"SESSION");return new globalThis.BackendAIClient(e,"Backend.AI Console.")}),[n])},d=function(){return(0,l.useQuery)({queryKey:"backendai-client-for-suspense",queryFn:function(){return new Promise((function(e){if("undefined"!==typeof globalThis.backendaiclient&&null!==globalThis.backendaiclient&&!1!==globalThis.backendaiclient.ready)return e(globalThis.backendaiclient);document.addEventListener("backend-ai-connected",(function n(){e(globalThis.backendaiclient),document.removeEventListener("backend-ai-connected",n)}))}))},retry:!1,suspense:!0}).data},c=function(){var e=(0,l.useQuery)({queryKey:"backendai-metadata-for-suspense",queryFn:function(){return fetch("resources/image_metadata.json").then((function(e){return e.json()})).then((function(e){return e}))},suspense:!0,retry:!1}).data,n=function(e){if(!e)return{key:"",tags:[]};var n=e.split("/"),i=(n[2]||n[1]).split(":"),r=(0,t.Z)(i,2);return{key:r[0],tags:r[1].split("-")}};return[e,{getImageAliasName:function(i){var t=n(i).key;return(null===e||void 0===e?void 0:e.imageInfo[t].name)||t},getImageIcon:function(i){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resources/icons/";if(!i)return"default.png";var r=n(i).key;return t+(void 0!==(null===e||void 0===e?void 0:e.imageInfo[r].icon)?null===e||void 0===e?void 0:e.imageInfo[r].icon:"default.png")},getImageTags:function(e){},getBaseVersion:function(e){return n(e).tags[0]},getBaseImage:function(e){return n(e).tags[1]},getImageMeta:n}]}},164:function(e,n,i){i.d(n,{Y:function(){return l},h:function(){return r}});var t=i(7112),r=t.useQuery,l=t.useMutation},9039:function(e,n,i){i.r(n),i.d(n,{default:function(){return re}});var t,r,l,a=i(9439),o=i(4036),s=i(9002),u=i(7600),d=i(2513),c=i(4027),m=i(8499),g=i(5870),v=i(3842),f=i(4519),p=i(9277),h=i(1748),y=i(1413),x=i(4925),b=i(9080),k=i(8818),Z=i(2708),j=i(3066),S=i(7760),_=i(1603),F=i(6653),I=i(2556),K=["name","min","max","step","rules","required","inputNumberProps","sliderProps"],w=function(e){var n=e.name,i=e.min,t=e.max,r=e.step,l=e.rules,a=e.required,o=e.inputNumberProps,s=e.sliderProps,u=(0,x.Z)(e,K);return(0,I.jsx)(b.Z.Item,(0,y.Z)((0,y.Z)({required:a},u),{},{children:(0,I.jsxs)(p.Z,{direction:"row",gap:"md",children:[(0,I.jsx)(p.Z,{direction:"column",align:"stretch",style:{flex:3},children:(0,I.jsx)(b.Z.Item,{name:n,noStyle:!0,rules:l,children:(0,I.jsx)(_.Z,(0,y.Z)({max:t,min:i,step:r},s))})}),(0,I.jsx)(p.Z,{style:{flex:2},children:(0,I.jsx)(b.Z.Item,{name:n,noStyle:!0,children:(0,I.jsx)(F.Z,(0,y.Z)({max:t,min:i,step:r},o))})})]})}))},C=i(6980),T=i(2048),L=i.n(T),N=i(1215),q=i(3799),D=i(4001),E=function(e){var n=e.children,i=e.keyword,t=e.style,r=n.toLowerCase().indexOf(null===i||void 0===i?void 0:i.toLowerCase());return(0,I.jsxs)("span",{children:[n.substring(0,r),(0,I.jsx)("b",{style:(0,y.Z)({backgroundColor:"orange",color:"black"},t),children:n.substring(r,r+i.length)}),n.substring(r+i.length)]})},P=i(7007),M=function(e){return e?"".concat(e.registry,"/").concat(e.name,":").concat(e.tag,"@").concat(e.architecture):void 0},B=function(e){var n=e.filter,r=b.Z.useFormInstance(),l=b.Z.useWatch("environments",r),o=(0,f.useState)(""),s=(0,a.Z)(o,2),u=s[0],d=s[1],c=(0,f.useState)(""),m=(0,a.Z)(c,2),g=m[0],v=m[1],y=(0,h.$G)().t,x=(0,S.dS)(),Z=(0,a.Z)(x,2),j=Z[0],_=Z[1].getImageMeta,F=(0,C.useLazyLoadQuery)(void 0!==t?t:t=i(1947),{installed:!0},{fetchPolicy:"store-and-network"}).images;(0,f.useEffect)((function(){var e,n,i,t,a=(null===l||void 0===l?void 0:l.environment)||(null===(e=K[0])||void 0===e||null===(n=e.environmentGroups[0])||void 0===n?void 0:n.environmentName);if(L().find(K,(function(e){return L().find(e.environmentGroups,(function(e){return e.environmentName===a&&(t=e,!0)}))})),!L().find(null===(i=t)||void 0===i?void 0:i.images,(function(e){return(null===l||void 0===l?void 0:l.version)===M(e)}))){var o,s=null===(o=t)||void 0===o?void 0:o.images[0];s&&r.setFieldsValue({environments:{environment:a,version:M(s),image:s}})}}),[null===l||void 0===l?void 0:l.environment]);var K=(0,f.useMemo)((function(){return L().chain(F).filter(n||function(){return!0}).groupBy((function(e){var n;return(null===j||void 0===j||null===(n=j.imageInfo[_(M(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map((function(e,n){return{groupName:n,environmentGroups:L().chain(e).groupBy((function(e){var n;return(null===j||void 0===j||null===(n=j.imageInfo[_(M(e)||"").key])||void 0===n?void 0:n.name)||(null===e||void 0===e?void 0:e.name)})).map((function(e,n){return{environmentName:n,images:e}})).sortBy((function(e){return e.environmentName})).value()}})).sortBy((function(e){return e.groupName})).value()}),[F,j,n]);return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(b.Z.Item,{name:["environments","environment"],label:"".concat(y("session.launcher.Environments")," / ").concat(y("session.launcher.Version")),rules:[{required:!0}],style:{marginBottom:10},children:(0,I.jsx)(N.Z,{showSearch:!0,autoClearSearchValue:!0,labelInValue:!1,searchValue:u,onSearch:d,defaultActiveFirstOption:!0,optionLabelProp:"label",children:L().map(K,(function(e){return(0,I.jsx)(N.Z.OptGroup,{label:e.groupName,children:L().map(e.environmentGroups,(function(e){var n=e.images[0];return(0,I.jsx)(N.Z.Option,{value:e.environmentName,label:(0,I.jsx)(p.Z,{direction:"row",children:(0,I.jsxs)(p.Z,{direction:"row",align:"center",gap:"xs",children:[(0,I.jsx)(D.Z,{image:M(n)||"",style:{width:15,height:15}}),e.environmentName]})}),children:(0,I.jsxs)(p.Z,{direction:"row",justify:"between",children:[(0,I.jsxs)(p.Z,{direction:"row",align:"center",gap:"xs",children:[(0,I.jsx)(D.Z,{image:M(n)||"",style:{width:15,height:15}}),(0,I.jsx)(E,{keyword:u,children:e.environmentName})]}),(0,I.jsx)(p.Z,{direction:"row",gap:"xs"})]})},e.environmentName)}))},e.groupName)}))})}),(0,I.jsx)(b.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,t;return(null===(i=e.environments)||void 0===i?void 0:i.environments)!==(null===(t=n.environments)||void 0===t?void 0:t.environment)},children:function(e){var n,i,t=e.getFieldValue;return L().find(K,(function(e){return L().find(e.environmentGroups,(function(e){var n;return e.environmentName===(null===(n=t("environments"))||void 0===n?void 0:n.environment)&&(i=e,!0)}))})),(0,I.jsx)(b.Z.Item,{name:["environments","version"],rules:[{required:!0}],children:(0,I.jsx)(N.Z,{onChange:function(){},showSearch:!0,searchValue:g,onSearch:v,autoClearSearchValue:!0,optionLabelProp:"label",children:L().map(L().uniqBy(null===(n=i)||void 0===n?void 0:n.images,"digest"),(function(e){var n,i,t,r=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""],l=(0,a.Z)(r,3),o=l[0],s=l[1],u=l[2];return(0,I.jsx)(N.Z.Option,{value:M(e),label:[o,null===j||void 0===j?void 0:j.tagAlias[s],null===e||void 0===e?void 0:e.architecture,null===j||void 0===j||null===(i=j.tagAlias[u])||void 0===i?void 0:i.split(":")[1]].filter((function(e){return!!e})).join(" / "),children:(0,I.jsxs)(p.Z,{direction:"row",children:[o,(0,I.jsx)(q.Z,{type:"vertical"}),null===j||void 0===j?void 0:j.tagAlias[s],(0,I.jsx)(q.Z,{type:"vertical"}),null===e||void 0===e?void 0:e.architecture,(0,I.jsx)(q.Z,{type:"vertical"}),u&&(0,I.jsx)(P.Z,{values:(null===j||void 0===j||null===(t=j.tagAlias[u])||void 0===t?void 0:t.split(":"))||[]})]})},null===e||void 0===e?void 0:e.digest)}))})})}}),(0,I.jsx)(b.Z.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,I.jsx)(k.Z,{})})]})},R=i(6228),A=i(3255),V=i(164),G=["projectId","autoSelectDefault","filter"],O=function(e){e.projectId;var n=e.autoSelectDefault,i=(e.filter,(0,x.Z)(e,G)),t=(0,A.y3)(),r=(0,S.qh)(),l=(0,S.Kr)("first"),o=(0,a.Z)(l,2),s=o[0],u=o[1],d=(0,V.h)({queryKey:["ResourceGroupSelectorQuery",s],queryFn:function(){return t({method:"GET",url:"/scaling-groups?group=".concat(r.name)})},staleTime:0}).data,c=(null===d||void 0===d?void 0:d.scaling_groups)||[],m=c[0]?{label:c[0].name,value:c[0].name}:void 0;return(0,f.useEffect)((function(){var e;n&&m&&(null===(e=i.onChange)||void 0===e||e.call(i,m.value,m))}),[n]),(0,I.jsx)(N.Z,(0,y.Z)((0,y.Z)({defaultActiveFirstOption:!0,defaultValue:n?m:void 0,onDropdownVisibleChange:function(e){e&&(0,f.startTransition)((function(){u()}))}},i),{},{children:L().map(c,(function(e,n){return(0,I.jsx)(N.Z.Option,{value:e.name,children:e.name},e.name)}))}))},Q=["filter","autoSelectDefault"],z=function(e){var n,i,t=e.filter,r=e.autoSelectDefault,l=(0,x.Z)(e,Q),o=(0,S.qh)(),s=(0,A.y3)(),u=(0,S.Kr)("first"),d=(0,a.Z)(u,2),c=d[0],m=d[1],g=(0,V.h)({queryKey:["VFolderSelectQuery",c],queryFn:function(){return s({method:"GET",url:"/folders?group_id=".concat(o.id)})},staleTime:0}).data,v=t?L().filter(g,t):g,p=L().first(v)?{label:null===(n=L().first(v))||void 0===n?void 0:n.name,value:null===(i=L().first(v))||void 0===i?void 0:i.name}:void 0;return(0,f.useEffect)((function(){var e;r&&p&&(null===(e=l.onChange)||void 0===e||e.call(l,p.value,p))}),[r]),(0,I.jsx)(N.Z,(0,y.Z)((0,y.Z)({showSearch:!0},l),{},{onDropdownVisibleChange:function(e){e&&(0,f.startTransition)((function(){m()}))},children:L().map(v,(function(e){return(0,I.jsx)(N.Z.Option,{value:null===e||void 0===e?void 0:e.name,children:null===e||void 0===e?void 0:e.name})}))}))},U=["extraP","onRequestClose"],$=function(e){e.extraP;var n=e.onRequestClose,i=(0,x.Z)(e,U),t=(0,h.$G)().t,r=o.Z.useToken().token,l=(0,S.Dj)(),s=(0,S.tQ)(),u=b.Z.useForm(),d=(0,a.Z)(u,1)[0],c=(0,V.Y)({mutationFn:function(e){var n,i,t,r,a="".concat(null===(n=e.environments.image)||void 0===n?void 0:n.registry,"/").concat(null===(i=e.environments.image)||void 0===i?void 0:i.name,":").concat(null===(t=e.environments.image)||void 0===t?void 0:t.tag),o={name:e.serviceName,desired_session_count:e.desiredRoutingCount,image:a,arch:null===(r=e.environments.image)||void 0===r?void 0:r.architecture,group:l.current_group,domain:s,cluster_size:1,cluster_mode:"single-node",open_to_public:e.openToPublic,config:{model:e.vFolderName,model_mount_destination:"/models",environ:{},scaling_group:e.resourceGroup,resources:{cpu:e.cpu,mem:e.mem+"G","cuda.shares":e.gpu}}};return e.shmem&&e.shmem>0&&(o.config.resource_opts={shmem:e.shmem}),(0,A.Lc)({method:"POST",url:"/services",body:o,client:l})}});return(0,I.jsx)(v.Z,(0,y.Z)((0,y.Z)({title:"Title",onOk:function(){d.validateFields().then((function(e){c.mutate(e,{onSuccess:function(){console.log("service created"),n(!0)},onError:function(e){console.log(e)}}),new Promise((function(e,n){})).then((function(){n(!0)}))}))},onCancel:function(){n()},destroyOnClose:!0,maskClosable:!1,confirmLoading:c.isLoading},i),{},{children:(0,I.jsx)(f.Suspense,{fallback:(0,I.jsx)(R.Z,{}),children:(0,I.jsxs)(b.Z,{disabled:c.isLoading,form:d,preserve:!1,layout:"vertical",labelCol:{span:12},initialValues:{cpu:1,gpu:0,mem:.25,shmem:0,desiredRoutingCount:1},children:[(0,I.jsx)(b.Z.Item,{label:"Service Name",name:"serviceName",rules:[{max:20}],children:(0,I.jsx)(k.Z,{})}),(0,I.jsx)(b.Z.Item,{name:"resourceGroup",label:t("session.ResourceGroup"),rules:[{required:!0}],children:(0,I.jsx)(O,{autoSelectDefault:!0})}),(0,I.jsx)(b.Z.Item,{name:"openToPublic",label:"Open To Public",children:(0,I.jsx)(Z.Z,{})}),(0,I.jsx)(b.Z.Item,{name:"vFolderName",label:t("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,I.jsx)(z,{filter:function(e){return"model"===e.usage_mode},autoSelectDefault:!0})}),(0,I.jsx)(w,{label:"Desired Routing Count",name:"desiredRoutingCount",rules:[{required:!0}],inputNumberProps:{addonAfter:"#"},required:!0}),(0,I.jsxs)(j.Z,{style:{marginBottom:r.margin},children:[(0,I.jsx)(B,{}),(0,I.jsx)(b.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,t,r,l;return(null===(i=e.environments)||void 0===i||null===(t=i.image)||void 0===t?void 0:t.digest)!==(null===(r=n.environments)||void 0===r||null===(l=r.image)||void 0===l?void 0:l.digest)},children:function(e){var n,i,r,l=null===(n=(0,e.getFieldValue)("environments"))||void 0===n?void 0:n.image;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(w,{name:"cpu",label:t("session.launcher.CPU"),min:parseInt((null===(i=L().find(null===l||void 0===l?void 0:l.resource_limits,(function(e){return"cpu"===(null===e||void 0===e?void 0:e.key)})))||void 0===i?void 0:i.min)||"0"),max:parseInt((null===(r=L().find(null===l||void 0===l?void 0:l.resource_limits,(function(e){return"cpu"===(null===e||void 0===e?void 0:e.key)})))||void 0===r?void 0:r.max)||"100"),inputNumberProps:{addonAfter:t("session.launcher.Core")},required:!0,rules:[{required:!0}]}),(0,I.jsx)(w,{name:"mem",label:t("session.launcher.Memory"),max:30,inputNumberProps:{addonAfter:"GB"},step:.05,required:!0,rules:[{required:!0}]}),(0,I.jsx)(w,{name:"shmem",label:t("session.launcher.SharedMemory"),max:30,step:.1,inputNumberProps:{addonAfter:"GB"},required:!0,rules:[{required:!0}]}),(0,I.jsx)(w,{style:{marginBottom:0},name:"gpu",label:t("session.launcher.AIAccelerator"),max:30,step:.1,inputNumberProps:{addonAfter:"GPU"},required:!0,rules:[{required:!0}]})]})}})]})]})})}))},W=["onRequestClose","endpointFrgmt"],Y=function(e){var n=e.onRequestClose,t=e.endpointFrgmt,l=(0,x.Z)(e,W),s=o.Z.useToken().token,u=(0,S.Dj)(),d=b.Z.useForm(),c=(0,a.Z)(d,1)[0],m=(0,C.useFragment)(void 0!==r?r:r=i(6326),t),g=(0,V.Y)({mutationFn:function(e){var n={to:e.desired_session_count};return(0,A.Lc)({method:"POST",url:"/services/".concat(null===m||void 0===m?void 0:m.endpoint_id,"/scale"),body:n,client:u})}});return(0,I.jsx)(v.Z,(0,y.Z)((0,y.Z)({},l),{},{style:{zIndex:1e4},destroyOnClose:!0,onOk:function(e){c.validateFields().then((function(e){g.mutate(e,{onSuccess:function(){console.log("service updated"),n(!0)},onError:function(e){console.log(e)}})})).catch((function(e){console.log(e)}))},onCancel:function(){n()},okButtonProps:{loading:g.isLoading},title:"Edit Model Service",children:(0,I.jsx)(p.Z,{direction:"row",align:"stretch",justify:"around",children:(0,I.jsx)(b.Z,{form:c,preserve:!1,validateTrigger:["onChange","onBlur"],initialValues:{desired_session_count:null===m||void 0===m?void 0:m.desired_session_count},style:{marginBottom:s.marginLG,marginTop:s.margin},children:(0,I.jsx)(b.Z.Item,{name:"desired_session_count",label:"Desired Session Count",rules:[{pattern:/^[0-9]+$/,message:"Only Allows non-negative integers."}],children:(0,I.jsx)(F.Z,{type:"number",min:0})})})})}))},H=i(7477),J=i(3596),X=i(8501),ee=i(3861),ne=i(1662),ie=i(1843),te=function(){var e="default";if("RUNNING"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").toUpperCase())e="success";return e},re=function(e){e.children;var n=(0,h.$G)().t,t=(0,S.Dj)(),r=o.Z.useToken().token,y=(0,S.qh)(),x=(0,f.useState)(!1),b=(0,a.Z)(x,2),k=b[0],Z=b[1],j=(0,f.useState)(),_=(0,a.Z)(j,2),F=_[0],K=_[1],w=(0,f.useState)(!1),T=(0,a.Z)(w,2),N=T[0],q=T[1],D=(0,f.useState)({current:1,pageSize:100}),E=(0,a.Z)(D,1)[0],P=(0,f.useTransition)(),M=(0,a.Z)(P,2),B=M[0],R=M[1],G=(0,f.useState)(!1),O=(0,a.Z)(G,2),Q=O[0],z=O[1],U=(0,S.Kr)("initial-fetch"),W=(0,a.Z)(U,2),re=W[0],le=W[1],ae=(0,f.useState)("services"),oe=(0,a.Z)(ae,2),se=oe[0],ue=oe[1];(0,H.Z)((function(){(0,f.startTransition)((function(){le()}))}),7e3);var de=(0,C.useLazyLoadQuery)(void 0!==l?l:l=i(6142),{offset:(E.current-1)*E.pageSize,limit:E.pageSize,projectID:y.id},{fetchPolicy:"initial-fetch"===re?"store-and-network":"network-only",fetchKey:re}).endpoint_list,ce=L().sortBy(null===de||void 0===de?void 0:de.items,"name"),me=(0,V.Y)({mutationFn:function(){return(0,A.Lc)({method:"DELETE",url:"/services/"+(null===F||void 0===F?void 0:F.endpoint_id),client:t})}});return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(p.Z,{direction:"column",align:"stretch",style:{padding:r.padding,gap:r.margin},children:(0,I.jsxs)(p.Z,{direction:"column",align:"stretch",children:[(0,I.jsx)(p.Z,{style:{flex:1},children:(0,I.jsx)(s.ZP,{theme:{algorithm:o.Z.darkAlgorithm,components:{Tabs:{colorPrimary:"#92E868"}}},children:(0,I.jsx)(u.Z,{activeKey:se,onChange:function(e){return ue(e)},tabBarStyle:{marginBottom:0},style:{width:"100%",backgroundColor:"#2A2C30",paddingLeft:r.paddingMD,paddingRight:r.paddingMD,borderTopLeftRadius:r.borderRadius,borderTopRightRadius:r.borderRadius},items:[{key:"services",label:n("modelService.Services")}],tabBarExtraContent:{right:(0,I.jsx)(d.ZP,{type:"primary",onClick:function(){Z(!0)},children:"Start Service"})}})})}),(0,I.jsx)(f.Suspense,{fallback:(0,I.jsx)("div",{children:"loading.."}),children:(0,I.jsx)(c.Z,{loading:B,dataSource:ce||[],columns:[{title:"Endpoint name",dataIndex:"endpoint_id",fixed:"left",render:function(e,n){return(0,I.jsx)(ie.rU,{to:"/serving/"+e,children:n.name})}},{title:"Endpoint Id",dataIndex:"endpoint_id",width:310,render:function(e){return(0,I.jsx)(m.Z.Text,{code:!0,children:e})}},{title:"Controls",dataIndex:"controls",render:function(e,n){return(0,I.jsxs)(p.Z,{direction:"row",align:"stretch",children:[(0,I.jsx)(d.ZP,{type:"text",icon:(0,I.jsx)(J.Z,{}),style:n.desired_session_count>0?{color:"#29b6f6"}:void 0,disabled:n.desired_session_count<0,onClick:function(){q(!0),K(n)}}),(0,I.jsx)(d.ZP,{type:"text",icon:(0,I.jsx)(X.Z,{style:n.desired_session_count>0?{color:r.colorError}:void 0}),disabled:n.desired_session_count<0,onClick:function(){z(!0),K(n)}})]})}},{title:"Status",dataIndex:"status",render:function(e,n){return(0,I.jsx)(g.Z,{color:te(n.desired_session_count>0?"RUNNING":"TERMINATED"),children:n.desired_session_count>0?"RUNNING":"TERMINATED"})}},{title:"Desired Session Count",dataIndex:"desired_session_count",render:function(e){return e<0?"-":e}},{title:(0,I.jsxs)(p.Z,{direction:"column",align:"start",children:["Routings Count",(0,I.jsx)("br",{}),(0,I.jsx)(m.Z.Text,{type:"secondary",style:{fontWeight:"normal"},children:"(active/total)"})]}),render:function(e,n){var i;return L().filter(n.routings,(function(e){return"healthy"===(null===e||void 0===e?void 0:e.status)})).length+" / "+(null===(i=n.routings)||void 0===i?void 0:i.length)}},{title:"Public",render:function(e,n){return n.open_to_public?(0,I.jsx)(ee.Z,{style:{color:r.colorSuccess}}):(0,I.jsx)(ne.Z,{style:{color:r.colorTextSecondary}})}}],pagination:!1})})]})}),(0,I.jsx)(v.Z,{open:Q,title:n("dialog.title.LetsDouble-Check"),okButtonProps:{loading:me.isLoading},onOk:function(){me.mutate(void 0,{onSuccess:function(e){R((function(){le()})),z(!1)},onError:function(e){console.log("terminateModelServiceMutation Error",e)}})},onCancel:function(){z(!1)},children:(0,I.jsxs)(p.Z,{direction:"column",align:"stretch",justify:"center",children:[(0,I.jsx)("p",{children:"You are about to terminate "+((null===F||void 0===F?void 0:F.name)||"")+"."}),(0,I.jsx)("p",{children:n("dialog.ask.DoYouWantToProceed")})]})}),(0,I.jsx)(Y,{open:N,onRequestClose:function(e){q(!1),e&&R((function(){le()}))},endpointFrgmt:F||null}),(0,I.jsx)($,{open:k,onRequestClose:function(e){Z(!k),e&&R((function(){le()}))}})]})}},6142:function(e,n,i){i.r(n);var t=function(){var e={defaultValue:null,kind:"LocalArgument",name:"limit"},n={defaultValue:null,kind:"LocalArgument",name:"offset"},i={defaultValue:null,kind:"LocalArgument",name:"projectID"},t=[{kind:"Literal",name:"filter",value:"name != 'koalpaca-test'"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],r={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"model",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"domain",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"project",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"routing_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"endpoint",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"session",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"traffic_ratio",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[e,n,i],kind:"Fragment",metadata:null,name:"ServingListPageQuery",selections:[{alias:null,args:t,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[r,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[l,a,o,s,u,d,c,m,g,v,{kind:"RequiredField",field:f,action:"NONE",path:"endpoint_list.items.desired_session_count"},{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[p,h,y,x,b],storageKey:null},{args:null,kind:"FragmentSpread",name:"ModelServiceSettingModal_endpoint"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e,i],kind:"Operation",name:"ServingListPageQuery",selections:[{alias:null,args:t,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[r,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[l,a,o,s,u,d,c,m,g,v,f,{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[p,h,y,x,b,k],storageKey:null},k],storageKey:null}],storageKey:null}]},params:{cacheID:"e8962b0b84d03682b80681663f7f0031",id:null,metadata:{},name:"ServingListPageQuery",operationKind:"query",text:"query ServingListPageQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: \"name != 'koalpaca-test'\") {\n    total_count\n    items {\n      name\n      endpoint_id\n      image\n      model\n      domain\n      project\n      resource_group\n      resource_slots\n      url\n      open_to_public\n      desired_session_count\n      routings {\n        routing_id\n        endpoint\n        session\n        traffic_ratio\n        status\n        id\n      }\n      ...ModelServiceSettingModal_endpoint\n      id\n    }\n  }\n}\n\nfragment ModelServiceSettingModal_endpoint on Endpoint {\n  endpoint_id\n  desired_session_count\n}\n"}}}();t.hash="8c74706ec30c99bd1de50378d45b21bf",n.default=t}}]);
//# sourceMappingURL=39.fcae7938.chunk.js.map