/*! For license information please see 807.0573fff8.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[807,3273],{33273:(e,n,a)=>{a.r(n),a.d(n,{default:()=>f,passwordPattern:()=>b});var t=a(30032),o=a(83468),c=a(57857),i=a(59723),r=a(29871),l=a(82156),s=a(50840),d=a(7121),u=a(90214),m=a(97080),h=a(63284),g=a(6932),w=a(76998),p=a(77678),v=a(23446);const b=/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,f=()=>{const{value:e,dispatchEvent:n}=(0,i.useWebComponentInfo)();let a;try{a=JSON.parse(e||"")}catch(E){a={open:!1,currentPassword:"",username:"",api_endpoint:""}}const{open:f,currentPassword:k,username:S,api_endpoint:A}=a,{token:P}=s.A.useToken(),[C]=d.A.useForm(),{t:I}=(0,p.Bd)();(0,w.useEffect)((()=>{f&&C.resetFields()}),[f,C]);const y=(0,o.oM)({api_endpoint:A}),x=(0,c.ET)({mutationFn:e=>(0,t.hu)({method:"POST",url:"/server/update-password-no-auth",body:e,client:y})}),M=()=>{C.validateFields().then((e=>{x.mutate({username:S,current_password:k,new_password:e.newPassword},{onSuccess(e,a,t){n("ok",null)},onError(e,n,a){}})}))};return(0,v.jsx)(u.A,{open:f,centered:!0,mask:!1,onCancel:()=>{n("cancel",null)},keyboard:!1,maskClosable:!1,footer:null,width:450,destroyOnClose:!0,forceRender:!0,children:(0,v.jsxs)(r.A,{direction:"column",justify:"start",align:"stretch",gap:"md",style:{alignSelf:"stretch",paddingTop:P.paddingMD,paddingBottom:P.paddingMD},children:[(0,v.jsxs)(m.A.Title,{level:3,style:{margin:0},children:[(0,v.jsx)(l.A,{twoToneColor:P.colorWarning})," ",I("webui.menu.PleaseChangeYourPassword")]}),I("webui.menu.YouMushChangeYourPassword"),(0,v.jsxs)(d.A,{form:C,layout:"vertical",initialValues:{currentPassword:k},disabled:x.isLoading,children:[(0,v.jsx)(d.A.Item,{name:"newPassword",label:I("webui.menu.NewPassword"),rules:[{required:!0},{pattern:b,message:I("webui.menu.InvalidPasswordMessage").toString()},()=>({validator:(e,n)=>k===n?Promise.reject(new Error(I("webui.menu.NewPasswordCannotBeSame").toString())):Promise.resolve()})],hasFeedback:!0,children:(0,v.jsx)(h.A.Password,{})}),(0,v.jsx)(d.A.Item,{name:"confirm",label:I("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0},e=>{let{getFieldValue:n}=e;return{validator:(e,a)=>a&&n("newPassword")!==a?Promise.reject(new Error(I("environment.PasswordsDoNotMatch").toString())):Promise.resolve()}}],children:(0,v.jsx)(h.A.Password,{onPressEnter:M})})]}),(0,v.jsx)(g.Ay,{type:"primary",onClick:M,loading:x.isLoading,children:I("webui.menu.Update")})]})})}},60807:(e,n,a)=>{a.r(n),a.d(n,{default:()=>P});var t=a(83468),o=a(16162),c=a(57857),i=a(34103),r=a(33273),l=a(10235),s=a(60875),d=a(43336),u=a(45959),m=a(40379),h=a(24717),g=a(90214),w=a(73277),p=a(7121),v=a(63284),b=a(82745),f=a(76998),k=a(77678),S=a(3606),A=a(23446);const P=e=>{let{onRequestClose:n,onRequestRefresh:a,isRefreshModalPending:P,totpSupported:C,queryRef:I,...y}=e;const{t:x}=(0,k.Bd)(),M=(0,f.useRef)(null),[E,j]=h.Ay.useMessage(),[z,_]=g.A.useModal(),[N,{toggle:O}]=(0,m.A)(!1),q=(0,t.CX)(),T=(0,o.Am)(),[F,R]=(0,o.U6)(),{user:H}=(0,S.usePreloadedQuery)(s.j,I),D=(0,c.ET)({mutationFn:()=>q.remove_totp()});return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsxs)(i.A,{...y,okText:x("webui.menu.Update"),cancelText:x("webui.menu.Cancel"),onCancel:()=>{n()},confirmLoading:F.isPendingMutation,onOk:()=>(()=>{var e;null===(e=M.current)||void 0===e||e.validateFields().then((e=>{R.updateFullName(e.full_name,{onSuccess:a=>{a!==F.full_name&&E.open({type:"success",content:x("webui.menu.FullnameUpdated")}),e.newPassword&&e.newPasswordConfirm&&e.originalPassword?R.updatePassword({new_password:e.newPassword,new_password2:e.newPasswordConfirm,old_password:e.originalPassword},{onSuccess:()=>{E.open({type:"success",content:x("webui.menu.PasswordUpdated")}),n(!0)},onError:e=>{E.open({type:"error",content:e.message})}}):n(!0)},onError:e=>{E.open({type:"error",content:e.message})}})})).catch((()=>{}))})(),centered:!0,destroyOnClose:!0,title:x("webui.menu.MyAccountInformation"),children:[(0,A.jsx)(w.A,{spinning:P,indicator:(0,A.jsx)(d.A,{}),children:(0,A.jsxs)(p.A,{ref:M,layout:"vertical",labelCol:{span:8},initialValues:{full_name:F.full_name,totp_activated:(null===H||void 0===H?void 0:H.totp_activated)||!1},preserve:!1,children:[(0,A.jsx)(p.A.Item,{name:"full_name",label:x("webui.menu.FullName"),rules:[()=>({validator:(e,n)=>n&&n.length<65?Promise.resolve():Promise.reject(new Error(x("webui.menu.FullNameInvalid")))})],children:(0,A.jsx)(v.A,{})}),(0,A.jsx)(p.A.Item,{name:"originalPassword",label:x("webui.menu.OriginalPassword"),rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,a)=>a||!n("newPassword")&&!n("newPasswordConfirm")?Promise.resolve():Promise.reject(new Error(x("webui.menu.InputOriginalPassword")))}}],dependencies:["newPassword","newPasswordConfirm"],children:(0,A.jsx)(v.A.Password,{})}),(0,A.jsx)(p.A.Item,{name:"newPassword",label:x("webui.menu.NewPassword"),rules:[{pattern:"superadmin"===T?void 0:r.passwordPattern,message:x("webui.menu.InvalidPasswordMessage")}],children:(0,A.jsx)(v.A.Password,{})}),(0,A.jsx)(p.A.Item,{name:"newPasswordConfirm",label:x("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,a)=>a&&n("newPassword")!==a?Promise.reject(new Error(x("webui.menu.NewPasswordMismatch"))):Promise.resolve()}}],children:(0,A.jsx)(v.A.Password,{})}),!!C&&(0,A.jsx)(p.A.Item,{name:"totp_activated",label:x("webui.menu.TotpActivated"),valuePropName:"checked",children:(0,A.jsx)(b.A,{loading:D.isLoading,onChange:e=>{var n;e?O():null!==H&&void 0!==H&&H.totp_activated&&(null===(n=M.current)||void 0===n||n.setFieldValue("totp_activated",!0),z.confirm({title:x("totp.TurnOffTotp"),icon:(0,A.jsx)(u.A,{}),content:x("totp.ConfirmTotpRemovalBody"),okText:x("button.Yes"),okType:"danger",cancelText:x("button.No"),onOk(){D.mutate(void 0,{onSuccess:()=>{var e;h.Ay.success(x("totp.RemoveTotpSetupCompleted")),a(),null===(e=M.current)||void 0===e||e.setFieldValue("totp_activated",!1)},onError:e=>{h.Ay.error(e.message)}})},onCancel(){var e;null===(e=M.current)||void 0===e||e.setFieldValue("totp_activated",!0)}}))}})})]})}),!!C&&(0,A.jsx)(l.A,{userFrgmt:H,open:N,onRequestClose:e=>{var n;e?a():null===(n=M.current)||void 0===n||n.setFieldValue("totp_activated",!1);O()}})]}),j,_]})}},45959:(e,n,a)=>{a.d(n,{A:()=>l});var t=a(58168),o=a(76998),c=a(44018),i=a(13410),r=function(e,n){return o.createElement(i.A,(0,t.A)({},e,{ref:n,icon:c.A}))};const l=o.forwardRef(r)},82156:(e,n,a)=>{a.d(n,{A:()=>l});var t=a(58168),o=a(76998);const c={icon:function(e,n){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z",fill:e}},{tag:"path",attrs:{d:"M172.2 828.1h679.6L512 239.9 172.2 828.1zM560 720a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm-16-304v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8z",fill:n}},{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z",fill:e}}]}},name:"warning",theme:"twotone"};var i=a(13410),r=function(e,n){return o.createElement(i.A,(0,t.A)({},e,{ref:n,icon:c}))};const l=o.forwardRef(r)},82745:(e,n,a)=>{a.d(n,{A:()=>O});var t=a(76998),o=a(28983),c=a(34156),i=a.n(c),r=a(58168),l=a(64467),s=a(5544),d=a(80045),u=a(23551),m=a(36782),h=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],g=t.forwardRef((function(e,n){var a,o=e.prefixCls,c=void 0===o?"rc-switch":o,g=e.className,w=e.checked,p=e.defaultChecked,v=e.disabled,b=e.loadingIcon,f=e.checkedChildren,k=e.unCheckedChildren,S=e.onClick,A=e.onChange,P=e.onKeyDown,C=(0,d.A)(e,h),I=(0,u.A)(!1,{value:w,defaultValue:p}),y=(0,s.A)(I,2),x=y[0],M=y[1];function E(e,n){var a=x;return v||(M(a=e),null===A||void 0===A||A(a,n)),a}var j=i()(c,g,(a={},(0,l.A)(a,"".concat(c,"-checked"),x),(0,l.A)(a,"".concat(c,"-disabled"),v),a));return t.createElement("button",(0,r.A)({},C,{type:"button",role:"switch","aria-checked":x,disabled:v,className:j,ref:n,onKeyDown:function(e){e.which===m.A.LEFT?E(!1,e):e.which===m.A.RIGHT&&E(!0,e),null===P||void 0===P||P(e)},onClick:function(e){var n=E(!x,e);null===S||void 0===S||S(n,e)}}),b,t.createElement("span",{className:"".concat(c,"-inner")},t.createElement("span",{className:"".concat(c,"-inner-checked")},f),t.createElement("span",{className:"".concat(c,"-inner-unchecked")},k)))}));g.displayName="Switch";const w=g;var p=a(45127),v=a(28037),b=a(8565),f=a(67295),k=a(17996),S=a(16420),A=a(64663),P=a(55864),C=a(89514);const I=e=>{const{componentCls:n,trackHeightSM:a,trackPadding:t,trackMinWidthSM:o,innerMinMarginSM:c,innerMaxMarginSM:i,handleSizeSM:r,calc:l}=e,s="".concat(n,"-inner"),d=(0,k.zA)(l(r).add(l(t).mul(2)).equal()),u=(0,k.zA)(l(i).mul(2).equal());return{[n]:{["&".concat(n,"-small")]:{minWidth:o,height:a,lineHeight:(0,k.zA)(a),["".concat(n,"-inner")]:{paddingInlineStart:i,paddingInlineEnd:c,["".concat(s,"-checked, ").concat(s,"-unchecked")]:{minHeight:a},["".concat(s,"-checked")]:{marginInlineStart:"calc(-100% + ".concat(d," - ").concat(u,")"),marginInlineEnd:"calc(100% - ".concat(d," + ").concat(u,")")},["".concat(s,"-unchecked")]:{marginTop:l(a).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},["".concat(n,"-handle")]:{width:r,height:r},["".concat(n,"-loading-icon")]:{top:l(l(r).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},["&".concat(n,"-checked")]:{["".concat(n,"-inner")]:{paddingInlineStart:c,paddingInlineEnd:i,["".concat(s,"-checked")]:{marginInlineStart:0,marginInlineEnd:0},["".concat(s,"-unchecked")]:{marginInlineStart:"calc(100% - ".concat(d," + ").concat(u,")"),marginInlineEnd:"calc(-100% + ".concat(d," - ").concat(u,")")}},["".concat(n,"-handle")]:{insetInlineStart:"calc(100% - ".concat((0,k.zA)(l(r).add(t).equal()),")")}},["&:not(".concat(n,"-disabled):active")]:{["&:not(".concat(n,"-checked) ").concat(s)]:{["".concat(s,"-unchecked")]:{marginInlineStart:l(e.marginXXS).div(2).equal(),marginInlineEnd:l(e.marginXXS).mul(-1).div(2).equal()}},["&".concat(n,"-checked ").concat(s)]:{["".concat(s,"-checked")]:{marginInlineStart:l(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:l(e.marginXXS).div(2).equal()}}}}}}},y=e=>{const{componentCls:n,handleSize:a,calc:t}=e;return{[n]:{["".concat(n,"-loading-icon").concat(e.iconCls)]:{position:"relative",top:t(t(a).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},["&".concat(n,"-checked ").concat(n,"-loading-icon")]:{color:e.switchColor}}}},x=e=>{const{componentCls:n,trackPadding:a,handleBg:t,handleShadow:o,handleSize:c,calc:i}=e,r="".concat(n,"-handle");return{[n]:{[r]:{position:"absolute",top:a,insetInlineStart:a,width:c,height:c,transition:"all ".concat(e.switchDuration," ease-in-out"),"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:t,borderRadius:i(c).div(2).equal(),boxShadow:o,transition:"all ".concat(e.switchDuration," ease-in-out"),content:'""'}},["&".concat(n,"-checked ").concat(r)]:{insetInlineStart:"calc(100% - ".concat((0,k.zA)(i(c).add(a).equal()),")")},["&:not(".concat(n,"-disabled):active")]:{["".concat(r,"::before")]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},["&".concat(n,"-checked ").concat(r,"::before")]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},M=e=>{const{componentCls:n,trackHeight:a,trackPadding:t,innerMinMargin:o,innerMaxMargin:c,handleSize:i,calc:r}=e,l="".concat(n,"-inner"),s=(0,k.zA)(r(i).add(r(t).mul(2)).equal()),d=(0,k.zA)(r(c).mul(2).equal());return{[n]:{[l]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:c,paddingInlineEnd:o,transition:"padding-inline-start ".concat(e.switchDuration," ease-in-out, padding-inline-end ").concat(e.switchDuration," ease-in-out"),["".concat(l,"-checked, ").concat(l,"-unchecked")]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:"margin-inline-start ".concat(e.switchDuration," ease-in-out, margin-inline-end ").concat(e.switchDuration," ease-in-out"),pointerEvents:"none",minHeight:a},["".concat(l,"-checked")]:{marginInlineStart:"calc(-100% + ".concat(s," - ").concat(d,")"),marginInlineEnd:"calc(100% - ".concat(s," + ").concat(d,")")},["".concat(l,"-unchecked")]:{marginTop:r(a).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},["&".concat(n,"-checked ").concat(l)]:{paddingInlineStart:o,paddingInlineEnd:c,["".concat(l,"-checked")]:{marginInlineStart:0,marginInlineEnd:0},["".concat(l,"-unchecked")]:{marginInlineStart:"calc(100% - ".concat(s," + ").concat(d,")"),marginInlineEnd:"calc(-100% + ".concat(s," - ").concat(d,")")}},["&:not(".concat(n,"-disabled):active")]:{["&:not(".concat(n,"-checked) ").concat(l)]:{["".concat(l,"-unchecked")]:{marginInlineStart:r(t).mul(2).equal(),marginInlineEnd:r(t).mul(-1).mul(2).equal()}},["&".concat(n,"-checked ").concat(l)]:{["".concat(l,"-checked")]:{marginInlineStart:r(t).mul(-1).mul(2).equal(),marginInlineEnd:r(t).mul(2).equal()}}}}}},E=e=>{const{componentCls:n,trackHeight:a,trackMinWidth:t}=e;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},(0,A.dF)(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:t,height:a,lineHeight:"".concat((0,k.zA)(a)),verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:"all ".concat(e.motionDurationMid),userSelect:"none",["&:hover:not(".concat(n,"-disabled)")]:{background:e.colorTextTertiary}}),(0,A.K8)(e)),{["&".concat(n,"-checked")]:{background:e.switchColor,["&:hover:not(".concat(n,"-disabled)")]:{background:e.colorPrimaryHover}},["&".concat(n,"-loading, &").concat(n,"-disabled")]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},["&".concat(n,"-rtl")]:{direction:"rtl"}})}},j=(0,P.OF)("Switch",(e=>{const n=(0,C.h1)(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:"rgba(0, 0, 0, ".concat(e.opacityLoading,")"),switchHandleActiveInset:"-30%"});return[E(n),M(n),x(n),y(n),I(n)]}),(e=>{const{fontSize:n,lineHeight:a,controlHeight:t,colorWhite:o}=e,c=n*a,i=t/2,r=c-4,l=i-4;return{trackHeight:c,trackHeightSM:i,trackMinWidth:2*r+8,trackMinWidthSM:2*l+4,trackPadding:2,handleBg:o,handleSize:r,handleSizeSM:l,handleShadow:"0 2px 4px 0 ".concat(new S.q("#00230b").setAlpha(.2).toRgbString()),innerMinMargin:r/2,innerMaxMargin:r+2+4,innerMinMarginSM:l/2,innerMaxMarginSM:l+2+4}}));var z=function(e,n){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(a[t]=e[t]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var o=0;for(t=Object.getOwnPropertySymbols(e);o<t.length;o++)n.indexOf(t[o])<0&&Object.prototype.propertyIsEnumerable.call(e,t[o])&&(a[t[o]]=e[t[o]])}return a};const _=t.forwardRef(((e,n)=>{const{prefixCls:a,size:c,disabled:r,loading:l,className:s,rootClassName:d,style:m,checked:h,value:g,defaultChecked:k,defaultValue:S,onChange:A}=e,P=z(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[C,I]=(0,u.A)(!1,{value:null!==h&&void 0!==h?h:g,defaultValue:null!==k&&void 0!==k?k:S}),{getPrefixCls:y,direction:x,switch:M}=t.useContext(v.QO),E=t.useContext(b.A),_=(null!==r&&void 0!==r?r:E)||l,N=y("switch",a),O=t.createElement("div",{className:"".concat(N,"-handle")},l&&t.createElement(o.A,{className:"".concat(N,"-loading-icon")})),[q,T,F]=j(N),R=(0,f.A)(c),H=i()(null===M||void 0===M?void 0:M.className,{["".concat(N,"-small")]:"small"===R,["".concat(N,"-loading")]:l,["".concat(N,"-rtl")]:"rtl"===x},s,d,T,F),D=Object.assign(Object.assign({},null===M||void 0===M?void 0:M.style),m);return q(t.createElement(p.A,{component:"Switch"},t.createElement(w,Object.assign({},P,{checked:C,onChange:function(){I(arguments.length<=0?void 0:arguments[0]),null===A||void 0===A||A.apply(void 0,arguments)},prefixCls:N,className:H,style:D,disabled:_,ref:n,loadingIcon:O}))))})),N=_;N.__ANT_SWITCH=!0;const O=N}}]);
//# sourceMappingURL=807.0573fff8.chunk.js.map