/*! For license information please see 7562.f5c13ce6.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[7372,7562],{27372:(e,n,s)=>{s.r(n),s.d(n,{default:()=>h,passwordPattern:()=>b});var r=s(75045),o=s(32967),a=s(88578),t=s(23073),i=s(90840),d=s(73687),l=s(1869),u=s(59910),c=s(6648),w=s(75864),m=s(81021),p=s(76415),P=s(1426),v=s(48602),g=s(42906);const b=/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,h=()=>{const{value:e,dispatchEvent:n}=(0,t.useWebComponentInfo)();let s;try{s=JSON.parse(e||"")}catch(T){s={open:!1,currentPassword:"",username:"",api_endpoint:""}}const{open:h,currentPassword:A,username:f,api_endpoint:j}=s,{token:x}=l.A.useToken(),[_]=u.A.useForm(),{t:C}=(0,v.Bd)();(0,P.useEffect)((()=>{h&&_.resetFields()}),[h,_]);const y=(0,o.oM)({api_endpoint:j}),k=(0,a.ET)({mutationFn:e=>(0,r.hu)({method:"POST",url:"/server/update-password-no-auth",body:e,client:y})}),F=()=>{_.validateFields().then((e=>{k.mutate({username:f,current_password:A,new_password:e.newPassword},{onSuccess(e,s,r){n("ok",null)},onError(e,n,s){}})}))};return(0,g.jsx)(c.A,{open:h,centered:!0,mask:!1,onCancel:()=>{n("cancel",null)},keyboard:!1,maskClosable:!1,footer:null,width:450,destroyOnClose:!0,forceRender:!0,children:(0,g.jsxs)(i.A,{direction:"column",justify:"start",align:"stretch",gap:"md",style:{alignSelf:"stretch",paddingTop:x.paddingMD,paddingBottom:x.paddingMD},children:[(0,g.jsxs)(w.A.Title,{level:3,style:{margin:0},children:[(0,g.jsx)(d.A,{twoToneColor:x.colorWarning})," ",C("webui.menu.PleaseChangeYourPassword")]}),C("webui.menu.YouMushChangeYourPassword"),(0,g.jsxs)(u.A,{form:_,layout:"vertical",initialValues:{currentPassword:A},disabled:k.isPending,children:[(0,g.jsx)(u.A.Item,{name:"newPassword",label:C("webui.menu.NewPassword"),rules:[{required:!0},{pattern:b,message:C("webui.menu.InvalidPasswordMessage").toString()},()=>({validator:(e,n)=>A===n?Promise.reject(new Error(C("webui.menu.NewPasswordCannotBeSame").toString())):Promise.resolve()})],hasFeedback:!0,children:(0,g.jsx)(m.A.Password,{})}),(0,g.jsx)(u.A.Item,{name:"confirm",label:C("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0},e=>{let{getFieldValue:n}=e;return{validator:(e,s)=>s&&n("newPassword")!==s?Promise.reject(new Error(C("environment.PasswordsDoNotMatch").toString())):Promise.resolve()}}],children:(0,g.jsx)(m.A.Password,{onPressEnter:F})})]}),(0,g.jsx)(p.Ay,{type:"primary",onClick:F,loading:k.isPending,children:C("webui.menu.Update")})]})})}},7562:(e,n,s)=>{s.r(n),s.d(n,{default:()=>x});var r=s(32967),o=s(88653),a=s(88578),t=s(27340),i=s(27372),d=s(14897),l=s(34956),u=s(68159),c=s(49324),w=s(67884),m=s(41853),p=s(6648),P=s(77385),v=s(59910),g=s(81021),b=s(29180),h=s(1426),A=s(48602),f=s(18347),j=s(42906);const x=e=>{let{onRequestClose:n,onRequestRefresh:s,isRefreshModalPending:x,totpSupported:_,queryRef:C,...y}=e;const{t:k}=(0,A.Bd)(),F=(0,h.useRef)(null),[T,E]=m.Ay.useMessage(),[N,I]=p.A.useModal(),[M,{toggle:S}]=(0,w.A)(!1),R=(0,r.CX)(),O=(0,o.Am)(),[V,q]=(0,o.U6)(),{user:B}=(0,f.usePreloadedQuery)(l.j,C),U=(0,a.ET)({mutationFn:()=>R.remove_totp()});return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(t.A,{...y,okText:k("webui.menu.Update"),cancelText:k("webui.menu.Cancel"),onCancel:()=>{n()},confirmLoading:V.isPendingMutation,onOk:()=>(()=>{var e;null===(e=F.current)||void 0===e||e.validateFields().then((e=>{q.updateFullName(e.full_name,{onSuccess:s=>{s!==V.full_name&&T.open({type:"success",content:k("webui.menu.FullNameUpdated")}),e.newPassword&&e.newPasswordConfirm&&e.originalPassword?q.updatePassword({new_password:e.newPassword,new_password2:e.newPasswordConfirm,old_password:e.originalPassword},{onSuccess:()=>{T.open({type:"success",content:k("webui.menu.PasswordUpdated")}),n(!0)},onError:e=>{T.open({type:"error",content:e.message})}}):n(!0)},onError:e=>{T.open({type:"error",content:e.message})}})})).catch((()=>{}))})(),centered:!0,destroyOnClose:!0,title:k("webui.menu.MyAccountInformation"),children:[(0,j.jsx)(P.A,{spinning:x,indicator:(0,j.jsx)(u.A,{}),children:(0,j.jsxs)(v.A,{ref:F,layout:"vertical",labelCol:{span:8},initialValues:{full_name:V.full_name,totp_activated:(null===B||void 0===B?void 0:B.totp_activated)||!1},preserve:!1,children:[(0,j.jsx)(v.A.Item,{name:"full_name",label:k("webui.menu.FullName"),rules:[()=>({validator:(e,n)=>n&&n.length<65?Promise.resolve():Promise.reject(new Error(k("webui.menu.FullNameInvalid")))})],children:(0,j.jsx)(g.A,{})}),(0,j.jsx)(v.A.Item,{name:"originalPassword",label:k("webui.menu.OriginalPassword"),rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,s)=>s||!n("newPassword")&&!n("newPasswordConfirm")?Promise.resolve():Promise.reject(new Error(k("webui.menu.InputOriginalPassword")))}}],dependencies:["newPassword","newPasswordConfirm"],children:(0,j.jsx)(g.A.Password,{})}),(0,j.jsx)(v.A.Item,{name:"newPassword",label:k("webui.menu.NewPassword"),rules:[{pattern:"superadmin"===O?void 0:i.passwordPattern,message:k("webui.menu.InvalidPasswordMessage")}],children:(0,j.jsx)(g.A.Password,{})}),(0,j.jsx)(v.A.Item,{name:"newPasswordConfirm",label:k("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,s)=>s&&n("newPassword")!==s?Promise.reject(new Error(k("webui.menu.NewPasswordMismatch"))):Promise.resolve()}}],children:(0,j.jsx)(g.A.Password,{})}),!!_&&(0,j.jsx)(v.A.Item,{name:"totp_activated",label:k("webui.menu.TotpActivated"),valuePropName:"checked",children:(0,j.jsx)(b.A,{loading:U.isPending,onChange:e=>{var n;e?S():null!==B&&void 0!==B&&B.totp_activated&&(null===(n=F.current)||void 0===n||n.setFieldValue("totp_activated",!0),N.confirm({title:k("totp.TurnOffTotp"),icon:(0,j.jsx)(c.A,{}),content:k("totp.ConfirmTotpRemovalBody"),okText:k("button.Yes"),okType:"danger",cancelText:k("button.No"),onOk(){U.mutate(void 0,{onSuccess:()=>{var e;m.Ay.success(k("totp.RemoveTotpSetupCompleted")),s(),null===(e=F.current)||void 0===e||e.setFieldValue("totp_activated",!1)},onError:e=>{m.Ay.error(e.message)}})},onCancel(){var e;null===(e=F.current)||void 0===e||e.setFieldValue("totp_activated",!0)}}))}})})]})}),!!_&&(0,j.jsx)(d.A,{userFrgmt:B,open:M,onRequestClose:e=>{var n;e?s():null===(n=F.current)||void 0===n||n.setFieldValue("totp_activated",!1);S()}})]}),E,I]})}}}]);
//# sourceMappingURL=7562.f5c13ce6.chunk.js.map