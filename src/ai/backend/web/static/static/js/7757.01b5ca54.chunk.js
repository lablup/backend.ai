"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[7757],{77918:(e,n,l)=>{l.d(n,{A:()=>j});var a=l(98466),i=l(51593),s=l(11899),r=l(60881),t=l(43373);var o,d=l(94126),u=l(89130),c=l(40567),m=l(69551),g=l(50868),p=l(42042),y=l(52515),h=l(69056),v=l(96799),k=l(33789),f=l(60822),F=l(89608),_=l.n(F),S=l(34880),x=l(56762),b=l(88789),A=l(73689);const j=e=>{var n,F,j,K,T,w;let{sessionFrgmt:N,...C}=e;const L=(0,i.CX)(),{token:R}=g.A.useToken(),E=(0,s.Am)(),I=(0,b.useFragment)(void 0!==o?o:o=l(23714),N),D=(null===I||void 0===I||null===(n=I.kernel_nodes)||void 0===n||null===(F=n.edges)||void 0===F?void 0:F.map((e=>null===e||void 0===e?void 0:e.node)))||[],[M,q]=(0,t.useState)((null===(j=_().find(D,(e=>"main"===(null===e||void 0===e?void 0:e.cluster_role))))||void 0===j?void 0:j.row_id)||(null===(K=D[0])||void 0===K?void 0:K.row_id)),{data:U,refetch:P,isPending:B,isRefetching:$,dataUpdatedAt:V}=(0,r.nN)({queryKey:["containerLog",null===I||void 0===I?void 0:I.row_id,null===I||void 0===I?void 0:I.access_key,M,C.open],queryFn:async()=>C.open&&null!==I&&void 0!==I&&I.row_id&&null!==I&&void 0!==I&&I.access_key&&M?await L.get_logs(null===I||void 0===I?void 0:I.row_id,null===I||void 0===I?void 0:I.access_key,M,15e3).then((e=>e.result.logs)):"",staleTime:5e3}),[O,{resetPrevious:G}]=function(e,n){let{initialPrev:l}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const a=(0,t.useRef)(l),[i,s]=(0,t.useState)({}),r=(0,t.useMemo)(e,n),o=(0,t.useMemo)((()=>a.current),[...n,i]);return(0,t.useEffect)((()=>{a.current=r}),n),[{previous:o,current:r},{resetPrevious:()=>{a.current=l,s({})}}]}((()=>(null===U||void 0===U?void 0:U.split("\n").length)||0),[U]),{md:Q}=p.Ay.useBreakpoint(),{t:W}=(0,x.Bd)();return(0,A.jsx)(d.A,{title:(0,A.jsxs)(u.A,{style:{maxWidth:"100%"},gap:"sm",children:[(0,A.jsx)(y.A.Title,{level:4,style:{margin:0,flexShrink:0},children:"Logs"}),(0,A.jsx)(y.A.Text,{style:{fontWeight:"normal"},ellipsis:!0,children:null===I||void 0===I?void 0:I.name}),(0,A.jsxs)(y.A.Text,{style:{fontWeight:"normal",fontFamily:"monospace"},copyable:{text:null===I||void 0===I?void 0:I.row_id,tooltips:W("button.CopySomething",{name:W("session.SessionId")})},children:["(",Q?null===I||void 0===I?void 0:I.row_id:null===I||void 0===I||null===(T=I.row_id.split("-"))||void 0===T?void 0:T[0],")"]})]}),width:"100%",styles:{header:{width:"100%"},body:{height:"calc(100vh - 100px)",maxHeight:"calc(100vh - 100px)"}},...C,footer:null,children:(0,A.jsxs)(u.A,{direction:"column",align:"start",style:{height:"100%"},gap:"sm",children:[(0,A.jsxs)(u.A,{gap:"sm",wrap:"wrap",children:["Kernel Role",(0,A.jsx)(h.A,{value:M,onChange:e=>{q(e),G()},options:_().chain(null===I||void 0===I||null===(w=I.kernel_nodes)||void 0===w?void 0:w.edges).sortBy((e=>{var n,l;return`${null===e||void 0===e||null===(n=e.node)||void 0===n?void 0:n.cluster_role} ${null===e||void 0===e||null===(l=e.node)||void 0===l?void 0:l.cluster_idx}`})).map((e=>{var n,l,a,i,s;return{label:(0,A.jsxs)(A.Fragment,{children:[null===e||void 0===e||null===(n=e.node)||void 0===n?void 0:n.cluster_role,"main"!==(null===e||void 0===e||null===(l=e.node)||void 0===l?void 0:l.cluster_role)?null===e||void 0===e||null===(a=e.node)||void 0===a?void 0:a.cluster_idx:"","admin"===E||"superadmin"===E?(0,A.jsxs)(y.A.Text,{style:{fontFamily:"monospace",fontSize:R.fontSizeSM},type:"secondary",children:["(",((null===e||void 0===e||null===(i=e.node)||void 0===i?void 0:i.row_id)||"").substring(0,5),")"]}):null]}),value:null===e||void 0===e||null===(s=e.node)||void 0===s?void 0:s.row_id}})).value()}),(0,A.jsx)(v.A,{type:"vertical"}),(0,A.jsx)(k.A,{title:W("button.Download"),children:(0,A.jsx)(f.Ay,{size:"middle",icon:(0,A.jsx)(S.A,{}),disabled:B||$,onClick:()=>{const e=new Blob([U||""],{type:"text/plain"});(0,a.WN)(e,`${(null===I||void 0===I?void 0:I.name)||"session"}-logs-${M}-${(new Date).toISOString()}.txt`)}})}),(0,A.jsx)(k.A,{title:W("button.Refresh"),children:(0,A.jsx)(f.Ay,{size:"middle",loading:B||$,icon:(0,A.jsx)(c.A,{}),onClick:()=>P()})})]}),(0,A.jsx)("div",{style:{height:"calc(100% - 50px)",alignSelf:"stretch",border:`1px solid ${R.colorBorder}`,overflow:"hidden"},children:(0,A.jsx)(m.jB,{startFollowing:!0,render:e=>{let{follow:n,onScroll:l}=e;return(0,A.jsx)(m.FT,{enableLinks:!0,caseInsensitive:!0,enableSearch:!0,enableSearchNavigation:!0,selectableLines:!0,text:U||"",highlight:O.previous,extraLines:1,follow:n,onScroll:l})}},V)})]})})}},23714:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ContainerLogModalFragment",selections:[e,{kind:"RequiredField",field:n,action:"NONE",path:"row_id"},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[e,n,{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_idx",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_role",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"ComputeSessionNode",abstractKey:null}}();a.hash="59dda81185d3d874cd635adcae2ae9d4";const i=a},56893:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EditableSessionNameFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"priority",storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"c6b003f47f74148456a1d12e7ed8fba1"},i=a},64002:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"input"}],n=[{alias:null,args:[{kind:"Variable",name:"input",variableName:"input"}],concreteType:"ModifyComputeSessionPayload",kind:"LinkedField",name:"modify_compute_session",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"item",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EditableSessionNameMutation",selections:n,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EditableSessionNameMutation",selections:n},params:{cacheID:"bea4b6405958ab3b9796129b5807d0fa",id:null,metadata:{},name:"EditableSessionNameMutation",operationKind:"mutation",text:"mutation EditableSessionNameMutation(\n  $input: ModifyComputeSessionInput!\n) {\n  modify_compute_session(input: $input) {\n    item {\n      id\n      name\n    }\n  }\n}\n"}}}();a.hash="92003994eaa19ceec71d4fe2efb299cd";const i=a},48761:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionActionButtonsFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},action:"NONE",path:"row_id"},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commit_status",storageKey:null},{args:null,kind:"FragmentSpread",name:"TerminateSessionModalFragment"},{args:null,kind:"FragmentSpread",name:"ContainerLogModalFragment"}],type:"ComputeSessionNode",abstractKey:null,hash:"70c38dda1f1e788529d6bfd96bbef9f5"},i=a},60768:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionReservationFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"73f2fc395c80c1bf672ef9d0fea66787"},i=a},38604:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionStatusTagFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"28d44a009b8d8ecc51f60af3fc9ef8c8"},i=a},38406:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionTypeTagFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"6d4ab2b738125ee81d47483324695349"},i=a},99704:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:{plural:!0},name:"TerminateSessionModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},action:"NONE",path:"scaling_group"},{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"agent_id",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"ComputeSessionNode",abstractKey:null,hash:"0987c567ddd892540d949ccabd005e2b"},i=a},5457:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"},{defaultValue:null,kind:"LocalArgument",name:"project_id"}],n=[{alias:null,args:[{kind:"Variable",name:"id",variableName:"id"},{kind:"Variable",name:"project_id",variableName:"project_id"}],concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"TerminateSessionModalRefetchQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"TerminateSessionModalRefetchQuery",selections:n},params:{cacheID:"42872ac8084736aaf26675f9531456db",id:null,metadata:{},name:"TerminateSessionModalRefetchQuery",operationKind:"query",text:"query TerminateSessionModalRefetchQuery(\n  $id: GlobalIDField!\n  $project_id: UUID!\n) {\n  compute_session_node(id: $id, project_id: $project_id) {\n    id\n    status\n  }\n}\n"}}}();a.hash="6c928af0802a6732e5237c3f6c46db99";const i=a},77757:(e,n,l)=>{l.d(n,{A:()=>he});var a,i,s=l(51593),r=l(69715),t=l(58879),o=l(11899),d=l(15634),u=l(21050),c=l(50868),m=l(65436),g=l(43373),p=l(88789),y=l(73689);const h=e=>{let{component:n=m.A,sessionFrgmt:s,style:r,...t}=e;const o=(0,p.useFragment)(void 0!==a?a:a=l(56893),s),[d,u]=(0,g.useState)(o.name),{token:h}=c.A.useToken(),[v,k]=(0,p.useMutation)(void 0!==i?i:i=l(64002));return o&&(0,y.jsx)(n,{editable:k?void 0:{onChange:e=>{u(e),v({variables:{input:{id:o.id,name:e,priority:o.priority}},onCompleted(e,n){},onError(e){}})},triggerType:["icon","text"]},copyable:!0,style:{...r,color:k?h.colorTextTertiary:null===r||void 0===r?void 0:r.color},...t,children:k?d:o.name})};var v,k,f=l(77918),F=l(60881),_=l(3643),S=l(34357),x=l(94126),b=l(89130),A=l(52515),j=l(9833),K=l(55368),T=l(59286),w=l(89608),N=l.n(w),C=l(56762);const L=(0,T.rU)((e=>{let{css:n,token:l}=e;return{custom:n`
      ul {
        list-style-type: circle;
        padding-left: ${l.paddingMD}px;
      }
    `}})),R=async e=>{let n,l;try{"GET"===e.method&&(e.body=void 0),n=await fetch(e.uri,e);const a=n.headers.get("Content-Type");if(null===a){if(l=n.ok,!n.ok)throw new Error(n)}else l=a.startsWith("application/json")||a.startsWith("application/problem+json")?await n.json():a.startsWith("text/")?await n.text():await n.blob();if(!n.ok)throw l}catch(a){return n}return l},E=async(e,n,l)=>{let a="http://127.0.0.1:5050/";if(void 0!==globalThis.__local_proxy&&void 0!==globalThis.__local_proxy.url?a=globalThis.__local_proxy.url:void 0!==l._config.proxyURL&&(a=l._config.proxyURL),void 0!==e&&void 0!==n){const i=await(async(e,n,l)=>{if(!0===l.debug){var a,i,s,r;if(null!==(a=globalThis.appLauncher)&&void 0!==a&&null!==(i=a.forceUseV1Proxy)&&void 0!==i&&i.checked)return"v1";if(null!==(s=globalThis.appLauncher)&&void 0!==s&&null!==(r=s.forceUseV2Proxy)&&void 0!==r&&r.checked)return"v2"}return globalThis.isElectron?"v1":l.scalingGroup.getWsproxyVersion(e,n).then((e=>e.wsproxy_version))})(e,n,l);"v1"!==i&&(a=new URL(`${i}/`,a).href)}return a},I=e=>{var n;let{sessionFrgmts:a,onRequestClose:i,...r}=e;const{t:t}=(0,C.Bd)(),{styles:u}=L(),c=(0,p.useFragment)(void 0!==v?v:v=l(99704),a),[m,h]=(0,g.useState)(!1),f=(0,o.Am)(),T=(0,s.CX)(),w=(0,d.hd)(),I=(0,F.ET)({mutationFn:async e=>(async(e,n,l,a)=>{const i=await E(e.scaling_group,l,a),s={method:"GET",uri:new URL(`proxy/${n}/${e.row_id}`,i).href};return R(s).then((l=>{let a=new URL(`proxy/${n}/${e.row_id}/delete`,i);return localStorage.getItem("backendaiwebui.appproxy-permit-key")&&(a.searchParams.set("permit_key",localStorage.getItem("backendaiwebui.appproxy-permit-key")||""),a=new URL(a.href)),void 0===l||404===l.code||R({method:"GET",uri:a.href,credentials:"include",mode:"cors"})}))})(e,T._config.accessKey,w.id,T).catch((e=>({error:e}))).then((n=>{const l=null===n||void 0===n?void 0:n.error;if(void 0===l||l&&l.message&&(404===l.statusCode||500===l.statusCode))return T.destroy(e.row_id,T._config.accessKey,m);throw l}))}),D=(0,p.useRelayEnvironment)(),M=(0,S.b)(),{upsertNotification:q}=(0,_.js)();return(0,y.jsx)(x.A,{centered:!0,title:t("session.TerminateSession"),open:!1,confirmLoading:I.isPending,onOk:()=>{var e;if(null!==(e=c[0])&&void 0!==e&&e.row_id){const e=c[0];I.mutateAsync(e).then((()=>{h(!1),i(!0)})).catch((e=>{q({message:M.relieve(null===e||void 0===e?void 0:e.title),description:null===e||void 0===e?void 0:e.message,open:!0})})).finally((()=>{const n=new CustomEvent("backend-ai-session-list-refreshed",{detail:"running"});return document.dispatchEvent(n),(0,p.fetchQuery)(D,void 0!==k?k:k=l(5457),{id:e.id,project_id:w.id}).toPromise()}))}},okText:t(m?"button.ForceTerminate":"session.Terminate"),okType:"danger",okButtonProps:{type:m?"primary":"default"},onCancel:()=>{h(!1),i(!1)},...r,children:(0,y.jsxs)(b.A,{className:u.custom,direction:"column",align:"stretch",gap:"xs",children:[(0,y.jsx)(A.A.Text,{children:t("usersettings.SessionTerminationDialog")}),(0,y.jsx)(A.A.Text,{mark:!0,children:1===c.length?null===(n=c[0])||void 0===n?void 0:n.name:`${c.length} sessions`}),(0,y.jsx)(j.A,{checked:m,onChange:e=>{h(e.target.checked)},children:t("button.ForceTerminate")}),m&&(0,y.jsxs)(K.A,{children:[(0,y.jsx)(A.A.Paragraph,{type:"danger",children:t("session.ForceTerminateWarningMsg")}),(0,y.jsxs)("ul",{children:[(0,y.jsx)("li",{children:t("session.ForceTerminateWarningMsg2")}),(0,y.jsx)("li",{children:t("session.ForceTerminateWarningMsg3")})]}),"superadmin"===f&&(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(K.A,{type:"inner",title:t("session.ContainerToCleanUp"),children:N().chain(c).map((e=>{var n;return null===e||void 0===e||null===(n=e.kernel_nodes)||void 0===n?void 0:n.edges})).map((e=>null===e||void 0===e?void 0:e.map((e=>null===e||void 0===e?void 0:e.node)))).flatten().groupBy("agent_id").map(((e,n)=>(0,y.jsxs)(y.Fragment,{children:[n,(0,y.jsx)("ul",{children:e.map((e=>(0,y.jsx)("li",{children:(0,y.jsx)(A.A.Text,{copyable:!0,children:e.container_id})},e.container_id)))},n)]}))).value()})})]})]})})};var D,M=l(33789),q=l(60822),U=l(81288),P=l(73221),B=l(7155);const $=e=>!["TERMINATED","CANCELLED"].includes((null===e||void 0===e?void 0:e.status)||""),V=e=>{const{token:n}=c.A.useToken(),a={runTerminal:e=>{globalThis.appLauncher.runTerminal(e)},showLauncher:e=>{}},{t:i}=(0,C.Bd)(),s=(0,p.useFragment)(void 0!==D?D:D=l(48761),e.sessionFrgmt),[r,t]=(0,g.useState)(!1),[o,d]=(0,g.useState)(!1);return s&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(M.A,{title:i("session.ExecuteTerminalApp"),children:(0,y.jsx)(q.Ay,{disabled:!$(s),icon:(0,y.jsx)(U.A,{}),onClick:()=>{a.runTerminal(null===s||void 0===s?void 0:s.row_id)}})}),(0,y.jsx)(I,{sessionFrgmts:[s],open:r,onRequestClose:()=>{t(!1)}}),(0,y.jsx)(M.A,{title:i("session.SeeContainerLogs"),children:(0,y.jsx)(q.Ay,{icon:(0,y.jsx)(P.A,{}),onClick:()=>{d(!0)}})}),(0,y.jsx)(f.A,{sessionFrgmt:s,open:o,onCancel:()=>{d(!1)}}),(0,y.jsx)(M.A,{title:i("session.TerminateSession"),children:(0,y.jsx)(q.Ay,{disabled:!$(s),icon:(0,y.jsx)(B.A,{color:$(s)?n.colorError:void 0}),onClick:()=>{t(!0)}})})]})};var O,G=l(12795),Q=l(20782),W=l(12731),z=l.n(W);const Y=e=>{let{sessionFrgmt:n}=e;const a=(0,s.CX)(),{t:i}=(0,C.Bd)(),r=(0,p.useFragment)(void 0!==O?O:O=l(60768),n);return(0,y.jsxs)(y.Fragment,{children:[z()(r.created_at).format("lll"),(0,y.jsx)(G.A,{callback:()=>null!==r&&void 0!==r&&r.created_at?a.utils.elapsedTime(r.created_at,null===r||void 0===r?void 0:r.terminated_at):"-",delay:1e3,render:e=>(0,y.jsx)(Q.A,{values:[{label:i("session.ElapsedTime")},{label:e}]})})]})};var H,X=l(44954),J=l(15934);const Z={RESTARTING:"blue",PREPARED:"blue",PREPARING:"blue",PULLING:"blue",RUNNING:"green",PENDING:"green",SCHEDULED:"green",ERROR:"red"},ee=e=>["RESTARTING","TERMINATING","PENDING","PREPARING","PULLING"].includes((null===e||void 0===e?void 0:e.status)||""),ne={"no-available-instances":"red","failed-to-start":"red","creation-failed":"red"},le=e=>{let{sessionFrgmt:n}=e;const a=(0,p.useFragment)(void 0!==H?H:H=l(38604),n),{token:i}=c.A.useToken();return a?N().isEmpty(a.status_info)?(0,y.jsx)(J.A,{color:a.status?N().get(Z,a.status):void 0,icon:ee(a)?(0,y.jsx)(X.A,{spin:!0}):void 0,children:a.status||" "}):(0,y.jsxs)(b.A,{children:[(0,y.jsx)(J.A,{style:{margin:0,zIndex:1},color:a.status?N().get(Z,a.status):void 0,children:a.status}),(0,y.jsx)(J.A,{style:{margin:0,marginLeft:-1,borderStyle:"dashed",color:a.status_info&&N().get(ne,a.status_info)?void 0:i.colorTextSecondary},color:a.status_info?N().get(ne,a.status_info):void 0,children:a.status_info})]}):null};var ae;const ie={INTERACTIVE:"green",BATCH:"darkgreen",INFERENCE:"blue"},se=e=>{let{sessionFrgmt:n}=e;const a=(0,p.useFragment)(void 0!==ae?ae:ae=l(38406),n);return(0,y.jsx)(J.A,{color:N().get(ie,N().toUpper(a.type||"")),children:N().toUpper(a.type||"")})};var re,te=l(16272),oe=l(42042),de=l(45679),ue=l(39464),ce=l(79273);const me=e=>{var n;let{id:a,fetchKey:i="initial"}=e;const{t:s}=(0,C.Bd)(),{token:m}=c.A.useToken(),g=(0,d.hd)(),v=(0,o.Am)(),{md:k}=oe.Ay.useBreakpoint(),{session:f,legacy_session:F}=(0,p.useLazyLoadQuery)(void 0!==re?re:re=l(49814),{id:(0,t.wc)("ComputeSessionNode",a),uuid:a,project_id:g.id},{fetchPolicy:"network-only",fetchKey:i}),_=(null===F||void 0===F?void 0:F.image)&&(null===F||void 0===F?void 0:F.architecture)&&F.image+"@"+F.architecture;return f?(0,y.jsxs)(b.A,{direction:"column",gap:"sm",align:"stretch",children:[(0,y.jsxs)(b.A,{direction:"row",justify:"between",align:"start",style:{alignSelf:"stretch"},children:[(0,y.jsx)(h,{sessionFrgmt:f,component:ce.A,level:3,style:{margin:0,flex:1},editable:!1}),(0,y.jsx)(q.Ay.Group,{size:"large",children:(0,y.jsx)(V,{sessionFrgmt:f})})]}),(0,y.jsxs)(de.A,{bordered:!0,column:k?2:1,children:[(0,y.jsx)(de.A.Item,{label:s("session.SessionId"),span:k?2:1,children:(0,y.jsx)(A.A.Text,{copyable:!0,style:{fontFamily:"monospace"},children:f.row_id})}),("admin"===v||"superadmin"===v)&&(0,y.jsx)(de.A.Item,{label:s("credential.UserID"),span:k?2:1,children:null===F||void 0===F?void 0:F.user_email}),(0,y.jsx)(de.A.Item,{label:s("session.Status"),contentStyle:{display:"flex",gap:m.marginSM},children:(0,y.jsx)(le,{sessionFrgmt:f})}),(0,y.jsx)(de.A.Item,{label:s("session.SessionType"),children:(0,y.jsx)(se,{sessionFrgmt:f})}),(0,y.jsx)(de.A.Item,{label:s("session.launcher.Environments"),children:_?(0,y.jsxs)(b.A,{gap:"sm",children:[(0,y.jsx)(te.A,{image:_}),(0,y.jsx)(b.A,{children:(0,y.jsx)(r.Ay,{image:_})})]}):"-"}),(0,y.jsx)(de.A.Item,{label:s("session.launcher.MountedFolders"),children:null===F||void 0===F||null===(n=F.mounts)||void 0===n?void 0:n.join(", ")}),(0,y.jsx)(de.A.Item,{label:s("session.launcher.ResourceAllocation"),children:(0,y.jsxs)(b.A,{gap:"sm",children:[(0,y.jsx)(M.A,{title:s("session.ResourceGroup"),children:f.scaling_group}),(0,y.jsx)(u.ResourceNumbersOfSession,{resource:JSON.parse(f.requested_slots||"{}")})]})}),(0,y.jsx)(de.A.Item,{label:s("session.Agent"),children:f.agent_ids||"-"}),(0,y.jsx)(de.A.Item,{label:s("session.Reservation"),children:(0,y.jsx)(b.A,{gap:"xs",wrap:"wrap",children:(0,y.jsx)(Y,{sessionFrgmt:f})})})]})]}):(0,y.jsx)(ue.A,{showIcon:!0,message:s("session.SessionNotFound"),type:"error",description:a})};var ge=l(40567),pe=l(33342),ye=l(34948);const he=e=>{let{sessionId:n,...l}=e;const{t:a}=(0,C.Bd)();(0,s.CX)();const[i,r]=(0,g.useTransition)(),[t,o]=(0,s.Tw)("first");return(0,y.jsx)(pe.A,{title:a("session.SessionInfo"),width:800,...l,open:!!n,onClose:e=>{var n;null===(n=l.onClose)||void 0===n||n.call(l,e)},extra:(0,y.jsx)(M.A,{title:a("button.Refresh"),children:(0,y.jsx)(q.Ay,{loading:i,icon:(0,y.jsx)(ge.A,{}),onClick:()=>{r((()=>{o()}))}})}),children:(0,y.jsx)(g.Suspense,{fallback:(0,y.jsx)(ye.A,{}),children:n&&(0,y.jsx)(me,{id:n,fetchKey:t})})})}},49814:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e={defaultValue:null,kind:"LocalArgument",name:"id"},n={defaultValue:null,kind:"LocalArgument",name:"project_id"},l={defaultValue:null,kind:"LocalArgument",name:"uuid"},a=[{kind:"Variable",name:"id",variableName:"id"},{kind:"Variable",name:"project_id",variableName:"project_id"}],i={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"project_id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"user_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},m={alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image",plural:!1,selections:[i,r,c,{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null}],storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"vfolder_mounts",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"agent_ids",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"requested_slots",storageKey:null},f=[{kind:"Variable",name:"id",variableName:"uuid"}],F={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null};return{fragment:{argumentDefinitions:[e,n,l],kind:"Fragment",metadata:null,name:"SessionDetailContentQuery",selections:[{alias:"session",args:a,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[i,s,r,t,o,d,u,{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[i,m],storageKey:null}],storageKey:null}],storageKey:null},g,{kind:"RequiredField",field:p,action:"NONE",path:"session.created_at"},y,h,v,k,{args:null,kind:"FragmentSpread",name:"SessionStatusTagFragment"},{args:null,kind:"FragmentSpread",name:"SessionActionButtonsFragment"},{args:null,kind:"FragmentSpread",name:"SessionTypeTagFragment"},{args:null,kind:"FragmentSpread",name:"EditableSessionNameFragment"},{args:null,kind:"FragmentSpread",name:"SessionReservationFragment"},{args:null,kind:"FragmentSpread",name:"ContainerLogModalFragment"}],storageKey:null},{alias:"legacy_session",args:f,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[F,_,S,c],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,l,n],kind:"Operation",name:"SessionDetailContentQuery",selections:[{alias:"session",args:a,concreteType:"ComputeSessionNode",kind:"LinkedField",name:"compute_session_node",plural:!1,selections:[i,s,r,t,o,d,u,{alias:null,args:null,concreteType:"KernelConnection",kind:"LinkedField",name:"kernel_nodes",plural:!1,selections:[{alias:null,args:null,concreteType:"KernelEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"KernelNode",kind:"LinkedField",name:"node",plural:!1,selections:[i,m,{alias:null,args:null,kind:"ScalarField",name:"container_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"agent_id",storageKey:null},s,{alias:null,args:null,kind:"ScalarField",name:"cluster_idx",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_role",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},g,p,y,h,v,k,{alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"commit_status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"priority",storageKey:null}],storageKey:null},{alias:"legacy_session",args:f,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[F,_,S,c,i],storageKey:null}]},params:{cacheID:"baa240f530b7b96a3f423735a1c75c34",id:null,metadata:{},name:"SessionDetailContentQuery",operationKind:"query",text:"query SessionDetailContentQuery(\n  $id: GlobalIDField!\n  $uuid: UUID!\n  $project_id: UUID!\n) {\n  session: compute_session_node(id: $id, project_id: $project_id) {\n    id\n    row_id\n    name\n    project_id\n    user_id\n    resource_opts\n    status\n    kernel_nodes {\n      edges {\n        node {\n          id\n          image {\n            id\n            name\n            architecture\n            tag\n          }\n        }\n      }\n    }\n    vfolder_mounts\n    created_at\n    terminated_at\n    scaling_group\n    agent_ids\n    requested_slots\n    ...SessionStatusTagFragment\n    ...SessionActionButtonsFragment\n    ...SessionTypeTagFragment\n    ...EditableSessionNameFragment\n    ...SessionReservationFragment\n    ...ContainerLogModalFragment\n  }\n  legacy_session: compute_session(id: $uuid) {\n    image\n    mounts\n    user_email\n    architecture\n    id\n  }\n}\n\nfragment ContainerLogModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  status\n  access_key\n  kernel_nodes {\n    edges {\n      node {\n        id\n        row_id\n        container_id\n        cluster_idx\n        cluster_role\n      }\n    }\n  }\n}\n\nfragment EditableSessionNameFragment on ComputeSessionNode {\n  id\n  name\n  priority\n}\n\nfragment SessionActionButtonsFragment on ComputeSessionNode {\n  id\n  row_id\n  status\n  access_key\n  service_ports\n  commit_status\n  ...TerminateSessionModalFragment\n  ...ContainerLogModalFragment\n}\n\nfragment SessionReservationFragment on ComputeSessionNode {\n  id\n  created_at\n  terminated_at\n}\n\nfragment SessionStatusTagFragment on ComputeSessionNode {\n  id\n  name\n  status\n  status_info\n}\n\nfragment SessionTypeTagFragment on ComputeSessionNode {\n  type\n}\n\nfragment TerminateSessionModalFragment on ComputeSessionNode {\n  id\n  row_id\n  name\n  scaling_group\n  kernel_nodes {\n    edges {\n      node {\n        container_id\n        agent_id\n        id\n      }\n    }\n  }\n}\n"}}}();a.hash="90f5988e556db928e962ee53e579f224";const i=a},98466:(e,n,l)=>{l.d(n,{RM:()=>t,WN:()=>r});var a=l(89608),i=l.n(a);function s(e){return null===e||void 0===e?"":"number"===typeof e||"boolean"===typeof e?String(e):`"${(e=i().isString(e)?e:JSON.stringify(e)).replace(/"/g,'""')}"`}const r=(e,n)=>{const l=URL.createObjectURL(e),a=document.createElement("a");a.href=l,a.download=n,a.click(),URL.revokeObjectURL(l)},t=(e,n,l)=>{const a=((e,n)=>{const l=i().map(e,(e=>i().omit(e,"__fragments","__fragmentOwner","__id"))),a=i().keys(l[0]),r=i().map(l,(e=>i().map(e,((e,l)=>{var a;return null!==n&&void 0!==n&&n[l]&&(null===(a=n[l])||void 0===a?void 0:a.call(n,e))||e})))).map((e=>e.map(s).join(","))).join("\n");return[a.map(s).join(","),r].join("\n")})(e,l),t=new Blob([a],{type:"text/csv"});r(t,`${n}.csv`)}},34357:(e,n,l)=>{l.d(n,{b:()=>r});var a=l(56762);const i={"Cannot read property 'map' of null":"error.APINotSupported","TypeError: NetworkError when attempting to fetch resource.":"error.NetworkConnectionFailed","Login failed. Check login information.":"error.LoginFailed","User credential mismatch.":"error.LoginFailed","Authentication failed. Check information and manager status.":"error.AuthenticationFailed","Too many failed login attempts":"error.TooManyLoginFailures","server responded failure: 400 Bad Request - The virtual folder already exists with the same name.":"error.VirtualFolderAlreadyExist","400 Bad Request - The virtual folder already exists with the same name.":"error.VirtualFolderAlreadyExist","server responded failure: 400 Bad Request - One of your accessible vfolders already has the name you requested.":"error.VirtualFolderAlreadyExist","server responded failure: 400 Bad Request - You cannot create more vfolders.":"error.MaximumVfolderCreation","server responded failure: 400 Bad Request - Missing or invalid API parameters. (You cannot create more vfolders.)":"error.MaximumVfolderCreation","server responded failure: 400 Bad Request - Cannot change the options of a vfolder that is not owned by myself.":"error.CannotChangeVirtualFolderOption","server responded failure: 403 Forbidden - Cannot share private dot-prefixed vfolders.":"error.CannotSharePrivateAutomountFolder","server responded failure: 404 Not Found - No such vfolder invitation.":"error.FolderSharingNotAvailableToUser","server responded failure: 404 Not Found - No such user.":"error.FolderSharingNotAvailableToUser","server responded failure: 412 Precondition Failed - You have reached your resource limit.":"error.ReachedResourceLimit","Cannot read property 'split' of undefined":"error.UserHasNoGroup"},s={"\\w*not found matched token with email\\w*":"error.InvalidSignupToken","\\w*Access key not found\\w*":"error.LoginInformationMismatch","\\w*401 Unauthorized - Credential/signature mismatch\\w*":"error.LoginInformationMismatch",'integrity error: duplicate key value violates unique constraint "pk_resource_presets"[\\n]DETAIL:  Key \\(name\\)=\\([\\w]+\\) already exists.[\\n]':"error.ResourcePolicyAlreadyExist",'integrity error: duplicate key value violates unique constraint "pk_scaling_groups"[\\n]DETAIL:  Key \\(name\\)=\\([\\w]+\\) already exists.[\\n]':"error.ScalingGroupAlreadyExist",'integrity error: duplicate key value violates unique constraint "uq_users_username"[\\n]DETAIL:  Key \\(username\\)=\\([\\w]+\\) already exists.[\\n]':"error.UserNameAlreadyExist","server responded failure: 400 Bad Request - Missing or invalid API parameters. (Your resource quota is exceeded. (cpu=24 mem=512g cuda.shares=80))":"error.ResourceLimitExceed",'\\w*Key \\(name\\)=\\(.+\\) is still referenced from table "keypairs"\\.\\w*':"error.ResourcePolicyStillReferenced","Your resource request is smaller than the minimum required by the image. (\\w*)":"error.SmallerResourceThenImageRequires"},r=()=>{const{t:e}=(0,a.Bd)();return{relieve:n=>{if("undefined"===typeof n)return void 0===globalThis.backendaiclient||null===globalThis.backendaiclient?"_DISCONNECTED":"Problem occurred.";if(!0===globalThis.backendaiwebui.debug)return n;if({}.hasOwnProperty.call(i,n))return e(i[n]);for(const l of Object.keys(s))if(RegExp(l).test(n))return e(s[l]);return n}}}}}]);
//# sourceMappingURL=7757.01b5ca54.chunk.js.map