/*! For license information please see 446.d6b515da.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[446],{69357:(e,n,l)=>{l.d(n,{a:()=>i});var o=l(10979);const i=e=>{const[n,l]=(0,o.q)("hiddenColumnKeys.".concat(e));return[n,l]}},70446:(e,n,l)=>{l.r(n),l.d(n,{default:()=>Qe});var o=l(56276);const i=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"DeleteKeyPairResourcePolicy",kind:"LinkedField",name:"delete_keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"KeypairResourcePolicyListMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"KeypairResourcePolicyListMutation",selections:n},params:{cacheID:"fe182323e364c317f26c7193239af22b",id:null,metadata:{},name:"KeypairResourcePolicyListMutation",operationKind:"mutation",text:"mutation KeypairResourcePolicyListMutation(\n  $name: String!\n) {\n  delete_keypair_resource_policy(name: $name) {\n    ok\n    msg\n  }\n}\n"}}}();i.hash="5771729a12a204d27a9cdf5ad31e707f";const a=i,s=function(){var e={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"total_resource_slots",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"max_session_lifetime",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"idle_timeout",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"max_pending_session_count",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sftp_sessions",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"KeypairResourcePolicyListQuery",selections:[{alias:null,args:null,concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policies",plural:!0,selections:[e,n,l,o,i,a,s,r,t,{args:null,kind:"FragmentSpread",name:"KeypairResourcePolicySettingModalFragment"},{args:null,kind:"FragmentSpread",name:"KeypairResourcePolicyInfoModalFragment"},{args:null,kind:"FragmentSpread",name:"BAIAllowedVfolderHostsWithPermissionFromKeyPairResourcePolicyFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"KeypairResourcePolicyListQuery",selections:[{alias:null,args:null,concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policies",plural:!0,selections:[e,n,l,o,i,a,s,r,t,{alias:null,args:null,kind:"ScalarField",name:"default_for_unspecified",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_pending_session_resource_slots",storageKey:null}],storageKey:null}]},params:{cacheID:"f3f71df356260fd014ca2d56a9651a93",id:null,metadata:{},name:"KeypairResourcePolicyListQuery",operationKind:"query",text:'query KeypairResourcePolicyListQuery {\n  keypair_resource_policies {\n    name\n    total_resource_slots\n    max_session_lifetime\n    max_concurrent_sessions\n    max_containers_per_session\n    idle_timeout\n    allowed_vfolder_hosts\n    max_pending_session_count @since(version: "24.03.4")\n    max_concurrent_sftp_sessions @since(version: "24.03.4")\n    ...KeypairResourcePolicySettingModalFragment\n    ...KeypairResourcePolicyInfoModalFragment\n    ...BAIAllowedVfolderHostsWithPermissionFromKeyPairResourcePolicyFragment\n  }\n}\n\nfragment BAIAllowedVfolderHostsWithPermissionFromKeyPairResourcePolicyFragment on KeyPairResourcePolicy {\n  allowed_vfolder_hosts\n}\n\nfragment KeypairResourcePolicyInfoModalFragment on KeyPairResourcePolicy {\n  name\n  created_at\n  default_for_unspecified\n  total_resource_slots\n  max_session_lifetime\n  max_concurrent_sessions\n  max_containers_per_session\n  idle_timeout\n  allowed_vfolder_hosts\n  max_pending_session_count @since(version: "24.03.4")\n  max_concurrent_sftp_sessions @since(version: "24.03.4")\n  max_pending_session_resource_slots @since(version: "24.03.4")\n  ...BAIAllowedVfolderHostsWithPermissionFromKeyPairResourcePolicyFragment\n}\n\nfragment KeypairResourcePolicySettingModalFragment on KeyPairResourcePolicy {\n  name\n  default_for_unspecified\n  total_resource_slots\n  max_session_lifetime\n  max_concurrent_sessions\n  max_containers_per_session\n  idle_timeout\n  allowed_vfolder_hosts\n  max_pending_session_count @since(version: "24.03.4")\n  max_concurrent_sftp_sessions @since(version: "24.03.4")\n}\n'}}}();s.hash="d74582c3e52a0e9e508fc25b9debe2c8";const r=s;var t=l(48880),c=l(520),u=l(73635),d=l(69357),m=l(11863),_=l(7871);const y={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"KeypairResourcePolicyInfoModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"default_for_unspecified",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"total_resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_session_lifetime",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"idle_timeout",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_pending_session_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sftp_sessions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_pending_session_resource_slots",storageKey:null},{args:null,kind:"FragmentSpread",name:"BAIAllowedVfolderHostsWithPermissionFromKeyPairResourcePolicyFragment"}],type:"KeyPairResourcePolicy",abstractKey:null,hash:"dd7c66455cb533aefc46d7f6ab093bf2"},p=y;var g=l(20353),x=l(7957),v=l(64754),f=l(70974),k=l(67631),P=l(8905),h=l.n(P),S=l(47699),j=l.n(S),b=l(62962),A=l(46336),R=l(89374);const F=["open","onRequestClose","resourcePolicyFrgmt"];var K;const M=(0,f.rU)((e=>{let{css:n}=e;return{description:n(K||(K=(0,_.A)(["\n    .ant-descriptions-row {\n      border: none !important;\n    }\n    .ant-descriptions-view > table {\n      width: fit-content !important;\n    }\n  "])))}})),C=e=>{let{open:n,onRequestClose:l,resourcePolicyFrgmt:i}=e,a=(0,m.A)(e,F);const{styles:s}=M(),{t:r}=(0,b.Bd)(),{token:t}=g.A.useToken(),c=(0,A.useFragment)(p,i),u=(0,k.YM)([{label:r("resourcePolicy.Name"),children:(0,R.jsx)(x.A.Text,{copyable:!0,children:null===c||void 0===c?void 0:c.name})},{label:r("resourcePolicy.DefaultForUnspecified"),children:(null===c||void 0===c?void 0:c.default_for_unspecified)||"\u221e"},{label:r("resourcePolicy.CreatedAt"),children:h()(null===c||void 0===c?void 0:c.created_at).format("lll")||"\u221e"},{label:r("resourcePolicy.ResourcePolicy"),children:null!==c&&void 0!==c&&c.total_resource_slots?j().isEmpty(JSON.parse(null===c||void 0===c?void 0:c.total_resource_slots))?"-":(0,R.jsx)(v.A,{className:s.description,size:"small",column:2,children:(0,R.jsx)(v.A.Item,{children:(0,R.jsx)(k.OO,{direction:"column",align:"start",style:{width:"100%"},children:j().map(JSON.parse(null===c||void 0===c?void 0:c.total_resource_slots),((e,n)=>(0,R.jsx)(k.jO,{type:n,value:j().toString(e)},n)))})})}):"-"},{label:r("resourcePolicy.StorageNodes"),children:c&&!j().isEmpty(JSON.parse((null===c||void 0===c?void 0:c.allowed_vfolder_hosts)||"{}"))?(0,R.jsx)(k.Nt,{allowedHostPermissionFrgmtFromKeyPair:c}):"-"},{label:r("resourcePolicy.Concurrency"),children:(null===c||void 0===c?void 0:c.max_concurrent_sessions)||"\u221e"},{label:r("resourcePolicy.ClusterSize"),children:null===c||void 0===c?void 0:c.max_containers_per_session},{label:r("resourcePolicy.IdleTimeout"),children:(null===c||void 0===c?void 0:c.idle_timeout)||"\u221e"},{label:r("session.MaxSessionLifetime"),children:(null===c||void 0===c?void 0:c.max_session_lifetime)||"\u221e"},{label:r("resourcePolicy.MaxPendingSessionCount"),children:j().isNull(null===c||void 0===c?void 0:c.max_pending_session_count)||j().isUndefined(null===c||void 0===c?void 0:c.max_pending_session_count)?"\u221e":null===c||void 0===c?void 0:c.max_pending_session_count},{label:r("resourcePolicy.MaxConcurrentSFTPSessions"),children:(null===c||void 0===c?void 0:c.max_concurrent_sftp_sessions)||"\u221e"},{label:r("resourcePolicy.MaxPendingSessionResourceSlots"),children:null!==c&&void 0!==c&&c.max_pending_session_resource_slots?j().isEmpty(JSON.parse(null===c||void 0===c?void 0:c.max_pending_session_resource_slots))?"-":(0,R.jsx)(v.A,{className:s.description,size:"small",column:2,children:(0,R.jsx)(v.A.Item,{children:(0,R.jsx)(k.OO,{direction:"column",align:"start",children:j().map(JSON.parse(null===c||void 0===c?void 0:c.max_pending_session_resource_slots),((e,n)=>(0,R.jsx)(k.jO,{type:n,value:j().toString(e)},n)))})})}):"-"}]);return(0,R.jsx)(k.Ib,(0,o.A)((0,o.A)({open:n,onCancel:()=>l(),footer:null,title:"".concat(r("resourcePolicy.ResourcePolicy"),": '").concat(null===c||void 0===c?void 0:c.name,"'"),centered:!0,width:t.screenSM},a),{},{children:(0,R.jsx)(v.A,{bordered:!0,column:1,items:u})}))},w=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"},{defaultValue:null,kind:"LocalArgument",name:"props"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"ModifyKeyPairResourcePolicy",kind:"LinkedField",name:"modify_keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"KeypairResourcePolicySettingModalModifyMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"KeypairResourcePolicySettingModalModifyMutation",selections:n},params:{cacheID:"72be648e07857dd6923d7c81f3f19948",id:null,metadata:{},name:"KeypairResourcePolicySettingModalModifyMutation",operationKind:"mutation",text:"mutation KeypairResourcePolicySettingModalModifyMutation(\n  $name: String!\n  $props: ModifyKeyPairResourcePolicyInput!\n) {\n  modify_keypair_resource_policy(name: $name, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();w.hash="8c99c8be8781f93fed817a67c86ea966";const I=w,O=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"},{defaultValue:null,kind:"LocalArgument",name:"props"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"CreateKeyPairResourcePolicy",kind:"LinkedField",name:"create_keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"KeypairResourcePolicySettingModalCreateMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"KeypairResourcePolicySettingModalCreateMutation",selections:n},params:{cacheID:"b52e3e869ccfabb393fb45a48074767e",id:null,metadata:{},name:"KeypairResourcePolicySettingModalCreateMutation",operationKind:"mutation",text:"mutation KeypairResourcePolicySettingModalCreateMutation(\n  $name: String!\n  $props: CreateKeyPairResourcePolicyInput!\n) {\n  create_keypair_resource_policy(name: $name, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();O.hash="7c4c5be505f02fa76e7b4db73a1f4b14";const q=O,L={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"KeypairResourcePolicySettingModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"default_for_unspecified",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"total_resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_session_lifetime",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"idle_timeout",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_pending_session_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sftp_sessions",storageKey:null}],type:"KeyPairResourcePolicy",abstractKey:null,hash:"7200f02275c0bbd9c1a2b4c8c215dae5"},D=L;var N=l(40690),T=l(72828),V=l(284),U=l(9359),z=l(17534);const E=["name","unlimitedValue","disableUnlimited","children"],B=e=>{let{name:n,unlimitedValue:l,disableUnlimited:i,children:a}=e,s=(0,m.A)(e,E);const{t:r}=(0,b.Bd)(),[t,c]=(0,z.useState)(!1),u=V.A.useFormInstance();(0,z.useEffect)((()=>{const e=u.getFieldValue(n);c(e===l)}),[u,n,l]);const d=(0,z.isValidElement)(a)?(0,z.cloneElement)(a,{disabled:t}):a,_=t&&(0,z.isValidElement)(a)?(0,z.cloneElement)(a,{value:void 0,disabled:t}):void 0;return(0,R.jsxs)(k.OO,{direction:"column",align:"start",children:[(0,R.jsx)(V.A.Item,(0,o.A)((0,o.A)({style:{margin:0},name:n,hidden:t},s),{},{children:d})),t?(0,R.jsx)(V.A.Item,(0,o.A)((0,o.A)({style:{margin:0}},s),{},{children:_})):null,(0,R.jsx)(U.A,{checked:t,disabled:i,onChange:e=>{const o=e.target.checked;c(o),o?u.setFieldValue(n,l):u.resetFields([n])},children:r("resourcePolicy.Unlimited")})]})};var $=l(80275),H=l(74031),Q=l(87621),J=l(87844),Y=l(67692),G=l(53825),W=l(86671),X=l(30369),Z=l(83499);const ee=["existingPolicyNames","keypairResourcePolicyFrgmt","onRequestClose"],ne=["_name"],le=e=>{let{existingPolicyNames:n,keypairResourcePolicyFrgmt:l=null,onRequestClose:i}=e,a=(0,m.A)(e,ee);const{t:s}=(0,b.Bd)(),{message:r}=H.A.useApp(),{token:u}=g.A.useToken(),d=(0,z.useRef)(null),[_]=(0,T.bL)(),{mergedResourceSlots:y}=(0,k.Hv)(),p=(0,N.CX)(),v=(0,A.useFragment)(D,l),[f,P]=(0,A.useMutation)(q),[h,S]=(0,A.useMutation)(I),F=(0,z.useMemo)((()=>{var e,n,l,o,i,a,s,r,c,u;const d=JSON.parse(null!==(e=null===v||void 0===v?void 0:v.allowed_vfolder_hosts)&&void 0!==e?e:"{}"),m=JSON.parse(null!==(n=null===v||void 0===v?void 0:v.total_resource_slots)&&void 0!==n?n:"{}");if(null!==m&&void 0!==m&&m.mem){var _,y,p;let e=(0,t.mv)(null===m||void 0===m?void 0:m.mem,"auto",2,!0);""!==(null===(_=e)||void 0===_?void 0:_.unit)&&"k"!==(null===(y=e)||void 0===y?void 0:y.unit)||(e=(0,t.mv)(null===m||void 0===m?void 0:m.mem,"m",3,!0)),m.mem=(null===(p=e)||void 0===p?void 0:p.value)||"0g"}return{name:null!==(l=null===v||void 0===v?void 0:v.name)&&void 0!==l?l:"",default_for_unspecified:(null===v||void 0===v?void 0:v.default_for_unspecified)||"UNLIMITED",total_resource_slots:null!==m&&void 0!==m?m:{},max_session_lifetime:null!==(o=null===v||void 0===v?void 0:v.max_session_lifetime)&&void 0!==o?o:0,max_concurrent_sessions:null!==(i=null===v||void 0===v?void 0:v.max_concurrent_sessions)&&void 0!==i?i:0,max_containers_per_session:null!==(a=null===v||void 0===v?void 0:v.max_containers_per_session)&&void 0!==a?a:1,idle_timeout:null!==(s=null===v||void 0===v?void 0:v.idle_timeout)&&void 0!==s?s:0,allowed_vfolder_hosts:null!==(r=j().keys(d))&&void 0!==r?r:[],max_pending_session_count:null!==(c=null===v||void 0===v?void 0:v.max_pending_session_count)&&void 0!==c?c:null,max_concurrent_sftp_sessions:null!==(u=null===v||void 0===v?void 0:v.max_concurrent_sftp_sessions)&&void 0!==u?u:0}}),[v]);return(0,R.jsx)(k.Ib,(0,o.A)((0,o.A)({width:800,title:s(null===v?"resourcePolicy.CreateResourcePolicy":"resourcePolicy.UpdateResourcePolicy"),onOk:()=>{var e;return null===d||void 0===d||null===(e=d.current)||void 0===e?void 0:e.validateFields().then((e=>{const n=j().mapValues(j().pickBy(e.total_resource_slots,(e=>!j().isUndefined(e))),((e,n)=>{var l;return j().includes(n,"mem")?null===(l=(0,t.mv)(e,"",0))||void 0===l?void 0:l.numberFixed:e})),l=j().fromPairs(j().map(e.allowed_vfolder_hosts,(n=>{var l;if(null!==F&&void 0!==F&&null!==(l=F.allowed_vfolder_hosts)&&void 0!==l&&l.includes(n)){return[n,JSON.parse((null===v||void 0===v?void 0:v.allowed_vfolder_hosts)||"{}")[n]]}return[n,j().get(e,n,["create-vfolder","modify-vfolder","delete-vfolder","mount-in-session","upload-file","download-file","invite-others","set-user-specific-permission"])]}))),{_name:a}=e,c=(0,m.A)(e,ne),u=(0,o.A)((0,o.A)({},j().omit(c,"parsedTotalResourceSlots","name")),{},{total_resource_slots:JSON.stringify(n),allowed_vfolder_hosts:JSON.stringify(l)});null===v?f({variables:{name:null===e||void 0===e?void 0:e.name,props:u},onCompleted:e=>{var n,l,o,a;return(null!==e&&void 0!==e&&null!==(n=e.create_keypair_resource_policy)&&void 0!==n&&n.ok||null===(l=e.create_keypair_resource_policy)||void 0===l||!l.msg)&&(null!==e&&void 0!==e&&null!==(o=e.create_keypair_resource_policy)&&void 0!==o&&o.ok||null===(a=e.create_keypair_resource_policy)||void 0===a||!a.msg)?(r.success(s("resourcePolicy.SuccessfullyCreated")),void i(!0)):(r.error(e.create_keypair_resource_policy.msg),void i(!1))},onError(e){r.error((null===e||void 0===e?void 0:e.message)||s("resourcePolicy.CannotCreateResourcePolicy"))}}):h({variables:{name:null===e||void 0===e?void 0:e.name,props:u},onCompleted:(e,n)=>{var l,o;return null!==e&&void 0!==e&&null!==(l=e.modify_keypair_resource_policy)&&void 0!==l&&l.ok||null===(o=e.modify_keypair_resource_policy)||void 0===o||!o.msg?n&&n.length>0?(n.forEach((e=>r.error(e.message))),void i(!1)):(r.success(s("resourcePolicy.SuccessfullyUpdated")),void i(!0)):(r.error(e.modify_keypair_resource_policy.msg),void i(!1))},onError(e){r.error((null===e||void 0===e?void 0:e.message)||s("resourcePolicy.CannotUpdateResourcePolicy"))}})})).catch((()=>{}))},onCancel:()=>i(),destroyOnHidden:!0,confirmLoading:P||S},a),{},{children:(0,R.jsxs)(V.A,{requiredMark:!1,ref:d,layout:"vertical",initialValues:F,preserve:!1,children:[(0,R.jsx)(V.A.Item,{label:s("resourcePolicy.Name"),name:"name",required:!0,rules:[{required:!0,message:s("data.explorer.ValueRequired")},{max:64},{validator:(e,l)=>!v&&null!==n&&void 0!==n&&n.includes(l)?Promise.reject(s("resourcePolicy.ResourcePolicyNameAlreadyExists")):Promise.resolve()}],children:(0,R.jsx)(Q.A,{disabled:!!v})}),(0,R.jsx)(V.A.Item,{label:(0,R.jsxs)(k.OO,{gap:"xxs",children:[(0,R.jsx)(x.A.Text,{children:s("resourcePolicy.DefaultForUnspecified")}),(0,R.jsx)(J.A,{title:(0,R.jsxs)(R.Fragment,{children:[s("resourcePolicy.DefaultForUnspecifiedTooltipDesc1"),(0,R.jsx)("br",{}),(0,R.jsx)("br",{}),s("resourcePolicy.DefaultForUnspecifiedTooltipDesc2")]}),placement:"right",children:(0,R.jsx)($.A,{style:{color:u.colorTextSecondary,cursor:"pointer"}})})]}),name:"default_for_unspecified",children:(0,R.jsx)(Y.A,{options:[{key:"unlimited",label:"UNLIMITED",value:"UNLIMITED"},{key:"limited",label:"LIMITED",value:"LIMITED"}]})}),(0,R.jsx)(V.A.Item,{label:s("resourcePolicy.ResourcePolicy"),required:!0,children:(0,R.jsx)(G.A,{children:j().chain(_).keys().chunk(3).map(((e,n)=>(0,R.jsx)(W.A,{gutter:[24,16],children:j().map(e,(e=>{var n,l;return(0,R.jsx)(X.A,{xs:{span:12},md:{span:8},style:{alignSelf:"end",marginBottom:u.marginLG},children:(0,R.jsx)(B,{unlimitedValue:void 0,label:(null===(n=j().get(y,e))||void 0===n?void 0:n.description)||e,name:["total_resource_slots",e],rules:[{validator:(n,l)=>j().includes(e,"mem")&&l&&(0,t.mv)(l,"p").number>(0,t.mv)("300p","p").number?Promise.reject(new Error(s("resourcePolicy.MemorySizeExceedsLimit"))):Promise.resolve()}],style:{margin:0,width:"100%"},children:j().includes(e,"mem")?(0,R.jsx)(k.Hi,{style:{width:"100%"}}):(0,R.jsx)(Z.A,{min:0,max:c.d7,step:j().includes(e,".shares")?.1:1,suffix:null===(l=j().get(y,e))||void 0===l?void 0:l.display_unit,style:{width:"100%"}})})},e)}))},n))).value()})}),(0,R.jsx)(V.A.Item,{label:s("resourcePolicy.Sessions"),required:!0,children:(0,R.jsx)(G.A,{children:(0,R.jsxs)(W.A,{gutter:[24,16],style:{alignSelf:"end"},children:[(0,R.jsx)(X.A,{xs:{span:12},md:{span:8},style:{alignSelf:"end"},children:(0,R.jsx)(B,{label:s("resourcePolicy.ClusterSize"),name:"max_containers_per_session",style:{margin:0,width:"100%"},disableUnlimited:!0,children:(0,R.jsx)(Z.A,{min:0,max:c.tu,style:{width:"100%"}})})}),(0,R.jsx)(X.A,{xs:{span:12},md:{span:8},style:{alignSelf:"end"},children:(0,R.jsx)(B,{name:"max_session_lifetime",unlimitedValue:0,label:s("resourcePolicy.MaxSessionLifetime"),style:{margin:0,width:"100%"},children:(0,R.jsx)(Z.A,{min:0,max:100,style:{width:"100%"}})})}),p.supports("max-pending-session-count")?(0,R.jsx)(X.A,{xs:{span:12},md:{span:8},style:{alignSelf:"end"},children:(0,R.jsx)(B,{name:"max_pending_session_count",unlimitedValue:null,label:s("resourcePolicy.MaxPendingSessionCount"),style:{margin:0,width:"100%"},children:(0,R.jsx)(Z.A,{min:0,max:c.tu,style:{width:"100%"}})})}):null,(0,R.jsx)(X.A,{xs:{span:12},md:{span:8},style:{alignSelf:"end"},children:(0,R.jsx)(B,{name:"max_concurrent_sessions",label:s("resourcePolicy.ConcurrentJobs"),unlimitedValue:0,style:{margin:0,width:"100%"},children:(0,R.jsx)(Z.A,{min:0,max:c.tu,style:{width:"100%"}})})}),(0,R.jsx)(X.A,{xs:{span:12},md:{span:8},style:{alignSelf:"end"},children:(0,R.jsx)(B,{name:"idle_timeout",unlimitedValue:0,label:s("resourcePolicy.IdleTimeoutSec"),style:{margin:0,width:"100%"},children:(0,R.jsx)(Z.A,{min:0,max:Number.MAX_SAFE_INTEGER,style:{width:"100%"}})})}),(0,R.jsx)(X.A,{xs:{span:12},md:{span:8},style:{alignSelf:"end"},children:(0,R.jsx)(B,{name:"max_concurrent_sftp_sessions",unlimitedValue:0,label:s("resourcePolicy.MaxConcurrentSFTPSessions"),style:{margin:0,width:"100%"},children:(0,R.jsx)(Z.A,{min:0,max:c.tu,style:{width:"100%"}})})})]})})}),(0,R.jsx)(V.A.Item,{label:s("resourcePolicy.Folders"),required:!0,children:(0,R.jsx)(G.A,{children:(0,R.jsx)(V.A.Item,{label:s("resourcePolicy.AllowedHosts"),name:"allowed_vfolder_hosts",children:(0,R.jsx)(k.Lb,{mode:"multiple"})})})})]})}))};var oe=l(72446),ie=l(64284),ae=l(10292),se=l(75909),re=l(74285),te=l(59881),ce=l(84423),ue=l(15121),de=l(16582);const me=(0,l(24604).A)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),_e=e=>{const{token:n}=g.A.useToken(),{t:l}=(0,b.Bd)(),{message:i,modal:s}=H.A.useApp(),[m,_]=(0,k.Tw)("initial-fetch"),[y,p]=(0,z.useTransition)(),[v,{toggle:f}]=(0,ce.A)(),[P,h]=(0,z.useState)(!1),[S,F]=(0,z.useState)(),[K,M]=(0,z.useState)(),[w,I]=(0,z.useState)(null),[O,q]=(0,z.useTransition)(),{keypair_resource_policies:L}=(0,A.useLazyLoadQuery)(r,{},{fetchPolicy:"initial-fetch"===m?"store-and-network":"network-only",fetchKey:m}),[D,N]=(0,A.useMutation)(a),T=(0,k.YM)([{title:l("resourcePolicy.Name"),dataIndex:"name",key:"name",fixed:"left",sorter:(e,n)=>(0,t._f)(null===e||void 0===e?void 0:e.name,null===n||void 0===n?void 0:n.name)},{title:l("resourcePolicy.ResourcePolicy"),dataIndex:"total_resource_slots",key:"total_resource_slots",render:(e,n)=>(0,R.jsx)(k.OO,{gap:"xxs",children:j().isEmpty(JSON.parse((null===n||void 0===n?void 0:n.total_resource_slots)||"{}"))?"-":j().map(JSON.parse((null===n||void 0===n?void 0:n.total_resource_slots)||"{}"),((e,n)=>(0,R.jsx)(k.jO,{type:n,value:j().toString(e)},n)))})},{title:l("resourcePolicy.Concurrency"),dataIndex:"max_concurrent_sessions",key:"max_concurrent_sessions",sorter:(e,n)=>null!==e&&void 0!==e&&e.max_concurrent_sessions&&null!==n&&void 0!==n&&n.max_concurrent_sessions?e.max_concurrent_sessions-n.max_concurrent_sessions:1,render:e=>e||"\u221e"},{title:l("resourcePolicy.ClusterSize"),dataIndex:"max_containers_per_session",key:"max_containers_per_session",sorter:(e,n)=>null!==e&&void 0!==e&&e.max_containers_per_session&&null!==n&&void 0!==n&&n.max_containers_per_session?e.max_containers_per_session-n.max_containers_per_session:1,render:e=>e===c.tu?"\u221e":e},{title:l("resourcePolicy.IdleTimeout"),dataIndex:"idle_timeout",key:"idle_timeout",sorter:(e,n)=>null!==e&&void 0!==e&&e.idle_timeout&&null!==n&&void 0!==n&&n.idle_timeout?e.idle_timeout-n.idle_timeout:1,render:e=>e||"\u221e"},{title:l("session.MaxSessionLifetime"),dataIndex:"max_session_lifetime",key:"max_session_lifetime",sorter:(e,n)=>(0,t.Oe)(null===e||void 0===e?void 0:e.max_session_lifetime,null===n||void 0===n?void 0:n.max_session_lifetime,0),render:e=>e||"\u221e"},{title:l("resourcePolicy.StorageNodes"),dataIndex:"allowed_vfolder_hosts",key:"allowed_vfolder_hosts",render:(e,n)=>(0,R.jsx)(R.Fragment,{children:e&&n?(0,R.jsx)(k.Nt,{allowedHostPermissionFrgmtFromKeyPair:n}):"-"})},{title:l("resourcePolicy.MaxPendingSessionCount"),dataIndex:"max_pending_session_count",key:"max_pending_session_count",sorter:(e,n)=>(0,t.Oe)(null===e||void 0===e?void 0:e.max_pending_session_count,null===n||void 0===n?void 0:n.max_pending_session_count,0),render:e=>e||"\u221e"},{title:l("resourcePolicy.MaxConcurrentSFTPSessions"),dataIndex:"max_concurrent_sftp_sessions",key:"max_concurrent_sftp_sessions",sorter:(e,n)=>(0,t.Oe)(null===e||void 0===e?void 0:e.max_concurrent_sftp_sessions,null===n||void 0===n?void 0:n.max_concurrent_sftp_sessions,0),render:e=>e||"\u221e"},{title:l("general.Control"),key:"control",fixed:"right",render:(e,o)=>(0,R.jsxs)(k.OO,{direction:"row",align:"stretch",children:[(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(ie.A,{style:{color:n.colorInfo}}),onClick:()=>{q((()=>{I(o||null)}))}}),(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(ae.A,{}),style:{color:n.colorInfo},onClick:()=>{M(o)}}),(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(se.A,{style:{color:n.colorError}}),loading:N&&S===(null===o||void 0===o?void 0:o.name)+m,disabled:N&&S!==(null===o||void 0===o?void 0:o.name)+m,onClick:()=>{s.confirm({title:l("resourcePolicy.DeletePolicy"),content:(0,R.jsxs)(k.OO,{direction:"column",align:"stretch",children:[(0,R.jsxs)(k.OO,{gap:"xxs",children:[(0,R.jsx)(x.A.Text,{children:l("resourcePolicy.DeletePolicyDescription")}),(0,R.jsx)(x.A.Text,{strong:!0,children:null===o||void 0===o?void 0:o.name})]}),(0,R.jsx)("br",{}),(0,R.jsx)(x.A.Text,{type:"danger",children:l("dialog.warning.CannotBeUndone")})]}),okButtonProps:{danger:!0},okText:l("button.Delete"),onOk:()=>{null!==o&&void 0!==o&&o.name&&(F(o.name+m),D({variables:{name:o.name},onCompleted:(e,n)=>{var o,a;if(null!==e&&void 0!==e&&null!==(o=e.delete_keypair_resource_policy)&&void 0!==o&&o.ok)if(n&&(null===n||void 0===n?void 0:n.length)>0){const e=j().map(n,(e=>e.message));for(const n of e)i.error(n)}else p((()=>_())),i.success(l("resourcePolicy.SuccessfullyDeleted"));else i.error(null===e||void 0===e||null===(a=e.delete_keypair_resource_policy)||void 0===a?void 0:a.msg)},onError(e){i.error(null===e||void 0===e?void 0:e.message)}}))}})}})]})}]),[V,U]=(0,d.a)("KeypairResourcePolicyList");return(0,R.jsxs)(k.OO,(0,o.A)((0,o.A)({direction:"column",align:"stretch",gap:"sm"},e),{},{children:[(0,R.jsxs)(k.OO,{direction:"row",justify:"end",wrap:"wrap",gap:"xs",children:[(0,R.jsx)(de.A,{menu:{items:[{key:"exportCSV",label:l("resourcePolicy.ExportCSV"),onClick:()=>{(()=>{if(!L)return void i.error(l("resourcePolicy.NoDataToExport"));const e=j().without(j().map(T,(e=>j().toString(e.key))),"control"),n=j().map(L,(n=>j().pick(n,e.map((e=>e)))));(0,u.RM)(n,"keypair_resource_policies",{total_resource_slots:e=>j().isEmpty(e)?"-":JSON.stringify(e),max_concurrent_sessions:e=>e||"-",max_containers_per_session:e=>e===c.tu?"\u221e":e,idle_timeout:e=>e||"-",max_session_lifetime:e=>e||"-",allowed_vfolder_hosts:e=>j().isEmpty(e)?"-":j().keys(JSON.parse(e)).join(", ")})})()}}]},trigger:["click"],children:(0,R.jsx)(ue.Ay,{icon:(0,R.jsx)(me,{})})}),(0,R.jsx)(k.OO,{direction:"row",gap:"xs",wrap:"wrap",style:{flexShrink:1},children:(0,R.jsxs)(k.OO,{gap:"xs",children:[(0,R.jsx)(J.A,{title:l("button.Refresh"),children:(0,R.jsx)(ue.Ay,{icon:(0,R.jsx)(re.A,{}),loading:y,onClick:()=>{p((()=>_()))}})}),(0,R.jsx)(ue.Ay,{type:"primary",icon:(0,R.jsx)(te.A,{}),onClick:()=>{h(!0)},children:l("button.Create")})]})})]}),(0,R.jsx)(k.zx,{columns:j().filter(T,(e=>!j().includes(V,j().toString(null===e||void 0===e?void 0:e.key)))),dataSource:L,rowKey:"name",scroll:{x:"max-content"},pagination:{extraContent:(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(ae.A,{}),onClick:()=>{f()}})},showSorterTooltip:!1}),(0,R.jsx)(oe.A,{open:v,onRequestClose:e=>{(null===e||void 0===e?void 0:e.selectedColumnKeys)&&U(j().difference(T.map((e=>j().toString(e.key))),null===e||void 0===e?void 0:e.selectedColumnKeys)),f()},columns:T,hiddenColumnKeys:V}),(0,R.jsx)(z.Suspense,{children:(0,R.jsx)(le,{existingPolicyNames:j().map(L,(e=>(null===e||void 0===e?void 0:e.name)||"")),open:!!K||P,keypairResourcePolicyFrgmt:K||null,onRequestClose:e=>{M(null),h(!1),e&&p((()=>{_()}))}})}),(0,R.jsx)(C,{open:!!w||O,onRequestClose:()=>{I(null)},loading:O,resourcePolicyFrgmt:w||null})]}))},ye=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"DeleteProjectResourcePolicy",kind:"LinkedField",name:"delete_project_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ProjectResourcePolicyListMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ProjectResourcePolicyListMutation",selections:n},params:{cacheID:"9f1218faa2207eff18f5a145f12f87ac",id:null,metadata:{},name:"ProjectResourcePolicyListMutation",operationKind:"mutation",text:"mutation ProjectResourcePolicyListMutation(\n  $name: String!\n) {\n  delete_project_resource_policy(name: $name) {\n    ok\n    msg\n  }\n}\n"}}}();ye.hash="2c5a20c6c463174bbfc726a27cdfdcac";const pe=ye,ge=function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"max_vfolder_count",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"max_quota_scope_size",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"max_network_count",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ProjectResourcePolicyListQuery",selections:[{alias:null,args:null,concreteType:"ProjectResourcePolicy",kind:"LinkedField",name:"project_resource_policies",plural:!0,selections:[e,n,l,o,i,a,{args:null,kind:"FragmentSpread",name:"ProjectResourcePolicySettingModalFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ProjectResourcePolicyListQuery",selections:[{alias:null,args:null,concreteType:"ProjectResourcePolicy",kind:"LinkedField",name:"project_resource_policies",plural:!0,selections:[e,n,l,o,i,a],storageKey:null}]},params:{cacheID:"6aea9773e50cdfa81562c7a8322c8faa",id:null,metadata:{},name:"ProjectResourcePolicyListQuery",operationKind:"query",text:'query ProjectResourcePolicyListQuery {\n  project_resource_policies {\n    id\n    name\n    created_at\n    max_vfolder_count @since(version: "23.09.6")\n    max_quota_scope_size @since(version: "23.09.2")\n    max_network_count @since(version: "24.12.0")\n    ...ProjectResourcePolicySettingModalFragment\n  }\n}\n\nfragment ProjectResourcePolicySettingModalFragment on ProjectResourcePolicy {\n  id\n  name\n  created_at\n  max_vfolder_count @since(version: "23.09.6")\n  max_quota_scope_size @since(version: "23.09.2")\n  max_network_count @since(version: "24.12.0")\n}\n'}}}();ge.hash="4c7451b05822ee2f8c5e2c8d35ed57db";const xe=ge,ve=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"},{defaultValue:null,kind:"LocalArgument",name:"props"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"ModifyProjectResourcePolicy",kind:"LinkedField",name:"modify_project_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ProjectResourcePolicySettingModalModifyMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ProjectResourcePolicySettingModalModifyMutation",selections:n},params:{cacheID:"aedc4eab77206f7ab189ccd3f2d938b3",id:null,metadata:{},name:"ProjectResourcePolicySettingModalModifyMutation",operationKind:"mutation",text:"mutation ProjectResourcePolicySettingModalModifyMutation(\n  $name: String!\n  $props: ModifyProjectResourcePolicyInput!\n) {\n  modify_project_resource_policy(name: $name, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();ve.hash="3cd62195489eba58dd9693f1fc9df8ff";const fe=ve,ke=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"},{defaultValue:null,kind:"LocalArgument",name:"props"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"CreateProjectResourcePolicy",kind:"LinkedField",name:"create_project_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ProjectResourcePolicySettingModalCreateMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ProjectResourcePolicySettingModalCreateMutation",selections:n},params:{cacheID:"b94d7a4b8e8341df4e396784abba4203",id:null,metadata:{},name:"ProjectResourcePolicySettingModalCreateMutation",operationKind:"mutation",text:"mutation ProjectResourcePolicySettingModalCreateMutation(\n  $name: String!\n  $props: CreateProjectResourcePolicyInput!\n) {\n  create_project_resource_policy(name: $name, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();ke.hash="c0683608e8a527146563ba5bd9fcad33";const Pe=ke,he={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ProjectResourcePolicySettingModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_vfolder_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_quota_scope_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_network_count",storageKey:null}],type:"ProjectResourcePolicy",abstractKey:null,hash:"949f6a93198024700bf15197f3b613f0"},Se=he;var je=l(1125);const be=["existingPolicyNames","projectResourcePolicyFrgmt","onRequestClose"],Ae=e=>{let{existingPolicyNames:n,projectResourcePolicyFrgmt:l=null,onRequestClose:i}=e,a=(0,m.A)(e,be);const{t:s}=(0,b.Bd)(),{token:r}=g.A.useToken(),{message:u}=H.A.useApp(),d=(0,z.useRef)(null),_=(0,N.CX)(),y=null===_||void 0===_?void 0:_.supports("max_network_count"),p=(0,A.useFragment)(Se,l),[x,v]=(0,A.useMutation)(Pe),[f,P]=(0,A.useMutation)(fe),h=(0,z.useMemo)((()=>{let e={};null===p&&(e={max_vfolder_count:0,max_quota_scope_size:-1,max_network_count:-1});let n=null===p||void 0===p?void 0:p.max_quota_scope_size;return n=j().isUndefined(n)||-1===n?-1:(0,t.wb)(n),(0,o.A)((0,o.A)((0,o.A)({},e),p),{},{max_quota_scope_size:n})}),[p,null===p||void 0===p?void 0:p.max_vfolder_count,null===p||void 0===p?void 0:p.max_quota_scope_size]);return(0,R.jsxs)(k.Ib,(0,o.A)((0,o.A)({title:s(null===p?"resourcePolicy.CreateResourcePolicy":"resourcePolicy.UpdateResourcePolicy"),onOk:()=>{var e;return null===d||void 0===d||null===(e=d.current)||void 0===e?void 0:e.validateFields().then((e=>{const n={max_vfolder_count:(null===e||void 0===e?void 0:e.max_vfolder_count)||0,max_quota_scope_size:-1===(null===e||void 0===e?void 0:e.max_quota_scope_size)?-1:(0,t._S)(null===e||void 0===e?void 0:e.max_quota_scope_size),max_network_count:(null===e||void 0===e?void 0:e.max_network_count)||-1};y||delete n.max_network_count,null===p?x({variables:{name:null===e||void 0===e?void 0:e.name,props:n},onCompleted(e,n){var l,o;null===e||void 0===e||null===(l=e.create_project_resource_policy)||void 0===l||!l.ok||n?(u.error((null===e||void 0===e||null===(o=e.create_project_resource_policy)||void 0===o?void 0:o.msg)||s("resourcePolicy.CannotCreateResourcePolicy")),i()):(u.success(s("storageHost.ResourcePolicySuccessfullyUpdated")),i(!0))},onError(e){u.error((null===e||void 0===e?void 0:e.message)||s("resourcePolicy.CannotCreateResourcePolicy"))}}):f({variables:{name:null===e||void 0===e?void 0:e.name,props:n},onCompleted(e,n){var l,o;null===e||void 0===e||null===(l=e.modify_project_resource_policy)||void 0===l||!l.ok||n?(u.error((null===e||void 0===e||null===(o=e.modify_project_resource_policy)||void 0===o?void 0:o.msg)||s("resourcePolicy.CannotUpdateResourcePolicy")),i()):(u.success(s("storageHost.ResourcePolicySuccessfullyUpdated")),i(!0))},onError(e){u.error((null===e||void 0===e?void 0:e.message)||s("resourcePolicy.CannotUpdateResourcePolicy"))}})})).catch((()=>{}))},onCancel:()=>i(),destroyOnHidden:!0,confirmLoading:v||P},a),{},{children:[(0,R.jsx)(je.A,{title:s("storageHost.BeCarefulToSetProjectResourcePolicy"),type:"warning",showIcon:!0,style:{marginBottom:r.marginMD}}),(0,R.jsxs)(V.A,{ref:d,layout:"vertical",initialValues:h,preserve:!1,children:[(0,R.jsx)(V.A.Item,{label:s("resourcePolicy.Name"),name:"name",required:!0,rules:[{required:!0,message:s("data.explorer.ValueRequired")},{max:255},{validator:(e,l)=>!p&&null!==n&&void 0!==n&&n.includes(l)?Promise.reject(s("resourcePolicy.ResourcePolicyNameAlreadyExists")):Promise.resolve()}],children:(0,R.jsx)(Q.A,{disabled:!!p})}),(0,R.jsxs)(k.OO,{direction:"column",align:"stretch",gap:"md",style:{marginBottom:r.marginMD},children:[(0,R.jsx)(B,{name:"max_vfolder_count",unlimitedValue:0,label:s("resourcePolicy.MaxFolderCount"),style:{width:"100%",margin:0},children:(0,R.jsx)(Z.A,{min:0,max:c.tu,style:{width:"100%"}})}),(0,R.jsx)(B,{name:"max_quota_scope_size",unlimitedValue:-1,label:s("storageHost.MaxFolderSize"),style:{width:"100%",margin:0},children:(0,R.jsx)(Z.A,{min:0,max:Math.floor(Number.MAX_SAFE_INTEGER/Math.pow(10,9)),suffix:"GB",style:{width:"100%"}})}),y?(0,R.jsx)(B,{name:"max_network_count",unlimitedValue:-1,label:s("resourcePolicy.MaxNetworkCount"),style:{width:"100%",margin:0},children:(0,R.jsx)(Z.A,{min:0,max:c.tu,style:{width:"100%"}})}):null]})]})]}))};var Re=l(20908),Fe=l(42124);const Ke=()=>{const{token:e}=g.A.useToken(),{t:n}=(0,b.Bd)(),[l,o]=(0,z.useTransition)(),[i,a]=(0,k.Tw)("initial-fetch"),[s,r]=(0,z.useState)(!1),[c,{toggle:m}]=(0,ce.A)(),[_,y]=(0,z.useState)(),[p,x]=(0,z.useState)(),v=(0,N.CX)(),f=null===v||void 0===v?void 0:v.supports("max_network_count"),{project_resource_policies:P}=(0,A.useLazyLoadQuery)(xe,{},{fetchPolicy:"initial-fetch"===i?"store-and-network":"network-only",fetchKey:i}),[S,F]=(0,A.useMutation)(pe),K=(0,k.YM)([{title:n("resourcePolicy.Name"),dataIndex:"name",key:"name",fixed:"left",sorter:(e,n)=>(0,t._f)(null===e||void 0===e?void 0:e.name,null===n||void 0===n?void 0:n.name)},{title:n("resourcePolicy.MaxVFolderCount"),dataIndex:"max_vfolder_count",key:"max_vfolder_count",render:e=>0===j().toNumber(e)?"\u221e":e,sorter:(e,n)=>(0,t.Oe)(null===e||void 0===e?void 0:e.max_vfolder_count,null===n||void 0===n?void 0:n.max_vfolder_count,0)},{title:n("resourcePolicy.MaxQuotaScopeSize"),dataIndex:"max_quota_scope_size",key:"max_quota_scope_size",render:e=>-1===e?"\u221e":(0,t.wb)(e),sorter:(e,n)=>(0,t.Oe)(null===e||void 0===e?void 0:e.max_quota_scope_size,null===n||void 0===n?void 0:n.max_quota_scope_size,-1)},f?{title:n("resourcePolicy.MaxNetworkCount"),dataIndex:"max_network_count",key:"max_network_count",render:e=>-1===e?"\u221e":e,sorter:()=>!0}:{},{title:"ID",dataIndex:"id",key:"id",sorter:(e,n)=>(0,t._f)(null===e||void 0===e?void 0:e.id,null===n||void 0===n?void 0:n.id)},{title:n("resourcePolicy.CreatedAt"),dataIndex:"created_at",key:"created_at",render:e=>h()(e).format("lll"),sorter:(e,n)=>(0,t._f)(null===e||void 0===e?void 0:e.created_at,null===n||void 0===n?void 0:n.created_at)},{title:n("general.Control"),fixed:"right",key:"control",render:(l,s)=>(0,R.jsxs)(k.OO,{direction:"row",align:"stretch",children:[(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(ae.A,{}),style:{color:e.colorInfo},onClick:()=>{x(s)}}),(0,R.jsx)(Re.A,{title:n("dialog.ask.DoYouWantToProceed"),description:n("dialog.warning.CannotBeUndone"),okType:"danger",okText:n("button.Delete"),onConfirm:()=>{null!==s&&void 0!==s&&s.name&&(y(s.name+i),S({variables:{name:s.name},onCompleted:(e,l)=>{var i,s;if(null!==e&&void 0!==e&&null!==(i=e.delete_project_resource_policy)&&void 0!==i&&i.ok)if(l&&(null===l||void 0===l?void 0:l.length)>0){const e=j().map(l,(e=>e.message));for(const n of e)Fe.Ay.error(n)}else o((()=>a())),Fe.Ay.success(n("resourcePolicy.SuccessfullyDeleted"));else Fe.Ay.error(null===e||void 0===e||null===(s=e.delete_project_resource_policy)||void 0===s?void 0:s.msg)},onError(e){Fe.Ay.error(null===e||void 0===e?void 0:e.message)}}))},children:(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(se.A,{style:{color:e.colorError}}),loading:F&&_===(null===s||void 0===s?void 0:s.name)+i,disabled:F&&_!==(null===s||void 0===s?void 0:s.name)+i})})]})}]),[M,C]=(0,d.a)("ProjectResourcePolicyList");return(0,R.jsxs)(k.OO,{direction:"column",align:"stretch",gap:"sm",children:[(0,R.jsx)(k.OO,{direction:"row",justify:"end",wrap:"wrap",gap:"xs",children:(0,R.jsxs)(k.OO,{direction:"row",gap:"xs",wrap:"wrap",style:{flexShrink:1},children:[(0,R.jsx)(de.A,{menu:{items:[{key:"exportCSV",label:n("resourcePolicy.ExportCSV"),onClick:()=>{(()=>{if(!P)return void Fe.Ay.error(n("resourcePolicy.NoDataToExport"));const e=j().without(j().map(K,(e=>j().toString(e.key))),"control"),l=j().map(P,(n=>j().pick(n,e.map((e=>e)))));(0,u.RM)(l,"project_resource_polices",{max_vfolder_count:e=>0===j().toNumber(e)?"-":e,max_quota_scope_size:e=>-1===e?"-":(0,t.wb)(e)})})()}}]},trigger:["click"],children:(0,R.jsx)(ue.Ay,{icon:(0,R.jsx)(me,{})})}),(0,R.jsxs)(k.OO,{gap:"xs",children:[(0,R.jsx)(J.A,{title:n("button.Refresh"),children:(0,R.jsx)(ue.Ay,{icon:(0,R.jsx)(re.A,{}),loading:l,onClick:()=>{o((()=>a()))}})}),(0,R.jsx)(ue.Ay,{type:"primary",icon:(0,R.jsx)(te.A,{}),onClick:()=>{r(!0)},children:n("button.Create")})]})]})}),(0,R.jsx)(k.zx,{rowKey:"id",showSorterTooltip:!1,columns:j().filter(K,(e=>!j().includes(M,j().toString(null===e||void 0===e?void 0:e.key)))),dataSource:(0,k.f)(P),scroll:{x:"max-content"},pagination:{extraContent:(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(ae.A,{}),onClick:()=>{m()}})}}),(0,R.jsx)(oe.A,{open:c,onRequestClose:e=>{(null===e||void 0===e?void 0:e.selectedColumnKeys)&&C(j().difference(K.map((e=>j().toString(e.key))),null===e||void 0===e?void 0:e.selectedColumnKeys)),m()},columns:K,hiddenColumnKeys:M}),(0,R.jsx)(Ae,{existingPolicyNames:j().map(P,"name"),open:!!p||s,projectResourcePolicyFrgmt:p||null,onRequestClose:e=>{e&&o((()=>a())),x(null),r(!1)}})]})},Me=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"DeleteUserResourcePolicy",kind:"LinkedField",name:"delete_user_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserResourcePolicyListMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserResourcePolicyListMutation",selections:n},params:{cacheID:"7be7fa4bc2e6ce7666489318e415d769",id:null,metadata:{},name:"UserResourcePolicyListMutation",operationKind:"mutation",text:"mutation UserResourcePolicyListMutation(\n  $name: String!\n) {\n  delete_user_resource_policy(name: $name) {\n    ok\n    msg\n  }\n}\n"}}}();Me.hash="5b565e4db37c96850ac85a92cd4e0290";const Ce=Me,we=function(){var e={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"max_vfolder_count",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"max_session_count_per_model_session",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"max_quota_scope_size",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"max_customized_image_count",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UserResourcePolicyListQuery",selections:[{alias:null,args:null,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policies",plural:!0,selections:[e,n,l,o,i,a,s,{args:null,kind:"FragmentSpread",name:"UserResourcePolicySettingModalFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"UserResourcePolicyListQuery",selections:[{alias:null,args:null,concreteType:"UserResourcePolicy",kind:"LinkedField",name:"user_resource_policies",plural:!0,selections:[e,n,l,o,i,a,s],storageKey:null}]},params:{cacheID:"00b0583474f74c417b06d53115787d3b",id:null,metadata:{},name:"UserResourcePolicyListQuery",operationKind:"query",text:'query UserResourcePolicyListQuery {\n  user_resource_policies {\n    id\n    name\n    created_at\n    max_vfolder_count @since(version: "23.09.6")\n    max_session_count_per_model_session @since(version: "23.09.10")\n    max_quota_scope_size @since(version: "23.09.2")\n    max_customized_image_count @since(version: "24.03.0")\n    ...UserResourcePolicySettingModalFragment\n  }\n}\n\nfragment UserResourcePolicySettingModalFragment on UserResourcePolicy {\n  id\n  name\n  max_vfolder_count @since(version: "23.09.6")\n  max_session_count_per_model_session @since(version: "23.09.10")\n  max_quota_scope_size @since(version: "23.09.2")\n  max_customized_image_count @since(version: "24.03.0")\n}\n'}}}();we.hash="be57da0a1c15efb970cb1e828500e6dc";const Ie=we,Oe=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"},{defaultValue:null,kind:"LocalArgument",name:"props"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"ModifyUserResourcePolicy",kind:"LinkedField",name:"modify_user_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserResourcePolicySettingModalModifyMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserResourcePolicySettingModalModifyMutation",selections:n},params:{cacheID:"f33ed379f4871e357183803b340a938a",id:null,metadata:{},name:"UserResourcePolicySettingModalModifyMutation",operationKind:"mutation",text:"mutation UserResourcePolicySettingModalModifyMutation(\n  $name: String!\n  $props: ModifyUserResourcePolicyInput!\n) {\n  modify_user_resource_policy(name: $name, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();Oe.hash="d50cbcfb63bfd30da81fea8968bb6436";const qe=Oe,Le=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"},{defaultValue:null,kind:"LocalArgument",name:"props"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"CreateUserResourcePolicy",kind:"LinkedField",name:"create_user_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserResourcePolicySettingModalCreateMutation",selections:n,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserResourcePolicySettingModalCreateMutation",selections:n},params:{cacheID:"129c4a570d8ae1a075d9aa9261094c48",id:null,metadata:{},name:"UserResourcePolicySettingModalCreateMutation",operationKind:"mutation",text:"mutation UserResourcePolicySettingModalCreateMutation(\n  $name: String!\n  $props: CreateUserResourcePolicyInput!\n) {\n  create_user_resource_policy(name: $name, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();Le.hash="9c00928ca86d4779838243df247257aa";const De=Le,Ne={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"UserResourcePolicySettingModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_vfolder_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_session_count_per_model_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_quota_scope_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_customized_image_count",storageKey:null}],type:"UserResourcePolicy",abstractKey:null,hash:"d93790c2b9fef92baa6999ce770cd9da"},Te=Ne,Ve=["existingPolicyNames","userResourcePolicyFrgmt","onRequestClose"],Ue=e=>{let{existingPolicyNames:n,userResourcePolicyFrgmt:l=null,onRequestClose:i}=e,a=(0,m.A)(e,Ve);const{t:s}=(0,b.Bd)(),{token:r}=g.A.useToken(),{message:u}=H.A.useApp(),d=(0,z.useRef)(null),_=(0,A.useFragment)(Te,l),[y,p]=(0,A.useMutation)(De),[x,v]=(0,A.useMutation)(qe),f=(0,z.useMemo)((()=>{let e={};null===_&&(e={max_vfolder_count:0,max_quota_scope_size:-1});let n=null===_||void 0===_?void 0:_.max_quota_scope_size;return n=j().isUndefined(n)||-1===n?-1:(0,t.wb)(n),(0,o.A)((0,o.A)((0,o.A)({},e),_),{},{max_quota_scope_size:n})}),[_,null===_||void 0===_?void 0:_.max_vfolder_count,null===_||void 0===_?void 0:_.max_quota_scope_size]);return(0,R.jsxs)(k.Ib,(0,o.A)((0,o.A)({title:s(null===_?"resourcePolicy.CreateResourcePolicy":"resourcePolicy.UpdateResourcePolicy"),onOk:()=>{var e;return null===d||void 0===d||null===(e=d.current)||void 0===e?void 0:e.validateFields().then((e=>{const n={max_vfolder_count:(null===e||void 0===e?void 0:e.max_vfolder_count)||0,max_quota_scope_size:-1===(null===e||void 0===e?void 0:e.max_quota_scope_size)?-1:(0,t._S)(null===e||void 0===e?void 0:e.max_quota_scope_size),max_session_count_per_model_session:null===e||void 0===e?void 0:e.max_session_count_per_model_session,max_customized_image_count:null===e||void 0===e?void 0:e.max_customized_image_count};null===_?y({variables:{name:null===e||void 0===e?void 0:e.name,props:n},onCompleted(e,n){var l,o;null===e||void 0===e||null===(l=e.create_user_resource_policy)||void 0===l||!l.ok||n?(u.error((null===e||void 0===e||null===(o=e.create_user_resource_policy)||void 0===o?void 0:o.msg)||s("resourcePolicy.CannotCreateResourcePolicy")),i()):(u.success(s("storageHost.ResourcePolicySuccessfullyUpdated")),i(!0))},onError(e){u.error((null===e||void 0===e?void 0:e.message)||s("resourcePolicy.CannotCreateResourcePolicy"))}}):x({variables:{name:null===e||void 0===e?void 0:e.name,props:n},onCompleted(e,n){var l,o;null===e||void 0===e||null===(l=e.modify_user_resource_policy)||void 0===l||!l.ok||n?(u.error((null===e||void 0===e||null===(o=e.modify_user_resource_policy)||void 0===o?void 0:o.msg)||s("resourcePolicy.CannotUpdateResourcePolicy")),i()):(u.success(s("storageHost.ResourcePolicySuccessfullyUpdated")),i(!0))},onError(e){u.error((null===e||void 0===e?void 0:e.message)||s("resourcePolicy.CannotUpdateResourcePolicy"))}})})).catch((()=>{}))},onCancel:()=>i(),destroyOnHidden:!0,confirmLoading:p||v},a),{},{children:[(0,R.jsx)(je.A,{title:s("storageHost.BeCarefulToSetUserResourcePolicy"),type:"warning",showIcon:!0,style:{marginBottom:r.marginMD}}),(0,R.jsxs)(V.A,{ref:d,layout:"vertical",initialValues:f,preserve:!1,children:[(0,R.jsx)(V.A.Item,{label:s("resourcePolicy.Name"),name:"name",required:!0,rules:[{required:!0,message:s("data.explorer.ValueRequired")},{max:255},{validator:(e,l)=>!_&&null!==n&&void 0!==n&&n.includes(l)?Promise.reject(s("resourcePolicy.ResourcePolicyNameAlreadyExists")):Promise.resolve()}],children:(0,R.jsx)(Q.A,{disabled:!!_})}),(0,R.jsxs)(k.OO,{direction:"column",align:"stretch",gap:"md",style:{marginBottom:r.marginMD},children:[(0,R.jsx)(B,{name:"max_vfolder_count",unlimitedValue:0,label:s("resourcePolicy.MaxFolderCount"),style:{width:"100%",margin:0},children:(0,R.jsx)(Z.A,{min:0,max:c.tu,style:{width:"100%"}})}),(0,R.jsx)(B,{name:"max_quota_scope_size",unlimitedValue:-1,label:s("storageHost.MaxFolderSize"),style:{width:"100%",margin:0},children:(0,R.jsx)(Z.A,{min:0,max:Math.floor(Number.MAX_SAFE_INTEGER/Math.pow(10,9)),suffix:"GB",style:{width:"100%"}})})]}),(0,R.jsx)(V.A.Item,{name:"max_session_count_per_model_session",label:s("resourcePolicy.MaxSessionCountPerModelSession"),rules:[{required:!0,message:s("data.explorer.ValueRequired")}],children:(0,R.jsx)(Z.A,{min:0,max:c.tu,style:{width:"100%"}})}),(0,R.jsx)(V.A.Item,{name:"max_customized_image_count",label:s("resourcePolicy.MaxCustomizedImageCount"),rules:[{required:!0,message:s("data.explorer.ValueRequired")}],children:(0,R.jsx)(Z.A,{min:0,max:c.tu,style:{width:"100%"}})})]})]}))},ze=()=>{const{token:e}=g.A.useToken(),{t:n}=(0,b.Bd)(),{message:l}=H.A.useApp(),[o,i]=(0,z.useTransition)(),[a,s]=(0,k.Tw)("initial-fetch"),[r,c]=(0,z.useState)(!1),[m,{toggle:_}]=(0,ce.A)(),[y,p]=(0,z.useState)(),[x,v]=(0,z.useState)(),{user_resource_policies:f}=(0,A.useLazyLoadQuery)(Ie,{},{fetchPolicy:"initial-fetch"===a?"store-and-network":"network-only",fetchKey:a}),[P,S]=(0,A.useMutation)(Ce),F=(0,k.YM)([{title:n("resourcePolicy.Name"),dataIndex:"name",key:"name",fixed:"left",sorter:(e,n)=>(0,t._f)(null===e||void 0===e?void 0:e.name,null===n||void 0===n?void 0:n.name)},{title:n("resourcePolicy.MaxVFolderCount"),dataIndex:"max_vfolder_count",key:"max_vfolder_count",render:e=>0===j().toNumber(e)?"\u221e":e,sorter:(e,n)=>(0,t.Oe)(null===e||void 0===e?void 0:e.max_vfolder_count,null===n||void 0===n?void 0:n.max_vfolder_count,0)},{title:n("resourcePolicy.MaxSessionCountPerModelSession"),dataIndex:"max_session_count_per_model_session",key:"max_session_count_per_model_session",sorter:(e,n)=>{var l,o;return(null!==(l=null===e||void 0===e?void 0:e.max_session_count_per_model_session)&&void 0!==l?l:0)-(null!==(o=null===n||void 0===n?void 0:n.max_session_count_per_model_session)&&void 0!==o?o:0)}},{title:n("resourcePolicy.MaxQuotaScopeSize"),dataIndex:"max_quota_scope_size",key:"max_quota_scope_size",render:e=>-1===e?"\u221e":(0,t.wb)(e),sorter:(e,n)=>(0,t.Oe)(null===e||void 0===e?void 0:e.max_quota_scope_size,null===n||void 0===n?void 0:n.max_quota_scope_size,-1)},{title:n("resourcePolicy.MaxCustomizedImageCount"),key:"max_customized_image_count",dataIndex:"max_customized_image_count",sorter:(e,n)=>{var l,o;return(null!==(l=null===e||void 0===e?void 0:e.max_customized_image_count)&&void 0!==l?l:0)-(null!==(o=null===n||void 0===n?void 0:n.max_customized_image_count)&&void 0!==o?o:0)}},{title:"ID",dataIndex:"id",key:"id",sorter:(e,n)=>(0,t._f)(null===e||void 0===e?void 0:e.id,null===n||void 0===n?void 0:n.id)},{title:n("resourcePolicy.CreatedAt"),dataIndex:"created_at",key:"created_at",render:e=>h()(e).format("lll"),sorter:(e,n)=>(0,t._f)(null===e||void 0===e?void 0:e.created_at,null===n||void 0===n?void 0:n.created_at)},{title:n("general.Control"),fixed:"right",key:"control",render:(o,r)=>(0,R.jsxs)(k.OO,{direction:"row",align:"stretch",children:[(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(ae.A,{}),style:{color:e.colorInfo},onClick:()=>{v(r)}}),(0,R.jsx)(Re.A,{title:n("dialog.ask.DoYouWantToProceed"),description:n("dialog.warning.CannotBeUndone"),okType:"danger",okText:n("button.Delete"),onConfirm:()=>{null!==r&&void 0!==r&&r.name&&(p(r.name+a),P({variables:{name:r.name},onCompleted:(e,o)=>{var a,r;if(null!==e&&void 0!==e&&null!==(a=e.delete_user_resource_policy)&&void 0!==a&&a.ok)if(o&&o.length>0){const e=o.map((e=>e.message));for(const n of e)l.error(n)}else i((()=>s())),l.success(n("resourcePolicy.SuccessfullyDeleted"));else l.error(null===e||void 0===e||null===(r=e.delete_user_resource_policy)||void 0===r?void 0:r.msg)},onError(e){l.error(null===e||void 0===e?void 0:e.message)}}))},children:(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(se.A,{style:{color:e.colorError}}),loading:S&&y===(null===r||void 0===r?void 0:r.name)+a,disabled:S&&y!==(null===r||void 0===r?void 0:r.name)+a})})]})}]),[K,M]=(0,d.a)("UserResourcePolicyList");return(0,R.jsxs)(k.OO,{direction:"column",align:"stretch",gap:"sm",children:[(0,R.jsx)(k.OO,{direction:"row",justify:"end",wrap:"wrap",gap:"xs",children:(0,R.jsxs)(k.OO,{direction:"row",gap:"xs",wrap:"wrap",style:{flexShrink:1},children:[(0,R.jsx)(de.A,{menu:{items:[{key:"exportCSV",label:n("resourcePolicy.ExportCSV"),onClick:()=>{(()=>{if(!f||f.length===(null===K||void 0===K?void 0:K.length))return void l.error(n("resourcePolicy.NoDataToExport"));const e=j().without(j().map(F,(e=>j().toString(e.key))),"control"),o=j().map(f,(n=>j().pick(n,e.map((e=>e)))));(0,u.RM)(o,"user-resource-policies",{max_vfolder_count:e=>0===j().toNumber(e)?"-":e,max_quota_scope_size:e=>-1===e?"-":(0,t.wb)(e)})})()}}]},trigger:["click"],children:(0,R.jsx)(ue.Ay,{icon:(0,R.jsx)(me,{})})}),(0,R.jsxs)(k.OO,{gap:"xs",children:[(0,R.jsx)(J.A,{title:n("button.Refresh"),children:(0,R.jsx)(ue.Ay,{icon:(0,R.jsx)(re.A,{}),loading:o,onClick:()=>{i((()=>s()))}})}),(0,R.jsx)(ue.Ay,{type:"primary",icon:(0,R.jsx)(te.A,{}),onClick:()=>{c(!0)},children:n("button.Create")})]})]})}),(0,R.jsx)(k.zx,{rowKey:"id",showSorterTooltip:!1,columns:j().filter(F,(e=>!j().includes(K,j().toString(null===e||void 0===e?void 0:e.key)))),dataSource:(0,k.f)(f),scroll:{x:"max-content"},pagination:{extraContent:(0,R.jsx)(ue.Ay,{type:"text",icon:(0,R.jsx)(ae.A,{}),onClick:()=>{_()}})}}),(0,R.jsx)(oe.A,{open:m,onRequestClose:e=>{(null===e||void 0===e?void 0:e.selectedColumnKeys)&&M(j().difference(F.map((e=>j().toString(e.key))),null===e||void 0===e?void 0:e.selectedColumnKeys)),_()},columns:F,hiddenColumnKeys:K}),(0,R.jsx)(Ue,{existingPolicyNames:j().map(f,"name"),open:!!x||r,userResourcePolicyFrgmt:x||null,onRequestClose:e=>{e&&i((()=>s())),v(null),c(!1)}})]})};var Ee=l(30270),Be=l(60609),$e=l(73233);const He=(0,$e.withDefault)($e.StringParam,"keypair"),Qe=()=>{const{t:e}=(0,b.Bd)(),[n]=(0,$e.useQueryParam)("tab",He),l=(0,N.f0)();return(0,R.jsx)(k.Zu,{activeTabKey:n,onTabChange:e=>{l({pathname:"/resource-policy",search:new URLSearchParams({tab:e}).toString()},{params:{tab:e}})},tabList:(0,k.YM)([{key:"keypair",label:e("resourcePolicy.Keypair")},{key:"user",label:e("resourcePolicy.User")},{key:"project",label:e("resourcePolicy.Project")}]),children:(0,R.jsxs)(z.Suspense,{fallback:(0,R.jsx)(Ee.A,{active:!0}),children:["keypair"===n&&(0,R.jsx)(Be.A,{children:(0,R.jsx)(_e,{})}),"user"===n&&(0,R.jsx)(Be.A,{children:(0,R.jsx)(ze,{})}),"project"===n&&(0,R.jsx)(Be.A,{children:(0,R.jsx)(Ke,{})})]})})}},72446:(e,n,l)=>{l.d(n,{A:()=>x});var o=l(56276),i=l(11863),a=l(63926),s=l(9359),r=l(284),t=l(87621),c=l(20353),u=l(67631),d=l(47699),m=l.n(d),_=l(17534),y=l(62962),p=l(89374);const g=["open","onRequestClose","columns","hiddenColumnKeys"],x=e=>{var n;let{open:l,onRequestClose:d,columns:x,hiddenColumnKeys:v}=e,f=(0,i.A)(e,g);const k=(0,_.useRef)(null),{t:P}=(0,y.Bd)(),{token:h}=c.A.useToken(),S=m().map(x,(e=>{return"string"===typeof e.title?{label:e.title,value:m().toString(e.key)}:"object"===typeof e.title&&"props"in e.title?{label:(n=e.title,_.Children.map(n.props.children,(e=>{if("string"===typeof e)return e}))),value:m().toString(e.key)}:{label:void 0,value:m().toString(e.key)};var n}));return(0,p.jsx)(u.Ib,(0,o.A)((0,o.A)({title:P("table.SettingTable"),open:l,destroyOnHidden:!0,centered:!0,onOk:()=>{var e;null===(e=k.current)||void 0===e||e.validateFields().then((e=>{d(e)})).catch((()=>{}))},onCancel:()=>{d()}},f),{},{children:(0,p.jsxs)(r.A,{ref:k,preserve:!1,initialValues:{selectedColumnKeys:null===(n=m().map(S,"value"))||void 0===n?void 0:n.filter((e=>!m().includes(v,e)))},layout:"vertical",children:[(0,p.jsx)(r.A.Item,{name:"searchInput",label:P("table.SelectColumnToDisplay"),style:{marginBottom:0},children:(0,p.jsx)(t.A,{prefix:(0,p.jsx)(a.A,{}),style:{marginBottom:h.marginSM},placeholder:P("table.SearchTableColumn")})}),(0,p.jsx)(r.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.searchInput!==n.searchInput,children:e=>{let{getFieldValue:n}=e;const l=n("searchInput")?m().toLower(n("searchInput")):void 0,i=m().map(S,(e=>m().toLower(m().toString(e.label)).includes(l||"")?e:(0,o.A)((0,o.A)({},e),{},{style:{display:"none"}})));return(0,p.jsx)(r.A.Item,{name:"selectedColumnKeys",style:{height:220,overflowY:"auto"},rules:[{required:!0,message:P("general.validation.PleaseSelectOptions")}],children:(0,p.jsx)(s.A.Group,{options:i,style:{flexDirection:"column"}})})}})]})}))}}}]);
//# sourceMappingURL=446.d6b515da.chunk.js.map