"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[266],{14001:function(e,n,a){var i=a(1413),t=a(29439),s=a(87760),l=a(4519),r=a(2556),u=function(e,n){var a=e.image,l=e.style,u=void 0===l?{}:l,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=(0,s.dS)(),c=(0,t.Z)(d,2)[1].getImageIcon;return(0,r.jsx)("img",{src:c(a),style:(0,i.Z)({width:"1.5em",height:"1.5em"},u),alt:o})};n.Z=l.memo(u)},3173:function(e,n,a){a.r(n);var i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionInfoCellFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null}],type:"ComputeSession",abstractKey:null,hash:"93f8cd0d4b47d24ea281955be0ad792b"};n.default=i},72428:function(e,n,a){a.r(n);var i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"ak"},n={defaultValue:null,kind:"LocalArgument",name:"group_id"},a={defaultValue:null,kind:"LocalArgument",name:"limit"},i={defaultValue:null,kind:"LocalArgument",name:"offset"},t={defaultValue:null,kind:"LocalArgument",name:"skipClusterSize"},s={defaultValue:null,kind:"LocalArgument",name:"status"},l=[{kind:"Variable",name:"access_key",variableName:"ak"},{kind:"Variable",name:"group_id",variableName:"group_id"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"status",variableName:"status"}],r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"starts_at",storageKey:null},I={alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null};return{fragment:{argumentDefinitions:[e,n,a,i,t,s],kind:"Fragment",metadata:null,name:"SessionListQuery",selections:[{alias:null,args:l,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,u,o,d,c,g,m,f,k,y,p,v,h,S,b,I,{args:null,kind:"FragmentSpread",name:"SessionInfoCellFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,i,e,n,s,t],kind:"Operation",name:"SessionListQuery",selections:[{alias:null,args:l,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,u,o,d,c,g,m,f,k,y,p,v,h,S,b,I,{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"e152f44d42d7fc4a33606a935adc582f",id:null,metadata:{},name:"SessionListQuery",operationKind:"query",text:"query SessionListQuery(\n  $limit: Int!\n  $offset: Int!\n  $ak: String\n  $group_id: String\n  $status: String\n  $skipClusterSize: Boolean!\n) {\n  compute_session_list(limit: $limit, offset: $offset, access_key: $ak, group_id: $group_id, status: $status) {\n    items {\n      id\n      type\n      session_id\n      name\n      image\n      architecture\n      created_at\n      terminated_at\n      status\n      status_info\n      service_ports\n      mounts\n      occupied_slots\n      access_key\n      starts_at\n      cluster_size @skipOnClient(if: $skipClusterSize)\n      ...SessionInfoCellFragment\n    }\n  }\n}\n\nfragment SessionInfoCellFragment on ComputeSession {\n  id\n  session_id\n  name\n  status\n  user_email\n  image\n}\n"}}}();i.hash="c41131439f810b7c5cd0bd9eb2857a46",n.default=i},87760:function(e,n,a){a.d(n,{Dj:function(){return d},Kr:function(){return l},M:function(){return o},dS:function(){return c},qh:function(){return u},tQ:function(){return r}});var i=a(29439),t=a(4519),s=a(87112),l=function(e){return function(e){var n=(0,t.useState)(e||(new Date).toISOString()),a=(0,i.Z)(n,2),s=a[0],l=a[1];return[s,function(e){l(e||(new Date).toISOString())}]}(e)},r=function(){return d()._config.domainName},u=function(){var e=d(),n=(0,t.useState)({name:e.current_group,id:e.groupIds[e.current_group]}),a=(0,i.Z)(n,2),s=a[0],l=a[1];return(0,t.useEffect)((function(){var n=function(n){var a=n.detail;l({name:a,id:e.groupIds[a]})};return document.addEventListener("backend-ai-group-changed",n),function(){document.removeEventListener("backend-ai-group-changed",n)}})),s},o=function(e){var n=e.api_endpoint;return(0,t.useMemo)((function(){var e=new globalThis.BackendAIClientConfig("","",n,"SESSION");return new globalThis.BackendAIClient(e,"Backend.AI Console.")}),[n])},d=function(){return(0,s.useQuery)({queryKey:"backendai-client-for-suspense",queryFn:function(){return new Promise((function(e){if("undefined"!==typeof globalThis.backendaiclient&&null!==globalThis.backendaiclient&&!1!==globalThis.backendaiclient.ready)return e(globalThis.backendaiclient);document.addEventListener("backend-ai-connected",(function n(){e(globalThis.backendaiclient),document.removeEventListener("backend-ai-connected",n)}))}))},retry:!1,suspense:!0}).data},c=function(){var e=(0,s.useQuery)({queryKey:"backendai-metadata-for-suspense",queryFn:function(){return fetch("resources/image_metadata.json").then((function(e){return e.json()})).then((function(e){return e}))},suspense:!0,retry:!1}).data,n=function(e){if(!e)return{key:"",tags:[]};var n=e.split("/"),a=(n[2]||n[1]).split(":"),t=(0,i.Z)(a,2);return{key:t[0],tags:t[1].split("-")}};return[e,{getImageAliasName:function(a){var i=n(a).key;return(null===e||void 0===e?void 0:e.imageInfo[i].name)||i},getImageIcon:function(a){var i,t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resources/icons/";if(!a)return"default.png";var l=n(a).key;return s+(void 0!==(null===e||void 0===e||null===(i=e.imageInfo[l])||void 0===i?void 0:i.icon)?null===e||void 0===e||null===(t=e.imageInfo[l])||void 0===t?void 0:t.icon:"default.png")},getImageTags:function(e){},getBaseVersion:function(e){return n(e).tags[0]},getBaseImage:function(e){return n(e).tags[1]},getImageMeta:n}]}},50164:function(e,n,a){a.d(n,{Y:function(){return s},h:function(){return t}});var i=a(87112),t=i.useQuery,s=i.useMutation},6266:function(e,n,a){a.r(n),a.d(n,{default:function(){return A}});var i,t,s=a(93433),l=a(29439),r=a(99277),u=a(1413),o=a(44925),d=a(87760),c=a(50164),g=a(14001),m=a(4519),f=a(2556),k=function(e,n){var a=e.image;e.style;a=a||"";var i=(0,d.dS)(),t=(0,l.Z)(i,2)[1],s=t.getImageAliasName,r=t.getBaseVersion,u=t.getBaseImage;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{children:s(a)}),(0,f.jsx)("div",{children:r(a)}),(0,f.jsx)("div",{children:u(a)})]})},y=m.memo(k),p=a(61749),v=a(44036),h=a(57054),S=a(38818),b=a(28499),I=a(92171),x=a(81748),_=a(16980),F=function(e){var n=e.sessionFrgmt,t=e.onRename,s=(0,d.Dj)(),u=v.Z.useToken().token,o=(0,_.useFragment)(void 0!==i?i:i=a(3173),n),k=(0,c.Y)({mutationFn:function(e){var n=s.APIMajorVersion<5?o.name:o.session_id;return s.rename(n,e)}}),F=h.Z.useForm(),j=(0,l.Z)(F,1)[0],Z=(0,x.$G)().t,K=(0,m.useState)(!1),L=(0,l.Z)(K,2),N=L[0],T=L[1],C=(0,m.useState)(o.name),E=(0,l.Z)(C,2),R=E[0],A=E[1],D=function(){return["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(o.status||void 0)&&!function(){return["RESTARTING","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(o.status||void 0)&&s.email===o.user_email,w=k.isLoading||R!==o.name;return(0,f.jsxs)(r.Z,{direction:"column",children:[(0,f.jsx)(r.Z,{direction:"row",children:(0,f.jsx)(h.Z,{form:j,children:N?(0,f.jsx)(h.Z.Item,{style:{margin:0},name:"name",rules:[{required:!0},{max:64},{pattern:/^(?:[a-zA-Z0-9][a-zA-Z0-9._-]{2,}[a-zA-Z0-9])?$/,message:Z("session.Validation.EnterValidSessionName").toString()}],children:(0,f.jsx)(S.Z,{autoFocus:!0,onPressEnter:function(){j.validateFields().then((function(e){var n=e.name;T(!1),A(n),k.mutate(n,{onSuccess:function(e){t&&t()},onError:function(e){A(o.name)}})}))},onKeyUp:function(e){"Escape"===e.key&&T(!1)}})}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(b.Z.Text,{style:{opacity:w?.5:1},children:R}),D&&(0,f.jsx)(I.ZP,{loading:w,type:"text",icon:(0,f.jsx)(p.Z,{}),style:{color:u.colorLink},onClick:function(){j.setFieldsValue({name:o.name}),T(!0)}})]})})}),(0,f.jsx)(g.Z,{image:o.image}),(0,f.jsx)(y,{image:o.image})]})},j=a(83007),Z=["status","limit","currentPage","pageSize","projectId","filter","extraFetchKey"],K=function(e){var n,i=e.status,s=void 0===i?[]:i,r=(e.limit,e.currentPage),c=void 0===r?1:r,g=e.pageSize,k=void 0===g?50:g,y=e.projectId,p=e.filter,v=e.extraFetchKey,h=void 0===v?"":v,S=(0,o.Z)(e,Z),b=(0,d.Dj)(),I=(0,d.Kr)("initial-fetch"),K=(0,l.Z)(I,2),L=K[0],N=K[1],T=(0,m.useDeferredValue)(L+h),C=(0,x.$G)().t;!b.supports("avoid-hol-blocking")&&s.includes("SCHEDULED")&&(s=s.filter((function(e){return"SCHEDULED"!==e})));var E=(0,_.useLazyLoadQuery)(void 0!==t?t:t=a(72428),{limit:k,offset:(c-1)*k,status:null===(n=s)||void 0===n?void 0:n.join(","),group_id:y,skipClusterSize:!b.supports("multi-container")},{fetchKey:T,fetchPolicy:"network-only"}).compute_session_list;return(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(j.Z,(0,u.Z)({scroll:{x:!0},columns:[{title:C("session.SessionInfo"),render:function(e,n,a){return console.log(n),(0,f.jsx)(F,{sessionFrgmt:n,onRename:function(){N(n.session_id+(new Date).toISOString())}},n.session_id)},fixed:"left"},{title:C("session.Status"),dataIndex:"status"},{title:C("general.Control")},{title:C("session.Configuration")},{title:C("session.Usage")},{title:C("session.Reservation")},{title:C("session.Architecture")},{title:C("session.SessionType")},{title:C("session.Agent")}],dataSource:((null===E||void 0===E?void 0:E.items)||[]).filter(p)},S))})},L=a(79781),N=a(52176),T=a(15850),C=a(45110),E=["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"],R={running:E,interactive:E,batch:E,inference:E,finished:["TERMINATED","CANCELLED"],others:["TERMINATING","ERROR"],default:E},A=function(e){var n=e.children,a=(0,x.$G)().t,i=(0,d.Dj)(),t=v.Z.useToken().token,u=(0,d.qh)(),o=(0,m.useState)("running"),c=(0,l.Z)(o,2),g=c[0],k=c[1],y=(0,m.useState)("next"),p=(0,l.Z)(y,2),h=p[0],S=p[1];return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(N.Z,{message:(0,f.jsxs)(r.Z,{gap:"md",children:[(0,f.jsxs)(b.Z.Text,{children:["This is"," ","current"===h?"current version":"NEXT generation"," ","of session list. you can switch anytime."]}),(0,f.jsx)(T.Z,{options:[{label:"Current",value:"current"},{label:(0,f.jsx)(b.Z.Text,{style:{color:"next"===h?t.colorPrimary:void 0},children:"Next"}),value:"next",icon:(0,f.jsx)(L.Z,{twoToneColor:t.colorWarning})}],value:h,onChange:function(e){return S(e)}})]}),type:"warning",banner:!0,style:{marginTop:-14,marginLeft:-14,marginRight:-14}}),"next"===h?(0,f.jsxs)(r.Z,{direction:"column",align:"stretch",style:{padding:t.padding,gap:t.margin},children:[n,(0,f.jsxs)(r.Z,{direction:"column",align:"stretch",children:[(0,f.jsx)(r.Z,{style:{flex:1},children:(0,f.jsx)(C.Z,{activeKey:g,onChange:function(e){return k(e)},tabBarStyle:{marginBottom:0},style:{width:"100%",paddingLeft:t.paddingMD,paddingRight:t.paddingMD,borderTopLeftRadius:t.borderRadius,borderTopRightRadius:t.borderRadius},items:[{key:"running",label:a("session.Running")},{key:"interactive",label:a("session.Interactive")},{key:"batch",label:a("session.Batch")}].concat((0,s.Z)(i.supports("inference-workload")?[{key:"inference",label:a("session.Inference")}]:[]),[{key:"finished",label:a("session.Finished")},{key:"others",label:a("session.Others")}]),tabBarExtraContent:{right:(0,f.jsx)(r.Z,{direction:"row",gap:"sm",children:(0,f.jsx)("backend-ai-session-launcher",{location:"session",id:"session-launcher",active:!0})})}})}),(0,f.jsx)(m.Suspense,{fallback:(0,f.jsx)("div",{children:"loading.."}),children:(0,f.jsx)(K,{projectId:u.id,status:R[g]||R.default,filter:function(e){var n;return!["interactive","batch","inference"].includes(g)||(null===e||void 0===e||null===(n=e.type)||void 0===n?void 0:n.toLowerCase())===g},extraFetchKey:g})})]})]}):(0,f.jsx)(f.Fragment,{children:(0,f.jsx)("backend-ai-session-view",{class:"page",name:"job",active:!0})})]})}}}]);
//# sourceMappingURL=266.c2d19f73.chunk.js.map