"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[230],{77758:function(e,n,t){t.d(n,{Z:function(){return l}});var a=t(1413),o=t(36459),r=t(68957),i=(t(4519),t(2556)),l=function(e){var n,t=Object.assign({},((0,o.Z)(e),e));return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("style",{children:".ant-modal.bai-modal .ant-modal-content {\n  padding: var(--general-modal-content-padding, 0);\n}\n.ant-modal.bai-modal .ant-modal-body {\n  padding: var(--general-modal-body-padding, 0 24px);\n}\n\n.ant-modal.bai-modal .ant-modal-footer {\n  padding: var(--general-modal-footer-padding, 0 20px 24px 20px);\n}\n\n.ant-modal.bai-modal .ant-modal-header {\n  border-bottom: 1px solid rgb(221, 221, 221);\n  border-width: 100%;\n  justify-content: space-between;\n  display: flex;\n  align-items: center;\n}\n\n.ant-modal.bai-modal .ant-modal-content .ant-modal-header,\n.ant-modal.bai-modal .ant-modal-content > button.ant-modal-close {\n  padding: var(--general-modal-header-padding, 10px 20px);\n  height: var(--general-modal-header-height, 69px);\n}\n\n.ant-modal.bai-modal .ant-modal-content > button.ant-modal-close {\n  /* center */\n  top: 0;\n}\n"}),(0,i.jsx)(r.Z,(0,a.Z)({centered:null===(n=t.centered)||void 0===n||n,className:"bai-modal"},t))]})}},14749:function(e,n,t){var a,o=t(1413),r=t(29439),i=t(44925),l=t(87760),s=t(50164),u=t(77758),d=t(99277),c=t(44036),m=t(57054),p=t(32360),f=t(39883),g=t(42272),v=t(28499),w=t(38818),y=(t(4519),t(81748)),h=t(87112),Z=t(16980),_=t(2556),b=["userFrgmt","onRequestClose"];n.Z=function(e){var n=e.userFrgmt,P=void 0===n?null:n,k=e.onRequestClose,x=(0,i.Z)(e,b),j=(0,y.$G)().t,T=c.Z.useToken().token,F=m.Z.useForm(),S=(0,r.Z)(F,1)[0],C=(0,Z.useFragment)(void 0!==a?a:a=t(78067),P),M=(0,l.Dj)(),E=(0,h.useQuery)({queryKey:["initialize_totp",null===M||void 0===M?void 0:M.email,x.open],queryFn:function(){return(null===C||void 0===C?void 0:C.email)!==(null===M||void 0===M?void 0:M.email)||null!==C&&void 0!==C&&C.totp_activated||!x.open?null:M.initialize_totp()},suspense:!1,staleTime:0,cacheTime:0}),K=(0,s.Y)({mutationFn:function(e){return M.activate_totp(e.otp)}});return(0,_.jsx)(u.Z,(0,o.Z)((0,o.Z)({title:j("webui.menu.SetupTotp"),maskClosable:!1,confirmLoading:K.isLoading,onOk:function(){S.validateFields().then((function(e){K.mutate(e,{onSuccess:function(){p.ZP.success(j("totp.TotpSetupCompleted")),k(!0)},onError:function(){p.ZP.error(j("totp.InvalidTotpCode"))}}),new Promise((function(e,n){})).then((function(){k(!0)}))}))},onCancel:function(){k()},style:{zIndex:1}},x),{},{children:E.isLoading?(0,_.jsx)(d.Z,{justify:"center",direction:"row",children:(0,_.jsx)(f.Z,{})}):E.data?(0,_.jsxs)(m.Z,{preserve:!1,form:S,validateTrigger:["onChange","onBlur"],children:[j("totp.TypeInAuthKey"),(0,_.jsx)(d.Z,{justify:"center",style:{margin:T.marginSM,gap:T.margin},children:(0,_.jsx)(g.Z,{value:E.data.totp_uri})}),j("totp.ScanQRToEnable"),(0,_.jsx)(d.Z,{justify:"center",style:{margin:T.marginSM,gap:T.margin},children:(0,_.jsx)(v.Z.Text,{copyable:!0,code:!0,children:E.data.totp_key})}),j("totp.TypeInAuthKey"),(0,_.jsx)(d.Z,{justify:"center",style:{margin:T.marginSM,gap:T.margin},children:(0,_.jsx)(m.Z.Item,{required:!0,name:"otp",children:(0,_.jsx)(w.Z,{maxLength:6,allowClear:!0,placeholder:"000000",style:{maxWidth:120}})})})]}):(0,_.jsx)(d.Z,{justify:"center",direction:"row",children:j("totp.TotpSetupNotAvailable")})}))}},51230:function(e,n,t){t.r(n),t.d(n,{default:function(){return F}});var a,o=t(1413),r=t(29439),i=t(44925),l=t(87760),s=t(1839),u=t(50164),d=t(77758),c=t(79898),m=t(14749),p=t(88724),f=t(63703),g=t(57054),v=t(32360),w=t(68957),y=t(38818),h=t(19427),Z=t(62708),_=t(32048),b=t.n(_),P=t(4519),k=t(81748),x=t(16980),j=t(2556),T=["onRequestClose"],F=function(e){var n=e.onRequestClose,_=(0,i.Z)(e,T),F=(0,k.$G)().t,S=g.Z.useForm(),C=(0,r.Z)(S,1)[0],M=v.ZP.useMessage(),E=(0,r.Z)(M,2),K=E[0],N=E[1],A=w.Z.useModal(),I=(0,r.Z)(A,2),O=I[0],L=I[1],q=(0,f.Z)(!1),U=(0,r.Z)(q,2),V=U[0],R=U[1].toggle,D=(0,l.Dj)(),$=(0,u.h)("isManagerSupportingTOTP",(function(){return D.isManagerSupportingTOTP()}),{suspense:!0}).data,z=D.supports("2FA")&&$,Q=(0,s.j)(),Y=(0,r.Z)(Q,2),B=Y[0],G=Y[1],W=(0,l.Kr)("initial-fetch"),H=(0,r.Z)(W,2),J=H[0],X=H[1],ee=(0,P.useDeferredValue)(J),ne=(0,x.useLazyLoadQuery)(void 0!==a?a:a=t(57555),{email:B.email,isNotSupportTotp:!z},{fetchPolicy:"network-only",fetchKey:ee}).user,te=(0,u.h)("baiClient.keypair.list",(function(){return D.keypair.list(B.email,["access_key","secret_key"],!0).then((function(e){return e.keypairs}))}),{suspense:!0}).data,ae=(0,u.Y)({mutationFn:function(){return D.remove_totp()}});return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("style",{children:".disabled_style_readonly,\n.disabled_style_readonly input {\n  background-color: #f5f5f5;\n}\n"}),(0,j.jsxs)(d.Z,(0,o.Z)((0,o.Z)({},_),{},{okText:F("webui.menu.Update"),cancelText:F("webui.menu.Cancel"),onCancel:function(){n()},confirmLoading:B.isPendingMutation,onOk:function(){C.validateFields().then((function(e){G.updateFullName(e.full_name,{onSuccess:function(t){t!==B.full_name&&K.open({type:"success",content:F("webui.menu.FullnameUpdated")}),e.newPassword&&e.newPasswordConfirm&&e.originalPassword?G.updatePassword({new_password:e.newPassword,new_password2:e.newPasswordConfirm,old_password:e.originalPassword},{onSuccess:function(){K.open({type:"success",content:F("webui.menu.PasswordUpdated")}),n(!0)},onError:function(e){K.open({type:"error",content:e.message})}}):n(!0)},onError:function(e){K.open({type:"error",content:e.message})}})}))},centered:!0,destroyOnClose:!0,title:F("webui.menu.MyAccountInformation"),children:[(0,j.jsxs)(g.Z,{layout:"horizontal",labelCol:{span:8},form:C,initialValues:{full_name:B.full_name,totp_activated:(null===ne||void 0===ne?void 0:ne.totp_activated)||!1,access_key:null===te||void 0===te?void 0:te[0].access_key},preserve:!1,children:[(0,j.jsx)(g.Z.Item,{name:"full_name",label:F("webui.menu.FullName"),rules:[function(){return{validator:function(e,n){return n&&n.length<65?Promise.resolve():Promise.reject(new Error(F("webui.menu.FullNameInvalid")))}}}],children:(0,j.jsx)(y.Z,{})}),(0,j.jsx)(g.Z.Item,{name:"access_key",label:F("general.AccessKey"),children:(0,j.jsx)(h.Z,{options:b().map(te,(function(e){return{value:e.access_key}}))})}),(0,j.jsx)(g.Z.Item,{label:F("general.SecretKey"),shouldUpdate:function(e,n){return e.access_key!==n.access_key},children:function(e){var n,t=e.getFieldValue;return(0,j.jsx)(y.Z.Password,{value:null===(n=b().find(te,["access_key",t("access_key")]))||void 0===n?void 0:n.secret_key,className:"disabled_style_readonly",readOnly:!0})}}),(0,j.jsx)(g.Z.Item,{name:"originalPassword",label:F("webui.menu.OriginalPassword"),rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return t||!n("newPassword")&&!n("newPasswordConfirm")?Promise.resolve():Promise.reject(new Error(F("webui.menu.InputOriginalPassword")))}}}],dependencies:["newPassword","newPasswordConfirm"],children:(0,j.jsx)(y.Z.Password,{})}),(0,j.jsx)(g.Z.Item,{name:"newPassword",label:F("webui.menu.NewPassword"),rules:[{pattern:c.passwordPattern,message:F("webui.menu.InvalidPasswordMessage")}],children:(0,j.jsx)(y.Z.Password,{})}),(0,j.jsx)(g.Z.Item,{name:"newPasswordConfirm",label:F("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return t&&n("newPassword")!==t?Promise.reject(new Error(F("webui.menu.NewPasswordMismatch"))):Promise.resolve()}}}],children:(0,j.jsx)(y.Z.Password,{})}),!!z&&(0,j.jsx)(g.Z.Item,{name:"totp_activated",label:F("webui.menu.TotpActivated"),valuePropName:"checked",children:(0,j.jsx)(Z.Z,{onChange:function(e){e?R():null!==ne&&void 0!==ne&&ne.totp_activated&&(C.setFieldValue("totp_activated",!0),O.confirm({title:F("totp.TurnOffTotp"),icon:(0,j.jsx)(p.Z,{}),content:F("totp.ConfirmTotpRemovalBody"),okText:F("button.Yes"),okType:"danger",cancelText:F("button.No"),onOk:function(){ae.mutate(void 0,{onSuccess:function(){v.ZP.success(F("totp.RemoveTotpSetupCompleted")),X(),C.setFieldValue("totp_activated",!1)},onError:function(e){v.ZP.error(e.message)}})},onCancel:function(){C.setFieldValue("totp_activated",!0)}}))}})})]}),!!z&&(0,j.jsx)(m.Z,{userFrgmt:ne,open:V,onRequestClose:function(e){e?X():C.setFieldValue("totp_activated",!1),R()}})]})),N,L]})}},78067:function(e,n,t){t.r(n);var a={argumentDefinitions:[{kind:"RootArgument",name:"isNotSupportTotp"}],kind:"Fragment",metadata:null,name:"TOTPActivateModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null}],type:"User",abstractKey:null,hash:"f5da6b3094f7d70bef9373d9c907955c"};n.default=a},57555:function(e,n,t){t.r(n);var a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"}],n=[{kind:"Variable",name:"email",variableName:"email"}],t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserProfileSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,a,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserProfileSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,a,{alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null}],storageKey:null}]},params:{cacheID:"b0c9773ff4a3e759f0f9822463daa757",id:null,metadata:{},name:"UserProfileSettingModalQuery",operationKind:"query",text:"query UserProfileSettingModalQuery(\n  $email: String!\n  $isNotSupportTotp: Boolean!\n) {\n  user(email: $email) {\n    id\n    totp_activated @skipOnClient(if: $isNotSupportTotp)\n    ...TOTPActivateModalFragment\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();a.hash="c87e74dfaa01d51a1697e67df81e101b",n.default=a},1839:function(e,n,t){t.d(n,{T:function(){return c},j:function(){return m}});var a=t(1413),o=t(29439),r=t(87760),i=t(43255),l=t(50164),s=t(32048),u=t.n(s),d=t(4519),c=function(){var e=(0,r.Kr)("first"),n=(0,o.Z)(e,2),t=n[0],a=n[1],i=(0,r.Dj)();return[(0,l.h)({queryKey:["useResourceSlots",t],queryFn:function(){return i.get_resource_slots()},staleTime:0}).data,{refresh:function(){return a()}}]},m=function(){var e=(0,r.Dj)(),n=(0,d.useState)({full_name:e.full_name,email:e.email}),t=(0,o.Z)(n,2),s=t[0],c=t[1];(0,d.useEffect)((function(){var n=function(n){if(e.supports("change-user-name")){var t=n.detail;c((function(e){return(0,a.Z)((0,a.Z)({},e),{},{full_name:t})}))}};return document.addEventListener("current-user-info-changed",n),function(){document.removeEventListener("current-user-info-changed",n)}}),[e]);var m=(0,l.Y)({mutationFn:function(n){return e.update_full_name(n.email,n.full_name)}}),p=(0,l.Y)({mutationFn:function(n){return e.update_password(n.old_password,n.new_password,n.new_password2)}});return[(0,a.Z)((0,a.Z)({},s),{},{username:function(){var n=u().trim(s.full_name).length>0?s.full_name:s.email;if(e._config.maskUserInfo){var t=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(n)?n.split("@")[0].length-2:n.length-2;n=(0,i.Cd)(n,"*",2,t)}return n}(),isPendingMutation:m.isLoading||p.isLoading}),{updateFullName:function(n,t){m.mutate({full_name:n,email:e.email},{onSuccess:function(){(null===t||void 0===t?void 0:t.onSuccess)&&t.onSuccess(n),document.dispatchEvent(new CustomEvent("current-user-info-changed",{detail:n})),c((function(e){return(0,a.Z)((0,a.Z)({},e),{},{full_name:n})}))},onError:function(e){(null===t||void 0===t?void 0:t.onError)&&t.onError(e)}})},updatePassword:function(e,n){p.mutate(e,{onSuccess:function(){(null===n||void 0===n?void 0:n.onSuccess)&&n.onSuccess(void 0)},onError:function(e){(null===n||void 0===n?void 0:n.onError)&&n.onError(e)}})}}]}}}]);
//# sourceMappingURL=230.0396ec8b.chunk.js.map