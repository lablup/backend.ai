"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[1198,7569],{68314:(e,l,a)=>{a.d(l,{A:()=>o});var n=a(89214),r=(a(66610),a(66906));const o=e=>{let{type:l,style:a,monospace:o,children:i,...s}=e;return o?(0,r.jsx)(n.A.Text,{type:l,...s,style:{fontFamily:"monospace",...a},children:i}):(0,r.jsx)(n.A.Text,{type:l,style:a,...s,children:i})}},27569:(e,l,a)=>{a.r(l),a.d(l,{default:()=>S,useFileUploadManager:()=>_});const n=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"vfolderGlobalId"}],l=[{kind:"Variable",name:"id",variableName:"vfolderGlobalId"}],a={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"FileUploadManagerQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[{kind:"RequiredField",field:a,action:"THROW"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"FileUploadManagerQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"da162cec4ce77cdb6fcdd31a87d2f135",id:null,metadata:{},name:"FileUploadManagerQuery",operationKind:"query",text:"query FileUploadManagerQuery(\n  $vfolderGlobalId: String!\n) {\n  vfolder_node(id: $vfolderGlobalId) {\n    name\n    id\n  }\n}\n"}}}();n.hash="1f3a6bd97dae542b3c85605ab9a61d03";const r=n;var o=a(82860),i=a(63872),s=a(64949),d=a(81501),t=a(17315),u=a(8348),c=a.n(u),m=a(97190),g=a(66610),p=a(54070),y=a(89737),F=a(19885),f=a(29951);const k=(0,s.eU)([]),v=(0,s.eU)({}),h=(0,t.Iz)((e=>(0,s.eU)((l=>l(v)[e]),((l,a,n)=>{const r=l(v);a(v,{...r,[e]:n})})))),S=()=>{const{t:e}=(0,p.Bd)(),{upsertNotification:l}=(0,o.js)(),a=(0,F.CX)(),[n,r]=(0,d.fp)(k),[i,s]=(0,d.fp)(v),t=new m.A({concurrency:1});return(0,g.useEffect)((()=>{0!==n.length&&a&&(n.forEach((a=>{const{vFolderId:n,vFolderName:r,uploadFilesNames:o,startFunctions:i}=a;s((e=>{var l;return{...e,[n]:{vFolderName:r,pending:[...(null===(l=e[n])||void 0===l?void 0:l.pending)||[],...o],completed:[],failed:[]}}})),l({key:"upload:"+n,open:!0,message:e("explorer.UploadToFolder",{folderName:r}),backgroundTask:{status:"pending",percent:0,onChange:{pending:e("explorer.ProcessingUpload")}},duration:0}),i.forEach((a=>{t.add((async()=>{await a({onProgress:(a,o,i)=>{s((s=>{var d;const t=(null===(d=s[n])||void 0===d?void 0:d.pending)||[];return l({key:"upload:"+n,message:`${e("explorer.UploadToFolder",{folderName:r})}${t.length>1?` (${t.length})`:""}`,backgroundTask:{status:"pending",percent:Math.round(a/o*100)-1,onChange:{pending:e("explorer.FileInProgress",{fileName:i})}}}),s}))}}).then((e=>{s((l=>({...l,[n]:{...l[n],pending:l[n].pending.filter((l=>l!==e)),completed:[...l[n].completed,e]}})))})).catch((e=>{s((l=>({...l,[n]:{...l[n],pending:l[n].pending.filter((l=>l!==e)),failed:[...l[n].failed,e]}})))}))}))}))})),r([]))}),[n]),(0,g.useEffect)((()=>{Object.entries(i).forEach((a=>{let[n,r]=a;c().isEmpty(null===r||void 0===r?void 0:r.pending)&&(c().isEmpty(null===r||void 0===r?void 0:r.failed)?c().isEmpty(null===r||void 0===r?void 0:r.completed)||(l({key:"upload:"+n,open:!0,message:e("explorer.SuccessfullyUploadedToFolder",{folderName:null===r||void 0===r?void 0:r.vFolderName}),backgroundTask:{status:"resolved",percent:100,onChange:{resolved:" "}},duration:3}),s((e=>({...e,[n]:{...e[n],completed:[]}})))):l({key:"upload:"+n,open:!0,message:e("explorer.UploadFailed",{folderName:null===r||void 0===r?void 0:r.vFolderName}),backgroundTask:{status:"rejected",percent:0,onChange:{rejected:e("explorer.FileUploadFailed",{folderName:null===r||void 0===r?void 0:r.vFolderName})}},extraDescription:c().join(null===r||void 0===r?void 0:r.failed,", ")}))}))}),[i]),null},_=e=>{const l=(0,i.kq)(),{t:a}=(0,p.Bd)(),{upsertNotification:n}=(0,o.js)(),[s,t]=(e=>(0,d.fp)(h(e)))(e),u=(0,d.Xr)(k),{vfolder_node:m}=(0,y.useLazyLoadQuery)(r,{vfolderGlobalId:(0,i.wc)("VirtualFolderNode",e)},{fetchPolicy:e?"network-only":"store-only"});return{uploadStatus:s,setUploadStatus:t,uploadFiles:async(e,r,o)=>{var i;if(!((e,r)=>{const o=l._config.maxFileUploadSize,i=c().map(e,(e=>e.size)).reduce(((e,l)=>Math.max(e,l)),0);var s;return!(o>0&&i>o)||(n({open:!0,key:"upload:"+r,message:a("explorer.UploadFailed",{folderName:null!==(s=null===m||void 0===m?void 0:m.name)&&void 0!==s?s:""}),description:a("data.explorer.FileUploadSizeLimit"),duration:3,toText:a("data.folders.OpenAFolder"),to:{search:new URLSearchParams({folder:r}).toString()}}),!1)})(e,r))return;let s=[];const d=c().map(e,(e=>(s.push(e.webkitRelativePath||e.name),async a=>{const n=[o,e.webkitRelativePath||e.name].filter(Boolean).join("/"),i=await l.vfolder.create_upload_session(n,e,r);return new Promise(((l,n)=>{new f._O(e,{endpoint:i,uploadUrl:i,retryDelays:[0,3e3,5e3,1e4,2e4],chunkSize:x(e.size),storeFingerprintForResuming:!1,metadata:{filename:e.name,filetype:e.type},onProgress:(l,n)=>{var r;null===a||void 0===a||null===(r=a.onProgress)||void 0===r||r.call(a,l,n,e.name)},onSuccess:()=>{l(e.webkitRelativePath||e.name)},onError:()=>{n(e.webkitRelativePath||e.name)}}).start()}))}))),t={vFolderId:r,vFolderName:null!==(i=null===m||void 0===m?void 0:m.name)&&void 0!==i?i:"",uploadFilesNames:s,startFunctions:d};u((e=>[...e,t]))}}},x=e=>{const l=1048576;return e>=5120*l?200*l:e>=1024*l?100*l:e>=100*l?50*l:15*l}},81198:(e,l,a)=>{a.r(l),a.d(l,{default:()=>re});const n=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"vfolderGlobalId"}],l=[{kind:"Variable",name:"id",variableName:"vfolderGlobalId"}],a={alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"FolderExplorerQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,n,r,o,{args:null,kind:"FragmentSpread",name:"FolderExplorerHeaderFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeDescriptionFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"FolderExplorerQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,n,r,o,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},r],storageKey:null}]},params:{cacheID:"e60d786710970b21697ea3fcd2727be1",id:null,metadata:{},name:"FolderExplorerQuery",operationKind:"query",text:'query FolderExplorerQuery(\n  $vfolderGlobalId: String!\n) {\n  vfolder_node(id: $vfolderGlobalId) {\n    group\n    unmanaged_path @since(version: "25.04.0")\n    permissions\n    host\n    ...FolderExplorerHeaderFragment\n    ...VFolderNodeDescriptionFragment\n    ...VFolderNameTitleNodeFragment\n    id\n  }\n}\n\nfragment EditableVFolderNameFragment on VirtualFolderNode {\n  id\n  name\n  user\n  group\n  status\n}\n\nfragment FolderExplorerHeaderFragment on VirtualFolderNode {\n  id\n  user\n  permission\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderNameTitleNodeFragment\n  ...VFolderNodeIdenticonFragment\n  ...EditableVFolderNameFragment\n}\n\nfragment VFolderNameTitleNodeFragment on VirtualFolderNode {\n  name\n}\n\nfragment VFolderNodeDescriptionFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderPermissionCellFragment\n  ...useVirtualFolderNodePathFragment\n}\n\nfragment VFolderNodeIdenticonFragment on VirtualFolderNode {\n  id\n}\n\nfragment VFolderPermissionCellFragment on VirtualFolderNode {\n  permissions\n}\n\nfragment useVirtualFolderNodePathFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n}\n'}}}();n.hash="f1ac6c7707249c64019aa879886995c4";const r=n;var o=a(27569);const i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FolderExplorerHeaderFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeIdenticonFragment"},{args:null,kind:"FragmentSpread",name:"EditableVFolderNameFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"b034e00d5b8454a58e6ebb66a4d821a1"},s=i;var d=a(56457),t=a(99453),u=a(44163),c=a(75706),m=a(89214),g=a(56761),p=a(33403),y=a(75220),F=a(63872),f=a(66610),k=a(54070),v=a(89737),h=a(66906);const S=e=>{let{vfolderNodeFrgmt:l,folderExplorerRef:a,titleStyle:n}=e;const{t:r}=(0,k.Bd)(),{token:o}=u.A.useToken(),{lg:i}=c.Ay.useBreakpoint(),f=(0,v.useFragment)(s,l);return(0,h.jsxs)(F.OO,{"data-testid":"folder-explorer-header",justify:"between",gap:o.marginMD,style:{width:"100%"},children:[(0,h.jsxs)(F.OO,{"data-testid":"folder-explorer-title",gap:"xs",style:{flex:1,...n},children:[f?(0,h.jsx)(t.A,{vfolderNodeIdenticonFrgmt:f,style:{fontSize:o.fontSizeHeading4}}):(0,h.jsx)(F.OO,{style:{borderColor:o.colorBorderSecondary,borderWidth:1,borderStyle:"solid",width:o.fontSizeHeading3,height:o.fontSizeHeading3,borderRadius:o.borderRadius}}),f&&(0,h.jsx)(d.A,{vfolderFrgmt:f,enableLink:!1,component:m.A.Title,level:3,style:{margin:0,width:"100%"},ellipsis:!0,editable:{triggerType:["icon","text"]},inputProps:{size:"large"}})]}),(0,h.jsx)(F.OO,{"data-testid":"folder-explorer-actions",justify:"end",gap:o.marginSM,children:null!==f&&void 0!==f&&f.unmanaged_path?null:(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(g.A,{title:!i&&r("data.explorer.ExecuteFileBrowser"),children:(0,h.jsx)(p.Ay,{icon:(0,h.jsx)(y.A,{width:"18px",src:"/resources/icons/filebrowser.svg",alt:"File Browser",preview:!1}),onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e._executeFileBrowser()},children:i&&r("data.explorer.ExecuteFileBrowser")})}),(0,h.jsx)(g.A,{title:!i&&r("data.explorer.RunSSH/SFTPserver"),children:(0,h.jsx)(p.Ay,{icon:(0,h.jsx)(y.A,{width:"18px",src:"/resources/icons/sftp.png",alt:"SSH / SFTP",preview:!1}),onClick:()=>{var e;null===(e=a.current)||void 0===e||e._executeSSHProxyAgent()},children:i&&r("data.explorer.RunSSH/SFTPserver")})})]})})]})},_=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],l=[{kind:"Variable",name:"id",variableName:"id"}],a={alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,n],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[a,n,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"3aee063a4b508648c2365ba6c7f0f44a",id:null,metadata:{},name:"VFolderNodeDescriptionPermissionRefreshQuery",operationKind:"query",text:"query VFolderNodeDescriptionPermissionRefreshQuery(\n  $id: String!\n) {\n  vfolder_node(id: $id) {\n    permission\n    permissions\n    id\n  }\n}\n"}}}();_.hash="36063c8300310d9ef6c369b49127a2a2";const x=_,b={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderPermissionCellFragment"},{args:null,kind:"FragmentSpread",name:"useVirtualFolderNodePathFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"f4ca4470ea635f85c8c346eed0a5fe8c"},K=b;var N=a(2156),w=a(19885),j=a(37615),A=a(19337),P=a(71526);const V={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useVirtualFolderNodePathFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"439221036e87c57ca3ec1ce737e0cdf7"},T=V;var I=a(8348),z=a.n(I);const O=e=>{const l=(0,v.useFragment)(T,e),[a,n]=z().split(null===l||void 0===l?void 0:l.quota_scope_id,":"),r=(0,F.om)(null===l||void 0===l?void 0:l.id),o=r.slice(0,2),i=r.slice(2,4),s=r.slice(4),d=`${n.replaceAll("-","")}/${o}/${i}/${s.replaceAll("-","")}`;return{quotaScopeType:a,quotaScopeIdWithoutType:n,vfolderId:r,vfolderIdPrefix1:o,vfolderIdPrefix2:i,vfolderIdRest:s,vfolderPath:d}};var R=a(61659),D=a(14659),q=a(67097),E=a(68314);const H=e=>{let{vfolderNodeFrgmt:l}=e;const{quotaScopeType:a,quotaScopeIdWithoutType:n,vfolderId:r,vfolderIdPrefix1:o,vfolderIdPrefix2:i,vfolderIdRest:s}=O(l),{token:d}=u.A.useToken();return(0,h.jsxs)(F.OO,{direction:"row",align:"start",justify:"start",wrap:"wrap",gap:3,children:[(0,h.jsx)(E.A,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"(root)"}),(0,h.jsx)(E.A,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,h.jsxs)(F.OO,{direction:"column",align:"start",justify:"start",children:[(0,h.jsx)(E.A,{monospace:!0,copyable:{text:n},style:{fontSize:"0.9em"},children:z().truncate(n.replaceAll("-",""),{length:15})}),(0,h.jsxs)(E.A,{type:"secondary",style:{fontSize:d.fontSizeSM},children:["Quota Scope ID (",z().upperFirst(a),")"]})]}),(0,h.jsx)(E.A,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,h.jsxs)(F.OO,{direction:"column",align:"start",justify:"start",children:[(0,h.jsxs)(F.OO,{gap:3,children:[(0,h.jsx)(E.A,{monospace:!0,style:{fontSize:"0.9em"},children:o}),(0,h.jsx)(E.A,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,h.jsx)(E.A,{monospace:!0,style:{fontSize:"0.9em"},children:i}),(0,h.jsx)(E.A,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,h.jsx)(E.A,{monospace:!0,copyable:{text:r},style:{fontSize:"0.9em"},children:z().truncate(s.replaceAll("-",""),{length:7})})]}),(0,h.jsx)(E.A,{type:"secondary",style:{fontSize:d.fontSizeSM},children:"VFolder ID"})]})]})};var L=a(99139),U=a(95676),Q=a(18682),M=a(80503),C=a(4994),B=a.n(C);const $=e=>{var l;let{vfolderNodeFrgmt:a,onRequestRefresh:n,...r}=e;const{t:o}=(0,k.Bd)(),{token:i}=u.A.useToken(),{message:s}=Q.A.useApp(),{getErrorMessage:d}=(0,F.B7)(),t=(0,v.useRelayEnvironment)(),c=(0,P.hd)(),g=(0,w.CX)(),[p]=(0,j.U6)(),y=(0,A.ET)({mutationFn:e=>{let{permission:l,id:a}=e;return g.vfolder.update_folder({permission:l},a)}}),f=(0,v.useFragment)(K,a),{vfolderPath:S}=O(f),_=(0,F.om)(f.id),b=(0,F.YM)([!(null!==f&&void 0!==f&&f.unmanaged_path)&&{key:"path",label:(0,h.jsx)(m.A.Text,{copyable:{text:S},style:{color:i.colorTextLabel},children:o("data.folders.Path")}),children:(0,h.jsx)(H,{vfolderNodeFrgmt:f})},{key:"status",label:o("data.folders.Status"),children:(0,h.jsx)(D.A,{color:f.status?q.C[f.status]:void 0,children:z().toUpper(f.status||"")})},{key:"host",label:o("data.Host"),children:f.host},{key:"ownership_type",label:o("data.folders.Ownership"),children:"user"===(null===f||void 0===f?void 0:f.ownership_type)?(0,h.jsxs)(F.OO,{gap:"xs",children:[(0,h.jsx)(m.A.Text,{children:o("data.User")}),(0,h.jsx)(L.A,{style:{color:i.colorTextTertiary}})]}):(0,h.jsxs)(F.OO,{gap:"xs",children:[(0,h.jsx)(m.A.Text,{children:o("data.Project")}),(0,h.jsx)(F.Ob,{style:{color:i.colorTextTertiary}})]})},((null===f||void 0===f?void 0:f.user)===p.uuid||g.is_admin&&(null===f||void 0===f?void 0:f.group)===(null===c||void 0===c?void 0:c.id))&&{key:"permission",label:o("data.folders.MountPermission"),children:(0,h.jsx)(R.A,{defaultValue:"wd"===f.permission?"rw":f.permission,options:[{value:"ro",label:o("data.ReadOnly")},{value:"rw",label:o("data.ReadWrite")}],onChange:e=>{y.mutate({permission:e,id:_},{onSuccess:()=>{s.success(o("data.permission.PermissionModified")),document.dispatchEvent(new CustomEvent("backend-ai-folder-updated")),(0,v.fetchQuery)(t,x,{id:f.id}).toPromise(),null===n||void 0===n||n()},onError:e=>{s.error(d(e))}})},popupMatchSelectWidth:!1})},{key:"owner",label:o("data.folders.Owner"),children:(null===f||void 0===f?void 0:f.user)===(null===p||void 0===p?void 0:p.uuid)||g.is_admin&&(null===f||void 0===f?void 0:f.group)===(null===c||void 0===c?void 0:c.id)?(0,h.jsx)(F.OO,{justify:"start",children:(0,h.jsx)(U.A,{})}):null},null!==f.user_email&&{key:"user_email",label:o("data.User"),children:(0,h.jsx)(m.A.Text,{copyable:!0,children:f.user_email})},null!==f.group_name&&{key:"group_name",label:o("data.Project"),children:f.group_name},{key:"cloneable",label:o("data.folders.Cloneable"),children:f.cloneable?(0,h.jsx)(F.OO,{justify:"start",children:(0,h.jsx)(U.A,{})}):null},{key:"max_size",label:o("data.folders.MaxSize"),children:f.max_size?null===(l=(0,N.Gh)(f.max_size,"g",2))||void 0===l?void 0:l.displayValue:"\u221e"},{key:"usage",label:o("data.UsageMode"),children:f.usage_mode},{key:"created_at",label:o("data.folders.CreatedAt"),children:B()(f.created_at).format("lll")}]);return(0,h.jsx)(M.A,{bordered:!0,column:1,size:"small",items:b,styles:{content:{wordBreak:"break-word",overflowWrap:"break-word"}},...r})};var G=a(12991),W=a(77828),X=a(90077),J=a(17505);const Y=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domainName"},{defaultValue:null,kind:"LocalArgument",name:"projectId"},{defaultValue:null,kind:"LocalArgument",name:"resourcePolicyName"}],l=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domainName"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domainName"},{kind:"Variable",name:"id",variableName:"projectId"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"resourcePolicyName"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:l,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:a},params:{cacheID:"f7d16150a7d77cb465733a2933a08261",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery(\n  $domainName: String\n  $projectId: UUID!\n  $resourcePolicyName: String\n) {\n  domain(name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  group(id: $projectId, domain_name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $resourcePolicyName) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();Y.hash="616594ca9d6c787458c32688c1a25b1f";const Z=Y,ee=function(){var e={defaultValue:null,kind:"LocalArgument",name:"accessKey"},l={defaultValue:null,kind:"LocalArgument",name:"domainName"},a=[{kind:"Variable",name:"access_key",variableName:"accessKey"},{kind:"Variable",name:"domain_name",variableName:"domainName"}],n={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null};return{fragment:{argumentDefinitions:[e,l],kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{kind:"RequiredField",field:{alias:null,args:a,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{kind:"RequiredField",field:n,action:"THROW"}],storageKey:null},action:"THROW"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,e],kind:"Operation",name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{alias:null,args:a,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"ca4270af888b8158a6bbb4fe9dc305ca",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_KeypairQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_KeypairQuery(\n  $domainName: String!\n  $accessKey: String\n) {\n  keypair(domain_name: $domainName, access_key: $accessKey) {\n    resource_policy\n    id\n  }\n}\n"}}}();ee.hash="43280e755e9e0f52dcd74eb7aa29d60c";const le=ee;var ae=a(85727);const ne=(0,J.rU)((e=>{let{css:l}=e;return{baiModalHeader:l`
    .ant-modal-title {
      width: 100%;
    }
  `}})),re=e=>{var l,a;let{vfolderID:n,onRequestClose:i,...s}=e;const{t:d}=(0,k.Bd)(),{token:t}=u.A.useToken(),{xl:m}=c.Ay.useBreakpoint(),{styles:g}=ne(),p=(0,f.useRef)(null),{uploadStatus:y,uploadFiles:_}=(0,o.useFileUploadManager)(n),[x,b]=(0,w.zu)(),K=(0,w.CX)(),N=(0,w.eZ)(),j=(0,P.hd)(),A=null===K||void 0===K||null===(l=K._config)||void 0===l?void 0:l.accessKey,{unitedAllowedPermissionByVolume:V}=((e,l,a)=>{var n,r,o;const i=(0,w.CX)(),{keypair:s}=(0,v.useLazyLoadQuery)(le,{domainName:e,accessKey:a},{fetchPolicy:"store-or-network"}),d=(0,v.useLazyLoadQuery)(Z,{domainName:e,projectId:l,resourcePolicyName:null===s||void 0===s?void 0:s.resource_policy},{fetchPolicy:"store-or-network"}),t=JSON.parse((null===d||void 0===d||null===(n=d.domain)||void 0===n?void 0:n.allowed_vfolder_hosts)||"{}"),u=JSON.parse((null===d||void 0===d||null===(r=d.group)||void 0===r?void 0:r.allowed_vfolder_hosts)||"{}"),c=JSON.parse((null===d||void 0===d||null===(o=d.keypair_resource_policy)||void 0===o?void 0:o.allowed_vfolder_hosts)||"{}"),{data:m}=(0,ae.U)({queryKey:["vhostInfo"],queryFn:async()=>await i.vfolder.list_hosts(),staleTime:3e5,gcTime:0}),g=Object.assign({},...m.allowed.map((e=>{return{[e]:(l=[t[e],u[e],c[e]],[...new Set([].concat(...l.filter(Boolean)))])};var l})));return{StorageHostPermissionByDomain:t,StorageHostPermissionByGroup:u,StorageHostPermissionByResourcePolicy:c,unitedAllowedPermissionByVolume:g}})(N,j.id,A),T=(0,f.useRef)(null);(0,f.useEffect)((()=>{y&&z().isEmpty(y.pending)&&b()}),[y,b]);const{vfolder_node:I}=(0,v.useLazyLoadQuery)(r,{vfolderGlobalId:(0,F.wc)("VirtualFolderNode",n)},{fetchPolicy:s.open?"network-only":"store-only"}),O=z().includes(V[null!==(a=null===I||void 0===I?void 0:I.host)&&void 0!==a?a:""],"download-file"),R=z().includes(null===I||void 0===I?void 0:I.permissions,"delete_content"),D=z().includes(null===I||void 0===I?void 0:I.permissions,"write_content"),q=null!==I&&void 0!==I&&I.unmanaged_path?(0,h.jsx)(G.A,{message:d("explorer.NoExplorerSupportForUnmanagedFolder"),showIcon:!0}):(0,h.jsx)(F.Gt,{targetVFolderId:n,fetchKey:x,onUpload:(e,l)=>{_(e,n,l)},enableDownload:O,enableDelete:R,enableWrite:D,tableProps:{scroll:m?{x:"max-content"}:{x:"max-content",y:"calc(100vh - 400px)"}},style:{paddingBottom:m?t.paddingLG:0},fileDropContainerRef:T}),E=I?(0,h.jsx)($,{vfolderNodeFrgmt:I,onRequestRefresh:()=>{var e;null===(e=p.current)||void 0===e||e._fetchVFolder()}}):null;return(0,h.jsx)(F.Ib,{className:g.baiModalHeader,width:"90%",centered:!0,destroyOnClose:!0,footer:null,title:I?(0,h.jsx)(S,{titleStyle:{zIndex:t.zIndexPopupBase+2},vfolderNodeFrgmt:I,folderExplorerRef:p}):null,bodyProps:{ref:T},onCancel:()=>{i()},...s,children:(0,h.jsxs)(F.OO,{direction:"column",gap:"lg",align:"stretch",children:[I?(null===j||void 0===j?void 0:j.id)!==(null===I||void 0===I?void 0:I.group)&&null!==I&&void 0!==I&&I.group?(0,h.jsx)(G.A,{message:d("data.NotInProject"),type:"warning",showIcon:!0}):null:(0,h.jsx)(G.A,{message:d("explorer.FolderNotFoundOrNoAccess"),type:"error",showIcon:!0}),m?(0,h.jsxs)(W.A,{style:{gap:t.size},layout:m?"horizontal":"vertical",children:[(0,h.jsx)(W.A.Panel,{resizable:!1,children:q}),(0,h.jsx)(W.A.Panel,{defaultSize:500,children:E})]},m?"large":"small"):(0,h.jsxs)(F.OO,{direction:"column",align:"stretch",children:[q,(0,h.jsx)(X.A,{style:{borderColor:t.colorBorderSecondary}}),E]}),(0,h.jsx)("div",{style:{display:"none"},children:(0,h.jsx)("backend-ai-folder-explorer",{ref:p,active:!0,vfolderID:n})})]})})}}}]);
//# sourceMappingURL=1198.59a86a58.chunk.js.map