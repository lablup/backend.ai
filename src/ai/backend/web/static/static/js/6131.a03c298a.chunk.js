"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[6131],{90003:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"endpoint_id"},n={defaultValue:null,kind:"LocalArgument",name:"filter"},t={defaultValue:null,kind:"LocalArgument",name:"limit"},i={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"projectID"},o={defaultValue:null,kind:"LocalArgument",name:"skipEndpoint"},a=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],r={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},c={args:null,kind:"FragmentSpread",name:"EndpointLLMChatCard_endpoint"},p=[{kind:"Variable",name:"endpoint_id",variableName:"endpoint_id"}],m=[d,s,u,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:[e,n,t,i,l,o],kind:"Fragment",metadata:null,name:"EndpointSelectQuery",selections:[{alias:null,args:a,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[r,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[d,s,u,c],storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[d,s,c],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[i,t,l,n,e,o],kind:"Operation",name:"EndpointSelectQuery",selections:[{alias:null,args:a,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[r,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:m,storageKey:null}],storageKey:null},{alias:null,args:p,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:m,storageKey:null}]},params:{cacheID:"4ed77e0d8d228a82aa36a46316bc28ca",id:null,metadata:{},name:"EndpointSelectQuery",operationKind:"query",text:"query EndpointSelectQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n  $filter: String\n  $endpoint_id: UUID!\n  $skipEndpoint: Boolean!\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: $filter) {\n    total_count\n    items {\n      name\n      endpoint_id\n      url\n      ...EndpointLLMChatCard_endpoint\n      id\n    }\n  }\n  endpoint(endpoint_id: $endpoint_id) @skipOnClient(if: $skipEndpoint) {\n    name\n    endpoint_id\n    ...EndpointLLMChatCard_endpoint\n    id\n  }\n}\n\nfragment EndpointLLMChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="bc98e0b499fc7a18b88e87841f5e6e47";const l=i},46735:(e,n,t)=>{t.d(n,{A:()=>pe});var i=t(72375),l=t(23441),o=t(53350);const a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[n,i]=(0,o.useState)(0);return(0,o.useEffect)((()=>{(0,o.startTransition)((()=>{(async e=>{const{encode:n}=await t.e(2471).then(t.bind(t,32471));return n(e).length})(e).then(i).catch((()=>{i(e.length)}))}))}),[e]),n};var r=t(72338),d=t(11383),s=t(60598);const u=e=>{let{style:n,loading:t,autoFocus:i,onStop:l,onSend:a,...r}=e;const u=(0,o.useRef)(null);return(0,o.useEffect)((()=>{i&&u.current&&u.current.focus()}),[i]),(0,s.jsx)(d.A,{ref:u,...r,loading:t,onSubmit:()=>{null===a||void 0===a||a()},onCancel:()=>{null===l||void 0===l||l()},submitType:"enter"})};var c=t(1581),p=t(46976),m=t.n(p),g=t(91788);const f=e=>{let{models:n,allowCustomModel:t,...i}=e;const{t:l}=(0,g.Bd)();return(0,s.jsx)(c.A,{placeholder:l("chatui.SelectModel"),style:{fontWeight:"normal"},showSearch:!0,options:m().concat(t?[{label:"Custom",value:"custom"}]:[],m().chain(n).groupBy("group").mapValues((e=>m().map(e,(e=>({label:e.label,value:e.name}))))).map(((e,n)=>({label:"undefined"===n?"Others":n,options:e}))).value()),popupMatchSelectWidth:!1,...i})};var h=t(82919),y=t(52335),v=t(31456),x=t(167),k=t(37542);const b=e=>{let{copyable:n,defaultIcon:t,...i}=e;const[l,a]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{if(l){const e=setTimeout((()=>{a(!1)}),2e3);return()=>clearTimeout(e)}}),[l]),(0,s.jsx)(h.A,{title:l?"Copied!":"Copy",open:!!l||void 0,children:(0,s.jsx)(k.CopyToClipboard,{text:(null===n||void 0===n?void 0:n.text)||"",onCopy:async()=>{a(!0)},children:(0,s.jsx)(y.Ay,{icon:l?(0,s.jsx)(v.A,{}):t||(0,s.jsx)(x.A,{}),...i})})})};var j=t(50128),A=t(20418),C=t(25710),S=t(28304),L=t(83376);const{Text:E}=j.A,w=e=>{let{children:n}=e;return(0,s.jsx)(C.o,{components:{p(e){let{node:n,...t}=e;return(0,s.jsx)("p",{...t,style:{whiteSpace:"pre-wrap"}})},code(e){const{children:n,className:t,node:i,ref:l,...o}=e,a=/language-(\w+)/.exec(t||""),r=String(n).replace(/\n$/,"");return a?(0,s.jsx)(A.A,{title:(0,s.jsx)(E,{style:{fontWeight:"normal"},type:"secondary",children:a[1]}),type:"inner",size:"small",extra:(0,s.jsx)(b,{type:"text",copyable:{text:"s"}}),styles:{body:{padding:0},header:{margin:0}},children:(0,s.jsx)("div",{style:{margin:"-0.5em 0",width:"100%"},children:(0,s.jsx)(I,{ref:l,...o,PreTag:"div",language:a[1],style:L.A,wrapLongLines:!0,wrapLines:!0,children:r})})}):(0,s.jsx)("code",{...o,className:t,children:n})}},children:n})},M=e=>{let{children:n,...t}=e;return(0,s.jsx)(S.A,{...t,children:n})},I=o.memo(M),_=o.memo(w);var T=t(79429),F=t(65839),D=t(9571),K=t(69546),R=t(38385),z=t(78502),$=t.n(z),U=t(48787),B=t.n(U),V=t(2660),P=t.n(V);$().extend(B()),$().extend(P());const O=e=>{let{extra:n,message:t,placement:i="left",containerStyle:l,enableExtraHover:a,isStreaming:d}=e;const{token:u}=D.A.useToken(),[c,p]=(0,o.useState)(!1),g=(0,F.A)(t.content,{wait:50});return(0,s.jsxs)(r.A,{direction:"left"===i?"row":"row-reverse",justify:"start",align:"baseline",style:{marginLeft:"left"===i?"0":"15%",marginRight:"right"===i?"0":20,...l},gap:"sm",onMouseEnter:()=>p(!0),onMouseLeave:()=>p(!1),children:["user"!==t.role?(0,s.jsx)(K.A,{icon:"\ud83e\udd16",style:{fontSize:u.fontSizeHeading3}}):null,(0,s.jsxs)(r.A,{direction:"column",align:"left"===i?"start":"end",wrap:"wrap",style:{flex:1},gap:"xs",children:[m().map(t.experimental_attachments,((e,n)=>m().includes(null===e||void 0===e?void 0:e.contentType,"image/")?(0,s.jsx)(r.A,{style:{border:"none",textAlign:"end"},align:"end",children:(0,s.jsx)(R.A,{src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name,style:{maxWidth:"50vw",maxHeight:"12vh",borderRadius:u.borderRadius}},`${null===t||void 0===t?void 0:t.id}-${n}`)}):(0,s.jsx)(T.A.FileCard,{item:{uid:`${null===t||void 0===t?void 0:t.id}-${n}`,name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.url),type:null===e||void 0===e?void 0:e.contentType,description:null===e||void 0===e?void 0:e.name,url:null===e||void 0===e?void 0:e.url}},n))),(0,s.jsx)(r.A,{align:"stretch",direction:"column",style:{borderRadius:u.borderRadius,borderColor:u.colorBorderSecondary,borderWidth:u.lineWidth,padding:"1em",paddingTop:0,paddingBottom:0,backgroundColor:"user"!==t.role?u.colorBgContainer:u.colorBgContainerDisabled,maxWidth:"100%"},children:(0,s.jsx)(_,{children:g+(d?"\n\u25cf":"")})}),(0,s.jsx)(r.A,{style:{fontSize:u.fontSizeSM,...a?{opacity:c?1:0,transition:"opacity 0.2s",transitionDelay:c?"0s":"0.2s"}:{}},children:n})]})]})};var H=t(68098),Q=t(7126);const q=e=>{let{autoScroll:n,atBottom:t,lastMessageContent:i,...l}=e;const a=(0,H.E)(l.onScrollToBottom);return(0,o.useEffect)((()=>{t&&n&&(null===a||void 0===a||a("auto"))}),[t,n,i,a]),(0,s.jsx)(y.Ay,{icon:(0,s.jsx)(Q.A,{}),shape:"circle",onClick:()=>{a&&a("click")}})};var N=t(85064),W=t(2646);const X=e=>{let{messages:n,isStreaming:t}=e;const i=(0,o.useRef)(null),[l,a]=(0,o.useState)(!0),{token:d}=D.A.useToken(),u="undefined"!==typeof window?1.5*window.innerHeight:0;return(0,s.jsxs)(r.A,{direction:"column",align:"stretch",style:{height:"100%",flex:1},children:[(0,s.jsx)(W.aY,{atBottomStateChange:a,atBottomThreshold:60,computeItemKey:(e,n)=>n.id,data:n,followOutput:"auto",initialTopMostItemIndex:(null===n||void 0===n?void 0:n.length)-1,itemContent:(e,i)=>(0,s.jsx)(O,{message:i,placement:"user"===i.role?"right":"left",containerStyle:{paddingLeft:d.paddingMD,paddingRight:d.paddingMD,paddingTop:0===e?d.paddingMD:0,paddingBottom:e===n.length-1?d.paddingMD:0},isStreaming:"user"!==i.role&&t&&e===n.length-1,enableExtraHover:"user"===i.role,extra:"user"!==i.role?(0,s.jsx)(N.Ay,{children:(0,s.jsx)(b,{type:"text",size:"small",copyable:{text:i.content}})}):(0,s.jsx)(N.Ay,{children:null})},i.id),overscan:u,ref:i}),(0,s.jsx)("div",{style:{position:"absolute",right:"50%",transform:"translateX(+50%)",bottom:d.marginSM,opacity:l?0:1,transition:"opacity 0.2s",transitionDelay:l?"0s":"0.2s"},children:(0,s.jsx)(q,{atBottom:l,autoScroll:t,onScrollToBottom:e=>{const n=i.current;switch(e){case"auto":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"auto",index:"LAST"});break;case"click":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"smooth",index:"LAST"})}},lastMessageContent:m().get(m().last(n),"content")})})]})};var Y=t(34902),G=t(81340),J=t(10424),Z=t(51282),ee=t(27319),ne=t(12943),te=t(56431),ie=t(51847),le=t(61279),oe=t(79773),ae=t(9712),re=t(13170),de=t(83978),se=t(58325),ue=t(24798),ce=t(2822);const pe=e=>{var n;let{models:t=[],endpointId:c,baseURL:p,headers:h,credentials:v,apiKey:x,fetchOnClient:k,allowCustomModel:b,alert:C,leftExtra:S,inputMessage:L,submitKey:E,onInputChange:w,onSubmitChange:M,showCompareMenuItem:I,modelToken:_,...F}=e;const K=(0,l.f0)(),[R,z]=(0,o.useState)(!1),[$,U]=(0,ie.A)(F,{valuePropName:"modelId",trigger:"onModelChange",defaultValue:null===t||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id}),B=(0,o.useRef)(null),V=(0,o.useRef)(null),{messages:P,error:O,input:H,setInput:Q,stop:q,isLoading:N,append:W,setMessages:pe}=(0,G.Y_)({api:p,headers:h,credentials:v,body:{modelId:$},fetch:async(e,n)=>{if(k||"custom"===$){var t,i,l;const e=JSON.parse(null===n||void 0===n?void 0:n.body),o=(0,Y.r)({baseURL:b?null===(t=B.current)||void 0===t?void 0:t.getFieldValue("baseURL"):p,apiKey:(b?null===(i=B.current)||void 0===i?void 0:i.getFieldValue("token"):x)||"dummy"}),a=await(0,le.gM)({abortSignal:(null===n||void 0===n?void 0:n.signal)||void 0,model:o(b?null===(l=B.current)||void 0===l?void 0:l.getFieldValue("modelId"):$),messages:null===e||void 0===e?void 0:e.messages});return he(Date.now()),a.toDataStreamResponse()}return fetch(e,n)}}),{token:me}=D.A.useToken(),{t:ge}=(0,g.Bd)(),[fe,he]=(0,o.useState)(null);(0,o.useEffect)((()=>{m().isUndefined(L)||Q(L)}),[L,Q]),(0,o.useEffect)((()=>{!m().isUndefined(E)&&H&&W({role:"user",content:H})}),[E]);const ye=a(H),ve=(0,o.useMemo)((()=>m().map(P,(e=>null===e||void 0===e?void 0:e.content)).join("")),[P]),xe=ye+a(ve),ke=(0,o.useMemo)((()=>{const e=m().last(P);return"assistant"===(null===e||void 0===e?void 0:e.role)?null===e||void 0===e?void 0:e.content:""}),[P]),be=a(ke),je=(0,o.useMemo)((()=>be>0&&fe?be/((Date.now()-fe)/1e3):0),[be,fe]),[Ae,Ce]=(0,o.useState)([]),Se=(0,i.LY)([I&&{key:"compare",label:ge("chatui.CompareWithOtherModels"),icon:(0,s.jsx)(ce.A,{}),onClick:()=>{K(`/serving?tab=chatting&endpointId=${c}&modelId=${$}`)}},I&&{type:"divider"},{key:"clear",danger:!0,label:ge("chatui.DeleteChatHistory"),icon:(0,s.jsx)(J.A,{}),onClick:()=>{pe([])}}]);return(0,s.jsxs)(A.A,{ref:V,bordered:!0,extra:[],...F,title:(0,s.jsx)(r.A,{direction:"column",align:"stretch",gap:"sm",children:(0,s.jsxs)(r.A,{direction:"row",gap:"xs",children:[S,(0,s.jsx)(f,{models:t,value:$,onChange:U,allowCustomModel:b}),(0,s.jsx)(oe.A,{menu:{items:Se},trigger:["click"],children:(0,s.jsx)(y.Ay,{type:"link",onClick:e=>e.preventDefault(),icon:(0,s.jsx)(Z.A,{}),style:{color:me.colorTextSecondary,width:me.sizeMS}})})]})}),style:{height:"100%",width:"100%",display:"flex",flexDirection:"column"},styles:{body:{backgroundColor:me.colorFillQuaternary,borderRadius:0,flex:1,display:"flex",flexDirection:"column",padding:0,height:"50%",position:"relative"},actions:{paddingLeft:me.paddingContentHorizontal,paddingRight:me.paddingContentHorizontal},header:{zIndex:1}},actions:[(0,s.jsx)(u,{autoFocus:!0,value:H,placeholder:"Say something...",header:(0,s.jsx)(d.A.Header,{closable:!1,title:ge("chatui.Attachments"),open:!!R&&!m().isEmpty(Ae),onOpenChange:z,styles:{content:{padding:0}},children:(0,s.jsx)(T.A,{beforeUpload:()=>!1,getDropContainer:()=>V.current,accept:"image/*,text/*",items:Ae,onChange:e=>{let{fileList:n}=e;return Ce(n)},placeholder:e=>"drop"===e?{title:ge("chatui.DropFileHere")}:{icon:(0,s.jsx)(ee.A,{}),title:ge("chatui.UploadFiles"),description:ge("chatui.UploadFilesDescription")}})}),prefix:(0,s.jsx)(T.A,{beforeUpload:()=>!1,getDropContainer:()=>V.current,accept:"image/*,text/*",items:Ae,onChange:e=>{let{fileList:n}=e;Ce(n),z(!0)},placeholder:e=>"drop"===e?{title:ge("chatui.DropFileHere")}:{icon:(0,s.jsx)(ee.A,{}),title:ge("chatui.UploadFiles"),description:ge("chatui.UploadFilesDescription")},children:(0,s.jsx)(ae.A,{dot:!m().isEmpty(Ae)&&!R,children:(0,s.jsx)(y.Ay,{type:"text",icon:(0,s.jsx)(ne.A,{})})})}),onChange:e=>{Q(e),w&&w(e)},loading:N,onStop:()=>{q()},onSend:()=>{if(H||!m().isEmpty(Ae)){const e=m().map(Ae,(e=>e.originFileObj)),n=m().filter(e,Boolean),t=new DataTransfer;m().forEach(n,(e=>{t.items.add(e)})),W({role:"user",content:H},{experimental_attachments:t.files}),setTimeout((()=>{Q(""),Ce([]),z(!1)}),0),null===M||void 0===M||M()}},style:{flex:1}})],children:[(0,s.jsx)(r.A,{direction:"row",style:{padding:me.paddingSM,paddingRight:me.paddingContentHorizontalLG,paddingLeft:me.paddingContentHorizontalLG,backgroundColor:me.colorBgContainer,display:b&&"custom"===$?"flex":"none"},children:(0,s.jsxs)(re.A,{ref:B,layout:"horizontal",size:"small",requiredMark:"optional",style:{flex:1},initialValues:{baseURL:p,token:_},children:[C?(0,s.jsx)("div",{style:{marginBottom:me.size},children:C}):null,(0,s.jsx)(re.A.Item,{label:"baseURL",name:"baseURL",rules:[{type:"url"},{required:!0}],children:(0,s.jsx)(de.A,{placeholder:"https://domain/v1"})}),(0,s.jsx)(re.A.Item,{label:"Model ID",name:"modelId",rules:[{required:!0}],children:(0,s.jsx)(de.A,{placeholder:"llm-model"})}),(0,s.jsx)(re.A.Item,{label:"Token",name:"token",children:(0,s.jsx)(de.A,{})})]},p)}),m().isEmpty(null===O||void 0===O?void 0:O.message)?null:(0,s.jsx)(se.A,{message:null===O||void 0===O?void 0:O.message,type:"error",showIcon:!0,style:{margin:me.marginSM},closable:!0}),(0,s.jsx)(X,{messages:P,isStreaming:N}),(0,s.jsx)(r.A,{justify:"end",align:"end",style:{margin:me.marginSM},children:(0,s.jsx)(ue.A,{children:(0,s.jsxs)(r.A,{gap:"xs",children:[(0,s.jsx)(te.A,{}),(0,s.jsxs)(r.A,{gap:"xxs",children:[(0,s.jsx)(j.A.Text,{children:je.toFixed(2)}),(0,s.jsx)(j.A.Text,{type:"secondary",children:"tok/s"})]}),(0,s.jsxs)(r.A,{gap:"xxs",children:[(0,s.jsx)(j.A.Text,{children:xe}),(0,s.jsx)(j.A.Text,{type:"secondary",children:"total tokens"})]})]})})})]})}},56131:(e,n,t)=>{t.r(n),t.d(n,{default:()=>U});var i,l=t(72338),o=t(23441),a=t(73e3),r=t(51847),d=t(1581),s=t(46976),u=t.n(s),c=t(53350),p=t(22018),m=t(60598);const g=e=>{let{fetchKey:n,lifecycleStageFilter:l=["created"],loading:a,...s}=e;const g=(0,o.CX)(),[f,h]=(0,r.A)(s),[y,v]=(0,c.useState)(),[x,k]=(0,c.useTransition)(),b=l.map((e=>`lifecycle_stage == "${e}"`)).join(" | "),{endpoint_list:j,endpoint:A}=(0,p.useLazyLoadQuery)(void 0!==i?i:i=t(90003),{limit:10,offset:0,filter:g.supports("endpoint-lifecycle-stage-filter")?[b,y].filter(Boolean).map((e=>`(${e})`)).join(" & "):void 0,endpoint_id:f,skipEndpoint:!f},{fetchKey:n}),C=A?u().map(u().uniqBy(u().concat(null===j||void 0===j?void 0:j.items,A),"endpoint_id"),(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e}))):u().map(null===j||void 0===j?void 0:j.items,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e})));return(0,m.jsx)(d.A,{showSearch:!0,onSearch:e=>{k((()=>{v(e&&`name ilike "%${e}%"`)}))},filterOption:!1,loading:x||a,options:C,...s,value:f,onChange:(e,n)=>{var t;h(e,null===(t=u().castArray(n))||void 0===t?void 0:t[0].endpoint)}})};var f,h=t(46735),y=t(59203),v=t(43622),x=t(9571),k=t(24034),b=t(52335),j=t(58325),A=t(21110),C=t(7322),S=t(91788);const L=(0,A.eU)(""),E=(0,A.eU)(void 0),w=e=>{var n,i,l,r;let{basePath:d="v1",closable:s,defaultModelId:A,defaultEndpoint:w,isSynchronous:M,onRequestClose:I,onModelChange:_,...T}=e;const{t:F}=(0,S.Bd)(),{token:D}=x.A.useToken(),[K,R]=(0,o.Tw)("first"),[z,$]=(0,c.useState)(w||null),U=(0,p.useFragment)(void 0!==f?f:f=t(67646),z),[B,V]=(0,c.useState)(U),[P,O]=(0,C.fp)(L),[H,Q]=(0,C.fp)(E),{data:q}=(0,a.nj)({queryKey:["models",K,null===U||void 0===U?void 0:U.endpoint_id],queryFn:()=>{var e;return null!==U&&void 0!==U&&U.url?fetch(new URL(d+"/models",null!==(e=null===U||void 0===U?void 0:U.url)&&void 0!==e?e:void 0).toString()).then((e=>e.json())).catch((e=>({data:[]}))):Promise.resolve({data:[]})}}),N=u().map(null===q||void 0===q?void 0:q.data,(e=>({id:e.id,name:e.id}))),W=(0,c.useId)();return(0,m.jsx)(h.A,{...T,baseURL:null!==U&&void 0!==U&&U.url?new URL(d,null!==(n=null===U||void 0===U?void 0:U.url)&&void 0!==n?n:void 0).toString():void 0,models:N,fetchOnClient:!0,leftExtra:(0,m.jsx)(g,{placeholder:F("chatui.SelectEndpoint"),style:{fontWeight:"normal"},fetchKey:K,showSearch:!0,loading:(null===B||void 0===B?void 0:B.endpoint_id)!==(null===U||void 0===U?void 0:U.endpoint_id),onChange:(e,n)=>{V(n),(0,c.startTransition)((()=>{$(n)}))},value:null===U||void 0===U?void 0:U.endpoint_id,popupMatchSelectWidth:!1}),modelId:A&&u().includes(u().map(null===q||void 0===q?void 0:q.data,"id"),A)?A:null!==(i=null===q||void 0===q||null===(l=q.data)||void 0===l||null===(r=l[0])||void 0===r?void 0:r.id)&&void 0!==i?i:"custom",extra:s?(0,m.jsx)(k.A,{title:F("chatui.DeleteChattingSession"),description:F("chatui.DeleteChattingSessionDescription"),onConfirm:()=>{null===I||void 0===I||I()},okText:F("button.Delete"),okButtonProps:{danger:!0},children:(0,m.jsx)(b.Ay,{icon:(0,m.jsx)(y.A,{}),type:"text",style:{color:D.colorIcon}})}):void 0,allowCustomModel:u().isEmpty(N),alert:u().isEmpty(N)&&(0,m.jsx)(j.A,{type:"warning",showIcon:!0,message:F("chatui.CannotFindModel"),action:(0,m.jsx)(b.Ay,{icon:(0,m.jsx)(v.A,{}),onClick:()=>{R()},children:F("button.Refresh")})}),inputMessage:M?P:void 0,onInputChange:e=>{O(e)},submitKey:(null===H||void 0===H?void 0:H.id)===W||null===H||void 0===H?void 0:H.key,onSubmitChange:()=>{O(""),M&&Q({id:W,key:(new Date).toString()})}})};var M=t(53051),I=t(92509),_=t(51146);const T=function(e){void 0===e&&(e=[]);var n=(0,c.useRef)(-1),t=(0,c.useRef)([]),i=(0,c.useCallback)((function(e){n.current+=1,t.current.splice(e,0,n.current)}),[]),l=(0,I.zs)((0,c.useState)((function(){return e.forEach((function(e,n){i(n)})),e})),2),o=l[0],a=l[1],r=(0,c.useCallback)((function(e){t.current=[],a((function(){return e.forEach((function(e,n){i(n)})),e}))}),[]),d=(0,c.useCallback)((function(e,n){a((function(t){var l=(0,I.fX)([],(0,I.zs)(t),!1);return l.splice(e,0,n),i(e),l}))}),[]),s=(0,c.useCallback)((function(e){return t.current[e]}),[]),u=(0,c.useCallback)((function(e){return t.current.findIndex((function(n){return n===e}))}),[]),p=(0,c.useCallback)((function(e,n){a((function(t){var l=(0,I.fX)([],(0,I.zs)(t),!1);return n.forEach((function(n,t){i(e+t)})),l.splice.apply(l,(0,I.fX)([e,0],(0,I.zs)(n),!1)),l}))}),[]),m=(0,c.useCallback)((function(e,n){a((function(t){var i=(0,I.fX)([],(0,I.zs)(t),!1);return i[e]=n,i}))}),[]),g=(0,c.useCallback)((function(e){a((function(n){var i=(0,I.fX)([],(0,I.zs)(n),!1);i.splice(e,1);try{t.current.splice(e,1)}catch(l){console.error(l)}return i}))}),[]),f=(0,c.useCallback)((function(e){Array.isArray(e)?e.length&&a((function(n){var i=[],l=n.filter((function(n,t){var l=!e.includes(t);return l&&i.push(s(t)),l}));return t.current=i,l})):_.A&&console.error('`indexes` parameter of `batchRemove` function expected to be an array, but got "'.concat(typeof e,'".'))}),[]),h=(0,c.useCallback)((function(e,n){e!==n&&a((function(i){var l=(0,I.fX)([],(0,I.zs)(i),!1),o=l.filter((function(n,t){return t!==e}));o.splice(n,0,l[e]);try{var a=t.current.filter((function(n,t){return t!==e}));a.splice(n,0,t.current[e]),t.current=a}catch(r){console.error(r)}return o}))}),[]),y=(0,c.useCallback)((function(e){a((function(n){return i(n.length),n.concat([e])}))}),[]),v=(0,c.useCallback)((function(){try{t.current=t.current.slice(0,t.current.length-1)}catch(e){console.error(e)}a((function(e){return e.slice(0,e.length-1)}))}),[]),x=(0,c.useCallback)((function(e){a((function(n){return i(0),[e].concat(n)}))}),[]),k=(0,c.useCallback)((function(){try{t.current=t.current.slice(1,t.current.length)}catch(e){console.error(e)}a((function(e){return e.slice(1,e.length)}))}),[]),b=(0,c.useCallback)((function(e){return e.map((function(e,n){return{key:n,item:e}})).sort((function(e,n){return u(e.key)-u(n.key)})).filter((function(e){return!!e.item})).map((function(e){return e.item}))}),[]);return{list:o,insert:d,merge:p,replace:m,remove:g,batchRemove:f,getKey:s,getIndex:u,move:h,push:y,pop:v,unshift:x,shift:k,sortList:b,resetList:r}};var F,D=t(50128),K=t(77109),R=t(20418),z=t(91867),$=t(32043);const U=e=>{let{...n}=e;const{token:i}=x.A.useToken(),{t:o}=(0,S.Bd)(),{list:a,remove:r,getKey:d,push:s}=T(["0","1"]),[g,f]=(0,c.useState)(!1),[h]=(0,$.useQueryParam)("endpointId",$.StringParam),[y]=(0,$.useQueryParam)("modelId",$.StringParam),v=!h,{endpoint:k,endpoint_list:j}=(0,p.useLazyLoadQuery)(void 0!==F?F:F=t(52965),{endpointId:h||"",isEmptyEndpointId:v});return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(l.A,{direction:"column",align:"stretch",children:[(0,m.jsxs)(l.A,{direction:"row",justify:"between",wrap:"wrap",gap:"xs",style:{padding:i.paddingContentVertical,paddingLeft:i.paddingContentHorizontalSM,paddingRight:i.paddingContentHorizontalSM},children:[(0,m.jsx)(l.A,{direction:"column",align:"start",children:(0,m.jsx)(D.A.Text,{style:{margin:0,padding:0},children:"LLM Playground"})}),(0,m.jsx)(l.A,{direction:"row",gap:"xs",wrap:"wrap",style:{flexShrink:1},children:(0,m.jsxs)(l.A,{gap:"xs",children:[(0,m.jsx)(D.A.Text,{type:"secondary",children:o("chatui.SyncInput")}),(0,m.jsx)(K.A,{value:g,onClick:e=>{f(e)}}),(0,m.jsx)(b.Ay,{onClick:()=>{s((new Date).toString())},icon:(0,m.jsx)(M.A,{})})]})})]}),(0,m.jsx)(l.A,{gap:"xs",direction:"row",style:{margin:i.margin,marginTop:0,overflow:"auto",height:"calc(100vh - 215px)"},align:"stretch",children:u().map(a,((e,n)=>{var t;return(0,m.jsx)(c.Suspense,{fallback:(0,m.jsx)(R.A,{bordered:!0,style:{width:"100%",display:"flex",flexDirection:"column"},children:(0,m.jsx)(z.A,{active:!0})}),children:(0,m.jsx)(w,{defaultModelId:0===n&&k&&y?y:void 0,defaultEndpoint:0===n&&k?k:(null===j||void 0===j||null===(t=j.items)||void 0===t?void 0:t[0])||void 0,style:{flex:1},onRequestClose:()=>{r(n)},closable:a.length>1,isSynchronous:g},d(n))},d(n))}))})]})})}},67646:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointLLMChatCard_endpoint",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"d5fbaab35efda649f9f7847ee51028b6"},l=i},52965:(e,n,t)=>{t.r(n),t.d(n,{default:()=>l});const i=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpointId"},{defaultValue:null,kind:"LocalArgument",name:"isEmptyEndpointId"}],n=[{kind:"Variable",name:"endpoint_id",variableName:"endpointId"}],t=[{args:null,kind:"FragmentSpread",name:"EndpointLLMChatCard_endpoint"}],i=[{kind:"Literal",name:"limit",value:1},{kind:"Literal",name:"offset",value:0}],l=[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"LLMPlaygroundPageQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:t,storageKey:null},{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:t,storageKey:null}],storageKey:"endpoint_list(limit:1,offset:0)"}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"LLMPlaygroundPageQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:l,storageKey:null},{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:l,storageKey:null}],storageKey:"endpoint_list(limit:1,offset:0)"}]},params:{cacheID:"2666fd687919647b3aaa7f1d6cda6662",id:null,metadata:{},name:"LLMPlaygroundPageQuery",operationKind:"query",text:"query LLMPlaygroundPageQuery(\n  $endpointId: UUID!\n  $isEmptyEndpointId: Boolean!\n) {\n  endpoint(endpoint_id: $endpointId) @skipOnClient(if: $isEmptyEndpointId) {\n    ...EndpointLLMChatCard_endpoint\n    id\n  }\n  endpoint_list(limit: 1, offset: 0) {\n    items {\n      ...EndpointLLMChatCard_endpoint\n      id\n    }\n  }\n}\n\nfragment EndpointLLMChatCard_endpoint on Endpoint {\n  endpoint_id\n  url\n}\n"}}}();i.hash="ebf5c41c874617edc639e99afe6789d2";const l=i},51847:(e,n,t)=>{t.d(n,{A:()=>d});var i=t(92509),l=t(53350),o=t(66413),a=t(7447);const r=function(){var e=(0,i.zs)((0,l.useState)({}),2)[1];return(0,l.useCallback)((function(){return e({})}),[])};const d=function(e,n){void 0===e&&(e={}),void 0===n&&(n={});var t=n.defaultValue,d=n.defaultValuePropName,s=void 0===d?"defaultValue":d,u=n.valuePropName,c=void 0===u?"value":u,p=n.trigger,m=void 0===p?"onChange":p,g=e[c],f=Object.prototype.hasOwnProperty.call(e,c),h=(0,l.useMemo)((function(){return f?g:Object.prototype.hasOwnProperty.call(e,s)?e[s]:t}),[]),y=(0,l.useRef)(h);f&&(y.current=g);var v=r();return[y.current,(0,a.A)((function(n){for(var t=[],l=1;l<arguments.length;l++)t[l-1]=arguments[l];var a=(0,o.Tn)(n)?n(y.current):n;f||(y.current=a,v()),e[m]&&e[m].apply(e,(0,i.fX)([a],(0,i.zs)(t),!1))}))]}}}]);
//# sourceMappingURL=6131.a03c298a.chunk.js.map