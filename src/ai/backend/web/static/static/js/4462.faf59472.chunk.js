/*! For license information please see 4462.faf59472.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[4462],{98401:(e,n,l)=>{l.d(n,{A:()=>d});var t=l(89130),a=l(15934),r=l(89608),i=l.n(r),o=l(43373),s=l(73689);const d=e=>{let n,{values:l=[]}=e;return 0===l.length?null:(n=l[0]&&("string"===typeof l[0]||o.isValidElement(l[0]))?l.map((e=>({label:e,color:"blue"}))):l,(0,s.jsx)(t.A,{direction:"row",children:i().map(n,((e,l)=>(0,s.jsx)(a.A,{style:i().last(n)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:e.label},l)))}))}},40471:(e,n,l)=>{l.d(n,{A:()=>g});var t=l(58879),a=l(7194),r=l(27666),i=l(86917),o=l(69056),s=l(85690),d=l(89608),u=l.n(d),c=l(43373),m=l(73689);const g=e=>{let{dynamicSteps:n=[1,2,4,8,16,32,64,128,256,512],units:l=["m","g","t","p"],disableAutoUnit:d=!1,min:g="0m",max:v="300p",roundStep:p,...y}=e;const[h,x]=(0,a.A)(y,{defaultValue:"0g"}),[f,b]=null===h||void 0===h?[null,null]:(0,t.E8)(h),k=(0,r.A)(b),A=b||k||l[0],[j,S]=(0,t.E8)(g),[_,I]=(0,t.E8)(v),M=(0,c.useRef)(null);return(0,c.useEffect)((()=>{if(M.current){const e=e=>{var n;const l=null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value;/^\d+(g|m)$/.test(l)&&x(l)},n=M.current;return null===n||void 0===n||n.addEventListener("input",e),()=>{null===n||void 0===n||n.removeEventListener("input",e)}}}),[M,f,b,x]),(0,m.jsx)(i.A,{ref:M,...y,onBlur:()=>{if(u().isNumber(p)&&p>0){var e,n,l;const t=(null===(e=p.toString().split(".")[1])||void 0===e?void 0:e.length)||0;if(isNaN(Math.round(u().toNumber((null===(n=M.current)||void 0===n?void 0:n.value)||"0")/p)*p))return;x(`${(Math.round(u().toNumber((null===(l=M.current)||void 0===l?void 0:l.value)||"0")/p)*p).toFixed(t)}${A}`)}},value:f,onChange:e=>{x(null===e||void 0===e?e:`${e}${A}`)},max:I===A?_:(0,t.Js)(v,A).number,min:S===A?j:(0,t.Js)(g,A).number,addonAfter:(0,m.jsx)(o.A,{tabIndex:-1,value:A,onChange:e=>{x(`${f}${e}`)},onDropdownVisibleChange:e=>{(e&&null===h||void 0===h)&&x(`0${A}`)},options:u().map(l,(e=>({value:e,label:(0,m.jsx)(s.A.Text,{style:{fontFamily:"'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace"},children:e.toUpperCase()+"iB"})}))),suffixIcon:l.length>1?void 0:null,open:l.length>1&&void 0,style:{cursor:l.length>1?void 0:"default"}}),step:0,onStep:(e,t)=>{const a=u().isNull(f)||u().isUndefined(f)?0:f,r=u().sortedIndex(u().sortBy(n),a);let i;i="up"===t.type?a===n[r]?r+1:r:r-1;const o=l.indexOf(A);if(!d&&i<0)if(0===o)x(`0${A}`);else{const e=n[n.length-1],t=l[o-1];x(`${e}${t}`)}else if(!d&&i>n.length-1)if(o===l.length-1)x(`${a+("up"===t.type?1:-1)}${I}`);else{const e=n[0],t=l[o+1];x(`${e}${t}`)}else if(i>=0&&i<n.length){let e=n[i];S===A&&e<j?e=j:I===A&&e>_&&(e=_),x(`${e}${A}`)}}})}},69715:(e,n,l)=>{l.d(n,{Ay:()=>h,Kk:()=>v,p3:()=>p,sT:()=>m,vB:()=>c});var t=l(51593),a=l(98401),r=l(89130),i=l(6597),o=l(15934),s=l(43373),d=l(73689);const u=e=>{let{image:n,...l}=e;n=n||"";const[,{getImageAliasName:r,getBaseVersion:i,tagAlias:o}]=(0,t.Gj)();return(0,d.jsx)(a.A,{values:[{label:o(r(n)),color:"blue"},{label:i(n),color:"green"}],...l})},c=e=>{let{image:n,...l}=e;n=n||"";const[,{getBaseVersion:a,tagAlias:r}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...l,children:r(a(n))})},m=e=>{let{image:n,...l}=e;n=n||"";const[,{getBaseImage:a,tagAlias:r}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...l,children:r(a(n))})},g=e=>{let{image:n,...l}=e;n=n||"";const[,{getArchitecture:a,tagAlias:r}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...l,children:r(a(n))})},v=e=>{let{image:n,...l}=e;n=n||"";const[,{getImageLang:a,tagAlias:r}]=(0,t.Gj)();return(0,d.jsx)(o.A,{color:"green",...l,children:r(a(n))})},p=e=>{let{tag:n,labels:l,highlightKeyword:s,...u}=e;l=l||[];const[,{getConstraints:c}]=(0,t.Gj)(),m=c(n,l);return(0,d.jsxs)(r.A,{direction:"row",align:"start",children:[m[0]?(0,d.jsx)(o.A,{color:"blue",...u,children:(0,d.jsx)(i.A,{keyword:s,children:m[0]})}):null,m[1]?(0,d.jsx)(a.A,{color:"cyan",values:[{label:(0,d.jsx)(i.A,{keyword:s,children:"Customized"}),color:"cyan"},{label:(0,d.jsx)(i.A,{keyword:s,children:m[1]}),color:"cyan"}],...u}):null]})},y=(e,n)=>{let{image:l,style:t={}}=e;return l=l||"",(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u,{image:l}),(0,d.jsx)(m,{image:l}),(0,d.jsx)(g,{image:l})]})},h=s.memo(y)},76604:(e,n,l)=>{l.d(n,{A:()=>x,s:()=>h});var t=l(58879),a=l(11899),r=l(15634),i=l(89130),o=l(50868),s=l(85690),d=l(33789),u=l(89608),c=l.n(u),m=l(8652),g=l(43373),v=l(73689);const p=e=>{var n,l;let{type:d,value:u,extra:m,opts:g,hideTooltip:p=!1,max:y}=e;const{token:x}=o.A.useToken(),f=(0,r.Nw)(),{mergedResourceSlots:b}=(0,a.Hv)(f||void 0),k=e=>{var n,l,a;return null!==b&&void 0!==b&&null!==(n=b[d])&&void 0!==n&&n.number_format.binary?Number(null===(l=(0,t.Js)(e,"g",3,!0))||void 0===l?void 0:l.numberFixed).toString():((null===b||void 0===b||null===(a=b[d])||void 0===a?void 0:a.number_format.round_length)||0)>0?parseFloat(e).toFixed(2):e};return(0,v.jsxs)(i.A,{direction:"row",gap:"xxs",children:[null!==b&&void 0!==b&&b[d]?(0,v.jsx)(h,{type:d,showTooltip:!p}):d,(0,v.jsxs)(s.A.Text,{children:[k(u),c().isUndefined(y)?null:"Infinity"===y?"~\u221e":`~${k(y)}`]}),(0,v.jsx)(s.A.Text,{type:"secondary",children:(null===b||void 0===b||null===(n=b[d])||void 0===n?void 0:n.display_unit)||""}),"mem"===d&&null!==g&&void 0!==g&&g.shmem&&(null===g||void 0===g?void 0:g.shmem)>0?(0,v.jsxs)(s.A.Text,{type:"secondary",style:{fontSize:x.fontSizeSM},children:["(SHM: ",null===(l=(0,t.Js)(g.shmem+"b","g",2,!0))||void 0===l?void 0:l.numberFixed,"GiB)"]}):null,m]})},y=e=>{let{size:n=16,children:l}=e;return(0,v.jsx)("mwc-icon",{style:{"--mdc-icon-size":`${n+2}px`,width:n,height:n},children:l})},h=e=>{var n;let{type:l,size:t=16,showIcon:a=!0,showUnit:r=!0,showTooltip:o=!0,...s}=e;const u={cpu:(0,v.jsx)(y,{size:t,children:"developer_board"}),mem:(0,v.jsx)(y,{size:t,children:"memory"}),"cuda.device":"/resources/icons/file_type_cuda.svg","cuda.shares":"/resources/icons/file_type_cuda.svg","rocm.device":"/resources/icons/rocm.svg","tpu.device":(0,v.jsx)(y,{size:t,children:"view_module"}),"ipu.device":(0,v.jsx)(y,{size:t,children:"view_module"}),"atom.device":"/resources/icons/rebel.svg","atom-plus.device":"/resources/icons/rebel.svg","gaudi2.device":"/resources/icons/gaudi.svg","warboy.device":"/resources/icons/furiosa.svg","hyperaccel-lpu.device":"/resources/icons/npu_generic.svg"},c=null!==(n=u[l])&&void 0!==n?n:(0,v.jsx)(m.A,{}),g="string"===typeof c?(0,v.jsx)("img",{...s,style:{height:t,alignSelf:"center",...s.style||{}},src:u[l]||"",alt:l}):(0,v.jsx)(i.A,{style:{width:16,height:16},children:c||l});return o?(0,v.jsx)(d.A,{title:l,children:g}):(0,v.jsx)(i.A,{style:{pointerEvents:"none"},children:g})},x=g.memo(p)},35987:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t=function(){var e={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},n=[{alias:null,args:null,concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[e,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ImageListQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ImageListQuery",selections:n},params:{cacheID:"a9b21b0f0f396926cf1af9e794ec4c1d",id:null,metadata:{},name:"ImageListQuery",operationKind:"query",text:"query ImageListQuery {\n  images {\n    id\n    name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    labels {\n      key\n      value\n    }\n    humanized_name\n    resource_limits {\n      key\n      min\n      max\n    }\n  }\n}\n"}}}();t.hash="0881e461c1e3dc480359bc4af37042dc";const a=t},36751:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t=function(){var e={defaultValue:null,kind:"LocalArgument",name:"architecture"},n={defaultValue:null,kind:"LocalArgument",name:"props"},l={defaultValue:null,kind:"LocalArgument",name:"target"},t=[{alias:null,args:[{kind:"Variable",name:"architecture",variableName:"architecture"},{kind:"Variable",name:"props",variableName:"props"},{kind:"Variable",name:"target",variableName:"target"}],concreteType:"ModifyImage",kind:"LinkedField",name:"modify_image",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n,l],kind:"Fragment",metadata:null,name:"ManageAppsModalMutation",selections:t,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,e,n],kind:"Operation",name:"ManageAppsModalMutation",selections:t},params:{cacheID:"b7a57119037085ec9f08346991633e0a",id:null,metadata:{},name:"ManageAppsModalMutation",operationKind:"mutation",text:"mutation ManageAppsModalMutation(\n  $target: String!\n  $architecture: String\n  $props: ModifyImageInput!\n) {\n  modify_image(target: $target, architecture: $architecture, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();t.hash="bb280196745e96f5c488d1d785a5b012";const a=t},28499:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t=function(){var e={defaultValue:null,kind:"LocalArgument",name:"architecture"},n={defaultValue:null,kind:"LocalArgument",name:"props"},l={defaultValue:null,kind:"LocalArgument",name:"target"},t=[{alias:null,args:[{kind:"Variable",name:"architecture",variableName:"architecture"},{kind:"Variable",name:"props",variableName:"props"},{kind:"Variable",name:"target",variableName:"target"}],concreteType:"ModifyImage",kind:"LinkedField",name:"modify_image",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n,l],kind:"Fragment",metadata:null,name:"ManageImageResourceLimitModalMutation",selections:t,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,e,n],kind:"Operation",name:"ManageImageResourceLimitModalMutation",selections:t},params:{cacheID:"b4c4a5b17c6aa265df64e4d2d6338684",id:null,metadata:{},name:"ManageImageResourceLimitModalMutation",operationKind:"mutation",text:"mutation ManageImageResourceLimitModalMutation(\n  $target: String!\n  $architecture: String\n  $props: ModifyImageInput!\n) {\n  modify_image(target: $target, architecture: $architecture, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();t.hash="491b6e500587a3630195d9025ef76f29";const a=t},10791:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"DeleteResourcePreset",kind:"LinkedField",name:"delete_resource_preset",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ResourcePresetListDeleteMutation",selections:n,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ResourcePresetListDeleteMutation",selections:n},params:{cacheID:"66d1ae4fe23653f392529fb39e2e61f2",id:null,metadata:{},name:"ResourcePresetListDeleteMutation",operationKind:"mutation",text:"mutation ResourcePresetListDeleteMutation(\n  $name: String!\n) {\n  delete_resource_preset(name: $name) {\n    ok\n    msg\n  }\n}\n"}}}();t.hash="99b502a95d31e84e4de261e06fb89915";const a=t},82045:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t=function(){var e={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},n={alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetListQuery",selections:[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[e,n,l,{args:null,kind:"FragmentSpread",name:"ResourcePresetSettingModalFragment"}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ResourcePresetListQuery",selections:[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[e,n,l],storageKey:null}]},params:{cacheID:"f8093b3bde88909fa6f5ab7fdf92dcb0",id:null,metadata:{},name:"ResourcePresetListQuery",operationKind:"query",text:"query ResourcePresetListQuery {\n  resource_presets {\n    name\n    resource_slots\n    shared_memory\n    ...ResourcePresetSettingModalFragment\n  }\n}\n\nfragment ResourcePresetSettingModalFragment on ResourcePreset {\n  name\n  resource_slots\n  shared_memory\n}\n"}}}();t.hash="d720729122a85e155a7f334eba9156fc";const a=t},87941:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"},{defaultValue:null,kind:"LocalArgument",name:"props"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"CreateResourcePreset",kind:"LinkedField",name:"create_resource_preset",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ResourcePresetSettingModalCreateMutation",selections:n,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ResourcePresetSettingModalCreateMutation",selections:n},params:{cacheID:"4c6d8ef938cb69d5336e86c9d7fca415",id:null,metadata:{},name:"ResourcePresetSettingModalCreateMutation",operationKind:"mutation",text:"mutation ResourcePresetSettingModalCreateMutation(\n  $name: String!\n  $props: CreateResourcePresetInput!\n) {\n  create_resource_preset(name: $name, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();t.hash="6d3e941d6668ba2fda013fa61adb004d";const a=t},69674:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetSettingModalFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null}],type:"ResourcePreset",abstractKey:null,hash:"e0519643146e095e7a6ac81fee9d922a"},a=t},10275:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"},{defaultValue:null,kind:"LocalArgument",name:"props"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"},{kind:"Variable",name:"props",variableName:"props"}],concreteType:"ModifyResourcePreset",kind:"LinkedField",name:"modify_resource_preset",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ResourcePresetSettingModalModifyMutation",selections:n,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ResourcePresetSettingModalModifyMutation",selections:n},params:{cacheID:"8096f8cb30e3ac68ed767977d4f44061",id:null,metadata:{},name:"ResourcePresetSettingModalModifyMutation",operationKind:"mutation",text:"mutation ResourcePresetSettingModalModifyMutation(\n  $name: String!\n  $props: ModifyResourcePresetInput!\n) {\n  modify_resource_preset(name: $name, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();t.hash="80ba55bd668ca590b31674b9b0c280ed";const a=t},40478:(e,n,l)=>{l.d(n,{A:()=>u});var t=l(33789),a=l(60822),r=l(24914),i=l(10361),o=l(43373),s=l(48401),d=l(73689);const u=e=>{let{copyable:n,defaultIcon:l,...u}=e;const[c,m]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{if(c){const e=setTimeout((()=>{m(!1)}),2e3);return()=>clearTimeout(e)}}),[c]),(0,d.jsx)(t.A,{title:c?"Copied!":"Copy",open:!!c||void 0,children:(0,d.jsx)(s.CopyToClipboard,{text:(null===n||void 0===n?void 0:n.text)||"",onCopy:async()=>{m(!0)},children:(0,d.jsx)(a.Ay,{icon:c?(0,d.jsx)(r.A,{}):l||(0,d.jsx)(i.A,{}),...u})})})}},34462:(e,n,l)=>{l.r(n),l.d(n,{default:()=>fe});var t=l(4703),a=l(55182),r=l(89130),i=l(58879),o=l(51593),s=l(3643),d=l(34357),u=l(94126),c=l(29546),m=l(56762),g=l(73689);const v=e=>{let{onRequestClose:n,selectedRows:l,setInstallingImages:t,...a}=e;const{t:i}=(0,m.Bd)(),v=(0,o.CX)(),{upsertNotification:p}=(0,s.js)(),y=(0,d.b)();if(!a.open)return null;const{imagesToInstall:h,hasInstalledImage:x}=(()=>{let e=!1;return{imagesToInstall:l.filter((n=>(n.installed&&(e=!0),!n.installed))),hasInstalledImage:e}})();return(0,g.jsx)(u.A,{...a,destroyOnClose:!0,maskClosable:!1,onCancel:()=>n(),title:i("environment.CheckImageInstallation"),okText:i("environment.Install"),onOk:()=>{n();const e=h.map((async e=>{var n;const l=(null===e||void 0===e?void 0:e.registry)+"/"+(null===e||void 0===e?void 0:e.name)+":"+(null===e||void 0===e?void 0:e.tag);let t=!1;const a={};null===e||void 0===e||null===(n=e.resource_limits)||void 0===n||n.forEach((e=>{const n=null===e||void 0===e?void 0:e.key;a[n]=null===e||void 0===e?void 0:e.min})),"cuda.device"in a&&" cuda.shares"in a?(t=!0,a.gpu=0,a.fgpu=a["cuda.shares"]):"cuda.device"in a?(a.gpu=a["cuda.device"],t=!0):t=!1,a.mem.endsWith("g")?a.mem=a.mem.replace("g",".5g"):a.mem.endsWith("m")&&(a.mem=Number(a.mem.slice(0,-1))+256+"m"),a.domain=v._config.domainName,a.group_name=v.current_group;const r=await v.get_resource_slots();t&&("cuda.device"in r||"cuda.shares"in r||(delete a.gpu,delete a.fgpu,delete a["cuda.shares"],delete a["cuda.device"])),"cuda.device"in r&&"cuda.shares"in r?"fgpu"in a&&"gpu"in a&&(delete a.gpu,delete a["cuda.device"]):"cuda.device"in r?(delete a.fgpu,delete a["cuda.shares"]):"cuda.shares"in r&&(delete a.gpu,delete a["cuda.device"]),a.enqueueOnly=!0,a.type="batch",a.startupCommand='echo "Image is installed"',p({message:`${i("environment.InstallingImage")}${l}${i("environment.TakesTime")}`,open:!0,duration:2});const o=await globalThis.lablupIndicator.start("indeterminate");o.set(10,i("import.Downloading"));try{return await v.image.install(l,null===e||void 0===e?void 0:e.architecture,a),o.end(1e3),null===e||void 0===e?void 0:e.id}catch(s){return globalThis.lablupNotification.text=y.relieve(s.title),globalThis.lablupNotification.detail=s.message,globalThis.lablupNotification.show(!0,s),o.set(100,i("environment.DescProblemOccurred")),o.end(1e3),null}}));Promise.allSettled(e).then((e=>{const n=e.filter((e=>"fulfilled"===e.status&&null!==e.value)).map((e=>e.value));t(n)}))},children:(0,g.jsxs)(r.A,{direction:"column",gap:"md",align:"start",children:[x?i("environment.InstalledImagesAreExcluded"):null,(0,g.jsx)(r.A,{direction:"column",align:"start",children:(0,g.jsx)(c.A,{size:"small",bordered:!0,dataSource:h.map((e=>`${null===e||void 0===e?void 0:e.registry}/${null===e||void 0===e?void 0:e.name}/${null===e||void 0===e?void 0:e.tag}`)),renderItem:e=>(0,g.jsx)(c.A.Item,{children:e})})}),i("environment.DescSignificantInstallTime"),i("dialog.ask.DoYouWantToProceed")]})})};var p,y=l(69715),h=l(64703),x=l(4342),f=l(44733),b=l(50868),k=l(85029),A=l(85690),j=l(23702),S=l(67378),_=l(60822),I=l(89608),M=l.n(I),C=l(43373),P=l(88522);const R=e=>{let{open:n,image:t,onRequestClose:a,...i}=e;const{t:s}=(0,m.Bd)(),d=(0,o.CX)(),c=C.useRef(null),v=f.A.useApp(),{token:y}=b.A.useToken(),[I,R]=(0,P.useMutation)(void 0!==p?p:p=l(36751));if(!t)return null;const w=(()=>{let e=[];if(t.labels){const a=M().findIndex(t.labels,(e=>null!==e&&"ai.backend.service-ports"===(null===e||void 0===e?void 0:e.key)));var n,l;if(-1!==a)e=null===t||void 0===t||null===(n=t.labels[a])||void 0===n||null===(l=n.value)||void 0===l?void 0:l.split(",").map((e=>{const n=e.split(":");return{app:n[0],protocol:n[1],port:Number(n[2])}}))}return e})();return(0,g.jsxs)(u.A,{destroyOnClose:!0,open:n,onOk:()=>{var e;null===(e=c.current)||void 0===e||e.validateFields().then((()=>{var e;const n=null===(e=c.current)||void 0===e?void 0:e.getFieldValue("apps").map((e=>`${e.app}:${e.protocol}:${e.port}`)).join(","),l=M().map(t.labels,(e=>{return e.key.includes("service-ports")?{key:e.key,value:n}:{key:e.key,value:(null===(l=e.value)||void 0===l?void 0:l.toString())||""};var l})),r=()=>I({variables:{target:`${null===t||void 0===t?void 0:t.registry}/${null===t||void 0===t?void 0:t.name}:${null===t||void 0===t?void 0:t.tag}`,architecture:null===t||void 0===t?void 0:t.architecture,props:{labels:l,resource_limits:d.isManagerVersionCompatibleWith("24.03.4.*")?void 0:null}},onCompleted:(e,n)=>{var l,t;if(null!==e&&void 0!==e&&null!==(l=e.modify_image)&&void 0!==l&&l.ok)if(n&&(null===n||void 0===n?void 0:n.length)>0){const e=M().map(n,(e=>e.message));for(const n of e)k.Ay.error(n,2.5)}else k.Ay.success(s("environment.DescImagePortsModified")),a(!0);else k.Ay.error(null===e||void 0===e||null===(t=e.modify_image)||void 0===t?void 0:t.msg)},onError:e=>{k.Ay.error(s("dialog.ErrorOccurred"))}});null!==t&&void 0!==t&&t.installed?v.modal.confirm({title:"Image reinstallation required",content:(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(m.x6,{i18nKey:"environment.ModifyImageResourceLimitReinstallRequired"})}),onOk:r,getContainer:()=>document.body,closable:!0}):r()})).catch((e=>{}))},onCancel:()=>a(!1),confirmLoading:R,title:s("environment.ManageApps"),...i,children:[(0,g.jsxs)(r.A,{direction:"row",style:{width:"100%",marginBottom:y.marginXS},children:[(0,g.jsx)(A.A.Text,{strong:!0,style:{width:"32%"},children:s("environment.AppName")}),(0,g.jsx)(A.A.Text,{strong:!0,style:{width:"32%"},children:s("environment.Protocol")}),(0,g.jsx)(A.A.Text,{strong:!0,style:{width:"32%"},children:s("environment.Port")}),(0,g.jsx)(r.A,{})]}),(0,g.jsx)(j.A,{ref:c,layout:"vertical",autoComplete:"off",initialValues:{apps:w},requiredMark:!1,children:(0,g.jsx)(r.A,{direction:"column",children:(0,g.jsx)(j.A.List,{name:"apps",children:(e,n)=>{let{add:l,remove:a}=n;return(0,g.jsxs)(r.A,{direction:"column",style:{width:"100%"},children:[M().map(e,((e,n)=>(0,g.jsx)(j.A.Item,{children:(0,g.jsxs)(r.A,{direction:"row",gap:"xs",children:[(0,g.jsx)(j.A.Item,{...e,name:[e.name,"app"],noStyle:!0,rules:[{required:!0,message:s("environment.AppNameMustNotBeEmpty")}],children:(0,g.jsx)(S.A,{placeholder:s("environment.AppName")})}),(0,g.jsx)(j.A.Item,{...e,name:[e.name,"protocol"],noStyle:!0,rules:[{pattern:/^(http|tcp|pty|preopen)$/,required:!0,message:s("environment.ProtocolMustBeOneOfSupported")}],children:(0,g.jsx)(S.A,{placeholder:s("environment.Protocol")})}),(0,g.jsx)(j.A.Item,{...e,name:[e.name,"port"],noStyle:!0,rules:[{validator:(e,n)=>{const l=M().isUndefined(n)||""===n?NaN:M().toNumber(n);return M().isNaN(l)||l<0||l>=65535?Promise.reject(s("environment.PortMustBeInRange")):[2e3,2001,2002,2003,2200,7681].includes(Number(l))?Promise.reject(s("environment.PortReservedForInternalUse")):Promise.resolve()}},{validator:(e,l)=>{var t;const a=null===(t=c.current)||void 0===t?void 0:t.getFieldValue("apps");return M().isString(l)&&l.length>0&&a.some(((e,t)=>t!==n&&(null===e||void 0===e?void 0:e.port)===l))?Promise.reject(s("environment.PortMustBeUnique")):Promise.resolve()}}],children:(0,g.jsx)(S.A,{placeholder:s("environment.Port")})}),(0,g.jsx)(_.Ay,{type:"text",danger:!0,onClick:()=>a(e.name),style:0===n?{width:"10%",marginTop:8}:{width:"10%"},icon:(0,g.jsx)(h.A,{})})]},e.key)}))),(0,g.jsx)(_.Ay,{type:"dashed",onClick:()=>l(),block:!0,icon:(0,g.jsx)(x.A,{}),disabled:!t,children:s("button.Add")})]})}})})})]})};var w=l(11899),F=l(7194),$=l(87298);const K=e=>{var n;let{value:l,defaultValue:t,onChange:a,steps:r,showAllMarkLabels:i,...o}=e;const s=r.map((e=>M().isNumber(e)||M().isString(e)?{value:e,label:e.toString()}:e)),[d,u]=(0,F.A)({value:l,defaultValue:null!==t&&void 0!==t?t:null===(n=s[0])||void 0===n?void 0:n.value,onChange:a}),c=e=>0===e||e===s.length-1,m=M().fromPairs(s.map(((e,n)=>[n,c(n)?e.label:" "])));return(0,g.jsx)($.A,{...o,marks:m,value:M().findIndex(s,{value:d}),min:0,tooltip:{formatter(e){var n;if((0,I.isNumber)(e))return null===(n=s[e])||void 0===n?void 0:n.label},...o.tooltip},max:s.length-1,onChange:e=>{var n,l;u(null===(n=s[e])||void 0===n?void 0:n.value,null===(l=s[e])||void 0===l?void 0:l.label)}})};var L=l(96799);const T=e=>{var n,l,t,a;let{name:i,min:o,max:s}=e;const{token:d}=b.A.useToken(),{mergedResourceSlots:u}=(0,w.Hv)(),c=e=>{var n,l,t,a,r,i;return{cpu:{label:null===u||void 0===u||null===(n=u.cpu)||void 0===n?void 0:n.description,steps:M().map(["0","1","2","3","4","5","6","7","8"],(e=>{var n;return{value:e,label:`${e} ${null===u||void 0===u||null===(n=u.cpu)||void 0===n?void 0:n.display_unit}`}}))},mem:{label:null===u||void 0===u||null===(l=u.mem)||void 0===l?void 0:l.description,steps:M().map(["64m","128m","256m","512m","1g","2g","4g","8g","16g","32g","64g","128g","256g","512g"],(e=>({value:e,label:`${e.slice(0,-1)} ${M().toUpper(M().last(e))}iB`})))},"cuda.device":{label:null===u||void 0===u||null===(t=u["cuda.device"])||void 0===t?void 0:t.description,steps:M().map(["0","1","2","3","4","5","6","7","8"],(e=>{var n;return{value:e,label:`${e} ${null===u||void 0===u||null===(n=u["cuda.device"])||void 0===n?void 0:n.display_unit}`}}))},"cuda.shares":{label:null===u||void 0===u||null===(a=u["cuda.shares"])||void 0===a?void 0:a.description,steps:M().map(["0","0.1","0.2","0.5","1.0","2.0","4.0","8.0"],(e=>{var n;return{value:e,label:`${e} ${null===u||void 0===u||null===(n=u["cuda.shares"])||void 0===n?void 0:n.display_unit}`}}))},"rocm.device":{label:null===u||void 0===u||null===(r=u["rocm.device"])||void 0===r?void 0:r.description,steps:["0","1","2","3","4","5","6","7","8"]}}[e]||{label:null===u||void 0===u||null===(i=u[e])||void 0===i?void 0:i.description,steps:M().map(["0","1","2","3","4"],(n=>{var l;return{value:n,label:`${n} ${(null===u||void 0===u||null===(l=u[e])||void 0===l?void 0:l.display_unit)||""}`}}))}},m=j.A.useFormInstance(),v=j.A.useWatch(i,m),p=M().find(c(i).steps,(e=>e.value===v||e===v));return(0,g.jsx)(j.A.Item,{label:null!==(n=null===(l=c(i))||void 0===l?void 0:l.label)&&void 0!==n?n:i.toUpperCase(),style:{flex:1},children:(0,g.jsxs)(r.A,{direction:"row",gap:"lg",children:[(0,g.jsx)(S.A,{size:"large",variant:"borderless",readOnly:!0,value:null!==(t=null===p||void 0===p?void 0:p.label)&&void 0!==t?t:p,style:{flex:1,fontSize:d.fontSizeLG},tabIndex:-1}),(0,g.jsx)(L.A,{type:"vertical",style:{height:40}}),(0,g.jsx)(j.A.Item,{name:i,noStyle:!0,initialValue:o,children:(0,g.jsx)(K,{style:{flex:5},steps:null===(a=c(i))||void 0===a?void 0:a.steps})})]})})};var N;const V=e=>{var n;let{image:t,open:a,onRequestClose:r,...i}=e;const s=(0,o.CX)(),{t:d}=(0,m.Bd)(),c=(0,C.useRef)(null),v=f.A.useApp(),[p,y]=(0,P.useMutation)(void 0!==N?N:N=l(28499));return(0,g.jsx)(u.A,{destroyOnClose:!0,open:a,maskClosable:!1,onOk:async()=>{var e;const n=await(null===(e=c.current)||void 0===e?void 0:e.getFieldsValue()),l=Object.entries(n).map((e=>{var n,l,a,r;let[i,o]=e;return{key:i,min:null!==(n=o.toString())&&void 0!==n?n:"0",max:(null!==(l=null===t||void 0===t||null===(a=t.resource_limits)||void 0===a||null===(r=a.find((e=>(null===e||void 0===e?void 0:e.key)===i)))||void 0===r?void 0:r.max)&&void 0!==l?l:s.isManagerVersionCompatibleWith("24.03.4.*"))?void 0:null}})),a=()=>p({variables:{target:`${null===t||void 0===t?void 0:t.registry}/${null===t||void 0===t?void 0:t.name}:${null===t||void 0===t?void 0:t.tag}`,architecture:null===t||void 0===t?void 0:t.architecture,props:{resource_limits:l}},onCompleted:(e,n)=>{var l,t;if(null!==e&&void 0!==e&&null!==(l=e.modify_image)&&void 0!==l&&l.ok)if(n&&(null===n||void 0===n?void 0:n.length)>0){const e=M().map(n,(e=>e.message));for(const n of e)k.Ay.error(n,2.5)}else k.Ay.success(d("environment.DescImageResourceModified")),r(!0);else k.Ay.error(null===e||void 0===e||null===(t=e.modify_image)||void 0===t?void 0:t.msg)},onError:e=>{k.Ay.error(d("dialog.ErrorOccurred"))}});null!==t&&void 0!==t&&t.installed?v.modal.confirm({title:"Image reinstallation required",content:(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(m.x6,{i18nKey:"environment.ModifyImageResourceLimitReinstallRequired"})}),onOk:a,getContainer:()=>document.body,closable:!0}):a()},onCancel:()=>r(!1),confirmLoading:y,centered:!0,title:d("environment.ModifyImageResourceLimit"),...i,children:(0,g.jsx)(j.A,{ref:c,layout:"vertical",children:null===t||void 0===t||null===(n=t.resource_limits)||void 0===n?void 0:n.map((e=>{const{key:n,min:l,max:t}=e,a=n.replace(/_/g,".");return(0,g.jsx)(T,{name:null!==a&&void 0!==a?a:"",min:null!==l&&void 0!==l?l:"",max:null!==t&&void 0!==t?t:""},a)}))})})};var z=l(76604),D=l(6597),E=l(40478),O=l(95782),B=l(81850),q=l(40991);const H={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 144H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H212V212h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V160c0-8.8-7.2-16-16-16zm-52 268H612V212h200v200zM464 544H160c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H212V612h200v200zm452-268H560c-8.8 0-16 7.2-16 16v304c0 8.8 7.2 16 16 16h304c8.8 0 16-7.2 16-16V560c0-8.8-7.2-16-16-16zm-52 268H612V612h200v200z"}}]},name:"appstore",theme:"outlined"};var J=l(64098),U=function(e,n){return C.createElement(J.A,(0,q.A)({},e,{ref:n,icon:H}))};const Q=C.forwardRef(U);var G=l(1499),W=l(40567);const X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"};var Y=function(e,n){return C.createElement(J.A,(0,q.A)({},e,{ref:n,icon:X}))};const Z=C.forwardRef(Y);var ee,ne=l(15934),le=l(77731);const te=e=>{let{style:n}=e;const{t:t}=(0,m.Bd)(),[a,s]=(0,C.useState)([]),[,{getNamespace:d,getBaseVersion:u,getLang:c,getBaseImages:p,getConstraints:h}]=(0,o.Gj)(),{token:x}=b.A.useToken(),[k,j]=(0,C.useState)(null),[I,w]=(0,C.useState)(null),[F,$]=(0,C.useState)(!1),[K,L]=(0,o.Tw)("initial-fetch"),[,T]=(0,C.useTransition)(),[N,q]=(0,C.useState)([]),{message:H}=f.A.useApp(),[J,U]=(0,C.useState)(""),[X,Y]=(0,C.useTransition)(),[te,ae]=(0,C.useTransition)(),{images:re}=(0,P.useLazyLoadQuery)(void 0!==ee?ee:ee=l(35987),{},{fetchPolicy:"initial-fetch"===K?"store-and-network":"network-only",fetchKey:K}),ie=(0,C.useMemo)((()=>M().sortBy(re,(e=>null===e||void 0===e?void 0:e.humanized_name))),[re]),oe=[{title:t("environment.Status"),dataIndex:"installed",key:"installed",defaultSortOrder:"descend",sorter:(e,n)=>M().toNumber((null===e||void 0===e?void 0:e.installed)||0)-M().toNumber((null===n||void 0===n?void 0:n.installed)||0),render:(e,n)=>null!==n&&void 0!==n&&n.id&&N.includes(n.id)?(0,g.jsx)(ne.A,{color:"gold",children:(0,g.jsx)(D.A,{keyword:J,children:t("environment.Installing")})}):null!==n&&void 0!==n&&n.installed?(0,g.jsx)(ne.A,{color:"gold",children:(0,g.jsx)(D.A,{keyword:J,children:t("environment.Installed")})}):null},{title:t("environment.Registry"),dataIndex:"registry",key:"registry",sorter:(e,n)=>null!==e&&void 0!==e&&e.registry&&null!==n&&void 0!==n&&n.registry?e.registry.localeCompare(n.registry):0,render:(e,n)=>(0,g.jsx)(D.A,{keyword:J,children:n.registry})},{title:t("environment.Architecture"),dataIndex:"architecture",key:"architecture",sorter:(e,n)=>null!==e&&void 0!==e&&e.architecture&&null!==n&&void 0!==n&&n.architecture?e.architecture.localeCompare(n.architecture):0,render:(e,n)=>(0,g.jsx)(D.A,{keyword:J,children:n.architecture})},{title:t("environment.Namespace"),key:"namespace",dataIndex:"namespace",sorter:(e,n)=>{const l=d((0,i.A_)(e)||""),t=d((0,i.A_)(n)||"");return l&&t?l.localeCompare(t):0},render:(e,n)=>(0,g.jsx)(D.A,{keyword:J,children:d((0,i.A_)(n)||"")})},{title:t("environment.Language"),key:"lang",dataIndex:"lang",sorter:(e,n)=>{const l=null!==e&&void 0!==e&&e.name?c(null===e||void 0===e?void 0:e.name):"",t=null!==n&&void 0!==n&&n.name?c(null===n||void 0===n?void 0:n.name):"";return l&&t?l.localeCompare(t):0},render:(e,n)=>(0,g.jsx)(D.A,{keyword:J,children:n.name?c(n.name):null})},{title:t("environment.Version"),key:"baseversion",dataIndex:"baseversion",sorter:(e,n)=>{const l=u((0,i.A_)(e)||""),t=u((0,i.A_)(n)||"");return l&&t?l.localeCompare(t):0},render:(e,n)=>(0,g.jsx)(D.A,{keyword:J,children:u((0,i.A_)(n)||"")})},{title:t("environment.Base"),key:"baseimage",dataIndex:"baseimage",sorter:(e,n)=>{const l=null!==e&&void 0!==e&&e.tag&&null!==e&&void 0!==e&&e.name&&p(null===e||void 0===e?void 0:e.tag,null===e||void 0===e?void 0:e.name)[0]||"",t=null!==n&&void 0!==n&&n.tag&&null!==n&&void 0!==n&&n.name&&p(null===n||void 0===n?void 0:n.tag,null===n||void 0===n?void 0:n.name)[0]||"";return""===l&&""===t?0:""===l?-1:""===t?1:l.localeCompare(t)},render:(e,n)=>(0,g.jsx)(r.A,{direction:"row",align:"start",children:null!==n&&void 0!==n&&n.tag&&null!==n&&void 0!==n&&n.name?p(n.tag,n.name).map((e=>(0,g.jsx)(ne.A,{color:"green",children:(0,g.jsx)(D.A,{keyword:J,children:e})}))):null})},{title:t("environment.Constraint"),key:"constraint",dataIndex:"constraint",sorter:(e,n)=>{const l=null!==e&&void 0!==e&&e.tag&&null!==n&&void 0!==n&&n.labels&&h(null===e||void 0===e?void 0:e.tag,null===e||void 0===e?void 0:e.labels)[0]||"",t=null!==n&&void 0!==n&&n.tag&&null!==n&&void 0!==n&&n.labels&&h(null===n||void 0===n?void 0:n.tag,null===n||void 0===n?void 0:n.labels)[0]||"";return""===l&&""===t?0:""===l?-1:""===t?1:l.localeCompare(t)},render:(e,n)=>null!==n&&void 0!==n&&n.tag?(0,g.jsx)(y.p3,{tag:null===n||void 0===n?void 0:n.tag,labels:null===n||void 0===n?void 0:n.labels,highlightKeyword:J}):null},{title:t("environment.Digest"),dataIndex:"digest",key:"digest",sorter:(e,n)=>null!==e&&void 0!==e&&e.digest&&null!==n&&void 0!==n&&n.digest?e.digest.localeCompare(n.digest):0,render:(e,n)=>(0,g.jsx)(D.A,{keyword:J,children:n.digest})},{title:t("environment.ResourceLimit"),dataIndex:"resource_limits",key:"resource_limits",render:(e,n)=>{var l;return(0,g.jsx)(r.A,{direction:"row",gap:"xxs",children:null===n||void 0===n||null===(l=n.resource_limits)||void 0===l?void 0:l.map((e=>(0,g.jsx)(z.A,{type:(null===e||void 0===e?void 0:e.key)||"",value:(null===e||void 0===e?void 0:e.min)||"0",max:(null===e||void 0===e?void 0:e.max)||"Infinity"})))})}},{title:t("general.Control"),key:"control",dataIndex:"control",fixed:"right",render:(e,n)=>(0,g.jsxs)(r.A,{direction:"row",align:"stretch",justify:"center",gap:"xxs",onClick:e=>{e.stopPropagation()},children:[(0,g.jsx)(E.A,{type:"text",defaultIcon:(0,g.jsx)(O.A,{}),style:{color:x.colorPrimary},copyable:{text:(0,i.A_)(n)||""}}),(0,g.jsx)(_.Ay,{type:"text",icon:(0,g.jsx)(B.A,{style:{color:x.colorInfo}}),onClick:()=>w(n)}),(0,g.jsx)(_.Ay,{type:"text",icon:(0,g.jsx)(Q,{style:{color:x.colorInfo}}),onClick:()=>{j(n)}})]})}],se=(0,C.useMemo)((()=>null===ie||void 0===ie?void 0:ie.map((e=>({installed:null!==e&&void 0!==e&&e.installed?t("environment.Installed"):"",namespace:d((0,i.A_)(e)||""),lang:null!==e&&void 0!==e&&e.name?c(e.name):"",baseversion:u((0,i.A_)(e)||""),baseimage:null!==e&&void 0!==e&&e.tag&&null!==e&&void 0!==e&&e.name?p(e.tag,e.name):[],constraints:null!==e&&void 0!==e&&e.tag&&null!==e&&void 0!==e&&e.labels?h(e.tag,e.labels):[],isCustomized:!(null===e||void 0===e||!e.tag)&&-1!==e.tag.indexOf("customized")})))),[ie]),de=(0,C.useMemo)((()=>{if(M().isEmpty(J))return ie;const e=new RegExp(`${M().escapeRegExp(J)}`,"i");return M().filter(ie,((n,l)=>M().some(n,((n,t)=>{if("id"===t)return!1;if(["digest","architecture","registry"].includes(t))return e.test(M().toString(n));const a=se[l]||{};if("installed"===t)return e.test(a.installed);const r=e.test(a.baseversion),i=M().some(a.baseimage,(n=>e.test(n))),o=M().some(a.constraints,(n=>e.test(n))),s=!!a.isCustomized&&e.test("customized"),d=e.test(a.lang),u=e.test(a.namespace);return r||i||o||d||u||s}))))}),[J,se,ie]);return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)(r.A,{direction:"column",align:"stretch",style:{flex:1,...n},children:[(0,g.jsxs)(r.A,{justify:"end",style:{padding:x.paddingSM},gap:"xs",children:[a.length>0?(0,g.jsx)(A.A.Text,{children:t("general.NSelected",{count:a.length})}):null,(0,g.jsx)(S.A,{allowClear:!0,prefix:(0,g.jsx)(G.A,{}),placeholder:t("environment.SearchImages"),onChange:e=>{ae((()=>U(e.target.value)))},style:{width:200}}),(0,g.jsx)(_.Ay,{icon:(0,g.jsx)(W.A,{}),loading:X,onClick:()=>{s([]),Y((()=>L()))},children:t("button.Refresh")}),(0,g.jsx)(_.Ay,{icon:(0,g.jsx)(Z,{}),style:{backgroundColor:x.colorPrimary,color:"white"},onClick:()=>{0!==a.length?a.some((e=>!e.installed))?$(!0):H.error(t("environment.AlreadyInstalledImage")):H.error(t("environment.NoImagesAreSelected"))},children:t("environment.Install")})]}),(0,g.jsx)(le.A,{rowKey:"id",scroll:{x:"max-content"},pagination:{showTotal:(e,n)=>`${n[0]}-${n[1]} of ${e} items`,pageSizeOptions:["10","20","50"],style:{marginRight:x.marginXS}},dataSource:(0,i.tS)(de),columns:oe,loading:te,rowSelection:{type:"checkbox",onChange:(e,n)=>{s(n)},selectedRowKeys:a.map((e=>e.id))},onRow:e=>({onClick:n=>{a.find((n=>n.id===e.id))?s((n=>n.filter((n=>n.id!==e.id)))):s((n=>[...n,e]))}}),showSorterTooltip:!1,sortDirections:["descend","ascend","descend"]})]}),(0,g.jsx)(V,{open:!!I,onRequestClose:e=>{w(null),e&&T((()=>{L()}))},image:I}),(0,g.jsx)(R,{open:!!k,onRequestClose:e=>{j(null),e&&T((()=>{L()}))},image:k}),(0,g.jsx)(v,{open:F,onRequestClose:()=>{$(!1)},setInstallingImages:q,selectedRows:a})]})};var ae,re,ie,oe=l(40471),se=l(98038),de=l(52932),ue=l(86917);const ce=e=>{var n;let{resourcePresetFrgmt:t,existingResourcePresetNames:a,onRequestClose:r,...o}=e;const{t:s}=(0,m.Bd)(),{message:d}=f.A.useApp(),c=(0,C.useRef)(null),[v]=(0,w.bL)(),{mergedResourceSlots:p}=(0,w.Hv)(),y=(0,P.useFragment)(void 0!==ae?ae:ae=l(69674),t),[h,x]=(0,P.useMutation)(void 0!==re?re:re=l(87941)),[b,k]=(0,P.useMutation)(void 0!==ie?ie:ie=l(10275));return(0,g.jsx)(u.A,{...o,title:s(y?"resourcePreset.ModifyResourcePreset":"resourcePreset.CreateResourcePreset"),onOk:()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.validateFields().then((e=>{var n;let l=M().mapValues(null===e||void 0===e?void 0:e.resource_slots,((e,n)=>{var l;return M().includes(n,"mem")?null===(l=(0,i.Js)(e,"b",0))||void 0===l?void 0:l.numberFixed:e}));l=M().pickBy(l,M().negate(M().isUndefined));const t={resource_slots:JSON.stringify(l||{}),shared_memory:null!==e&&void 0!==e&&e.shared_memory?null===(n=(0,i.Js)(null===e||void 0===e?void 0:e.shared_memory,"b",0))||void 0===n?void 0:n.numberFixed:null};M().isEmpty(y)?h({variables:{name:null===e||void 0===e?void 0:e.name,props:t},onCompleted:(e,n)=>{var l,t;if(null!==e&&void 0!==e&&null!==(l=e.create_resource_preset)&&void 0!==l&&l.ok)if(n&&(null===n||void 0===n?void 0:n.length)>0){const e=M().map(n,(e=>e.message));M().forEach(e,(e=>{d.error(e,2.5)})),r(!1)}else d.success(s("resourcePreset.Created")),r(!0);else d.error(null===e||void 0===e||null===(t=e.create_resource_preset)||void 0===t?void 0:t.msg),r(!1)},onError(e){d.error(null===e||void 0===e?void 0:e.message)}}):b({variables:{name:null===e||void 0===e?void 0:e.name,props:t},onCompleted:(e,n)=>{var l,t;if(null!==e&&void 0!==e&&null!==(l=e.modify_resource_preset)&&void 0!==l&&l.ok)if(n&&(null===n||void 0===n?void 0:n.length)>0){const e=M().map(n,(e=>null===e||void 0===e?void 0:e.message));M().forEach(e,(e=>{d.error(e,2.5)})),r(!1)}else d.success(s("resourcePreset.Updated")),r(!0);else d.error(null===e||void 0===e||null===(t=e.modify_resource_preset)||void 0===t?void 0:t.msg),r(!1)},onError(e){d.error(null===e||void 0===e?void 0:e.message)}})})).catch((()=>{}))},onCancel:()=>r(!1),destroyOnClose:!0,confirmLoading:x||k,children:(0,g.jsxs)(j.A,{ref:c,layout:"vertical",preserve:!1,initialValues:y?{name:y.name,resource_slots:M().mapValues(JSON.parse((null===y||void 0===y?void 0:y.resource_slots)||"{}"),((e,n)=>{var l;return M().includes(n,"mem")?null===(l=(0,i.Js)(e+"b","g"))||void 0===l?void 0:l.numberUnit:e}))||{},shared_memory:null!==y&&void 0!==y&&y.shared_memory?null===(n=(0,i.Js)((null===y||void 0===y?void 0:y.shared_memory)+"b","g"))||void 0===n?void 0:n.numberUnit:null}:{},children:[(0,g.jsx)(j.A.Item,{label:s("resourcePreset.PresetName"),name:"name",rules:[{required:!0,message:s("resourcePreset.NoPresetName")},{pattern:/^[a-zA-Z0-9._-]*$/,message:s("data.Allowslettersnumbersand-_dot")},{validator:(e,n)=>!y&&null!==a&&void 0!==a&&a.includes(n)?Promise.reject(new Error(s("resourcePreset.PresetNameAlreadyExists"))):Promise.resolve()}],children:(0,g.jsx)(S.A,{disabled:!!y})}),(0,g.jsx)(j.A.Item,{label:s("resourcePreset.ResourcePreset"),children:(0,g.jsxs)(se.A,{gutter:16,children:[M().map(M().chunk(M().keys(v),2),((e,n)=>(0,g.jsx)(C.Fragment,{children:M().map(e,(e=>{var n,l;return(0,g.jsx)(de.A,{span:12,style:{alignSelf:"end"},children:(0,g.jsx)(j.A.Item,{label:(null===(n=M().get(p,e))||void 0===n?void 0:n.description)||e,name:["resource_slots",e],rules:[{validator:(n,l)=>l&&M().includes(e,"mem")&&(0,i.Js)(l,"p").number>(0,i.Js)("300p","p").number?Promise.reject(new Error("Memory size should be less than 300 PiB")):Promise.resolve()}],children:M().includes(e,"mem")?(0,g.jsx)(oe.A,{}):(0,g.jsx)(ue.A,{min:"cpu"===e?1:0,step:M().includes(e,".shares")?.1:1,addonAfter:null===(l=M().get(p,e))||void 0===l?void 0:l.display_unit})})},e)}))},n))),(0,g.jsx)(de.A,{span:12,style:{alignSelf:"end"},children:(0,g.jsx)(j.A.Item,{label:s("resourcePreset.SharedMemory"),name:"shared_memory",dependencies:["resource_slots","mem"],rules:[e=>{let{getFieldValue:n}=e;return{validator(e,l){var t,a,r,o,d,u;return l&&null!==(t=n("resource_slots"))&&void 0!==t&&t.mem&&(null!==(a=null===(r=(0,i.Js)(null===(o=n("resource_slots"))||void 0===o?void 0:o.mem,"b"))||void 0===r?void 0:r.number)&&void 0!==a?a:0)<(null!==(d=null===(u=(0,i.Js)(l,"b"))||void 0===u?void 0:u.number)&&void 0!==d?d:0)?Promise.reject(s("resourcePreset.MemoryShouldBeLargerThanSHMEM")):Promise.resolve()}}}],children:(0,g.jsx)(oe.A,{})})})]})})]})})};var me,ge,ve=l(33789);const pe=()=>{const{t:e}=(0,m.Bd)(),{token:n}=b.A.useToken(),{modal:t}=f.A.useApp(),[a,s]=(0,C.useTransition)(),[d,u]=(0,o.Tw)("initial-fetch"),[c,v]=(0,C.useState)(),[p,y]=(0,C.useState)(null),[k,j]=(0,C.useState)(!1),{resource_presets:S}=(0,P.useLazyLoadQuery)(void 0!==me?me:me=l(82045),{},{fetchPolicy:"initial-fetch"===d?"store-and-network":"network-only",fetchKey:d}),[I,R]=(0,P.useMutation)(void 0!==ge?ge:ge=l(10791));return(0,g.jsxs)(r.A,{direction:"column",align:"stretch",children:[(0,g.jsx)(r.A,{direction:"row",gap:"xs",justify:"end",wrap:"wrap",style:{padding:n.paddingContentVertical,paddingLeft:n.paddingContentHorizontalSM,paddingRight:n.paddingContentHorizontalSM},children:(0,g.jsxs)(r.A,{direction:"row",gap:"xs",wrap:"wrap",style:{flexShrink:1},children:[(0,g.jsx)(ve.A,{title:e("button.Refresh"),children:(0,g.jsx)(_.Ay,{icon:(0,g.jsx)(W.A,{}),loading:a,onClick:()=>{s((()=>{u()}))}})}),(0,g.jsx)(_.Ay,{type:"primary",icon:(0,g.jsx)(x.A,{}),onClick:()=>{j(!0)},children:e("resourcePreset.CreatePreset")})]})}),(0,g.jsx)(le.A,{rowKey:"name",dataSource:(0,i.tS)(S),scroll:{x:"max-content"},pagination:!1,sortDirections:["descend","ascend","descend"],showSorterTooltip:!1,columns:[{title:e("resourcePreset.Name"),dataIndex:"name",sorter:(e,n)=>(0,i._f)(e.name,n.name)},{title:e("resourcePreset.Resources"),dataIndex:"resource_slots",render:e=>(0,g.jsx)(r.A,{gap:"xxs",children:M().isEmpty(e)?"-":M().map(JSON.parse(e),((e,n)=>(0,g.jsx)(z.A,{type:n,value:e},n)))})},{title:e("resourcePreset.SharedMemory"),dataIndex:"shared_memory",render:e=>{var n;return e?null===(n=(0,i.Js)(e+"","g"))||void 0===n?void 0:n.number:"-"},sorter:(e,n)=>e.shared_memory-n.shared_memory},{title:e("general.Control"),key:"control",fixed:"right",render:(l,a)=>(0,g.jsxs)(r.A,{align:"stretch",children:[(0,g.jsx)(ve.A,{title:e("button.Edit"),children:(0,g.jsx)(_.Ay,{type:"text",size:"large",icon:(0,g.jsx)(B.A,{}),style:{color:n.colorInfo},onClick:()=>{y(a)}})}),(0,g.jsx)(ve.A,{title:e("button.Delete"),children:(0,g.jsx)(_.Ay,{type:"text",size:"large",icon:(0,g.jsx)(h.A,{style:{color:n.colorError}}),loading:R&&c===(null===a||void 0===a?void 0:a.name)+d,disabled:R&&c!==(null===a||void 0===a?void 0:a.name)+d,onClick:()=>{t.confirm({title:e("resourcePreset.DeleteResourcePreset"),content:(0,g.jsxs)(g.Fragment,{children:[e("resourcePreset.AboutToDeletePreset")," ",(0,g.jsx)(A.A.Text,{strong:!0,children:null===a||void 0===a?void 0:a.name})]}),onOk:()=>{var e;v((null===a||void 0===a?void 0:a.name)+d),I({variables:{name:null!==(e=null===a||void 0===a?void 0:a.name)&&void 0!==e?e:""},onCompleted:()=>{s((()=>{u()}))}})},okText:e("button.Delete"),okType:"primary",okButtonProps:{danger:!0}})}})})]})}]}),(0,g.jsx)(C.Suspense,{fallback:null,children:(0,g.jsx)(ce,{resourcePresetFrgmt:p,open:!!p||k,onRequestClose:e=>{y(null),j(!1),e&&s((()=>{u()}))},existingResourcePresetNames:M().map(S,(e=>null===e||void 0===e?void 0:e.name))})})]})};var ye=l(72269),he=l(12121);const xe=(0,he.withDefault)(he.StringParam,"image"),fe=()=>{const{t:e}=(0,m.Bd)(),[n,l]=(0,he.useQueryParam)("tab",xe),r=(0,o.CX)(),i=r.supports("container-registry-gql");return(0,g.jsx)(ye.A,{activeTabKey:n,onTabChange:l,tabList:[{key:"image",label:e("environment.Images")},{key:"preset",label:e("environment.ResourcePresets")},...r.is_superadmin?[{key:"registry",label:e("environment.Registries")}]:[]],styles:{body:{padding:0,paddingTop:1,overflow:"hidden"}},children:(0,g.jsxs)(C.Suspense,{fallback:(0,g.jsx)(a.A,{style:{height:"calc(100vh - 145px)"},spinSize:"large"}),children:["image"===n&&(0,g.jsx)(te,{}),"preset"===n&&(0,g.jsx)(pe,{}),"registry"===n?i?(0,g.jsx)(t.default,{}):(0,g.jsx)("backend-ai-registry-list",{active:!0}):null]})})}},10361:(e,n,l)=>{l.d(n,{A:()=>t});const t=(0,l(43106).A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])}}]);
//# sourceMappingURL=4462.faf59472.chunk.js.map