"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[2186],{2186(e,n,l){l.r(n),l.d(n,{ResourceNumbersOfSession:()=>ze,default:()=>Re});var t=l(56276),s=l(11863),i=l(89696),r=l(97455),a=l(2210),o=l.n(a),d=l(47476),c=l.n(d),u=l(32397),m=l(33337);const h=["value","onChange","localFormat"],v=u.forwardRef(((e,n)=>{let{value:l,onChange:a,localFormat:d}=e,u=(0,s.A)(e,h);const[,v]=(0,i.A)({value:l,onChange:a});return(0,m.jsx)(r.A,(0,t.A)({ref:n,value:l?o()(l):void 0,onChange:e=>{var n,l,t;c().isArray(e)&&(e=e[0]);const s=d?null===(n=e)||void 0===n?void 0:n.format():null===(l=e)||void 0===l||null===(t=l.tz())||void 0===t?void 0:t.toISOString();v(s)}},u))}));v.displayName="DatePickerISO";const p=v;var g=l(88813),x=l(81010),j=l(29367),A=l(393),y=l(69501),b=l(83632),F=l(17031),w=l(94109);const f=["open","onClose"],S=e=>{let{open:n,onClose:l}=e,i=(0,s.A)(e,f);const{t:r}=(0,w.Bd)(),[a,o]=(0,b.q)("has_opened_tour_neo_session_validation"),d=[{title:r("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:r("tourGuide.neoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:r("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:r("tourGuide.neoSessionLauncher.FixErrorFieldByModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:r("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:r("tourGuide.neoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,m.jsx)(F.A,(0,t.A)({steps:d,onClose:e=>{null===l||void 0===l||l(e),o(!0)},open:!a&&n},i))};var k=l(22722),O=l(81262);const V=e=>{let{form:n}=e;const l=k.A.useWatch("mounts",n),t=O.A.useApp(),{t:s}=(0,w.Bd)(),i=(0,u.useMemo)((()=>c().isArray(l)&&l.length>0),[l]);return(0,u.useEffect)((()=>{i&&(t.message.warning(s("session.launcher.InvalidMountsSelectionWarning"),5),n.setFieldValue("mounts",void 0))}),[i,s,t.message,n]),null};var E=l(48648),T=l(18249),I=l(45682),N=l(46704),C=l(49331);const _=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],l={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},s],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[l],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,i],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[l,s],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,i,s],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();_.hash="ba086835ea654ab889e0e6aaefa0abfe";const B=_;var D=l(62459),P=l(41458),M=l(20024),z=l(7749),R=l(40007),L=l(21986),q=l(85895),G=l(21843),U=l(89325),K=l(23755),W=l(71489),H=l(54086),Q=l(96337),J=l(52993),Z=l(19869);const X=e=>{const{t:n}=(0,w.Bd)(),l=k.A.useFormInstance(),s=k.A.useWatch(["owner","enabled"],l),i=(0,D.Am)();return("admin"===i||"superadmin"===i)&&s&&(0,m.jsx)(Q.Zuv,(0,t.A)((0,t.A)({title:n("session.launcher.SetSessionOwner"),showDivider:!0,size:"small",status:l.getFieldError(["owner","email"]).length>0||l.getFieldError(["owner","accesskey"]).length>0||l.getFieldError(["owner","project"]).length>0||l.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit")},e),{},{children:(0,m.jsxs)(H.A,{size:"small",column:1,children:[(0,m.jsx)(H.A.Item,{label:n("session.launcher.OwnerEmail"),children:l.getFieldValue(["owner","email"])}),(0,m.jsx)(H.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:l.getFieldValue(["owner","accesskey"])}),(0,m.jsx)(H.A.Item,{label:n("session.launcher.OwnerGroup"),children:l.getFieldValue(["owner","project"])}),(0,m.jsx)(H.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:l.getFieldValue(["owner","resourceGroup"])})]})}))},$=e=>{const{t:n}=(0,w.Bd)(),{token:l}=z.A.useToken(),s=k.A.useFormInstance(),i=k.A.useWatch(["owner","enabled"],s),[r,a]=(0,u.useState)(),o=(0,Z.useRelayEnvironment)(),{data:d,isFetching:h}=(0,P.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",r],queryFn:()=>{const e=s.getFieldValue(["owner","email"]);if(!e)return;const n=B;return(0,Z.fetchQuery)(o,n,{email:e}).toPromise()},enabled:!!r}),v=s.getFieldValue(["owner","email"])?null===d||void 0===d?void 0:d.keypairs:void 0,p=s.getFieldValue(["owner","email"])?null===d||void 0===d?void 0:d.user:void 0,g=!h&&r&&!p;return(0,m.jsxs)(R.A,(0,t.A)((0,t.A)({title:n("session.launcher.SetSessionOwner"),extra:(0,m.jsx)(k.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,m.jsx)(L.A,{})}),styles:i?void 0:{header:{borderBottom:"none"},body:{display:i?"block":"none"}}},e),{},{children:[(0,m.jsx)(M.A,{name:["owner","domainName"],value:null===p||void 0===p?void 0:p.domain_name}),(0,m.jsx)(k.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:t}=e;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Q.OOm,{children:(0,m.jsx)(k.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:i},{type:"email",message:n("general.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:g?"error":void 0,help:g?n("credential.NoUserToDisplay"):void 0,children:(0,m.jsx)(q.A.Search,{onSearch:e=>{s.validateFields([["owner","email"]]).then((()=>{a(e)})).catch((()=>{}))},onChange:()=>{a(""),s.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:h,enterButton:!h&&p?(0,m.jsx)(G.Ay,{icon:(0,m.jsx)(J.A,{})}):void 0})})}),(0,m.jsx)(k.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:t(["owner","enabled"])}],children:(0,m.jsx)(Q.xrr,{options:c().map(v,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:c().isEmpty(r)||h})}),(0,m.jsxs)(U.A,{gutter:l.marginSM,children:[(0,m.jsx)(K.A,{span:12,children:(0,m.jsx)(k.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:t(["owner","enabled"])}],children:(0,m.jsx)(Q.xrr,{options:c().map(null===p||void 0===p?void 0:p.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:c().isEmpty(r)||h})})}),(0,m.jsx)(K.A,{span:12,children:(0,m.jsx)(k.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:l}=e;return(0,m.jsx)(u.Suspense,{fallback:(0,m.jsx)(k.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:l(["owner","enabled"])}],children:(0,m.jsx)(W.A,{loading:!0})}),children:(0,m.jsx)(k.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:l(["owner","enabled"])}],children:l(["owner","project"])?(0,m.jsx)(Q.ZPT,{projectName:l(["owner","project"]),disabled:c().isEmpty(r)||h,autoSelectDefault:!0}):(0,m.jsx)(W.A,{disabled:!0})})})}})})]})]})}})]}))};var Y=l(26132),ee=l(68632),ne=l(59989),le=l(2616),te=l(60594),se=l(69594);const ie=e=>{var n,l,t,s,i,r,a,d,u,h,v,p,g,x,j,y,b,F,f,S,V,_,B,D,P,M,L,q,W,J,Z,$,ie,re,ae,oe;let{onClickEditStep:de}=e;const ce=O.A.useApp(),{t:ue}=(0,w.Bd)(),me=k.A.useFormInstance(),{token:he}=z.A.useToken(),ve=(0,T.CX)(),pe=k.A.useWatch("sessionType",{form:me,preserve:!0}),ge=null!==(n=null===ve||void 0===ve?void 0:ve.supports("batch-timeout"))&&void 0!==n&&n,xe=null!==(l=null===ve||void 0===ve?void 0:ve.supports("extended-image-info"))&&void 0!==l&&l,je=(0,I.hd)(),[,{getBaseVersion:Ae,getBaseImage:ye,tagAlias:be}]=(0,T.Gj)();return(0,m.jsxs)(m.Fragment,{children:[me.getFieldValue("bootstrap_script")&&(0,m.jsx)(Q.RfO,{description:ue("session.launcher.UsingBootstrapScriptInfo"),ghostInfoBg:!1,action:(0,m.jsx)(G.Ay,{size:"small",type:"text",onClick:()=>{ce.modal.info({title:ue("session.launcher.BootstrapScriptDetail"),content:(0,m.jsxs)(Q.OOm,{direction:"column",align:"start",children:[(0,m.jsx)(ee.A.Paragraph,{children:ue("userSettings.BootstrapScriptDescription")}),(0,m.jsx)(Y.A,{language:"shell",children:me.getFieldValue("bootstrap_script")})]}),width:800})},children:ue("notification.SeeDetail")}),type:"info",showIcon:!0}),(0,m.jsx)(Q.Zuv,{title:ue("session.launcher.SessionType"),showDivider:!0,size:"small",status:me.getFieldError("sessionName").length>0||me.getFieldError(["batch","command"]).length>0||me.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("sessionType")},children:(0,m.jsxs)(H.A,{size:"small",column:1,children:[(0,m.jsx)(H.A.Item,{label:ue("session.SessionType"),children:me.getFieldValue("sessionType")}),!c().isEmpty(me.getFieldValue("sessionName"))&&(0,m.jsx)(H.A.Item,{label:ue("session.launcher.SessionName"),children:me.getFieldValue("sessionName")}),"batch"===pe&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(H.A.Item,{label:ue("session.launcher.StartUpCommand"),styles:{label:{whiteSpace:"nowrap"},content:{overflow:"auto"}},children:me.getFieldValue(["batch","command"])?(0,m.jsx)(Y.A,{language:"shell",children:me.getFieldValue(["batch","command"])}):(0,m.jsx)(ee.A.Text,{type:"secondary",children:ue("general.None")})}),(0,m.jsx)(H.A.Item,{label:ue("session.launcher.SessionStartTime"),children:me.getFieldValue(["batch","scheduleDate"])?o()(me.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,m.jsx)(ee.A.Text,{type:"secondary",children:ue("general.None")})}),ge?(0,m.jsx)(H.A.Item,{label:ue("session.launcher.BatchJobTimeoutDuration"),children:me.getFieldValue(["batch","timeout"])?(0,m.jsxs)(ee.A.Text,{children:[me.getFieldValue(["batch","timeout"]),me.getFieldValue(["batch","timeoutUnit"])||"s"]}):(0,m.jsx)(ee.A.Text,{type:"secondary",children:ue("general.None")})}):null]})]})}),(0,m.jsx)(X,{onClickExtraButton:()=>{de("sessionType")}}),(0,m.jsx)(Q.Zuv,{title:ue("session.launcher.Environments"),showDivider:!0,size:"small",status:c().some(me.getFieldValue("envvars"),((e,n)=>me.getFieldError(["envvars",n,"variable"]).length>0||me.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("environment")},children:(0,m.jsxs)(H.A,{size:"small",column:1,children:[(0,m.jsx)(H.A.Item,{label:ue("session.launcher.Project"),children:je.name}),(0,m.jsx)(H.A.Item,{label:ue("general.Image"),children:xe?(0,m.jsxs)(U.A,{style:{flexFlow:"nowrap"},children:[(0,m.jsx)(K.A,{children:(0,m.jsx)(N.A,{image:(null===(t=me.getFieldValue("environments"))||void 0===t?void 0:t.version)||(null===(s=me.getFieldValue("environments"))||void 0===s?void 0:s.manual),style:{marginRight:he.marginXS}})}),(0,m.jsx)(K.A,{children:(0,m.jsx)(Q.OOm,{direction:"row",wrap:"wrap",children:null!==(i=me.getFieldValue("environments"))&&void 0!==i&&i.manual?(0,m.jsx)(ee.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(r=me.getFieldValue("environments"))||void 0===r?void 0:r.manual},children:null===(a=me.getFieldValue("environments"))||void 0===a?void 0:a.manual}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ee.A.Text,{children:be(null===(d=me.getFieldValue("environments"))||void 0===d||null===(u=d.image)||void 0===u?void 0:u.base_image_name)}),(0,m.jsx)(ne.A,{type:"vertical"}),(0,m.jsx)(ee.A.Text,{children:null===(h=me.getFieldValue("environments"))||void 0===h||null===(v=h.image)||void 0===v?void 0:v.version}),(0,m.jsx)(ne.A,{type:"vertical"}),(0,m.jsx)(ee.A.Text,{children:null===(p=me.getFieldValue("environments"))||void 0===p||null===(g=p.image)||void 0===g?void 0:g.architecture}),(0,m.jsx)(ne.A,{type:"vertical"}),c().map(null===(x=me.getFieldValue("environments"))||void 0===x||null===(j=x.image)||void 0===j?void 0:j.tags,(e=>{var n,l,t;const s=c().includes(e.key,"customized_"),i=s?null===(n=c().find(null===(l=me.getFieldValue("environments"))||void 0===l||null===(t=l.image)||void 0===t?void 0:t.labels,{key:"ai.backend.customized-image.name"}))||void 0===n?void 0:n.value:e.value,r=be(e.key+i);return c().isEqual(r,(0,E.WY)(e.key+i))||s?(0,m.jsx)(Q.qnQ,{values:[{label:be(e.key),color:s?"cyan":"blue"},{label:i,color:s?"cyan":"blue"}]},e.key):(0,m.jsx)(le.A,{color:s?"cyan":"blue",children:r},e.key)})),(0,m.jsx)(ee.A.Text,{style:{color:he.colorPrimary},copyable:{text:(0,E.A_)(null===(y=me.getFieldValue("environments"))||void 0===y?void 0:y.image)||(null===(b=me.getFieldValue("environments"))||void 0===b?void 0:b.version)}})]})})})]}):(0,m.jsxs)(U.A,{style:{flexFlow:"nowrap",gap:he.sizeXS},children:[(0,m.jsx)(K.A,{children:(0,m.jsx)(N.A,{image:(null===(F=me.getFieldValue("environments"))||void 0===F?void 0:F.version)||(null===(f=me.getFieldValue("environments"))||void 0===f?void 0:f.manual)})}),(0,m.jsx)(K.A,{children:(0,m.jsx)(Q.OOm,{direction:"row",wrap:"wrap",children:null!==(S=me.getFieldValue("environments"))&&void 0!==S&&S.manual?(0,m.jsx)(ee.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(V=me.getFieldValue("environments"))||void 0===V?void 0:V.manual},children:null===(_=me.getFieldValue("environments"))||void 0===_?void 0:_.manual}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ee.A.Text,{children:be(ye(null===(B=me.getFieldValue("environments"))||void 0===B?void 0:B.version))}),(0,m.jsx)(ne.A,{type:"vertical"}),(0,m.jsx)(ee.A.Text,{children:Ae(null===(D=me.getFieldValue("environments"))||void 0===D?void 0:D.version)}),(0,m.jsx)(ne.A,{type:"vertical"}),(0,m.jsx)(ee.A.Text,{children:null===(P=me.getFieldValue("environments"))||void 0===P||null===(M=P.image)||void 0===M?void 0:M.architecture}),(0,m.jsx)(ne.A,{type:"vertical"}),(0,m.jsx)(C.J,{tag:me.getFieldValue(["environments","image","tag"]),labels:null===(L=me.getFieldValue("environments"))||void 0===L||null===(q=L.image)||void 0===q?void 0:q.labels}),(0,m.jsx)(ee.A.Text,{style:{color:he.colorPrimary},copyable:{text:(0,E.A_)(null===(W=me.getFieldValue("environments"))||void 0===W?void 0:W.image)||(null===(J=me.getFieldValue("environments"))||void 0===J?void 0:J.version)}})]})})})]})}),(null===(Z=me.getFieldValue("envvars"))||void 0===Z?void 0:Z.length)>0&&(0,m.jsx)(H.A.Item,{label:ue("session.launcher.EnvironmentVariable"),children:null!==($=me.getFieldValue("envvars"))&&void 0!==$&&$.length?(0,m.jsx)(Q.OOm,{align:"stretch",direction:"column",children:(0,m.jsx)(Y.A,{language:"shell",children:c().map(me.getFieldValue("envvars"),(e=>"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"'))).join("\n")})}):(0,m.jsx)(ee.A.Text,{type:"secondary",children:"-"})})]})}),(0,m.jsx)(Q.Zuv,{title:ue("session.launcher.ResourceAllocation"),showDivider:!0,status:c().some(me.getFieldValue("resource"),((e,n)=>me.getFieldError(["resource",n]).length>0))||me.getFieldError(["num_of_sessions"]).length>0||me.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("environment")},children:(0,m.jsxs)(Q.OOm,{direction:"column",align:"stretch",children:[c().some(me.getFieldValue("resource"),((e,n)=>me.getFieldWarning(["resource",n]).length>0))&&(0,m.jsx)(te.A,{type:"warning",showIcon:!0,title:ue("session.launcher.EnqueueComputeSessionWarning")}),(0,m.jsxs)(H.A,{column:2,children:[(0,m.jsx)(H.A.Item,{label:ue("general.ResourceGroup"),span:2,children:me.getFieldValue("resourceGroup")||(0,m.jsx)(ee.A.Text,{type:"secondary",children:ue("general.None")})}),(0,m.jsx)(H.A.Item,{label:ue("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,m.jsxs)(Q.OOm,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===me.getFieldValue("allocationPreset")?"":(0,m.jsx)(le.A,{children:me.getFieldValue("allocationPreset")}),(0,m.jsx)(ze,{resource:me.getFieldValue("resource")})]})}),ve.supports("agent-select")&&!(null!==ve&&void 0!==ve&&null!==(ie=ve._config)&&void 0!==ie&&ie.hideAgents)&&(0,m.jsx)(H.A.Item,{label:ue("session.launcher.AgentNode"),children:c().castArray(me.getFieldValue("agent")).join(", ")||ue("session.launcher.AutoSelect")}),(0,m.jsx)(H.A.Item,{label:ue("session.launcher.NumberOfContainer"),children:1===me.getFieldValue("cluster_size")?me.getFieldValue("num_of_sessions"):me.getFieldValue("cluster_size")}),(0,m.jsx)(H.A.Item,{label:ue("session.launcher.ClusterMode"),children:"single-node"===me.getFieldValue("cluster_mode")?ue("session.launcher.SingleNode"):ue("session.launcher.MultiNode")})]}),(0,m.jsx)(R.A,{size:"small",type:"inner",title:ue("session.launcher.TotalAllocation"),children:(0,m.jsx)(Q.OOm,{direction:"row",gap:"xxs",children:(0,m.jsx)(ze,{resource:me.getFieldValue("resource"),containerCount:1===me.getFieldValue("cluster_size")?me.getFieldValue("num_of_sessions"):me.getFieldValue("cluster_size")})})})]})}),(0,m.jsx)(Q.Zuv,{title:ue("webui.menu.Data&Storage"),showDivider:!0,size:"small",status:me.getFieldError("mount_id_map").length>0?"error":void 0,extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("storage")},children:(0,m.jsxs)(Q.OOm,{direction:"column",align:"stretch",gap:"xs",children:[(null===(re=me.getFieldValue("mount_ids"))||void 0===re?void 0:re.length)>0?(0,m.jsx)(se.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:ue("data.folders.Name")},{dataIndex:"alias",title:ue("session.launcher.FolderAlias"),render:(e,n)=>c().isEmpty(e)?(0,m.jsx)(ee.A.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(n.name)}):e}],dataSource:c().map(me.getFieldValue("mount_ids"),(e=>{var n,l;return{name:(null===(n=me.getFieldValue("vfoldersNameMap"))||void 0===n?void 0:n[e])||e,alias:null===(l=me.getFieldValue("mount_id_map"))||void 0===l?void 0:l[e]}}))}):(0,m.jsx)(te.A,{type:"warning",showIcon:!0,title:ue("session.launcher.NoFolderMounted")}),(null===(ae=me.getFieldValue("autoMountedFolderNames"))||void 0===ae?void 0:ae.length)>0?(0,m.jsx)(H.A,{size:"small",children:(0,m.jsx)(H.A.Item,{label:ue("data.AutomountFolders"),children:(0,m.jsx)(Q.OOm,{gap:"xs",wrap:"wrap",children:c().map(me.getFieldValue("autoMountedFolderNames"),(e=>(0,m.jsx)(le.A,{children:e},e)))})})}):null]})}),(0,m.jsx)(Q.Zuv,{title:"Network",showDivider:!0,size:"small",status:me.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("network")},children:(0,m.jsx)(H.A,{size:"small",children:(0,m.jsx)(H.A.Item,{label:ue("session.launcher.PreOpenPortTitle"),children:(0,m.jsxs)(Q.OOm,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[c().sortBy(me.getFieldValue("ports"),(e=>parseInt(e))).map(((e,n)=>(0,m.jsx)(A.uD,{value:e,style:{margin:0},children:e},n+e))),c().isArray(me.getFieldValue("ports"))&&0!==(null===(oe=me.getFieldValue("ports"))||void 0===oe?void 0:oe.length)?null:(0,m.jsx)(ee.A.Text,{type:"secondary",children:ue("general.None")})]})})})})]})};var re=l(59991),ae=l(35681);const oe=e=>{let n=Object.assign({},((0,re.A)(e),e));const{t:l}=(0,w.Bd)(),s=(0,ae.f)();return(0,m.jsx)(k.A.Item,(0,t.A)((0,t.A)({label:l("session.launcher.SessionName"),name:"sessionName",rules:s},n),{},{children:(0,m.jsx)(q.A,{allowClear:!0,autoComplete:"off",count:{max:64,show:!0}})}))};var de=l(7871);const ce=()=>{const[e,n]=(0,b.q)("recentSessionHistory"),l=(0,Q.EQ6)((l=>{let{id:t,params:s,createdAt:i,name:r}=l;const a={id:null!==t&&void 0!==t?t:(0,Q.kXB)(8),params:s,createdAt:null!==i&&void 0!==i?i:(new Date).toISOString(),name:r},o=c().sortBy([a,...e||[]],"-createdAt").slice(0,5);n(o)})),s=(0,Q.EQ6)((()=>n([]))),i=(0,Q.EQ6)((l=>{const t=(e||[]).filter((e=>e.id!==l));n(t)})),r=(0,Q.EQ6)(((l,s)=>{const i=(e||[]).map((e=>e.id===l?(0,t.A)((0,t.A)({},e),{},{name:s}):e));n(i)}));return[e,{push:l,clear:s,remove:i,update:r}]};var ue,me=l(84527),he=l(94668),ve=l(93806),pe=l(58798);const ge=(0,ve.rU)((e=>{let{css:n}=e;return{fixEditableVerticalAlign:n(ue||(ue=(0,de.A)(["\n    & {\n      margin-top: 0px !important;\n    }\n  "])))}})),xe=e=>{let n=Object.assign({},((0,re.A)(e),e));const{t:l}=(0,w.Bd)(),{styles:s}=ge(),[i,{update:r}]=ce(),[a,d]=(0,u.useState)(null),[,{getImageAliasName:h,getBaseVersion:v}]=(0,T.Gj)(),[p,{pin:g,unpin:x,update:j}]=(()=>{const[e,n]=(0,b.q)("pinnedSessionHistory"),[l]=(0,b.q)("recentSessionHistory"),s=(0,Q.EQ6)((t=>{const s=(l||[]).find((e=>e.id===t));s&&n([...e||[],s])})),i=(0,Q.EQ6)((l=>{const t=(e||[]).filter((e=>e.id!==l));n(t)})),r=(0,Q.EQ6)(((l,s)=>{const i=(e||[]).map((e=>e.id===l?(0,t.A)((0,t.A)({},e),{},{name:s}):e));n(i)}));return[e,{pin:s,unpin:i,update:r}]})(),[,A]=(0,u.useState)(),{token:y}=z.A.useToken(),F=(0,u.useMemo)((()=>{const e=(e,n)=>{const l=new URLSearchParams(e.params),s=JSON.parse(l.get("formValues")||"{}");return(0,t.A)((0,t.A)({},s),{},{pinned:n,name:e.name})},n=c().map(i,(n=>(0,t.A)((0,t.A)({},n),e(n,!1)))),l=c().map(p,(n=>(0,t.A)((0,t.A)({},n),e(n,!0))));return c().chain([...l,...n]).unionBy("id").value()}),[i,p]);return(0,m.jsx)(Q.IbE,(0,t.A)((0,t.A)({width:800,title:l("session.launcher.RecentHistory"),footer:null,onCancel:()=>{A(void 0),n.onRequestClose()}},n),{},{children:(0,m.jsxs)(Q.OOm,{direction:"column",align:"stretch",gap:"sm",children:[(0,m.jsx)(ee.A.Text,{children:l("session.launcher.YouCanStartWithHistory")}),(0,m.jsx)(Q.zxw,{rowSelection:{selectedRowKeys:null===p||void 0===p?void 0:p.map((e=>e.id)),columnWidth:0,hideSelectAll:!0,renderCell:()=>null},scroll:{x:"max-content"},dataSource:F,pagination:!1,onRow:e=>({onMouseEnter:()=>d(e.id),onMouseLeave:()=>d(null)}),rowKey:e=>e.id,columns:[{title:(0,m.jsxs)(Q.OOm,{gap:"xxs",children:[(0,m.jsx)(pe.A,{}),(0,m.jsx)(me.A,{title:l("session.launcher.PinnedHistoryTooltip")})]}),dataIndex:"pinned",width:40,render:(e,n)=>{const l=!!n.pinned,t=a===n.id;return l?(0,m.jsx)(G.Ay,{size:"small",onClick:()=>{x(n.id)},type:"link",children:(0,m.jsx)(pe.A,{})}):(0,m.jsx)(G.Ay,{size:"small",onClick:()=>g(n.id),type:"link",children:(0,m.jsx)(pe.A,{style:{color:t?y.colorTextQuaternary:"transparent"}})})}},{title:l("session.launcher.SessionNameShort"),dataIndex:"name",render:(e,l)=>{const t=e||l.id.split("-")[0];return(0,m.jsx)(ee.A.Text,{className:s.fixEditableVerticalAlign,editable:{onChange(e){c().isEmpty(e)||(r(l.id,e),l.pinned&&j(l.id,e))},text:t},children:(0,m.jsx)(Q.rmy,{type:"hover",onClick:()=>{var e;null===(e=n.onRequestClose)||void 0===e||e.call(n,JSON.parse(new URLSearchParams(l.params||"").get("formValues")||"{}"))},children:t})})}},{title:l("session.launcher.Environments"),dataIndex:["environments","version"],render:(e,n)=>{var l,t;const s=(null===(l=n.environments)||void 0===l?void 0:l.version)||(null===(t=n.environments)||void 0===t?void 0:t.manual);return s&&(0,m.jsx)(he.A,{title:s,placement:"right",children:(0,m.jsxs)(Q.OOm,{gap:"xxs",children:[(0,m.jsx)(N.A,{image:s}),(0,m.jsxs)(ee.A.Text,{children:[h(s)," ",v(s)]})]})})},onCell:()=>({style:{maxWidth:250,textOverflow:"ellipsis"}})},{title:l("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,m.jsx)(Q.OOm,{gap:"xs",children:(0,m.jsx)(ze,{resource:e})})},{title:l("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>o()(e).fromNow()}]})]})}))};var je=l(45143);var Ae=l(45601),ye=l(32128),be=l(17375),Fe=l(36061),we=l(75794),fe=l(99845),Se=l(70975),ke=l(72703),Oe=l(77095),Ve=l(26218),Ee=l(37942),Te=l(55638),Ie=l(88957),Ne=l(10036),Ce=l(85910),_e=l(21507),Be=l(443),De=l(31356),Pe=l(56496),Me=l(22905);const ze=e=>{let{resource:n,containerCount:l=1}=e;return(0,m.jsxs)(m.Fragment,{children:[c().map(c().omit(n,"shmem","accelerator","acceleratorType"),((e,t)=>{var s,i;return"0"===e?null:(0,m.jsx)(Q.jOc,{type:t,value:"mem"===t?((null===(s=(0,E.mv)(e.toString(),""))||void 0===s?void 0:s.number)||0)*l+"":c().toNumber(e)*l+"",opts:{shmem:n.shmem?((null===(i=(0,E.mv)(n.shmem,""))||void 0===i?void 0:i.number)||0)*l:void 0}},t)})),n&&n.accelerator&&n.acceleratorType&&c().isNumber(n.accelerator)?(0,m.jsx)(Q.jOc,{type:n.acceleratorType,value:c().toString(n.accelerator*l)}):null]})},Re=()=>{var e,n;const l=O.A.useApp(),{logger:s}=(0,Q.Q7t)(),{getErrorMessage:i}=(0,Q.B78)(),r=(0,_e.md)(j.i7),a=(0,T.CX)(),d=a.supports("mount-by-id"),h=null!==(e=null===a||void 0===a?void 0:a.supports("batch-timeout"))&&void 0!==e&&e,v=(0,D.Am)(),[,b]=(0,I.zL)(),{startSession:F,defaultFormValues:f,upsertSessionNotification:N}=(0,Pe.G)(),C=(0,Me.withDefault)(Me.NumberParam,0),_=(0,Me.withDefault)(Me.JsonParam,f),B=(0,Me.withDefault)(Me.JsonParam,{}),[{step:P,formValues:M,redirectTo:H},J]=(0,Me.useQueryParams)({step:C,formValues:_,redirectTo:Me.StringParam,appOption:B}),{search:Z}=(0,De.zy)(),X=(0,T.f0)(),[Y,{toggle:ne}]=(0,Se.A)(),[,{push:le}]=ce(),{run:te}=(0,ke.A)((()=>{const e=ue.getFieldsValue();J({formValues:c().assign(c().omit(ue.getFieldsValue(),["environments.image","environments.customizedTag","autoMountedFolderNames","owner","envvars"]),{envvars:(0,g.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),se=e=>{J({step:e},"pushIn")},{token:re}=z.A.useToken(),{t:ae}=(0,w.Bd)(),de=Oe.Ay.useBreakpoint(),[ue]=k.A.useForm();(0,u.useEffect)((()=>{c().isEmpty(M)||ue.validateFields().catch((()=>{}))}),[]);const me=(0,u.useEffectEvent)((()=>c().isEmpty(M)?null:setTimeout((()=>{ue.validateFields().catch((()=>{}))}),500)));(0,u.useEffect)((()=>{const e=me();return()=>{e&&clearTimeout(e)}}),[]);const ve=(0,u.useMemo)((()=>c().merge({},f,y.jh,M)),[f,M]);(0,u.useEffect)((()=>{var e;null===(e=r.current)||void 0===e||e.scrollTo(0,0)}),[P]);const pe=k.A.useWatch("sessionType",{form:ue,preserve:!0})||ue.getFieldValue("sessionType")||M.sessionType,ge=(0,Q.YM3)([{title:ae("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(ae("session.launcher.Environments")," & ").concat(ae("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==pe&&{title:ae("webui.menu.Data&Storage"),key:"storage"},{title:ae("session.launcher.Network"),key:"network"},{title:ae("session.launcher.ConfirmAndLaunch"),icon:(0,m.jsx)(Ae.A,{}),key:"review"}]),ze=null===(n=ge[P])||void 0===n?void 0:n.key,Re=c().some(ue.getFieldsError(),(e=>e.errors.length>0)),[Le,qe]=(0,Q.TwB)("first");(0,u.useEffect)((()=>{P===ge.length-1&&ue.validateFields().catch((()=>{})).finally((()=>qe()))}),[P,ue,qe,ge.length]),(0,u.useEffect)((()=>{"first"!==Le&&Ue(!!Re)}),[Le,Re]);const[Ge,Ue]=(0,u.useState)(!1),[Ke,We]=(0,u.useState)(!1);return(0,u.useLayoutEffect)((()=>{Ke&&(ue.resetFields(),We(!1))}),[Ke,ue]),(0,m.jsxs)(Q.OOm,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,m.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,m.jsxs)(Q.OOm,{direction:"row",gap:"md",align:"start",children:[(0,m.jsxs)(Q.OOm,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,m.jsxs)(Q.OOm,{direction:"row",justify:"between",children:[(0,m.jsx)(ee.A.Title,{level:4,style:{marginTop:0},children:ae("session.launcher.StartNewSession")}),(0,m.jsx)(Q.OOm,{direction:"row",gap:"sm",children:(0,m.jsx)(G.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>ne(),children:ae("session.launcher.RecentHistory")})})]}),(0,m.jsx)(k.A.Provider,{onFormChange:()=>{te()},children:(0,m.jsxs)(k.A,{form:ue,layout:"vertical",initialValues:ve,children:[(0,m.jsx)(V,{form:ue}),(0,m.jsxs)(Q.OOm,{direction:"column",align:"stretch",gap:"md",children:[(0,m.jsxs)(R.A,{title:ae("session.launcher.SessionType"),style:{display:"sessionType"===ze?"block":"none"},children:[(0,m.jsx)(k.A.Item,{name:"sessionType",children:(0,m.jsx)(Ve.Ay.Group,{options:[{label:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ee.A.Text,{code:!0,children:ae("session.launcher.InteractiveMode")})," ",(0,m.jsx)(ee.A.Text,{type:"secondary",children:ae("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ee.A.Text,{code:!0,children:ae("session.launcher.BatchMode")})," ",(0,m.jsx)(ee.A.Text,{type:"secondary",children:ae("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,m.jsx)(oe,{}),(0,m.jsx)(k.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,m.jsx)(q.A,{})})]}),"batch"===pe&&(0,m.jsxs)(R.A,{title:ae("session.launcher.BatchModeConfig"),style:{display:"sessionType"===ze?"block":"none"},children:[(0,m.jsx)(k.A.Item,{label:ae("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,m.jsx)(q.A.TextArea,{autoSize:!0})}),(0,m.jsx)(k.A.Item,{noStyle:!0,dependencies:[["batch","scheduleDate"]],children:()=>{const e=ue.getFieldValue(["batch","scheduleDate"]);return(0,m.jsx)(Q.vmA,{delay:1e3,callback:()=>{const e=ue.getFieldValue(["batch","scheduleDate"]);return e?o()(e).isBefore(o()())?void(0===ue.getFieldError(["batch","scheduleDate"]).length&&ue.validateFields([["batch","scheduleDate"]])):o()(e).fromNow():void 0},triggerKey:e||"none",render:e=>(0,m.jsx)(k.A.Item,{label:ae("session.launcher.SessionStartTime"),extra:e,children:(0,m.jsxs)(Q.OOm,{direction:"row",gap:"xs",children:[(0,m.jsx)(k.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,m.jsx)(Ee.A,{onChange:e=>{e.target.checked&&c().isEmpty(ue.getFieldValue(["batch","scheduleDate"]))?ue.setFieldValue(["batch","scheduleDate"],o()().add(2,"minutes").toISOString()):!1===e.target.checked&&ue.setFieldValue(["batch","scheduleDate"],void 0),ue.validateFields([["batch","scheduleDate"]])},children:ae("session.launcher.Enable")})}),(0,m.jsx)(k.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var l,t;return(null===(l=e.batch)||void 0===l?void 0:l.enabled)!==(null===(t=n.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const n=!0!==(null===(e=ue.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(k.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&o()(n).isBefore(o()())?Promise.reject(ae("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,m.jsx)(p,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(o()().startOf("day"))})})})}})]})})})}}),h?(0,m.jsx)(k.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"],["batch","timeoutUnit"]],children:()=>{const e=ue.getFieldValue(["batch","timeout"]),n=ue.getFieldValue(["batch","timeoutUnit"]),l=o().duration(e,null!==n&&void 0!==n?n:"s"),t=(0,E.a3)(l,ae),s=!c().isNull(e)&&c().toFinite(e)>0?t:null;return(0,m.jsx)(k.A.Item,{label:ae("session.launcher.BatchJobTimeoutDuration"),tooltip:ae("session.launcher.BatchJobTimeoutDurationDesc"),help:s,children:(0,m.jsxs)(Q.OOm,{direction:"row",gap:"xs",children:[(0,m.jsx)(k.A.Item,{noStyle:!0,name:["batch","timeoutEnabled"],valuePropName:"checked",children:(0,m.jsx)(Ee.A,{onChange:e=>{!1===e.target.checked&&ue.setFieldValue(["batch","timeout"],void 0),ue.validateFields([["batch","timeout"]])},children:ae("session.launcher.Enable")})}),(0,m.jsx)(k.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"]],children:()=>{const e=!0!==ue.getFieldValue(["batch","timeoutEnabled"]);return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(Te.A.Compact,{children:[(0,m.jsx)(k.A.Item,{name:["batch","timeout"],label:ae("session.launcher.BatchJobTimeoutDuration"),noStyle:!0,dependencies:[["batch","timeoutEnabled"]],rules:[{min:0,type:"number",message:ae("error.AllowsPositiveNumberOnly")},{required:!e}],children:(0,m.jsx)(Ie.A,{disabled:e,min:1,style:{width:"100%"},onChange:()=>{ue.validateFields([["batch","timeoutUnit"]])}})}),(0,m.jsx)(k.A.Item,{noStyle:!0,name:["batch","timeoutUnit"],dependencies:[["batch","timeout"],["batch","timeoutEnabled"]],rules:[e=>{let{getFieldValue:n}=e;return{validator(){const e=n(["batch","timeout"]);return!0===n(["batch","timeoutEnabled"])&&(void 0===e||null===e||e<1)?Promise.reject():Promise.resolve()}}}],children:(0,m.jsx)(W.A,{tabIndex:-1,disabled:e,style:{width:100},options:[{label:ae("time.Sec"),value:"s"},{label:ae("time.Min"),value:"m"},{label:ae("time.Hour"),value:"h"},{label:ae("time.Day"),value:"d"},{label:ae("time.Week"),value:"w"}]})})]})})}})]})})}}):null]}),("admin"===v||"superadmin"===v)&&(0,m.jsx)($,{style:{display:"sessionType"===ze?"block":"none"}}),"inference"===pe&&(0,m.jsx)(R.A,{title:"Inference Mode Configuration",children:(0,m.jsx)(k.A.Item,{name:["inference","vFolderName"],label:ae("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,m.jsx)(W.A,{})})}),(0,m.jsxs)(R.A,{title:ae("session.launcher.Environments"),style:{display:"environment"===ze?"block":"none"},children:[(0,m.jsx)(Be.tH,{fallbackRender:()=>null,children:(0,m.jsx)(x.A,{})}),(0,m.jsx)(k.A.Item,{label:ae("session.launcher.EnvironmentVariable"),children:(0,m.jsx)(g.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,m.jsx)(R.A,{title:ae("session.launcher.ResourceAllocation"),style:{display:"environment"===ze?"block":"none"},children:(0,m.jsx)(y.Ay,{enableAgentSelect:!a._config.hideAgents&&a.supports("agent-select"),enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,m.jsxs)(R.A,{title:ae("session.launcher.HPCOptimization"),style:{display:"environment"===ze?"block":"none"},children:[(0,m.jsx)(k.A.Item,{noStyle:!0,children:(0,m.jsxs)(Q.OOm,{direction:"row",gap:"sm",children:[(0,m.jsx)(ee.A.Text,{children:ae("session.launcher.SwitchOpenMPoptimization")}),(0,m.jsx)(k.A.Item,{label:ae("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,m.jsx)(L.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e?ue.setFieldsValue({hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:void 0,OPENBLAS_NUM_THREADS:void 0}}):ue.setFieldsValue({hpcOptimization:{autoEnabled:!1,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"}})}})})]})}),(0,m.jsx)(k.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var l,t;return(null===(l=e.hpcOptimization)||void 0===l?void 0:l.autoEnabled)!==(null===(t=n.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=ue.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,m.jsxs)(U.A,{gutter:re.marginMD,style:{display:e?"none":void 0,marginTop:re.marginMD},children:[(0,m.jsx)(K.A,{xs:24,sm:12,children:(0,m.jsx)(k.A.Item,{style:{flex:1},label:ae("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,m.jsxs)(m.Fragment,{children:[ae("session.launcher.OpenMPOptimization"),(0,m.jsx)(w.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,m.jsx)(Ie.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,m.jsx)(K.A,{xs:24,sm:12,children:(0,m.jsx)(k.A.Item,{style:{flex:1},label:ae("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,m.jsxs)(m.Fragment,{children:[ae("session.launcher.OpenMPOptimization"),(0,m.jsx)(w.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,m.jsx)(Ie.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,m.jsx)(R.A,{title:ae("webui.menu.Data&Storage"),style:{display:"storage"===ze?"block":"none"},children:(0,m.jsx)(k.A.Item,{noStyle:!0,dependencies:["owner"],children:e=>{let{getFieldValue:n}=e;const l=n("owner"),t=(null===l||void 0===l?void 0:l.enabled)&&c().every(c().omit(l,"enabled"),(e=>void 0!==e));return(0,m.jsx)(je.A,{rowKey:d?"id":"name",rowFilter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))},tableProps:{ownerEmail:t?null===l||void 0===l?void 0:l.email:void 0}})}})}),(0,m.jsx)(R.A,{title:ae("session.launcher.Network"),style:{display:"network"===ze?"block":"none"},children:(0,m.jsx)(A.Ay,{})}),"review"===ze&&(0,m.jsx)(ie,{onClickEditStep:e=>{const n=c().findIndex(ge,{key:e});se(n)}}),(0,m.jsxs)(Q.OOm,{direction:"row",justify:"between",children:[(0,m.jsx)(Q.OOm,{gap:"sm",children:(0,m.jsx)(Ne.A,{title:ae("button.Reset"),description:ae("session.launcher.ResetFormConfirm"),onConfirm:()=>{J({},"replace"),We(!0)},icon:(0,m.jsx)(ye.A,{style:{color:re.colorError}}),okText:ae("button.Reset"),okButtonProps:{danger:!0},children:(0,m.jsx)(G.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:ae("button.Reset")})})}),(0,m.jsxs)(Q.OOm,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[P>0&&(0,m.jsx)(G.Ay,{onClick:()=>{se(P-1)},icon:(0,m.jsx)(be.A,{}),children:ae("button.Previous")}),P===ge.length-1?(0,m.jsx)(he.A,{title:Re?ae("session.launcher.PleaseCompleteForm"):void 0,children:(0,m.jsx)(Q.Fvl,{type:"primary",icon:(0,m.jsx)(Fe.A,{}),disabled:Re,action:async()=>{var e;const n=Z,t=await ue.validateFields().catch((e=>{s.error("validation errors",e)}));if(t){if(c().isEmpty(t.mount_ids)||0===(null===(e=t.mount_ids)||void 0===e?void 0:e.length)){if(!await l.modal.confirm({title:ae("session.launcher.NoFolderMounted"),content:(0,m.jsxs)(m.Fragment,{children:[ae("session.launcher.HomeDirectoryDeletionDialog"),(0,m.jsx)("br",{}),(0,m.jsx)("br",{}),ae("session.launcher.LaunchConfirmationDialog"),(0,m.jsx)("br",{}),(0,m.jsx)("br",{}),ae("dialog.ask.DoYouWantToProceed")]}),okText:ae("session.launcher.Start"),closable:!0}))return}await F(t).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&(N(e.fulfilled),b(t.resourceGroup),le({params:n,name:e.fulfilled[0].value.sessionName})),null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&X(H||"/job"),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const n=e.rejected[0].reason;l.modal.error({title:null===n||void 0===n?void 0:n.title,content:i(n)})}})).catch((e=>{s.error("Unexpected error during session creation:",e),l.message.error(ae("error.UnexpectedError"))}))}},children:ae("session.launcher.Launch")})}):(0,m.jsxs)(G.Ay,{type:"primary",ghost:!0,onClick:()=>{se(P+1)},children:[ae("button.Next")," ",(0,m.jsx)(we.A,{})]}),P!==ge.length-1&&(0,m.jsxs)(G.Ay,{onClick:()=>{se(ge.length-1)},children:[ae("session.launcher.SkipToConfirmAndLaunch"),(0,m.jsx)(fe.A,{})]})]})]})]})]})})]}),de.lg&&(0,m.jsx)(Q.OOm,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,m.jsx)(Ce.A,{size:"small",orientation:"vertical",current:P,onChange:e=>{se(e)},items:c().map(ge,((e,n)=>(0,t.A)((0,t.A)({},e),{},{status:n===P?"process":"wait"})))})})]}),(0,m.jsx)(xe,{onRequestClose:e=>{if(e){const n=c().merge({sessionName:"",ports:[],vfoldersNameMap:{},mount_ids:[],mount_id_map:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0},agent:["auto"]},e);c().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,Q.kXB)(4)),ue.setFieldsValue(n),se(ge.length-1),ue.validateFields().catch((()=>{}))}ne()},open:Y}),P===ge.length-1?(0,m.jsx)(Be.tH,{fallback:null,children:(0,m.jsx)(S,{open:Ge,onClose:()=>{Ue(!1)},scrollIntoViewOptions:!0})}):void 0]})}},20024(e,n,l){l.d(n,{A:()=>d});var t=l(56276),s=l(11863),i=l(22722),r=l(32397),a=l(33337);const o=["value"],d=e=>{let{value:n}=e,l=(0,s.A)(e,o);const d=i.A.useFormInstance();return(0,r.useEffect)((()=>{d.setFieldValue(l.name,n)}),[n,d,l.name]),(0,a.jsx)(i.A.Item,(0,t.A)((0,t.A)({},l),{},{hidden:!0,children:(0,a.jsx)("div",{})}))}},35681(e,n,l){l.d(n,{f:()=>a});var t=l(23177),s=l(47476),i=l.n(s),r=l(94109);const a=e=>{const n=(0,t.c)(17),{t:l}=(0,r.Bd)();let s,a,o,d,c,u,m;return n[0]!==l?(s=l("session.validation.SessionNameTooShort"),n[0]=l,n[1]=s):s=n[1],n[2]!==s?(a={min:4,message:s},n[2]=s,n[3]=a):a=n[3],n[4]!==l?(o=l("session.validation.SessionNameTooLong64"),n[4]=l,n[5]=o):o=n[5],n[6]!==o?(d={max:64,message:o},n[6]=o,n[7]=d):d=n[7],n[8]!==l?(c={validator:(e,n)=>i().isEmpty(n)?Promise.resolve():/^\w/.test(n)?/\w$/.test(n)?/^[\w.-]*$/.test(n)?Promise.resolve():Promise.reject(l("session.validation.SessionNameInvalidCharacter")):Promise.reject(l("session.validation.SessionNameShouldEndWith")):Promise.reject(l("session.validation.SessionNameShouldStartWith"))},n[8]=l,n[9]=c):c=n[9],n[10]!==e?(u=e?{required:!0}:{},n[10]=e,n[11]=u):u=n[11],n[12]!==a||n[13]!==d||n[14]!==c||n[15]!==u?(m=[a,d,c,u],n[12]=a,n[13]=d,n[14]=c,n[15]=u,n[16]=m):m=n[16],m}}}]);
//# sourceMappingURL=2186.7ef48b45.chunk.js.map