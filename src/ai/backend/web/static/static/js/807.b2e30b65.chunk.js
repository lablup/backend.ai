/*! For license information please see 807.b2e30b65.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[807,3273],{33273:(e,n,a)=>{a.r(n),a.d(n,{default:()=>k,passwordPattern:()=>b});var t=a(30032),i=a(83468),r=a(17413),o=a(87985),l=a(29871),s=a(82156),d=a(50840),c=a(65080),u=a(90214),m=a(24128),h=a(24377),g=a(6932),w=a(76998),p=a(77678),v=a(23446);const b=/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,k=()=>{const{value:e,dispatchEvent:n}=(0,o.useWebComponentInfo)();let a;try{a=JSON.parse(e||"")}catch(M){a={open:!1,currentPassword:"",username:"",api_endpoint:""}}const{open:k,currentPassword:$,username:f,api_endpoint:S}=a,{token:P}=d.A.useToken(),[A]=c.A.useForm(),{t:C}=(0,p.Bd)();(0,w.useEffect)((()=>{k&&A.resetFields()}),[k,A]);const I=(0,i.oM)({api_endpoint:S}),y=(0,r.ET)({mutationFn:e=>(0,t.hu)({method:"POST",url:"/server/update-password-no-auth",body:e,client:I})}),x=()=>{A.validateFields().then((e=>{y.mutate({username:f,current_password:$,new_password:e.newPassword},{onSuccess(e,a,t){n("ok",null)},onError(e,n,a){}})}))};return(0,v.jsx)(u.A,{open:k,centered:!0,mask:!1,onCancel:()=>{n("cancel",null)},keyboard:!1,maskClosable:!1,footer:null,width:450,destroyOnClose:!0,forceRender:!0,children:(0,v.jsxs)(l.A,{direction:"column",justify:"start",align:"stretch",gap:"md",style:{alignSelf:"stretch",paddingTop:P.paddingMD,paddingBottom:P.paddingMD},children:[(0,v.jsxs)(m.A.Title,{level:3,style:{margin:0},children:[(0,v.jsx)(s.A,{twoToneColor:P.colorWarning})," ",C("webui.menu.PleaseChangeYourPassword")]}),C("webui.menu.YouMushChangeYourPassword"),(0,v.jsxs)(c.A,{form:A,layout:"vertical",initialValues:{currentPassword:$},disabled:y.isPending,children:[(0,v.jsx)(c.A.Item,{name:"newPassword",label:C("webui.menu.NewPassword"),rules:[{required:!0},{pattern:b,message:C("webui.menu.InvalidPasswordMessage").toString()},()=>({validator:(e,n)=>$===n?Promise.reject(new Error(C("webui.menu.NewPasswordCannotBeSame").toString())):Promise.resolve()})],hasFeedback:!0,children:(0,v.jsx)(h.A.Password,{})}),(0,v.jsx)(c.A.Item,{name:"confirm",label:C("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0},e=>{let{getFieldValue:n}=e;return{validator:(e,a)=>a&&n("newPassword")!==a?Promise.reject(new Error(C("environment.PasswordsDoNotMatch").toString())):Promise.resolve()}}],children:(0,v.jsx)(h.A.Password,{onPressEnter:x})})]}),(0,v.jsx)(g.Ay,{type:"primary",onClick:x,loading:y.isPending,children:C("webui.menu.Update")})]})})}},60807:(e,n,a)=>{a.r(n),a.d(n,{default:()=>P});var t=a(83468),i=a(16162),r=a(17413),o=a(25339),l=a(33273),s=a(15840),d=a(60875),c=a(2381),u=a(58736),m=a(40379),h=a(24717),g=a(90214),w=a(73277),p=a(65080),v=a(24377),b=a(82745),k=a(76998),$=a(77678),f=a(3606),S=a(23446);const P=e=>{let{onRequestClose:n,onRequestRefresh:a,isRefreshModalPending:P,totpSupported:A,queryRef:C,...I}=e;const{t:y}=(0,$.Bd)(),x=(0,k.useRef)(null),[M,j]=h.Ay.useMessage(),[E,z]=g.A.useModal(),[_,{toggle:N}]=(0,m.A)(!1),O=(0,t.CX)(),q=(0,i.Am)(),[T,F]=(0,i.U6)(),{user:H}=(0,f.usePreloadedQuery)(d.j,C),R=(0,r.ET)({mutationFn:()=>O.remove_totp()});return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(o.A,{...I,okText:y("webui.menu.Update"),cancelText:y("webui.menu.Cancel"),onCancel:()=>{n()},confirmLoading:T.isPendingMutation,onOk:()=>(()=>{var e;null===(e=x.current)||void 0===e||e.validateFields().then((e=>{F.updateFullName(e.full_name,{onSuccess:a=>{a!==T.full_name&&M.open({type:"success",content:y("webui.menu.FullnameUpdated")}),e.newPassword&&e.newPasswordConfirm&&e.originalPassword?F.updatePassword({new_password:e.newPassword,new_password2:e.newPasswordConfirm,old_password:e.originalPassword},{onSuccess:()=>{M.open({type:"success",content:y("webui.menu.PasswordUpdated")}),n(!0)},onError:e=>{M.open({type:"error",content:e.message})}}):n(!0)},onError:e=>{M.open({type:"error",content:e.message})}})})).catch((()=>{}))})(),centered:!0,destroyOnClose:!0,title:y("webui.menu.MyAccountInformation"),children:[(0,S.jsx)(w.A,{spinning:P,indicator:(0,S.jsx)(c.A,{}),children:(0,S.jsxs)(p.A,{ref:x,layout:"vertical",labelCol:{span:8},initialValues:{full_name:T.full_name,totp_activated:(null===H||void 0===H?void 0:H.totp_activated)||!1},preserve:!1,children:[(0,S.jsx)(p.A.Item,{name:"full_name",label:y("webui.menu.FullName"),rules:[()=>({validator:(e,n)=>n&&n.length<65?Promise.resolve():Promise.reject(new Error(y("webui.menu.FullNameInvalid")))})],children:(0,S.jsx)(v.A,{})}),(0,S.jsx)(p.A.Item,{name:"originalPassword",label:y("webui.menu.OriginalPassword"),rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,a)=>a||!n("newPassword")&&!n("newPasswordConfirm")?Promise.resolve():Promise.reject(new Error(y("webui.menu.InputOriginalPassword")))}}],dependencies:["newPassword","newPasswordConfirm"],children:(0,S.jsx)(v.A.Password,{})}),(0,S.jsx)(p.A.Item,{name:"newPassword",label:y("webui.menu.NewPassword"),rules:[{pattern:"superadmin"===q?void 0:l.passwordPattern,message:y("webui.menu.InvalidPasswordMessage")}],children:(0,S.jsx)(v.A.Password,{})}),(0,S.jsx)(p.A.Item,{name:"newPasswordConfirm",label:y("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],rules:[e=>{let{getFieldValue:n}=e;return{validator:(e,a)=>a&&n("newPassword")!==a?Promise.reject(new Error(y("webui.menu.NewPasswordMismatch"))):Promise.resolve()}}],children:(0,S.jsx)(v.A.Password,{})}),!!A&&(0,S.jsx)(p.A.Item,{name:"totp_activated",label:y("webui.menu.TotpActivated"),valuePropName:"checked",children:(0,S.jsx)(b.A,{loading:R.isPending,onChange:e=>{var n;e?N():null!==H&&void 0!==H&&H.totp_activated&&(null===(n=x.current)||void 0===n||n.setFieldValue("totp_activated",!0),E.confirm({title:y("totp.TurnOffTotp"),icon:(0,S.jsx)(u.A,{}),content:y("totp.ConfirmTotpRemovalBody"),okText:y("button.Yes"),okType:"danger",cancelText:y("button.No"),onOk(){R.mutate(void 0,{onSuccess:()=>{var e;h.Ay.success(y("totp.RemoveTotpSetupCompleted")),a(),null===(e=x.current)||void 0===e||e.setFieldValue("totp_activated",!1)},onError:e=>{h.Ay.error(e.message)}})},onCancel(){var e;null===(e=x.current)||void 0===e||e.setFieldValue("totp_activated",!0)}}))}})})]})}),!!A&&(0,S.jsx)(s.A,{userFrgmt:H,open:_,onRequestClose:e=>{var n;e?a():null===(n=x.current)||void 0===n||n.setFieldValue("totp_activated",!1);N()}})]}),j,z]})}},82156:(e,n,a)=>{a.d(n,{A:()=>s});var t=a(58168),i=a(76998);const r={icon:function(e,n){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z",fill:e}},{tag:"path",attrs:{d:"M172.2 828.1h679.6L512 239.9 172.2 828.1zM560 720a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm-16-304v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8z",fill:n}},{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z",fill:e}}]}},name:"warning",theme:"twotone"};var o=a(76228),l=function(e,n){return i.createElement(o.A,(0,t.A)({},e,{ref:n,icon:r}))};const s=i.forwardRef(l)},82745:(e,n,a)=>{a.d(n,{A:()=>N});var t=a(76998),i=a(2381),r=a(34156),o=a.n(r),l=a(58168),s=a(64467),d=a(5544),c=a(80045),u=a(23551),m=a(36782),h=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],g=t.forwardRef((function(e,n){var a,i=e.prefixCls,r=void 0===i?"rc-switch":i,g=e.className,w=e.checked,p=e.defaultChecked,v=e.disabled,b=e.loadingIcon,k=e.checkedChildren,$=e.unCheckedChildren,f=e.onClick,S=e.onChange,P=e.onKeyDown,A=(0,c.A)(e,h),C=(0,u.A)(!1,{value:w,defaultValue:p}),I=(0,d.A)(C,2),y=I[0],x=I[1];function M(e,n){var a=y;return v||(x(a=e),null===S||void 0===S||S(a,n)),a}var j=o()(r,g,(a={},(0,s.A)(a,"".concat(r,"-checked"),y),(0,s.A)(a,"".concat(r,"-disabled"),v),a));return t.createElement("button",(0,l.A)({},A,{type:"button",role:"switch","aria-checked":y,disabled:v,className:j,ref:n,onKeyDown:function(e){e.which===m.A.LEFT?M(!1,e):e.which===m.A.RIGHT&&M(!0,e),null===P||void 0===P||P(e)},onClick:function(e){var n=M(!y,e);null===f||void 0===f||f(n,e)}}),b,t.createElement("span",{className:"".concat(r,"-inner")},t.createElement("span",{className:"".concat(r,"-inner-checked")},k),t.createElement("span",{className:"".concat(r,"-inner-unchecked")},$)))}));g.displayName="Switch";const w=g;var p=a(45127),v=a(28037),b=a(8565),k=a(67295),$=a(17996),f=a(16420),S=a(64663),P=a(6132),A=a(99254);const C=e=>{const{componentCls:n,trackHeightSM:a,trackPadding:t,trackMinWidthSM:i,innerMinMarginSM:r,innerMaxMarginSM:o,handleSizeSM:l,calc:s}=e,d=`${n}-inner`,c=(0,$.zA)(s(l).add(s(t).mul(2)).equal()),u=(0,$.zA)(s(o).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:i,height:a,lineHeight:(0,$.zA)(a),[`${n}-inner`]:{paddingInlineStart:o,paddingInlineEnd:r,[`${d}-checked, ${d}-unchecked`]:{minHeight:a},[`${d}-checked`]:{marginInlineStart:`calc(-100% + ${c} - ${u})`,marginInlineEnd:`calc(100% - ${c} + ${u})`},[`${d}-unchecked`]:{marginTop:s(a).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:l,height:l},[`${n}-loading-icon`]:{top:s(s(l).sub(e.switchLoadingIconSize)).div(2).equal(),fontSize:e.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:r,paddingInlineEnd:o,[`${d}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${d}-unchecked`]:{marginInlineStart:`calc(100% - ${c} + ${u})`,marginInlineEnd:`calc(-100% + ${c} - ${u})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${(0,$.zA)(s(l).add(t).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${d}`]:{[`${d}-unchecked`]:{marginInlineStart:s(e.marginXXS).div(2).equal(),marginInlineEnd:s(e.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${d}`]:{[`${d}-checked`]:{marginInlineStart:s(e.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:s(e.marginXXS).div(2).equal()}}}}}}},I=e=>{const{componentCls:n,handleSize:a,calc:t}=e;return{[n]:{[`${n}-loading-icon${e.iconCls}`]:{position:"relative",top:t(t(a).sub(e.fontSize)).div(2).equal(),color:e.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:e.switchColor}}}},y=e=>{const{componentCls:n,trackPadding:a,handleBg:t,handleShadow:i,handleSize:r,calc:o}=e,l=`${n}-handle`;return{[n]:{[l]:{position:"absolute",top:a,insetInlineStart:a,width:r,height:r,transition:`all ${e.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:t,borderRadius:o(r).div(2).equal(),boxShadow:i,transition:`all ${e.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${l}`]:{insetInlineStart:`calc(100% - ${(0,$.zA)(o(r).add(a).equal())})`},[`&:not(${n}-disabled):active`]:{[`${l}::before`]:{insetInlineEnd:e.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${l}::before`]:{insetInlineEnd:0,insetInlineStart:e.switchHandleActiveInset}}}}},x=e=>{const{componentCls:n,trackHeight:a,trackPadding:t,innerMinMargin:i,innerMaxMargin:r,handleSize:o,calc:l}=e,s=`${n}-inner`,d=(0,$.zA)(l(o).add(l(t).mul(2)).equal()),c=(0,$.zA)(l(r).mul(2).equal());return{[n]:{[s]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:r,paddingInlineEnd:i,transition:`padding-inline-start ${e.switchDuration} ease-in-out, padding-inline-end ${e.switchDuration} ease-in-out`,[`${s}-checked, ${s}-unchecked`]:{display:"block",color:e.colorTextLightSolid,fontSize:e.fontSizeSM,transition:`margin-inline-start ${e.switchDuration} ease-in-out, margin-inline-end ${e.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:a},[`${s}-checked`]:{marginInlineStart:`calc(-100% + ${d} - ${c})`,marginInlineEnd:`calc(100% - ${d} + ${c})`},[`${s}-unchecked`]:{marginTop:l(a).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${s}`]:{paddingInlineStart:i,paddingInlineEnd:r,[`${s}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${s}-unchecked`]:{marginInlineStart:`calc(100% - ${d} + ${c})`,marginInlineEnd:`calc(-100% + ${d} - ${c})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${s}`]:{[`${s}-unchecked`]:{marginInlineStart:l(t).mul(2).equal(),marginInlineEnd:l(t).mul(-1).mul(2).equal()}},[`&${n}-checked ${s}`]:{[`${s}-checked`]:{marginInlineStart:l(t).mul(-1).mul(2).equal(),marginInlineEnd:l(t).mul(2).equal()}}}}}},M=e=>{const{componentCls:n,trackHeight:a,trackMinWidth:t}=e;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},(0,S.dF)(e)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:t,height:a,lineHeight:`${(0,$.zA)(a)}`,verticalAlign:"middle",background:e.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${e.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:e.colorTextTertiary}}),(0,S.K8)(e)),{[`&${n}-checked`]:{background:e.switchColor,[`&:hover:not(${n}-disabled)`]:{background:e.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:e.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},j=(0,P.OF)("Switch",(e=>{const n=(0,A.oX)(e,{switchDuration:e.motionDurationMid,switchColor:e.colorPrimary,switchDisabledOpacity:e.opacityLoading,switchLoadingIconSize:e.calc(e.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${e.opacityLoading})`,switchHandleActiveInset:"-30%"});return[M(n),x(n),y(n),I(n),C(n)]}),(e=>{const{fontSize:n,lineHeight:a,controlHeight:t,colorWhite:i}=e,r=n*a,o=t/2,l=r-4,s=o-4;return{trackHeight:r,trackHeightSM:o,trackMinWidth:2*l+8,trackMinWidthSM:2*s+4,trackPadding:2,handleBg:i,handleSize:l,handleSizeSM:s,handleShadow:`0 2px 4px 0 ${new f.q("#00230b").setAlpha(.2).toRgbString()}`,innerMinMargin:l/2,innerMaxMargin:l+2+4,innerMinMarginSM:s/2,innerMaxMarginSM:s+2+4}}));var E=function(e,n){var a={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.indexOf(t)<0&&(a[t]=e[t]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(t=Object.getOwnPropertySymbols(e);i<t.length;i++)n.indexOf(t[i])<0&&Object.prototype.propertyIsEnumerable.call(e,t[i])&&(a[t[i]]=e[t[i]])}return a};const z=t.forwardRef(((e,n)=>{const{prefixCls:a,size:r,disabled:l,loading:s,className:d,rootClassName:c,style:m,checked:h,value:g,defaultChecked:$,defaultValue:f,onChange:S}=e,P=E(e,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[A,C]=(0,u.A)(!1,{value:null!==h&&void 0!==h?h:g,defaultValue:null!==$&&void 0!==$?$:f}),{getPrefixCls:I,direction:y,switch:x}=t.useContext(v.QO),M=t.useContext(b.A),z=(null!==l&&void 0!==l?l:M)||s,_=I("switch",a),N=t.createElement("div",{className:`${_}-handle`},s&&t.createElement(i.A,{className:`${_}-loading-icon`})),[O,q,T]=j(_),F=(0,k.A)(r),H=o()(null===x||void 0===x?void 0:x.className,{[`${_}-small`]:"small"===F,[`${_}-loading`]:s,[`${_}-rtl`]:"rtl"===y},d,c,q,T),R=Object.assign(Object.assign({},null===x||void 0===x?void 0:x.style),m);return O(t.createElement(p.A,{component:"Switch"},t.createElement(w,Object.assign({},P,{checked:A,onChange:function(){C(arguments.length<=0?void 0:arguments[0]),null===S||void 0===S||S.apply(void 0,arguments)},prefixCls:_,className:H,style:R,disabled:z,ref:n,loadingIcon:N}))))})),_=z;_.__ANT_SWITCH=!0;const N=_}}]);
//# sourceMappingURL=807.b2e30b65.chunk.js.map