"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[266],{9277:function(e,n,a){var i=a(1413),t=a(4925),s=a(4036),l=(a(4519),a(2556)),r=["direction","wrap","justify","align","gap","style","children"];n.Z=function(e){var n=e.direction,a=void 0===n?"row":n,o=e.wrap,u=void 0===o?"nowrap":o,d=e.justify,c=void 0===d?"flex-start":d,g=e.align,m=void 0===g?"center":g,f=e.gap,p=void 0===f?0:f,k=e.style,y=e.children,v=(0,t.Z)(e,r),h=s.Z.useToken().token,S=[c,m],b=null===S||void 0===S?void 0:S.map((function(e){var n;switch(e){case"start":n="flex-start";break;case"end":n="flex-end";break;case"between":n="space-between";break;case"around":n="space-around";break;default:n=e}return n})),x=(0,i.Z)({display:"flex",flexDirection:a,flexWrap:u,justifyContent:b[0],alignItems:b[1]},k);return(0,l.jsx)("div",(0,i.Z)((0,i.Z)({style:(0,i.Z)({alignItems:"stretch",backgroundColor:"transparent",border:"0 solid black",boxSizing:"border-box",display:"flex",flexBasis:"auto",flexDirection:"column",flexShrink:0,listStyle:"none",margin:0,minHeight:0,minWidth:0,padding:0,position:"relative",textDecoration:"none",gap:"string"===typeof p?h["padding"+p.toUpperCase()]:p},x)},v),{},{children:y}))}},4001:function(e,n,a){var i=a(1413),t=a(9439),s=a(4519),l=a(7760),r=a(2556),o=function(e,n){var a=e.image,s=e.style,o=void 0===s?{}:s,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=(0,l.dS)(),c=(0,t.Z)(d,2)[1].getImageIcon;return(0,r.jsx)("img",{src:c(a),style:(0,i.Z)({width:"1.5em",height:"1.5em"},o),alt:u})};n.Z=s.memo(o)},3173:function(e,n,a){a.r(n);var i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionInfoCellFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null}],type:"ComputeSession",abstractKey:null,hash:"93f8cd0d4b47d24ea281955be0ad792b"};n.default=i},2428:function(e,n,a){a.r(n);var i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"ak"},n={defaultValue:null,kind:"LocalArgument",name:"group_id"},a={defaultValue:null,kind:"LocalArgument",name:"limit"},i={defaultValue:null,kind:"LocalArgument",name:"offset"},t={defaultValue:null,kind:"LocalArgument",name:"skipClusterSize"},s={defaultValue:null,kind:"LocalArgument",name:"status"},l=[{kind:"Variable",name:"access_key",variableName:"ak"},{kind:"Variable",name:"group_id",variableName:"group_id"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"status",variableName:"status"}],r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"starts_at",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null};return{fragment:{argumentDefinitions:[e,n,a,i,t,s],kind:"Fragment",metadata:null,name:"SessionListQuery",selections:[{alias:null,args:l,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,g,m,f,p,k,y,v,h,S,b,x,{args:null,kind:"FragmentSpread",name:"SessionInfoCellFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,i,e,n,s,t],kind:"Operation",name:"SessionListQuery",selections:[{alias:null,args:l,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,g,m,f,p,k,y,v,h,S,b,x,{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"e152f44d42d7fc4a33606a935adc582f",id:null,metadata:{},name:"SessionListQuery",operationKind:"query",text:"query SessionListQuery(\n  $limit: Int!\n  $offset: Int!\n  $ak: String\n  $group_id: String\n  $status: String\n  $skipClusterSize: Boolean!\n) {\n  compute_session_list(limit: $limit, offset: $offset, access_key: $ak, group_id: $group_id, status: $status) {\n    items {\n      id\n      type\n      session_id\n      name\n      image\n      architecture\n      created_at\n      terminated_at\n      status\n      status_info\n      service_ports\n      mounts\n      occupied_slots\n      access_key\n      starts_at\n      cluster_size @skipOnClient(if: $skipClusterSize)\n      ...SessionInfoCellFragment\n    }\n  }\n}\n\nfragment SessionInfoCellFragment on ComputeSession {\n  id\n  session_id\n  name\n  status\n  user_email\n  image\n}\n"}}}();i.hash="c41131439f810b7c5cd0bd9eb2857a46",n.default=i},7760:function(e,n,a){a.d(n,{Dj:function(){return d},Kr:function(){return l},M:function(){return u},dS:function(){return c},qh:function(){return o},tQ:function(){return r}});var i=a(9439),t=a(4519),s=a(7112),l=function(e){return function(e){var n=(0,t.useState)(e||(new Date).toISOString()),a=(0,i.Z)(n,2),s=a[0],l=a[1];return[s,function(e){l(e||(new Date).toISOString())}]}(e)},r=function(){return d()._config.domainName},o=function(){var e=d(),n=(0,t.useState)({name:e.current_group,id:e.groupIds[e.current_group]}),a=(0,i.Z)(n,2),s=a[0],l=a[1];return(0,t.useEffect)((function(){var n=function(n){var a=n.detail;l({name:a,id:e.groupIds[a]})};return document.addEventListener("backend-ai-group-changed",n),function(){document.removeEventListener("backend-ai-group-changed",n)}})),s},u=function(e){var n=e.api_endpoint;return(0,t.useMemo)((function(){var e=new globalThis.BackendAIClientConfig("","",n,"SESSION");return new globalThis.BackendAIClient(e,"Backend.AI Console.")}),[n])},d=function(){return(0,s.useQuery)({queryKey:"backendai-client-for-suspense",queryFn:function(){return new Promise((function(e){if("undefined"!==typeof globalThis.backendaiclient&&null!==globalThis.backendaiclient&&!1!==globalThis.backendaiclient.ready)return e(globalThis.backendaiclient);document.addEventListener("backend-ai-connected",(function n(){e(globalThis.backendaiclient),document.removeEventListener("backend-ai-connected",n)}))}))},retry:!1,suspense:!0}).data},c=function(){var e=(0,s.useQuery)({queryKey:"backendai-metadata-for-suspense",queryFn:function(){return fetch("resources/image_metadata.json").then((function(e){return e.json()})).then((function(e){return e}))},suspense:!0,retry:!1}).data,n=function(e){if(!e)return{key:"",tags:[]};var n=e.split("/"),a=(n[2]||n[1]).split(":"),t=(0,i.Z)(a,2);return{key:t[0],tags:t[1].split("-")}};return[e,{getImageAliasName:function(a){var i=n(a).key;return(null===e||void 0===e?void 0:e.imageInfo[i].name)||i},getImageIcon:function(a){var i,t,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"resources/icons/";if(!a)return"default.png";var l=n(a).key;return s+(void 0!==(null===e||void 0===e||null===(i=e.imageInfo[l])||void 0===i?void 0:i.icon)?null===e||void 0===e||null===(t=e.imageInfo[l])||void 0===t?void 0:t.icon:"default.png")},getImageTags:function(e){},getBaseVersion:function(e){return n(e).tags[0]},getBaseImage:function(e){return n(e).tags[1]},getImageMeta:n}]}},164:function(e,n,a){a.d(n,{Y:function(){return s},h:function(){return t}});var i=a(7112),t=i.useQuery,s=i.useMutation},6266:function(e,n,a){a.r(n),a.d(n,{default:function(){return D}});var i,t,s=a(3433),l=a(9439),r=a(4036),o=a(2176),u=a(8499),d=a(5850),c=a(7600),g=a(4519),m=a(9277),f=a(1748),p=a(9781),k=a(1413),y=a(4925),v=a(3510),h=a(6980),S=a(3572),b=a(8818),x=a(2513),I=a(1749),_=a(7760),j=a(4001),F=a(2556),Z=function(e,n){var a=e.image;e.style;a=a||"";var i=(0,_.dS)(),t=(0,l.Z)(i,2)[1],s=t.getImageAliasName,r=t.getBaseVersion,o=t.getBaseImage;return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("div",{children:s(a)}),(0,F.jsx)("div",{children:r(a)}),(0,F.jsx)("div",{children:o(a)})]})},K=g.memo(Z),L=a(164),C=function(e){var n=e.sessionFrgmt,t=e.onRename,s=(0,_.Dj)(),o=r.Z.useToken().token,d=(0,h.useFragment)(void 0!==i?i:i=a(3173),n),c=(0,L.Y)({mutationFn:function(e){var n=s.APIMajorVersion<5?d.name:d.session_id;return s.rename(n,e)}}),p=S.Z.useForm(),k=(0,l.Z)(p,1)[0],y=(0,f.$G)().t,v=(0,g.useState)(!1),Z=(0,l.Z)(v,2),C=Z[0],N=Z[1],T=(0,g.useState)(d.name),E=(0,l.Z)(T,2),R=E[0],D=E[1],w=function(){return["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(d.status||void 0)&&!function(){return["RESTARTING","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(d.status||void 0)&&s.email===d.user_email,A=c.isLoading||R!==d.name;return(0,F.jsxs)(m.Z,{direction:"column",children:[(0,F.jsx)(m.Z,{direction:"row",children:(0,F.jsx)(S.Z,{form:k,children:C?(0,F.jsx)(S.Z.Item,{style:{margin:0},name:"name",rules:[{required:!0},{max:64},{pattern:/^(?:[a-zA-Z0-9][a-zA-Z0-9._-]{2,}[a-zA-Z0-9])?$/,message:y("session.Validation.EnterValidSessionName").toString()}],children:(0,F.jsx)(b.Z,{autoFocus:!0,onPressEnter:function(){k.validateFields().then((function(e){var n=e.name;N(!1),D(n),c.mutate(n,{onSuccess:function(e){t&&t()},onError:function(e){D(d.name)}})}))},onKeyUp:function(e){"Escape"===e.key&&N(!1)}})}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(u.Z.Text,{style:{opacity:A?.5:1},children:R}),w&&(0,F.jsx)(x.ZP,{loading:A,type:"text",icon:(0,F.jsx)(I.Z,{}),style:{color:o.colorLink},onClick:function(){k.setFieldsValue({name:d.name}),N(!0)}})]})})}),(0,F.jsx)(j.Z,{image:d.image}),(0,F.jsx)(K,{image:d.image})]})},N=["status","limit","currentPage","pageSize","projectId","filter","extraFetchKey"],T=function(e){var n,i=e.status,s=void 0===i?[]:i,r=(e.limit,e.currentPage),o=void 0===r?1:r,u=e.pageSize,d=void 0===u?50:u,c=e.projectId,m=e.filter,p=e.extraFetchKey,S=void 0===p?"":p,b=(0,y.Z)(e,N),x=(0,_.Dj)(),I=(0,_.Kr)("initial-fetch"),j=(0,l.Z)(I,2),Z=j[0],K=j[1],L=(0,g.useDeferredValue)(Z+S),T=(0,f.$G)().t;!x.supports("avoid-hol-blocking")&&s.includes("SCHEDULED")&&(s=s.filter((function(e){return"SCHEDULED"!==e})));var E=(0,h.useLazyLoadQuery)(void 0!==t?t:t=a(2428),{limit:d,offset:(o-1)*d,status:null===(n=s)||void 0===n?void 0:n.join(","),group_id:c,skipClusterSize:!x.supports("multi-container")},{fetchKey:L,fetchPolicy:"network-only"}).compute_session_list;return(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(v.Z,(0,k.Z)({scroll:{x:!0},columns:[{title:T("session.SessionInfo"),render:function(e,n,a){return console.log(n),(0,F.jsx)(C,{sessionFrgmt:n,onRename:function(){K(n.session_id+(new Date).toISOString())}},n.session_id)},fixed:"left"},{title:T("session.Status"),dataIndex:"status"},{title:T("general.Control")},{title:T("session.Configuration")},{title:T("session.Usage")},{title:T("session.Reservation")},{title:T("session.Architecture")},{title:T("session.SessionType")},{title:T("session.Agent")}],dataSource:((null===E||void 0===E?void 0:E.items)||[]).filter(m)},b))})},E=["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"],R={running:E,interactive:E,batch:E,inference:E,finished:["TERMINATED","CANCELLED"],others:["TERMINATING","ERROR"],default:E},D=function(e){var n=e.children,a=(0,f.$G)().t,i=(0,_.Dj)(),t=r.Z.useToken().token,k=(0,_.qh)(),y=(0,g.useState)("running"),v=(0,l.Z)(y,2),h=v[0],S=v[1],b=(0,g.useState)("next"),x=(0,l.Z)(b,2),I=x[0],j=x[1];return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(o.Z,{message:(0,F.jsxs)(m.Z,{gap:"md",children:[(0,F.jsxs)(u.Z.Text,{children:["This is"," ","current"===I?"current version":"NEXT generation"," ","of session list. you can switch anytime."]}),(0,F.jsx)(d.Z,{options:[{label:"Current",value:"current"},{label:(0,F.jsx)(u.Z.Text,{style:{color:"next"===I?t.colorPrimary:void 0},children:"Next"}),value:"next",icon:(0,F.jsx)(p.Z,{twoToneColor:t.colorWarning})}],value:I,onChange:function(e){return j(e)}})]}),type:"warning",banner:!0,style:{marginTop:-14,marginLeft:-14,marginRight:-14}}),"next"===I?(0,F.jsxs)(m.Z,{direction:"column",align:"stretch",style:{padding:t.padding,gap:t.margin},children:[n,(0,F.jsxs)(m.Z,{direction:"column",align:"stretch",children:[(0,F.jsx)(m.Z,{style:{flex:1},children:(0,F.jsx)(c.Z,{activeKey:h,onChange:function(e){return S(e)},tabBarStyle:{marginBottom:0},style:{width:"100%",paddingLeft:t.paddingMD,paddingRight:t.paddingMD,borderTopLeftRadius:t.borderRadius,borderTopRightRadius:t.borderRadius},items:[{key:"running",label:a("session.Running")},{key:"interactive",label:a("session.Interactive")},{key:"batch",label:a("session.Batch")}].concat((0,s.Z)(i.supports("inference-workload")?[{key:"inference",label:a("session.Inference")}]:[]),[{key:"finished",label:a("session.Finished")},{key:"others",label:a("session.Others")}]),tabBarExtraContent:{right:(0,F.jsx)(m.Z,{direction:"row",gap:"sm",children:(0,F.jsx)("backend-ai-session-launcher",{location:"session",id:"session-launcher",active:!0})})}})}),(0,F.jsx)(g.Suspense,{fallback:(0,F.jsx)("div",{children:"loading.."}),children:(0,F.jsx)(T,{projectId:k.id,status:R[h]||R.default,filter:function(e){var n;return!["interactive","batch","inference"].includes(h)||(null===e||void 0===e||null===(n=e.type)||void 0===n?void 0:n.toLowerCase())===h},extraFetchKey:h})})]})]}):(0,F.jsx)(F.Fragment,{children:(0,F.jsx)("backend-ai-session-view",{class:"page",name:"job",active:!0})})]})}}}]);
//# sourceMappingURL=266.e40affab.chunk.js.map