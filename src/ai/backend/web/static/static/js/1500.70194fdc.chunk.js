"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[1500],{31500:(e,n,t)=>{t.r(n),t.d(n,{default:()=>j});var r,a=t(83468),i=t(25339),o=t(87985),l=t(29871),s=t(97041),d=t(5336),u=t(78969),c=t(50840),m=t(24717),p=t(24128),g=t(65080),v=t(24377),h=t(6932),A=t(45901),y=t.n(A),f=t(76998),k=t(77678),x=t(3606),b=t(23446);const j=e=>{let{...n}=e;const{t:A}=(0,k.Bd)(),j=(0,a.CX)(),M=f.useRef(null),P=u.A.useApp(),{token:I}=c.A.useToken(),{parsedValue:{open:w,image:N,servicePorts:$},dispatchEvent:C}=(0,o.useWebComponentInfo)(),[S,V]=(0,x.useMutation)(void 0!==r?r:r=t(23258));return(0,b.jsxs)(i.A,{destroyOnClose:!0,open:w,onOk:()=>{var e;null===(e=M.current)||void 0===e||e.validateFields().then((()=>{var e;const n=null===(e=M.current)||void 0===e?void 0:e.getFieldValue("apps").map((e=>`${e.app}:${e.protocol}:${e.port}`)).join(","),t=y().map(N.labels,((e,t)=>t.includes("service-ports")?{key:t,value:n}:{key:t,value:(null===e||void 0===e?void 0:e.toString())||""})),r=()=>S({variables:{target:`${N.registry}/${N.name}:${N.tag}`,architecture:N.architecture,props:{labels:t,resource_limits:j.isManagerVersionCompatibleWith("24.03.4.*")?void 0:null}},onCompleted:(e,n)=>{var t,r;if(null!==e&&void 0!==e&&null!==(t=e.modify_image)&&void 0!==t&&t.ok)if(n&&(null===n||void 0===n?void 0:n.length)>0){const e=y().map(n,(e=>e.message));for(const n of e)m.Ay.error(n,2.5)}else m.Ay.success(A("environment.DescImagePortsModified")),C("ok",null);else m.Ay.error(null===e||void 0===e||null===(r=e.modify_image)||void 0===r?void 0:r.msg)},onError:e=>{m.Ay.error(A("dialog.ErrorOccurred"))}});N.installed?P.modal.confirm({title:"Image reinstallation required",content:(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(k.x6,{i18nKey:"environment.ModifyImageResourceLimitReinstallRequired"})}),onOk:r,getContainer:()=>document.body,closable:!0}):r()})).catch((e=>{}))},onCancel:()=>C("cancel",null),confirmLoading:V,title:A("environment.ManageApps"),...n,children:[(0,b.jsxs)(l.A,{direction:"row",style:{width:"100%",marginBottom:I.marginXS},children:[(0,b.jsx)(p.A.Text,{strong:!0,style:{width:"32%"},children:A("environment.AppName")}),(0,b.jsx)(p.A.Text,{strong:!0,style:{width:"32%"},children:A("environment.Protocol")}),(0,b.jsx)(p.A.Text,{strong:!0,style:{width:"32%"},children:A("environment.Port")}),(0,b.jsx)(l.A,{})]}),(0,b.jsx)(g.A,{ref:M,layout:"vertical",autoComplete:"off",initialValues:{apps:$},requiredMark:!1,children:(0,b.jsx)(l.A,{direction:"column",children:(0,b.jsx)(g.A.List,{name:"apps",children:(e,n)=>{let{add:t,remove:r}=n;return(0,b.jsxs)(l.A,{direction:"column",style:{width:"100%"},children:[y().map(e,((e,n)=>(0,b.jsx)(g.A.Item,{children:(0,b.jsxs)(l.A,{direction:"row",gap:"xs",children:[(0,b.jsx)(g.A.Item,{...e,name:[e.name,"app"],noStyle:!0,rules:[{required:!0,message:A("environment.AppNameMustNotBeEmpty")}],children:(0,b.jsx)(v.A,{placeholder:A("environment.AppName")})}),(0,b.jsx)(g.A.Item,{...e,name:[e.name,"protocol"],noStyle:!0,rules:[{pattern:/^(http|tcp|pty|preopen)$/,required:!0,message:A("environment.ProtocolMustBeOneOfSupported")}],children:(0,b.jsx)(v.A,{placeholder:A("environment.Protocol")})}),(0,b.jsx)(g.A.Item,{...e,name:[e.name,"port"],noStyle:!0,rules:[{validator:(e,n)=>{const t=y().isUndefined(n)||""===n?NaN:y().toNumber(n);return y().isNaN(t)||t<0||t>=65535?Promise.reject(A("environment.PortMustBeInRange")):[2e3,2001,2002,2003,2200,7681].includes(Number(t))?Promise.reject(A("environment.PortReservedForInternalUse")):Promise.resolve()}},{validator:(e,t)=>{var r;const a=null===(r=M.current)||void 0===r?void 0:r.getFieldValue("apps");return y().isString(t)&&t.length>0&&a.some(((e,r)=>r!==n&&(null===e||void 0===e?void 0:e.port)===t))?Promise.reject(A("environment.PortMustBeUnique")):Promise.resolve()}}],children:(0,b.jsx)(v.A,{placeholder:A("environment.Port")})}),(0,b.jsx)(h.Ay,{type:"text",danger:!0,onClick:()=>r(e.name),style:0===n?{width:"10%",marginTop:8}:{width:"10%"},icon:(0,b.jsx)(s.A,{})})]},e.key)}))),(0,b.jsx)(h.Ay,{type:"dashed",onClick:()=>t(),block:!0,icon:(0,b.jsx)(d.A,{}),children:A("button.Add")})]})}})})})]})}},23258:(e,n,t)=>{t.r(n),t.d(n,{default:()=>a});const r=function(){var e={defaultValue:null,kind:"LocalArgument",name:"architecture"},n={defaultValue:null,kind:"LocalArgument",name:"props"},t={defaultValue:null,kind:"LocalArgument",name:"target"},r=[{alias:null,args:[{kind:"Variable",name:"architecture",variableName:"architecture"},{kind:"Variable",name:"props",variableName:"props"},{kind:"Variable",name:"target",variableName:"target"}],concreteType:"ModifyImage",kind:"LinkedField",name:"modify_image",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n,t],kind:"Fragment",metadata:null,name:"ManageAppsModalMutation",selections:r,type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[t,e,n],kind:"Operation",name:"ManageAppsModalMutation",selections:r},params:{cacheID:"b7a57119037085ec9f08346991633e0a",id:null,metadata:{},name:"ManageAppsModalMutation",operationKind:"mutation",text:"mutation ManageAppsModalMutation(\n  $target: String!\n  $architecture: String\n  $props: ModifyImageInput!\n) {\n  modify_image(target: $target, architecture: $architecture, props: $props) {\n    ok\n    msg\n  }\n}\n"}}}();r.hash="bb280196745e96f5c488d1d785a5b012";const a=r}}]);
//# sourceMappingURL=1500.70194fdc.chunk.js.map