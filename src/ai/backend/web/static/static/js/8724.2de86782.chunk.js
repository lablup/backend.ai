"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[8724],{59727:(e,n,t)=>{t.d(n,{A:()=>p});var l=t(56276),s=t(11863),i=t(17012),a=t(66298),r=t(47671),o=t.n(r),d=t(60669),c=t.n(d),u=t(29262),m=t(26862);const h=["value","onChange","localFormat"],v=u.forwardRef(((e,n)=>{let{value:t,onChange:r,localFormat:d}=e,u=(0,s.A)(e,h);const[,v]=(0,i.A)({value:t,onChange:r});return(0,m.jsx)(a.A,(0,l.A)({ref:n,value:t?o()(t):void 0,onChange:e=>{var n,t,l;c().isArray(e)&&(e=e[0]);const s=d?null===(n=e)||void 0===n?void 0:n.format():null===(t=e)||void 0===t||null===(l=t.tz())||void 0===l?void 0:l.toISOString();v(s)}},u))}));v.displayName="DatePickerISO";const p=v},89147:(e,n,t)=>{t.d(n,{A:()=>d});var l=t(56276),s=t(11863),i=t(66203),a=t(29262),r=t(26862);const o=["value"],d=e=>{let{value:n}=e,t=(0,s.A)(e,o);const d=i.A.useFormInstance();return(0,a.useEffect)((()=>{d.setFieldValue(t.name,n)}),[n,d,t.name]),(0,r.jsx)(i.A.Item,(0,l.A)((0,l.A)({},t),{},{hidden:!0,children:(0,r.jsx)("div",{})}))}},93664:(e,n,t)=>{t.d(n,{f:()=>u});const l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"projectId"},t=[{alias:null,args:[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"project_id",variableName:"projectId"}],concreteType:"ComputeSessionConnection",kind:"LinkedField",name:"compute_session_nodes",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"count",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n],kind:"Fragment",metadata:null,name:"useValidateSessionNameQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e],kind:"Operation",name:"useValidateSessionNameQuery",selections:t},params:{cacheID:"2392cc957c8d4e1b5ff8eb0717faa135",id:null,metadata:{},name:"useValidateSessionNameQuery",operationKind:"query",text:"query useValidateSessionNameQuery(\n  $projectId: UUID!\n  $filter: String\n) {\n  compute_session_nodes(project_id: $projectId, filter: $filter) {\n    count\n  }\n}\n"}}}();l.hash="4384b91173f16b29861a6bb9cfa6cbfa";const s=l;var i=t(52053),a=t(60669),r=t.n(a),o=t(29262),d=t(99118),c=t(84372);const u=e=>{const{t:n}=(0,d.Bd)(),t=(0,c.useRelayEnvironment)(),l=(0,i.hd)();return(0,o.useMemo)((()=>[{min:4,message:n("session.validation.SessionNameTooShort")},{max:64,message:n("session.validation.SessionNameTooLong64")},{validator:(e,t)=>r().isEmpty(t)?Promise.resolve():/^\w/.test(t)?/\w$/.test(t)?/^[\w.-]*$/.test(t)?Promise.resolve():Promise.reject(n("session.validation.SessionNameInvalidCharacter")):Promise.reject(n("session.validation.SessionNameShouldEndWith")):Promise.reject(n("session.validation.SessionNameShouldStartWith"))},{validator:async(i,a)=>a!==e&&a?(0,c.fetchQuery)(t,s,{projectId:l.id,filter:'status != "TERMINATED" & status != "CANCELLED" & name == "'.concat(a,'"')}).toPromise().catch((()=>{})).then((e=>{var t,l;if((null!==(t=null===e||void 0===e||null===(l=e.compute_session_nodes)||void 0===l?void 0:l.count)&&void 0!==t?t:0)>0)return Promise.reject(n("session.launcher.SessionAlreadyExists"))})):Promise.resolve()},e?{required:!0}:{}]),[e,t,l.id,n])}},98724:(e,n,t)=>{t.r(n),t.d(n,{ResourceNumbersOfSession:()=>De,default:()=>Be});var l=t(56276),s=t(59727),i=t(59078),a=t(77085),r=t(31152),o=t(21334),d=t(67813),c=t(11863),u=t(7075),m=t(59278),h=t(29262),v=t(99118),p=t(26862);const g=["open","onClose"],x=e=>{let{open:n,onClose:t}=e,s=(0,c.A)(e,g);const{t:i}=(0,v.Bd)(),[a,r]=(0,u.q)("has_opened_tour_neo_session_validation"),o=[{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.FixErrorFieldByModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,p.jsx)(m.A,(0,l.A)({steps:o,onClose:e=>{null===t||void 0===t||t(e),r(!0)},open:!a&&n},s))};var j=t(66203),y=t(36961),A=t(60669),b=t.n(A);const F=e=>{let{form:n}=e;const t=j.A.useWatch("mounts",n),l=y.A.useApp(),{t:s}=(0,v.Bd)(),i=(0,h.useMemo)((()=>b().isArray(t)&&t.length>0),[t]);return(0,h.useEffect)((()=>{i&&(l.message.warning(s("session.launcher.InvalidMountsSelectionWarning"),5),n.setFieldValue("mounts",void 0))}),[i,s,l.message,n]),null};var f=t(31871),w=t(37138),S=t(52053),k=t(74065),O=t(93594);const V=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],t={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},s],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[t],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,i],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[t,s],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,i,s],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();V.hash="ba086835ea654ab889e0e6aaefa0abfe";const E=V;var T=t(476),I=t(63590),N=t(89147),C=t(87272),_=t(59005),D=t(71905),B=t(91129),P=t(37717),M=t(22787),z=t(24213),R=t(29268),L=t(49969),q=t(7265),K=t(81188),U=t(84372);const G=e=>{const{t:n}=(0,v.Bd)(),t=j.A.useFormInstance(),s=j.A.useWatch(["owner","enabled"],t),i=(0,T.Am)();return("admin"===i||"superadmin"===i)&&s&&(0,p.jsx)(q.Zuv,(0,l.A)((0,l.A)({title:n("session.launcher.SetSessionOwner"),showDivider:!0,size:"small",status:t.getFieldError(["owner","email"]).length>0||t.getFieldError(["owner","accesskey"]).length>0||t.getFieldError(["owner","project"]).length>0||t.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit")},e),{},{children:(0,p.jsxs)(L.A,{size:"small",column:1,children:[(0,p.jsx)(L.A.Item,{label:n("session.launcher.OwnerEmail"),children:t.getFieldValue(["owner","email"])}),(0,p.jsx)(L.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:t.getFieldValue(["owner","accesskey"])}),(0,p.jsx)(L.A.Item,{label:n("session.launcher.OwnerGroup"),children:t.getFieldValue(["owner","project"])}),(0,p.jsx)(L.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:t.getFieldValue(["owner","resourceGroup"])})]})}))},Q=e=>{const{t:n}=(0,v.Bd)(),{token:t}=C.A.useToken(),s=j.A.useFormInstance(),i=j.A.useWatch(["owner","enabled"],s),[a,r]=(0,h.useState)(),o=(0,U.useRelayEnvironment)(),{data:d,isFetching:c}=(0,I.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",a],queryFn:()=>{const e=s.getFieldValue(["owner","email"]);if(!e)return;const n=E;return(0,U.fetchQuery)(o,n,{email:e}).toPromise()},enabled:!!a}),u=s.getFieldValue(["owner","email"])?null===d||void 0===d?void 0:d.keypairs:void 0,m=s.getFieldValue(["owner","email"])?null===d||void 0===d?void 0:d.user:void 0,g=!c&&a&&!m;return(0,p.jsxs)(_.A,(0,l.A)((0,l.A)({title:n("session.launcher.SetSessionOwner"),extra:(0,p.jsx)(j.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,p.jsx)(D.A,{})}),styles:i?void 0:{header:{borderBottom:"none"},body:{display:i?"block":"none"}}},e),{},{children:[(0,p.jsx)(N.A,{name:["owner","domainName"],value:null===m||void 0===m?void 0:m.domain_name}),(0,p.jsx)(j.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:l}=e;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(q.OOm,{children:(0,p.jsx)(j.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:i},{type:"email",message:n("general.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:g?"error":void 0,help:g?n("credential.NoUserToDisplay"):void 0,children:(0,p.jsx)(B.A.Search,{onSearch:e=>{s.validateFields([["owner","email"]]).then((()=>{r(e)})).catch((()=>{}))},onChange:()=>{r(""),s.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:c,enterButton:!c&&m?(0,p.jsx)(P.Ay,{icon:(0,p.jsx)(K.A,{})}):void 0})})}),(0,p.jsx)(j.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:l(["owner","enabled"])}],children:(0,p.jsx)(q.xrr,{options:b().map(u,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:b().isEmpty(a)||c})}),(0,p.jsxs)(M.A,{gutter:t.marginSM,children:[(0,p.jsx)(z.A,{span:12,children:(0,p.jsx)(j.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:l(["owner","enabled"])}],children:(0,p.jsx)(q.xrr,{options:b().map(null===m||void 0===m?void 0:m.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:b().isEmpty(a)||c})})}),(0,p.jsx)(z.A,{span:12,children:(0,p.jsx)(j.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:t}=e;return(0,p.jsx)(h.Suspense,{fallback:(0,p.jsx)(j.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:t(["owner","enabled"])}],children:(0,p.jsx)(R.A,{loading:!0})}),children:(0,p.jsx)(j.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:t(["owner","enabled"])}],children:t(["owner","project"])?(0,p.jsx)(q.ZPT,{projectName:t(["owner","project"]),disabled:b().isEmpty(a)||c,autoSelectDefault:!0}):(0,p.jsx)(R.A,{disabled:!0})})})}})})]})]})}})]}))};var W=t(55687),H=t(69319),J=t(90464),$=t(86425),Z=t(52251),X=t(79089),Y=t(47671),ee=t.n(Y);const ne=e=>{var n,t,l,s,i,a,r,d,c,u,m,h,g,x,A,F,V,E,T,I,N,D,B,R,K,U,Q,Y,ne,te,le,se,ie,ae,re,oe;let{onClickEditStep:de}=e;const ce=y.A.useApp(),{t:ue}=(0,v.Bd)(),me=j.A.useFormInstance(),{token:he}=C.A.useToken(),ve=(0,w.CX)(),pe=j.A.useWatch("sessionType",{form:me,preserve:!0}),ge=null!==(n=null===ve||void 0===ve?void 0:ve.supports("batch-timeout"))&&void 0!==n&&n,xe=null!==(t=null===ve||void 0===ve?void 0:ve.supports("extended-image-info"))&&void 0!==t&&t,je=(0,S.hd)(),[,{getBaseVersion:ye,getBaseImage:Ae,tagAlias:be}]=(0,w.Gj)();return(0,p.jsxs)(p.Fragment,{children:[me.getFieldValue("bootstrap_script")&&(0,p.jsx)(q.RfO,{description:ue("session.launcher.UsingBootstrapScriptInfo"),ghostInfoBg:!1,action:(0,p.jsx)(P.Ay,{size:"small",type:"text",onClick:()=>{ce.modal.info({title:ue("session.launcher.BootstrapScriptDetail"),content:(0,p.jsxs)(q.OOm,{direction:"column",align:"start",children:[(0,p.jsx)(H.A.Paragraph,{children:ue("userSettings.BootstrapScriptDescription")}),(0,p.jsx)(W.A,{language:"shell",children:me.getFieldValue("bootstrap_script")})]}),width:800})},children:ue("notification.SeeDetail")}),type:"info",showIcon:!0}),(0,p.jsx)(q.Zuv,{title:ue("session.launcher.SessionType"),showDivider:!0,size:"small",status:me.getFieldError("sessionName").length>0||me.getFieldError(["batch","command"]).length>0||me.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("sessionType")},children:(0,p.jsxs)(L.A,{size:"small",column:1,children:[(0,p.jsx)(L.A.Item,{label:ue("session.SessionType"),children:me.getFieldValue("sessionType")}),!b().isEmpty(me.getFieldValue("sessionName"))&&(0,p.jsx)(L.A.Item,{label:ue("session.launcher.SessionName"),children:me.getFieldValue("sessionName")}),"batch"===pe&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(L.A.Item,{label:ue("session.launcher.StartUpCommand"),styles:{label:{whiteSpace:"nowrap"},content:{overflow:"auto"}},children:me.getFieldValue(["batch","command"])?(0,p.jsx)(W.A,{language:"shell",children:me.getFieldValue(["batch","command"])}):(0,p.jsx)(H.A.Text,{type:"secondary",children:ue("general.None")})}),(0,p.jsx)(L.A.Item,{label:ue("session.launcher.SessionStartTime"),children:me.getFieldValue(["batch","scheduleDate"])?ee()(me.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,p.jsx)(H.A.Text,{type:"secondary",children:ue("general.None")})}),ge?(0,p.jsx)(L.A.Item,{label:ue("session.launcher.BatchJobTimeoutDuration"),children:me.getFieldValue(["batch","timeout"])?(0,p.jsxs)(H.A.Text,{children:[me.getFieldValue(["batch","timeout"]),me.getFieldValue(["batch","timeoutUnit"])||"s"]}):(0,p.jsx)(H.A.Text,{type:"secondary",children:ue("general.None")})}):null]})]})}),(0,p.jsx)(G,{onClickExtraButton:()=>{de("sessionType")}}),(0,p.jsx)(q.Zuv,{title:ue("session.launcher.Environments"),showDivider:!0,size:"small",status:b().some(me.getFieldValue("envvars"),((e,n)=>me.getFieldError(["envvars",n,"variable"]).length>0||me.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("environment")},children:(0,p.jsxs)(L.A,{size:"small",column:1,children:[(0,p.jsx)(L.A.Item,{label:ue("session.launcher.Project"),children:je.name}),(0,p.jsx)(L.A.Item,{label:ue("general.Image"),children:xe?(0,p.jsxs)(M.A,{style:{flexFlow:"nowrap"},children:[(0,p.jsx)(z.A,{children:(0,p.jsx)(k.A,{image:(null===(l=me.getFieldValue("environments"))||void 0===l?void 0:l.version)||(null===(s=me.getFieldValue("environments"))||void 0===s?void 0:s.manual),style:{marginRight:he.marginXS}})}),(0,p.jsx)(z.A,{children:(0,p.jsx)(q.OOm,{direction:"row",wrap:"wrap",children:null!==(i=me.getFieldValue("environments"))&&void 0!==i&&i.manual?(0,p.jsx)(H.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(a=me.getFieldValue("environments"))||void 0===a?void 0:a.manual},children:null===(r=me.getFieldValue("environments"))||void 0===r?void 0:r.manual}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(H.A.Text,{children:be(null===(d=me.getFieldValue("environments"))||void 0===d||null===(c=d.image)||void 0===c?void 0:c.base_image_name)}),(0,p.jsx)(J.A,{type:"vertical"}),(0,p.jsx)(H.A.Text,{children:null===(u=me.getFieldValue("environments"))||void 0===u||null===(m=u.image)||void 0===m?void 0:m.version}),(0,p.jsx)(J.A,{type:"vertical"}),(0,p.jsx)(H.A.Text,{children:null===(h=me.getFieldValue("environments"))||void 0===h||null===(g=h.image)||void 0===g?void 0:g.architecture}),(0,p.jsx)(J.A,{type:"vertical"}),b().map(null===(x=me.getFieldValue("environments"))||void 0===x||null===(A=x.image)||void 0===A?void 0:A.tags,(e=>{var n,t,l;const s=b().includes(e.key,"customized_"),i=s?null===(n=b().find(null===(t=me.getFieldValue("environments"))||void 0===t||null===(l=t.image)||void 0===l?void 0:l.labels,{key:"ai.backend.customized-image.name"}))||void 0===n?void 0:n.value:e.value,a=be(e.key+i);return b().isEqual(a,(0,f.WY)(e.key+i))||s?(0,p.jsx)(q.qnQ,{values:[{label:be(e.key),color:s?"cyan":"blue"},{label:i,color:s?"cyan":"blue"}]},e.key):(0,p.jsx)($.A,{color:s?"cyan":"blue",children:a},e.key)})),(0,p.jsx)(H.A.Text,{style:{color:he.colorPrimary},copyable:{text:(0,f.A_)(null===(F=me.getFieldValue("environments"))||void 0===F?void 0:F.image)||(null===(V=me.getFieldValue("environments"))||void 0===V?void 0:V.version)}})]})})})]}):(0,p.jsxs)(M.A,{style:{flexFlow:"nowrap",gap:he.sizeXS},children:[(0,p.jsx)(z.A,{children:(0,p.jsx)(k.A,{image:(null===(E=me.getFieldValue("environments"))||void 0===E?void 0:E.version)||(null===(T=me.getFieldValue("environments"))||void 0===T?void 0:T.manual)})}),(0,p.jsx)(z.A,{children:(0,p.jsx)(q.OOm,{direction:"row",wrap:"wrap",children:null!==(I=me.getFieldValue("environments"))&&void 0!==I&&I.manual?(0,p.jsx)(H.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(N=me.getFieldValue("environments"))||void 0===N?void 0:N.manual},children:null===(D=me.getFieldValue("environments"))||void 0===D?void 0:D.manual}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(H.A.Text,{children:be(Ae(null===(B=me.getFieldValue("environments"))||void 0===B?void 0:B.version))}),(0,p.jsx)(J.A,{type:"vertical"}),(0,p.jsx)(H.A.Text,{children:ye(null===(R=me.getFieldValue("environments"))||void 0===R?void 0:R.version)}),(0,p.jsx)(J.A,{type:"vertical"}),(0,p.jsx)(H.A.Text,{children:null===(K=me.getFieldValue("environments"))||void 0===K||null===(U=K.image)||void 0===U?void 0:U.architecture}),(0,p.jsx)(J.A,{type:"vertical"}),(0,p.jsx)(O.J,{tag:me.getFieldValue(["environments","image","tag"]),labels:null===(Q=me.getFieldValue("environments"))||void 0===Q||null===(Y=Q.image)||void 0===Y?void 0:Y.labels}),(0,p.jsx)(H.A.Text,{style:{color:he.colorPrimary},copyable:{text:(0,f.A_)(null===(ne=me.getFieldValue("environments"))||void 0===ne?void 0:ne.image)||(null===(te=me.getFieldValue("environments"))||void 0===te?void 0:te.version)}})]})})})]})}),(null===(le=me.getFieldValue("envvars"))||void 0===le?void 0:le.length)>0&&(0,p.jsx)(L.A.Item,{label:ue("session.launcher.EnvironmentVariable"),children:null!==(se=me.getFieldValue("envvars"))&&void 0!==se&&se.length?(0,p.jsx)(q.OOm,{align:"stretch",direction:"column",children:(0,p.jsx)(W.A,{language:"shell",children:b().map(me.getFieldValue("envvars"),(e=>"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"'))).join("\n")})}):(0,p.jsx)(H.A.Text,{type:"secondary",children:"-"})})]})}),(0,p.jsx)(q.Zuv,{title:ue("session.launcher.ResourceAllocation"),showDivider:!0,status:b().some(me.getFieldValue("resource"),((e,n)=>me.getFieldError(["resource",n]).length>0))||me.getFieldError(["num_of_sessions"]).length>0||me.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("environment")},children:(0,p.jsxs)(q.OOm,{direction:"column",align:"stretch",children:[b().some(me.getFieldValue("resource"),((e,n)=>me.getFieldWarning(["resource",n]).length>0))&&(0,p.jsx)(Z.A,{type:"warning",showIcon:!0,title:ue("session.launcher.EnqueueComputeSessionWarning")}),(0,p.jsxs)(L.A,{column:2,children:[(0,p.jsx)(L.A.Item,{label:ue("general.ResourceGroup"),span:2,children:me.getFieldValue("resourceGroup")||(0,p.jsx)(H.A.Text,{type:"secondary",children:ue("general.None")})}),(0,p.jsx)(L.A.Item,{label:ue("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,p.jsxs)(q.OOm,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===me.getFieldValue("allocationPreset")?"":(0,p.jsx)($.A,{children:me.getFieldValue("allocationPreset")}),(0,p.jsx)(De,{resource:me.getFieldValue("resource")})]})}),ve.supports("agent-select")&&!(null!==ve&&void 0!==ve&&null!==(ie=ve._config)&&void 0!==ie&&ie.hideAgents)&&(0,p.jsx)(L.A.Item,{label:ue("session.launcher.AgentNode"),children:b().castArray(me.getFieldValue("agent")).join(", ")||ue("session.launcher.AutoSelect")}),(0,p.jsx)(L.A.Item,{label:ue("session.launcher.NumberOfContainer"),children:1===me.getFieldValue("cluster_size")?me.getFieldValue("num_of_sessions"):me.getFieldValue("cluster_size")}),(0,p.jsx)(L.A.Item,{label:ue("session.launcher.ClusterMode"),children:"single-node"===me.getFieldValue("cluster_mode")?ue("session.launcher.SingleNode"):ue("session.launcher.MultiNode")})]}),(0,p.jsx)(_.A,{size:"small",type:"inner",title:ue("session.launcher.TotalAllocation"),children:(0,p.jsx)(q.OOm,{direction:"row",gap:"xxs",children:(0,p.jsx)(De,{resource:me.getFieldValue("resource"),containerCount:1===me.getFieldValue("cluster_size")?me.getFieldValue("num_of_sessions"):me.getFieldValue("cluster_size")})})})]})}),(0,p.jsx)(q.Zuv,{title:ue("webui.menu.Data&Storage"),showDivider:!0,size:"small",status:me.getFieldError("mount_id_map").length>0?"error":void 0,extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("storage")},children:(0,p.jsxs)(q.OOm,{direction:"column",align:"stretch",gap:"xs",children:[(null===(ae=me.getFieldValue("mount_ids"))||void 0===ae?void 0:ae.length)>0?(0,p.jsx)(X.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:ue("data.folders.Name")},{dataIndex:"alias",title:ue("session.launcher.FolderAlias"),render:(e,n)=>b().isEmpty(e)?(0,p.jsx)(H.A.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(n.name)}):e}],dataSource:b().map(me.getFieldValue("mount_ids"),(e=>{var n,t;return{name:(null===(n=me.getFieldValue("vfoldersNameMap"))||void 0===n?void 0:n[e])||e,alias:null===(t=me.getFieldValue("mount_id_map"))||void 0===t?void 0:t[e]}}))}):(0,p.jsx)(Z.A,{type:"warning",showIcon:!0,title:ue("session.launcher.NoFolderMounted")}),(null===(re=me.getFieldValue("autoMountedFolderNames"))||void 0===re?void 0:re.length)>0?(0,p.jsx)(L.A,{size:"small",children:(0,p.jsx)(L.A.Item,{label:ue("data.AutomountFolders"),children:(0,p.jsx)(q.OOm,{gap:"xs",wrap:"wrap",children:b().map(me.getFieldValue("autoMountedFolderNames"),(e=>(0,p.jsx)($.A,{children:e},e)))})})}):null]})}),(0,p.jsx)(q.Zuv,{title:"Network",showDivider:!0,size:"small",status:me.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:ue("button.Edit"),onClickExtraButton:()=>{de("network")},children:(0,p.jsx)(L.A,{size:"small",children:(0,p.jsx)(L.A.Item,{label:ue("session.launcher.PreOpenPortTitle"),children:(0,p.jsxs)(q.OOm,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[b().sortBy(me.getFieldValue("ports"),(e=>parseInt(e))).map(((e,n)=>(0,p.jsx)(o.uD,{value:e,style:{margin:0},children:e},n+e))),b().isArray(me.getFieldValue("ports"))&&0!==(null===(oe=me.getFieldValue("ports"))||void 0===oe?void 0:oe.length)?null:(0,p.jsx)(H.A.Text,{type:"secondary",children:ue("general.None")})]})})})})]})};var te=t(59991),le=t(93664);const se=e=>{let n=Object.assign({},((0,te.A)(e),e));const{t:t}=(0,v.Bd)(),s=(0,le.f)();return(0,p.jsx)(j.A.Item,(0,l.A)((0,l.A)({label:t("session.launcher.SessionName"),name:"sessionName",validateDebounce:200,rules:s},n),{},{children:(0,p.jsx)(B.A,{allowClear:!0,autoComplete:"off",count:{max:64,show:!0}})}))};var ie=t(7871);const ae=()=>{const[e,n]=(0,u.q)("recentSessionHistory"),t=(0,q.EQ6)((t=>{let{id:l,params:s,createdAt:i,name:a}=t;const r={id:null!==l&&void 0!==l?l:(0,q.kXB)(8),params:s,createdAt:null!==i&&void 0!==i?i:(new Date).toISOString(),name:a},o=b().sortBy([r,...e||[]],"-createdAt").slice(0,5);n(o)})),s=(0,q.EQ6)((()=>n([]))),i=(0,q.EQ6)((t=>{const l=(e||[]).filter((e=>e.id!==t));n(l)})),a=(0,q.EQ6)(((t,s)=>{const i=(e||[]).map((e=>e.id===t?(0,l.A)((0,l.A)({},e),{},{name:s}):e));n(i)}));return[e,{push:t,clear:s,remove:i,update:a}]};var re,oe=t(9170),de=t(69266),ce=t(6294),ue=t(69515);const me=(0,ce.rU)((e=>{let{css:n}=e;return{fixEditableVerticalAlign:n(re||(re=(0,ie.A)(["\n    & {\n      margin-top: 0px !important;\n    }\n  "])))}})),he=e=>{let n=Object.assign({},((0,te.A)(e),e));const{t:t}=(0,v.Bd)(),{styles:s}=me(),[i,{update:a}]=ae(),[r,o]=(0,h.useState)(null),[,{getImageAliasName:d,getBaseVersion:c}]=(0,w.Gj)(),[m,{pin:g,unpin:x,update:j}]=(()=>{const[e,n]=(0,u.q)("pinnedSessionHistory"),[t]=(0,u.q)("recentSessionHistory"),s=(0,q.EQ6)((l=>{const s=(t||[]).find((e=>e.id===l));s&&n([...e||[],s])})),i=(0,q.EQ6)((t=>{const l=(e||[]).filter((e=>e.id!==t));n(l)})),a=(0,q.EQ6)(((t,s)=>{const i=(e||[]).map((e=>e.id===t?(0,l.A)((0,l.A)({},e),{},{name:s}):e));n(i)}));return[e,{pin:s,unpin:i,update:a}]})(),[,y]=(0,h.useState)(),{token:A}=C.A.useToken(),F=(0,h.useMemo)((()=>{const e=(e,n)=>{const t=new URLSearchParams(e.params),s=JSON.parse(t.get("formValues")||"{}");return(0,l.A)((0,l.A)({},s),{},{pinned:n,name:e.name})},n=b().map(i,(n=>(0,l.A)((0,l.A)({},n),e(n,!1)))),t=b().map(m,(n=>(0,l.A)((0,l.A)({},n),e(n,!0))));return b().chain([...t,...n]).unionBy("id").value()}),[i,m]);return(0,p.jsx)(q.IbE,(0,l.A)((0,l.A)({width:800,title:t("session.launcher.RecentHistory"),footer:null,onCancel:()=>{y(void 0),n.onRequestClose()}},n),{},{children:(0,p.jsxs)(q.OOm,{direction:"column",align:"stretch",gap:"sm",children:[(0,p.jsx)(H.A.Text,{children:t("session.launcher.YouCanStartWithHistory")}),(0,p.jsx)(q.zxw,{rowSelection:{selectedRowKeys:null===m||void 0===m?void 0:m.map((e=>e.id)),columnWidth:0,hideSelectAll:!0,renderCell:()=>null},scroll:{x:"max-content"},dataSource:F,pagination:!1,onRow:e=>({onMouseEnter:()=>o(e.id),onMouseLeave:()=>o(null)}),rowKey:e=>e.id,columns:[{title:(0,p.jsxs)(q.OOm,{gap:"xxs",children:[(0,p.jsx)(ue.A,{}),(0,p.jsx)(oe.A,{title:t("session.launcher.PinnedHistoryTooltip")})]}),dataIndex:"pinned",width:40,render:(e,n)=>{const t=!!n.pinned,l=r===n.id;return t?(0,p.jsx)(P.Ay,{size:"small",onClick:()=>{x(n.id)},type:"link",children:(0,p.jsx)(ue.A,{})}):(0,p.jsx)(P.Ay,{size:"small",onClick:()=>g(n.id),type:"link",children:(0,p.jsx)(ue.A,{style:{color:l?A.colorTextQuaternary:"transparent"}})})}},{title:t("session.launcher.SessionNameShort"),dataIndex:"name",render:(e,t)=>{const l=e||t.id.split("-")[0];return(0,p.jsx)(H.A.Text,{className:s.fixEditableVerticalAlign,editable:{onChange(e){b().isEmpty(e)||(a(t.id,e),t.pinned&&j(t.id,e))},text:l},children:(0,p.jsx)(q.rmy,{type:"hover",onClick:()=>{var e;null===(e=n.onRequestClose)||void 0===e||e.call(n,JSON.parse(new URLSearchParams(t.params||"").get("formValues")||"{}"))},children:l})})}},{title:t("session.launcher.Environments"),dataIndex:["environments","version"],render:(e,n)=>{var t,l;const s=(null===(t=n.environments)||void 0===t?void 0:t.version)||(null===(l=n.environments)||void 0===l?void 0:l.manual);return s&&(0,p.jsx)(de.A,{title:s,placement:"right",children:(0,p.jsxs)(q.OOm,{gap:"xxs",children:[(0,p.jsx)(k.A,{image:s}),(0,p.jsxs)(H.A.Text,{children:[d(s)," ",c(s)]})]})})},onCell:()=>({style:{maxWidth:250,textOverflow:"ellipsis"}})},{title:t("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,p.jsx)(q.OOm,{gap:"xs",children:(0,p.jsx)(De,{resource:e})})},{title:t("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>ee()(e).fromNow()}]})]})}))};var ve=t(74833);var pe=t(90485),ge=t(78175),xe=t(24524),je=t(46435),ye=t(94014),Ae=t(50440),be=t(80391),Fe=t(41448),fe=t(20341),we=t(10483),Se=t(96922),ke=t(49631),Oe=t(72927),Ve=t(95655),Ee=t(10361),Te=t(17471),Ie=t(82113),Ne=t(55812),Ce=t(13215),_e=t(31495);const De=e=>{let{resource:n,containerCount:t=1}=e;return(0,p.jsxs)(p.Fragment,{children:[b().map(b().omit(n,"shmem","accelerator","acceleratorType"),((e,l)=>{var s,i;return"0"===e?null:(0,p.jsx)(q.jOc,{type:l,value:"mem"===l?((null===(s=(0,f.mv)(e.toString(),""))||void 0===s?void 0:s.number)||0)*t+"":b().toNumber(e)*t+"",opts:{shmem:n.shmem?((null===(i=(0,f.mv)(n.shmem,""))||void 0===i?void 0:i.number)||0)*t:void 0}},l)})),n&&n.accelerator&&n.acceleratorType&&b().isNumber(n.accelerator)?(0,p.jsx)(q.jOc,{type:n.acceleratorType,value:b().toString(n.accelerator*t)}):null]})},Be=()=>{var e,n;const t=y.A.useApp(),{logger:c}=(0,q.Q7t)(),{getErrorMessage:u}=(0,q.B78)(),m=(0,Te.md)(r.i7),g=(0,w.CX)(),A=g.supports("mount-by-id"),k=null!==(e=null===g||void 0===g?void 0:g.supports("batch-timeout"))&&void 0!==e&&e,O=(0,T.Am)(),[,V]=(0,S.zL)(),{startSession:E,defaultFormValues:I,upsertSessionNotification:N}=(0,Ce.G)(),L=(0,_e.withDefault)(_e.NumberParam,0),K=(0,_e.withDefault)(_e.JsonParam,I),U=(0,_e.withDefault)(_e.JsonParam,{}),[{step:G,formValues:W,redirectTo:J},$]=(0,_e.useQueryParams)({step:L,formValues:K,redirectTo:_e.StringParam,appOption:U}),{search:Z}=(0,Ne.zy)(),X=(0,w.f0)(),[Y,{toggle:te}]=(0,be.A)(),[,{push:le}]=ae(),{run:ie}=(0,Fe.A)((()=>{const e=me.getFieldsValue();$({formValues:b().assign(b().omit(me.getFieldsValue(),["environments.image","environments.customizedTag","autoMountedFolderNames","owner","envvars"]),{envvars:(0,i.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),re=e=>{$({step:e},"pushIn")},{token:oe}=C.A.useToken(),{t:ce}=(0,v.Bd)(),ue=fe.Ay.useBreakpoint(),[me]=j.A.useForm();(0,h.useEffect)((()=>{b().isEmpty(W)||me.validateFields().catch((()=>{}))}),[]);const De=(0,h.useEffectEvent)((()=>b().isEmpty(W)?null:setTimeout((()=>{me.validateFields().catch((()=>{}))}),500)));(0,h.useEffect)((()=>{const e=De();return()=>{e&&clearTimeout(e)}}),[]);const Be=(0,h.useMemo)((()=>b().merge({},I,d.jh,W)),[I,W]);(0,h.useEffect)((()=>{var e;null===(e=m.current)||void 0===e||e.scrollTo(0,0)}),[G]);const Pe=j.A.useWatch("sessionType",{form:me,preserve:!0})||me.getFieldValue("sessionType")||W.sessionType,Me=(0,q.YM3)([{title:ce("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(ce("session.launcher.Environments")," & ").concat(ce("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==Pe&&{title:ce("webui.menu.Data&Storage"),key:"storage"},{title:ce("session.launcher.Network"),key:"network"},{title:ce("session.launcher.ConfirmAndLaunch"),icon:(0,p.jsx)(pe.A,{}),key:"review"}]),ze=null===(n=Me[G])||void 0===n?void 0:n.key,Re=b().some(me.getFieldsError(),(e=>e.errors.length>0)),[Le,qe]=(0,q.TwB)("first");(0,h.useEffect)((()=>{G===Me.length-1&&me.validateFields().catch((()=>{})).finally((()=>qe()))}),[G,me,qe,Me.length]),(0,h.useEffect)((()=>{"first"!==Le&&Ue(!!Re)}),[Le,Re]);const[Ke,Ue]=(0,h.useState)(!1),[Ge,Qe]=(0,h.useState)(!1);return(0,h.useLayoutEffect)((()=>{Ge&&(me.resetFields(),Qe(!1))}),[Ge,me]),(0,p.jsxs)(q.OOm,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,p.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,p.jsxs)(q.OOm,{direction:"row",gap:"md",align:"start",children:[(0,p.jsxs)(q.OOm,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,p.jsxs)(q.OOm,{direction:"row",justify:"between",children:[(0,p.jsx)(H.A.Title,{level:4,style:{marginTop:0},children:ce("session.launcher.StartNewSession")}),(0,p.jsx)(q.OOm,{direction:"row",gap:"sm",children:(0,p.jsx)(P.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>te(),children:ce("session.launcher.RecentHistory")})})]}),(0,p.jsx)(j.A.Provider,{onFormChange:()=>{ie()},children:(0,p.jsxs)(j.A,{form:me,layout:"vertical",initialValues:Be,children:[(0,p.jsx)(F,{form:me}),(0,p.jsxs)(q.OOm,{direction:"column",align:"stretch",gap:"md",children:[(0,p.jsxs)(_.A,{title:ce("session.launcher.SessionType"),style:{display:"sessionType"===ze?"block":"none"},children:[(0,p.jsx)(j.A.Item,{name:"sessionType",children:(0,p.jsx)(we.Ay.Group,{options:[{label:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(H.A.Text,{code:!0,children:ce("session.launcher.InteractiveMode")})," ",(0,p.jsx)(H.A.Text,{type:"secondary",children:ce("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(H.A.Text,{code:!0,children:ce("session.launcher.BatchMode")})," ",(0,p.jsx)(H.A.Text,{type:"secondary",children:ce("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,p.jsx)(se,{}),(0,p.jsx)(j.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,p.jsx)(B.A,{})})]}),"batch"===Pe&&(0,p.jsxs)(_.A,{title:ce("session.launcher.BatchModeConfig"),style:{display:"sessionType"===ze?"block":"none"},children:[(0,p.jsx)(j.A.Item,{label:ce("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,p.jsx)(B.A.TextArea,{autoSize:!0})}),(0,p.jsx)(j.A.Item,{noStyle:!0,dependencies:[["batch","scheduleDate"]],children:()=>{const e=me.getFieldValue(["batch","scheduleDate"]);return(0,p.jsx)(q.vmA,{delay:1e3,callback:()=>{const e=me.getFieldValue(["batch","scheduleDate"]);return e?ee()(e).isBefore(ee()())?void(0===me.getFieldError(["batch","scheduleDate"]).length&&me.validateFields([["batch","scheduleDate"]])):ee()(e).fromNow():void 0},triggerKey:e||"none",render:e=>(0,p.jsx)(j.A.Item,{label:ce("session.launcher.SessionStartTime"),extra:e,children:(0,p.jsxs)(q.OOm,{direction:"row",gap:"xs",children:[(0,p.jsx)(j.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,p.jsx)(Se.A,{onChange:e=>{e.target.checked&&b().isEmpty(me.getFieldValue(["batch","scheduleDate"]))?me.setFieldValue(["batch","scheduleDate"],ee()().add(2,"minutes").toISOString()):!1===e.target.checked&&me.setFieldValue(["batch","scheduleDate"],void 0),me.validateFields([["batch","scheduleDate"]])},children:ce("session.launcher.Enable")})}),(0,p.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var t,l;return(null===(t=e.batch)||void 0===t?void 0:t.enabled)!==(null===(l=n.batch)||void 0===l?void 0:l.enabled)},children:()=>{var e;const n=!0!==(null===(e=me.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(j.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&ee()(n).isBefore(ee()())?Promise.reject(ce("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,p.jsx)(s.A,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(ee()().startOf("day"))})})})}})]})})})}}),k?(0,p.jsx)(j.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"],["batch","timeoutUnit"]],children:()=>{const e=me.getFieldValue(["batch","timeout"]),n=me.getFieldValue(["batch","timeoutUnit"]),t=ee().duration(e,null!==n&&void 0!==n?n:"s"),l=(0,f.a3)(t,ce),s=!b().isNull(e)&&b().toFinite(e)>0?l:null;return(0,p.jsx)(j.A.Item,{label:ce("session.launcher.BatchJobTimeoutDuration"),tooltip:ce("session.launcher.BatchJobTimeoutDurationDesc"),help:s,children:(0,p.jsxs)(q.OOm,{direction:"row",gap:"xs",children:[(0,p.jsx)(j.A.Item,{noStyle:!0,name:["batch","timeoutEnabled"],valuePropName:"checked",children:(0,p.jsx)(Se.A,{onChange:e=>{!1===e.target.checked&&me.setFieldValue(["batch","timeout"],void 0),me.validateFields([["batch","timeout"]])},children:ce("session.launcher.Enable")})}),(0,p.jsx)(j.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"]],children:()=>{const e=!0!==me.getFieldValue(["batch","timeoutEnabled"]);return(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)(ke.A.Compact,{children:[(0,p.jsx)(j.A.Item,{name:["batch","timeout"],label:ce("session.launcher.BatchJobTimeoutDuration"),noStyle:!0,dependencies:[["batch","timeoutEnabled"]],rules:[{min:0,type:"number",message:ce("error.AllowsPositiveNumberOnly")},{required:!e}],children:(0,p.jsx)(Oe.A,{disabled:e,min:1,style:{width:"100%"},onChange:()=>{me.validateFields([["batch","timeoutUnit"]])}})}),(0,p.jsx)(j.A.Item,{noStyle:!0,name:["batch","timeoutUnit"],dependencies:[["batch","timeout"],["batch","timeoutEnabled"]],rules:[e=>{let{getFieldValue:n}=e;return{validator(){const e=n(["batch","timeout"]);return!0===n(["batch","timeoutEnabled"])&&(void 0===e||null===e||e<1)?Promise.reject():Promise.resolve()}}}],children:(0,p.jsx)(R.A,{tabIndex:-1,disabled:e,style:{width:100},options:[{label:ce("time.Sec"),value:"s"},{label:ce("time.Min"),value:"m"},{label:ce("time.Hour"),value:"h"},{label:ce("time.Day"),value:"d"},{label:ce("time.Week"),value:"w"}]})})]})})}})]})})}}):null]}),("admin"===O||"superadmin"===O)&&(0,p.jsx)(Q,{style:{display:"sessionType"===ze?"block":"none"}}),"inference"===Pe&&(0,p.jsx)(_.A,{title:"Inference Mode Configuration",children:(0,p.jsx)(j.A.Item,{name:["inference","vFolderName"],label:ce("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,p.jsx)(R.A,{})})}),(0,p.jsxs)(_.A,{title:ce("session.launcher.Environments"),style:{display:"environment"===ze?"block":"none"},children:[(0,p.jsx)(Ie.tH,{fallbackRender:()=>null,children:(0,p.jsx)(a.A,{})}),(0,p.jsx)(j.A.Item,{label:ce("session.launcher.EnvironmentVariable"),children:(0,p.jsx)(i.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,p.jsx)(_.A,{title:ce("session.launcher.ResourceAllocation"),style:{display:"environment"===ze?"block":"none"},children:(0,p.jsx)(d.Ay,{enableAgentSelect:!g._config.hideAgents&&g.supports("agent-select"),enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,p.jsxs)(_.A,{title:ce("session.launcher.HPCOptimization"),style:{display:"environment"===ze?"block":"none"},children:[(0,p.jsx)(j.A.Item,{noStyle:!0,children:(0,p.jsxs)(q.OOm,{direction:"row",gap:"sm",children:[(0,p.jsx)(H.A.Text,{children:ce("session.launcher.SwitchOpenMPoptimization")}),(0,p.jsx)(j.A.Item,{label:ce("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,p.jsx)(D.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e?me.setFieldsValue({hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:void 0,OPENBLAS_NUM_THREADS:void 0}}):me.setFieldsValue({hpcOptimization:{autoEnabled:!1,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"}})}})})]})}),(0,p.jsx)(j.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var t,l;return(null===(t=e.hpcOptimization)||void 0===t?void 0:t.autoEnabled)!==(null===(l=n.hpcOptimization)||void 0===l?void 0:l.autoEnabled)},children:()=>{const e=me.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,p.jsxs)(M.A,{gutter:oe.marginMD,style:{display:e?"none":void 0,marginTop:oe.marginMD},children:[(0,p.jsx)(z.A,{xs:24,sm:12,children:(0,p.jsx)(j.A.Item,{style:{flex:1},label:ce("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,p.jsxs)(p.Fragment,{children:[ce("session.launcher.OpenMPOptimization"),(0,p.jsx)(v.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,p.jsx)(Oe.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,p.jsx)(z.A,{xs:24,sm:12,children:(0,p.jsx)(j.A.Item,{style:{flex:1},label:ce("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,p.jsxs)(p.Fragment,{children:[ce("session.launcher.OpenMPOptimization"),(0,p.jsx)(v.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,p.jsx)(Oe.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,p.jsx)(_.A,{title:ce("webui.menu.Data&Storage"),style:{display:"storage"===ze?"block":"none"},children:(0,p.jsx)(j.A.Item,{noStyle:!0,dependencies:["owner"],children:e=>{let{getFieldValue:n}=e;const t=n("owner"),l=(null===t||void 0===t?void 0:t.enabled)&&b().every(b().omit(t,"enabled"),(e=>void 0!==e));return(0,p.jsx)(ve.A,{rowKey:A?"id":"name",rowFilter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))},tableProps:{ownerEmail:l?null===t||void 0===t?void 0:t.email:void 0}})}})}),(0,p.jsx)(_.A,{title:ce("session.launcher.Network"),style:{display:"network"===ze?"block":"none"},children:(0,p.jsx)(o.Ay,{})}),"review"===ze&&(0,p.jsx)(ne,{onClickEditStep:e=>{const n=b().findIndex(Me,{key:e});re(n)}}),(0,p.jsxs)(q.OOm,{direction:"row",justify:"between",children:[(0,p.jsx)(q.OOm,{gap:"sm",children:(0,p.jsx)(Ve.A,{title:ce("button.Reset"),description:ce("session.launcher.ResetFormConfirm"),onConfirm:()=>{$({},"replace"),Qe(!0)},icon:(0,p.jsx)(ge.A,{style:{color:oe.colorError}}),okText:ce("button.Reset"),okButtonProps:{danger:!0},children:(0,p.jsx)(P.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:ce("button.Reset")})})}),(0,p.jsxs)(q.OOm,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[G>0&&(0,p.jsx)(P.Ay,{onClick:()=>{re(G-1)},icon:(0,p.jsx)(xe.A,{}),children:ce("button.Previous")}),G===Me.length-1?(0,p.jsx)(de.A,{title:Re?ce("session.launcher.PleaseCompleteForm"):void 0,children:(0,p.jsx)(q.Fvl,{type:"primary",icon:(0,p.jsx)(je.A,{}),disabled:Re,action:async()=>{var e;const n=Z,l=await me.validateFields().catch((e=>{c.error("validation errors",e)}));if(l){if(b().isEmpty(l.mount_ids)||0===(null===(e=l.mount_ids)||void 0===e?void 0:e.length)){if(!await t.modal.confirm({title:ce("session.launcher.NoFolderMounted"),content:(0,p.jsxs)(p.Fragment,{children:[ce("session.launcher.HomeDirectoryDeletionDialog"),(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),ce("session.launcher.LaunchConfirmationDialog"),(0,p.jsx)("br",{}),(0,p.jsx)("br",{}),ce("dialog.ask.DoYouWantToProceed")]}),okText:ce("session.launcher.Start"),closable:!0}))return}await E(l).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&(N(e.fulfilled),V(l.resourceGroup),le({params:n,name:e.fulfilled[0].value.sessionName})),null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&X(J||"/job"),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const n=e.rejected[0].reason;t.modal.error({title:null===n||void 0===n?void 0:n.title,content:u(n)})}})).catch((e=>{c.error("Unexpected error during session creation:",e),t.message.error(ce("error.UnexpectedError"))}))}},children:ce("session.launcher.Launch")})}):(0,p.jsxs)(P.Ay,{type:"primary",ghost:!0,onClick:()=>{re(G+1)},children:[ce("button.Next")," ",(0,p.jsx)(ye.A,{})]}),G!==Me.length-1&&(0,p.jsxs)(P.Ay,{onClick:()=>{re(Me.length-1)},children:[ce("session.launcher.SkipToConfirmAndLaunch"),(0,p.jsx)(Ae.A,{})]})]})]})]})]})})]}),ue.lg&&(0,p.jsx)(q.OOm,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,p.jsx)(Ee.A,{size:"small",orientation:"vertical",current:G,onChange:e=>{re(e)},items:b().map(Me,((e,n)=>(0,l.A)((0,l.A)({},e),{},{status:n===G?"process":"wait"})))})})]}),(0,p.jsx)(he,{onRequestClose:e=>{if(e){const n=b().merge({sessionName:"",ports:[],vfoldersNameMap:{},mount_ids:[],mount_id_map:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0},agent:["auto"]},e);b().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,q.kXB)(4)),me.setFieldsValue(n),re(Me.length-1),me.validateFields().catch((()=>{}))}te()},open:Y}),G===Me.length-1?(0,p.jsx)(Ie.tH,{fallback:null,children:(0,p.jsx)(x,{open:Ke,onClose:()=>{Ue(!1)},scrollIntoViewOptions:!0})}):void 0]})}}}]);
//# sourceMappingURL=8724.2de86782.chunk.js.map