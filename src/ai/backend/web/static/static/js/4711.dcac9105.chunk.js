"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[4711],{33879:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpointId"}],n=[{kind:"Variable",name:"endpoint_id",variableName:"endpointId"}],t={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatCardQuery",selections:[{kind:"CatchField",field:{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[t,a,{args:null,kind:"FragmentSpread",name:"ChatHeader_Endpoint"}],storageKey:null},to:"RESULT"}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatCardQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[t,a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"6e2c7cca467d32f74de4ddf840a8f08a",id:null,metadata:{},name:"ChatCardQuery",operationKind:"query",text:"query ChatCardQuery(\n  $endpointId: UUID!\n) {\n  endpoint(endpoint_id: $endpointId) {\n    endpoint_id\n    url\n    ...ChatHeader_Endpoint\n    id\n  }\n}\n\nfragment ChatHeader_Endpoint on Endpoint {\n  endpoint_id\n}\n"}}}();a.hash="5ff3fd270fca0bac7779be279e93341e";const i=a},930:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ChatHeader_Endpoint",selections:[{alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"baa41c02cf67330c6bf4313d43280faa"},i=a},86164:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"limit"},t={defaultValue:null,kind:"LocalArgument",name:"offset"},a={defaultValue:null,kind:"LocalArgument",name:"projectID"},i=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],l={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null};return{fragment:{argumentDefinitions:[e,n,t,a],kind:"Fragment",metadata:null,name:"EndpointSelectQuery",selections:[{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[l,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[o,{kind:"RequiredField",field:r,action:"NONE"},s],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[t,n,a,e],kind:"Operation",name:"EndpointSelectQuery",selections:[{alias:null,args:i,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[l,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[o,r,s,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"aae5f818f3d7f1a77dce26a43ed1ead6",id:null,metadata:{},name:"EndpointSelectQuery",operationKind:"query",text:"query EndpointSelectQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n  $filter: String\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: $filter) {\n    total_count\n    items {\n      name\n      endpoint_id\n      url\n      id\n    }\n  }\n}\n"}}}();a.hash="75cd9e15a8e37c564ec047492c6798b3";const i=a},68351:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpoint_id"}],n=[{kind:"Variable",name:"endpoint_id",variableName:"endpoint_id"}],t={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EndpointSelectValueQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[t,{kind:"RequiredField",field:a,action:"NONE"},i],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EndpointSelectValueQuery",selections:[{alias:null,args:n,concreteType:"Endpoint",kind:"LinkedField",name:"endpoint",plural:!1,selections:[t,a,i,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"305b4336fc43ab460edf54efa95ff116",id:null,metadata:{},name:"EndpointSelectValueQuery",operationKind:"query",text:"query EndpointSelectValueQuery(\n  $endpoint_id: UUID!\n) {\n  endpoint(endpoint_id: $endpoint_id) {\n    name\n    endpoint_id\n    url\n    id\n  }\n}\n"}}}();a.hash="5f7c6954ddf84a211dc8428e86004300";const i=a},54320:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"endpointId"},{defaultValue:null,kind:"LocalArgument",name:"isEmptyEndpointId"}],n={alias:null,args:[{kind:"Variable",name:"endpoint_id",variableName:"endpointId"},{kind:"Literal",name:"limit",value:100},{kind:"Literal",name:"offset",value:0}],concreteType:"EndpointTokenList",kind:"LinkedField",name:"endpoint_token_list",plural:!1,selections:[{alias:null,args:null,concreteType:"EndpointToken",kind:"LinkedField",name:"items",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"token",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"valid_until",storageKey:null}],storageKey:null}],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"EndpointTokenSelectQuery",selections:[{kind:"CatchField",field:n,to:"RESULT"}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"EndpointTokenSelectQuery",selections:[n]},params:{cacheID:"f8777131f4094de086beaa0e11d6ae09",id:null,metadata:{},name:"EndpointTokenSelectQuery",operationKind:"query",text:"query EndpointTokenSelectQuery(\n  $endpointId: UUID!\n  $isEmptyEndpointId: Boolean!\n) {\n  endpoint_token_list(offset: 0, limit: 100, endpoint_id: $endpointId) @skipOnClient(if: $isEmptyEndpointId) {\n    items {\n      id\n      token\n      created_at\n      valid_until\n    }\n  }\n}\n"}}}();a.hash="839fdaad7009de6f1d8dc79de4e35a3d";const i=a},27766:(e,n,t)=>{t.d(n,{W:()=>l});var a=t(77668),i=(t(1426),t(42906));const l=e=>{let{name:n,height:t,width:l}=e;const o=a.Pt.icons[null!==n&&void 0!==n?n:"pure"];return(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",height:t,width:l,role:"img",dangerouslySetInnerHTML:{__html:o.body}})}},49871:(e,n,t)=>{t.d(n,{B:()=>o});var a=t(32967),i=t(88616),l=t(1426);const o=()=>{var e;const[n,t]=(0,a.Tw)("first"),{data:o,isLoading:r}=(0,i.nN)({queryKey:["useAgents",n],queryFn:()=>fetch("resources/ai-agents.json").then((e=>e.json())),staleTime:864e5});return{agents:null!==(e=null===o||void 0===o?void 0:o.agents)&&void 0!==e?e:[],isLoading:r,refresh:(0,l.useCallback)((()=>t()),[t])}}},14711:(e,n,t)=>{t.r(n),t.d(n,{default:()=>Mn});var a=t(34721),i=t(90840),l=t(32967),o=t(88616),r=t(49871),s=t(75045),d=t(46606),c=t(27766),u=t(37383),p=t(87447),m=t(6194),g=t(1426),h=t(42906);function v(e,n){return e.map((e=>({label:e.meta.title,value:e.id,...e}))).filter((e=>e.label.toLocaleLowerCase().includes(n||"")))}const y=e=>{let{loading:n,...t}=e;const{token:a}=p.A.useToken(),[l,o]=(0,u.A)(t),[s,d]=(0,g.useState)(),[y,f]=(0,g.useTransition)(),{agents:x}=(0,r.B)(),k=x.find((e=>e.id===l));return(0,h.jsx)(h.Fragment,{children:k&&(0,h.jsxs)(i.A,{gap:"xs",children:[(0,h.jsx)(c.W,{name:k.meta.avatar,height:a.sizeXL,width:a.sizeXL}),(0,h.jsx)(m.A,{showSearch:!0,onSearch:e=>{f((()=>{d(e)}))},filterOption:!1,loading:y||n,options:v(x,s),value:l,onChange:(e,n)=>{o(e,n)},popupMatchSelectWidth:!1})]})})};var f=t(48061),x=t(40361),k=t(74400),b=t(20730),j=t(40262),C=t(10933),S=t(42489),A=t(28081),w=t(8168);const T=e=>{let{id:n,label:t,max:a,min:i,step:l,description:o,disabled:r}=e;const{token:s}=p.A.useToken();return(0,h.jsx)(k.A.Item,{label:(0,h.jsx)(b.A,{justify:"between",style:{width:"240px"},children:(0,h.jsxs)(b.A,{gap:"xxs",children:[(0,h.jsx)(j.A.Text,{style:{fontSize:s.fontSizeSM,marginRight:s.marginXXS},children:t}),o&&(0,h.jsx)(x.A,{title:o,trigger:"hover"})]})}),name:n,children:(0,h.jsx)(f.A,{disabled:r,min:i,max:a,step:null!==l&&void 0!==l?l:null})})},I={maxTokens:{label:"Max Tokens",min:50,max:16384,step:1,description:(0,w.t)("chatui.chat.parameter.MaxTokens")},temperature:{label:"Temperature",min:0,max:1,step:.01,description:(0,w.t)("chatui.chat.parameter.Temperature")},topP:{label:"Top P",min:0,max:1,step:.01,description:(0,w.t)("chatui.chat.parameter.TopP")},topK:{label:"Top K",min:1,max:500,step:1,description:(0,w.t)("chatui.chat.parameter.TopK")},frequencyPenalty:{label:"Frequency Penalty",min:0,max:2,step:.01,description:(0,w.t)("chatui.chat.parameter.FrequencyPenalty")},presencePenalty:{label:"Presence Penalty",min:0,max:2,step:.01,description:(0,w.t)("chatui.chat.parameter.PresencePenalty")}},L={maxTokens:4096,temperature:.7,topP:1,topK:1,frequencyPenalty:1,presencePenalty:1},E=e=>{let{parameters:n,onChangeParameter:t}=e;const{token:a}=p.A.useToken(),[i,l]=(0,g.useState)(!1),o=(0,g.useRef)(Object.keys(n).length>0?n:L);return(0,h.jsx)(C.Ay,{theme:{components:{Form:{verticalLabelPadding:0,itemMarginBottom:a.marginXXS}}},children:(0,h.jsxs)(k.A,{size:"small",layout:"vertical",initialValues:Object.keys(n).length>0?n:L,onValuesChange:e=>{o.current={...o.current,...e},t(i,{...o.current})},children:[(0,h.jsxs)(b.A,{align:"center",justify:"space-between",children:[(0,h.jsx)(j.A.Text,{style:{fontSize:a.fontSizeLG,marginLeft:a.marginXXS},children:(0,w.t)("chatui.chat.parameter.Title")}),(0,h.jsx)(S.A,{checked:i,onChange:()=>{l(!i),t(!i,{...o.current})}})]}),(0,h.jsx)(A.A,{style:{marginBlock:a.marginSM}}),Object.entries(I).map((e=>{let[n,t]=e;return(0,h.jsx)(T,{disabled:!i,id:n,...t},n)}))]})})};var _=t(85288),F=t(27484),K=t.n(F),R=t(18347);var M=t(82929),P=t(38384),D=t(9976);const B=e=>{let{loading:n,total:t}=e;const{token:a}=p.A.useToken(),{t:l}=(0,D.Bd)();return(0,h.jsxs)(i.A,{justify:"end",gap:"xs",children:[n?(0,h.jsx)(P.A,{spin:!0,style:{color:a.colorTextSecondary}}):(0,h.jsx)("div",{}),(0,h.jsx)(j.A.Text,{type:"secondary",children:l("general.TotalItems",{total:t})})]})};var $,q,U=t(68325);const N=e=>{let{fetchKey:n,lifecycleStageFilter:a=["created"],loading:i,...o}=e;const{t:r}=(0,D.Bd)(),s=(0,l.CX)(),[d,c]=(0,u.A)(o),[p,m]=(0,u.A)(o,{valuePropName:"open",trigger:"onDropdownVisibleChange"}),v=(0,g.useDeferredValue)(p),[y,f]=(0,g.useState)(),x=(0,g.useDeferredValue)(y),k=(0,g.useRef)(null),b=a.map((e=>`lifecycle_stage == "${e}"`)).join(" | "),{endpoint:j}=(0,R.useLazyLoadQuery)(void 0!==$?$:$=t(68351),{endpoint_id:null!==d&&void 0!==d?d:""},{fetchPolicy:d?"store-or-network":"store-only"}),{paginationData:C,result:{endpoint_list:S},loadNext:A,isLoadingNext:w}=function(e,n,t,a,i){let{getItem:l,getId:o,getTotal:r}=i;const s=(0,g.useRef)([]),[d,c]=(0,g.useTransition)(),[u]=(0,g.useState)(n.limit),[p,m]=(0,g.useState)(0),h=(0,g.useRef)(t),v=!K().isEqual(h.current,t),y=(0,R.useLazyLoadQuery)(e,{limit:v?n.limit:u,offset:v?0:p,...t},a),f=(0,g.useMemo)((()=>{const e=l(y);return v&&(s.current=[]),e?K().uniqBy([...s.current,...e],o):void 0}),[y]),x=p+u<r(y),k=(0,_.E)((()=>{!d&&x&&(s.current=f||[],c((()=>{m(p+u)})))}));return(0,g.useEffect)((()=>{v&&(h.current=t,m(0))}),[v]),{paginationData:f,result:y,loadNext:k,hasNext:x,isLoadingNext:d}}(void 0!==q?q:q=t(86164),{limit:10},{filter:s.supports("endpoint-lifecycle-stage-filter")?[b,x?`name ilike "%${x}%"`:void 0].filter(Boolean).map((e=>`(${e})`)).join(" & "):void 0},{fetchKey:n,fetchPolicy:v?"network-only":"store-only"},{getTotal:e=>{var n;return null===(n=e.endpoint_list)||void 0===n?void 0:n.total_count},getItem:e=>{var n;return null===(n=e.endpoint_list)||void 0===n?void 0:n.items},getId:e=>null===e||void 0===e?void 0:e.endpoint_id}),T=K().map(C,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.endpoint_id,endpoint:e}))),[I,L]=(0,g.useState)(j?{label:(null===j||void 0===j?void 0:j.name)||void 0,value:(null===j||void 0===j?void 0:j.endpoint_id)||void 0}:{label:d,value:d}),E=y===x;return(0,g.useEffect)((()=>{var e;E&&(null===(e=k.current)||void 0===e||e.scrollTo(0))}),[E]),(0,h.jsx)(M.A,{ref:k,placeholder:r("chatui.SelectEndpoint"),style:{minWidth:100},showSearch:!0,searchValue:y,onSearch:e=>{f(e)},autoClearSearchValue:!0,filterOption:!1,loading:y!==x||i,options:T,...o,labelInValue:!0,value:I,onChange:(e,n)=>{var t,a;L(e),c(e.value,null===(t=K().castArray(n))||void 0===t?void 0:t[0].endpoint),null===(a=o.onChange)||void 0===a||a.call(o,e.value||"",n)},endReached:()=>{A()},open:p,onDropdownVisibleChange:m,notFoundContent:K().isUndefined(C)?(0,h.jsx)(U.A.Input,{active:!0,size:"small",block:!0}):void 0,footer:K().isNumber(null===S||void 0===S?void 0:S.total_count)&&S.total_count>0?(0,h.jsx)(B,{loading:w,total:null===S||void 0===S?void 0:S.total_count}):void 0})},V=e=>{let{models:n,...t}=e;const{t:a}=(0,D.Bd)();return(0,h.jsx)(m.A,{placeholder:a("chatui.SelectModel"),style:{fontWeight:"normal"},showSearch:!0,options:K().chain(n).groupBy("group").mapValues((e=>K().map(e,(e=>({label:e.label,value:e.name}))))).map(((e,n)=>({label:"undefined"===n?"Others":n,options:e}))).value(),popupMatchSelectWidth:!1,...t})};var z,Q=t(32017),H=t(80273),O=t(39651),W=t(17257),X=t(58485),G=t(20140),J=t(72046),Y=t(16332),Z=t(95440);const ee=e=>{let{sync:n,onClick:t}=e;const{t:a}=(0,D.Bd)();return(0,h.jsxs)(h.Fragment,{children:[n&&(0,h.jsx)(j.A.Text,{type:"secondary",children:a("chatui.SyncInput")}),(0,h.jsx)(S.A,{checked:n,onClick:t})]})},ne=e=>{let{showCompareMenuItem:n,closable:a,models:o,modelId:r,onChangeModel:c,endpointFrgmt:u,onChangeEndpoint:m,agent:v,onChangeAgent:f,sync:x,onChangeSync:k,onClickClose:b,onClickCreate:j,fetchKey:C,onClickDeleteChatHistory:S,parameters:A,usingParameters:w,onChangeParameter:T}=e;const{t:I}=(0,D.Bd)(),{token:L}=p.A.useToken(),_=(0,l.f0)(),[K,M]=(0,g.useTransition)(),[P,B]=(0,g.useTransition)(),$=(0,R.useFragment)(void 0!==z?z:z=t(930),u),q=(0,s.LY)([n&&{key:"compare",label:I("chatui.CompareWithOtherModels"),icon:(0,h.jsx)(Y.A,{}),onClick:()=>{var e;_({pathname:"/serving",search:new URLSearchParams({tab:"chatting",endpointId:null!==(e=null===$||void 0===$?void 0:$.endpoint_id)&&void 0!==e?e:"",modelId:r}).toString()})}},n&&{type:"divider"},{key:"clear",label:I("chatui.DeleteChatHistory"),icon:(0,h.jsx)(Z.A,{}),onClick:()=>{null===S||void 0===S||S()}},a&&{type:"divider"},a&&{key:"close",danger:!0,label:I("chatui.DeleteChattingSession"),icon:(0,h.jsx)(Q.A,{}),onClick:()=>{null===b||void 0===b||b()}}]),[U]=(0,d.q)("experimental_ai_agents");return(0,h.jsxs)(i.A,{direction:"row",justify:"start",wrap:"wrap",gap:"xs",style:{minHeight:"56px",width:"100%",paddingTop:L.paddingXS,paddingBottom:L.paddingXS},children:[(0,h.jsxs)(i.A,{wrap:"wrap",align:"start",gap:"xs",style:{flexGrow:1,flexShrink:1,flexBasis:"auto"},children:[U&&(0,h.jsx)(y,{loading:P,value:null===v||void 0===v?void 0:v.id,onChange:(e,n)=>{B((()=>{f(n)}))}}),(0,h.jsx)(N,{fetchKey:C,loading:K,onChange:e=>{M((()=>{null===m||void 0===m||m(e)}))},value:null===$||void 0===$?void 0:$.endpoint_id,popupMatchSelectWidth:!1}),!(0,F.isEmpty)(o)&&(0,h.jsx)(V,{models:o,value:r,onChange:e=>{(0,g.startTransition)((()=>{c(e)}))}})]}),(0,h.jsxs)(i.A,{gap:"xs",children:[a&&(0,h.jsx)(ee,{sync:x,onClick:e=>{(0,g.startTransition)((()=>{k(e)}))}}),(0,h.jsx)(X.A,{content:(0,h.jsx)(E,{parameters:A,onChangeParameter:(e,n)=>{(0,g.startTransition)((()=>{T(e,n)}))}}),trigger:"click",placement:"bottom",style:{padding:L.paddingXS},children:(0,h.jsx)(G.Ay,{icon:(0,h.jsx)(H.A,{style:{color:w?L.colorPrimary:void 0}})})}),(0,h.jsx)(G.Ay,{onClick:()=>null===j||void 0===j?void 0:j(),icon:(0,h.jsx)(O.A,{})}),(0,h.jsx)(J.A,{menu:{items:q},trigger:["click"],children:(0,h.jsx)(G.Ay,{type:"link",onClick:e=>e.preventDefault(),icon:(0,h.jsx)(W.A,{}),style:{color:L.colorTextSecondary,width:L.sizeMS}})})]})]})};var te=t(58049),ae=t(7405),ie=t(92713),le=t(17336),oe=t(14523);const re=e=>{let{items:n,onChange:t,dropContainerRef:a,children:i}=e;const{t:l}=(0,D.Bd)();return(0,h.jsx)(ie.A,{beforeUpload:()=>!1,getDropContainer:()=>a.current,accept:"image/*,text/*",items:n,onChange:t,placeholder:e=>"drop"===e?{title:l("chatui.DropFileHere")}:{icon:(0,h.jsx)(te.A,{}),title:l("chatui.UploadFiles"),description:l("chatui.UploadFilesDescription")},children:i})},se=e=>{let{loading:n,autoFocus:t,items:a,openAttachment:i,dropContainerRef:l,onInputChange:o,onInputSubmit:r,onInputCancel:s,onAttachmentChange:d,onAttachmentOpenChange:c,...u}=e;const{t:p}=(0,D.Bd)(),m=(0,g.useRef)(null);return(0,g.useEffect)((()=>{t&&m.current&&m.current.focus()}),[t]),(0,h.jsx)(le.A,{style:{flex:1},ref:m,...u,loading:n,onChange:o,onSubmit:r,onCancel:s,submitType:"enter",header:(0,h.jsx)(le.A.Header,{closable:!1,title:p("chatui.Attachments"),open:!!i&&!(0,F.isEmpty)(a),onOpenChange:c,styles:{content:{padding:0}},children:(0,h.jsx)(re,{items:a,dropContainerRef:l,onChange:e=>null===d||void 0===d?void 0:d("header",e)})}),prefix:(0,h.jsx)(re,{items:a,dropContainerRef:l,onChange:e=>null===d||void 0===d?void 0:d("prefix",e),children:(0,h.jsx)(oe.A,{dot:!(0,F.isEmpty)(a)&&!i,children:(0,h.jsx)(G.Ay,{type:"text",icon:(0,h.jsx)(ae.A,{})})})})})};var de=t(62021),ce=t(74157);const ue=(0,de.eU)(""),pe=(0,de.eU)(),me=(0,de.eU)(void 0),ge=e=>{let{sync:n,input:t,setInput:a,stop:l,append:o,isStreaming:r,disabled:d,dropContainerRef:c}=e;const{token:u}=p.A.useToken(),m={borderTop:`1px solid ${u.colorBorderSecondary}`,padding:u.paddingContentVertical},[v,y]=(0,g.useState)(!1),[f,x]=(0,g.useState)([]),[k,b]=(0,ce.fp)(ue),[j,C]=(0,ce.fp)(pe),[S,A]=(0,ce.fp)(me),w=(0,g.useId)(),T=(null===S||void 0===S?void 0:S.id)===w||null===S||void 0===S?void 0:S.key,I=(0,g.useRef)(n);(0,g.useEffect)((()=>{I.current!==n&&(a(""),I.current=n)}),[n,a]),(0,g.useEffect)((()=>{n&&!(0,F.isUndefined)(k)&&a(k)}),[k,a,n]);(0,g.useEffect)((()=>{var e;e=j,(0,F.isUndefined)(e)||(0,F.isEqual)(f,e)||(x(e),y(!0))}),[j]),(0,g.useEffect)((()=>{if(!(0,F.isUndefined)(T)&&t){const e={};(0,F.isEmpty)(f)||(e.experimental_attachments=(0,s.bJ)(f)),o({role:"user",content:t},e)}}),[T]);const L=(0,g.useCallback)((e=>{a(e),n&&b(e)}),[n,a,b]),E=(0,g.useCallback)((()=>{l()}),[l]),_=(0,g.useCallback)((()=>{if(t||!(0,F.isEmpty)(f)){const e={};(0,F.isEmpty)(f)||(e.experimental_attachments=(0,s.bJ)(f)),o({role:"user",content:t},e),setTimeout((()=>{a(""),x([]),y(!1)}),0),b(""),C([]),n&&A({id:w,key:(new Date).toString()})}}),[t,f,o,b,C,n,a,A,w]),K=(0,g.useCallback)(((e,t)=>{const a=t.fileList;x(a),"prefix"===e&&y(!0),n&&C(a)}),[n,x,y,C]),R=(0,g.useCallback)((e=>{y(e)}),[y]);return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(i.A,{style:m,direction:"column",align:"center",children:(0,h.jsx)(se,{disabled:d,placeholder:"Say something...",autoFocus:!0,value:t,items:f,openAttachment:v,dropContainerRef:c,loading:r,onInputChange:L,onInputSubmit:_,onInputCancel:E,onAttachmentChange:K,onAttachmentOpenChange:R})})})},he=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";const[n,a]=(0,g.useState)(0);return(0,g.useEffect)((()=>{(0,g.startTransition)((()=>{(async e=>{const{encode:n}=await t.e(1254).then(t.bind(t,61254));return n(e).length})(e).then(a).catch((()=>{a(e.length)}))}))}),[e]),n};var ve=t(50495),ye=t(44323);const fe=e=>{let{input:n,messages:t,startTime:a}=e;const{token:l}=p.A.useToken(),o=he(n),r=(0,g.useMemo)((()=>(0,F.map)(t,(e=>null===e||void 0===e?void 0:e.content)).join("")),[t]),s=o+he(r),d=(0,g.useMemo)((()=>{const e=(0,F.last)(t);return"assistant"===(null===e||void 0===e?void 0:e.role)?null===e||void 0===e?void 0:e.content:""}),[t]),c=he(d),u=(0,g.useMemo)((()=>c>0&&a?c/((Date.now()-a)/1e3):0),[c,a]);return(0,h.jsx)(i.A,{justify:"end",align:"end",style:{margin:l.marginSM},children:(0,h.jsx)(ye.A,{children:(0,h.jsxs)(i.A,{gap:"xs",children:[(0,h.jsx)(ve.A,{}),(0,h.jsxs)(i.A,{gap:"xxs",children:[(0,h.jsx)(j.A.Text,{children:u.toFixed(2)}),(0,h.jsx)(j.A.Text,{type:"secondary",children:"tok/s"})]}),(0,h.jsxs)(i.A,{gap:"xxs",children:[(0,h.jsx)(j.A.Text,{children:s}),(0,h.jsx)(j.A.Text,{type:"secondary",children:"total tokens"})]})]})})})};var xe=t(1469);const ke=(0,g.memo)((e=>{let{children:n,placement:t={},avatar:a,onMouseEnter:l,onMouseLeave:o}=e;const{token:r}=p.A.useToken();return(0,h.jsxs)(i.A,{direction:t.left?"row":"row-reverse",justify:"start",align:"baseline",style:{marginLeft:t.left?0:"15%",marginRight:t.right?0:20,paddingLeft:r.paddingMD,paddingRight:r.paddingMD,paddingTop:t.top?r.paddingMD:0,paddingBottom:t.bottom?r.paddingMD:0},gap:"sm",onMouseEnter:l,onMouseLeave:o,children:[(0,h.jsx)(xe.A,{icon:a,style:{fontSize:r.fontSizeHeading3}}),(0,h.jsx)(i.A,{direction:"column",align:t.left?"start":"end",wrap:"wrap",style:{flex:1},gap:"xs",children:n})]})}));ke.displayName="ChatMessageContainer";var be=t(8296),je=t(31778),Ce=t(29865),Se=t(80994);const Ae=e=>{let{copyable:n,defaultIcon:t,...a}=e;const[i,l]=(0,g.useState)(!1);return(0,g.useEffect)((()=>{if(i){const e=setTimeout((()=>{l(!1)}),2e3);return()=>clearTimeout(e)}}),[i]),(0,h.jsx)(be.A,{title:i?"Copied!":"Copy",open:!!i||void 0,children:(0,h.jsx)(Se.CopyToClipboard,{text:(null===n||void 0===n?void 0:n.text)||"",onCopy:async()=>{l(!0)},children:(0,h.jsx)(G.Ay,{icon:i?(0,h.jsx)(je.A,{}):t||(0,h.jsx)(Ce.A,{}),...a})})})};var we=t(70481),Te=t(5656),Ie=t(25596),Le=t(43114);const Ee={abap:!0,"actionscript-3":!0,ada:!0,apache:!0,apex:!0,apl:!0,applescript:!0,ara:!0,asm:!0,astro:!0,awk:!0,ballerina:!0,bat:!0,beancount:!0,berry:!0,bibtex:!0,bicep:!0,blade:!0,c:!0,cadence:!0,clarity:!0,clojure:!0,cmake:!0,cobol:!0,codeql:!0,coffee:!0,cpp:!0,crystal:!0,csharp:!0,css:!0,cue:!0,cypher:!0,d:!0,dart:!0,dax:!0,diff:!0,docker:!0,"dream-maker":!0,elixir:!0,elm:!0,erb:!0,erlang:!0,fish:!0,fsharp:!0,gdresource:!0,gdscript:!0,gdshader:!0,gherkin:!0,"git-commit":!0,"git-rebase":!0,"glimmer-js":!0,"glimmer-ts":!0,glsl:!0,gnuplot:!0,go:!0,graphql:!0,groovy:!0,hack:!0,haml:!0,handlebars:!0,haskell:!0,hcl:!0,hjson:!0,hlsl:!0,html:!0,http:!0,imba:!0,ini:!0,java:!0,javascript:!0,"jinja-html":!0,jison:!0,json:!0,json5:!0,jsonc:!0,jsonl:!0,jsonnet:!0,jssm:!0,jsx:!0,julia:!0,kotlin:!0,kusto:!0,latex:!0,less:!0,liquid:!0,lisp:!0,logo:!0,lua:!0,make:!0,markdown:!0,marko:!0,matlab:!0,mdc:!0,mdx:!0,mermaid:!0,mojo:!0,narrat:!0,nextflow:!0,nginx:!0,nim:!0,nix:!0,"objective-c":!0,"objective-cpp":!0,ocaml:!0,pascal:!0,perl:!0,php:!0,plsql:!0,postcss:!0,powerquery:!0,powershell:!0,prisma:!0,prolog:!0,proto:!0,pug:!0,puppet:!0,purescript:!0,python:!0,r:!0,raku:!0,razor:!0,reg:!0,rel:!0,riscv:!0,rst:!0,ruby:!0,rust:!0,sas:!0,sass:!0,scala:!0,scheme:!0,scss:!0,shaderlab:!0,shellscript:!0,shellsession:!0,smalltalk:!0,solidity:!0,sparql:!0,splunk:!0,sql:!0,"ssh-config":!0,stata:!0,stylus:!0,svelte:!0,swift:!0,"system-verilog":!0,tasl:!0,tcl:!0,tex:!0,toml:!0,tsx:!0,turtle:!0,twig:!0,typescript:!0,v:!0,vb:!0,verilog:!0,vhdl:!0,viml:!0,vue:!0,"vue-html":!0,vyper:!0,wasm:!0,wenyan:!0,wgsl:!0,wolfram:!0,xml:!0,xsl:!0,yaml:!0,zenscript:!0,zig:!0,bash:!0,batch:!0,be:!0,"c#":!0,cdc:!0,clj:!0,cmd:!0,console:!0,cql:!0,cs:!0,dockerfile:!0,erl:!0,"f#":!0,fs:!0,fsl:!0,gjs:!0,gts:!0,hbs:!0,hs:!0,jade:!0,js:!0,kql:!0,makefile:!0,md:!0,nar:!0,nf:!0,objc:!0,perl6:!0,properties:!0,ps:!0,ps1:!0,py:!0,ql:!0,rb:!0,rs:!0,sh:!0,shader:!0,shell:!0,spl:!0,styl:!0,ts:!0,vim:!0,vimscript:!0,vy:!0,yml:!0,zsh:!0,"\u6587\u8a00":!0},_e=(0,g.memo)((e=>{let{children:n,language:t}=e;const{data:a,isLoading:i}=((e,n)=>{const{isDarkMode:t}=(0,we.e)(),a=n.toLowerCase(),i=Ee[a]?a:"txt",l=(0,g.useMemo)((()=>Le.VV.hashStr(e)),[e]);return(0,Ie.Ay)([i,t?"d":"l",l].join("-"),(async()=>{try{return(0,Te.Yz)(e,{lang:i,theme:t?"github-dark":"github-light"})}catch(n){return console.error("shiki Highlight error:",n),e}}))})(n,t);return(0,h.jsx)(h.Fragment,{children:i||!a?(0,h.jsx)("pre",{children:(0,h.jsx)("code",{style:{whiteSpace:"pre-wrap"},children:n})}):(0,h.jsx)("div",{dangerouslySetInnerHTML:{__html:a},dir:"ltr"})})}));_e.displayName="SyntaxHighlighter";t(15148);var Fe=t(611),Ke=t(46132),Re=t(33532),Me=t(2128),Pe=t(63357),De=t(47732);const{Text:Be}=j.A;const $e=(0,g.memo)((e=>{let{children:n,...t}=e;return(0,h.jsx)(_e,{...t,children:n})}));$e.displayName="CodeBlock";const qe=(0,g.memo)((e=>{let{lang:n,extra:t}=e;const{token:a}=p.A.useToken();return(0,h.jsxs)(i.A,{style:{margin:0,minHeight:38,padding:`0 ${a.paddingSM}px`,background:"rgba(0, 0, 0, 0.02)",width:"100%"},children:[(0,h.jsx)(i.A,{style:{display:"inline-block",flex:"1",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:(0,h.jsx)(Be,{style:{fontWeight:"normal"},type:"secondary",children:n})}),(0,h.jsx)(i.A,{children:t})]})}));qe.displayName="CodeHead";const Ue=(0,g.memo)((e=>{let{block:n,isStreaming:t}=e;const a=(0,g.useCallback)((e=>{const{children:n,className:a,node:l,ref:o,...r}=e,s=/language-(\w+)/.exec(a||""),d=String(null!==n&&void 0!==n?n:"").replace(/\n$/,""),{token:c}=p.A.useToken();return s?(0,h.jsxs)(i.A,{direction:"column",style:{border:"1px solid #f0f0f0",margin:"0",padding:"0",borderRadius:c.borderRadiusLG,overflow:"hidden"},children:[(0,h.jsx)(qe,{lang:s[1],extra:(0,h.jsx)(Ae,{type:"text",copyable:{text:null!==d&&void 0!==d?d:""},style:{display:t?"none":"block"}})}),(0,h.jsx)(i.A,{style:{width:"100%",padding:c.paddingSM,borderRadius:`0 0 ${c.borderRadiusLG}px ${c.borderRadiusLG}px`,margin:"-0.5em 0",overflow:"scroll"},children:(0,h.jsx)($e,{...r,PreTag:"div",language:s[1],style:Re.A,wrapLongLines:!0,wrapLines:!0,children:d})})]}):(0,h.jsx)(i.A,{style:{width:"100%",padding:c.paddingSM,borderRadius:`0 0 ${c.borderRadiusLG}px ${c.borderRadiusLG}px`,margin:"-0.5em 0",overflow:"scroll"},children:(0,h.jsx)("code",{...r,style:{whiteSpace:"pre-wrap"},className:a,children:n})})}),[t]),l=(0,g.useCallback)((e=>{let{node:n,...t}=e;return(0,h.jsx)("p",{...t,style:{whiteSpace:"pre-wrap"}})}),[]);return(0,h.jsx)(Ke.oz,{remarkPlugins:[Pe.A,De.A],rehypePlugins:[Me.A],components:{p:l,code:a},children:n})}));Ue.displayName="ChatMessageContentBlock";const Ne=e=>{let{children:n,isStreaming:t}=e;return(0,g.useMemo)((()=>{return e=null!==n&&void 0!==n?n:"",Fe.xI.lexer(e).map((e=>e.raw));var e}),[n]).map(((e,n)=>(0,h.jsx)(Ue,{block:e,isStreaming:t},`block_${n}`)))};Ne.displayName="ChatMessageContent";const Ve=(0,g.memo)(Ne);var ze=t(22486),Qe=t(98593),He=t(66556);const Oe=e=>{let{extra:n,message:t,placement:a,enableExtraHover:l,isStreaming:o,avatar:r}=e;const{token:s}=p.A.useToken(),{t:d}=(0,D.Bd)(),[c,u]=(0,g.useState)(!1),{content:m,reasoning:v}=t;return(0,h.jsxs)(ke,{placement:a,avatar:r,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),children:[K().map(t.experimental_attachments,((e,n)=>K().includes(null===e||void 0===e?void 0:e.contentType,"image/")?(0,h.jsx)(i.A,{style:{border:"none",textAlign:"end"},align:"end",children:(0,h.jsx)(ze.A,{src:null===e||void 0===e?void 0:e.url,alt:null===e||void 0===e?void 0:e.name,style:{maxWidth:"50vw",maxHeight:"12vh",borderRadius:s.borderRadius}},`${null===t||void 0===t?void 0:t.id}-${n}`)}):(0,h.jsx)(ie.A.FileCard,{item:{uid:`${null===t||void 0===t?void 0:t.id}-${n}`,name:(null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.url),type:null===e||void 0===e?void 0:e.contentType,description:null===e||void 0===e?void 0:e.name,url:null===e||void 0===e?void 0:e.url}},n))),(0,h.jsxs)(i.A,{align:"stretch",direction:"column",style:{borderRadius:s.borderRadius,borderColor:s.colorBorderSecondary,borderWidth:s.lineWidth,padding:"1em",paddingTop:0,paddingBottom:0,backgroundColor:"user"!==t.role?s.colorBgContainer:s.colorBgContainerDisabled,maxWidth:"100%",width:K().trim(t.reasoning)?"100%":"auto"},children:[K().trim(t.reasoning)&&(0,h.jsx)(Qe.A,{style:{marginTop:s.margin,width:"100%"},items:[{key:"reasoning",label:K().isEmpty(m)?(0,h.jsxs)(i.A,{gap:"xs",children:[(0,h.jsx)(j.A.Text,{children:d("chatui.Thinking")}),(0,h.jsx)(He.A,{size:"small"})]}):(0,h.jsx)(j.A.Text,{children:d("chatui.ViewReasoning")}),children:(0,h.jsx)(Ve,{isStreaming:o,children:v})}]}),(0,h.jsx)(Ve,{isStreaming:o,children:m+(o?"\n":"")})]}),(0,h.jsx)(i.A,{style:{fontSize:s.fontSizeSM,...l?{opacity:c?1:0,transition:"opacity 0.2s",transitionDelay:c?"0s":"0.2s"}:{}},children:n})]})},We=(0,g.memo)(Oe);var Xe=t(3771);const Ge=e=>{let{message:n,isStreaming:t,placement:a}=e;return(0,h.jsx)(We,{message:n,placement:{...a,left:!0},isStreaming:t,enableExtraHover:!1,extra:(0,h.jsx)(Xe.Ay,{children:(0,h.jsx)(Ae,{type:"text",size:"small",copyable:{text:n.content},style:{display:t?"none":"block"}})}),avatar:"\ud83e\udd16"},n.id)};var Je=t(59404);const Ye=e=>{let{autoScroll:n,atBottom:t,...a}=e;const i=(0,_.E)(a.onScrollToBottom);return(0,g.useEffect)((()=>{t&&n&&(null===i||void 0===i||i("auto"))}),[t,n,i]),(0,h.jsx)(G.Ay,{icon:(0,h.jsx)(Je.A,{}),shape:"circle",onClick:()=>{i&&i("click")}})};var Ze=t(28703);const en={user:e=>{let{message:n,isStreaming:t,placement:a}=e;return(0,h.jsx)(We,{message:n,placement:{...a,right:!0},isStreaming:t,enableExtraHover:!0,extra:(0,h.jsx)(Xe.Ay,{children:null}),avatar:"\ud83e\uddd1\u200d\ud83e\uddb0"},n.id)},assistant:Ge,system:Ge,data:Ge},nn=e=>{let{messages:n,isStreaming:t}=e;const a=(0,g.useRef)(null),[l,o]=(0,g.useState)(!0),{token:r}=p.A.useToken(),s="undefined"!==typeof window?1.5*window.innerHeight:0,d=(0,g.useCallback)(((e,a)=>{const i=en[a.role];return(0,h.jsx)(h.Fragment,{children:(0,h.jsx)(i,{message:a,isStreaming:null!==t&&void 0!==t&&t,placement:{top:0===e,bottom:e===n.length-1}},a.id)})}),[t,n.length]);return(0,h.jsxs)(i.A,{direction:"column",align:"stretch",style:{height:"100%",flex:1},children:[(0,h.jsx)(Ze.aY,{atBottomStateChange:o,atBottomThreshold:60,computeItemKey:(e,n)=>n.id,data:n,followOutput:"auto",initialTopMostItemIndex:(null===n||void 0===n?void 0:n.length)-1,itemContent:d,overscan:s,ref:a}),(0,h.jsx)("div",{style:{position:"absolute",right:"50%",transform:"translateX(+50%)",bottom:r.marginSM,opacity:l?0:1,transition:"opacity 0.2s",transitionDelay:l?"0s":"0.2s"},children:(0,h.jsx)(Ye,{atBottom:l,autoScroll:t,onScrollToBottom:e=>{const n=a.current;switch(e){case"auto":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"auto",index:"LAST"});break;case"click":null===n||void 0===n||n.scrollToIndex({align:"end",behavior:"smooth",index:"LAST"})}}})})]})},tn=(0,g.memo)(nn),an=(0,g.memo)(fe),ln=e=>{let{messages:n,input:t,isStreaming:a,startTime:l}=e;return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(tn,{messages:n,isStreaming:a}),(0,h.jsx)(i.A,{direction:"column",align:"end",children:(0,h.jsx)(an,{messages:n,input:t,startTime:l})})]})};var on=t(66274);var rn,sn=t(83757),dn=t(89762),cn=t.n(dn);const un=e=>{let{endpointId:n,...a}=e;const{t:i}=(0,D.Bd)(),[l,o]=(0,u.A)(a),{endpoint_token_list:r}=(0,R.useLazyLoadQuery)(void 0!==rn?rn:rn=t(54320),{endpointId:n||"",isEmptyEndpointId:!n}),s=(0,g.useMemo)((()=>function(e){var n;if(!e.ok)return[];const t=cn()();return(0,F.sortBy)(null===(n=e.value)||void 0===n?void 0:n.items,"created_at").map((e=>({label:null===e||void 0===e?void 0:e.token,value:null===e||void 0===e?void 0:e.token,disabled:!cn()(null===e||void 0===e?void 0:e.valid_until).tz().isAfter(t)})))}(r)),[r]);return s.length<=0?(0,h.jsx)(sn.A,{onChange:e=>o(e.target.value)}):(0,h.jsx)(m.A,{placeholder:i("chatui.SelectToken"),style:{fontWeight:"normal",width:"200px"},options:s,value:l,onChange:(e,n)=>{var t,a;o(null!==(t=null===(a=(0,F.castArray)(n))||void 0===a?void 0:a[0].value)&&void 0!==t?t:"")},...a})};var pn=t(45554),mn=t(77123);const gn=e=>{let{baseURL:n,token:t,endpointId:a,loading:l,onSubmit:o}=e;const{t:r}=(0,D.Bd)(),{token:s}=p.A.useToken(),d=(0,g.useRef)(null),{origin:c,pathname:u}=function(e){const{origin:n,pathname:t}=new URL(e||"");return{origin:`${n}/`,pathname:t.replace(/^\//,"")}}(n);return(0,h.jsx)(i.A,{direction:"row",style:{padding:s.paddingSM,paddingRight:s.paddingContentHorizontalLG,paddingLeft:s.paddingContentHorizontalLG,backgroundColor:s.colorBgContainer},children:(0,h.jsxs)(k.A,{ref:d,layout:"horizontal",size:"small",requiredMark:"optional",style:{flex:1},initialValues:{basePath:u,token:t},children:[(0,h.jsx)("div",{style:{marginBottom:s.size},children:(0,h.jsx)(mn.A,{type:"warning",showIcon:!0,message:r("chatui.CannotFindModel")})}),(0,h.jsx)(k.A.Item,{label:r("modelService.BasePath"),name:"basePath",children:(0,h.jsx)(sn.A,{placeholder:"v1",addonBefore:c,defaultValue:u})}),(0,h.jsx)(k.A.Item,{label:r("modelService.Token"),name:"token",children:(0,h.jsx)(un,{loading:l,endpointId:a})}),(0,h.jsx)(G.Ay,{icon:(0,h.jsx)(pn.A,{}),loading:l,onClick:()=>{var e,n,t;null===o||void 0===o||o({baseURL:new URL(null!==(e=null===(n=d.current)||void 0===n?void 0:n.getFieldValue("basePath"))&&void 0!==e?e:"",c).toString(),token:null===(t=d.current)||void 0===t?void 0:t.getFieldValue("token")})},children:r("button.RefreshModelInformation")})]},n)})};var hn,vn=t(69731),yn=t(64181),fn=t(824),xn=t(52212),kn=t(59067),bn=t(92818);const jn=(0,bn.rU)((e=>{let{token:n,css:t}=e;return{chatCard:t`
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
  `,body:t`
    background-color: ${n.colorFillQuaternary};
    border-radius: 0;
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 0;
    height: 50%;
    position: relative;
  `,actions:t`
    padding-left: ${n.paddingContentHorizontal};
    padding-right: ${n.paddingContentHorizontal};
  `,header:t`
    zindex: 1;
  `,alert:t`
    margin: ${n.marginSM};
  `}}));function Cn(e,n,t){const{t:a}=(0,D.Bd)(),{data:i}=(0,o.nj)({queryKey:["models",n,t,e.apiKey],queryFn:async()=>{if(!t)return{data:[]};const n=function(e){const{origin:n,port:t,pathname:a}=new URL(e.trim()),i=t.length>0?`${n}:${t}`:n;return new URL("/"===a?"/models":`${a}/models`,i).toString()}(t),a=e.apiKey,i=await fetch(n,{headers:{Authorization:a?`Bearer ${a}`:""}}).catch((e=>({ok:!1,status:-1})));return i.ok?await i.json():{data:[],error:null===i||void 0===i?void 0:i.status}}});return{models:K().map((null===i||void 0===i?void 0:i.data)||[],(e=>({id:e.id,name:e.id}))),modelId:(0,g.useMemo)((()=>{var n,t,a;return e.modelId&&K().includes(K().map((null===i||void 0===i?void 0:i.data)||[],"id"),e.modelId)?e.modelId:null!==(n=null===i||void 0===i||null===(t=i.data)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.id)&&void 0!==n?n:"custom"}),[null===i||void 0===i?void 0:i.data,e.modelId]),modelsError:i.error&&(e=>{switch(e){case 401:return a("error.UnauthorizedToken");case 404:return a("error.NotFoundBasePath");case 500:return a("error.InternalServerError");case 503:return a("error.ServiceUnavailable");default:return a("error.UnknownError")}})(i.error)}}const Sn=ne,An=g.memo(ge);const wn=e=>{var n;let{chat:a,onUpdateChat:i,closable:o,fetchOnClient:s,onRequestClose:d,onCreateNewChat:c}=e;const{t:u}=(0,D.Bd)(),{message:p}=xn.A.useApp(),m=(0,R.useLazyLoadQuery)(void 0!==hn?hn:hn=t(33879),{endpointId:a.provider.endpointId||""},{fetchPolicy:a.provider.endpointId?"store-or-network":"store-only"}),v=m.endpoint.ok?m.endpoint.value:null,{styles:{chatCard:y,alert:f,...x}}=jn(),[k,b]=(0,g.useTransition)(),j=(0,g.useRef)(null),[C,S]=(0,l.Tw)("first"),[A,w]=(0,g.useState)(null),T=function(e,n){try{return n?new URL(e,n).toString():void 0}catch{console.error("Invalid base URL:",e,"endpointUrl",n)}}(a.provider.basePath,null===v||void 0===v?void 0:v.url),{models:I,modelId:L,modelsError:E}=Cn(a.provider,C,T),{agents:_}=(0,r.B)(),F=_.find((e=>e.id===a.provider.agentId)),{error:M,messages:P,input:B,setInput:$,stop:q,status:U,append:N,setMessages:V}=(0,yn.Y_)({id:`${a.id}-${null===v||void 0===v?void 0:v.endpoint_id}-${null!==(n=null===F||void 0===F?void 0:F.id)&&void 0!==n?n:"none"}-${L}`,api:T,credentials:a.provider.credentials,body:{modelId:L},experimental_throttle:50,fetch:async(e,n)=>{if(s||"custom"===L){var t;const e=JSON.parse(null===n||void 0===n?void 0:n.body),i=(0,vn.r)({baseURL:T,apiKey:a.provider.apiKey||"dummy"}),l=(0,fn.gM)({abortSignal:(null===n||void 0===n?void 0:n.signal)||void 0,model:(0,fn.ae)({model:i(L),middleware:(0,fn.Ol)({tagName:"think"})}),messages:null===e||void 0===e?void 0:e.messages,system:F&&null!==(t=F.config.system_prompt)&&void 0!==t?t:"",...a.usingParameters?a.parameters:{}});return w(Date.now()),l.toDataStreamResponse({sendReasoning:!0,getErrorMessage:e=>function(e){try{if(on.hL.isInstance(e))return e.responseBody?JSON.parse(e.responseBody||"{}").message:e.message;if(e instanceof Error)return e.message;if("string"===typeof e)return e}catch{}return"Unknown error:"+e}(e)})}return fetch(e,n)}}),z="streaming"===U||"submitted"===U;return(0,g.useEffect)((()=>{E&&"first"!==C&&p.error(`Error fetching models: ${E}`,5)}),[E,C,p]),(0,h.jsxs)(kn.A,{variant:"outlined",className:y,classNames:x,title:(0,h.jsx)(Sn,{models:I,modelId:L,onChangeModel:e=>{null===i||void 0===i||i({provider:{modelId:e}})},agents:_,agent:F,onChangeAgent:e=>{null===i||void 0===i||i({provider:{agentId:e.id,endpointId:e.endpoint_id}})},endpointFrgmt:v,onChangeEndpoint:e=>{null===i||void 0===i||i({provider:{endpointId:e}})},sync:a.sync,onChangeSync:e=>{null===i||void 0===i||i({sync:e})},fetchKey:C,closable:o,onClickCreate:c,onClickClose:()=>{null===d||void 0===d||d(a)},onClickDeleteChatHistory:()=>{V([])},parameters:a.parameters,usingParameters:a.usingParameters,onChangeParameter:(e,n)=>{null===i||void 0===i||i({usingParameters:e,parameters:n})}}),ref:j,children:[T&&v&&K().isEmpty(I)&&(0,h.jsx)(gn,{baseURL:T,token:a.provider.apiKey,endpointId:null===v||void 0===v?void 0:v.endpoint_id,loading:k,onSubmit:e=>{b((()=>{S(),null===i||void 0===i||i({...a,provider:{...a.provider,baseURL:e.baseURL,apiKey:e.token}})}))}}),K().isEmpty(null===M||void 0===M?void 0:M.message)?null:(0,h.jsx)(mn.A,{message:null===M||void 0===M?void 0:M.message,type:"error",showIcon:!0,className:f,closable:!0}),T?null:(0,h.jsx)(mn.A,{message:u("error.InvalidBaseURL"),type:"error",showIcon:!0,className:f,closable:!0}),(0,h.jsx)(ln,{messages:P,input:B,isStreaming:z,startTime:A}),(0,h.jsx)(An,{disabled:!T,sync:a.sync,input:B,setInput:$,stop:q,append:N,isStreaming:z,dropContainerRef:j})]})};var Tn=t(33341);const In=(0,bn.rU)((e=>{let{token:n,css:t}=e;return{chatView:t`
    overflow: auto;
    height: calc(100vh - 240px);
  `,skeleton:t`
    width: 100%;
    display: flex;
    flex-direction: column;
  `,chatCard:t`
    flex: 1;
    overflow: 'hidden';
  `,conversation:t`
    overflow: hidden;
  `}})),Ln={maxTokens:4096,temperature:.7,topP:1,topK:1,frequencyPenalty:1,presencePenalty:1};function En(e,n,t,a){return{id:e,conversationId:n,label:"Chat",sync:!0,provider:t,usingParameters:!1,parameters:a}}const _n=e=>{let{conversation:n,provider:t}=e;const a=En((0,g.useId)(),n.id,t,Ln),{list:l,remove:o,push:r,replace:s}=(0,Tn.A)([a]),{styles:d}=In();return(0,h.jsx)(i.A,{className:d.conversation,direction:"column",align:"stretch",gap:"xs",children:(0,h.jsx)(i.A,{className:d.chatView,gap:"xs",direction:"row",align:"stretch",children:(0,F.map)(l,((e,t)=>(0,h.jsx)(g.Suspense,{fallback:(0,h.jsx)(kn.A,{className:d.skeleton,variant:"outlined",children:(0,h.jsx)(U.A,{active:!0})}),children:(0,h.jsx)(wn,{className:d.chatCard,chat:e,onUpdateChat:n=>{const a=K().merge({},e,n);s(t,a)},fetchOnClient:!0,onRequestClose:()=>o(t),onCreateNewChat:()=>{r(En(l.length.toString(),n.id,e.provider,Ln))},closable:l.length>1})},e.id)))})})};var Fn,Kn=t(86289);const Rn={body:{overflow:"hidden"}};const Mn=()=>{var e;const[{endpointId:n,modelId:i,agentId:o}]=(0,Kn.useQueryParams)({endpointId:Kn.StringParam,agentId:Kn.StringParam,modelId:Kn.StringParam}),r=function(){var e;const n=(0,l.CX)(),{endpoint_list:a}=(0,R.useLazyLoadQuery)(void 0!==Fn?Fn:Fn=t(29559),{filter:n.supports("endpoint-lifecycle-stage-filter")?'lifecycle_stage == "created"':void 0});return(null===a||void 0===a||null===(e=a.items[0])||void 0===e?void 0:e.endpoint_id)||void 0}(),s={id:(0,g.useId)(),label:(0,w.t)("webui.menu.Chat"),chats:[]},d={basePath:"v1",agentId:null!==o&&void 0!==o?o:void 0,endpointId:null!==(e=null!==n&&void 0!==n?n:r)&&void 0!==e?e:void 0,modelId:null!==i&&void 0!==i?i:void 0};return(0,h.jsx)(a.A,{title:(0,w.t)("webui.menu.Chat"),styles:Rn,children:(0,h.jsx)(_n,{conversation:s,provider:d})})}},29559:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"filter"}],n=[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Literal",name:"limit",value:1},{kind:"Literal",name:"offset",value:0}],t={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ChatPageQuery",selections:[{alias:null,args:n,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[t],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ChatPageQuery",selections:[{alias:null,args:n,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"763e262ee50ff2487754885efebacb90",id:null,metadata:{},name:"ChatPageQuery",operationKind:"query",text:"query ChatPageQuery(\n  $filter: String\n) {\n  endpoint_list(limit: 1, offset: 0, filter: $filter) {\n    items {\n      endpoint_id\n      id\n    }\n  }\n}\n"}}}();a.hash="81b9bb8d9bd90410dd13088b30f18dc2";const i=a}}]);
//# sourceMappingURL=4711.dcac9105.chunk.js.map