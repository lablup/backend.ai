"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[266],{14001:function(e,n,a){var i=a(1413),l=a(29439),s=a(87760),t=a(4519),r=a(2556),o=function(e,n){var a=e.image,t=e.style,o=void 0===t?{}:t,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=(0,s.dS)(),c=(0,l.Z)(d,2)[1].getImageIcon;return(0,r.jsx)("img",{src:c(a),style:(0,i.Z)({width:"1em",height:"1em"},o),alt:u})};n.Z=t.memo(o)},3173:function(e,n,a){a.r(n);var i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionInfoCellFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null}],type:"ComputeSession",abstractKey:null,hash:"93f8cd0d4b47d24ea281955be0ad792b"};n.default=i},72428:function(e,n,a){a.r(n);var i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"ak"},n={defaultValue:null,kind:"LocalArgument",name:"group_id"},a={defaultValue:null,kind:"LocalArgument",name:"limit"},i={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"skipClusterSize"},s={defaultValue:null,kind:"LocalArgument",name:"status"},t=[{kind:"Variable",name:"access_key",variableName:"ak"},{kind:"Variable",name:"group_id",variableName:"group_id"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"status",variableName:"status"}],r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"starts_at",storageKey:null},F={alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null};return{fragment:{argumentDefinitions:[e,n,a,i,l,s],kind:"Fragment",metadata:null,name:"SessionListQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,m,g,f,y,k,p,S,h,v,x,F,{args:null,kind:"FragmentSpread",name:"SessionInfoCellFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,i,e,n,s,l],kind:"Operation",name:"SessionListQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,m,g,f,y,k,p,S,h,v,x,F,{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"e152f44d42d7fc4a33606a935adc582f",id:null,metadata:{},name:"SessionListQuery",operationKind:"query",text:"query SessionListQuery(\n  $limit: Int!\n  $offset: Int!\n  $ak: String\n  $group_id: String\n  $status: String\n  $skipClusterSize: Boolean!\n) {\n  compute_session_list(limit: $limit, offset: $offset, access_key: $ak, group_id: $group_id, status: $status) {\n    items {\n      id\n      type\n      session_id\n      name\n      image\n      architecture\n      created_at\n      terminated_at\n      status\n      status_info\n      service_ports\n      mounts\n      occupied_slots\n      access_key\n      starts_at\n      cluster_size @skipOnClient(if: $skipClusterSize)\n      ...SessionInfoCellFragment\n    }\n  }\n}\n\nfragment SessionInfoCellFragment on ComputeSession {\n  id\n  session_id\n  name\n  status\n  user_email\n  image\n}\n"}}}();i.hash="c41131439f810b7c5cd0bd9eb2857a46",n.default=i},6266:function(e,n,a){a.r(n),a.d(n,{default:function(){return G}});var i,l,s=a(93433),t=a(29439),r=a(99277),o=a(1413),u=a(44925),d=a(87760),c=a(50164),m=a(14001),g=a(4519),f=a(2556),y=function(e,n){var a=e.image;e.style;a=a||"";var i=(0,d.dS)(),l=(0,t.Z)(i,2)[1],s=l.getImageAliasName,r=l.getBaseVersion,o=l.getBaseImage;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{children:s(a)}),(0,f.jsx)("div",{children:r(a)}),(0,f.jsx)("div",{children:o(a)})]})},k=g.memo(y),p=a(61749),S=a(44036),h=a(57054),v=a(38818),x=a(28499),F=a(92171),_=a(81748),j=a(16980),b=function(e){var n=e.sessionFrgmt,l=e.onRename,s=(0,d.Dj)(),o=S.Z.useToken().token,u=(0,j.useFragment)(void 0!==i?i:i=a(3173),n),y=(0,c.Y)({mutationFn:function(e){var n=s.APIMajorVersion<5?u.name:u.session_id;return s.rename(n,e)}}),b=h.Z.useForm(),Z=(0,t.Z)(b,1)[0],I=(0,_.$G)().t,K=(0,g.useState)(!1),L=(0,t.Z)(K,2),N=L[0],R=L[1],C=(0,g.useState)(u.name),T=(0,t.Z)(C,2),E=T[0],A=T[1],D=function(){return["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(u.status||void 0)&&!function(){return["RESTARTING","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(u.status||void 0)&&s.email===u.user_email,G=y.isLoading||E!==u.name;return(0,f.jsxs)(r.Z,{direction:"column",children:[(0,f.jsx)(r.Z,{direction:"row",children:(0,f.jsx)(h.Z,{form:Z,children:N?(0,f.jsx)(h.Z.Item,{style:{margin:0},name:"name",rules:[{required:!0},{max:64},{pattern:/^(?:[a-zA-Z0-9][a-zA-Z0-9._-]{2,}[a-zA-Z0-9])?$/,message:I("session.Validation.EnterValidSessionName").toString()}],children:(0,f.jsx)(v.Z,{autoFocus:!0,onPressEnter:function(){Z.validateFields().then((function(e){var n=e.name;R(!1),A(n),y.mutate(n,{onSuccess:function(e){l&&l()},onError:function(e){A(u.name)}})}))},onKeyUp:function(e){"Escape"===e.key&&R(!1)}})}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(x.Z.Text,{style:{opacity:G?.5:1},children:E}),D&&(0,f.jsx)(F.ZP,{loading:G,type:"text",icon:(0,f.jsx)(p.Z,{}),style:{color:o.colorLink},onClick:function(){Z.setFieldsValue({name:u.name}),R(!0)}})]})})}),(0,f.jsx)(m.Z,{image:u.image}),(0,f.jsx)(k,{image:u.image})]})},Z=a(79876),I=["status","limit","currentPage","pageSize","projectId","filter","extraFetchKey"],K=function(e){var n,i=e.status,s=void 0===i?[]:i,r=(e.limit,e.currentPage),c=void 0===r?1:r,m=e.pageSize,y=void 0===m?50:m,k=e.projectId,p=e.filter,S=e.extraFetchKey,h=void 0===S?"":S,v=(0,u.Z)(e,I),x=(0,d.Dj)(),F=(0,d.Kr)("initial-fetch"),K=(0,t.Z)(F,2),L=K[0],N=K[1],R=(0,g.useDeferredValue)(L+h),C=(0,_.$G)().t;!x.supports("avoid-hol-blocking")&&s.includes("SCHEDULED")&&(s=s.filter((function(e){return"SCHEDULED"!==e})));var T=(0,j.useLazyLoadQuery)(void 0!==l?l:l=a(72428),{limit:y,offset:(c-1)*y,status:null===(n=s)||void 0===n?void 0:n.join(","),group_id:k,skipClusterSize:!x.supports("multi-container")},{fetchKey:R,fetchPolicy:"network-only"}).compute_session_list;return(0,f.jsx)(f.Fragment,{children:(0,f.jsx)(Z.Z,(0,o.Z)({scroll:{x:!0},columns:[{title:C("session.SessionInfo"),render:function(e,n,a){return console.log(n),(0,f.jsx)(b,{sessionFrgmt:n,onRename:function(){N(n.session_id+(new Date).toISOString())}},n.session_id)},fixed:"left"},{title:C("session.Status"),dataIndex:"status"},{title:C("general.Control")},{title:C("session.Configuration")},{title:C("session.Usage")},{title:C("session.Reservation")},{title:C("session.Architecture")},{title:C("session.SessionType")},{title:C("session.Agent")}],dataSource:((null===T||void 0===T?void 0:T.items)||[]).filter(p)},v))})},L=a(79781),N=a(33368),R=a(52176),C=a(15850),T=a(45110),E=a(12674),A=["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"],D={running:A,interactive:A,batch:A,inference:A,finished:["TERMINATED","CANCELLED"],others:["TERMINATING","ERROR"],default:A},G=function(e){var n=e.children,a=(0,_.$G)().t,i=(0,d.Dj)(),l=S.Z.useToken().token,o=(0,d.qh)(),u=(0,E.s0)(),c=(0,g.useState)("running"),m=(0,t.Z)(c,2),y=m[0],k=m[1],p=(0,g.useState)("next"),h=(0,t.Z)(p,2),v=h[0],j=h[1];return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(R.Z,{message:(0,f.jsxs)(r.Z,{gap:"md",children:[(0,f.jsxs)(x.Z.Text,{children:["This is"," ","current"===v?"current version":"NEXT generation"," ","of session list. you can switch anytime."]}),(0,f.jsx)(C.Z,{options:[{label:"Current",value:"current"},{label:(0,f.jsx)(x.Z.Text,{style:{color:"next"===v?l.colorPrimary:void 0},children:"Next"}),value:"next",icon:(0,f.jsx)(L.Z,{twoToneColor:l.colorWarning})}],value:v,onChange:function(e){return j(e)}})]}),type:"warning",banner:!0,style:{marginTop:-14,marginLeft:-14,marginRight:-14}}),"next"===v?(0,f.jsxs)(r.Z,{direction:"column",align:"stretch",style:{padding:l.padding,gap:l.margin},children:[n,(0,f.jsxs)(r.Z,{direction:"column",align:"stretch",children:[(0,f.jsx)(r.Z,{style:{flex:1},children:(0,f.jsx)(T.Z,{activeKey:y,onChange:function(e){return k(e)},tabBarStyle:{marginBottom:0},style:{width:"100%",paddingLeft:l.paddingMD,paddingRight:l.paddingMD,borderTopLeftRadius:l.borderRadius,borderTopRightRadius:l.borderRadius},items:[{key:"running",label:a("session.Running")},{key:"interactive",label:a("session.Interactive")},{key:"batch",label:a("session.Batch")}].concat((0,s.Z)(i.supports("inference-workload")?[{key:"inference",label:a("session.Inference")}]:[]),[{key:"finished",label:a("session.Finished")},{key:"others",label:a("session.Others")}]),tabBarExtraContent:{right:(0,f.jsx)(r.Z,{direction:"row",gap:"sm",children:(0,f.jsx)(F.ZP,{type:"primary",icon:(0,f.jsx)(N.Z,{}),onClick:function(){u("/session/start")},children:"START"})})}})}),(0,f.jsx)(g.Suspense,{fallback:(0,f.jsx)("div",{children:"loading.."}),children:(0,f.jsx)(K,{projectId:o.id,status:D[y]||D.default,filter:function(e){var n;return!["interactive","batch","inference"].includes(y)||(null===e||void 0===e||null===(n=e.type)||void 0===n?void 0:n.toLowerCase())===y},extraFetchKey:y})})]})]}):(0,f.jsx)(f.Fragment,{children:(0,f.jsx)("backend-ai-session-view",{class:"page",name:"job",active:!0})})]})}}}]);
//# sourceMappingURL=266.b42f923a.chunk.js.map