"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[272],{34680:(e,n,l)=>{l.d(n,{A:()=>p});var a=l(25339),i=l(62863),t=l(50840),r=l(65080),s=l(36209),o=l(87627),d=l(45901),u=l.n(d),c=l(76998),m=l(77678),g=l(23446);const p=e=>{let{open:n,onRequestClose:l,columns:d,displayedColumnKeys:p,...y}=e;const _=(0,c.useRef)(null),{t:k}=(0,m.Bd)(),{token:S}=t.A.useToken(),v=d.map((e=>{return"string"===typeof e.title?{label:e.title,value:u().toString(e.key)}:"object"===typeof e.title&&"props"in e.title?{label:(n=e.title,c.Children.map(n.props.children,(e=>{if("string"===typeof e)return e}))),value:u().toString(e.key)}:{label:void 0,value:u().toString(e.key)};var n}));return(0,g.jsx)(a.A,{title:k("table.SettingTable"),open:n,destroyOnClose:!0,centered:!0,onOk:()=>{var e;null===(e=_.current)||void 0===e||e.validateFields().then((e=>{l(e)})).catch((()=>{}))},onCancel:()=>{l()},...y,children:(0,g.jsxs)(r.A,{ref:_,preserve:!1,initialValues:{selectedColumnKeys:p||v.map((e=>e.value))},layout:"vertical",children:[(0,g.jsx)(r.A.Item,{name:"searchInput",label:k("table.SelectColumnToDisplay"),style:{marginBottom:0},children:(0,g.jsx)(s.A,{prefix:(0,g.jsx)(i.A,{}),style:{marginBottom:S.marginSM},placeholder:k("table.SearchTableColumn")})}),(0,g.jsx)(r.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.searchInput!==n.searchInput,children:e=>{let{getFieldValue:n}=e;const l=n("searchInput")?u().toLower(n("searchInput")):void 0,a=v.map((e=>u().toLower(u().toString(e.label)).includes(l||"")?e:{...e,style:{display:"none"}}));return(0,g.jsx)(r.A.Item,{name:"selectedColumnKeys",style:{height:220,overflowY:"auto"},children:(0,g.jsx)(o.A.Group,{options:a,style:{flexDirection:"column"}})})}})]})})}},25272:(e,n,l)=>{l.r(n),l.d(n,{default:()=>z});var a,i=l(44520),t=l(73819),r=l(29871),s=l(58218),o=l(34680),d=l(30032),u=l(83468),c=l(16162),m=l(57857),g=l(96495),p=l(63718),y=l(97041),_=l(187),k=l(57277),S=l(52569),v=l(44355),f=l(50840),F=l(24128),h=l(6932),x=l(59065),K=l(24717),b=l(29475),j=l(14862),A=l(14455),L=l.n(A),T=l(45901),C=l.n(T),E=l(76998),I=l(77678),w=l(3606),D=l(98322),V=l(23446);const z=e=>{let{children:n}=e;const{t:A}=(0,I.Bd)(),T=(0,u.CX)(),{token:z}=f.A.useToken(),N=(0,g.hd)(),[R,O]=(0,E.useState)(!1),[P,q]=(0,E.useState)(!1),[B,Q]=(0,E.useState)(null),[$,U]=(0,E.useState)(null),[M]=(0,E.useState)({current:1,pageSize:100}),[X,Y]=(0,E.useTransition)(),[H,W]=(0,u.Tw)("initial-fetch"),[G]=(0,E.useState)("services"),[J,Z]=(0,E.useState)(),[ee]=(0,c.U6)(),ne=[{title:A("modelService.EndpointName"),dataIndex:"endpoint_id",key:"endpointName",fixed:"left",render:(e,n)=>(0,V.jsx)(D.N_,{to:"/serving/"+e,children:n.name})},{title:A("modelService.EndpointId"),dataIndex:"endpoint_id",key:"endpoint_id",width:310,render:e=>(0,V.jsx)(F.A.Text,{code:!0,children:e})},{title:A("modelService.ServiceEndpoint"),dataIndex:"endpoint_id",key:"url",render:(e,n)=>n.url?(0,V.jsx)(F.A.Link,{copyable:!0,href:n.url,target:"_blank",children:n.url}):"-"},{title:A("modelService.Controls"),dataIndex:"controls",key:"controls",render:(e,n)=>{var l,a,i,t;return(0,V.jsxs)(r.A,{direction:"row",align:"stretch",children:[(0,V.jsx)(h.Ay,{type:"text",icon:(0,V.jsx)(p.A,{}),style:n.desired_session_count<0||"destroying"===(null===(l=n.status)||void 0===l?void 0:l.toLowerCase())||n.created_user_email&&n.created_user_email!==ee.email?{color:z.colorTextDisabled}:{color:z.colorInfo},disabled:n.desired_session_count<0||"destroying"===(null===(a=n.status)||void 0===a?void 0:a.toLowerCase())||!!n.created_user_email&&n.created_user_email!==ee.email,onClick:()=>{O(!R),Q(n)}}),(0,V.jsx)(x.A,{title:A("dialog.ask.DoYouWantToDeleteSomething",{name:n.name}),description:A("dialog.warning.CannotBeUndone"),okType:"danger",okText:A("button.Delete"),onConfirm:()=>{Z(n.endpoint_id),re.mutate((null===$||void 0===$?void 0:$.endpoint_id)||"",{onSuccess:e=>{Y((()=>{W()})),K.Ay.success(A("modelService.ServiceTerminated",{name:null===$||void 0===$?void 0:$.name}))},onError:e=>{console.log(e),K.Ay.error(A("modelService.FailedToTerminateService"))}})},children:(0,V.jsx)(h.Ay,{type:"text",icon:(0,V.jsx)(y.A,{style:n.desired_session_count<0||"destroying"===(null===(i=n.status)||void 0===i?void 0:i.toLowerCase())?void 0:{color:z.colorError}}),loading:re.isLoading&&J===n.endpoint_id,disabled:n.desired_session_count<0||"destroying"===(null===(t=n.status)||void 0===t?void 0:t.toLowerCase()),onClick:()=>{U(n)}})})]})}},{title:A("modelService.Status"),key:"status",render:(e,n)=>(0,V.jsx)(t.A,{endpointFrgmt:n})},...T.is_admin?[{title:A("modelService.Owner"),dataIndex:"created_user_email",key:"session_owner",render:(e,n)=>(0,V.jsx)(i.A,{endpointFrgmt:n})}]:[],{title:A("modelService.CreatedAt"),dataIndex:"created_at",key:"createdAt",render:e=>L()(e).format("ll LT"),defaultSortOrder:"descend",sortDirections:["descend","ascend","descend"],sorter:(e,n)=>{const l=L()(e.created_at),a=L()(n.created_at);return l.diff(a)}},{title:A("modelService.DesiredSessionCount"),dataIndex:"desired_session_count",key:"desiredSessionCount",render:e=>e<0?"-":e},{title:(0,V.jsxs)(r.A,{direction:"column",align:"start",children:[A("modelService.RoutingsCount"),(0,V.jsx)("br",{}),(0,V.jsxs)(F.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",A("modelService.Active/Total"),")"]})]}),key:"routingCount",render:(e,n)=>{var l;return C().filter(n.routings,(e=>"HEALTHY"===(null===e||void 0===e?void 0:e.status))).length+" / "+(null===(l=n.routings)||void 0===l?void 0:l.length)}},{title:A("modelService.Public"),key:"public",render:(e,n)=>n.open_to_public?(0,V.jsx)(_.A,{style:{color:z.colorSuccess}}):(0,V.jsx)(k.A,{style:{color:z.colorTextSecondary}})}],[le,ae]=(0,v.A)("backendaiwebui.EndpointListPage.displayedColumnKeys",{defaultValue:ne.map((e=>C().toString(e.key)))});(0,S.A)((()=>{(0,E.startTransition)((()=>{W()}))}),7e3);const{endpoint_list:ie}=(0,w.useLazyLoadQuery)(void 0!==a?a:a=l(69139),{offset:(M.current-1)*M.pageSize,limit:M.pageSize,projectID:N.id},{fetchPolicy:"initial-fetch"===H?"store-and-network":"network-only",fetchKey:H}),te=C().sortBy(null===ie||void 0===ie?void 0:ie.items,"name"),re=(0,m.E)({mutationFn:e=>(0,d.hu)({method:"DELETE",url:"/services/"+e,client:T})});return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(r.A,{direction:"column",align:"stretch",gap:"xs",children:(0,V.jsx)(r.A,{direction:"column",align:"stretch",children:(0,V.jsx)(b.A,{tabList:[{key:"services",label:A("modelService.Services")}],activeTabKey:G,tabBarExtraContent:(0,V.jsx)(h.Ay,{type:"primary",onClick:()=>{O(!0)},children:A("modelService.StartService")}),styles:{body:{padding:0,paddingTop:1}},children:(0,V.jsxs)(E.Suspense,{fallback:(0,V.jsx)("div",{children:"loading.."}),children:[(0,V.jsx)(j.A,{loading:X,scroll:{x:"max-content"},rowKey:"endpoint_id",dataSource:te||[],columns:ne.filter((e=>null===le||void 0===le?void 0:le.includes(C().toString(e.key))))}),(0,V.jsx)(r.A,{justify:"end",style:{padding:z.paddingXXS},children:(0,V.jsx)(h.Ay,{type:"text",icon:(0,V.jsx)(p.A,{}),onClick:()=>{q(!0)}})})]})})})}),(0,V.jsx)(s.A,{open:R,endpointFrgmt:B||null,onRequestClose:e=>{Q(null),O(!R),e&&Y((()=>{W()}))}}),(0,V.jsx)(o.A,{open:P,onRequestClose:e=>{(null===e||void 0===e?void 0:e.selectedColumnKeys)&&ae(null===e||void 0===e?void 0:e.selectedColumnKeys),q(!P)},columns:ne,displayedColumnKeys:le||[]})]})}},69139:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e={defaultValue:null,kind:"LocalArgument",name:"limit"},n={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"projectID"},a=[{kind:"Literal",name:"filter",value:"name != 'koalpaca-test'"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],i={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"model",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"domain",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"project",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"routing_id",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"endpoint",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"session",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"traffic_ratio",storageKey:null},F={alias:null,args:null,kind:"ScalarField",name:"created_user_email",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null};return{fragment:{argumentDefinitions:[e,n,l],kind:"Fragment",metadata:null,name:"EndpointListPageQuery",selections:[{alias:null,args:a,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[i,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[t,r,s,o,d,u,c,m,g,p,y,{kind:"RequiredField",field:_,action:"NONE",path:"endpoint_list.items.desired_session_count"},{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[k,S,v,f,d],storageKey:null},F,{args:null,kind:"FragmentSpread",name:"ServiceLauncherModalFragment"},{args:null,kind:"FragmentSpread",name:"EndpointOwnerInfoFragment"},{args:null,kind:"FragmentSpread",name:"EndpointStatusTagFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e,l],kind:"Operation",name:"EndpointListPageQuery",selections:[{alias:null,args:a,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[i,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[t,r,s,o,d,u,c,m,g,p,y,_,{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[k,S,v,f,d,h],storageKey:null},F,{alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"model_mount_destination",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"model_definition_path",storageKey:null},{alias:null,args:null,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"extra_mounts",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},h],storageKey:null},{alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image_object",plural:!1,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_local",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[x,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[x,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"size_bytes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"supported_accelerators",storageKey:null},h],storageKey:null},h,{alias:null,args:null,kind:"ScalarField",name:"session_owner_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"2c1efd80f524658cfe864dc29aeb3aef",id:null,metadata:{},name:"EndpointListPageQuery",operationKind:"query",text:'query EndpointListPageQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: "name != \'koalpaca-test\'") {\n    total_count\n    items {\n      name\n      endpoint_id\n      model\n      domain\n      status\n      project\n      resource_group\n      resource_slots\n      url\n      open_to_public\n      created_at @since(version: "23.09.0")\n      desired_session_count\n      routings {\n        routing_id\n        endpoint\n        session\n        traffic_ratio\n        status\n        id\n      }\n      created_user_email @since(version: "23.09.8")\n      ...ServiceLauncherModalFragment\n      ...EndpointOwnerInfoFragment\n      ...EndpointStatusTagFragment\n      id\n    }\n  }\n}\n\nfragment EndpointOwnerInfoFragment on Endpoint {\n  id\n  created_user_email @since(version: "23.09.8")\n  session_owner_email @since(version: "23.09.8")\n}\n\nfragment EndpointStatusTagFragment on Endpoint {\n  id\n  status\n}\n\nfragment ServiceLauncherModalFragment on Endpoint {\n  endpoint_id\n  desired_session_count\n  resource_group\n  resource_slots\n  resource_opts\n  cluster_mode\n  cluster_size\n  open_to_public\n  model\n  model_mount_destination @since(version: "24.03.4")\n  model_definition_path @since(version: "24.03.4")\n  extra_mounts @since(version: "24.03.4") {\n    row_id\n    id\n  }\n  image_object @since(version: "23.09.9") {\n    name\n    humanized_name\n    tag\n    registry\n    architecture\n    is_local\n    digest\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n    size_bytes\n    supported_accelerators\n    id\n  }\n  name\n}\n'}}}();a.hash="115f9b8bdb8107e20f20c6c21f6e492c";const i=a}}]);
//# sourceMappingURL=272.da5aa443.chunk.js.map