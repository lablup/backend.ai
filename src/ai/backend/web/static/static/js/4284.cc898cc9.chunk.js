"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[4284],{44520:(e,n,l)=>{l.d(n,{A:()=>m});var t,a=l(83468),i=l(71155),r=l(50840),s=l(20307),o=l(6932),d=(l(76998),l(77678)),u=l(3606),c=l(23446);const m=e=>{let{endpointFrgmt:n}=e;const{t:m}=(0,d.Bd)(),{token:g}=r.A.useToken(),p=(0,a.CX)(),y=(0,u.useFragment)(void 0!==t?t:t=l(21553),n);return p.supports("model-serving-endpoint-user-info")?(null===y||void 0===y?void 0:y.created_user_email)===(null===y||void 0===y?void 0:y.session_owner_email)?(null===y||void 0===y?void 0:y.session_owner_email)||"":(0,c.jsxs)(c.Fragment,{children:[(null===y||void 0===y?void 0:y.session_owner_email)||"",(0,c.jsx)(s.A,{title:m("modelService.ServiceDelegatedFrom",{createdUser:(null===y||void 0===y?void 0:y.created_user_email)||"",sessionOwner:(null===y||void 0===y?void 0:y.session_owner_email)||""}),children:(0,c.jsx)(o.Ay,{size:"small",type:"text",icon:(0,c.jsx)(i.A,{}),style:{color:g.colorTextSecondary}})})]}):p.email||""}},73819:(e,n,l)=>{l.d(n,{A:()=>s});var t,a=l(48713),i=(l(76998),l(3606)),r=l(23446);const s=e=>{var n;let{endpointFrgmt:s}=e;const o=(0,i.useFragment)(void 0!==t?t:t=l(82740),s);let d="default";switch(null===o||void 0===o||null===(n=o.status)||void 0===n?void 0:n.toUpperCase()){case"RUNNING":case"HEALTHY":d="success"}return(0,r.jsx)(a.A,{color:d,children:null===o||void 0===o?void 0:o.status})}},34680:(e,n,l)=>{l.d(n,{A:()=>p});var t=l(25339),a=l(62863),i=l(50840),r=l(65080),s=l(36209),o=l(87627),d=l(45901),u=l.n(d),c=l(76998),m=l(77678),g=l(23446);const p=e=>{let{open:n,onRequestClose:l,columns:d,displayedColumnKeys:p,...y}=e;const v=(0,c.useRef)(null),{t:_}=(0,m.Bd)(),{token:k}=i.A.useToken(),f=d.map((e=>{return"string"===typeof e.title?{label:e.title,value:u().toString(e.key)}:"object"===typeof e.title&&"props"in e.title?{label:(n=e.title,c.Children.map(n.props.children,(e=>{if("string"===typeof e)return e}))),value:u().toString(e.key)}:{label:void 0,value:u().toString(e.key)};var n}));return(0,g.jsx)(t.A,{title:_("table.SettingTable"),open:n,destroyOnClose:!0,centered:!0,onOk:()=>{var e;null===(e=v.current)||void 0===e||e.validateFields().then((e=>{l(e)})).catch((()=>{}))},onCancel:()=>{l()},...y,children:(0,g.jsxs)(r.A,{ref:v,preserve:!1,initialValues:{selectedColumnKeys:p||f.map((e=>e.value))},layout:"vertical",children:[(0,g.jsx)(r.A.Item,{name:"searchInput",label:_("table.SelectColumnToDisplay"),style:{marginBottom:0},children:(0,g.jsx)(s.A,{prefix:(0,g.jsx)(a.A,{}),style:{marginBottom:k.marginSM},placeholder:_("table.SearchTableColumn")})}),(0,g.jsx)(r.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.searchInput!==n.searchInput,children:e=>{let{getFieldValue:n}=e;const l=n("searchInput")?u().toLower(n("searchInput")):void 0,t=f.map((e=>u().toLower(u().toString(e.label)).includes(l||"")?e:{...e,style:{display:"none"}}));return(0,g.jsx)(r.A.Item,{name:"selectedColumnKeys",style:{height:220,overflowY:"auto"},children:(0,g.jsx)(o.A.Group,{options:t,style:{flexDirection:"column"}})})}})]})})}},21553:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointOwnerInfoFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_owner_email",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"fb21a441c8873205b5092ae1a5a7157e"},a=t},82740:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"EndpointStatusTagFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null}],type:"Endpoint",abstractKey:null,hash:"3b31efa50b55edddcb210b59003dc479"},a=t},94284:(e,n,l)=>{l.r(n),l.d(n,{default:()=>V});var t=l(44520),a=l(73819),i=l(29871),r=l(34680),s=l(30032),o=l(83468),d=l(16162),u=l(57857),c=l(96495),m=l(63718),g=l(97041),p=l(187),y=l(57277),v=l(76998),_=l(21112),k=l(32693);var f=function(e){if(e.id,"undefined"===typeof cancelAnimationFrame)return clearInterval(e.id);cancelAnimationFrame(e.id)};const S=function(e,n,l){var t=null===l||void 0===l?void 0:l.immediate,a=(0,_.A)(e),i=(0,v.useRef)(),r=(0,v.useCallback)((function(){i.current&&f(i.current)}),[]);return(0,v.useEffect)((function(){if((0,k.Et)(n)&&!(n<0))return t&&a.current(),i.current=function(e,n){if(void 0===n&&(n=0),"undefined"===typeof requestAnimationFrame)return{id:setInterval(e,n)};var l=Date.now(),t={id:0},a=function(){Date.now()-l>=n&&(e(),l=Date.now()),t.id=requestAnimationFrame(a)};return t.id=requestAnimationFrame(a),t}((function(){a.current()}),n),r}),[n]),r};var h,x=l(44355),F=l(50840),b=l(24128),A=l(6932),j=l(59065),K=l(24717),T=l(29475),w=l(14862),C=l(14455),E=l.n(C),I=l(45901),L=l.n(I),D=l(77678),N=l(3606),O=l(98322),R=l(23446);const V=e=>{let{children:n}=e;const{t:_}=(0,D.Bd)(),k=(0,o.CX)(),f=(0,o.f0)(),{token:C}=F.A.useToken(),I=(0,c.hd)(),[V,q]=(0,v.useState)(!1),[B,U]=(0,v.useState)(null),[P]=(0,v.useState)({current:1,pageSize:100}),[Q,$]=(0,v.useTransition)(),[z,H]=(0,o.Tw)("initial-fetch"),[X]=(0,v.useState)("services"),[Y,G]=(0,v.useState)(),[W]=(0,d.U6)(),M=[{title:_("modelService.EndpointName"),dataIndex:"endpoint_id",key:"endpointName",fixed:"left",render:(e,n)=>(0,R.jsx)(O.N_,{to:"/serving/"+e,children:n.name})},{title:_("modelService.EndpointId"),dataIndex:"endpoint_id",key:"endpoint_id",width:310,render:e=>(0,R.jsx)(b.A.Text,{code:!0,children:e})},{title:_("modelService.ServiceEndpoint"),dataIndex:"endpoint_id",key:"url",render:(e,n)=>n.url?(0,R.jsx)(b.A.Link,{copyable:!0,href:n.url,target:"_blank",children:n.url}):"-"},{title:_("modelService.Controls"),dataIndex:"controls",key:"controls",render:(e,n)=>{var l,t,a,r;return(0,R.jsxs)(i.A,{direction:"row",align:"stretch",children:[(0,R.jsx)(A.Ay,{type:"text",icon:(0,R.jsx)(m.A,{}),style:n.desired_session_count<0||"destroying"===(null===(l=n.status)||void 0===l?void 0:l.toLowerCase())||n.created_user_email&&n.created_user_email!==W.email?{color:C.colorTextDisabled}:{color:C.colorInfo},disabled:n.desired_session_count<0||"destroying"===(null===(t=n.status)||void 0===t?void 0:t.toLowerCase())||!!n.created_user_email&&n.created_user_email!==W.email,onClick:()=>{f("/service/update/"+n.endpoint_id)}}),(0,R.jsx)(j.A,{title:_("dialog.ask.DoYouWantToDeleteSomething",{name:n.name}),description:_("dialog.warning.CannotBeUndone"),okType:"danger",okText:_("button.Delete"),onConfirm:()=>{G(n.endpoint_id),le.mutate((null===B||void 0===B?void 0:B.endpoint_id)||"",{onSuccess:e=>{$((()=>{H()})),K.Ay.success(_("modelService.ServiceTerminated",{name:null===B||void 0===B?void 0:B.name}))},onError:e=>{console.log(e),K.Ay.error(_("modelService.FailedToTerminateService"))}})},children:(0,R.jsx)(A.Ay,{type:"text",icon:(0,R.jsx)(g.A,{style:n.desired_session_count<0||"destroying"===(null===(a=n.status)||void 0===a?void 0:a.toLowerCase())?void 0:{color:C.colorError}}),loading:le.isLoading&&Y===n.endpoint_id,disabled:n.desired_session_count<0||"destroying"===(null===(r=n.status)||void 0===r?void 0:r.toLowerCase()),onClick:()=>{U(n)}})})]})}},{title:_("modelService.Status"),key:"status",render:(e,n)=>(0,R.jsx)(a.A,{endpointFrgmt:n})},...k.is_admin?[{title:_("modelService.Owner"),dataIndex:"created_user_email",key:"session_owner",render:(e,n)=>(0,R.jsx)(t.A,{endpointFrgmt:n})}]:[],{title:_("modelService.CreatedAt"),dataIndex:"created_at",key:"createdAt",render:e=>E()(e).format("ll LT"),defaultSortOrder:"descend",sortDirections:["descend","ascend","descend"],sorter:(e,n)=>{const l=E()(e.created_at),t=E()(n.created_at);return l.diff(t)}},{title:_("modelService.DesiredSessionCount"),dataIndex:"desired_session_count",key:"desiredSessionCount",render:e=>e<0?"-":e},{title:(0,R.jsxs)(i.A,{direction:"column",align:"start",children:[_("modelService.RoutingsCount"),(0,R.jsx)("br",{}),(0,R.jsxs)(b.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",_("modelService.Active/Total"),")"]})]}),key:"routingCount",render:(e,n)=>{var l;return L().filter(n.routings,(e=>"HEALTHY"===(null===e||void 0===e?void 0:e.status))).length+" / "+(null===(l=n.routings)||void 0===l?void 0:l.length)}},{title:_("modelService.Public"),key:"public",render:(e,n)=>n.open_to_public?(0,R.jsx)(p.A,{style:{color:C.colorSuccess}}):(0,R.jsx)(y.A,{style:{color:C.colorTextSecondary}})}],[J,Z]=(0,x.A)("backendaiwebui.EndpointListPage.displayedColumnKeys",{defaultValue:M.map((e=>L().toString(e.key)))});S((()=>{(0,v.startTransition)((()=>{H()}))}),7e3);const{endpoint_list:ee}=(0,N.useLazyLoadQuery)(void 0!==h?h:h=l(69139),{offset:(P.current-1)*P.pageSize,limit:P.pageSize,projectID:I.id},{fetchPolicy:"initial-fetch"===z?"store-and-network":"network-only",fetchKey:z}),ne=L().sortBy(null===ee||void 0===ee?void 0:ee.items,"name"),le=(0,u.E)({mutationFn:e=>(0,s.hu)({method:"DELETE",url:"/services/"+e,client:k})});return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(i.A,{direction:"column",align:"stretch",gap:"xs",children:(0,R.jsx)(i.A,{direction:"column",align:"stretch",children:(0,R.jsx)(T.A,{tabList:[{key:"services",label:_("modelService.Services")}],activeTabKey:X,tabBarExtraContent:(0,R.jsx)(A.Ay,{type:"primary",onClick:()=>{f("/service/start")},children:_("modelService.StartService")}),styles:{body:{padding:0,paddingTop:1}},children:(0,R.jsxs)(v.Suspense,{fallback:(0,R.jsx)("div",{children:"loading.."}),children:[(0,R.jsx)(w.A,{loading:Q,scroll:{x:"max-content"},rowKey:"endpoint_id",dataSource:ne||[],columns:M.filter((e=>null===J||void 0===J?void 0:J.includes(L().toString(e.key))))}),(0,R.jsx)(i.A,{justify:"end",style:{padding:C.paddingXXS},children:(0,R.jsx)(A.Ay,{type:"text",icon:(0,R.jsx)(m.A,{}),onClick:()=>{q(!0)}})})]})})})}),(0,R.jsx)(r.A,{open:V,onRequestClose:e=>{(null===e||void 0===e?void 0:e.selectedColumnKeys)&&Z(null===e||void 0===e?void 0:e.selectedColumnKeys),q(!V)},columns:M,displayedColumnKeys:J||[]})]})}},69139:(e,n,l)=>{l.r(n),l.d(n,{default:()=>a});const t=function(){var e={defaultValue:null,kind:"LocalArgument",name:"limit"},n={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"projectID"},t=[{kind:"Literal",name:"filter",value:"name != 'koalpaca-test'"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],a={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"model",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"domain",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"project",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"routing_id",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"endpoint",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"session",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"traffic_ratio",storageKey:null},h={alias:null,args:null,concreteType:"RuntimeVariantInfo",kind:"LinkedField",name:"runtime_variant",plural:!1,selections:[i,{alias:null,args:null,kind:"ScalarField",name:"human_readable_name",storageKey:null}],storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"created_user_email",storageKey:null},F={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[e,n,l],kind:"Fragment",metadata:null,name:"EndpointListPageQuery",selections:[{alias:null,args:t,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[a,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[i,r,s,o,d,u,c,m,g,p,y,{kind:"RequiredField",field:v,action:"NONE",path:"endpoint_list.items.desired_session_count"},{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[_,k,f,S,d],storageKey:null},h,x,{args:null,kind:"FragmentSpread",name:"EndpointOwnerInfoFragment"},{args:null,kind:"FragmentSpread",name:"EndpointStatusTagFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e,l],kind:"Operation",name:"EndpointListPageQuery",selections:[{alias:null,args:t,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[a,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[i,r,s,o,d,u,c,m,g,p,y,v,{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[_,k,f,S,d,F],storageKey:null},h,x,F,{alias:null,args:null,kind:"ScalarField",name:"session_owner_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"083a2df0fceb9dd49f7785b83610f897",id:null,metadata:{},name:"EndpointListPageQuery",operationKind:"query",text:'query EndpointListPageQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: "name != \'koalpaca-test\'") {\n    total_count\n    items {\n      name\n      endpoint_id\n      model\n      domain\n      status\n      project\n      resource_group\n      resource_slots\n      url\n      open_to_public\n      created_at @since(version: "23.09.0")\n      desired_session_count\n      routings {\n        routing_id\n        endpoint\n        session\n        traffic_ratio\n        status\n        id\n      }\n      runtime_variant @since(version: "24.03.5") {\n        name\n        human_readable_name\n      }\n      created_user_email @since(version: "23.09.8")\n      ...EndpointOwnerInfoFragment\n      ...EndpointStatusTagFragment\n      id\n    }\n  }\n}\n\nfragment EndpointOwnerInfoFragment on Endpoint {\n  id\n  created_user_email @since(version: "23.09.8")\n  session_owner_email @since(version: "23.09.8")\n}\n\nfragment EndpointStatusTagFragment on Endpoint {\n  id\n  status\n}\n'}}}();t.hash="417da934708786432bccc5e7f2a2e9f9";const a=t}}]);
//# sourceMappingURL=4284.cc898cc9.chunk.js.map