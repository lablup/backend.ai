{"version":3,"file":"static/js/7492.0867fde1.chunk.js","mappings":"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","sources":["../../node_modules/.pnpm/@ant-design+icons-svg@4.4.2/node_modules/@ant-design/icons-svg/es/asn/WarningTwoTone.js","../../node_modules/.pnpm/@ant-design+icons@5.6.1_react-dom@19.2.0_react@19.2.0__react@19.2.0/node_modules/@ant-design/icons/es/icons/WarningTwoTone.js","components/ResetPasswordRequired.tsx","components/UserProfileSettingModal.tsx"],"sourcesContent":["// This icon file is generated automatically.\nvar WarningTwoTone = { \"icon\": function render(primaryColor, secondaryColor) { return { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z\", \"fill\": primaryColor } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M172.2 828.1h679.6L512 239.9 172.2 828.1zM560 720a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm-16-304v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8z\", \"fill\": secondaryColor } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z\", \"fill\": primaryColor } }] }; }, \"name\": \"warning\", \"theme\": \"twotone\" };\nexport default WarningTwoTone;\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\n\nimport * as React from 'react';\nimport WarningTwoToneSvg from \"@ant-design/icons-svg/es/asn/WarningTwoTone\";\nimport AntdIcon from \"../components/AntdIcon\";\nvar WarningTwoTone = function WarningTwoTone(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _extends({}, props, {\n    ref: ref,\n    icon: WarningTwoToneSvg\n  }));\n};\n\n/**![warning](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIGZpbGw9IiNjYWNhY2EiIHZpZXdCb3g9IjY0IDY0IDg5NiA4OTYiIGZvY3VzYWJsZT0iZmFsc2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTk1NS43IDg1NmwtNDE2LTcyMGMtNi4yLTEwLjctMTYuOS0xNi0yNy43LTE2cy0yMS42IDUuMy0yNy43IDE2bC00MTYgNzIwQzU2IDg3Ny40IDcxLjQgOTA0IDk2IDkwNGg4MzJjMjQuNiAwIDQwLTI2LjYgMjcuNy00OHptLTc4My41LTI3LjlMNTEyIDIzOS45bDMzOS44IDU4OC4ySDE3Mi4yeiIgZmlsbD0iIzE2NzdmZiIgLz48cGF0aCBkPSJNMTcyLjIgODI4LjFoNjc5LjZMNTEyIDIzOS45IDE3Mi4yIDgyOC4xek01NjAgNzIwYTQ4LjAxIDQ4LjAxIDAgMDEtOTYgMCA0OC4wMSA0OC4wMSAwIDAxOTYgMHptLTE2LTMwNHYxODRjMCA0LjQtMy42IDgtOCA4aC00OGMtNC40IDAtOC0zLjYtOC04VjQxNmMwLTQuNCAzLjYtOCA4LThoNDhjNC40IDAgOCAzLjYgOCA4eiIgZmlsbD0iI2U2ZjRmZiIgLz48cGF0aCBkPSJNNDY0IDcyMGE0OCA0OCAwIDEwOTYgMCA0OCA0OCAwIDEwLTk2IDB6bTE2LTMwNHYxODRjMCA0LjQgMy42IDggOCA4aDQ4YzQuNCAwIDgtMy42IDgtOFY0MTZjMC00LjQtMy42LTgtOC04aC00OGMtNC40IDAtOCAzLjYtOCA4eiIgZmlsbD0iIzE2NzdmZiIgLz48L3N2Zz4=) */\nvar RefIcon = /*#__PURE__*/React.forwardRef(WarningTwoTone);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'WarningTwoTone';\n}\nexport default RefIcon;","import { baiSignedRequestWithPromise } from '../helper';\nimport { useAnonymousBackendaiClient } from '../hooks';\nimport { useTanMutation } from '../hooks/reactQueryAlias';\nimport { useWebComponentInfo } from './DefaultProviders';\nimport { WarningTwoTone } from '@ant-design/icons';\nimport { Button, Form, Modal, Typography, Input, theme } from 'antd';\nimport { BAIFlex } from 'backend.ai-ui';\nimport { useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\n// src/components/backend-ai-common-utils.ts\nexport const passwordPattern = /^(?=.*\\d)(?=.*[a-zA-Z])(?=.*[_\\W]).{8,}$/;\n\nconst ResetPasswordRequired = () => {\n  const { value, dispatchEvent } = useWebComponentInfo();\n  let parsedValue: {\n    open: boolean;\n    currentPassword: string;\n    username: string;\n    api_endpoint: string;\n  };\n  try {\n    parsedValue = JSON.parse(value || '');\n  } catch (error) {\n    parsedValue = {\n      open: false,\n      currentPassword: '',\n      username: '',\n      api_endpoint: '',\n    };\n  }\n  const { open, currentPassword, username, api_endpoint } = parsedValue;\n\n  const { token } = theme.useToken();\n  const [form] = Form.useForm<{\n    newPassword: string;\n    confirm: string;\n  }>();\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    if (open) {\n      form.resetFields();\n    }\n  }, [open, form]);\n\n  const anonymousBaiClient = useAnonymousBackendaiClient({ api_endpoint });\n\n  const mutation = useTanMutation({\n    mutationFn: (body: {\n      username: string;\n      current_password: string;\n      new_password: string;\n    }) => {\n      return baiSignedRequestWithPromise({\n        method: 'POST',\n        url: '/server/update-password-no-auth',\n        body,\n        client: anonymousBaiClient,\n      });\n    },\n  });\n\n  const onSubmit = () => {\n    form.validateFields().then((values) => {\n      mutation.mutate(\n        {\n          username: username,\n          current_password: currentPassword,\n          new_password: values.newPassword,\n        },\n        {\n          onSuccess() {\n            dispatchEvent('ok', null);\n          },\n          onError() {},\n        },\n      );\n    });\n  };\n\n  return (\n    <Modal\n      open={open}\n      centered\n      mask={false}\n      onCancel={() => {\n        dispatchEvent('cancel', null);\n      }}\n      keyboard={false}\n      maskClosable={false}\n      footer={null}\n      width={450}\n      destroyOnHidden={true}\n      forceRender\n    >\n      <BAIFlex\n        direction=\"column\"\n        justify=\"start\"\n        align=\"stretch\"\n        gap={'md'}\n        style={{\n          alignSelf: 'stretch',\n          paddingTop: token.paddingMD,\n          paddingBottom: token.paddingMD,\n        }}\n      >\n        <Typography.Title level={3} style={{ margin: 0 }}>\n          <WarningTwoTone twoToneColor={token.colorWarning} />{' '}\n          {t('webui.menu.PleaseChangeYourPassword')}\n        </Typography.Title>\n        {t('webui.menu.YouMushChangeYourPassword')}\n        <Form\n          form={form}\n          layout=\"vertical\"\n          initialValues={{\n            currentPassword: currentPassword,\n          }}\n          disabled={mutation.isPending}\n        >\n          <Form.Item\n            name=\"newPassword\"\n            label={t('webui.menu.NewPassword')}\n            rules={[\n              {\n                required: true,\n              },\n              {\n                pattern: passwordPattern,\n                message: t('webui.menu.InvalidPasswordMessage').toString(),\n              },\n              () => ({\n                validator(_, value) {\n                  if (currentPassword === value) {\n                    return Promise.reject(\n                      new Error(\n                        t('webui.menu.NewPasswordCannotBeSame').toString(),\n                      ),\n                    );\n                  }\n                  return Promise.resolve();\n                },\n              }),\n            ]}\n            hasFeedback\n          >\n            <Input.Password />\n          </Form.Item>\n\n          <Form.Item\n            name=\"confirm\"\n            label={t('webui.menu.NewPasswordAgain')}\n            dependencies={['newPassword']}\n            hasFeedback\n            rules={[\n              {\n                required: true,\n              },\n              ({ getFieldValue }) => ({\n                validator(_, value) {\n                  if (!value || getFieldValue('newPassword') === value) {\n                    return Promise.resolve();\n                  }\n                  return Promise.reject(\n                    new Error(t('environment.PasswordsDoNotMatch').toString()),\n                  );\n                },\n              }),\n            ]}\n          >\n            <Input.Password onPressEnter={onSubmit} />\n          </Form.Item>\n        </Form>\n        <Button type=\"primary\" onClick={onSubmit} loading={mutation.isPending}>\n          {t('webui.menu.Update')}\n        </Button>\n      </BAIFlex>\n    </Modal>\n  );\n};\n\nexport default ResetPasswordRequired;\n","/**\n @license\n Copyright (c) 2015-2025 Lablup Inc. All rights reserved.\n */\nimport { UserProfileSettingModalQuery } from '../__generated__/UserProfileSettingModalQuery.graphql';\nimport { useSuspendedBackendaiClient } from '../hooks';\nimport { useCurrentUserInfo, useCurrentUserRole } from '../hooks/backendai';\nimport { useTanMutation } from '../hooks/reactQueryAlias';\nimport { passwordPattern } from './ResetPasswordRequired';\nimport TOTPActivateModal from './TOTPActivateModal';\nimport { UserProfileQuery } from './UserProfileSettingModalQuery';\nimport { ExclamationCircleFilled, LoadingOutlined } from '@ant-design/icons';\nimport { useToggle } from 'ahooks';\nimport {\n  Modal,\n  ModalProps,\n  Input,\n  Form,\n  message,\n  Switch,\n  Spin,\n  FormInstance,\n} from 'antd';\nimport { BAIModal, useErrorMessageResolver } from 'backend.ai-ui';\nimport React, { useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { PreloadedQuery, usePreloadedQuery } from 'react-relay';\n\ninterface Props extends ModalProps {\n  queryRef: PreloadedQuery<UserProfileSettingModalQuery>;\n  onRequestClose: (success?: boolean) => void;\n  onRequestRefresh: () => void;\n  totpSupported?: boolean;\n  isRefreshModalPending?: boolean;\n}\n\ntype UserProfileFormValues = {\n  full_name: string;\n  originalPassword?: string;\n  newPasswordConfirm?: string;\n  newPassword?: string;\n  totp_activated: boolean;\n};\n\nconst UserProfileSettingModal: React.FC<Props> = ({\n  onRequestClose,\n  onRequestRefresh,\n  isRefreshModalPending,\n  totpSupported,\n  queryRef,\n  ...baiModalProps\n}) => {\n  const { t } = useTranslation();\n  const formRef = useRef<FormInstance<UserProfileFormValues>>(null);\n  const [messageApi, contextHolder] = message.useMessage();\n  const [modal, modalContextHolder] = Modal.useModal();\n  const [isOpenTOTPActivateModal, { toggle: toggleTOTPActivateModal }] =\n    useToggle(false);\n  const baiClient = useSuspendedBackendaiClient();\n  const userRole = useCurrentUserRole();\n  const [userInfo, userMutations] = useCurrentUserInfo();\n  const { getErrorMessage } = useErrorMessageResolver();\n\n  const { user } = usePreloadedQuery(UserProfileQuery, queryRef);\n\n  const mutationToRemoveTotp = useTanMutation({\n    mutationFn: () => {\n      return baiClient.remove_totp();\n    },\n  });\n\n  const onSubmit = () => {\n    formRef.current\n      ?.validateFields()\n      .then((values) => {\n        userMutations.updateFullName(values.full_name, {\n          onSuccess: (newFullName) => {\n            if (newFullName !== userInfo.full_name) {\n              messageApi.open({\n                type: 'success',\n                content: t('webui.menu.FullNameUpdated'),\n              });\n            }\n\n            if (\n              values.newPassword &&\n              values.newPasswordConfirm &&\n              values.originalPassword\n            ) {\n              userMutations.updatePassword(\n                {\n                  new_password: values.newPassword,\n                  new_password2: values.newPasswordConfirm,\n                  old_password: values.originalPassword,\n                },\n                {\n                  onSuccess: () => {\n                    messageApi.open({\n                      type: 'success',\n                      content: t('webui.menu.PasswordUpdated'),\n                    });\n                    onRequestClose(true);\n                  },\n                  onError: (e) => {\n                    messageApi.open({\n                      type: 'error',\n                      content: e.message,\n                    });\n                  },\n                },\n              );\n            } else {\n              onRequestClose(true);\n            }\n          },\n          onError: (e) => {\n            messageApi.open({\n              type: 'error',\n              content: e.message,\n            });\n          },\n        });\n      })\n      .catch(() => {});\n  };\n\n  return (\n    <>\n      <BAIModal\n        {...baiModalProps}\n        okText={t('webui.menu.Update')}\n        cancelText={t('webui.menu.Cancel')}\n        onCancel={() => {\n          onRequestClose();\n        }}\n        confirmLoading={userInfo.isPendingMutation}\n        onOk={() => onSubmit()}\n        centered\n        destroyOnHidden\n        title={t('webui.menu.MyAccountInformation')}\n      >\n        <Spin spinning={isRefreshModalPending} indicator={<LoadingOutlined />}>\n          <Form\n            ref={formRef}\n            layout=\"vertical\"\n            initialValues={{\n              full_name: userInfo.full_name,\n              totp_activated: user?.totp_activated || false,\n            }}\n            preserve={false}\n          >\n            <Form.Item\n              name=\"full_name\"\n              label={t('webui.menu.FullName')}\n              rules={[\n                () => ({\n                  validator(_, value) {\n                    if (value && value.length < 65) {\n                      return Promise.resolve();\n                    }\n                    return Promise.reject(\n                      new Error(t('webui.menu.FullNameInvalid')),\n                    );\n                  },\n                }),\n              ]}\n            >\n              <Input />\n            </Form.Item>\n            <Form.Item\n              name=\"originalPassword\"\n              label={t('webui.menu.OriginalPassword')}\n              rules={[\n                ({ getFieldValue }) => ({\n                  validator(_, value) {\n                    if (\n                      !value &&\n                      (getFieldValue('newPassword') ||\n                        getFieldValue('newPasswordConfirm'))\n                    ) {\n                      return Promise.reject(\n                        new Error(t('webui.menu.InputOriginalPassword')),\n                      );\n                    }\n                    return Promise.resolve();\n                  },\n                }),\n              ]}\n              dependencies={['newPassword', 'newPasswordConfirm']}\n            >\n              <Input.Password />\n            </Form.Item>\n            <Form.Item\n              name=\"newPassword\"\n              label={t('webui.menu.NewPassword')}\n              rules={[\n                {\n                  pattern:\n                    userRole === 'superadmin' ? undefined : passwordPattern,\n                  message: t('webui.menu.InvalidPasswordMessage'),\n                },\n              ]}\n            >\n              <Input.Password />\n            </Form.Item>\n            <Form.Item\n              name=\"newPasswordConfirm\"\n              label={t('webui.menu.NewPasswordAgain')}\n              dependencies={['newPassword']}\n              rules={[\n                ({ getFieldValue }) => ({\n                  validator(_, value) {\n                    if (!value || getFieldValue('newPassword') === value) {\n                      return Promise.resolve();\n                    }\n                    return Promise.reject(\n                      new Error(t('webui.menu.NewPasswordMismatch')),\n                    );\n                  },\n                }),\n              ]}\n            >\n              <Input.Password />\n            </Form.Item>\n            {!!totpSupported && (\n              <Form.Item\n                name=\"totp_activated\"\n                label={t('webui.menu.TotpActivated')}\n                valuePropName=\"checked\"\n              >\n                <Switch\n                  loading={mutationToRemoveTotp.isPending}\n                  onChange={(checked: boolean) => {\n                    if (checked) {\n                      toggleTOTPActivateModal();\n                    } else {\n                      if (user?.totp_activated) {\n                        formRef.current?.setFieldValue('totp_activated', true);\n                        modal.confirm({\n                          title: t('totp.TurnOffTotp'),\n                          icon: <ExclamationCircleFilled />,\n                          content: t('totp.ConfirmTotpRemovalBody'),\n                          okText: t('button.Yes'),\n                          okType: 'danger',\n                          cancelText: t('button.No'),\n                          onOk() {\n                            mutationToRemoveTotp.mutate(undefined, {\n                              onSuccess: () => {\n                                message.success(\n                                  t('totp.RemoveTotpSetupCompleted'),\n                                );\n                                // updateFetchKey();\n                                onRequestRefresh();\n\n                                formRef.current?.setFieldValue(\n                                  'totp_activated',\n                                  false,\n                                );\n                              },\n                              onError: (error) => {\n                                message.error(getErrorMessage(error));\n                              },\n                            });\n                          },\n                          onCancel() {\n                            formRef.current?.setFieldValue(\n                              'totp_activated',\n                              true,\n                            );\n                          },\n                        });\n                      }\n                    }\n                  }}\n                />\n              </Form.Item>\n            )}\n          </Form>\n        </Spin>\n        {!!totpSupported && (\n          <TOTPActivateModal\n            userFrgmt={user}\n            open={isOpenTOTPActivateModal}\n            onRequestClose={(success) => {\n              if (success) {\n                // updateFetchKey();\n                onRequestRefresh();\n              } else {\n                formRef.current?.setFieldValue('totp_activated', false);\n              }\n              toggleTOTPActivateModal();\n            }}\n          />\n        )}\n      </BAIModal>\n      {contextHolder}\n      {modalContextHolder}\n    </>\n  );\n};\n\nexport default UserProfileSettingModal;\n"],"names":["primaryColor","secondaryColor","WarningTwoTone","props","ref","React","AntdIcon","_extends","icon","WarningTwoToneSvg","passwordPattern","ResetPasswordRequired","value","dispatchEvent","useWebComponentInfo","parsedValue","JSON","parse","error","open","currentPassword","username","api_endpoint","token","theme","useToken","form","Form","useForm","t","useTranslation","useEffect","resetFields","anonymousBaiClient","useAnonymousBackendaiClient","mutation","useTanMutation","mutationFn","body","baiSignedRequestWithPromise","method","url","client","onSubmit","validateFields","then","values","mutate","current_password","new_password","newPassword","onSuccess","onError","_jsx","Modal","centered","mask","onCancel","keyboard","maskClosable","footer","width","destroyOnHidden","forceRender","children","_jsxs","BAIFlex","direction","justify","align","gap","style","alignSelf","paddingTop","paddingMD","paddingBottom","Typography","Title","level","margin","twoToneColor","colorWarning","layout","initialValues","disabled","isPending","Item","name","label","rules","required","pattern","message","toString","validator","_","Promise","reject","Error","resolve","hasFeedback","Input","Password","dependencies","_ref","getFieldValue","onPressEnter","Button","type","onClick","loading","onRequestClose","onRequestRefresh","isRefreshModalPending","totpSupported","queryRef","baiModalProps","formRef","useRef","messageApi","contextHolder","useMessage","modal","modalContextHolder","useModal","isOpenTOTPActivateModal","toggle","toggleTOTPActivateModal","useToggle","baiClient","useSuspendedBackendaiClient","userRole","useCurrentUserRole","userInfo","userMutations","useCurrentUserInfo","getErrorMessage","useErrorMessageResolver","user","usePreloadedQuery","UserProfileQuery","mutationToRemoveTotp","remove_totp","_Fragment","BAIModal","okText","cancelText","confirmLoading","isPendingMutation","onOk","_formRef$current","current","updateFullName","full_name","newFullName","content","newPasswordConfirm","originalPassword","updatePassword","new_password2","old_password","e","catch","title","Spin","spinning","indicator","LoadingOutlined","totp_activated","preserve","length","_ref2","undefined","_ref3","valuePropName","Switch","onChange","checked","_formRef$current2","setFieldValue","confirm","ExclamationCircleFilled","okType","_formRef$current3","success","_formRef$current4","TOTPActivateModal","userFrgmt","_formRef$current5"],"sourceRoot":""}