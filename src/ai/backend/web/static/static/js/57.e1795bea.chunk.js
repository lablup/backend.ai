"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[57],{57381:(e,n,t)=>{t.d(n,{f:()=>u});const l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"projectId"},t=[{alias:null,args:[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"project_id",variableName:"projectId"}],concreteType:"ComputeSessionConnection",kind:"LinkedField",name:"compute_session_nodes",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"count",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n],kind:"Fragment",metadata:null,name:"useValidateSessionNameQuery",selections:t,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e],kind:"Operation",name:"useValidateSessionNameQuery",selections:t},params:{cacheID:"2392cc957c8d4e1b5ff8eb0717faa135",id:null,metadata:{},name:"useValidateSessionNameQuery",operationKind:"query",text:"query useValidateSessionNameQuery(\n  $projectId: UUID!\n  $filter: String\n) {\n  compute_session_nodes(project_id: $projectId, filter: $filter) {\n    count\n  }\n}\n"}}}();l.hash="4384b91173f16b29861a6bb9cfa6cbfa";const s=l;var i=t(81109),a=t(47699),r=t.n(a),o=t(17534),d=t(62962),c=t(46336);const u=e=>{const{t:n}=(0,d.Bd)(),t=(0,c.useRelayEnvironment)(),l=(0,i.hd)();return(0,o.useMemo)((()=>[{min:4,message:n("session.validation.SessionNameTooShort")},{max:64,message:n("session.validation.SessionNameTooLong64")},{validator:(e,t)=>r().isEmpty(t)?Promise.resolve():/^\w/.test(t)?/\w$/.test(t)?/^[\w.-]*$/.test(t)?Promise.resolve():Promise.reject(n("session.validation.SessionNameInvalidCharacter")):Promise.reject(n("session.validation.SessionNameShouldEndWith")):Promise.reject(n("session.validation.SessionNameShouldStartWith"))},{validator:async(i,a)=>a!==e&&a?(0,c.fetchQuery)(t,s,{projectId:l.id,filter:'status != "TERMINATED" & status != "CANCELLED" & name == "'.concat(a,'"')}).toPromise().catch((()=>{})).then((e=>{var t,l;if((null!==(t=null===e||void 0===e||null===(l=e.compute_session_nodes)||void 0===l?void 0:l.count)&&void 0!==t?t:0)>0)return Promise.reject(n("session.launcher.SessionAlreadyExists"))})):Promise.resolve()},e?{required:!0}:{}]),[e,t,l.id,n])}},78427:(e,n,t)=>{t.d(n,{A:()=>d});var l=t(56276),s=t(11863),i=t(284),a=t(17534),r=t(89374);const o=["value"],d=e=>{let{value:n}=e,t=(0,s.A)(e,o);const d=i.A.useFormInstance();return(0,a.useEffect)((()=>{d.setFieldValue(t.name,n)}),[n,d,t.name]),(0,r.jsx)(i.A.Item,(0,l.A)((0,l.A)({},t),{},{hidden:!0,children:(0,r.jsx)("div",{})}))}},88591:(e,n,t)=>{t.d(n,{A:()=>v});var l=t(56276),s=t(11863),i=t(92957),a=t(11463),r=t(8905),o=t.n(r),d=t(47699),c=t.n(d),u=t(17534),m=t(89374);const h=["value","onChange","localFormat"],p=u.forwardRef(((e,n)=>{let{value:t,onChange:r,localFormat:d}=e,u=(0,s.A)(e,h);const[,p]=(0,i.A)({value:t,onChange:r});return(0,m.jsx)(a.A,(0,l.A)({ref:n,value:t?o()(t):void 0,onChange:e=>{var n,t,l;c().isArray(e)&&(e=e[0]);const s=d?null===(n=e)||void 0===n?void 0:n.format():null===(t=e)||void 0===t||null===(l=t.tz())||void 0===l?void 0:l.toISOString();p(s)}},u))}));p.displayName="DatePickerISO";const v=p},90057:(e,n,t)=>{t.r(n),t.d(n,{ResourceNumbersOfSession:()=>Be,default:()=>Me});var l=t(56276),s=t(23590),i=t(88591),a=t(52038),r=t(62266),o=t(23395),d=t(47990),c=t(89648),u=t(11863),m=t(10979),h=t(51067),p=t(17534),v=t(62962),g=t(89374);const x=["open","onClose"],j=e=>{let{open:n,onClose:t}=e,s=(0,u.A)(e,x);const{t:i}=(0,v.Bd)(),[a,r]=(0,m.q)("has_opened_tour_neo_session_validation"),o=[{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.FixErrorFieldByModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,g.jsx)(h.A,(0,l.A)({steps:o,onClose:e=>{null===t||void 0===t||t(e),r(!0)},open:!a&&n},s))};var y=t(284),A=t(74031),b=t(47699),F=t.n(b);const f=e=>{let{form:n}=e;const t=y.A.useWatch("mounts",n),l=A.A.useApp(),{t:s}=(0,v.Bd)(),i=(0,p.useMemo)((()=>F().isArray(t)&&t.length>0),[t]);return(0,p.useEffect)((()=>{i&&(l.message.warning(s("session.launcher.InvalidMountsSelectionWarning"),5),n.setFieldValue("mounts",void 0))}),[i,s,l.message,n]),null};var w=t(48880),S=t(40690),k=t(81109),V=t(90679),O=t(2289),E=t(93304);const T=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],t={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},s],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[t],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,i],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[t,s],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[l,i,s],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();T.hash="ba086835ea654ab889e0e6aaefa0abfe";const I=T;var N=t(72828),C=t(62378),_=t(78427),D=t(20353),P=t(53825),B=t(61471),M=t(87621),z=t(15121),R=t(86671),L=t(30369),q=t(67692),K=t(64754),U=t(67631),G=t(48720),W=t(46336);const H=e=>{const{t:n}=(0,v.Bd)(),t=y.A.useFormInstance(),s=y.A.useWatch(["owner","enabled"],t),i=(0,N.Am)();return("admin"===i||"superadmin"===i)&&s&&(0,g.jsx)(U.Zu,(0,l.A)((0,l.A)({title:n("session.launcher.SetSessionOwner"),showDivider:!0,size:"small",status:t.getFieldError(["owner","email"]).length>0||t.getFieldError(["owner","accesskey"]).length>0||t.getFieldError(["owner","project"]).length>0||t.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit")},e),{},{children:(0,g.jsxs)(K.A,{size:"small",column:1,children:[(0,g.jsx)(K.A.Item,{label:n("session.launcher.OwnerEmail"),children:t.getFieldValue(["owner","email"])}),(0,g.jsx)(K.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:t.getFieldValue(["owner","accesskey"])}),(0,g.jsx)(K.A.Item,{label:n("session.launcher.OwnerGroup"),children:t.getFieldValue(["owner","project"])}),(0,g.jsx)(K.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:t.getFieldValue(["owner","resourceGroup"])})]})}))},Q=e=>{const{t:n}=(0,v.Bd)(),{token:t}=D.A.useToken(),s=y.A.useFormInstance(),i=y.A.useWatch(["owner","enabled"],s),[a,r]=(0,p.useState)(),o=(0,W.useRelayEnvironment)(),{data:d,isFetching:c}=(0,C.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",a],queryFn:()=>{const e=s.getFieldValue(["owner","email"]);if(!e)return;const n=I;return(0,W.fetchQuery)(o,n,{email:e}).toPromise()},enabled:!!a}),u=s.getFieldValue(["owner","email"])?null===d||void 0===d?void 0:d.keypairs:void 0,m=s.getFieldValue(["owner","email"])?null===d||void 0===d?void 0:d.user:void 0,h=!c&&a&&!m;return(0,g.jsxs)(P.A,(0,l.A)((0,l.A)({title:n("session.launcher.SetSessionOwner"),extra:(0,g.jsx)(y.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,g.jsx)(B.A,{})}),styles:i?void 0:{header:{borderBottom:"none"},body:{display:i?"block":"none"}}},e),{},{children:[(0,g.jsx)(_.A,{name:["owner","domainName"],value:null===m||void 0===m?void 0:m.domain_name}),(0,g.jsx)(y.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:l}=e;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(U.OO,{children:(0,g.jsx)(y.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:i},{type:"email",message:n("general.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:h?"error":void 0,help:h?n("credential.NoUserToDisplay"):void 0,children:(0,g.jsx)(M.A.Search,{onSearch:e=>{s.validateFields([["owner","email"]]).then((()=>{r(e)})).catch((()=>{}))},onChange:()=>{r(""),s.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:c,enterButton:!c&&m?(0,g.jsx)(z.Ay,{icon:(0,g.jsx)(G.A,{})}):void 0})})}),(0,g.jsx)(y.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:l(["owner","enabled"])}],children:(0,g.jsx)(U.xr,{options:F().map(u,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:F().isEmpty(a)||c})}),(0,g.jsxs)(R.A,{gutter:t.marginSM,children:[(0,g.jsx)(L.A,{span:12,children:(0,g.jsx)(y.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:l(["owner","enabled"])}],children:(0,g.jsx)(U.xr,{options:F().map(null===m||void 0===m?void 0:m.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:F().isEmpty(a)||c})})}),(0,g.jsx)(L.A,{span:12,children:(0,g.jsx)(y.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:t}=e;return(0,g.jsx)(p.Suspense,{fallback:(0,g.jsx)(y.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:t(["owner","enabled"])}],children:(0,g.jsx)(q.A,{loading:!0})}),children:(0,g.jsx)(y.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:t(["owner","enabled"])}],children:t(["owner","project"])?(0,g.jsx)(U.ZP,{projectName:t(["owner","project"]),disabled:F().isEmpty(a)||c,autoSelectDefault:!0}):(0,g.jsx)(q.A,{disabled:!0})})})}})})]})]})}})]}))};var J=t(68e3),$=t(7957),Z=t(45347),X=t(30621),Y=t(1125),ee=t(56686),ne=t(8905),te=t.n(ne);const le=e=>{var n,t,l,s,i,a,r,o,c,u,m,h,p,x,j,b,f,T,I,N,C,_,B,M,q,G,W,Q,ne,le,se,ie,ae,re,oe,de;let{onClickEditStep:ce}=e;const ue=A.A.useApp(),{t:me}=(0,v.Bd)(),he=y.A.useFormInstance(),{token:pe}=D.A.useToken(),ve=(0,S.CX)(),ge=y.A.useWatch("sessionType",{form:he,preserve:!0}),xe=null!==(n=null===ve||void 0===ve?void 0:ve.supports("batch-timeout"))&&void 0!==n&&n,je=null!==(t=null===ve||void 0===ve?void 0:ve.supports("extended-image-info"))&&void 0!==t&&t,ye=(0,k.hd)(),[,{getBaseVersion:Ae,getBaseImage:be,tagAlias:Fe}]=(0,S.Gj)();return(0,g.jsxs)(g.Fragment,{children:[he.getFieldValue("bootstrap_script")&&(0,g.jsx)(U.Rf,{description:me("session.launcher.UsingBootstrapScriptInfo"),ghostInfoBg:!1,action:(0,g.jsx)(z.Ay,{size:"small",type:"text",onClick:()=>{ue.modal.info({title:me("session.launcher.BootstrapScriptDetail"),content:(0,g.jsxs)(U.OO,{direction:"column",align:"start",children:[(0,g.jsx)($.A.Paragraph,{children:me("userSettings.BootstrapScriptDescription")}),(0,g.jsx)(J.A,{wordWrap:!0,language:"shell",children:he.getFieldValue("bootstrap_script")})]}),width:800})},children:me("notification.SeeDetail")}),type:"info",showIcon:!0}),(0,g.jsx)(U.Zu,{title:me("session.launcher.SessionType"),showDivider:!0,size:"small",status:he.getFieldError("sessionName").length>0||he.getFieldError(["batch","command"]).length>0||he.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:me("button.Edit"),onClickExtraButton:()=>{ce("sessionType")},children:(0,g.jsxs)(K.A,{size:"small",column:1,children:[(0,g.jsx)(K.A.Item,{label:me("session.SessionType"),children:he.getFieldValue("sessionType")}),!F().isEmpty(he.getFieldValue("sessionName"))&&(0,g.jsx)(K.A.Item,{label:me("session.launcher.SessionName"),children:he.getFieldValue("sessionName")}),"batch"===ge&&(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)(K.A.Item,{label:me("session.launcher.StartUpCommand"),styles:{label:{whiteSpace:"nowrap"},content:{overflow:"auto"}},children:he.getFieldValue(["batch","command"])?(0,g.jsx)(J.A,{language:"shell",children:he.getFieldValue(["batch","command"])}):(0,g.jsx)($.A.Text,{type:"secondary",children:me("general.None")})}),(0,g.jsx)(K.A.Item,{label:me("session.launcher.SessionStartTime"),children:he.getFieldValue(["batch","scheduleDate"])?te()(he.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,g.jsx)($.A.Text,{type:"secondary",children:me("general.None")})}),xe?(0,g.jsx)(K.A.Item,{label:me("session.launcher.BatchJobTimeoutDuration"),children:he.getFieldValue(["batch","timeout"])?(0,g.jsxs)($.A.Text,{children:[he.getFieldValue(["batch","timeout"]),he.getFieldValue(["batch","timeoutUnit"])||"s"]}):(0,g.jsx)($.A.Text,{type:"secondary",children:me("general.None")})}):null]})]})}),(0,g.jsx)(H,{onClickExtraButton:()=>{ce("sessionType")}}),(0,g.jsx)(U.Zu,{title:me("session.launcher.Environments"),showDivider:!0,size:"small",status:F().some(he.getFieldValue("envvars"),((e,n)=>he.getFieldError(["envvars",n,"variable"]).length>0||he.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:me("button.Edit"),onClickExtraButton:()=>{ce("environment")},children:(0,g.jsxs)(K.A,{size:"small",column:1,children:[(0,g.jsx)(K.A.Item,{label:me("session.launcher.Project"),children:ye.name}),(0,g.jsx)(K.A.Item,{label:me("general.Image"),children:je?(0,g.jsxs)(R.A,{style:{flexFlow:"nowrap"},children:[(0,g.jsx)(L.A,{children:(0,g.jsx)(O.A,{image:(null===(l=he.getFieldValue("environments"))||void 0===l?void 0:l.version)||(null===(s=he.getFieldValue("environments"))||void 0===s?void 0:s.manual),style:{marginRight:pe.marginXS}})}),(0,g.jsx)(L.A,{children:(0,g.jsx)(U.OO,{direction:"row",wrap:"wrap",children:null!==(i=he.getFieldValue("environments"))&&void 0!==i&&i.manual?(0,g.jsx)($.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(a=he.getFieldValue("environments"))||void 0===a?void 0:a.manual},children:null===(r=he.getFieldValue("environments"))||void 0===r?void 0:r.manual}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)($.A.Text,{children:Fe(null===(o=he.getFieldValue("environments"))||void 0===o||null===(c=o.image)||void 0===c?void 0:c.base_image_name)}),(0,g.jsx)(Z.A,{type:"vertical"}),(0,g.jsx)($.A.Text,{children:null===(u=he.getFieldValue("environments"))||void 0===u||null===(m=u.image)||void 0===m?void 0:m.version}),(0,g.jsx)(Z.A,{type:"vertical"}),(0,g.jsx)($.A.Text,{children:null===(h=he.getFieldValue("environments"))||void 0===h||null===(p=h.image)||void 0===p?void 0:p.architecture}),(0,g.jsx)(Z.A,{type:"vertical"}),F().map(null===(x=he.getFieldValue("environments"))||void 0===x||null===(j=x.image)||void 0===j?void 0:j.tags,(e=>{var n,t,l;const s=F().includes(e.key,"customized_"),i=s?null===(n=F().find(null===(t=he.getFieldValue("environments"))||void 0===t||null===(l=t.image)||void 0===l?void 0:l.labels,{key:"ai.backend.customized-image.name"}))||void 0===n?void 0:n.value:e.value,a=Fe(e.key+i);return F().isEqual(a,(0,w.WY)(e.key+i))||s?(0,g.jsx)(V.A,{values:[{label:Fe(e.key),color:s?"cyan":"blue"},{label:i,color:s?"cyan":"blue"}]},e.key):(0,g.jsx)(X.A,{color:s?"cyan":"blue",children:a},e.key)})),(0,g.jsx)($.A.Text,{style:{color:pe.colorPrimary},copyable:{text:(0,w.A_)(null===(b=he.getFieldValue("environments"))||void 0===b?void 0:b.image)||(null===(f=he.getFieldValue("environments"))||void 0===f?void 0:f.version)}})]})})})]}):(0,g.jsxs)(R.A,{style:{flexFlow:"nowrap",gap:pe.sizeXS},children:[(0,g.jsx)(L.A,{children:(0,g.jsx)(O.A,{image:(null===(T=he.getFieldValue("environments"))||void 0===T?void 0:T.version)||(null===(I=he.getFieldValue("environments"))||void 0===I?void 0:I.manual)})}),(0,g.jsx)(L.A,{children:(0,g.jsx)(U.OO,{direction:"row",wrap:"wrap",children:null!==(N=he.getFieldValue("environments"))&&void 0!==N&&N.manual?(0,g.jsx)($.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(C=he.getFieldValue("environments"))||void 0===C?void 0:C.manual},children:null===(_=he.getFieldValue("environments"))||void 0===_?void 0:_.manual}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)($.A.Text,{children:Fe(be(null===(B=he.getFieldValue("environments"))||void 0===B?void 0:B.version))}),(0,g.jsx)(Z.A,{type:"vertical"}),(0,g.jsx)($.A.Text,{children:Ae(null===(M=he.getFieldValue("environments"))||void 0===M?void 0:M.version)}),(0,g.jsx)(Z.A,{type:"vertical"}),(0,g.jsx)($.A.Text,{children:null===(q=he.getFieldValue("environments"))||void 0===q||null===(G=q.image)||void 0===G?void 0:G.architecture}),(0,g.jsx)(Z.A,{type:"vertical"}),(0,g.jsx)(E.J,{tag:he.getFieldValue(["environments","image","tag"]),labels:null===(W=he.getFieldValue("environments"))||void 0===W||null===(Q=W.image)||void 0===Q?void 0:Q.labels}),(0,g.jsx)($.A.Text,{style:{color:pe.colorPrimary},copyable:{text:(0,w.A_)(null===(ne=he.getFieldValue("environments"))||void 0===ne?void 0:ne.image)||(null===(le=he.getFieldValue("environments"))||void 0===le?void 0:le.version)}})]})})})]})}),(null===(se=he.getFieldValue("envvars"))||void 0===se?void 0:se.length)>0&&(0,g.jsx)(K.A.Item,{label:me("session.launcher.EnvironmentVariable"),children:null!==(ie=he.getFieldValue("envvars"))&&void 0!==ie&&ie.length?(0,g.jsx)(U.OO,{align:"stretch",direction:"column",children:(0,g.jsx)(J.A,{wordWrap:!0,language:"shell",children:F().map(he.getFieldValue("envvars"),(e=>"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"'))).join("\n")})}):(0,g.jsx)($.A.Text,{type:"secondary",children:"-"})})]})}),(0,g.jsx)(U.Zu,{title:me("session.launcher.ResourceAllocation"),showDivider:!0,status:F().some(he.getFieldValue("resource"),((e,n)=>he.getFieldError(["resource",n]).length>0))||he.getFieldError(["num_of_sessions"]).length>0||he.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:me("button.Edit"),onClickExtraButton:()=>{ce("environment")},children:(0,g.jsxs)(U.OO,{direction:"column",align:"stretch",children:[F().some(he.getFieldValue("resource"),((e,n)=>he.getFieldWarning(["resource",n]).length>0))&&(0,g.jsx)(Y.A,{type:"warning",showIcon:!0,title:me("session.launcher.EnqueueComputeSessionWarning")}),(0,g.jsxs)(K.A,{column:2,children:[(0,g.jsx)(K.A.Item,{label:me("general.ResourceGroup"),span:2,children:he.getFieldValue("resourceGroup")||(0,g.jsx)($.A.Text,{type:"secondary",children:me("general.None")})}),(0,g.jsx)(K.A.Item,{label:me("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,g.jsxs)(U.OO,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===he.getFieldValue("allocationPreset")?"":(0,g.jsx)(X.A,{children:he.getFieldValue("allocationPreset")}),(0,g.jsx)(Be,{resource:he.getFieldValue("resource")})]})}),ve.supports("agent-select")&&!(null!==ve&&void 0!==ve&&null!==(ae=ve._config)&&void 0!==ae&&ae.hideAgents)&&(0,g.jsx)(K.A.Item,{label:me("session.launcher.AgentNode"),children:F().castArray(he.getFieldValue("agent")).join(", ")||me("session.launcher.AutoSelect")}),(0,g.jsx)(K.A.Item,{label:me("session.launcher.NumberOfContainer"),children:1===he.getFieldValue("cluster_size")?he.getFieldValue("num_of_sessions"):he.getFieldValue("cluster_size")}),(0,g.jsx)(K.A.Item,{label:me("session.launcher.ClusterMode"),children:"single-node"===he.getFieldValue("cluster_mode")?me("session.launcher.SingleNode"):me("session.launcher.MultiNode")})]}),(0,g.jsx)(P.A,{size:"small",type:"inner",title:me("session.launcher.TotalAllocation"),children:(0,g.jsx)(U.OO,{direction:"row",gap:"xxs",children:(0,g.jsx)(Be,{resource:he.getFieldValue("resource"),containerCount:1===he.getFieldValue("cluster_size")?he.getFieldValue("num_of_sessions"):he.getFieldValue("cluster_size")})})})]})}),(0,g.jsx)(U.Zu,{title:me("webui.menu.Data&Storage"),showDivider:!0,size:"small",status:he.getFieldError("mount_id_map").length>0?"error":void 0,extraButtonTitle:me("button.Edit"),onClickExtraButton:()=>{ce("storage")},children:(0,g.jsxs)(U.OO,{direction:"column",align:"stretch",gap:"xs",children:[(null===(re=he.getFieldValue("mount_ids"))||void 0===re?void 0:re.length)>0?(0,g.jsx)(ee.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:me("data.folders.Name")},{dataIndex:"alias",title:me("session.launcher.FolderAlias"),render:(e,n)=>F().isEmpty(e)?(0,g.jsx)($.A.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(n.name)}):e}],dataSource:F().map(he.getFieldValue("mount_ids"),(e=>{var n,t;return{name:(null===(n=he.getFieldValue("vfoldersNameMap"))||void 0===n?void 0:n[e])||e,alias:null===(t=he.getFieldValue("mount_id_map"))||void 0===t?void 0:t[e]}}))}):(0,g.jsx)(Y.A,{type:"warning",showIcon:!0,title:me("session.launcher.NoFolderMounted")}),(null===(oe=he.getFieldValue("autoMountedFolderNames"))||void 0===oe?void 0:oe.length)>0?(0,g.jsx)(K.A,{size:"small",children:(0,g.jsx)(K.A.Item,{label:me("data.AutomountFolders"),children:F().map(he.getFieldValue("autoMountedFolderNames"),(e=>(0,g.jsx)(X.A,{children:e})))})}):null]})}),(0,g.jsx)(U.Zu,{title:"Network",showDivider:!0,size:"small",status:he.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:me("button.Edit"),onClickExtraButton:()=>{ce("network")},children:(0,g.jsx)(K.A,{size:"small",children:(0,g.jsx)(K.A.Item,{label:me("session.launcher.PreOpenPortTitle"),children:(0,g.jsxs)(U.OO,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[F().sortBy(he.getFieldValue("ports"),(e=>parseInt(e))).map(((e,n)=>(0,g.jsx)(d.uD,{value:e,style:{margin:0},children:e},n+e))),F().isArray(he.getFieldValue("ports"))&&0!==(null===(de=he.getFieldValue("ports"))||void 0===de?void 0:de.length)?null:(0,g.jsx)($.A.Text,{type:"secondary",children:me("general.None")})]})})})})]})};var se=t(59991),ie=t(57381);const ae=e=>{let n=Object.assign({},((0,se.A)(e),e));const{t:t}=(0,v.Bd)(),s=(0,ie.f)();return(0,g.jsx)(y.A.Item,(0,l.A)((0,l.A)({label:t("session.launcher.SessionName"),name:"sessionName",validateDebounce:200,rules:s},n),{},{children:(0,g.jsx)(M.A,{allowClear:!0,autoComplete:"off",count:{max:64,show:!0}})}))};var re=t(7871);const oe=()=>{const[e,n]=(0,m.q)("recentSessionHistory"),t=(0,U.lt)((t=>{let{id:l,params:s,createdAt:i,name:a}=t;const r={id:null!==l&&void 0!==l?l:(0,U.kX)(8),params:s,createdAt:null!==i&&void 0!==i?i:(new Date).toISOString(),name:a},o=F().sortBy([r,...e||[]],"-createdAt").slice(0,5);n(o)})),s=(0,U.lt)((()=>n([]))),i=(0,U.lt)((t=>{const l=(e||[]).filter((e=>e.id!==t));n(l)})),a=(0,U.lt)(((t,s)=>{const i=(e||[]).map((e=>e.id===t?(0,l.A)((0,l.A)({},e),{},{name:s}):e));n(i)}));return[e,{push:t,clear:s,remove:i,update:a}]};var de,ce=t(64018),ue=t(87844),me=t(70974),he=t(27111);const pe=(0,me.rU)((e=>{let{css:n}=e;return{fixEditableVerticalAlign:n(de||(de=(0,re.A)(["\n    & {\n      margin-top: 0px !important;\n    }\n  "])))}})),ve=e=>{let n=Object.assign({},((0,se.A)(e),e));const{t:t}=(0,v.Bd)(),{styles:s}=pe(),[i,{update:a}]=oe(),[r,o]=(0,p.useState)(null),[,{getImageAliasName:d,getBaseVersion:c}]=(0,S.Gj)(),[u,{pin:h,unpin:x,update:j}]=(()=>{const[e,n]=(0,m.q)("pinnedSessionHistory"),[t]=(0,m.q)("recentSessionHistory"),s=(0,U.lt)((l=>{const s=(t||[]).find((e=>e.id===l));s&&n([...e||[],s])})),i=(0,U.lt)((t=>{const l=(e||[]).filter((e=>e.id!==t));n(l)})),a=(0,U.lt)(((t,s)=>{const i=(e||[]).map((e=>e.id===t?(0,l.A)((0,l.A)({},e),{},{name:s}):e));n(i)}));return[e,{pin:s,unpin:i,update:a}]})(),[,y]=(0,p.useState)(),{token:A}=D.A.useToken(),b=(0,p.useMemo)((()=>{const e=(e,n)=>{const t=new URLSearchParams(e.params),s=JSON.parse(t.get("formValues")||"{}");return(0,l.A)((0,l.A)({},s),{},{pinned:n,name:e.name})},n=F().map(i,(n=>(0,l.A)((0,l.A)({},n),e(n,!1)))),t=F().map(u,(n=>(0,l.A)((0,l.A)({},n),e(n,!0))));return F().chain([...t,...n]).unionBy("id").value()}),[i,u]);return(0,g.jsx)(U.Ib,(0,l.A)((0,l.A)({width:800,title:t("session.launcher.RecentHistory"),footer:null,onCancel:()=>{y(void 0),n.onRequestClose()}},n),{},{children:(0,g.jsxs)(U.OO,{direction:"column",align:"stretch",gap:"sm",children:[(0,g.jsx)($.A.Text,{children:t("session.launcher.YouCanStartWithHistory")}),(0,g.jsx)(U.zx,{rowSelection:{selectedRowKeys:null===u||void 0===u?void 0:u.map((e=>e.id)),columnWidth:0,hideSelectAll:!0,renderCell:()=>null},scroll:{x:"max-content"},dataSource:b,pagination:!1,onRow:e=>({onMouseEnter:()=>o(e.id),onMouseLeave:()=>o(null)}),rowKey:e=>e.id,columns:[{title:(0,g.jsxs)(U.OO,{gap:"xxs",children:[(0,g.jsx)(he.A,{}),(0,g.jsx)(ce.A,{title:t("session.launcher.PinnedHistoryTooltip")})]}),dataIndex:"pinned",width:40,render:(e,n)=>{const t=!!n.pinned,l=r===n.id;return t?(0,g.jsx)(z.Ay,{size:"small",onClick:()=>{x(n.id)},type:"link",children:(0,g.jsx)(he.A,{})}):(0,g.jsx)(z.Ay,{size:"small",onClick:()=>h(n.id),type:"link",children:(0,g.jsx)(he.A,{style:{color:l?A.colorTextQuaternary:"transparent"}})})}},{title:t("session.launcher.SessionNameShort"),dataIndex:"name",render:(e,t)=>{const l=e||t.id.split("-")[0];return(0,g.jsx)($.A.Text,{className:s.fixEditableVerticalAlign,editable:{onChange(e){F().isEmpty(e)||(a(t.id,e),t.pinned&&j(t.id,e))},text:l},children:(0,g.jsx)(U.rm,{type:"hover",onClick:()=>{var e;null===(e=n.onRequestClose)||void 0===e||e.call(n,JSON.parse(new URLSearchParams(t.params||"").get("formValues")||"{}"))},children:l})})}},{title:t("session.launcher.Environments"),dataIndex:["environments","version"],render:(e,n)=>{const t=n.environments.version||n.environments.manual;return t&&(0,g.jsx)(ue.A,{title:t,placement:"right",children:(0,g.jsxs)(U.OO,{gap:"xxs",children:[(0,g.jsx)(O.A,{image:t}),(0,g.jsxs)($.A.Text,{children:[d(t)," ",c(t)]})]})})},onCell:()=>({style:{maxWidth:250,textOverflow:"ellipsis"}})},{title:t("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,g.jsx)(U.OO,{gap:"xs",children:(0,g.jsx)(Be,{resource:e})})},{title:t("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>te()(e).fromNow()}]})]})}))};var ge=t(18676);var xe=t(77071),je=t(80275),ye=t(22964),Ae=t(17786),be=t(47079),Fe=t(28707),fe=t(84423),we=t(70024),Se=t(90425),ke=t(81187),Ve=t(9359),Oe=t(51457),Ee=t(83499),Te=t(20908),Ie=t(12736),Ne=t(51440),Ce=t(7109),_e=t(40720),De=t(68134),Pe=t(73233);const Be=e=>{let{resource:n,containerCount:t=1}=e;return(0,g.jsxs)(g.Fragment,{children:[F().map(F().omit(n,"shmem","accelerator","acceleratorType"),((e,l)=>{var s,i;return"0"===e?null:(0,g.jsx)(U.jO,{type:l,value:"mem"===l?((null===(s=(0,w.mv)(e.toString(),""))||void 0===s?void 0:s.number)||0)*t+"":F().toNumber(e)*t+"",opts:{shmem:n.shmem?((null===(i=(0,w.mv)(n.shmem,""))||void 0===i?void 0:i.number)||0)*t:void 0}},l)})),n&&n.accelerator&&n.acceleratorType&&F().isNumber(n.accelerator)?(0,g.jsx)(U.jO,{type:n.acceleratorType,value:F().toString(n.accelerator*t)}):null]})},Me=()=>{var e,n;const t=A.A.useApp(),{logger:u}=(0,U.Q7)(),{getErrorMessage:m}=(0,U.B7)(),h=(0,Ne.md)(o.i7),x=(0,S.CX)(),b=x.supports("mount-by-id"),V=null!==(e=null===x||void 0===x?void 0:x.supports("batch-timeout"))&&void 0!==e&&e,O=(0,N.Am)(),[,E]=(0,k.zL)(),{startSession:T,defaultFormValues:I,upsertSessionNotification:C}=(0,De.G)(),_=(0,Pe.withDefault)(Pe.NumberParam,0),K=(0,Pe.withDefault)(Pe.JsonParam,I),G=(0,Pe.withDefault)(Pe.JsonParam,{}),[{step:W,formValues:H,redirectTo:J},Z]=(0,Pe.useQueryParams)({step:_,formValues:K,redirectTo:Pe.StringParam,appOption:G}),{search:X}=(0,_e.zy)(),Y=(0,S.f0)(),[ee,{toggle:ne}]=(0,fe.A)(),[,{push:se}]=oe(),{run:ie}=(0,we.A)((()=>{const e=he.getFieldsValue();Z({formValues:F().assign(F().omit(he.getFieldsValue(),["environments.image","environments.customizedTag","autoMountedFolderNames","owner","envvars"]),{envvars:(0,a.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),re=e=>{Z({step:e},"pushIn")},{token:de}=D.A.useToken(),{t:ce}=(0,v.Bd)(),me=Se.Ay.useBreakpoint(),[he]=y.A.useForm();(0,p.useEffect)((()=>{F().isEmpty(H)||he.validateFields().catch((()=>{}))}),[]);const pe=(0,p.useEffectEvent)((()=>F().isEmpty(H)?null:setTimeout((()=>{he.validateFields().catch((()=>{}))}),500)));(0,p.useEffect)((()=>{const e=pe();return()=>{e&&clearTimeout(e)}}),[]);const Be=(0,p.useMemo)((()=>F().merge({},I,c.jh,H)),[I,H]);(0,p.useEffect)((()=>{var e;null===(e=h.current)||void 0===e||e.scrollTo(0,0)}),[W]);const Me=y.A.useWatch("sessionType",{form:he,preserve:!0})||he.getFieldValue("sessionType")||H.sessionType,ze=(0,U.YM)([{title:ce("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(ce("session.launcher.Environments")," & ").concat(ce("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==Me&&{title:ce("webui.menu.Data&Storage"),key:"storage"},{title:ce("session.launcher.Network"),key:"network"},{title:ce("session.launcher.ConfirmAndLaunch"),icon:(0,g.jsx)(xe.A,{}),key:"review"}]),Re=null===(n=ze[W])||void 0===n?void 0:n.key,Le=F().some(he.getFieldsError(),(e=>e.errors.length>0)),[qe,Ke]=(0,U.Tw)("first");(0,p.useEffect)((()=>{W===ze.length-1&&he.validateFields().catch((()=>{})).finally((()=>Ke()))}),[W,he,Ke,ze.length]),(0,p.useEffect)((()=>{"first"!==qe&&Ge(!!Le)}),[qe,Le]);const[Ue,Ge]=(0,p.useState)(!1),[We,He]=(0,p.useState)(!1);return(0,p.useLayoutEffect)((()=>{We&&(he.resetFields(),He(!1))}),[We,he]),(0,g.jsxs)(U.OO,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,g.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,g.jsxs)(U.OO,{direction:"row",gap:"md",align:"start",children:[(0,g.jsxs)(U.OO,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,g.jsxs)(U.OO,{direction:"row",justify:"between",children:[(0,g.jsx)($.A.Title,{level:4,style:{marginTop:0},children:ce("session.launcher.StartNewSession")}),(0,g.jsx)(U.OO,{direction:"row",gap:"sm",children:(0,g.jsx)(z.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>ne(),children:ce("session.launcher.RecentHistory")})})]}),(0,g.jsx)(y.A.Provider,{onFormChange:()=>{ie()},children:(0,g.jsxs)(y.A,{form:he,layout:"vertical",initialValues:Be,children:[(0,g.jsx)(f,{form:he}),(0,g.jsxs)(U.OO,{direction:"column",align:"stretch",gap:"md",children:[(0,g.jsxs)(P.A,{title:ce("session.launcher.SessionType"),style:{display:"sessionType"===Re?"block":"none"},children:[(0,g.jsx)(y.A.Item,{name:"sessionType",children:(0,g.jsx)(ke.Ay.Group,{options:[{label:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)($.A.Text,{code:!0,children:ce("session.launcher.InteractiveMode")})," ",(0,g.jsx)($.A.Text,{type:"secondary",children:ce("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)($.A.Text,{code:!0,children:ce("session.launcher.BatchMode")})," ",(0,g.jsx)($.A.Text,{type:"secondary",children:ce("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,g.jsx)(ae,{}),(0,g.jsx)(y.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,g.jsx)(M.A,{})})]}),"batch"===Me&&(0,g.jsxs)(P.A,{title:ce("session.launcher.BatchModeConfig"),style:{display:"sessionType"===Re?"block":"none"},children:[(0,g.jsx)(y.A.Item,{label:ce("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,g.jsx)(M.A.TextArea,{autoSize:!0})}),(0,g.jsx)(y.A.Item,{noStyle:!0,dependencies:[["batch","scheduleDate"]],children:()=>{const e=he.getFieldValue(["batch","scheduleDate"]);return(0,g.jsx)(s.A,{delay:1e3,callback:()=>{const e=he.getFieldValue(["batch","scheduleDate"]);return e?te()(e).isBefore(te()())?void(0===he.getFieldError(["batch","scheduleDate"]).length&&he.validateFields([["batch","scheduleDate"]])):te()(e).fromNow():void 0},triggerKey:e||"none",render:e=>(0,g.jsx)(y.A.Item,{label:ce("session.launcher.SessionStartTime"),extra:e,children:(0,g.jsxs)(U.OO,{direction:"row",gap:"xs",children:[(0,g.jsx)(y.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,g.jsx)(Ve.A,{onChange:e=>{e.target.checked&&F().isEmpty(he.getFieldValue(["batch","scheduleDate"]))?he.setFieldValue(["batch","scheduleDate"],te()().add(2,"minutes").toISOString()):!1===e.target.checked&&he.setFieldValue(["batch","scheduleDate"],void 0),he.validateFields([["batch","scheduleDate"]])},children:ce("session.launcher.Enable")})}),(0,g.jsx)(y.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var t,l;return(null===(t=e.batch)||void 0===t?void 0:t.enabled)!==(null===(l=n.batch)||void 0===l?void 0:l.enabled)},children:()=>{var e;const n=!0!==(null===(e=he.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,g.jsx)(g.Fragment,{children:(0,g.jsx)(y.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&te()(n).isBefore(te()())?Promise.reject(ce("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,g.jsx)(i.A,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(te()().startOf("day"))})})})}})]})})})}}),V?(0,g.jsx)(y.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"],["batch","timeoutUnit"]],children:()=>{const e=he.getFieldValue(["batch","timeout"]),n=he.getFieldValue(["batch","timeoutUnit"]),t=te().duration(e,null!==n&&void 0!==n?n:"s"),l=(0,w.a3)(t,ce),s=!F().isNull(e)&&F().toFinite(e)>0?l:null;return(0,g.jsx)(y.A.Item,{label:ce("session.launcher.BatchJobTimeoutDuration"),tooltip:ce("session.launcher.BatchJobTimeoutDurationDesc"),help:s,children:(0,g.jsxs)(U.OO,{direction:"row",gap:"xs",children:[(0,g.jsx)(y.A.Item,{noStyle:!0,name:["batch","timeoutEnabled"],valuePropName:"checked",children:(0,g.jsx)(Ve.A,{onChange:e=>{!1===e.target.checked&&he.setFieldValue(["batch","timeout"],void 0),he.validateFields([["batch","timeout"]])},children:ce("session.launcher.Enable")})}),(0,g.jsx)(y.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"]],children:()=>{const e=!0!==he.getFieldValue(["batch","timeoutEnabled"]);return(0,g.jsx)(g.Fragment,{children:(0,g.jsxs)(Oe.A.Compact,{children:[(0,g.jsx)(y.A.Item,{name:["batch","timeout"],label:ce("session.launcher.BatchJobTimeoutDuration"),noStyle:!0,dependencies:[["batch","timeoutEnabled"]],rules:[{min:0,type:"number",message:ce("error.AllowsPositiveNumberOnly")},{required:!e}],children:(0,g.jsx)(Ee.A,{disabled:e,min:1,style:{width:"100%"},onChange:()=>{he.validateFields([["batch","timeoutUnit"]])}})}),(0,g.jsx)(y.A.Item,{noStyle:!0,name:["batch","timeoutUnit"],dependencies:[["batch","timeout"],["batch","timeoutEnabled"]],rules:[e=>{let{getFieldValue:n}=e;return{validator(){const e=n(["batch","timeout"]);return!0===n(["batch","timeoutEnabled"])&&(void 0===e||null===e||e<1)?Promise.reject():Promise.resolve()}}}],children:(0,g.jsx)(q.A,{tabIndex:-1,disabled:e,style:{width:100},options:[{label:ce("time.Sec"),value:"s"},{label:ce("time.Min"),value:"m"},{label:ce("time.Hour"),value:"h"},{label:ce("time.Day"),value:"d"},{label:ce("time.Week"),value:"w"}]})})]})})}})]})})}}):null]}),("admin"===O||"superadmin"===O)&&(0,g.jsx)(Q,{style:{display:"sessionType"===Re?"block":"none"}}),"inference"===Me&&(0,g.jsx)(P.A,{title:"Inference Mode Configuration",children:(0,g.jsx)(y.A.Item,{name:["inference","vFolderName"],label:ce("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,g.jsx)(q.A,{})})}),(0,g.jsxs)(P.A,{title:ce("session.launcher.Environments"),style:{display:"environment"===Re?"block":"none"},children:[(0,g.jsx)(Ce.tH,{fallbackRender:()=>null,children:(0,g.jsx)(r.A,{})}),(0,g.jsx)(y.A.Item,{label:ce("session.launcher.EnvironmentVariable"),children:(0,g.jsx)(a.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,g.jsx)(P.A,{title:ce("session.launcher.ResourceAllocation"),style:{display:"environment"===Re?"block":"none"},children:(0,g.jsx)(c.Ay,{enableAgentSelect:!x._config.hideAgents&&x.supports("agent-select"),enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,g.jsxs)(P.A,{title:ce("session.launcher.HPCOptimization"),style:{display:"environment"===Re?"block":"none"},children:[(0,g.jsx)(y.A.Item,{noStyle:!0,children:(0,g.jsxs)(U.OO,{direction:"row",gap:"sm",children:[(0,g.jsx)($.A.Text,{children:ce("session.launcher.SwitchOpenMPoptimization")}),(0,g.jsx)(y.A.Item,{label:ce("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,g.jsx)(B.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e?he.setFieldsValue({hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:void 0,OPENBLAS_NUM_THREADS:void 0}}):he.setFieldsValue({hpcOptimization:{autoEnabled:!1,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"}})}})})]})}),(0,g.jsx)(y.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var t,l;return(null===(t=e.hpcOptimization)||void 0===t?void 0:t.autoEnabled)!==(null===(l=n.hpcOptimization)||void 0===l?void 0:l.autoEnabled)},children:()=>{const e=he.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,g.jsxs)(R.A,{gutter:de.marginMD,style:{display:e?"none":void 0,marginTop:de.marginMD},children:[(0,g.jsx)(L.A,{xs:24,sm:12,children:(0,g.jsx)(y.A.Item,{style:{flex:1},label:ce("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,g.jsxs)(g.Fragment,{children:[ce("session.launcher.OpenMPOptimization"),(0,g.jsx)(v.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,g.jsx)(Ee.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,g.jsx)(L.A,{xs:24,sm:12,children:(0,g.jsx)(y.A.Item,{style:{flex:1},label:ce("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,g.jsxs)(g.Fragment,{children:[ce("session.launcher.OpenMPOptimization"),(0,g.jsx)(v.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,g.jsx)(Ee.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,g.jsx)(P.A,{title:ce("webui.menu.Data&Storage"),style:{display:"storage"===Re?"block":"none"},children:(0,g.jsx)(y.A.Item,{noStyle:!0,dependencies:["owner"],children:e=>{let{getFieldValue:n}=e;const t=n("owner"),l=(null===t||void 0===t?void 0:t.enabled)&&F().every(F().omit(t,"enabled"),(e=>void 0!==e));return(0,g.jsx)(ge.A,{rowKey:b?"id":"name",rowFilter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))},tableProps:{ownerEmail:l?null===t||void 0===t?void 0:t.email:void 0}})}})}),(0,g.jsx)(P.A,{title:ce("session.launcher.Network"),style:{display:"network"===Re?"block":"none"},children:(0,g.jsx)(d.Ay,{})}),"review"===Re&&(0,g.jsx)(le,{onClickEditStep:e=>{const n=F().findIndex(ze,{key:e});re(n)}}),(0,g.jsxs)(U.OO,{direction:"row",justify:"between",children:[(0,g.jsx)(U.OO,{gap:"sm",children:(0,g.jsx)(Te.A,{title:ce("button.Reset"),description:ce("session.launcher.ResetFormConfirm"),onConfirm:()=>{Z({},"replace"),He(!0)},icon:(0,g.jsx)(je.A,{style:{color:de.colorError}}),okText:ce("button.Reset"),okButtonProps:{danger:!0},children:(0,g.jsx)(z.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:ce("button.Reset")})})}),(0,g.jsxs)(U.OO,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[W>0&&(0,g.jsx)(z.Ay,{onClick:()=>{re(W-1)},icon:(0,g.jsx)(ye.A,{}),children:ce("button.Previous")}),W===ze.length-1?(0,g.jsx)(ue.A,{title:Le?ce("session.launcher.PleaseCompleteForm"):void 0,children:(0,g.jsx)(U.Fv,{type:"primary",icon:(0,g.jsx)(Ae.A,{}),disabled:Le,action:async()=>{var e;const n=X,l=await he.validateFields().catch((e=>{u.error("validation errors",e)}));if(l){if(F().isEmpty(l.mount_ids)||0===(null===(e=l.mount_ids)||void 0===e?void 0:e.length)){if(!await t.modal.confirm({title:ce("session.launcher.NoFolderMounted"),content:(0,g.jsxs)(g.Fragment,{children:[ce("session.launcher.HomeDirectoryDeletionDialog"),(0,g.jsx)("br",{}),(0,g.jsx)("br",{}),ce("session.launcher.LaunchConfirmationDialog"),(0,g.jsx)("br",{}),(0,g.jsx)("br",{}),ce("dialog.ask.DoYouWantToProceed")]}),okText:ce("session.launcher.Start"),closable:!0}))return}await T(l).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&(C(e.fulfilled),E(l.resourceGroup),se({params:n,name:e.fulfilled[0].value.sessionName})),null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&Y(J||"/job"),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const n=e.rejected[0].reason;t.modal.error({title:null===n||void 0===n?void 0:n.title,content:m(n)})}})).catch((e=>{u.error("Unexpected error during session creation:",e),t.message.error(ce("error.UnexpectedError"))}))}},children:ce("session.launcher.Launch")})}):(0,g.jsxs)(z.Ay,{type:"primary",ghost:!0,onClick:()=>{re(W+1)},children:[ce("button.Next")," ",(0,g.jsx)(be.A,{})]}),W!==ze.length-1&&(0,g.jsxs)(z.Ay,{onClick:()=>{re(ze.length-1)},children:[ce("session.launcher.SkipToConfirmAndLaunch"),(0,g.jsx)(Fe.A,{})]})]})]})]})]})})]}),me.lg&&(0,g.jsx)(U.OO,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,g.jsx)(Ie.A,{size:"small",orientation:"vertical",current:W,onChange:e=>{re(e)},items:F().map(ze,((e,n)=>(0,l.A)((0,l.A)({},e),{},{status:n===W?"process":"wait"})))})})]}),(0,g.jsx)(ve,{onRequestClose:e=>{if(e){const n=F().merge({sessionName:"",ports:[],vfoldersNameMap:{},mount_ids:[],mount_id_map:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0},agent:["auto"]},e);F().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,U.kX)(4)),he.setFieldsValue(n),re(ze.length-1),he.validateFields().catch((()=>{}))}ne()},open:ee}),W===ze.length-1?(0,g.jsx)(Ce.tH,{fallback:null,children:(0,g.jsx)(j,{open:Ue,onClose:()=>{Ge(!1)},scrollIntoViewOptions:!0})}):void 0]})}}}]);
//# sourceMappingURL=57.e1795bea.chunk.js.map