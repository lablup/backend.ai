"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[587],{23671:(e,n,l)=>{l.d(n,{Ay:()=>h,z7:()=>p});var a=l(96520),i=l(51142),r=l(30978),o=l(79837),t=l(294),s=l(90086),d=l(64428),u=l.n(d),m=l(55202),c=l(44617),v=l(52426);const g=[/AUTH/i,/ACCESS/i,/SECRET/i,/_KEY/i,/PASSWORD/i,/PASSWD/i,/PWD/i,/TOKEN/i,/PRIVATE/i,/CREDENTIAL/i,/JWT/i,/KEYPAIR/i,/CERTIFICATE/i,/SSH/i,/ENCRYPT/i,/SIGNATURE/i,/SALT/i,/PIN/i,/PASSPHRASE/i,/OAUTH/i];function p(e){return u().map(e,(e=>{return e&&(n=e.variable,g.some((e=>e.test(n))))?{...e,value:""}:e;var n}))}const h=e=>{let{formItemProps:n,...l}=e;const d=(0,m.useRef)(null),{t:g}=(0,c.Bd)(),p=o.A.useFormInstance();return(0,v.jsx)(o.A.List,{...l,children:(e,m)=>{let{add:c,remove:h}=m;return(0,v.jsxs)(a.A,{direction:"column",gap:"xs",align:"stretch",children:[e.map(((r,s)=>{let{key:m,name:c,...y}=r;return(0,v.jsxs)(a.A,{direction:"row",align:"baseline",gap:"xs",children:[(0,v.jsx)(o.A.Item,{...y,style:{marginBottom:0,flex:1},name:[c,"variable"],rules:[{required:!0,message:g("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:g("session.launcher.EnvironmentVariableNamePatternError")},e=>{let{getFieldValue:n}=e;return{validator(e,a){const i=u().map(n(l.name),(e=>null===e||void 0===e?void 0:e.variable));return!u().isEmpty(a)&&i.length>0&&u().filter(i,(e=>e===a)).length>1?Promise.reject(g("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}],...n,children:(0,v.jsx)(t.A,{ref:s===e.length-1?d:null,placeholder:"Variable",onChange:()=>{const n=e.map(((e,n)=>[l.name,n,"variable"]));p.validateFields(n)}})}),(0,v.jsx)(o.A.Item,{...y,name:[c,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:g("session.launcher.EnvironmentVariableValueRequired")}],validateTrigger:["onChange","onBlur"],children:(0,v.jsx)(t.A,{placeholder:"Value"})}),(0,v.jsx)(i.A,{onClick:()=>h(c)})]},m)})),(0,v.jsx)(o.A.Item,{noStyle:!0,children:(0,v.jsx)(s.Ay,{type:"dashed",onClick:()=>{c(),setTimeout((()=>{d.current&&d.current.focus()}),0)},icon:(0,v.jsx)(r.A,{}),block:!0,children:g("session.launcher.AddEnvironmentVariable")})})]})}})}},24721:(e,n,l)=>{l.d(n,{A:()=>b});var a=l(77813),i=l(81751),r=l(6871),o=l(34384),t=l(96520);var s,d=l(51598),u=l(3413),m=l(71559),c=l(79837),v=l(37090),g=l(18959),p=l(41961),h=l(36290),y=l(55616),A=l(294),f=l(64428),x=l.n(f),j=l(55202),_=l(44617),k=l(18139),F=l(52426);const b=e=>{var n;let{filter:f,showPrivate:b}=e;const w=c.A.useFormInstance(),S=c.A.useWatch("environments",{form:w,preserve:!0}),V=(0,i.CX)(),I=null===V||void 0===V?void 0:V.supports("extended-image-info"),[K,N]=(0,j.useState)(""),[C,E]=(0,j.useState)(""),{t:T}=(0,_.Bd)(),[P,{getBaseVersion:M,getImageMeta:R,tagAlias:L}]=(0,i.Gj)(),{token:O}=v.A.useToken(),{isDarkMode:B}=(0,r.e)(),z=(0,j.useRef)(null),G=(0,j.useRef)(null),q=null!==V&&void 0!==V&&null!==(n=V._config)&&void 0!==n&&n.showNonInstalledImages?{}:{installed:!0},{images:$}=(0,k.useLazyLoadQuery)(void 0!==s?s:s=l(96622),q,{fetchPolicy:"store-and-network"});(0,j.useEffect)((()=>{var e,n,l;if(!x().isEmpty(null===S||void 0===S?void 0:S.manual))return void((S.environment||S.version)&&w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}}));let i,r,o,t,s=null===(e=w.getFieldValue("environments"))||void 0===e?void 0:e.version;var d,u;(s&&s.indexOf("@")<0&&(s+="@x86_64"),s&&x().find(D,(e=>(i=x().find(e.environmentGroups,(e=>(r=x().find(e.images,(e=>(0,a.A_)(e)===s)),!!r))),!!i))),i?(o=i,t=r):w.getFieldValue(["environments","environment"])&&x().find(D,(e=>{var n;return o=x().find(e.environmentGroups,(e=>e.environmentName===w.getFieldValue(["environments","environment"]))),t=null===(n=o)||void 0===n?void 0:n.images[0],!!o})),o&&t)||(o=null===(d=D[0])||void 0===d?void 0:d.environmentGroups[0],t=null===(u=o)||void 0===u?void 0:u.images[0]);const m=null===(n=x().find(null===(l=t)||void 0===l?void 0:l.labels,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key))))||void 0===n?void 0:n.value;t?!i&&V._config.allow_manual_image_name_for_session&&s?w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0,manual:s,customizedTag:null!==m&&void 0!==m?m:void 0}}):w.setFieldsValue({environments:{environment:o.environmentName,version:(0,a.A_)(t),image:t,customizedTag:null!==m&&void 0!==m?m:void 0}}):V._config.allow_manual_image_name_for_session&&w.setFieldValue(["environments","manual"],s)}),[null===S||void 0===S?void 0:S.version,null===S||void 0===S?void 0:S.manual]);const D=(0,j.useMemo)((()=>x().chain($).filter((e=>(!!b||!(e=>x().some(null===e||void 0===e?void 0:e.labels,(e=>{var n;return"ai.backend.features"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.split(" ").includes("private"))})))(e))&&(!f||f(e)))).groupBy((e=>{var n;return(null===P||void 0===P||null===(n=P.imageInfo[R((0,a.A_)(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map(((e,n)=>({groupName:n,environmentGroups:x().chain(e).groupBy((e=>`${null===e||void 0===e?void 0:e.registry}/${I?null===e||void 0===e?void 0:e.namespace:null===e||void 0===e?void 0:e.name}`)).map(((e,n)=>{var l,i;const r=null===(l=n.split("/"))||void 0===l?void 0:l[2];return{environmentName:n,displayName:r&&(null===P||void 0===P||null===(i=P.imageInfo[r])||void 0===i?void 0:i.name)||x().last(n.split("/")),prefix:x().chain(n).split("/").drop(1).dropRight(1).join("/").value(),images:e.sort(((e,n)=>{var l,i,r,o,t,s;return function(e,n){const l=e.split(".").map(Number),a=n.split(".").map(Number);for(let i=0;i<Math.max(l.length,a.length);i++){const e=l[i]||0,n=a[i]||0;if(e>n)return 1;if(e<n)return-1}return 0}(null!==(l=null===n||void 0===n||null===(i=n.tag)||void 0===i||null===(r=i.split("-"))||void 0===r?void 0:r[0])&&void 0!==l?l:"",null!==(o=null===e||void 0===e||null===(t=e.tag)||void 0===t||null===(s=t.split("-"))||void 0===s?void 0:s[0])&&void 0!==o?o:"")||(0,a._f)(null===e||void 0===e?void 0:e.architecture,null===n||void 0===n?void 0:n.architecture)}))}})).sortBy((e=>e.displayName)).value()}))).sortBy((e=>e.groupName)).value()),[$,P,f,b]),{fullNameMatchedImage:W}=(0,j.useMemo)((()=>{let e,n;return K.length&&x().chain(D.flatMap((e=>e.environmentGroups)).find((l=>(n=l,e=x().find(l.images,(e=>(0,a.A_)(e)===K)),!!e)))).value(),{fullNameMatchedImage:e,fullNameMatchedImageGroup:n}}),[K,D]);return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)("style",{children:"/* Change the image and tags of the select option when the selection is opened  */\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  img,\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  span.ant-tag {\n  opacity: 0.5;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-light {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-dark {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px; /* Width of the transparent gradient area */\n  background: linear-gradient(\n    to right,\n    rgba(255, 255, 255, 0),\n    rgba(255, 255, 255, 1)\n  );\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px;\n  background: linear-gradient(\n    to right,\n    rgba(20, 20, 20, 0),\n    rgba(20, 20, 20, 1)\n  );\n}\n"}),(0,F.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","environment"],label:(0,F.jsxs)(g.A.Text,{copyable:{text:(0,a.A_)(w.getFieldValue(["environments","image"]))},children:[T("session.launcher.Environments")," /"," ",T("session.launcher.Version")]}),rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],style:{marginBottom:10},children:(0,F.jsx)(p.A,{ref:z,showSearch:!0,searchValue:K,onSearch:N,defaultActiveFirstOption:!0,optionFilterProp:"filterValue",onChange:e=>{if(W)w.setFieldsValue({environments:{environment:(I?null===W||void 0===W?void 0:W.namespace:null===W||void 0===W?void 0:W.name)||"",version:(0,a.A_)(W),image:W}});else{const n=D.flatMap((e=>e.environmentGroups)).filter((n=>n.environmentName===e))[0].images[0];w.setFieldsValue({environments:{environment:(I?null===n||void 0===n?void 0:n.namespace:null===n||void 0===n?void 0:n.name)||"",version:(0,a.A_)(n),image:n}})}},disabled:V._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:W?(0,F.jsx)(p.A.Option,{value:I?null===W||void 0===W?void 0:W.namespace:null===W||void 0===W?void 0:W.name,filterValue:(0,a.A_)(W),children:(0,F.jsxs)(t.A,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,F.jsx)(d.A,{image:(0,a.A_)(W)||"",style:{width:15,height:15}}),(0,a.A_)(W)]})}):x().map(D,(e=>(0,F.jsx)(p.A.OptGroup,{label:e.groupName,children:x().map(e.environmentGroups,(e=>{var n;const l=e.images[0],i=null===P||void 0===P?void 0:P.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[2]],r=[];let o=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(r.push(e.prefix),o=(0,F.jsx)(h.A,{color:"purple",children:(0,F.jsx)(m.A,{keyword:K,children:e.prefix})}));const s=x().map(null===i||void 0===i?void 0:i.label,(e=>x().isUndefined(e.category)&&e.tag&&e.color?(r.push(e.tag),(0,F.jsx)(h.A,{color:e.color,children:(0,F.jsx)(m.A,{keyword:K,children:e.tag},e.tag)},e.tag)):null));return(0,F.jsx)(p.A.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+r.join("\t"),children:(0,F.jsxs)(t.A,{direction:"row",justify:"between",children:[(0,F.jsxs)(t.A,{direction:"row",align:"center",gap:"xs",children:[(0,F.jsx)(d.A,{image:(0,a.A_)(l)||"",style:{width:15,height:15}}),(0,F.jsx)(m.A,{keyword:K,children:e.displayName})]}),(0,F.jsxs)(t.A,{direction:"row",className:B?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:O.marginXS,flexShrink:1},children:[o,s]})]})},e.environmentName)}))},e.groupName)))})}),(0,F.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var l,a;return(null===(l=e.environments)||void 0===l?void 0:l.environment)!==(null===(a=n.environments)||void 0===a?void 0:a.environment)},children:e=>{var n;let l,{getFieldValue:i}=e;return x().find(D,(e=>x().find(e.environmentGroups,(e=>{var n;return e.environmentName===(null===(n=i("environments"))||void 0===n?void 0:n.environment)&&(l=e,!0)})))),(0,F.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","version"],rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],children:(0,F.jsx)(p.A,{ref:G,onChange:e=>{const n=x().find($,(n=>(0,a.A_)(n)===e));w.setFieldValue(["environments","image"],n)},showSearch:!0,searchValue:C,onSearch:E,optionFilterProp:"filterValue",dropdownRender:e=>(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(t.A,{style:{fontWeight:O.fontWeightStrong,paddingLeft:O.paddingSM},children:[T("session.launcher.Version"),(0,F.jsx)(y.A,{type:"vertical"}),T("session.launcher.Architecture"),(0,F.jsx)(y.A,{type:"vertical"}),T("session.launcher.Tags")]}),(0,F.jsx)(y.A,{style:{margin:"8px 0"}}),e]}),disabled:V._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:x().map(x().uniqBy(null===(n=l)||void 0===n?void 0:n.images,"id"),(e=>{var n;const[l,i,...r]=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""];let s=null===P||void 0===P?void 0:P.tagAlias[i];if(!s){for(const[e,n]of Object.entries((null===P||void 0===P?void 0:P.tagReplace)||{})){const l=new RegExp(e);l.test(i)&&(s=null===i||void 0===i?void 0:i.replace(l,n))}s||(s=i)}const d=[],c=x().chain(r).filter((e=>!e.startsWith("customized_"))).map(((e,n)=>(0,F.jsx)(o.A,{values:x().split((null===P||void 0===P?void 0:P.tagAlias[e])||e,":").map((e=>(d.push(e),{label:e,highlightKeyword:C})))},n))).value(),v=null===e||void 0===e?void 0:e.labels;if(v){const e=x().findIndex(v,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key)));if(e&&v[e]){var g;const n=(null===(g=v[e])||void 0===g?void 0:g.value)||"";d.push("Customized"),d.push(n),c.push((0,F.jsx)(o.A,{highlightKeyword:C,values:[{label:"Customized",color:"cyan"},{label:null!==n&&void 0!==n?n:"",color:"cyan"}]},c.length+1))}}return(0,F.jsx)(p.A.Option,{value:(0,a.A_)(e),filterValue:[l,s,null===e||void 0===e?void 0:e.architecture,...d].join("\t"),children:I?(0,F.jsxs)(t.A,{direction:"row",children:[(0,F.jsx)(m.A,{keyword:C,children:null===e||void 0===e?void 0:e.version}),(0,F.jsx)(y.A,{type:"vertical"}),(0,F.jsx)(m.A,{keyword:C,children:null===e||void 0===e?void 0:e.architecture}),(0,F.jsx)(y.A,{type:"vertical"}),(0,F.jsx)(t.A,{direction:"row",align:"start",children:x().map(null===e||void 0===e?void 0:e.tags,(n=>{var l;const i=x().includes(n.key,"customized_"),r=i?null===(l=x().find(null===e||void 0===e?void 0:e.labels,{key:"ai.backend.customized-image.name"}))||void 0===l?void 0:l.value:n.value,t=L(n.key+r);return x().isEqual(t,(0,a.WY)(n.key+r))||i?(0,F.jsx)(o.A,{highlightKeyword:C,values:[{label:L(n.key),color:i?"cyan":"blue"},{label:null!==r&&void 0!==r?r:"",color:i?"cyan":"blue"}]},n.key):(0,F.jsx)(h.A,{color:i?"cyan":"blue",children:(0,F.jsx)(m.A,{keyword:C,children:t})},n.key)}))})]}):(0,F.jsx)(t.A,{direction:"row",justify:"between",children:(0,F.jsxs)(t.A,{direction:"row",children:[(0,F.jsx)(m.A,{keyword:C,children:M((0,a.A_)(e)||"")}),(0,F.jsx)(y.A,{type:"vertical"}),(0,F.jsx)(m.A,{keyword:C,children:null===e||void 0===e?void 0:e.architecture}),(0,F.jsx)(y.A,{type:"vertical"}),(0,F.jsx)(u.Jj,{tag:(null===e||void 0===e?void 0:e.tag)||"",highlightKeyword:C,labels:null===e||void 0===e?void 0:e.labels})]})})},null===e||void 0===e?void 0:e.id)}))})})}}),(0,F.jsx)(c.A.Item,{label:T("session.launcher.ManualImageName"),name:["environments","manual"],style:{display:V._config.allow_manual_image_name_for_session?"block":"none"},children:(0,F.jsx)(A.A,{allowClear:!0,onChange:e=>{x().isEmpty(e)||w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}})}})}),(0,F.jsx)(c.A.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,F.jsx)(A.A,{})})]})}},51598:(e,n,l)=>{l.d(n,{A:()=>t});var a=l(81751),i=l(55202),r=l(52426);const o=e=>{let{image:n,style:l={},alt:i=""}=e;const[,{getImageIcon:o}]=(0,a.Gj)();return(0,r.jsx)("img",{src:o(n),style:{width:"1em",height:"1em",verticalAlign:"middle",...l},alt:i})},t=i.memo(o)},3413:(e,n,l)=>{l.d(n,{Ay:()=>h,Jj:()=>y});var a=l(77813),i=l(81751),r=l(34384),o=(l(96520),l(71559)),t=l(36290),s=l(64428),d=l.n(s),u=l(55202),m=l(52426);const c=e=>{let{image:n,...l}=e;n=n||"";const[,{getImageAliasName:a,getBaseVersion:o,tagAlias:t}]=(0,i.Gj)();return(0,m.jsx)(r.A,{values:[{label:t(a(n)),color:"blue"},{label:o(n),color:"green"}],...l})},v=e=>{let{image:n,...l}=e;n=n||"";const[,{getBaseImage:a,tagAlias:r}]=(0,i.Gj)();return d().isEmpty(r(a(n)))?null:(0,m.jsx)(t.A,{color:"green",...l,children:r(a(n))})},g=e=>{let{image:n,...l}=e;n=n||"";const[,{getArchitecture:a,tagAlias:r}]=(0,i.Gj)();return d().isEmpty(r(a(n)))?null:(0,m.jsx)(t.A,{color:"green",...l,children:a(n)})},p=e=>{let{image:n}=e;return n=n||"",(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(c,{image:n}),(0,m.jsx)(v,{image:n}),(0,m.jsx)(g,{image:n})]})},h=u.memo(p),y=e=>{let{tag:n,labels:l,highlightKeyword:s,...c}=e;l=l||[];const[,{getTags:v,tagAlias:g}]=(0,i.Gj)(),p=v(n,l);return(0,m.jsx)(u.Fragment,{...c,children:d().map(p,((e,n)=>{const l="Customized"===e.key,i=g(e.key+e.value);return d().isEqual(i,(0,a.WY)(e.key+e.value))?(0,m.jsx)(r.A,{highlightKeyword:s,values:[{label:g(e.key),color:l?"cyan":"blue"},{label:e.value,color:l?"cyan":"blue"}]},e.key):(0,m.jsx)(t.A,{color:l?"cyan":"blue",children:(0,m.jsx)(o.A,{keyword:s,children:i},n)},e.key)}))})}},82213:(e,n,l)=>{l.d(n,{A:()=>$});var a,i=l(77813),r=l(81751),o=l(78568),t=l(7885),s=l(6452),d=l(43992),u=l(62424),m=l(72584),c=l(54145),v=l(96520),g=l(32630),p=l(21765),h=l(71559),y=l(34384),A=l(64428),f=l.n(A),x=l(55202),j=l(18139),_=l(52426);const k=e=>{let{vFolderFrgmt:n=null,permission:i}=e;const r=(0,j.useFragment)(void 0!==a?a:a=l(51300),n),o=f().chain({r:"green",w:"blue",d:"red"}).map(((e,n)=>{if(((e,n)=>!(null===e||void 0===e||!e.includes(n))||!(null===e||void 0===e||!e.includes("w")||"r"!==n))((null===r||void 0===r?void 0:r.permission)||i,n))return{label:n.toUpperCase(),color:e}})).compact().value();return(0,_.jsx)(y.A,{values:o})};var F,b=l(58915),w=l(15658),S=l(24262),V=l(79837),I=l(37090),K=l(18959),N=l(86663),C=l(294),E=l(90086),T=l(56909),P=l(69788),M=l(36290),R=l(52530),L=l.n(R),O=l(49664),B=l(44617);const z=/^[a-zA-Z0-9_/.-]*$/,G="/home/work/",q=e=>{let{filter:n,showAliasInput:a=!1,selectedRowKeys:y=[],onChangeSelectedRowKeys:A,aliasBasePath:R=G,aliasMap:q,onChangeAliasMap:$,rowKey:D="name",onChangeAutoMountedFolders:W,showAutoMountedFoldersSection:Q,ownerEmail:U,...J}=e;const{generateFolderPath:H}=(0,p.useFolderExplorerOpener)(),Y=x.useMemo((()=>e=>e&&e[D]),[D]),[X,Z]=(0,x.useState)(!1),[ee,ne]=(0,s.A)({value:y,onChange:A},{defaultValue:[]}),[le,ae]=(0,s.A)({value:q,onChange:$},{defaultValue:{}}),ie=(0,r.CX)(),[re]=(0,o.x)(null===ie||void 0===ie?void 0:ie._config.accessKey),[oe]=V.A.useForm();(0,x.useEffect)((()=>{le&&(oe.setFieldsValue(f().mapValues(le,(e=>e.startsWith(R)?e.slice(R.length):e))),oe.validateFields())}),[le,oe,R]);const{t:te}=(0,B.Bd)(),{token:se}=I.A.useToken(),de=(0,i.QE)(),ue=(0,d.hd)(),[me,ce]=(0,r.Tw)("first"),[ve,ge]=(0,x.useTransition)(),{data:pe}=(0,t.nj)({queryKey:["VFolderSelectQuery",me,ue.id,U],queryFn:()=>{const e=new URLSearchParams;return e.set("group_id",ue.id),U&&e.set("owner_user_email",U),de({method:"GET",url:`/folders?${e.toString()}`})},staleTime:1e3}),{domain:he,group:ye,keypair_resource_policy:Ae}=(0,j.useLazyLoadQuery)(void 0!==F?F:F=l(96067),{domain_name:ie._config.domainName,group_id:ue.id,keypair_resource_policy_name:(null===re||void 0===re?void 0:re.resource_policy)||""},{fetchPolicy:"store-and-network",fetchKey:me}),fe=(0,x.useMemo)((()=>{const e=JSON.parse((null===he||void 0===he?void 0:he.allowed_vfolder_hosts)||"{}"),n=JSON.parse((null===ye||void 0===ye?void 0:ye.allowed_vfolder_hosts)||"{}"),l=JSON.parse((null===Ae||void 0===Ae?void 0:Ae.allowed_vfolder_hosts)||"{}"),a=f().merge({},e,n,l),i=Object.keys(a).filter((e=>a[e].includes("mount-in-session")));return null===pe||void 0===pe?void 0:pe.filter((e=>i.includes(e.host)))}),[he,ye,Ae,pe]),xe=(0,x.useMemo)((()=>f().chain(fe).filter((e=>{var n;return"ready"===e.status&&(null===(n=e.name)||void 0===n?void 0:n.startsWith("."))})).map((e=>e.name)).value()),[fe]);(0,x.useEffect)((()=>{f().isFunction(W)&&W(xe)}),[xe]);const[je,_e]=(0,x.useState)(""),ke=f().chain(fe).filter((e=>!n||n(e))).filter((e=>!!ee.includes(Y(e))||(!je||e.name.includes(je)))).value(),Fe=(0,x.useCallback)(((e,n)=>void 0===n||""===n?`${R}${e}`:n.startsWith("/")?n:`${R}${n}`),[R]),be=(0,u.E)((()=>{ae(f().mapValues(f().pickBy(oe.getFieldsValue({strict:!1}),(e=>!!e)),((e,n)=>Fe(n,e)))),oe.validateFields().catch((()=>{}))}));(0,x.useEffect)((()=>{be()}),[JSON.stringify(ee),be]);const we=[{title:(0,_.jsxs)(v.A,{direction:"row",gap:"xxs",children:[(0,_.jsx)(K.A.Text,{children:te("data.folders.Name")}),a&&(0,_.jsx)(_.Fragment,{children:(0,_.jsxs)(K.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",te("session.launcher.FolderAlias")," ",(0,_.jsx)(N.A,{title:(0,_.jsx)(B.x6,{i18nKey:"session.launcher.DescFolderAlias"}),children:(0,_.jsx)(b.A,{})}),")"]})})]}),dataIndex:"name",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n)=>{const l=ee.includes(Y(n));return(0,_.jsxs)(v.A,{direction:"column",align:"start",gap:"xxs",style:a&&l?{display:"inline-flex",height:70,width:"100%"}:{maxWidth:200},children:[(0,_.jsx)(c.A,{type:"hover",to:H(n.id),children:(0,_.jsx)(h.A,{keyword:je,children:e})}),a&&l&&(0,_.jsx)(V.A.Item,{noStyle:!0,shouldUpdate:(e,l)=>e[Y(n)]!==l[Y(n)],children:()=>{const e=f()(ee).reduce(((e,n)=>(e[n]=(null===le||void 0===le?void 0:le[n])||Fe(n,void 0),e)),{});return(0,_.jsx)(V.A.Item,{name:Y(n),rules:[{type:"string",pattern:z,message:te("session.launcher.FolderAliasInvalid")},{type:"string",validator:async(l,a)=>a&&f().some(e,((e,l)=>l!==Y(n)&&e===Fe(Y(n),a)))?Promise.reject(te("session.launcher.FolderAliasOverlapping")):Promise.resolve()},{type:"string",validator:async(e,l)=>{const a=Fe(Y(n),l);return l&&f().map(xe,(e=>Fe("",e))).includes(a)?Promise.reject(te("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],extra:Fe(n.name,oe.getFieldValue(Y(n))),children:(0,_.jsx)(C.A,{onClick:e=>{e.stopPropagation()},placeholder:te("session.launcher.FolderAlias"),allowClear:!0,onChange:()=>{be()}})})}})]})}},{title:te("data.UsageMode"),dataIndex:"usage_mode",sorter:(e,n)=>e.usage_mode.localeCompare(n.usage_mode)},{title:te("data.Host"),dataIndex:"host"},{title:te("data.Type"),dataIndex:"type",sorter:(e,n)=>e.type.localeCompare(n.type),render:(e,n)=>(0,_.jsx)(v.A,{direction:"column",children:"user"===n.ownership_type?(0,_.jsxs)(v.A,{gap:"xs",children:[(0,_.jsx)(K.A.Text,{children:te("data.User")}),(0,_.jsx)(w.A,{style:{color:se.colorTextTertiary}})]}):(0,_.jsxs)(v.A,{gap:"xs",children:[(0,_.jsx)(K.A.Text,{children:te("data.Project")}),(0,_.jsx)(m.A,{style:{color:se.colorTextTertiary}})]})})},{title:te("data.Permission"),dataIndex:"permission",sorter:(e,n)=>e.permission.localeCompare(n.permission),render:(e,n)=>(0,_.jsx)(k,{permission:n.permission})},{title:te("data.Created"),dataIndex:"created_at",sorter:(e,n)=>e.created_at.localeCompare(n.created_at),render:(e,n)=>L()(e).format("L"),defaultSortOrder:"descend"}];return(0,_.jsxs)(v.A,{direction:"column",align:"stretch",gap:"xs",children:[(0,_.jsxs)(v.A,{direction:"row",gap:"xs",justify:"between",children:[(0,_.jsx)(C.A,{value:je,onChange:e=>_e(e.target.value),allowClear:!0,placeholder:te("data.SearchByName")}),(0,_.jsx)(N.A,{title:te("button.Refresh"),children:(0,_.jsx)(E.Ay,{loading:ve,icon:(0,_.jsx)(S.A,{}),onClick:()=>{ge((()=>{ce()}))}})}),(0,_.jsx)(N.A,{title:te("data.CreateANewStorageFolder"),children:(0,_.jsx)(E.Ay,{icon:(0,_.jsx)(O.A,{}),type:"primary",ghost:!0,onClick:()=>{Z(!0)}})})]}),(0,_.jsx)(V.A,{form:oe,component:!1,preserve:!1,children:(0,_.jsx)(T.A,{scroll:{x:"max-content"},rowKey:Y,rowSelection:{selectedRowKeys:ee,onChange:e=>{ne(e),be()}},showSorterTooltip:!1,columns:we,dataSource:ke,onRow:(e,n)=>({onClick:n=>{var l;const a=n.target;null!==a&&void 0!==a&&null!==(l=a.classList)&&void 0!==l&&l.contains("ant-table-selection-column")&&(n.stopPropagation(),ee.includes(Y(e))?ne(ee.filter((n=>n!==Y(e)))):ne([...ee,Y(e)]))}}),...J})}),Q&&xe.length>0?(0,_.jsx)(_.Fragment,{children:(0,_.jsx)(P.A,{size:"small",children:(0,_.jsx)(P.A.Item,{label:te("data.AutomountFolders"),children:f().map(xe,(e=>(0,_.jsx)(M.A,{children:e},e)))})})}):null,(0,_.jsx)(g.A,{open:X,onRequestClose:e=>{Z(!1),e&&ge((()=>{ce(),ne((n=>[...n,e[D]]))}))}})]})},$=e=>{let{filter:n,rowKey:l="name",tableProps:a,...i}=e;const r=V.A.useFormInstance(),{t:o}=(0,B.Bd)();return(0,x.useEffect)((()=>{r.setFieldsValue({mounts:[],vfoldersAliasMap:{},autoMountedFolderNames:[]})}),[null===a||void 0===a?void 0:a.ownerEmail,r]),(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(V.A.Item,{hidden:!0,name:"vfoldersAliasMap",rules:[{validator(e,n){const l=f().chain(r.getFieldValue("mounts")).reduce(((e,l)=>(e[l]=n[l]||"/home/work/"+l,e)),{}).values().value();return f().uniq(l).length!==l.length?Promise.reject(o("session.launcher.FolderAliasOverlapping")):f().some(l,(e=>!z.test(e)))?Promise.reject(o("session.launcher.FolderAliasInvalid")):f().some(r.getFieldValue("autoMountedFolderNames"),(e=>l.includes(G+e)))?Promise.reject(o("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],children:(0,_.jsx)(C.A,{})}),(0,_.jsx)(V.A.Item,{hidden:!0,name:"autoMountedFolderNames"}),(0,_.jsx)(V.A.Item,{name:"mounts",...i,valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,_.jsx)(q,{rowKey:l,showAliasInput:!0,aliasMap:r.getFieldValue("vfoldersAliasMap"),onChangeAliasMap:e=>{r.setFieldValue("vfoldersAliasMap",e),r.validateFields(["vfoldersAliasMap"])},pagination:!1,filter:n,showAutoMountedFoldersSection:!0,onChangeAutoMountedFolders:e=>{r.setFieldValue("autoMountedFolderNames",e)},...a})})]})}},96622:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},l=[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base_image_name",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"version",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:a,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:a},params:{cacheID:"9ff1339a66b7da77df70de956e3c7dd8",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:'query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    name @deprecatedSince(version: "24.12.0")\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n    namespace @since(version: "24.12.0")\n    base_image_name @since(version: "24.12.0")\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    version @since(version: "24.12.0")\n  }\n}\n'}}}();a.hash="40b2d995106300fffb0c3a5d66103d38";const i=a},51300:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"},i=a},96067:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domain_name"},{defaultValue:null,kind:"LocalArgument",name:"group_id"},{defaultValue:null,kind:"LocalArgument",name:"keypair_resource_policy_name"}],n=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],l=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domain_name"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domain_name"},{kind:"Variable",name:"id",variableName:"group_id"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"keypair_resource_policy_name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:n,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderTableProjectQuery",selections:l,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderTableProjectQuery",selections:l},params:{cacheID:"2c2ce905afd89e93c6d761f22ed59f3d",id:null,metadata:{},name:"VFolderTableProjectQuery",operationKind:"query",text:"query VFolderTableProjectQuery(\n  $domain_name: String!\n  $group_id: UUID!\n  $keypair_resource_policy_name: String!\n) {\n  domain(name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  group(id: $group_id, domain_name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $keypair_resource_policy_name) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();a.hash="ccdbaa52a63c2ea005423e7c541eff80";const i=a}}]);
//# sourceMappingURL=587.4eb19390.chunk.js.map