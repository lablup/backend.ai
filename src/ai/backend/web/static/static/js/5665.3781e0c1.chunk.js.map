{"version":3,"file":"static/js/5665.3781e0c1.chunk.js","mappings":"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","sources":["components/UserProfileSettingModal.tsx","../../node_modules/.pnpm/@ant-design+icons-svg@4.4.2/node_modules/@ant-design/icons-svg/es/asn/WarningTwoTone.js","../../node_modules/.pnpm/@ant-design+icons@5.6.1_react-dom@19.2.1_react@19.2.1__react@19.2.1/node_modules/@ant-design/icons/es/icons/WarningTwoTone.js","components/ResetPasswordRequired.tsx"],"sourcesContent":["/**\n @license\n Copyright (c) 2015-2025 Lablup Inc. All rights reserved.\n */\nimport { UserProfileSettingModalQuery } from '../__generated__/UserProfileSettingModalQuery.graphql';\nimport { useSuspendedBackendaiClient } from '../hooks';\nimport { useCurrentUserInfo, useCurrentUserRole } from '../hooks/backendai';\nimport { useTanMutation } from '../hooks/reactQueryAlias';\nimport { passwordPattern } from './ResetPasswordRequired';\nimport TOTPActivateModal from './TOTPActivateModal';\nimport { UserProfileQuery } from './UserProfileSettingModalQuery';\nimport { ExclamationCircleFilled, LoadingOutlined } from '@ant-design/icons';\nimport { useToggle } from 'ahooks';\nimport {\n  Modal,\n  ModalProps,\n  Input,\n  Form,\n  message,\n  Switch,\n  Spin,\n  FormInstance,\n} from 'antd';\nimport { BAIModal, useErrorMessageResolver } from 'backend.ai-ui';\nimport React, { useRef } from 'react';\nimport { useTranslation } from 'react-i18next';\nimport { PreloadedQuery, usePreloadedQuery } from 'react-relay';\n\ninterface Props extends ModalProps {\n  queryRef: PreloadedQuery<UserProfileSettingModalQuery>;\n  onRequestClose: (success?: boolean) => void;\n  onRequestRefresh: () => void;\n  totpSupported?: boolean;\n  isRefreshModalPending?: boolean;\n}\n\ntype UserProfileFormValues = {\n  full_name: string;\n  originalPassword?: string;\n  newPasswordConfirm?: string;\n  newPassword?: string;\n  totp_activated: boolean;\n};\n\nconst UserProfileSettingModal: React.FC<Props> = ({\n  onRequestClose,\n  onRequestRefresh,\n  isRefreshModalPending,\n  totpSupported,\n  queryRef,\n  ...baiModalProps\n}) => {\n  const { t } = useTranslation();\n  const formRef = useRef<FormInstance<UserProfileFormValues>>(null);\n  const [messageApi, contextHolder] = message.useMessage();\n  const [modal, modalContextHolder] = Modal.useModal();\n  const [isOpenTOTPActivateModal, { toggle: toggleTOTPActivateModal }] =\n    useToggle(false);\n  const baiClient = useSuspendedBackendaiClient();\n  const userRole = useCurrentUserRole();\n  const [userInfo, userMutations] = useCurrentUserInfo();\n  const { getErrorMessage } = useErrorMessageResolver();\n\n  const { user } = usePreloadedQuery(UserProfileQuery, queryRef);\n\n  const mutationToRemoveTotp = useTanMutation({\n    mutationFn: () => {\n      return baiClient.remove_totp();\n    },\n  });\n\n  const onSubmit = () => {\n    formRef.current\n      ?.validateFields()\n      .then((values) => {\n        userMutations.updateFullName(values.full_name, {\n          onSuccess: (newFullName) => {\n            if (newFullName !== userInfo.full_name) {\n              messageApi.open({\n                type: 'success',\n                content: t('webui.menu.FullNameUpdated'),\n              });\n            }\n\n            if (\n              values.newPassword &&\n              values.newPasswordConfirm &&\n              values.originalPassword\n            ) {\n              userMutations.updatePassword(\n                {\n                  new_password: values.newPassword,\n                  new_password2: values.newPasswordConfirm,\n                  old_password: values.originalPassword,\n                },\n                {\n                  onSuccess: () => {\n                    messageApi.open({\n                      type: 'success',\n                      content: t('webui.menu.PasswordUpdated'),\n                    });\n                    onRequestClose(true);\n                  },\n                  onError: (e) => {\n                    messageApi.open({\n                      type: 'error',\n                      content: e.message,\n                    });\n                  },\n                },\n              );\n            } else {\n              onRequestClose(true);\n            }\n          },\n          onError: (e) => {\n            messageApi.open({\n              type: 'error',\n              content: e.message,\n            });\n          },\n        });\n      })\n      .catch(() => {});\n  };\n\n  return (\n    <>\n      <BAIModal\n        {...baiModalProps}\n        okText={t('webui.menu.Update')}\n        cancelText={t('webui.menu.Cancel')}\n        onCancel={() => {\n          onRequestClose();\n        }}\n        confirmLoading={userInfo.isPendingMutation}\n        onOk={() => onSubmit()}\n        centered\n        destroyOnHidden\n        title={t('webui.menu.MyAccountInformation')}\n      >\n        <Spin spinning={isRefreshModalPending} indicator={<LoadingOutlined />}>\n          <Form\n            ref={formRef}\n            layout=\"vertical\"\n            initialValues={{\n              full_name: userInfo.full_name,\n              totp_activated: user?.totp_activated || false,\n            }}\n            preserve={false}\n          >\n            <Form.Item\n              name=\"full_name\"\n              label={t('webui.menu.FullName')}\n              rules={[\n                () => ({\n                  validator(_, value) {\n                    if (value && value.length < 65) {\n                      return Promise.resolve();\n                    }\n                    return Promise.reject(\n                      new Error(t('webui.menu.FullNameInvalid')),\n                    );\n                  },\n                }),\n              ]}\n            >\n              <Input />\n            </Form.Item>\n            <Form.Item\n              name=\"originalPassword\"\n              label={t('webui.menu.OriginalPassword')}\n              rules={[\n                ({ getFieldValue }) => ({\n                  validator(_, value) {\n                    if (\n                      !value &&\n                      (getFieldValue('newPassword') ||\n                        getFieldValue('newPasswordConfirm'))\n                    ) {\n                      return Promise.reject(\n                        new Error(t('webui.menu.InputOriginalPassword')),\n                      );\n                    }\n                    return Promise.resolve();\n                  },\n                }),\n              ]}\n              dependencies={['newPassword', 'newPasswordConfirm']}\n            >\n              <Input.Password />\n            </Form.Item>\n            <Form.Item\n              name=\"newPassword\"\n              label={t('webui.menu.NewPassword')}\n              rules={[\n                {\n                  pattern:\n                    userRole === 'superadmin' ? undefined : passwordPattern,\n                  message: t('webui.menu.InvalidPasswordMessage'),\n                },\n              ]}\n            >\n              <Input.Password />\n            </Form.Item>\n            <Form.Item\n              name=\"newPasswordConfirm\"\n              label={t('webui.menu.NewPasswordAgain')}\n              dependencies={['newPassword']}\n              rules={[\n                ({ getFieldValue }) => ({\n                  validator(_, value) {\n                    if (!value || getFieldValue('newPassword') === value) {\n                      return Promise.resolve();\n                    }\n                    return Promise.reject(\n                      new Error(t('webui.menu.NewPasswordMismatch')),\n                    );\n                  },\n                }),\n              ]}\n            >\n              <Input.Password />\n            </Form.Item>\n            {!!totpSupported && (\n              <Form.Item\n                name=\"totp_activated\"\n                label={t('webui.menu.TotpActivated')}\n                valuePropName=\"checked\"\n              >\n                <Switch\n                  loading={mutationToRemoveTotp.isPending}\n                  onChange={(checked: boolean) => {\n                    if (checked) {\n                      toggleTOTPActivateModal();\n                    } else {\n                      if (user?.totp_activated) {\n                        formRef.current?.setFieldValue('totp_activated', true);\n                        modal.confirm({\n                          title: t('totp.TurnOffTotp'),\n                          icon: <ExclamationCircleFilled />,\n                          content: t('totp.ConfirmTotpRemovalBody'),\n                          okText: t('button.Yes'),\n                          okType: 'danger',\n                          cancelText: t('button.No'),\n                          onOk() {\n                            mutationToRemoveTotp.mutate(undefined, {\n                              onSuccess: () => {\n                                message.success(\n                                  t('totp.RemoveTotpSetupCompleted'),\n                                );\n                                // updateFetchKey();\n                                onRequestRefresh();\n\n                                formRef.current?.setFieldValue(\n                                  'totp_activated',\n                                  false,\n                                );\n                              },\n                              onError: (error) => {\n                                message.error(getErrorMessage(error));\n                              },\n                            });\n                          },\n                          onCancel() {\n                            formRef.current?.setFieldValue(\n                              'totp_activated',\n                              true,\n                            );\n                          },\n                        });\n                      }\n                    }\n                  }}\n                />\n              </Form.Item>\n            )}\n          </Form>\n        </Spin>\n        {!!totpSupported && (\n          <TOTPActivateModal\n            userFrgmt={user}\n            open={isOpenTOTPActivateModal}\n            onRequestClose={(success) => {\n              if (success) {\n                // updateFetchKey();\n                onRequestRefresh();\n              } else {\n                formRef.current?.setFieldValue('totp_activated', false);\n              }\n              toggleTOTPActivateModal();\n            }}\n          />\n        )}\n      </BAIModal>\n      {contextHolder}\n      {modalContextHolder}\n    </>\n  );\n};\n\nexport default UserProfileSettingModal;\n","// This icon file is generated automatically.\nvar WarningTwoTone = { \"icon\": function render(primaryColor, secondaryColor) { return { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z\", \"fill\": primaryColor } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M172.2 828.1h679.6L512 239.9 172.2 828.1zM560 720a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm-16-304v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8z\", \"fill\": secondaryColor } }, { \"tag\": \"path\", \"attrs\": { \"d\": \"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z\", \"fill\": primaryColor } }] }; }, \"name\": \"warning\", \"theme\": \"twotone\" };\nexport default WarningTwoTone;\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\n\nimport * as React from 'react';\nimport WarningTwoToneSvg from \"@ant-design/icons-svg/es/asn/WarningTwoTone\";\nimport AntdIcon from \"../components/AntdIcon\";\nvar WarningTwoTone = function WarningTwoTone(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _extends({}, props, {\n    ref: ref,\n    icon: WarningTwoToneSvg\n  }));\n};\n\n/**![warning](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIGZpbGw9IiNjYWNhY2EiIHZpZXdCb3g9IjY0IDY0IDg5NiA4OTYiIGZvY3VzYWJsZT0iZmFsc2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTk1NS43IDg1NmwtNDE2LTcyMGMtNi4yLTEwLjctMTYuOS0xNi0yNy43LTE2cy0yMS42IDUuMy0yNy43IDE2bC00MTYgNzIwQzU2IDg3Ny40IDcxLjQgOTA0IDk2IDkwNGg4MzJjMjQuNiAwIDQwLTI2LjYgMjcuNy00OHptLTc4My41LTI3LjlMNTEyIDIzOS45bDMzOS44IDU4OC4ySDE3Mi4yeiIgZmlsbD0iIzE2NzdmZiIgLz48cGF0aCBkPSJNMTcyLjIgODI4LjFoNjc5LjZMNTEyIDIzOS45IDE3Mi4yIDgyOC4xek01NjAgNzIwYTQ4LjAxIDQ4LjAxIDAgMDEtOTYgMCA0OC4wMSA0OC4wMSAwIDAxOTYgMHptLTE2LTMwNHYxODRjMCA0LjQtMy42IDgtOCA4aC00OGMtNC40IDAtOC0zLjYtOC04VjQxNmMwLTQuNCAzLjYtOCA4LThoNDhjNC40IDAgOCAzLjYgOCA4eiIgZmlsbD0iI2U2ZjRmZiIgLz48cGF0aCBkPSJNNDY0IDcyMGE0OCA0OCAwIDEwOTYgMCA0OCA0OCAwIDEwLTk2IDB6bTE2LTMwNHYxODRjMCA0LjQgMy42IDggOCA4aDQ4YzQuNCAwIDgtMy42IDgtOFY0MTZjMC00LjQtMy42LTgtOC04aC00OGMtNC40IDAtOCAzLjYtOCA4eiIgZmlsbD0iIzE2NzdmZiIgLz48L3N2Zz4=) */\nvar RefIcon = /*#__PURE__*/React.forwardRef(WarningTwoTone);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'WarningTwoTone';\n}\nexport default RefIcon;","import { baiSignedRequestWithPromise } from '../helper';\nimport { useAnonymousBackendaiClient } from '../hooks';\nimport { useTanMutation } from '../hooks/reactQueryAlias';\nimport { useWebComponentInfo } from './DefaultProviders';\nimport { WarningTwoTone } from '@ant-design/icons';\nimport { Button, Form, Modal, Typography, Input, theme } from 'antd';\nimport { BAIFlex } from 'backend.ai-ui';\nimport { useEffect } from 'react';\nimport { useTranslation } from 'react-i18next';\n\n// src/components/backend-ai-common-utils.ts\nexport const passwordPattern = /^(?=.*\\d)(?=.*[a-zA-Z])(?=.*[_\\W]).{8,}$/;\n\nconst ResetPasswordRequired = () => {\n  const { value, dispatchEvent } = useWebComponentInfo();\n  let parsedValue: {\n    open: boolean;\n    currentPassword: string;\n    username: string;\n    api_endpoint: string;\n  };\n  try {\n    parsedValue = JSON.parse(value || '');\n  } catch (error) {\n    parsedValue = {\n      open: false,\n      currentPassword: '',\n      username: '',\n      api_endpoint: '',\n    };\n  }\n  const { open, currentPassword, username, api_endpoint } = parsedValue;\n\n  const { token } = theme.useToken();\n  const [form] = Form.useForm<{\n    newPassword: string;\n    confirm: string;\n  }>();\n  const { t } = useTranslation();\n\n  useEffect(() => {\n    if (open) {\n      form.resetFields();\n    }\n  }, [open, form]);\n\n  const anonymousBaiClient = useAnonymousBackendaiClient({ api_endpoint });\n\n  const mutation = useTanMutation({\n    mutationFn: (body: {\n      username: string;\n      current_password: string;\n      new_password: string;\n    }) => {\n      return baiSignedRequestWithPromise({\n        method: 'POST',\n        url: '/server/update-password-no-auth',\n        body,\n        client: anonymousBaiClient,\n      });\n    },\n  });\n\n  const onSubmit = () => {\n    form.validateFields().then((values) => {\n      mutation.mutate(\n        {\n          username: username,\n          current_password: currentPassword,\n          new_password: values.newPassword,\n        },\n        {\n          onSuccess() {\n            dispatchEvent('ok', null);\n          },\n          onError() {},\n        },\n      );\n    });\n  };\n\n  return (\n    <Modal\n      open={open}\n      centered\n      mask={false}\n      onCancel={() => {\n        dispatchEvent('cancel', null);\n      }}\n      keyboard={false}\n      maskClosable={false}\n      footer={null}\n      width={450}\n      destroyOnHidden={true}\n      forceRender\n    >\n      <BAIFlex\n        direction=\"column\"\n        justify=\"start\"\n        align=\"stretch\"\n        gap={'md'}\n        style={{\n          alignSelf: 'stretch',\n          paddingTop: token.paddingMD,\n          paddingBottom: token.paddingMD,\n        }}\n      >\n        <Typography.Title level={3} style={{ margin: 0 }}>\n          <WarningTwoTone twoToneColor={token.colorWarning} />{' '}\n          {t('webui.menu.PleaseChangeYourPassword')}\n        </Typography.Title>\n        {t('webui.menu.YouMushChangeYourPassword')}\n        <Form\n          form={form}\n          layout=\"vertical\"\n          initialValues={{\n            currentPassword: currentPassword,\n          }}\n          disabled={mutation.isPending}\n        >\n          <Form.Item\n            name=\"newPassword\"\n            label={t('webui.menu.NewPassword')}\n            rules={[\n              {\n                required: true,\n              },\n              {\n                pattern: passwordPattern,\n                message: t('webui.menu.InvalidPasswordMessage').toString(),\n              },\n              () => ({\n                validator(_, value) {\n                  if (currentPassword === value) {\n                    return Promise.reject(\n                      new Error(\n                        t('webui.menu.NewPasswordCannotBeSame').toString(),\n                      ),\n                    );\n                  }\n                  return Promise.resolve();\n                },\n              }),\n            ]}\n            hasFeedback\n          >\n            <Input.Password />\n          </Form.Item>\n\n          <Form.Item\n            name=\"confirm\"\n            label={t('webui.menu.NewPasswordAgain')}\n            dependencies={['newPassword']}\n            hasFeedback\n            rules={[\n              {\n                required: true,\n              },\n              ({ getFieldValue }) => ({\n                validator(_, value) {\n                  if (!value || getFieldValue('newPassword') === value) {\n                    return Promise.resolve();\n                  }\n                  return Promise.reject(\n                    new Error(t('environment.PasswordsDoNotMatch').toString()),\n                  );\n                },\n              }),\n            ]}\n          >\n            <Input.Password onPressEnter={onSubmit} />\n          </Form.Item>\n        </Form>\n        <Button type=\"primary\" onClick={onSubmit} loading={mutation.isPending}>\n          {t('webui.menu.Update')}\n        </Button>\n      </BAIFlex>\n    </Modal>\n  );\n};\n\nexport default ResetPasswordRequired;\n"],"names":["_ref","onRequestClose","onRequestRefresh","isRefreshModalPending","totpSupported","queryRef","baiModalProps","_objectWithoutProperties","_excluded","t","useTranslation","formRef","useRef","messageApi","contextHolder","message","useMessage","modal","modalContextHolder","Modal","useModal","isOpenTOTPActivateModal","toggle","toggleTOTPActivateModal","useToggle","baiClient","useSuspendedBackendaiClient","userRole","useCurrentUserRole","userInfo","userMutations","useCurrentUserInfo","getErrorMessage","useErrorMessageResolver","user","usePreloadedQuery","UserProfileQuery","mutationToRemoveTotp","useTanMutation","mutationFn","remove_totp","_jsxs","_Fragment","children","BAIModal","_objectSpread","okText","cancelText","onCancel","confirmLoading","isPendingMutation","onOk","onSubmit","_formRef$current","current","validateFields","then","values","updateFullName","full_name","onSuccess","newFullName","open","type","content","newPassword","newPasswordConfirm","originalPassword","updatePassword","new_password","new_password2","old_password","onError","e","catch","centered","destroyOnHidden","title","_jsx","Spin","spinning","indicator","LoadingOutlined","Form","ref","layout","initialValues","totp_activated","preserve","Item","name","label","rules","validator","_","value","length","Promise","resolve","reject","Error","Input","_ref2","getFieldValue","dependencies","Password","pattern","undefined","passwordPattern","_ref3","valuePropName","Switch","loading","isPending","onChange","checked","_formRef$current2","setFieldValue","confirm","icon","ExclamationCircleFilled","okType","mutate","_formRef$current3","success","error","_formRef$current4","TOTPActivateModal","userFrgmt","_formRef$current5","primaryColor","secondaryColor","WarningTwoTone","props","React","AntdIcon","_extends","WarningTwoToneSvg","ResetPasswordRequired","dispatchEvent","useWebComponentInfo","parsedValue","JSON","parse","currentPassword","username","api_endpoint","token","theme","useToken","form","useForm","useEffect","resetFields","anonymousBaiClient","useAnonymousBackendaiClient","mutation","body","baiSignedRequestWithPromise","method","url","client","current_password","mask","keyboard","maskClosable","footer","width","forceRender","BAIFlex","direction","justify","align","gap","style","alignSelf","paddingTop","paddingMD","paddingBottom","Typography","Title","level","margin","twoToneColor","colorWarning","disabled","required","toString","hasFeedback","onPressEnter","Button","onClick"],"ignoreList":[],"sourceRoot":""}