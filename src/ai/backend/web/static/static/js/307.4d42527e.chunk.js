"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[307],{34680:(e,n,l)=>{l.d(n,{A:()=>p});var a=l(25339),i=l(62863),t=l(50840),r=l(65080),s=l(82028),o=l(87627),d=l(45901),u=l.n(d),c=l(76998),m=l(77678),g=l(23446);const p=e=>{let{open:n,onRequestClose:l,columns:d,displayedColumnKeys:p,...y}=e;const k=(0,c.useRef)(null),{t:v}=(0,m.Bd)(),{token:S}=t.A.useToken(),_=d.map((e=>{return"string"===typeof e.title?{label:e.title,value:u().toString(e.key)}:"object"===typeof e.title&&"props"in e.title?{label:(n=e.title,c.Children.map(n.props.children,(e=>{if("string"===typeof e)return e}))),value:u().toString(e.key)}:{label:void 0,value:u().toString(e.key)};var n}));return(0,g.jsx)(a.A,{title:v("table.SettingTable"),open:n,destroyOnClose:!0,centered:!0,onOk:()=>{var e;null===(e=k.current)||void 0===e||e.validateFields().then((e=>{l(e)})).catch((()=>{}))},onCancel:()=>{l()},...y,children:(0,g.jsxs)(r.A,{ref:k,preserve:!1,initialValues:{selectedColumnKeys:p||_.map((e=>e.value))},layout:"vertical",children:[(0,g.jsx)(r.A.Item,{name:"searchInput",label:v("table.SelectColumnToDisplay"),style:{marginBottom:0},children:(0,g.jsx)(s.A,{prefix:(0,g.jsx)(i.A,{}),style:{marginBottom:S.marginSM},placeholder:v("table.SearchTableColumn")})}),(0,g.jsx)(r.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>e.searchInput!==n.searchInput,children:e=>{let{getFieldValue:n}=e;const l=n("searchInput")?u().toLower(n("searchInput")):void 0,a=_.map((e=>u().toLower(u().toString(e.label)).includes(l||"")?e:{...e,style:{display:"none"}}));return(0,g.jsx)(r.A.Item,{name:"selectedColumnKeys",style:{height:220,overflowY:"auto"},children:(0,g.jsx)(o.A.Group,{options:a,style:{flexDirection:"column"}})})}})]})})}},61307:(e,n,l)=>{l.r(n),l.d(n,{default:()=>q});var a=l(25339),i=l(44520),t=l(73819),r=l(29871),s=l(58218),o=l(34680),d=l(30032),u=l(83468),c=l(57857),m=l(63718),g=l(97041),p=l(187),y=l(57277),k=l(76998),v=l(21112),S=l(32693);var _=function(e){if(e.id,"undefined"===typeof cancelAnimationFrame)return clearInterval(e.id);cancelAnimationFrame(e.id)};const f=function(e,n,l){var a=null===l||void 0===l?void 0:l.immediate,i=(0,v.A)(e),t=(0,k.useRef)();return(0,k.useEffect)((function(){if((0,S.Et)(n)&&!(n<0))return a&&i.current(),t.current=function(e,n){if(void 0===n&&(n=0),"undefined"===typeof requestAnimationFrame)return{id:setInterval(e,n)};var l=(new Date).getTime(),a={id:0},i=function(){(new Date).getTime()-l>=n&&(e(),l=(new Date).getTime()),a.id=requestAnimationFrame(i)};return a.id=requestAnimationFrame(i),a}((function(){i.current()}),n),function(){t.current&&_(t.current)}}),[n]),(0,k.useCallback)((function(){t.current&&_(t.current)}),[])};var h,F=l(65988),x=l(50840),A=l(13279),K=l(6932),b=l(29475),j=l(14862),L=l(24717),T=l(14455),C=l.n(T),I=l(45901),w=l.n(I),E=l(77678),D=l(3606),z=l(98322),R=l(23446);const q=e=>{let{children:n}=e;const{t:v}=(0,E.Bd)(),S=(0,u.CX)(),{token:_}=x.A.useToken(),T=(0,u.hd)(),[I,q]=(0,k.useState)(!1),[O,P]=(0,k.useState)(!1),[V,N]=(0,k.useState)(null),[B,H]=(0,k.useState)(null),[M]=(0,k.useState)({current:1,pageSize:100}),[Q,$]=(0,k.useTransition)(),[Y,U]=(0,k.useState)(!1),[X,W]=(0,u.Tw)("initial-fetch"),[G]=(0,k.useState)("services"),J=[{title:v("modelService.EndpointName"),dataIndex:"endpoint_id",key:"endpointName",fixed:"left",render:(e,n)=>(0,R.jsx)(z.N_,{to:"/serving/"+e,children:n.name})},{title:v("modelService.EndpointId"),dataIndex:"endpoint_id",key:"endpoint_id",width:310,render:e=>(0,R.jsx)(A.A.Text,{code:!0,children:e})},{title:v("modelService.ServiceEndpoint"),dataIndex:"endpoint_id",key:"url",render:(e,n)=>n.url?(0,R.jsx)(A.A.Link,{copyable:!0,href:n.url,target:"_blank",children:n.url}):"-"},{title:v("modelService.Controls"),dataIndex:"controls",key:"controls",render:(e,n)=>{var l,a,i,t;return(0,R.jsxs)(r.A,{direction:"row",align:"stretch",children:[(0,R.jsx)(K.Ay,{type:"text",icon:(0,R.jsx)(m.A,{}),style:n.desired_session_count<0||"destroying"===(null===(l=n.status)||void 0===l?void 0:l.toLowerCase())?void 0:{color:_.colorInfo},disabled:n.desired_session_count<0||"destroying"===(null===(a=n.status)||void 0===a?void 0:a.toLowerCase()),onClick:()=>{q(!I),N(n)}}),(0,R.jsx)(K.Ay,{type:"text",icon:(0,R.jsx)(g.A,{style:n.desired_session_count<0||"destroying"===(null===(i=n.status)||void 0===i?void 0:i.toLowerCase())?void 0:{color:_.colorError}}),disabled:n.desired_session_count<0||"destroying"===(null===(t=n.status)||void 0===t?void 0:t.toLowerCase()),onClick:()=>{U(!0),H(n)}})]})}},{title:v("modelService.Status"),key:"status",render:(e,n)=>(0,R.jsx)(t.A,{endpointFrgmt:n})},...S.is_admin?[{title:v("modelService.Owner"),dataIndex:"created_user_email",key:"session_owner",render:(e,n)=>(0,R.jsx)(i.A,{endpointFrgmt:n})}]:[],{title:v("modelService.CreatedAt"),dataIndex:"created_at",key:"createdAt",render:e=>C()(e).format("ll LT"),defaultSortOrder:"descend",sortDirections:["descend","ascend","descend"],sorter:(e,n)=>{const l=C()(e.created_at),a=C()(n.created_at);return l.diff(a)}},{title:v("modelService.DesiredSessionCount"),dataIndex:"desired_session_count",key:"desiredSessionCount",render:e=>e<0?"-":e},{title:(0,R.jsxs)(r.A,{direction:"column",align:"start",children:[v("modelService.RoutingsCount"),(0,R.jsx)("br",{}),(0,R.jsxs)(A.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",v("modelService.Active/Total"),")"]})]}),key:"routingCount",render:(e,n)=>{var l;return w().filter(n.routings,(e=>"HEALTHY"===(null===e||void 0===e?void 0:e.status))).length+" / "+(null===(l=n.routings)||void 0===l?void 0:l.length)}},{title:v("modelService.Public"),key:"public",render:(e,n)=>n.open_to_public?(0,R.jsx)(p.A,{style:{color:_.colorSuccess}}):(0,R.jsx)(y.A,{style:{color:_.colorTextSecondary}})}],[Z,ee]=(0,F.A)("backendaiwebui.ServingListPage.displayedColumnKeys",{defaultValue:J.map((e=>w().toString(e.key)))});f((()=>{(0,k.startTransition)((()=>{W()}))}),7e3);const{endpoint_list:ne}=(0,D.useLazyLoadQuery)(void 0!==h?h:h=l(12346),{offset:(M.current-1)*M.pageSize,limit:M.pageSize,projectID:T.id},{fetchPolicy:"initial-fetch"===X?"store-and-network":"network-only",fetchKey:X}),le=w().sortBy(null===ne||void 0===ne?void 0:ne.items,"name"),ae=(0,c.E)({mutationFn:e=>(0,d.hu)({method:"DELETE",url:"/services/"+e,client:S})});return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(r.A,{direction:"column",align:"stretch",gap:"xs",children:(0,R.jsx)(r.A,{direction:"column",align:"stretch",children:(0,R.jsx)(b.A,{tabList:[{key:"services",label:v("modelService.Services")}],activeTabKey:G,tabBarExtraContent:(0,R.jsx)(K.Ay,{type:"primary",onClick:()=>{q(!0)},children:v("modelService.StartService")}),styles:{body:{padding:0,paddingTop:1}},children:(0,R.jsxs)(k.Suspense,{fallback:(0,R.jsx)("div",{children:"loading.."}),children:[(0,R.jsx)(j.A,{loading:Q,scroll:{x:"max-content"},rowKey:"endpoint_id",dataSource:le||[],columns:J.filter((e=>null===Z||void 0===Z?void 0:Z.includes(w().toString(e.key))))}),(0,R.jsx)(r.A,{justify:"end",style:{padding:_.paddingXXS},children:(0,R.jsx)(K.Ay,{type:"text",icon:(0,R.jsx)(m.A,{}),onClick:()=>{P(!0)}})})]})})})}),(0,R.jsx)(a.A,{open:Y,title:v("dialog.title.LetsDouble-Check"),okButtonProps:{loading:ae.isLoading},onOk:()=>{ae.mutate((null===B||void 0===B?void 0:B.endpoint_id)||"",{onSuccess:e=>{$((()=>{W()})),U(!Y),L.Ay.success(v("modelService.ServiceTerminated",{name:null===B||void 0===B?void 0:B.name}))},onError:e=>{console.log(e),L.Ay.error(v("modelService.FailedToTerminateService"))}})},onCancel:()=>{U(!Y)},children:(0,R.jsxs)(r.A,{direction:"column",align:"stretch",justify:"center",children:[(0,R.jsx)("p",{children:v("modelService.YouAreAboutToTerminate")+((null===B||void 0===B?void 0:B.name)||"")+"."}),(0,R.jsx)("p",{children:v("dialog.ask.DoYouWantToProceed")})]})}),(0,R.jsx)(s.A,{open:I,endpointFrgmt:V||null,onCancel:()=>{N(null),q(!I)},onRequestClose:e=>{q(!I),e&&$((()=>{W()}))}}),(0,R.jsx)(o.A,{open:O,onRequestClose:e=>{(null===e||void 0===e?void 0:e.selectedColumnKeys)&&ee(null===e||void 0===e?void 0:e.selectedColumnKeys),P(!O)},columns:J,displayedColumnKeys:Z||[]})]})}},12346:(e,n,l)=>{l.r(n),l.d(n,{default:()=>i});const a=function(){var e={defaultValue:null,kind:"LocalArgument",name:"limit"},n={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"projectID"},a=[{kind:"Literal",name:"filter",value:"name != 'koalpaca-test'"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"project",variableName:"projectID"}],i={alias:null,args:null,kind:"ScalarField",name:"total_count",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"endpoint_id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"model",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"domain",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"project",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"resource_group",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"open_to_public",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"desired_session_count",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"routing_id",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"endpoint",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"session",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"traffic_ratio",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},F={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null};return{fragment:{argumentDefinitions:[e,n,l],kind:"Fragment",metadata:null,name:"ServingListPageQuery",selections:[{alias:null,args:a,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[i,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[t,r,s,o,d,u,c,m,g,p,y,{kind:"RequiredField",field:k,action:"NONE",path:"endpoint_list.items.desired_session_count"},{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[v,S,_,f,d],storageKey:null},{args:null,kind:"FragmentSpread",name:"ServiceLauncherModalFragment"},{args:null,kind:"FragmentSpread",name:"EndpointOwnerInfoFragment"},{args:null,kind:"FragmentSpread",name:"EndpointStatusTagFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e,l],kind:"Operation",name:"ServingListPageQuery",selections:[{alias:null,args:a,concreteType:"EndpointList",kind:"LinkedField",name:"endpoint_list",plural:!1,selections:[i,{alias:null,args:null,concreteType:"Endpoint",kind:"LinkedField",name:"items",plural:!0,selections:[t,r,s,o,d,u,c,m,g,p,y,k,{alias:null,args:null,concreteType:"Routing",kind:"LinkedField",name:"routings",plural:!0,selections:[v,S,_,f,d,h],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null},{alias:null,args:null,concreteType:"ImageNode",kind:"LinkedField",name:"image_object",plural:!1,selections:[t,{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_local",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[F,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[F,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"size_bytes",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"supported_accelerators",storageKey:null},h],storageKey:null},h,{alias:null,args:null,kind:"ScalarField",name:"created_user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_owner_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"6962d5d48c0c3c0c478cfeeaae1f63e7",id:null,metadata:{},name:"ServingListPageQuery",operationKind:"query",text:'query ServingListPageQuery(\n  $offset: Int!\n  $limit: Int!\n  $projectID: UUID\n) {\n  endpoint_list(offset: $offset, limit: $limit, project: $projectID, filter: "name != \'koalpaca-test\'") {\n    total_count\n    items {\n      name\n      endpoint_id\n      model\n      domain\n      status\n      project\n      resource_group\n      resource_slots\n      url\n      open_to_public\n      created_at @since(version: "23.09.0")\n      desired_session_count\n      routings {\n        routing_id\n        endpoint\n        session\n        traffic_ratio\n        status\n        id\n      }\n      ...ServiceLauncherModalFragment\n      ...EndpointOwnerInfoFragment\n      ...EndpointStatusTagFragment\n      id\n    }\n  }\n}\n\nfragment EndpointOwnerInfoFragment on Endpoint {\n  id\n  created_user_email @since(version: "23.09.8")\n  session_owner_email @since(version: "23.09.8")\n}\n\nfragment EndpointStatusTagFragment on Endpoint {\n  id\n  status\n}\n\nfragment ServiceLauncherModalFragment on Endpoint {\n  endpoint_id\n  desired_session_count\n  resource_group\n  resource_slots\n  resource_opts\n  cluster_mode\n  cluster_size\n  open_to_public\n  model\n  image_object @since(version: "23.09.9") {\n    name\n    humanized_name\n    tag\n    registry\n    architecture\n    is_local\n    digest\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n    size_bytes\n    supported_accelerators\n    id\n  }\n  name\n}\n'}}}();a.hash="99a738a4bb1e6636dd1f5f78e9828377";const i=a},97041:(e,n,l)=>{l.d(n,{A:()=>o});var a=l(58168),i=l(76998);const t={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]},name:"delete",theme:"outlined"};var r=l(76228),s=function(e,n){return i.createElement(r.A,(0,a.A)({},e,{ref:n,icon:t}))};const o=i.forwardRef(s)}}]);
//# sourceMappingURL=307.4d42527e.chunk.js.map