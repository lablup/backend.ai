"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[57],{57381:(e,n,l)=>{l.d(n,{f:()=>u});const s=function(){var e={defaultValue:null,kind:"LocalArgument",name:"filter"},n={defaultValue:null,kind:"LocalArgument",name:"projectId"},l=[{alias:null,args:[{kind:"Variable",name:"filter",variableName:"filter"},{kind:"Variable",name:"project_id",variableName:"projectId"}],concreteType:"ComputeSessionConnection",kind:"LinkedField",name:"compute_session_nodes",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"count",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[e,n],kind:"Fragment",metadata:null,name:"useValidateSessionNameQuery",selections:l,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[n,e],kind:"Operation",name:"useValidateSessionNameQuery",selections:l},params:{cacheID:"2392cc957c8d4e1b5ff8eb0717faa135",id:null,metadata:{},name:"useValidateSessionNameQuery",operationKind:"query",text:"query useValidateSessionNameQuery(\n  $projectId: UUID!\n  $filter: String\n) {\n  compute_session_nodes(project_id: $projectId, filter: $filter) {\n    count\n  }\n}\n"}}}();s.hash="4384b91173f16b29861a6bb9cfa6cbfa";const t=s;var i=l(81109),a=l(47699),r=l.n(a),o=l(17534),d=l(62962),c=l(46336);const u=e=>{const{t:n}=(0,d.Bd)(),l=(0,c.useRelayEnvironment)(),s=(0,i.hd)();return(0,o.useMemo)((()=>[{min:4,message:n("session.validation.SessionNameTooShort")},{max:64,message:n("session.validation.SessionNameTooLong64")},{validator:(e,l)=>r().isEmpty(l)?Promise.resolve():/^\w/.test(l)?/\w$/.test(l)?/^[\w.-]*$/.test(l)?Promise.resolve():Promise.reject(n("session.validation.SessionNameInvalidCharacter")):Promise.reject(n("session.validation.SessionNameShouldEndWith")):Promise.reject(n("session.validation.SessionNameShouldStartWith"))},{validator:async(i,a)=>a!==e&&a?(0,c.fetchQuery)(l,t,{projectId:s.id,filter:'status != "TERMINATED" & status != "CANCELLED" & name == "'.concat(a,'"')}).toPromise().catch((()=>{})).then((e=>{var l,s;if((null!==(l=null===e||void 0===e||null===(s=e.compute_session_nodes)||void 0===s?void 0:s.count)&&void 0!==l?l:0)>0)return Promise.reject(n("session.launcher.SessionAlreadyExists"))})):Promise.resolve()},e?{required:!0}:{}]),[e,l,s.id,n])}},78427:(e,n,l)=>{l.d(n,{A:()=>d});var s=l(56276),t=l(11863),i=l(94010),a=l(17534),r=l(89374);const o=["value"],d=e=>{let{value:n}=e,l=(0,t.A)(e,o);const d=i.A.useFormInstance();return(0,a.useEffect)((()=>{d.setFieldValue(l.name,n)}),[n,d,l.name]),(0,r.jsx)(i.A.Item,(0,s.A)((0,s.A)({},l),{},{hidden:!0,children:(0,r.jsx)("div",{})}))}},88591:(e,n,l)=>{l.d(n,{A:()=>g});var s=l(56276),t=l(11863),i=l(92957),a=l(56270),r=l(8905),o=l.n(r),d=l(47699),c=l.n(d),u=l(17534),m=l(89374);const h=["value","onChange","localFormat"],p=u.forwardRef(((e,n)=>{let{value:l,onChange:r,localFormat:d}=e,u=(0,t.A)(e,h);const[,p]=(0,i.A)({value:l,onChange:r});return(0,m.jsx)(a.A,(0,s.A)({ref:n,value:l?o()(l):void 0,onChange:e=>{var n,l,s;c().isArray(e)&&(e=e[0]);const t=d?null===(n=e)||void 0===n?void 0:n.format():null===(l=e)||void 0===l||null===(s=l.tz())||void 0===s?void 0:s.toISOString();p(t)}},u))}));p.displayName="DatePickerISO";const g=p},90057:(e,n,l)=>{l.r(n),l.d(n,{ResourceNumbersOfSession:()=>Re,default:()=>Le});var s=l(56276),t=l(23590),i=l(88591),a=l(52038),r=l(15621),o=l(68962),d=l(47990),c=l(42159),u=l(85653),m=l(11863),h=l(10979),p=l(40393),g=l(17534),v=l(62962),x=l(89374);const A=["open","onClose"],j=e=>{let{open:n,onClose:l}=e,t=(0,m.A)(e,A);const{t:i}=(0,v.Bd)(),[a,r]=(0,h.q)("has_opened_tour_neo_session_validation"),o=[{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.FixErrorFieldByModifyButton"),target:()=>{var e,n;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e||null===(n=e[0])||void 0===n?void 0:n.querySelector(".ant-card-extra")}},{title:i("tourGuide.neoSessionLauncher.ValidationErrorTitle"),description:i("tourGuide.neoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,x.jsx)(p.A,(0,s.A)({steps:o,onClose:e=>{null===l||void 0===l||l(e),r(!0)},open:!a&&n},t))};var y=l(94010),b=l(66597),F=l(47699),f=l.n(F);const w=e=>{let{form:n}=e;const l=y.A.useWatch("mounts",n),s=b.A.useApp(),{t:t}=(0,v.Bd)(),i=(0,g.useMemo)((()=>f().isArray(l)&&l.length>0),[l]);return(0,g.useEffect)((()=>{i&&(s.message.warning(t("session.launcher.InvalidMountsSelectionWarning"),5),n.setFieldValue("mounts",void 0))}),[i,t,s.message,n]),null};var S=l(48880),k=l(40690),V=l(81109),O=l(41442),E=l(90679),T=l(2289),I=l(93304);const N=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"}],n=[{kind:"Variable",name:"email",variableName:"email"}],l={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},i={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},t],storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[l],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[s,i],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"SessionOwnerSetterCardQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypairs",plural:!0,selections:[l,t],storageKey:null},{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[s,i,t],storageKey:null}]},params:{cacheID:"a8de553c14d6730a6825cba2f409be0d",id:null,metadata:{},name:"SessionOwnerSetterCardQuery",operationKind:"query",text:"query SessionOwnerSetterCardQuery(\n  $email: String!\n) {\n  keypairs(email: $email) {\n    access_key\n    id\n  }\n  user(email: $email) {\n    domain_name\n    groups {\n      name\n      id\n    }\n    id\n  }\n}\n"}}}();N.hash="ba086835ea654ab889e0e6aaefa0abfe";const C=N;var _=l(72828),D=l(62378),B=l(78427),P=l(33243),M=l(76591),z=l(99901),R=l(60186),L=l(90711),q=l(8343),K=l(96677),U=l(33651),G=l(30782),W=l(94824),H=l(67631),Q=l(48720),J=l(46336);const $=e=>{const{t:n}=(0,v.Bd)(),l=y.A.useFormInstance(),t=y.A.useWatch(["owner","enabled"],l),i=(0,_.Am)();return("admin"===i||"superadmin"===i)&&t&&(0,x.jsx)(H.Zu,(0,s.A)((0,s.A)({title:n("session.launcher.SetSessionOwner"),showDivider:!0,size:"small",status:l.getFieldError(["owner","email"]).length>0||l.getFieldError(["owner","accesskey"]).length>0||l.getFieldError(["owner","project"]).length>0||l.getFieldError(["owner","resourceGroup"]).length>0?"error":void 0,extraButtonTitle:n("button.Edit")},e),{},{children:(0,x.jsxs)(W.A,{size:"small",column:1,children:[(0,x.jsx)(W.A.Item,{label:n("session.launcher.OwnerEmail"),children:l.getFieldValue(["owner","email"])}),(0,x.jsx)(W.A.Item,{label:n("session.launcher.OwnerAccessKey"),children:l.getFieldValue(["owner","accesskey"])}),(0,x.jsx)(W.A.Item,{label:n("session.launcher.OwnerGroup"),children:l.getFieldValue(["owner","project"])}),(0,x.jsx)(W.A.Item,{label:n("session.launcher.OwnerResourceGroup"),children:l.getFieldValue(["owner","resourceGroup"])})]})}))},Z=e=>{const{t:n}=(0,v.Bd)(),{token:l}=M.A.useToken(),t=y.A.useFormInstance(),i=y.A.useWatch(["owner","enabled"],t),[a,r]=(0,g.useState)(),o=(0,J.useRelayEnvironment)(),{data:d,isFetching:c}=(0,D.nN)({queryKey:["SessionOwnerSetterCard","ownerInfo",a],queryFn:()=>{const e=t.getFieldValue(["owner","email"]);if(!e)return;const n=C;return(0,J.fetchQuery)(o,n,{email:e}).toPromise()},enabled:!!a}),u=t.getFieldValue(["owner","email"])?null===d||void 0===d?void 0:d.keypairs:void 0,m=t.getFieldValue(["owner","email"])?null===d||void 0===d?void 0:d.user:void 0,h=!c&&a&&!m;return(0,x.jsxs)(z.A,(0,s.A)((0,s.A)({title:n("session.launcher.SetSessionOwner"),extra:(0,x.jsx)(y.A.Item,{name:["owner","enabled"],valuePropName:"checked",noStyle:!0,children:(0,x.jsx)(R.A,{})}),styles:i?void 0:{header:{borderBottom:"none"},body:{display:i?"block":"none"}}},e),{},{children:[(0,x.jsx)(B.A,{name:["owner","domainName"],value:null===m||void 0===m?void 0:m.domain_name}),(0,x.jsx)(y.A.Item,{dependencies:[["owner","enabled"]],noStyle:!0,children:e=>{let{getFieldValue:s}=e;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(H.OO,{children:(0,x.jsx)(y.A.Item,{name:["owner","email"],label:n("session.launcher.OwnerEmail"),rules:[{required:i},{type:"email",message:n("general.validation.InvalidEmailAddress")}],style:{flex:1},validateStatus:h?"error":void 0,help:h?n("credential.NoUserToDisplay"):void 0,children:(0,x.jsx)(L.A.Search,{onSearch:e=>{t.validateFields([["owner","email"]]).then((()=>{r(e)})).catch((()=>{}))},onChange:()=>{r(""),t.setFieldsValue({owner:{accesskey:"",project:void 0,resourceGroup:void 0}})},loading:c,enterButton:!c&&m?(0,x.jsx)(q.Ay,{icon:(0,x.jsx)(Q.A,{})}):void 0})})}),(0,x.jsx)(y.A.Item,{name:["owner","accesskey"],label:n("session.launcher.OwnerAccessKey"),rules:[{required:s(["owner","enabled"])}],children:(0,x.jsx)(H.xr,{options:f().map(u,(e=>({label:null===e||void 0===e?void 0:e.access_key,value:null===e||void 0===e?void 0:e.access_key}))),autoSelectOption:!0,disabled:f().isEmpty(a)||c})}),(0,x.jsxs)(K.A,{gutter:l.marginSM,children:[(0,x.jsx)(U.A,{span:12,children:(0,x.jsx)(y.A.Item,{name:["owner","project"],label:n("session.launcher.OwnerGroup"),rules:[{required:s(["owner","enabled"])}],children:(0,x.jsx)(H.xr,{options:f().map(null===m||void 0===m?void 0:m.groups,(e=>({label:null===e||void 0===e?void 0:e.name,value:null===e||void 0===e?void 0:e.name}))),autoSelectOption:!0,disabled:f().isEmpty(a)||c})})}),(0,x.jsx)(U.A,{span:12,children:(0,x.jsx)(y.A.Item,{dependencies:[["owner","project"]],noStyle:!0,children:e=>{let{getFieldValue:l}=e;return(0,x.jsx)(g.Suspense,{fallback:(0,x.jsx)(y.A.Item,{label:n("session.launcher.OwnerResourceGroup"),rules:[{required:l(["owner","enabled"])}],children:(0,x.jsx)(G.A,{loading:!0})}),children:(0,x.jsx)(y.A.Item,{name:["owner","resourceGroup"],label:n("session.launcher.OwnerResourceGroup"),rules:[{required:l(["owner","enabled"])}],children:l(["owner","project"])?(0,x.jsx)(P.A,{projectName:l(["owner","project"]),disabled:f().isEmpty(a)||c,autoSelectDefault:!0}):(0,x.jsx)(G.A,{disabled:!0})})})}})})]})]})}})]}))};var X=l(68e3),Y=l(96223),ee=l(72245),ne=l(42338),le=l(31035),se=l(8034),te=l(8905),ie=l.n(te);const ae=e=>{var n,l,s,t,i,a,r,o,c,u,m,h,p,g,A,j,F,w,N,C,_,D,B,P,R,L,G,Q,J,Z,te,ae,re,oe,de,ce;let{onClickEditStep:ue}=e;const me=b.A.useApp(),{t:he}=(0,v.Bd)(),pe=y.A.useFormInstance(),{token:ge}=M.A.useToken(),ve=(0,k.CX)(),xe=y.A.useWatch("sessionType",{form:pe,preserve:!0}),Ae=null!==(n=null===ve||void 0===ve?void 0:ve.supports("batch-timeout"))&&void 0!==n&&n,je=null!==(l=null===ve||void 0===ve?void 0:ve.supports("extended-image-info"))&&void 0!==l&&l,ye=(0,V.hd)(),[,{getBaseVersion:be,getBaseImage:Fe,tagAlias:fe}]=(0,k.Gj)();return(0,x.jsxs)(x.Fragment,{children:[pe.getFieldValue("bootstrap_script")&&(0,x.jsx)(O.A,{description:he("session.launcher.UsingBootstrapScriptInfo"),ghostInfoBg:!1,action:(0,x.jsx)(q.Ay,{size:"small",type:"text",onClick:()=>{me.modal.info({title:he("session.launcher.BootstrapScriptDetail"),content:(0,x.jsxs)(H.OO,{direction:"column",align:"start",children:[(0,x.jsx)(Y.A.Paragraph,{children:he("userSettings.BootstrapScriptDescription")}),(0,x.jsx)(X.A,{wordWrap:!0,language:"shell",children:pe.getFieldValue("bootstrap_script")})]}),width:800})},children:he("notification.SeeDetail")}),type:"info",showIcon:!0}),(0,x.jsx)(H.Zu,{title:he("session.launcher.SessionType"),showDivider:!0,size:"small",status:pe.getFieldError("sessionName").length>0||pe.getFieldError(["batch","command"]).length>0||pe.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{ue("sessionType")},children:(0,x.jsxs)(W.A,{size:"small",column:1,children:[(0,x.jsx)(W.A.Item,{label:he("session.SessionType"),children:pe.getFieldValue("sessionType")}),!f().isEmpty(pe.getFieldValue("sessionName"))&&(0,x.jsx)(W.A.Item,{label:he("session.launcher.SessionName"),children:pe.getFieldValue("sessionName")}),"batch"===xe&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(W.A.Item,{label:he("session.launcher.StartUpCommand"),styles:{label:{whiteSpace:"nowrap"},content:{overflow:"auto"}},children:pe.getFieldValue(["batch","command"])?(0,x.jsx)(X.A,{language:"shell",children:pe.getFieldValue(["batch","command"])}):(0,x.jsx)(Y.A.Text,{type:"secondary",children:he("general.None")})}),(0,x.jsx)(W.A.Item,{label:he("session.launcher.SessionStartTime"),children:pe.getFieldValue(["batch","scheduleDate"])?ie()(pe.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,x.jsx)(Y.A.Text,{type:"secondary",children:he("general.None")})}),Ae?(0,x.jsx)(W.A.Item,{label:he("session.launcher.BatchJobTimeoutDuration"),children:pe.getFieldValue(["batch","timeout"])?(0,x.jsxs)(Y.A.Text,{children:[pe.getFieldValue(["batch","timeout"]),pe.getFieldValue(["batch","timeoutUnit"])||"s"]}):(0,x.jsx)(Y.A.Text,{type:"secondary",children:he("general.None")})}):null]})]})}),(0,x.jsx)($,{onClickExtraButton:()=>{ue("sessionType")}}),(0,x.jsx)(H.Zu,{title:he("session.launcher.Environments"),showDivider:!0,size:"small",status:f().some(pe.getFieldValue("envvars"),((e,n)=>pe.getFieldError(["envvars",n,"variable"]).length>0||pe.getFieldError(["envvars",n,"value"]).length>0))?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{ue("environment")},children:(0,x.jsxs)(W.A,{size:"small",column:1,children:[(0,x.jsx)(W.A.Item,{label:he("session.launcher.Project"),children:ye.name}),(0,x.jsx)(W.A.Item,{label:he("general.Image"),children:je?(0,x.jsxs)(K.A,{style:{flexFlow:"nowrap"},children:[(0,x.jsx)(U.A,{children:(0,x.jsx)(T.A,{image:(null===(s=pe.getFieldValue("environments"))||void 0===s?void 0:s.version)||(null===(t=pe.getFieldValue("environments"))||void 0===t?void 0:t.manual),style:{marginRight:ge.marginXS}})}),(0,x.jsx)(U.A,{children:(0,x.jsx)(H.OO,{direction:"row",wrap:"wrap",children:null!==(i=pe.getFieldValue("environments"))&&void 0!==i&&i.manual?(0,x.jsx)(Y.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(a=pe.getFieldValue("environments"))||void 0===a?void 0:a.manual},children:null===(r=pe.getFieldValue("environments"))||void 0===r?void 0:r.manual}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(Y.A.Text,{children:fe(null===(o=pe.getFieldValue("environments"))||void 0===o||null===(c=o.image)||void 0===c?void 0:c.base_image_name)}),(0,x.jsx)(ee.A,{type:"vertical"}),(0,x.jsx)(Y.A.Text,{children:null===(u=pe.getFieldValue("environments"))||void 0===u||null===(m=u.image)||void 0===m?void 0:m.version}),(0,x.jsx)(ee.A,{type:"vertical"}),(0,x.jsx)(Y.A.Text,{children:null===(h=pe.getFieldValue("environments"))||void 0===h||null===(p=h.image)||void 0===p?void 0:p.architecture}),(0,x.jsx)(ee.A,{type:"vertical"}),f().map(null===(g=pe.getFieldValue("environments"))||void 0===g||null===(A=g.image)||void 0===A?void 0:A.tags,(e=>{var n,l,s;const t=f().includes(e.key,"customized_"),i=t?null===(n=f().find(null===(l=pe.getFieldValue("environments"))||void 0===l||null===(s=l.image)||void 0===s?void 0:s.labels,{key:"ai.backend.customized-image.name"}))||void 0===n?void 0:n.value:e.value,a=fe(e.key+i);return f().isEqual(a,(0,S.WY)(e.key+i))||t?(0,x.jsx)(E.A,{values:[{label:fe(e.key),color:t?"cyan":"blue"},{label:i,color:t?"cyan":"blue"}]},e.key):(0,x.jsx)(ne.A,{color:t?"cyan":"blue",children:a},e.key)})),(0,x.jsx)(Y.A.Text,{style:{color:ge.colorPrimary},copyable:{text:(0,S.A_)(null===(j=pe.getFieldValue("environments"))||void 0===j?void 0:j.image)||(null===(F=pe.getFieldValue("environments"))||void 0===F?void 0:F.version)}})]})})})]}):(0,x.jsxs)(K.A,{style:{flexFlow:"nowrap",gap:ge.sizeXS},children:[(0,x.jsx)(U.A,{children:(0,x.jsx)(T.A,{image:(null===(w=pe.getFieldValue("environments"))||void 0===w?void 0:w.version)||(null===(N=pe.getFieldValue("environments"))||void 0===N?void 0:N.manual)})}),(0,x.jsx)(U.A,{children:(0,x.jsx)(H.OO,{direction:"row",wrap:"wrap",children:null!==(C=pe.getFieldValue("environments"))&&void 0!==C&&C.manual?(0,x.jsx)(Y.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(_=pe.getFieldValue("environments"))||void 0===_?void 0:_.manual},children:null===(D=pe.getFieldValue("environments"))||void 0===D?void 0:D.manual}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(Y.A.Text,{children:fe(Fe(null===(B=pe.getFieldValue("environments"))||void 0===B?void 0:B.version))}),(0,x.jsx)(ee.A,{type:"vertical"}),(0,x.jsx)(Y.A.Text,{children:be(null===(P=pe.getFieldValue("environments"))||void 0===P?void 0:P.version)}),(0,x.jsx)(ee.A,{type:"vertical"}),(0,x.jsx)(Y.A.Text,{children:null===(R=pe.getFieldValue("environments"))||void 0===R||null===(L=R.image)||void 0===L?void 0:L.architecture}),(0,x.jsx)(ee.A,{type:"vertical"}),(0,x.jsx)(I.J,{tag:pe.getFieldValue(["environments","image","tag"]),labels:null===(G=pe.getFieldValue("environments"))||void 0===G||null===(Q=G.image)||void 0===Q?void 0:Q.labels}),(0,x.jsx)(Y.A.Text,{style:{color:ge.colorPrimary},copyable:{text:(0,S.A_)(null===(J=pe.getFieldValue("environments"))||void 0===J?void 0:J.image)||(null===(Z=pe.getFieldValue("environments"))||void 0===Z?void 0:Z.version)}})]})})})]})}),(null===(te=pe.getFieldValue("envvars"))||void 0===te?void 0:te.length)>0&&(0,x.jsx)(W.A.Item,{label:he("session.launcher.EnvironmentVariable"),children:null!==(ae=pe.getFieldValue("envvars"))&&void 0!==ae&&ae.length?(0,x.jsx)(H.OO,{align:"stretch",direction:"column",children:(0,x.jsx)(X.A,{wordWrap:!0,language:"shell",children:f().map(pe.getFieldValue("envvars"),(e=>"".concat((null===e||void 0===e?void 0:e.variable)||"",'="').concat((null===e||void 0===e?void 0:e.value)||"",'"'))).join("\n")})}):(0,x.jsx)(Y.A.Text,{type:"secondary",children:"-"})})]})}),(0,x.jsx)(H.Zu,{title:he("session.launcher.ResourceAllocation"),showDivider:!0,status:f().some(pe.getFieldValue("resource"),((e,n)=>pe.getFieldError(["resource",n]).length>0))||pe.getFieldError(["num_of_sessions"]).length>0||pe.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{ue("environment")},children:(0,x.jsxs)(H.OO,{direction:"column",align:"stretch",children:[f().some(pe.getFieldValue("resource"),((e,n)=>pe.getFieldWarning(["resource",n]).length>0))&&(0,x.jsx)(le.A,{type:"warning",showIcon:!0,message:he("session.launcher.EnqueueComputeSessionWarning")}),(0,x.jsxs)(W.A,{column:2,children:[(0,x.jsx)(W.A.Item,{label:he("general.ResourceGroup"),span:2,children:pe.getFieldValue("resourceGroup")||(0,x.jsx)(Y.A.Text,{type:"secondary",children:he("general.None")})}),(0,x.jsx)(W.A.Item,{label:he("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,x.jsxs)(H.OO,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===pe.getFieldValue("allocationPreset")?"":(0,x.jsx)(ne.A,{children:pe.getFieldValue("allocationPreset")}),(0,x.jsx)(Re,{resource:pe.getFieldValue("resource")})]})}),ve.supports("agent-select")&&!(null!==ve&&void 0!==ve&&null!==(re=ve._config)&&void 0!==re&&re.hideAgents)&&(0,x.jsx)(W.A.Item,{label:he("session.launcher.AgentNode"),children:f().castArray(pe.getFieldValue("agent")).join(", ")||he("session.launcher.AutoSelect")}),(0,x.jsx)(W.A.Item,{label:he("session.launcher.NumberOfContainer"),children:1===pe.getFieldValue("cluster_size")?pe.getFieldValue("num_of_sessions"):pe.getFieldValue("cluster_size")}),(0,x.jsx)(W.A.Item,{label:he("session.launcher.ClusterMode"),children:"single-node"===pe.getFieldValue("cluster_mode")?he("session.launcher.SingleNode"):he("session.launcher.MultiNode")})]}),(0,x.jsx)(z.A,{size:"small",type:"inner",title:he("session.launcher.TotalAllocation"),children:(0,x.jsx)(H.OO,{direction:"row",gap:"xxs",children:(0,x.jsx)(Re,{resource:pe.getFieldValue("resource"),containerCount:1===pe.getFieldValue("cluster_size")?pe.getFieldValue("num_of_sessions"):pe.getFieldValue("cluster_size")})})})]})}),(0,x.jsx)(H.Zu,{title:he("webui.menu.Data&Storage"),showDivider:!0,size:"small",status:pe.getFieldError("mount_id_map").length>0?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{ue("storage")},children:(0,x.jsxs)(H.OO,{direction:"column",align:"stretch",gap:"xs",children:[(null===(oe=pe.getFieldValue("mount_ids"))||void 0===oe?void 0:oe.length)>0?(0,x.jsx)(se.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:he("data.folders.Name")},{dataIndex:"alias",title:he("session.launcher.FolderAlias"),render:(e,n)=>f().isEmpty(e)?(0,x.jsx)(Y.A.Text,{type:"secondary",style:{opacity:.7},children:"/home/work/".concat(n.name)}):e}],dataSource:f().map(pe.getFieldValue("mount_ids"),(e=>{var n,l;return{name:(null===(n=pe.getFieldValue("vfoldersNameMap"))||void 0===n?void 0:n[e])||e,alias:null===(l=pe.getFieldValue("mount_id_map"))||void 0===l?void 0:l[e]}}))}):(0,x.jsx)(le.A,{type:"warning",showIcon:!0,message:he("session.launcher.NoFolderMounted")}),(null===(de=pe.getFieldValue("autoMountedFolderNames"))||void 0===de?void 0:de.length)>0?(0,x.jsx)(W.A,{size:"small",children:(0,x.jsx)(W.A.Item,{label:he("data.AutomountFolders"),children:f().map(pe.getFieldValue("autoMountedFolderNames"),(e=>(0,x.jsx)(ne.A,{children:e})))})}):null]})}),(0,x.jsx)(H.Zu,{title:"Network",showDivider:!0,size:"small",status:pe.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:he("button.Edit"),onClickExtraButton:()=>{ue("network")},children:(0,x.jsx)(W.A,{size:"small",children:(0,x.jsx)(W.A.Item,{label:he("session.launcher.PreOpenPortTitle"),children:(0,x.jsxs)(H.OO,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[f().sortBy(pe.getFieldValue("ports"),(e=>parseInt(e))).map(((e,n)=>(0,x.jsx)(d.uD,{value:e,style:{margin:0},children:e},n+e))),f().isArray(pe.getFieldValue("ports"))&&0!==(null===(ce=pe.getFieldValue("ports"))||void 0===ce?void 0:ce.length)?null:(0,x.jsx)(Y.A.Text,{type:"secondary",children:he("general.None")})]})})})})]})};var re=l(59991),oe=l(57381);const de=e=>{let n=Object.assign({},((0,re.A)(e),e));const{t:l}=(0,v.Bd)(),t=(0,oe.f)();return(0,x.jsx)(y.A.Item,(0,s.A)((0,s.A)({label:l("session.launcher.SessionName"),name:"sessionName",validateDebounce:200,rules:t},n),{},{children:(0,x.jsx)(L.A,{allowClear:!0,autoComplete:"off",count:{max:64,show:!0}})}))};var ce=l(7871),ue=l(69041);const me=()=>{const[e,n]=(0,h.q)("recentSessionHistory"),l=(0,ue.E)((l=>{let{id:s,params:t,createdAt:i,name:a}=l;const r={id:null!==s&&void 0!==s?s:(0,H.kX)(8),params:t,createdAt:null!==i&&void 0!==i?i:(new Date).toISOString(),name:a},o=f().sortBy([r,...e||[]],"-createdAt").slice(0,5);n(o)})),t=(0,ue.E)((()=>n([]))),i=(0,ue.E)((l=>{const s=(e||[]).filter((e=>e.id!==l));n(s)})),a=(0,ue.E)(((l,t)=>{const i=(e||[]).map((e=>e.id===l?(0,s.A)((0,s.A)({},e),{},{name:t}):e));n(i)}));return[e,{push:l,clear:t,remove:i,update:a}]};var he,pe=l(64018),ge=l(20714),ve=l(84791),xe=l(27111);const Ae=(0,ve.rU)((e=>{let{css:n}=e;return{fixEditableVerticalAlign:n(he||(he=(0,ce.A)(["\n    & {\n      margin-top: 0px !important;\n    }\n  "])))}})),je=e=>{let n=Object.assign({},((0,re.A)(e),e));const{t:l}=(0,v.Bd)(),{styles:t}=Ae(),[i,{update:a}]=me(),[r,o]=(0,g.useState)(null),[,{getImageAliasName:d,getBaseVersion:c}]=(0,k.Gj)(),[u,{pin:m,unpin:p,update:A}]=(()=>{const[e,n]=(0,h.q)("pinnedSessionHistory"),[l]=(0,h.q)("recentSessionHistory"),t=(0,ue.E)((s=>{const t=(l||[]).find((e=>e.id===s));t&&n([...e||[],t])})),i=(0,ue.E)((l=>{const s=(e||[]).filter((e=>e.id!==l));n(s)})),a=(0,ue.E)(((l,t)=>{const i=(e||[]).map((e=>e.id===l?(0,s.A)((0,s.A)({},e),{},{name:t}):e));n(i)}));return[e,{pin:t,unpin:i,update:a}]})(),[,j]=(0,g.useState)(),{token:y}=M.A.useToken(),b=(0,g.useMemo)((()=>{const e=(e,n)=>{const l=new URLSearchParams(e.params),t=JSON.parse(l.get("formValues")||"{}");return(0,s.A)((0,s.A)({},t),{},{pinned:n,name:e.name})},n=f().map(i,(n=>(0,s.A)((0,s.A)({},n),e(n,!1)))),l=f().map(u,(n=>(0,s.A)((0,s.A)({},n),e(n,!0))));return f().chain([...l,...n]).unionBy("id").value()}),[i,u]);return(0,x.jsx)(H.Ib,(0,s.A)((0,s.A)({width:800,title:l("session.launcher.RecentHistory"),footer:null,onCancel:()=>{j(void 0),n.onRequestClose()}},n),{},{children:(0,x.jsxs)(H.OO,{direction:"column",align:"stretch",gap:"sm",children:[(0,x.jsx)(Y.A.Text,{children:l("session.launcher.YouCanStartWithHistory")}),(0,x.jsx)(H.zx,{rowSelection:{selectedRowKeys:null===u||void 0===u?void 0:u.map((e=>e.id)),columnWidth:0,hideSelectAll:!0,renderCell:()=>null},scroll:{x:"max-content"},dataSource:b,pagination:!1,onRow:e=>({onMouseEnter:()=>o(e.id),onMouseLeave:()=>o(null)}),rowKey:e=>e.id,columns:[{title:(0,x.jsxs)(H.OO,{gap:"xxs",children:[(0,x.jsx)(xe.A,{}),(0,x.jsx)(pe.A,{title:l("session.launcher.PinnedHistoryTooltip")})]}),dataIndex:"pinned",width:40,render:(e,n)=>{const l=!!n.pinned,s=r===n.id;return l?(0,x.jsx)(q.Ay,{size:"small",onClick:()=>{p(n.id)},type:"link",children:(0,x.jsx)(xe.A,{})}):(0,x.jsx)(q.Ay,{size:"small",onClick:()=>m(n.id),type:"link",children:(0,x.jsx)(xe.A,{style:{color:s?y.colorTextQuaternary:"transparent"}})})}},{title:l("session.launcher.SessionNameShort"),dataIndex:"name",render:(e,l)=>{const s=e||l.id.split("-")[0];return(0,x.jsx)(Y.A.Text,{className:t.fixEditableVerticalAlign,editable:{onChange(e){f().isEmpty(e)||(a(l.id,e),l.pinned&&A(l.id,e))},text:s},children:(0,x.jsx)(H.rm,{type:"hover",onClick:()=>{var e;null===(e=n.onRequestClose)||void 0===e||e.call(n,JSON.parse(new URLSearchParams(l.params||"").get("formValues")||"{}"))},children:s})})}},{title:l("session.launcher.Environments"),dataIndex:["environments","version"],render:(e,n)=>{const l=n.environments.version||n.environments.manual;return l&&(0,x.jsx)(ge.A,{title:l,placement:"right",children:(0,x.jsxs)(H.OO,{gap:"xxs",children:[(0,x.jsx)(T.A,{image:l}),(0,x.jsxs)(Y.A.Text,{children:[d(l)," ",c(l)]})]})})},onCell:()=>({style:{maxWidth:250,textOverflow:"ellipsis"}})},{title:l("session.launcher.ResourceAllocation"),dataIndex:"resource",render:e=>(0,x.jsx)(H.OO,{gap:"xs",children:(0,x.jsx)(Re,{resource:e})})},{title:l("session.launcher.CreatedAt"),dataIndex:"createdAt",render:e=>ie()(e).fromNow()}]})]})}))};var ye=l(18676);var be=l(77564),Fe=l(49248),fe=l(2725),we=l(90941),Se=l(95444),ke=l(24766),Ve=l(84423),Oe=l(70024),Ee=l(62287),Te=l(32489),Ie=l(82609),Ne=l(93853),Ce=l(69062),_e=l(32642),De=l(51440),Be=l(7109),Pe=l(40720),Me=l(68134),ze=l(73233);const Re=e=>{let{resource:n,containerCount:l=1}=e;return(0,x.jsxs)(x.Fragment,{children:[f().map(f().omit(n,"shmem","accelerator","acceleratorType"),((e,s)=>{var t,i;return"0"===e?null:(0,x.jsx)(c.A,{type:s,value:"mem"===s?((null===(t=(0,S.mv)(e.toString(),""))||void 0===t?void 0:t.number)||0)*l+"":f().toNumber(e)*l+"",opts:{shmem:n.shmem?((null===(i=(0,S.mv)(n.shmem,""))||void 0===i?void 0:i.number)||0)*l:void 0}},s)})),n&&n.accelerator&&n.acceleratorType&&f().isNumber(n.accelerator)?(0,x.jsx)(c.A,{type:n.acceleratorType,value:f().toString(n.accelerator*l)}):null]})},Le=()=>{var e,n;const l=b.A.useApp(),{logger:c}=(0,H.Q7)(),{getErrorMessage:m}=(0,H.B7)(),h=(0,De.md)(o.i7),p=(0,k.CX)(),A=p.supports("mount-by-id"),F=null!==(e=null===p||void 0===p?void 0:p.supports("batch-timeout"))&&void 0!==e&&e,O=(0,_.Am)(),[,E]=(0,V.zL)(),{startSession:T,defaultFormValues:I,upsertSessionNotification:N}=(0,Me.G)(),C=(0,ze.withDefault)(ze.NumberParam,0),D=(0,ze.withDefault)(ze.JsonParam,I),B=(0,ze.withDefault)(ze.JsonParam,{}),[{step:P,formValues:W,redirectTo:Q},J]=(0,ze.useQueryParams)({step:C,formValues:D,redirectTo:ze.StringParam,appOption:B}),{search:$}=(0,Pe.zy)(),X=(0,k.f0)(),[ee,{toggle:ne}]=(0,Ve.A)(),[,{push:le}]=me(),{run:se}=(0,Oe.A)((()=>{const e=ue.getFieldsValue();J({formValues:f().assign(f().omit(ue.getFieldsValue(),["environments.image","environments.customizedTag","autoMountedFolderNames","owner","envvars"]),{envvars:(0,a.z7)(e.envvars)})},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),te=e=>{J({step:e},"pushIn")},{token:re}=M.A.useToken(),{t:oe}=(0,v.Bd)(),ce=Ee.Ay.useBreakpoint(),[ue]=y.A.useForm();(0,g.useEffect)((()=>{f().isEmpty(W)||ue.validateFields().catch((()=>{}))}),[]);const he=(0,g.useEffectEvent)((()=>f().isEmpty(W)?null:setTimeout((()=>{ue.validateFields().catch((()=>{}))}),500)));(0,g.useEffect)((()=>{const e=he();return()=>{e&&clearTimeout(e)}}),[]);const pe=(0,g.useMemo)((()=>f().merge({},I,u.jh,W)),[I,W]);(0,g.useEffect)((()=>{var e;null===(e=h.current)||void 0===e||e.scrollTo(0,0)}),[P]);const ve=y.A.useWatch("sessionType",{form:ue,preserve:!0})||ue.getFieldValue("sessionType")||W.sessionType,xe=(0,H.YM)([{title:oe("session.launcher.SessionType"),key:"sessionType"},{title:"".concat(oe("session.launcher.Environments")," & ").concat(oe("session.launcher.ResourceAllocation")," "),key:"environment"},"inference"!==ve&&{title:oe("webui.menu.Data&Storage"),key:"storage"},{title:oe("session.launcher.Network"),key:"network"},{title:oe("session.launcher.ConfirmAndLaunch"),icon:(0,x.jsx)(be.A,{}),key:"review"}]),Ae=null===(n=xe[P])||void 0===n?void 0:n.key,Re=f().some(ue.getFieldsError(),(e=>e.errors.length>0)),[Le,qe]=(0,k.Tw)("first");(0,g.useEffect)((()=>{P===xe.length-1&&ue.validateFields().catch((()=>{})).finally((()=>qe()))}),[P,ue,qe,xe.length]),(0,g.useEffect)((()=>{"first"!==Le&&Ue(!!Re)}),[Le,Re]);const[Ke,Ue]=(0,g.useState)(!1),[Ge,We]=(0,g.useState)(!1);return(0,g.useLayoutEffect)((()=>{Ge&&(ue.resetFields(),We(!1))}),[Ge,ue]),(0,x.jsxs)(H.OO,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,x.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,x.jsxs)(H.OO,{direction:"row",gap:"md",align:"start",children:[(0,x.jsxs)(H.OO,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:[(0,x.jsxs)(H.OO,{direction:"row",justify:"between",children:[(0,x.jsx)(Y.A.Title,{level:4,style:{marginTop:0},children:oe("session.launcher.StartNewSession")}),(0,x.jsx)(H.OO,{direction:"row",gap:"sm",children:(0,x.jsx)(q.Ay,{type:"link",style:{paddingRight:0,paddingLeft:0},onClick:()=>ne(),children:oe("session.launcher.RecentHistory")})})]}),(0,x.jsx)(y.A.Provider,{onFormChange:()=>{se()},children:(0,x.jsxs)(y.A,{form:ue,layout:"vertical",initialValues:pe,children:[(0,x.jsx)(w,{form:ue}),(0,x.jsxs)(H.OO,{direction:"column",align:"stretch",gap:"md",children:[(0,x.jsxs)(z.A,{title:oe("session.launcher.SessionType"),style:{display:"sessionType"===Ae?"block":"none"},children:[(0,x.jsx)(y.A.Item,{name:"sessionType",children:(0,x.jsx)(Te.Ay.Group,{options:[{label:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(Y.A.Text,{code:!0,children:oe("session.launcher.InteractiveMode")})," ",(0,x.jsx)(Y.A.Text,{type:"secondary",children:oe("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(Y.A.Text,{code:!0,children:oe("session.launcher.BatchMode")})," ",(0,x.jsx)(Y.A.Text,{type:"secondary",children:oe("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,x.jsx)(de,{}),(0,x.jsx)(y.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,x.jsx)(L.A,{})})]}),"batch"===ve&&(0,x.jsxs)(z.A,{title:oe("session.launcher.BatchModeConfig"),style:{display:"sessionType"===Ae?"block":"none"},children:[(0,x.jsx)(y.A.Item,{label:oe("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,x.jsx)(L.A.TextArea,{autoSize:!0})}),(0,x.jsx)(y.A.Item,{noStyle:!0,dependencies:[["batch","scheduleDate"]],children:()=>{const e=ue.getFieldValue(["batch","scheduleDate"]);return(0,x.jsx)(t.A,{delay:1e3,callback:()=>{const e=ue.getFieldValue(["batch","scheduleDate"]);return e?ie()(e).isBefore(ie()())?void(0===ue.getFieldError(["batch","scheduleDate"]).length&&ue.validateFields([["batch","scheduleDate"]])):ie()(e).fromNow():void 0},triggerKey:e||"none",render:e=>(0,x.jsx)(y.A.Item,{label:oe("session.launcher.SessionStartTime"),extra:e,children:(0,x.jsxs)(H.OO,{direction:"row",gap:"xs",children:[(0,x.jsx)(y.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,x.jsx)(Ie.A,{onChange:e=>{e.target.checked&&f().isEmpty(ue.getFieldValue(["batch","scheduleDate"]))?ue.setFieldValue(["batch","scheduleDate"],ie()().add(2,"minutes").toISOString()):!1===e.target.checked&&ue.setFieldValue(["batch","scheduleDate"],void 0),ue.validateFields([["batch","scheduleDate"]])},children:oe("session.launcher.Enable")})}),(0,x.jsx)(y.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var l,s;return(null===(l=e.batch)||void 0===l?void 0:l.enabled)!==(null===(s=n.batch)||void 0===s?void 0:s.enabled)},children:()=>{var e;const n=!0!==(null===(e=ue.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(y.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,n)=>n&&ie()(n).isBefore(ie()())?Promise.reject(oe("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,x.jsx)(i.A,{disabled:n,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(ie()().startOf("day"))})})})}})]})})})}}),F?(0,x.jsx)(y.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"],["batch","timeoutUnit"]],children:()=>{const e=ue.getFieldValue(["batch","timeout"]),n=ue.getFieldValue(["batch","timeoutUnit"]),l=ie().duration(e,null!==n&&void 0!==n?n:"s"),s=(0,S.a3)(l,oe),t=!f().isNull(e)&&f().toFinite(e)>0?s:null;return(0,x.jsx)(y.A.Item,{label:oe("session.launcher.BatchJobTimeoutDuration"),tooltip:oe("session.launcher.BatchJobTimeoutDurationDesc"),help:t,children:(0,x.jsxs)(H.OO,{direction:"row",gap:"xs",children:[(0,x.jsx)(y.A.Item,{noStyle:!0,name:["batch","timeoutEnabled"],valuePropName:"checked",children:(0,x.jsx)(Ie.A,{onChange:e=>{!1===e.target.checked&&ue.setFieldValue(["batch","timeout"],void 0),ue.validateFields([["batch","timeout"]])},children:oe("session.launcher.Enable")})}),(0,x.jsx)(y.A.Item,{noStyle:!0,dependencies:[["batch","timeoutEnabled"]],children:()=>{const e=!0!==ue.getFieldValue(["batch","timeoutEnabled"]);return(0,x.jsx)(x.Fragment,{children:(0,x.jsx)(y.A.Item,{name:["batch","timeout"],label:oe("session.launcher.BatchJobTimeoutDuration"),noStyle:!0,rules:[{min:0,type:"number",message:oe("error.AllowsPositiveNumberOnly")},{required:!e}],children:(0,x.jsx)(Ne.A,{disabled:e,min:1,addonAfter:(0,x.jsx)(y.A.Item,{noStyle:!0,name:["batch","timeoutUnit"],children:(0,x.jsx)(G.A,{tabIndex:-1,style:{minWidth:75},options:[{label:oe("time.Sec"),value:"s"},{label:oe("time.Min"),value:"m"},{label:oe("time.Hour"),value:"h"},{label:oe("time.Day"),value:"d"},{label:oe("time.Week"),value:"w"}]})})})})})}})]})})}}):null]}),("admin"===O||"superadmin"===O)&&(0,x.jsx)(Z,{style:{display:"sessionType"===Ae?"block":"none"}}),"inference"===ve&&(0,x.jsx)(z.A,{title:"Inference Mode Configuration",children:(0,x.jsx)(y.A.Item,{name:["inference","vFolderName"],label:oe("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,x.jsx)(G.A,{})})}),(0,x.jsxs)(z.A,{title:oe("session.launcher.Environments"),style:{display:"environment"===Ae?"block":"none"},children:[(0,x.jsx)(Be.tH,{fallbackRender:()=>null,children:(0,x.jsx)(r.A,{})}),(0,x.jsx)(y.A.Item,{label:oe("session.launcher.EnvironmentVariable"),children:(0,x.jsx)(a.Ay,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,x.jsx)(z.A,{title:oe("session.launcher.ResourceAllocation"),style:{display:"environment"===Ae?"block":"none"},children:(0,x.jsx)(u.Ay,{enableAgentSelect:!p._config.hideAgents&&p.supports("agent-select"),enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,x.jsxs)(z.A,{title:oe("session.launcher.HPCOptimization"),style:{display:"environment"===Ae?"block":"none"},children:[(0,x.jsx)(y.A.Item,{noStyle:!0,children:(0,x.jsxs)(H.OO,{direction:"row",gap:"sm",children:[(0,x.jsx)(Y.A.Text,{children:oe("session.launcher.SwitchOpenMPoptimization")}),(0,x.jsx)(y.A.Item,{label:oe("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,x.jsx)(R.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e?ue.setFieldsValue({hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:void 0,OPENBLAS_NUM_THREADS:void 0}}):ue.setFieldsValue({hpcOptimization:{autoEnabled:!1,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"}})}})})]})}),(0,x.jsx)(y.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var l,s;return(null===(l=e.hpcOptimization)||void 0===l?void 0:l.autoEnabled)!==(null===(s=n.hpcOptimization)||void 0===s?void 0:s.autoEnabled)},children:()=>{const e=ue.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,x.jsxs)(K.A,{gutter:re.marginMD,style:{display:e?"none":void 0,marginTop:re.marginMD},children:[(0,x.jsx)(U.A,{xs:24,sm:12,children:(0,x.jsx)(y.A.Item,{style:{flex:1},label:oe("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,x.jsxs)(x.Fragment,{children:[oe("session.launcher.OpenMPOptimization"),(0,x.jsx)(v.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,x.jsx)(Ne.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,x.jsx)(U.A,{xs:24,sm:12,children:(0,x.jsx)(y.A.Item,{style:{flex:1},label:oe("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,x.jsxs)(x.Fragment,{children:[oe("session.launcher.OpenMPOptimization"),(0,x.jsx)(v.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,x.jsx)(Ne.A,{min:1,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,x.jsx)(z.A,{title:oe("webui.menu.Data&Storage"),style:{display:"storage"===Ae?"block":"none"},children:(0,x.jsx)(y.A.Item,{noStyle:!0,dependencies:["owner"],children:e=>{let{getFieldValue:n}=e;const l=n("owner"),s=(null===l||void 0===l?void 0:l.enabled)&&f().every(f().omit(l,"enabled"),(e=>void 0!==e));return(0,x.jsx)(ye.A,{rowKey:A?"id":"name",rowFilter:e=>{var n;return"ready"===e.status&&!(null!==(n=e.name)&&void 0!==n&&n.startsWith("."))},tableProps:{ownerEmail:s?null===l||void 0===l?void 0:l.email:void 0}})}})}),(0,x.jsx)(z.A,{title:oe("session.launcher.Network"),style:{display:"network"===Ae?"block":"none"},children:(0,x.jsx)(d.Ay,{})}),"review"===Ae&&(0,x.jsx)(ae,{onClickEditStep:e=>{const n=f().findIndex(xe,{key:e});te(n)}}),(0,x.jsxs)(H.OO,{direction:"row",justify:"between",children:[(0,x.jsx)(H.OO,{gap:"sm",children:(0,x.jsx)(Ce.A,{title:oe("button.Reset"),description:oe("session.launcher.ResetFormConfirm"),onConfirm:()=>{J({},"replace"),We(!0)},icon:(0,x.jsx)(Fe.A,{style:{color:re.colorError}}),okText:oe("button.Reset"),okButtonProps:{danger:!0},children:(0,x.jsx)(q.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:oe("button.Reset")})})}),(0,x.jsxs)(H.OO,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[P>0&&(0,x.jsx)(q.Ay,{onClick:()=>{te(P-1)},icon:(0,x.jsx)(fe.A,{}),children:oe("button.Previous")}),P===xe.length-1?(0,x.jsx)(ge.A,{title:Re?oe("session.launcher.PleaseCompleteForm"):void 0,children:(0,x.jsx)(H.Fv,{type:"primary",icon:(0,x.jsx)(we.A,{}),disabled:Re,action:async()=>{var e;const n=$,s=await ue.validateFields().catch((e=>{c.error("validation errors",e)}));if(s){if(f().isEmpty(s.mount_ids)||0===(null===(e=s.mount_ids)||void 0===e?void 0:e.length)){if(!await l.modal.confirm({title:oe("session.launcher.NoFolderMounted"),content:(0,x.jsxs)(x.Fragment,{children:[oe("session.launcher.HomeDirectoryDeletionDialog"),(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),oe("session.launcher.LaunchConfirmationDialog"),(0,x.jsx)("br",{}),(0,x.jsx)("br",{}),oe("dialog.ask.DoYouWantToProceed")]}),okText:oe("session.launcher.Start"),closable:!0}))return}await T(s).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&(N(e.fulfilled),E(s.resourceGroup),le({params:n,name:e.fulfilled[0].value.sessionName})),null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&X(Q||"/job"),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const n=e.rejected[0].reason;l.modal.error({title:null===n||void 0===n?void 0:n.title,content:m(n)})}})).catch((e=>{c.error("Unexpected error during session creation:",e),l.message.error(oe("error.UnexpectedError"))}))}},children:oe("session.launcher.Launch")})}):(0,x.jsxs)(q.Ay,{type:"primary",ghost:!0,onClick:()=>{te(P+1)},children:[oe("button.Next")," ",(0,x.jsx)(Se.A,{})]}),P!==xe.length-1&&(0,x.jsxs)(q.Ay,{onClick:()=>{te(xe.length-1)},children:[oe("session.launcher.SkipToConfirmAndLaunch"),(0,x.jsx)(ke.A,{})]})]})]})]})]})})]}),ce.lg&&(0,x.jsx)(H.OO,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,x.jsx)(_e.A,{size:"small",direction:"vertical",current:P,onChange:e=>{te(e)},items:f().map(xe,((e,n)=>(0,s.A)((0,s.A)({},e),{},{status:n===P?"process":"wait"})))})})]}),(0,x.jsx)(je,{onRequestClose:e=>{if(e){const n=f().merge({sessionName:"",ports:[],vfoldersNameMap:{},mount_ids:[],mount_id_map:{},bootstrap_script:"",num_of_sessions:1,owner:{enabled:!1,accesskey:"",domainName:"",email:void 0,project:"",resourceGroup:""},environments:{manual:""},batch:{enabled:!1,command:void 0,scheduleDate:void 0},agent:["auto"]},e);f().isEmpty(n.sessionName)||(n.sessionName=n.sessionName+"-"+(0,H.kX)(4)),ue.setFieldsValue(n),te(xe.length-1),ue.validateFields().catch((()=>{}))}ne()},open:ee}),P===xe.length-1?(0,x.jsx)(Be.tH,{fallback:null,children:(0,x.jsx)(j,{open:Ke,onClose:()=>{Ue(!1)},scrollIntoViewOptions:!0})}):void 0]})}}}]);
//# sourceMappingURL=57.6df7a49a.chunk.js.map