"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[9265],{15621:(e,n,a)=>{a.d(n,{A:()=>b});const l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},a=[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],l=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:a,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base_image_name",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:a,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"version",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"supported_accelerators",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:l,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:l},params:{cacheID:"192812639ccebbee01e918cbd60b8816",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:'query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    name @deprecatedSince(version: "24.12.0")\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n    namespace @since(version: "24.12.0")\n    base_image_name @since(version: "24.12.0")\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    version @since(version: "24.12.0")\n    supported_accelerators\n  }\n}\n'}}}();l.hash="cd124d0155c7eab304c2d3b6dc75074a";const i=l;var o=a(48880),t=a(40690),r=a(22339),s=a(90679);var d=a(2289),u=a(93304),m=a(46072),c=a(94010),g=a(76591),v=a(96223),p=a(30782),h=a(42338),y=a(72245),A=a(90711),f=a(67631),x=a(47699),_=a.n(x),j=a(17534),k=a(62962),F=a(46336),w=a(89374);const b=e=>{var n;let{filter:a,showPrivate:l}=e;const x=c.A.useFormInstance(),b=c.A.useWatch("environments",{form:x,preserve:!0}),S=(0,t.CX)(),V=null===S||void 0===S?void 0:S.supports("extended-image-info"),[I,K]=(0,j.useState)(""),[O,E]=(0,j.useState)(""),{t:T}=(0,k.Bd)(),[N,{getBaseVersion:C,getImageMeta:P,tagAlias:M}]=(0,t.Gj)(),{token:R}=g.A.useToken(),{isDarkMode:L}=(0,r.e)(),z=(0,j.useRef)(null),q=(0,j.useRef)(null),B=null!==S&&void 0!==S&&null!==(n=S._config)&&void 0!==n&&n.showNonInstalledImages?{}:{installed:!0},{images:D}=(0,F.useLazyLoadQuery)(i,B,{fetchPolicy:"store-and-network"});(0,j.useEffect)((()=>{var e,n,a;if(!_().isEmpty(null===b||void 0===b?void 0:b.manual))return void((b.environment||b.version)&&x.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}}));let l,i,t,r,s=null===(e=x.getFieldValue("environments"))||void 0===e?void 0:e.version;var d,u;(s&&s.indexOf("@")<0&&(s+="@x86_64"),s&&_().find(Q,(e=>(l=_().find(e.environmentGroups,(e=>(i=_().find(e.images,(e=>(0,o.A_)(e)===s)),!!i))),!!l))),l?(t=l,r=i):x.getFieldValue(["environments","environment"])&&_().find(Q,(e=>{var n;return t=_().find(e.environmentGroups,(e=>e.environmentName===x.getFieldValue(["environments","environment"]))),r=null===(n=t)||void 0===n?void 0:n.images[0],!!t})),t&&r)||(t=null===(d=Q[0])||void 0===d?void 0:d.environmentGroups[0],r=null===(u=t)||void 0===u?void 0:u.images[0]);const m=null===(n=_().find(null===(a=r)||void 0===a?void 0:a.labels,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key))))||void 0===n?void 0:n.value;r?!l&&S._config.allow_manual_image_name_for_session&&s?x.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0,manual:s,customizedTag:null!==m&&void 0!==m?m:void 0}}):x.setFieldsValue({environments:{environment:t.environmentName,version:(0,o.A_)(r),image:r,customizedTag:null!==m&&void 0!==m?m:void 0}}):S._config.allow_manual_image_name_for_session&&x.setFieldValue(["environments","manual"],s)}),[null===b||void 0===b?void 0:b.version,null===b||void 0===b?void 0:b.manual]);const Q=(0,j.useMemo)((()=>_().chain(D).filter((e=>(!!l||!(e=>_().some(null===e||void 0===e?void 0:e.labels,(e=>{var n;return"ai.backend.features"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.split(" ").includes("private"))})))(e))&&(!a||a(e)))).groupBy((e=>{var n;return(null===N||void 0===N||null===(n=N.imageInfo[P((0,o.A_)(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map(((e,n)=>{var a;return{groupName:n,groupSortKey:(null===N||void 0===N||null===(a=N.groupSortKeyMap)||void 0===a?void 0:a[n])||n,environmentGroups:_().chain(e).groupBy((e=>"".concat(null===e||void 0===e?void 0:e.registry,"/").concat(V?null===e||void 0===e?void 0:e.namespace:null===e||void 0===e?void 0:e.name))).map(((e,n)=>{var a,l;const i=null===(a=n.split("/"))||void 0===a?void 0:a[2],t=i&&(null===N||void 0===N||null===(l=N.imageInfo[i])||void 0===l?void 0:l.name)||_().last(n.split("/"));return{environmentName:n,displayName:t,prefix:_().chain(n).split("/").drop(1).dropRight(1).join("/").value(),images:e.sort(((e,n)=>{var a,l,i,t,r,s;return function(e,n){const a=e.split(".").map(Number),l=n.split(".").map(Number);for(let i=0;i<Math.max(a.length,l.length);i++){const e=a[i]||0,n=l[i]||0;if(e>n)return 1;if(e<n)return-1}return 0}(null!==(a=null===n||void 0===n||null===(l=n.tag)||void 0===l||null===(i=l.split("-"))||void 0===i?void 0:i[0])&&void 0!==a?a:"",null!==(t=null===e||void 0===e||null===(r=e.tag)||void 0===r||null===(s=r.split("-"))||void 0===s?void 0:s[0])&&void 0!==t?t:"")||(0,o._f)(null===e||void 0===e?void 0:e.architecture,null===n||void 0===n?void 0:n.architecture)}))}})).sortBy((e=>e.displayName)).value()}})).sortBy((e=>e.groupSortKey)).value()),[D,N,a,l]),{fullNameMatchedImage:W}=(0,j.useMemo)((()=>{let e,n;return I.length&&_().chain(Q.flatMap((e=>e.environmentGroups)).find((a=>(n=a,e=_().find(a.images,(e=>(0,o.A_)(e)===I)),!!e)))).value(),{fullNameMatchedImage:e,fullNameMatchedImageGroup:n}}),[I,Q]);return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)("style",{children:"/* Change the image and tags of the select option when the selection is opened  */\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  img,\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  span.ant-tag {\n  opacity: 0.5;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-light {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-dark {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px; /* Width of the transparent gradient area */\n  background: linear-gradient(\n    to right,\n    rgba(255, 255, 255, 0),\n    rgba(255, 255, 255, 1)\n  );\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px;\n  background: linear-gradient(\n    to right,\n    rgba(20, 20, 20, 0),\n    rgba(20, 20, 20, 1)\n  );\n}\n"}),(0,w.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","environment"],label:(0,w.jsxs)(v.A.Text,{copyable:{text:(0,o.A_)(x.getFieldValue(["environments","image"]))},children:[T("session.launcher.Environments")," /"," ",T("session.launcher.Version")]}),rules:[{required:_().isEmpty(null===b||void 0===b?void 0:b.manual),message:T("general.ValueRequired",{name:T("session.launcher.Environments")})}],style:{marginBottom:10},children:(0,w.jsx)(p.A,{ref:z,showSearch:!0,popupMatchSelectWidth:!1,searchValue:I,onSearch:K,defaultActiveFirstOption:!0,optionFilterProp:"filterValue",onChange:e=>{if(W)x.setFieldsValue({environments:{environment:(V?null===W||void 0===W?void 0:W.namespace:null===W||void 0===W?void 0:W.name)||"",version:(0,o.A_)(W),image:W}});else{const n=Q.flatMap((e=>e.environmentGroups)).filter((n=>n.environmentName===e))[0].images[0];x.setFieldsValue({environments:{environment:(V?null===n||void 0===n?void 0:n.namespace:null===n||void 0===n?void 0:n.name)||"",version:(0,o.A_)(n),image:n}})}},disabled:S._config.allow_manual_image_name_for_session&&!_().isEmpty(null===b||void 0===b?void 0:b.manual),children:W?(0,w.jsx)(p.A.Option,{value:V?null===W||void 0===W?void 0:W.namespace:null===W||void 0===W?void 0:W.name,filterValue:(0,o.A_)(W),children:(0,w.jsxs)(f.OO,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,w.jsx)(d.A,{image:(0,o.A_)(W)||"",style:{width:15,height:15}}),(0,o.A_)(W)]})}):_().map(Q,(e=>(0,w.jsx)(p.A.OptGroup,{label:e.groupName,children:_().map(e.environmentGroups,(e=>{var n;const a=e.images[0],l=null===N||void 0===N?void 0:N.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[2]],i=[];let t=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(i.push(e.prefix),t=(0,w.jsx)(h.A,{color:"purple",children:(0,w.jsx)(m.A,{keyword:I,children:e.prefix})}));const r=_().map(null===l||void 0===l?void 0:l.label,(e=>_().isUndefined(e.category)&&e.tag&&e.color?(i.push(e.tag),(0,w.jsx)(h.A,{color:e.color,children:(0,w.jsx)(m.A,{keyword:I,children:e.tag},e.tag)},e.tag)):null));return(0,w.jsx)(p.A.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+i.join("\t"),children:(0,w.jsxs)(f.OO,{direction:"row",justify:"between",children:[(0,w.jsxs)(f.OO,{direction:"row",align:"center",gap:"xs",children:[(0,w.jsx)(d.A,{image:(0,o.A_)(a)||"",style:{width:15,height:15}}),(0,w.jsx)(m.A,{keyword:I,children:e.displayName})]}),(0,w.jsxs)(f.OO,{direction:"row",className:L?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:R.marginXS,flexShrink:1},children:[t,r]})]})},e.environmentName)}))},e.groupName)))})}),(0,w.jsx)(c.A.Item,{noStyle:!0,shouldUpdate:(e,n)=>{var a,l;return(null===(a=e.environments)||void 0===a?void 0:a.environment)!==(null===(l=n.environments)||void 0===l?void 0:l.environment)},children:e=>{var n;let a,{getFieldValue:l}=e;return _().find(Q,(e=>_().find(e.environmentGroups,(e=>{var n;return e.environmentName===(null===(n=l("environments"))||void 0===n?void 0:n.environment)&&(a=e,!0)})))),(0,w.jsx)(c.A.Item,{className:"image-environment-select-form-item",name:["environments","version"],rules:[{required:_().isEmpty(null===b||void 0===b?void 0:b.manual),message:T("general.ValueRequired",{name:T("session.launcher.Version")})}],children:(0,w.jsx)(p.A,{ref:q,popupMatchSelectWidth:!1,onChange:e=>{const n=_().find(D,(n=>(0,o.A_)(n)===e));x.setFieldValue(["environments","image"],n)},showSearch:!0,searchValue:O,onSearch:E,optionFilterProp:"filterValue",popupRender:e=>(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(f.OO,{style:{fontWeight:R.fontWeightStrong,paddingLeft:R.paddingSM},children:[T("session.launcher.Version"),(0,w.jsx)(y.A,{type:"vertical"}),T("session.launcher.Architecture"),(0,w.jsx)(y.A,{type:"vertical"}),T("session.launcher.Tags")]}),(0,w.jsx)(y.A,{style:{margin:"8px 0"}}),e]}),disabled:S._config.allow_manual_image_name_for_session&&!_().isEmpty(null===b||void 0===b?void 0:b.manual),children:_().map(_().uniqBy(null===(n=a)||void 0===n?void 0:n.images,"id"),(e=>{var n;const[a,l,...i]=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""];let t=null===N||void 0===N?void 0:N.tagAlias[l];if(!t){for(const[e,n]of Object.entries((null===N||void 0===N?void 0:N.tagReplace)||{})){const a=new RegExp(e);a.test(l)&&(t=null===l||void 0===l?void 0:l.replace(a,n))}t||(t=l)}const r=[],d=_().chain(i).filter((e=>!e.startsWith("customized_"))).map(((e,n)=>(0,w.jsx)(s.A,{values:_().split((null===N||void 0===N?void 0:N.tagAlias[e])||e,":").map((e=>(r.push(e),{label:e,highlightKeyword:O})))},n))).value(),c=null===e||void 0===e?void 0:e.labels;if(c){const e=_().findIndex(c,(e=>null!==e&&"ai.backend.customized-image.name"===(null===e||void 0===e?void 0:e.key)));if(e&&c[e]){var g;const n=(null===(g=c[e])||void 0===g?void 0:g.value)||"";r.push("Customized"),r.push(n),d.push((0,w.jsx)(s.A,{highlightKeyword:O,values:[{label:"Customized",color:"cyan"},{label:null!==n&&void 0!==n?n:"",color:"cyan"}]},d.length+1))}}return(0,w.jsx)(p.A.Option,{value:(0,o.A_)(e),filterValue:[a,t,null===e||void 0===e?void 0:e.architecture,...r].join("\t"),children:V?(0,w.jsxs)(f.OO,{direction:"row",children:[(0,w.jsx)(m.A,{keyword:O,children:null===e||void 0===e?void 0:e.version}),(0,w.jsx)(y.A,{type:"vertical"}),(0,w.jsx)(m.A,{keyword:O,children:null===e||void 0===e?void 0:e.architecture}),(0,w.jsx)(y.A,{type:"vertical"}),(0,w.jsx)(f.OO,{direction:"row",align:"start",children:_().map(null===e||void 0===e?void 0:e.tags,(n=>{var a;const l=_().includes(n.key,"customized_"),i=l?null===(a=_().find(null===e||void 0===e?void 0:e.labels,{key:"ai.backend.customized-image.name"}))||void 0===a?void 0:a.value:n.value,t=M(n.key+i);return _().isEqual(t,(0,o.WY)(n.key+i))||l?(0,w.jsx)(s.A,{highlightKeyword:O,values:[{label:M(n.key),color:l?"cyan":"blue"},{label:null!==i&&void 0!==i?i:"",color:l?"cyan":"blue"}]},n.key):(0,w.jsx)(h.A,{color:l?"cyan":"blue",children:(0,w.jsx)(m.A,{keyword:O,children:t})},n.key)}))})]}):(0,w.jsx)(f.OO,{direction:"row",justify:"between",children:(0,w.jsxs)(f.OO,{direction:"row",children:[(0,w.jsx)(m.A,{keyword:O,children:C((0,o.A_)(e)||"")}),(0,w.jsx)(y.A,{type:"vertical"}),(0,w.jsx)(m.A,{keyword:O,children:null===e||void 0===e?void 0:e.architecture}),(0,w.jsx)(y.A,{type:"vertical"}),(0,w.jsx)(u.J,{tag:(null===e||void 0===e?void 0:e.tag)||"",highlightKeyword:O,labels:null===e||void 0===e?void 0:e.labels})]})})},null===e||void 0===e?void 0:e.id)}))})})}}),(0,w.jsx)(c.A.Item,{label:T("session.launcher.ManualImageName"),name:["environments","manual"],style:{display:S._config.allow_manual_image_name_for_session?"block":"none"},children:(0,w.jsx)(A.A,{allowClear:!0,onChange:e=>{_().isEmpty(e)||x.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}})}})}),(0,w.jsx)(c.A.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,w.jsx)(A.A,{})})]})}},18676:(e,n,a)=>{a.d(n,{A:()=>$});var l=a(56276),i=a(11863),o=a(69041);const t=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domain_name"},{defaultValue:null,kind:"LocalArgument",name:"group_id"},{defaultValue:null,kind:"LocalArgument",name:"keypair_resource_policy_name"}],n=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domain_name"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domain_name"},{kind:"Variable",name:"id",variableName:"group_id"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:n,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"keypair_resource_policy_name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:n,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderTableProjectQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderTableProjectQuery",selections:a},params:{cacheID:"2c2ce905afd89e93c6d761f22ed59f3d",id:null,metadata:{},name:"VFolderTableProjectQuery",operationKind:"query",text:"query VFolderTableProjectQuery(\n  $domain_name: String!\n  $group_id: UUID!\n  $keypair_resource_policy_name: String!\n) {\n  domain(name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  group(id: $group_id, domain_name: $domain_name) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $keypair_resource_policy_name) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();t.hash="ccdbaa52a63c2ea005423e7c541eff80";const r=t;var s=a(48880),d=a(40690),u=a(73205),m=a(62378),c=a(66673),g=a(81109),v=a(94538),p=a(66800),h=a(46072);const y={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderPermissionTag_VFolder",selections:[{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null}],type:"VirtualFolder",abstractKey:null,hash:"d3b0f85629ac8c6f45ef363938f66067"},A=y;var f=a(90679),x=a(47699),_=a.n(x),j=a(17534),k=a(46336),F=a(89374);const w=e=>{let{vFolderFrgmt:n=null,permission:a}=e;const l=(0,k.useFragment)(A,n),i=_().chain({r:"green",w:"blue",d:"red"}).map(((e,n)=>{if(((e,n)=>!(null===e||void 0===e||!e.includes(n))||!(null===e||void 0===e||!e.includes("w")||"r"!==n))((null===l||void 0===l?void 0:l.permission)||a,n))return{label:n.toUpperCase(),color:e}})).compact().value();return(0,F.jsx)(f.A,{values:i})};var b=a(49248),S=a(62431),V=a(63026),I=a(94010),K=a(76591),O=a(96223),E=a(20714),T=a(90711),N=a(8343),C=a(94824),P=a(42338),M=a(67631),R=a(8905),L=a.n(R),z=a(52866),q=a(62962);const B=["rowFilter","showAliasInput","selectedRowKeys","onChangeSelectedRowKeys","aliasBasePath","aliasMap","onChangeAliasMap","rowKey","onChangeAutoMountedFolders","showAutoMountedFoldersSection","ownerEmail","onValidateSelectedRowKeys"],D=/^[a-zA-Z0-9_/.-]*$/,Q="/home/work/",W=e=>{let{rowFilter:n,showAliasInput:a=!1,selectedRowKeys:t=[],onChangeSelectedRowKeys:y,aliasBasePath:A=Q,aliasMap:f,onChangeAliasMap:x,rowKey:R="name",onChangeAutoMountedFolders:W,showAutoMountedFoldersSection:G,ownerEmail:U,onValidateSelectedRowKeys:$}=e,J=(0,i.A)(e,B);const{generateFolderPath:H}=(0,p.useFolderExplorerOpener)(),Y=j.useMemo((()=>e=>e&&e[R]),[R]),[X,Z]=(0,j.useState)(!1),[ee,ne]=(0,c.A)({value:t,onChange:e=>{const n=_().filter(we,(n=>_().includes(e,Y(n))));null===y||void 0===y||y(e,n)}},{defaultValue:[]}),[ae,le]=(0,c.A)({value:f,onChange:x},{defaultValue:{}}),ie=(0,d.CX)(),[oe]=(0,u.x)(null===ie||void 0===ie?void 0:ie._config.accessKey),[te]=I.A.useForm();(0,j.useEffect)((()=>{ae&&(te.setFieldsValue(_().mapValues(ae,(e=>e.startsWith(A)?e.slice(A.length):e))),te.validateFields())}),[ae,te,A]);const{t:re}=(0,q.Bd)(),{token:se}=K.A.useToken(),de=(0,s.QE)(),ue=(0,g.hd)(),[me,ce]=(0,d.Tw)("first"),[ge,ve]=(0,j.useTransition)(),{data:pe}=(0,m.nj)({queryKey:["VFolderSelectQuery",me,ue.id,U],queryFn:()=>{const e=new URLSearchParams;return U&&e.set("owner_user_email",U),de({method:"GET",url:"/folders?".concat(e.toString())})},staleTime:1e3}),{domain:he,group:ye,keypair_resource_policy:Ae}=(0,k.useLazyLoadQuery)(r,{domain_name:ie._config.domainName,group_id:ue.id,keypair_resource_policy_name:(null===oe||void 0===oe?void 0:oe.resource_policy)||""},{fetchPolicy:"store-and-network",fetchKey:me}),fe=(0,j.useMemo)((()=>{const e=JSON.parse((null===he||void 0===he?void 0:he.allowed_vfolder_hosts)||"{}"),n=JSON.parse((null===ye||void 0===ye?void 0:ye.allowed_vfolder_hosts)||"{}"),a=JSON.parse((null===Ae||void 0===Ae?void 0:Ae.allowed_vfolder_hosts)||"{}"),l=_().merge({},e,n,a);return Object.keys(l).filter((e=>l[e].includes("mount-in-session")))}),[he,ye,Ae]),xe=(0,j.useMemo)((()=>(null===pe||void 0===pe?void 0:pe.filter((e=>"user"===e.ownership_type||!e.group||e.group===ue.id)))||[]),[pe,ue.id]),_e=(0,j.useMemo)((()=>xe.filter((e=>fe.includes(e.host)))),[xe,fe]);(0,j.useEffect)((()=>{const e=_().difference(ee,_e.map((e=>Y(e))));null===$||void 0===$||$(e,_().filter(_e,(e=>_().includes(ee,Y(e)))))}),[_e,Y,$,JSON.stringify(ee)]);const je=(0,j.useMemo)((()=>_().chain(_e).filter((e=>{var n;return"ready"===e.status&&(null===(n=e.name)||void 0===n?void 0:n.startsWith("."))})).map((e=>e.name)).value()),[_e]);(0,j.useEffect)((()=>{_().isFunction(W)&&W(je)}),[je]),(0,j.useEffect)((()=>{t&&0!==t.length||ne([])}),[ue.id]);const[ke,Fe]=(0,j.useState)(""),we=(0,j.useMemo)((()=>_().chain(_e).filter((e=>!(n&&!n(e))&&(!!ee.includes(Y(e))||(!ke||e.name.includes(ke))))).value()),[_e,n,ee,Y,ke]),be=(0,j.useCallback)(((e,n)=>void 0===n||""===n?"".concat(A).concat(e):n.startsWith("/")?n:"".concat(A).concat(n)),[A]),Se=(0,o.E)((()=>{le(_().mapValues(_().pickBy(te.getFieldsValue({strict:!1}),(e=>!!e)),((e,n)=>be(n,e)))),te.validateFields().catch((()=>{}))}));(0,j.useEffect)((()=>{Se()}),[JSON.stringify(ee),Se]);const Ve=[{title:(0,F.jsxs)(M.OO,{direction:"row",gap:"xxs",children:[(0,F.jsx)(O.A.Text,{children:re("data.folders.Name")}),a&&(0,F.jsx)(F.Fragment,{children:(0,F.jsxs)(O.A.Text,{type:"secondary",style:{fontWeight:"normal"},children:["(",re("session.launcher.FolderAlias")," ",(0,F.jsx)(E.A,{title:(0,F.jsx)(q.x6,{i18nKey:"session.launcher.DescFolderAlias"}),children:(0,F.jsx)(b.A,{})}),")"]})})]}),dataIndex:"name",sorter:(e,n)=>e.name.localeCompare(n.name),render:(e,n)=>{const l=ee.includes(Y(n));return(0,F.jsxs)(M.OO,{direction:"column",align:"start",gap:"xxs",style:a&&l?{display:"inline-flex",height:70,width:"100%"}:{maxWidth:200},children:[(0,F.jsx)(M.rm,{type:"hover",to:H(n.id),children:(0,F.jsx)(h.A,{keyword:ke,children:e})}),a&&l&&(0,F.jsx)(I.A.Item,{noStyle:!0,shouldUpdate:(e,a)=>e[Y(n)]!==a[Y(n)],children:()=>{const e=_()(ee).reduce(((e,n)=>(e[n]=(null===ae||void 0===ae?void 0:ae[n])||be(n,void 0),e)),{});return(0,F.jsx)(I.A.Item,{name:Y(n),rules:[{type:"string",pattern:D,message:re("session.launcher.FolderAliasInvalid")},{type:"string",validator:async(a,l)=>l&&_().some(e,((e,a)=>a!==Y(n)&&e===be(Y(n),l)))?Promise.reject(re("session.launcher.FolderAliasOverlapping")):Promise.resolve()},{type:"string",validator:async(e,a)=>{const l=be(Y(n),a);return a&&_().map(je,(e=>be("",e))).includes(l)?Promise.reject(re("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],extra:be(n.name,te.getFieldValue(Y(n))),children:(0,F.jsx)(T.A,{onClick:e=>{e.stopPropagation()},placeholder:re("session.launcher.FolderAlias"),allowClear:!0,onChange:()=>{Se()}})})}})]})}},{title:re("data.UsageMode"),dataIndex:"usage_mode",sorter:(e,n)=>e.usage_mode.localeCompare(n.usage_mode)},{title:re("data.Host"),dataIndex:"host"},{title:re("data.Type"),dataIndex:"type",sorter:(e,n)=>e.type.localeCompare(n.type),render:(e,n)=>(0,F.jsx)(M.OO,{direction:"column",children:"user"===n.ownership_type?(0,F.jsxs)(M.OO,{gap:"xs",children:[(0,F.jsx)(O.A.Text,{children:re("data.User")}),(0,F.jsx)(S.A,{style:{color:se.colorTextTertiary}})]}):(0,F.jsxs)(M.OO,{gap:"xs",children:[(0,F.jsx)(O.A.Text,{children:re("data.Project")}),(0,F.jsx)(M.Ob,{style:{color:se.colorTextTertiary}})]})})},{title:re("data.Permission"),dataIndex:"permission",sorter:(e,n)=>e.permission.localeCompare(n.permission),render:(e,n)=>(0,F.jsx)(w,{permission:n.permission})},{title:re("data.Created"),dataIndex:"created_at",sorter:(e,n)=>e.created_at.localeCompare(n.created_at),render:e=>L()(e).format("L"),defaultSortOrder:"descend"}];return(0,F.jsxs)(M.OO,{direction:"column",align:"stretch",gap:"xs",children:[(0,F.jsxs)(M.OO,{direction:"row",gap:"xs",justify:"between",children:[(0,F.jsx)(T.A,{value:ke,onChange:e=>Fe(e.target.value),allowClear:!0,placeholder:re("data.SearchByName")}),(0,F.jsx)(E.A,{title:re("button.Refresh"),children:(0,F.jsx)(N.Ay,{loading:ge,icon:(0,F.jsx)(V.A,{}),onClick:()=>{ve((()=>{ce()}))}})}),(0,F.jsx)(E.A,{title:re("data.CreateANewStorageFolder"),children:(0,F.jsx)(N.Ay,{icon:(0,F.jsx)(z.A,{}),type:"primary",ghost:!0,onClick:()=>{Z(!0)}})})]}),(0,F.jsx)(I.A,{form:te,component:!1,preserve:!1,children:(0,F.jsx)(M.zx,(0,l.A)({scroll:{x:"max-content"},rowKey:Y,rowSelection:{selectedRowKeys:ee,onChange:e=>{ne(e),Se()}},showSorterTooltip:!1,columns:Ve,dataSource:we,onRow:e=>({onClick:n=>{var a;const l=n.target;null!==l&&void 0!==l&&null!==(a=l.classList)&&void 0!==a&&a.contains("ant-table-selection-column")&&(n.stopPropagation(),ee.includes(Y(e))?ne(ee.filter((n=>n!==Y(e)))):ne([...ee,Y(e)]))}})},J))}),G&&je.length>0?(0,F.jsx)(F.Fragment,{children:(0,F.jsx)(C.A,{size:"small",children:(0,F.jsx)(C.A.Item,{label:re("data.AutomountFolders"),children:_().map(je,(e=>(0,F.jsx)(P.A,{children:e},e)))})})}):null,(0,F.jsx)(v.A,{open:X,onRequestClose:e=>{Z(!1),e&&ve((()=>{ce(),ne((n=>[...n,e[R]]))}))}})]})};var G=a(66597);const U=["rowFilter","rowKey","tableProps"],$=e=>{let{rowFilter:n,rowKey:a="name",tableProps:t}=e,r=(0,i.A)(e,U);const s=I.A.useFormInstance(),{t:d}=(0,q.Bd)(),{message:u}=G.A.useApp();return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(I.A.Item,{hidden:!0,name:"mount_id_map",rules:[{validator(e,n){const a=_().chain(s.getFieldValue("mount_ids")).reduce(((e,a)=>(e[a]=n[a]||"/home/work/"+a,e)),{}).values().value();return _().uniq(a).length!==a.length?Promise.reject(d("session.launcher.FolderAliasOverlapping")):_().some(a,(e=>!D.test(e)))?Promise.reject(d("session.launcher.FolderAliasInvalid")):_().some(s.getFieldValue("autoMountedFolderNames"),(e=>a.includes(Q+e)))?Promise.reject(d("session.launcher.FolderAliasOverlappingToAutoMount")):Promise.resolve()}}],children:(0,F.jsx)(T.A,{})}),(0,F.jsx)(I.A.Item,{hidden:!0,name:"mounts",children:(0,F.jsx)("div",{})}),(0,F.jsx)(I.A.Item,{hidden:!0,name:"autoMountedFolderNames",children:(0,F.jsx)("div",{})}),(0,F.jsx)(I.A.Item,{hidden:!0,name:"vfoldersNameMap",children:(0,F.jsx)("div",{})}),(0,F.jsx)(I.A.Item,(0,l.A)((0,l.A)({name:"mount_ids"},r),{},{valuePropName:"selectedRowKeys",trigger:"onChangeSelectedRowKeys",children:(0,F.jsx)(W,(0,l.A)({rowKey:a,showAliasInput:!0,aliasMap:s.getFieldValue("mount_id_map"),onChangeAliasMap:(0,o.E)((e=>{s.setFieldValue("mount_id_map",e),s.validateFields(["mount_id_map"])})),pagination:!1,rowFilter:n,showAutoMountedFoldersSection:!0,onChangeAutoMountedFolders:(0,o.E)((e=>{s.setFieldValue("autoMountedFolderNames",e)})),onValidateSelectedRowKeys:(0,o.E)(((e,n)=>{s.setFieldValue("mount_ids",_().difference(s.getFieldValue("mount_ids"),e)),s.setFieldValue("mount_id_map",_().omitBy(s.getFieldValue("mount_id_map"),((n,a)=>e.includes(a)))),s.setFieldValue("vfoldersNameMap",_().reduce(n,((e,n)=>(e[n[a]]=n.name,e)),{})),e.length>0&&u.warning(d("session.launcher.InvalidMountsSelectionWarning"))}))},t),null===t||void 0===t?void 0:t.ownerEmail)}))]})}},52038:(e,n,a)=>{a.d(n,{Ay:()=>x,z7:()=>f});var l=a(56276),i=a(11863),o=a(72627),t=a(57586),r=a(8343),s=a(94010),d=a(90711),u=a(67631),m=a(47699),c=a.n(m),g=a(17534),v=a(62962),p=a(89374);const h=["formItemProps"],y=["key","name"],A=[/AUTH/i,/ACCESS/i,/SECRET/i,/_KEY/i,/PASSWORD/i,/PASSWD/i,/PWD/i,/TOKEN/i,/PRIVATE/i,/CREDENTIAL/i,/JWT/i,/KEYPAIR/i,/CERTIFICATE/i,/SSH/i,/ENCRYPT/i,/SIGNATURE/i,/SALT/i,/PIN/i,/PASSPHRASE/i,/OAUTH/i];function f(e){return c().map(e,(e=>{return e&&(n=e.variable,A.some((e=>e.test(n))))?(0,l.A)((0,l.A)({},e),{},{value:""}):e;var n}))}const x=e=>{let{formItemProps:n}=e,a=(0,i.A)(e,h);const m=(0,g.useRef)(null),{t:A}=(0,v.Bd)(),f=s.A.useFormInstance();return(0,p.jsx)(s.A.List,(0,l.A)((0,l.A)({},a),{},{children:(e,g)=>{let{add:v,remove:h}=g;return(0,p.jsxs)(u.OO,{direction:"column",gap:"xs",align:"stretch",children:[e.map(((t,r)=>{let{key:g,name:v}=t,x=(0,i.A)(t,y);return(0,p.jsxs)(u.OO,{direction:"row",align:"baseline",gap:"xs",children:[(0,p.jsx)(s.A.Item,(0,l.A)((0,l.A)((0,l.A)({},x),{},{style:{marginBottom:0,flex:1},name:[v,"variable"],rules:[{required:!0,message:A("session.launcher.EnterEnvironmentVariable")},{pattern:/^[a-zA-Z_][a-zA-Z0-9_]*$/,message:A("session.launcher.EnvironmentVariableNamePatternError")},e=>{let{getFieldValue:n}=e;return{validator(e,l){const i=c().map(n(a.name),(e=>null===e||void 0===e?void 0:e.variable));return!c().isEmpty(l)&&i.length>0&&c().filter(i,(e=>e===l)).length>1?Promise.reject(A("session.launcher.EnvironmentVariableDuplicateName")):Promise.resolve()}}}]},n),{},{children:(0,p.jsx)(d.A,{ref:r===e.length-1?m:null,placeholder:"Variable",onChange:()=>{const n=e.map(((e,n)=>[a.name,n,"variable"]));f.validateFields(n)}})})),(0,p.jsx)(s.A.Item,(0,l.A)((0,l.A)({},x),{},{name:[v,"value"],style:{marginBottom:0,flex:1},rules:[{required:!0,message:A("session.launcher.EnvironmentVariableValueRequired")}],validateTrigger:["onChange","onBlur"],children:(0,p.jsx)(d.A,{placeholder:"Value"})})),(0,p.jsx)(o.A,{onClick:()=>h(v)})]},g)})),(0,p.jsx)(s.A.Item,{noStyle:!0,children:(0,p.jsx)(r.Ay,{type:"dashed",onClick:()=>{v(),setTimeout((()=>{m.current&&m.current.focus()}),0)},icon:(0,p.jsx)(t.A,{}),block:!0,children:A("session.launcher.AddEnvironmentVariable")})})]})}}))}},93304:(e,n,a)=>{a.d(n,{J:()=>V,e:()=>I});var l=a(56276),i=a(11863);const o=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"uuid"}],n=[{kind:"Variable",name:"id",variableName:"uuid"}],a={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageTagsUNSAFELazySessionImageTagQuery",selections:[{alias:null,args:n,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[a,l,i],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageTagsUNSAFELazySessionImageTagQuery",selections:[{alias:null,args:n,concreteType:"ComputeSession",kind:"LinkedField",name:"compute_session",plural:!1,selections:[a,l,i,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"561670e250a47b880df70cc432c19049",id:null,metadata:{},name:"ImageTagsUNSAFELazySessionImageTagQuery",operationKind:"query",text:"query ImageTagsUNSAFELazySessionImageTagQuery(\n  $uuid: UUID!\n) {\n  compute_session(id: $uuid) {\n    image\n    mounts\n    architecture\n    id\n  }\n}\n"}}}();o.hash="20cd966dac98c484e7c795ff3d7e78a4";const t=o;var r=a(48880),s=a(40690),d=a(90679),u=a(2289),m=a(46072),c=a(42338),g=a(76591),v=a(67631),p=a(47699),h=a.n(p),y=a(17534),A=a(46336),f=a(89374);const x=["image"],_=["image"],j=["image"],k=["tag","labels","highlightKeyword"],F=e=>{let{image:n}=e,a=(0,i.A)(e,x);n=n||"";const[,{getImageAliasName:o,getBaseVersion:t,tagAlias:r}]=(0,s.Gj)();return(0,f.jsx)(d.A,(0,l.A)({values:[{label:r(o(n)),color:"blue"},{label:t(n),color:"green"}]},a))},w=e=>{let{image:n}=e,a=(0,i.A)(e,_);n=n||"";const[,{getBaseImage:o,tagAlias:t}]=(0,s.Gj)();return h().isEmpty(t(o(n)))?null:(0,f.jsx)(c.A,(0,l.A)((0,l.A)({color:"green"},a),{},{children:t(o(n))}))},b=e=>{let{image:n}=e,a=(0,i.A)(e,j);n=n||"";const[,{getArchitecture:o,tagAlias:t}]=(0,s.Gj)();return h().isEmpty(t(o(n)))?null:(0,f.jsx)(c.A,(0,l.A)((0,l.A)({color:"green"},a),{},{children:o(n)}))},S=y.memo((function(e){let{image:n}=e;return n=n||"",(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(F,{image:n}),(0,f.jsx)(w,{image:n}),(0,f.jsx)(b,{image:n})]})})),V=e=>{let{tag:n,labels:a,highlightKeyword:o}=e,t=(0,i.A)(e,k);a=a||[];const[,{getTags:u,tagAlias:g}]=(0,s.Gj)(),v=u(n,a);return(0,f.jsx)(y.Fragment,(0,l.A)((0,l.A)({},t),{},{children:h().map(v,((e,n)=>{const a="Customized"===e.key,l=g(e.key+e.value);return h().isEqual(l,(0,r.WY)(e.key+e.value))?(0,f.jsx)(d.A,{highlightKeyword:o,values:[{label:g(e.key),color:a?"cyan":"blue"},{label:e.value,color:a?"cyan":"blue"}]},e.key):(0,f.jsx)(c.A,{color:a?"cyan":"blue",children:(0,f.jsx)(m.A,{keyword:o,children:l},n)},e.key)}))}))},I=e=>{let{sessionId:n}=e;const{token:a}=g.A.useToken(),{compute_session:l}=(0,A.useLazyLoadQuery)(t,{uuid:n||""},{fetchPolicy:n?"store-or-network":"store-only"}),i=(null===l||void 0===l?void 0:l.image)&&(null===l||void 0===l?void 0:l.architecture)&&l.image+"@"+l.architecture;return i?(0,f.jsxs)(v.OO,{gap:["xs",0],wrap:"wrap",children:[(0,f.jsx)(u.A,{image:i,style:{marginRight:a.marginXS}}),(0,f.jsx)(S,{image:i})]}):null}}}]);
//# sourceMappingURL=9265.380f51b9.chunk.js.map