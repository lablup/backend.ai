"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[864,3988],{13988:(e,l,n)=>{n.r(l),n.d(l,{default:()=>He});var a=n(56276),r=n(11863),i=n(7871);const o=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"vfolderGlobalId"}],l=[{kind:"Variable",name:"id",variableName:"vfolderGlobalId"}],n={alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"FolderExplorerModalQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a,r,i,o,t,s,{args:null,kind:"FragmentSpread",name:"FolderExplorerHeaderFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeDescriptionFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"FolderExplorerModalQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a,r,i,o,t,s,{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},i],storageKey:null}]},params:{cacheID:"2b13f520ce7b35fc61805141d89f9471",id:null,metadata:{},name:"FolderExplorerModalQuery",operationKind:"query",text:'query FolderExplorerModalQuery(\n  $vfolderGlobalId: String!\n) {\n  vfolder_node(id: $vfolderGlobalId) {\n    group\n    group_name\n    unmanaged_path @since(version: "25.04.0")\n    permissions\n    host\n    id\n    name\n    ...FolderExplorerHeaderFragment\n    ...VFolderNodeDescriptionFragment\n    ...VFolderNameTitleNodeFragment\n  }\n}\n\nfragment EditableVFolderNameFragment on VirtualFolderNode {\n  id\n  name\n  user\n  group\n  status\n}\n\nfragment FileBrowserButtonFragment on VirtualFolderNode {\n  id\n  row_id\n  host\n}\n\nfragment FolderExplorerHeaderFragment on VirtualFolderNode {\n  id\n  user\n  permission\n  row_id\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderNameTitleNodeFragment\n  ...VFolderNodeIdenticonFragment\n  ...EditableVFolderNameFragment\n  ...FileBrowserButtonFragment\n  ...SFTPServerButtonFragment\n}\n\nfragment SFTPServerButtonFragment on VirtualFolderNode {\n  id\n  row_id\n  host\n}\n\nfragment VFolderNameTitleNodeFragment on VirtualFolderNode {\n  name\n}\n\nfragment VFolderNodeDescriptionFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n  unmanaged_path @since(version: "25.04.0")\n  ...VFolderPermissionCellFragment\n  ...useVirtualFolderNodePathFragment\n}\n\nfragment VFolderNodeIdenticonFragment on VirtualFolderNode {\n  id\n}\n\nfragment VFolderPermissionCellFragment on VirtualFolderNode {\n  permissions\n}\n\nfragment useVirtualFolderNodePathFragment on VirtualFolderNode {\n  id\n  host\n  quota_scope_id\n  user\n  user_email\n  group\n  group_name\n  creator\n  usage_mode\n  permission\n  ownership_type\n  max_files\n  max_size\n  created_at\n  last_used\n  num_files\n  cur_size\n  cloneable\n  status\n  permissions @since(version: "24.09.0")\n}\n'}}}();o.hash="bc8ed85ec64ce6416231f71a40388f03";const t=o;var s=n(20864);const d={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FolderExplorerHeaderFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{kind:"RequiredField",field:{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},action:"THROW"},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderNameTitleNodeFragment"},{args:null,kind:"FragmentSpread",name:"VFolderNodeIdenticonFragment"},{args:null,kind:"FragmentSpread",name:"EditableVFolderNameFragment"},{args:null,kind:"FragmentSpread",name:"FileBrowserButtonFragment"},{args:null,kind:"FragmentSpread",name:"SFTPServerButtonFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"8c6e3cf5a92c8f51f54f315622c8bb75"},u=d;var c=n(15584),m=n(18537),g=n(63979);const p={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"FileBrowserButtonFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"4efd44f6f555400c7682e3af18779331"},y=p;var v=n(36961),f=n(45505),F=n(69266),h=n(7265),k=n(60669),S=n.n(k),_=n(29262),x=n(99118),b=n(84372),w=n(37138),K=n(52053);const A=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],l={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},n=[l,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],a=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"namespace",storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:n,storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"tags",plural:!0,selections:n,storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useDefaultImagesWithFallbackQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useDefaultImagesWithFallbackQuery",selections:a},params:{cacheID:"50986f0b2ceaf84de4cd397a2d793329",id:null,metadata:{},name:"useDefaultImagesWithFallbackQuery",operationKind:"query",text:'query useDefaultImagesWithFallbackQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    id\n    tag\n    registry\n    architecture\n    name @deprecatedSince(version: "24.12.0")\n    namespace @since(version: "24.12.0")\n    labels {\n      key\n      value\n    }\n    tags @since(version: "24.12.0") {\n      key\n      value\n    }\n    resource_limits {\n      key\n      min\n      max\n    }\n  }\n}\n'}}}();A.hash="10405daea8947c9eb138ed58ff364fe0";const j=A;var N=n(93687),P=n(17471),V=n(19429),T=n(31871);const I=j,z=(0,V.t_)((async()=>{var e,l;const n=await w.VV;return S().isEmpty(null===(e=n._config)||void 0===e?void 0:e.defaultFileBrowserImage)||null===(l=n._config)||void 0===l?void 0:l.defaultFileBrowserImage})),E=(0,V.t_)((async()=>{var e,l;const n=await w.VV;return S().isEmpty(null===(e=n._config)||void 0===e?void 0:e.systemSSHImage)||null===(l=n._config)||void 0===l?void 0:l.systemSSHImage})),B=(0,N.eU)();function O(e){var l;return"ai.backend.service-ports"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l.toLowerCase().includes("filebrowser"))}function D(e){var l;return null===e||void 0===e||null===(l=e.labels)||void 0===l?void 0:l.find(O)}function Q(e){var l;return null===e||void 0===e||null===(l=e.images)||void 0===l?void 0:l.filter(D)}function R(e){var l;return"ai.backend.role"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l.toLowerCase().includes("system"))}function M(e){var l;return null===e||void 0===e||null===(l=e.labels)||void 0===l?void 0:l.find(R)}function H(e){var l;return null===e||void 0===e||null===(l=e.images)||void 0===l?void 0:l.filter(M)}const q=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"domainName"},{defaultValue:null,kind:"LocalArgument",name:"projectId"},{defaultValue:null,kind:"LocalArgument",name:"resourcePolicyName"}],l=[{alias:null,args:null,kind:"ScalarField",name:"allowed_vfolder_hosts",storageKey:null}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"domainName"}],concreteType:"Domain",kind:"LinkedField",name:"domain",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"domain_name",variableName:"domainName"},{kind:"Variable",name:"id",variableName:"projectId"}],concreteType:"Group",kind:"LinkedField",name:"group",plural:!1,selections:l,storageKey:null},{alias:null,args:[{kind:"Variable",name:"name",variableName:"resourcePolicyName"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:l,storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:n,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",selections:n},params:{cacheID:"f7d16150a7d77cb465733a2933a08261",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_AllowedVFolderHostsQuery(\n  $domainName: String\n  $projectId: UUID!\n  $resourcePolicyName: String\n) {\n  domain(name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  group(id: $projectId, domain_name: $domainName) {\n    allowed_vfolder_hosts\n  }\n  keypair_resource_policy(name: $resourcePolicyName) {\n    allowed_vfolder_hosts\n  }\n}\n"}}}();q.hash="616594ca9d6c787458c32688c1a25b1f";const L=q,C=function(){var e={defaultValue:null,kind:"LocalArgument",name:"accessKey"},l={defaultValue:null,kind:"LocalArgument",name:"domainName"},n=[{kind:"Variable",name:"access_key",variableName:"accessKey"},{kind:"Variable",name:"domain_name",variableName:"domainName"}],a={alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null};return{fragment:{argumentDefinitions:[e,l],kind:"Fragment",metadata:null,name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{kind:"RequiredField",field:{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{kind:"RequiredField",field:a,action:"THROW"}],storageKey:null},action:"THROW"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[l,e],kind:"Operation",name:"useMergedAllowedStorageHostPermission_KeypairQuery",selections:[{alias:null,args:n,concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"ca4270af888b8158a6bbb4fe9dc305ca",id:null,metadata:{},name:"useMergedAllowedStorageHostPermission_KeypairQuery",operationKind:"query",text:"query useMergedAllowedStorageHostPermission_KeypairQuery(\n  $domainName: String!\n  $accessKey: String\n) {\n  keypair(domain_name: $domainName, access_key: $accessKey) {\n    resource_policy\n    id\n  }\n}\n"}}}();C.hash="43280e755e9e0f52dcd74eb7aa29d60c";const U=C;var W=n(60002);const $=(e,l,n)=>{var a,r,i;const o=(0,w.CX)(),{keypair:t}=(0,b.useLazyLoadQuery)(U,{domainName:e,accessKey:n},{fetchPolicy:"store-or-network"}),s=(0,b.useLazyLoadQuery)(L,{domainName:e,projectId:l,resourcePolicyName:null===t||void 0===t?void 0:t.resource_policy},{fetchPolicy:"store-or-network"}),d=JSON.parse((null===s||void 0===s||null===(a=s.domain)||void 0===a?void 0:a.allowed_vfolder_hosts)||"{}"),u=JSON.parse((null===s||void 0===s||null===(r=s.group)||void 0===r?void 0:r.allowed_vfolder_hosts)||"{}"),c=JSON.parse((null===s||void 0===s||null===(i=s.keypair_resource_policy)||void 0===i?void 0:i.allowed_vfolder_hosts)||"{}"),{data:m}=(0,W.U)({queryKey:["vhostInfo"],queryFn:async()=>await o.vfolder.list_hosts(),staleTime:3e5,gcTime:0}),g=Object.assign({},...m.allowed.map((e=>{return{[e]:(l=[d[e],u[e],c[e]],[...new Set([].concat(...l.filter(Boolean)))])};var l})));return{StorageHostPermissionByDomain:d,StorageHostPermissionByGroup:u,StorageHostPermissionByResourcePolicy:c,unitedAllowedPermissionByVolume:g}};var G=n(13215),X=n(26862);const Z=["showTitle","vfolderFrgmt"],J=e=>{var l;const n=(0,c.c)(41);let i,o,t;if(n[0]!==e){var s=e;({showTitle:o,vfolderFrgmt:t}=s),i=(0,r.A)(s,Z),n[0]=e,n[1]=i,n[2]=o,n[3]=t}else i=n[1],o=n[2],t=n[3];const d=void 0===o||o,{t:u}=(0,x.Bd)(),{message:m,modal:g}=v.A.useApp(),{logger:p}=(0,h.Q7t)(),k=(0,w.CX)(),A=(0,w.eZ)(),j=(0,K.hd)(),N=null===k||void 0===k||null===(l=k._config)||void 0===l?void 0:l.accessKey,{unitedAllowedPermissionByVolume:V}=$(A,j.id,N),{getErrorMessage:E}=(0,h.B78)(),{startSessionWithDefault:B,upsertSessionNotification:O}=(0,G.G)(),D=(()=>{const e=(0,c.c)(7),[l,n]=(0,P.fp)(z),a=(0,b.useRelayEnvironment)();let r;e[0]!==l||e[1]!==a||e[2]!==n?(r=()=>{void 0===l&&(0,b.fetchQuery)(a,I,{installed:!0},{fetchPolicy:"store-or-network"}).toPromise().then(Q).then((async e=>{const l=S().first(e);n(l?(0,T.A_)(l):null)})).catch((()=>{n(null)}))},e[0]=l,e[1]=a,e[2]=n,e[3]=r):r=e[3];const i=(0,_.useEffectEvent)(r);let o,t;return e[4]!==i?(o=()=>{i()},e[4]=i,e[5]=o):o=e[5],e[6]===Symbol.for("react.memo_cache_sentinel")?(t=[],e[6]=t):t=e[6],(0,_.useEffect)(o,t),l})();let R;n[4]===Symbol.for("react.memo_cache_sentinel")?(R=y,n[4]=R):R=n[4];const M=(0,b.useFragment)(R,t);let H;var q;n[5]!==V||n[6]!==(null===M||void 0===M?void 0:M.host)?(H=S().includes(V[null!==(q=null===M||void 0===M?void 0:M.host)&&void 0!==q?q:""],"mount-in-session"),n[5]=V,n[6]=null===M||void 0===M?void 0:M.host,n[7]=H):H=n[7];const L=H;let C;n[8]!==D||n[9]!==L||n[10]!==d||n[11]!==u?(C=()=>L?null===D?u("data.explorer.NoImagesSupportingFileBrowser"):!d&&D?u("data.explorer.ExecuteFileBrowser"):"":u("data.explorer.NoPermissionToMountFolder"),n[8]=D,n[9]=L,n[10]=d,n[11]=u,n[12]=C):C=n[12];const U=C;let W,J,Y;n[13]!==U?(W=U(),n[13]=U,n[14]=W):W=n[14],n[15]!==D?(J=D?void 0:{filter:"grayscale(100%)"},n[15]=D,n[16]=J):J=n[16],n[17]!==J?(Y=(0,X.jsx)(f.A,{width:"18px",src:"/resources/icons/filebrowser.svg",alt:"File Browser",preview:!1,style:J}),n[17]=J,n[18]=Y):Y=n[18];const ee=!D||!L;let le,ne,ae,re;return n[19]!==D||n[20]!==E||n[21]!==p||n[22]!==m||n[23]!==g||n[24]!==B||n[25]!==u||n[26]!==O||n[27]!==M?(le=async()=>{var e;if(!D)return;const l={sessionName:"filebrowser-".concat(M.row_id),sessionType:"interactive",environments:{version:D},allocationPreset:"minimum-required",cluster_mode:"single-node",cluster_size:1,mount_ids:[(null===(e=M.row_id)||void 0===e?void 0:e.replaceAll("-",""))||""]};await B(l).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&O(e.fulfilled,[{key:"filebrowser-".concat(M.row_id),extraData:{appName:"filebrowser"}}]),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const l=e.rejected[0].reason;g.error({title:null===l||void 0===l?void 0:l.title,content:E(l)})}})).catch((e=>{p.error("Unexpected error during session creation:",e),m.error(u("error.UnexpectedError"))}))},n[19]=D,n[20]=E,n[21]=p,n[22]=m,n[23]=g,n[24]=B,n[25]=u,n[26]=O,n[27]=M,n[28]=le):le=n[28],n[29]!==d||n[30]!==u?(ne=d&&u("data.explorer.ExecuteFileBrowser"),n[29]=d,n[30]=u,n[31]=ne):ne=n[31],n[32]!==i||n[33]!==ne||n[34]!==Y||n[35]!==ee||n[36]!==le?(ae=(0,X.jsx)(h.Fvl,(0,a.A)((0,a.A)({icon:Y,disabled:ee,action:le},i),{},{children:ne})),n[32]=i,n[33]=ne,n[34]=Y,n[35]=ee,n[36]=le,n[37]=ae):ae=n[37],n[38]!==ae||n[39]!==W?(re=(0,X.jsx)(F.A,{title:W,children:ae}),n[38]=ae,n[39]=W,n[40]=re):re=n[40],re},Y={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SFTPServerButtonFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"row_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"8bf5b2e08fd923cb5fc74aaa801b7e1f"},ee=Y,le=["showTitle","vfolderFrgmt"],ne=e=>{var l,n;const i=(0,c.c)(44);let o,t,s;if(i[0]!==e){var d=e;({showTitle:t,vfolderFrgmt:s}=d),o=(0,r.A)(d,le),i[0]=e,i[1]=o,i[2]=t,i[3]=s}else o=i[1],t=i[2],s=i[3];const u=void 0===t||t,{logger:m}=(0,h.Q7t)(),{t:g}=(0,x.Bd)(),{message:p,modal:y}=v.A.useApp(),k=(0,w.CX)(),A=(0,w.eZ)(),j=(0,K.hd)(),N=null===k||void 0===k||null===(l=k._config)||void 0===l?void 0:l.accessKey,{unitedAllowedPermissionByVolume:V}=$(A,j.id,N),{vhostInfo:z}=(0,K.Bk)(),{getErrorMessage:O}=(0,h.B78)(),{startSessionWithDefault:D,upsertSessionNotification:Q}=(0,G.G)(),{systemSSHImage:R}=(()=>{const e=(0,c.c)(11),[l,n]=(0,P.fp)(E),[a,r]=(0,P.fp)(B),i=(0,b.useRelayEnvironment)();let o;e[0]!==i||e[1]!==n||e[2]!==r||e[3]!==l?(o=()=>{void 0===l&&(0,b.fetchQuery)(i,I,{installed:!0},{fetchPolicy:"store-or-network"}).toPromise().then(H).then((async e=>{const l=S().first(e);n(l?(0,T.A_)(l):null),r(l||void 0)})).catch((()=>{n(null)}))},e[0]=i,e[1]=n,e[2]=r,e[3]=l,e[4]=o):o=e[4];const t=(0,_.useEffectEvent)(o);let s,d,u;return e[5]!==t?(s=()=>{t()},e[5]=t,e[6]=s):s=e[6],e[7]===Symbol.for("react.memo_cache_sentinel")?(d=[],e[7]=d):d=e[7],(0,_.useEffect)(s,d),e[8]!==l||e[9]!==a?(u={systemSSHImage:l,systemSSHImageInfo:a},e[8]=l,e[9]=a,e[10]=u):u=e[10],u})();let M;i[4]===Symbol.for("react.memo_cache_sentinel")?(M=ee,i[4]=M):M=i[4];const q=(0,b.useFragment)(M,s),L=null===z||void 0===z||null===(n=z.volume_info[(null===q||void 0===q?void 0:q.host)||""])||void 0===n?void 0:n.sftp_scaling_groups;let C;var U;i[5]!==V||i[6]!==(null===q||void 0===q?void 0:q.host)?(C=S().includes(V[null!==(U=null===q||void 0===q?void 0:q.host)&&void 0!==U?U:""],"mount-in-session"),i[5]=V,i[6]=null===q||void 0===q?void 0:q.host,i[7]=C):C=i[7];const W=C;let Z;i[8]!==W||i[9]!==L||i[10]!==u||i[11]!==R||i[12]!==g?(Z=()=>W?S().isEmpty(L)?g("data.explorer.NoSFTPSupportingScalingGroup"):R?!u&&R?g("data.explorer.RunSSH/SFTPserver"):"":g("data.explorer.NoImagesSupportingSystemSession"):g("data.explorer.NoPermissionToMountFolder"),i[8]=W,i[9]=L,i[10]=u,i[11]=R,i[12]=g,i[13]=Z):Z=i[13];const J=Z;let Y,ne,ae,re,ie,oe,te;return i[14]!==J?(Y=J(),i[14]=J,i[15]=Y):Y=i[15],i[16]!==W||i[17]!==L||i[18]!==R?(ne=S().isEmpty(L)||!R||!W,i[16]=W,i[17]=L,i[18]=R,i[19]=ne):ne=i[19],i[20]===Symbol.for("react.memo_cache_sentinel")?(ae=(0,X.jsx)(f.A,{width:"18px",src:"/resources/icons/sftp.png",alt:"SSH / SFTP",preview:!1}),i[20]=ae):ae=i[20],i[21]!==k._config||i[22]!==O||i[23]!==m||i[24]!==p||i[25]!==y||i[26]!==(null===L||void 0===L?void 0:L[0])||i[27]!==D||i[28]!==R||i[29]!==g||i[30]!==Q||i[31]!==(null===q||void 0===q?void 0:q.row_id)?(re=async()=>{var e,l,n;const r=(0,a.A)((0,a.A)({sessionName:"sftp-".concat(null===q||void 0===q?void 0:q.row_id),sessionType:"system"},null!==(e=k._config)&&void 0!==e&&e.systemSSHImage&&null!==(l=k._config)&&void 0!==l&&l.allow_manual_image_name_for_session?{environments:{manual:k._config.systemSSHImage}}:{environments:{version:R||""}}),{},{cluster_mode:"single-node",cluster_size:1,mount_ids:[(null===q||void 0===q||null===(n=q.row_id)||void 0===n?void 0:n.replaceAll("-",""))||""],resourceGroup:null===L||void 0===L?void 0:L[0]});await D(r).then((e=>{if(null!==e&&void 0!==e&&e.fulfilled&&e.fulfilled.length>0&&Q(e.fulfilled,[{key:"sftp-".concat(null===q||void 0===q?void 0:q.row_id)}]),null!==e&&void 0!==e&&e.rejected&&e.rejected.length>0){const l=e.rejected[0].reason;y.error({title:null===l||void 0===l?void 0:l.title,content:O(l)})}})).catch((e=>{m.error("Unexpected error during session creation:",e),p.error(g("error.UnexpectedError"))}))},i[21]=k._config,i[22]=O,i[23]=m,i[24]=p,i[25]=y,i[26]=null===L||void 0===L?void 0:L[0],i[27]=D,i[28]=R,i[29]=g,i[30]=Q,i[31]=null===q||void 0===q?void 0:q.row_id,i[32]=re):re=i[32],i[33]!==u||i[34]!==g?(ie=u&&g("data.explorer.RunSSH/SFTPserver"),i[33]=u,i[34]=g,i[35]=ie):ie=i[35],i[36]!==o||i[37]!==ne||i[38]!==re||i[39]!==ie?(oe=(0,X.jsx)(h.Fvl,(0,a.A)((0,a.A)({disabled:ne,icon:ae,action:re},o),{},{children:ie})),i[36]=o,i[37]=ne,i[38]=re,i[39]=ie,i[40]=oe):oe=i[40],i[41]!==oe||i[42]!==Y?(te=(0,X.jsx)(F.A,{title:Y,children:oe}),i[41]=oe,i[42]=Y,i[43]=te):te=i[43],te};var ae=n(2145),re=n(87272),ie=n(20341),oe=n(69319),te=n(39648);const se=e=>{const l=(0,c.c)(26),{vfolderNodeFrgmt:n,titleStyle:r}=e,{token:i}=re.A.useToken(),{lg:o}=ie.Ay.useBreakpoint();let t;l[0]===Symbol.for("react.memo_cache_sentinel")?(t=u,l[0]=t):t=l[0];const s=(0,b.useFragment)(t,n);let d,p,y,v,f,F,k,S;return l[1]===Symbol.for("react.memo_cache_sentinel")?(d={width:"100%"},l[1]=d):d=l[1],l[2]!==r?(p=(0,a.A)({flex:1,fontWeight:"normal"},r),l[2]=r,l[3]=p):p=l[3],l[4]!==i.borderRadius||l[5]!==i.colorBorderSecondary||l[6]!==i.fontSizeHeading3||l[7]!==i.fontSizeHeading4||l[8]!==s?(y=s?(0,X.jsx)(ae.A,{vfolderNodeIdenticonFrgmt:s,style:{fontSize:i.fontSizeHeading4}}):(0,X.jsx)(h.OOm,{style:{borderColor:i.colorBorderSecondary,borderWidth:1,borderStyle:"solid",width:i.fontSizeHeading3,height:i.fontSizeHeading3,borderRadius:i.borderRadius}}),l[4]=i.borderRadius,l[5]=i.colorBorderSecondary,l[6]=i.fontSizeHeading3,l[7]=i.fontSizeHeading4,l[8]=s,l[9]=y):y=l[9],l[10]!==s?(v=s&&(0,X.jsx)(m.A,{vfolderFrgmt:s,enableLink:!1,component:oe.A.Title,level:3,style:{margin:0,width:"100%"},ellipsis:!0,editable:{triggerType:["icon","text"]},inputProps:{size:"large",count:{max:64,show:!0},style:{fontWeight:"normal"}}}),l[10]=s,l[11]=v):v=l[11],l[12]!==p||l[13]!==y||l[14]!==v?(f=(0,X.jsxs)(h.OOm,{"data-testid":"folder-explorer-title",gap:"xs",style:p,children:[y,v]}),l[12]=p,l[13]=y,l[14]=v,l[15]=f):f=l[15],l[16]!==o||l[17]!==s?(F=!s||null!==s&&void 0!==s&&s.unmanaged_path?null:(0,X.jsxs)(_.Suspense,{fallback:(0,X.jsx)(te.A.Button,{active:!0}),children:[(0,X.jsx)(g.A,{children:(0,X.jsx)(J,{vfolderFrgmt:s,showTitle:o})}),(0,X.jsx)(g.A,{children:(0,X.jsx)(ne,{vfolderFrgmt:s,showTitle:o})})]}),l[16]=o,l[17]=s,l[18]=F):F=l[18],l[19]!==F||l[20]!==i.marginSM?(k=(0,X.jsx)(h.OOm,{"data-testid":"folder-explorer-actions",justify:"end",gap:i.marginSM,children:F}),l[19]=F,l[20]=i.marginSM,l[21]=k):k=l[21],l[22]!==f||l[23]!==k||l[24]!==i.marginMD?(S=(0,X.jsxs)(h.OOm,{"data-testid":"folder-explorer-header",justify:"between",gap:i.marginMD,style:d,children:[f,k]}),l[22]=f,l[23]=k,l[24]=i.marginMD,l[25]=S):S=l[25],S};var de=n(40720);const ue=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"id"}],l=[{kind:"Variable",name:"id",variableName:"id"}],n={alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},a={alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"VFolderNodeDescriptionPermissionRefreshQuery",selections:[{alias:null,args:l,concreteType:"VirtualFolderNode",kind:"LinkedField",name:"vfolder_node",plural:!1,selections:[n,a,{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}]},params:{cacheID:"3aee063a4b508648c2365ba6c7f0f44a",id:null,metadata:{},name:"VFolderNodeDescriptionPermissionRefreshQuery",operationKind:"query",text:"query VFolderNodeDescriptionPermissionRefreshQuery(\n  $id: String!\n) {\n  vfolder_node(id: $id) {\n    permission\n    permissions\n    id\n  }\n}\n"}}}();ue.hash="36063c8300310d9ef6c369b49127a2a2";const ce=ue,me={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"VFolderNodeDescriptionFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"unmanaged_path",storageKey:null},{args:null,kind:"FragmentSpread",name:"VFolderPermissionCellFragment"},{args:null,kind:"FragmentSpread",name:"useVirtualFolderNodePathFragment"}],type:"VirtualFolderNode",abstractKey:null,hash:"f4ca4470ea635f85c8c346eed0a5fe8c"},ge=me;var pe=n(476),ye=n(63590);const ve={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useVirtualFolderNodePathFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"host",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"quota_scope_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"group_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creator",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"usage_mode",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permission",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ownership_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_used",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"num_files",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cur_size",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cloneable",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permissions",storageKey:null}],type:"VirtualFolderNode",abstractKey:null,hash:"439221036e87c57ca3ec1ce737e0cdf7"},fe=ve,Fe=e=>{const l=(0,b.useFragment)(fe,e),[n,a]=S().split(null===l||void 0===l?void 0:l.quota_scope_id,":"),r=(0,h.omW)(null===l||void 0===l?void 0:l.id),i=r.slice(0,2),o=r.slice(2,4),t=r.slice(4),s="".concat(a.replaceAll("-",""),"/").concat(i,"/").concat(o,"/").concat(t.replaceAll("-",""));return{quotaScopeType:n,quotaScopeIdWithoutType:a,vfolderId:r,vfolderIdPrefix1:i,vfolderIdPrefix2:o,vfolderIdRest:t,vfolderPath:s}};var he=n(71356);const ke=e=>{let{vfolderNodeFrgmt:l}=e;const{quotaScopeType:n,quotaScopeIdWithoutType:a,vfolderId:r,vfolderIdPrefix1:i,vfolderIdPrefix2:o,vfolderIdRest:t}=Fe(l),{token:s}=re.A.useToken();return(0,X.jsxs)(h.OOm,{direction:"row",align:"start",justify:"start",wrap:"wrap",gap:3,children:[(0,X.jsx)(h.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"(root)"}),(0,X.jsx)(h.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,X.jsxs)(h.OOm,{direction:"column",align:"start",justify:"start",children:[(0,X.jsx)(h.mQ0,{monospace:!0,copyable:{text:a},style:{fontSize:"0.9em"},children:S().truncate(a.replaceAll("-",""),{length:15})}),(0,X.jsxs)(h.mQ0,{type:"secondary",style:{fontSize:s.fontSizeSM},children:["Quota Scope ID (",S().upperFirst(n),")"]})]}),(0,X.jsx)(h.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,X.jsxs)(h.OOm,{direction:"column",align:"start",justify:"start",children:[(0,X.jsxs)(h.OOm,{gap:3,children:[(0,X.jsx)(h.mQ0,{monospace:!0,style:{fontSize:"0.9em"},children:i}),(0,X.jsx)(h.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,X.jsx)(h.mQ0,{monospace:!0,style:{fontSize:"0.9em"},children:o}),(0,X.jsx)(h.mQ0,{monospace:!0,type:"secondary",style:{fontSize:"0.9em"},children:"/"}),(0,X.jsx)(h.mQ0,{monospace:!0,copyable:{text:r},style:{fontSize:"0.9em"},children:S().truncate(t.replaceAll("-",""),{length:7})})]}),(0,X.jsx)(h.mQ0,{type:"secondary",style:{fontSize:s.fontSizeSM},children:"VFolder ID"})]})]})};var Se=n(43014),_e=n(1272),xe=n(49969),be=n(47671),we=n.n(be);const Ke=["vfolderNodeFrgmt"],Ae=e=>{var l;let{vfolderNodeFrgmt:n}=e,i=(0,r.A)(e,Ke);const{t:o}=(0,x.Bd)(),{token:t}=re.A.useToken(),{message:s}=v.A.useApp(),{getErrorMessage:d}=(0,h.B78)(),u=(0,b.useRelayEnvironment)(),c=(0,K.hd)(),m=(0,w.CX)(),[g]=(0,pe.U6)(),p=(0,ye.ET)({mutationFn:e=>{let{permission:l,id:n}=e;return m.vfolder.update_folder({permission:l},n)}}),y=(0,b.useFragment)(ge,n),{vfolderPath:f}=Fe(y),F=(0,h.omW)(y.id),k=(0,h.YM3)([!(null!==y&&void 0!==y&&y.unmanaged_path)&&{key:"path",label:(0,X.jsx)(oe.A.Text,{copyable:{text:f},style:{color:t.colorTextLabel},children:o("data.folders.Path")}),children:(0,X.jsx)(ke,{vfolderNodeFrgmt:y})},{key:"status",label:o("data.folders.Status"),children:(0,X.jsx)(h.d6Z,{color:y.status?he.C[y.status]:void 0,children:S().toUpper(y.status||"")})},{key:"host",label:o("data.Host"),children:y.host},{key:"ownership_type",label:o("data.folders.Ownership"),children:"user"===(null===y||void 0===y?void 0:y.ownership_type)?(0,X.jsxs)(h.OOm,{gap:"xs",children:[(0,X.jsx)(oe.A.Text,{children:o("data.User")}),(0,X.jsx)(Se.A,{style:{color:t.colorTextTertiary}})]}):(0,X.jsxs)(h.OOm,{gap:"xs",children:[(0,X.jsx)(oe.A.Text,{children:o("data.Project")}),(0,X.jsx)(h.ObC,{style:{color:t.colorTextTertiary}})]})},((null===y||void 0===y?void 0:y.user)===g.uuid||m.is_admin&&(null===y||void 0===y?void 0:y.group)===(null===c||void 0===c?void 0:c.id))&&{key:"permission",label:o("data.folders.MountPermission"),children:(0,X.jsx)(h.xrr,{defaultValue:"wd"===y.permission?"rw":y.permission,options:[{value:"ro",label:o("data.ReadOnly")},{value:"rw",label:o("data.ReadWrite")}],onChange:e=>{p.mutate({permission:e,id:F},{onSuccess:()=>{s.success(o("data.permission.PermissionModified")),document.dispatchEvent(new CustomEvent("backend-ai-folder-updated")),(0,b.fetchQuery)(u,ce,{id:y.id}).toPromise()},onError:e=>{s.error(d(e))}})},popupMatchSelectWidth:!1})},{key:"owner",label:o("data.folders.Owner"),children:(null===y||void 0===y?void 0:y.user)===(null===g||void 0===g?void 0:g.uuid)||m.is_admin&&(null===y||void 0===y?void 0:y.group)===(null===c||void 0===c?void 0:c.id)?(0,X.jsx)(h.OOm,{justify:"start",children:(0,X.jsx)(_e.A,{})}):null},null!==y.user_email&&{key:"user_email",label:o("data.User"),children:(0,X.jsx)(oe.A.Text,{copyable:!0,children:y.user_email})},null!==y.group_name&&{key:"group_name",label:o("data.Project"),children:y.group_name},{key:"cloneable",label:o("data.folders.Cloneable"),children:y.cloneable?(0,X.jsx)(h.OOm,{justify:"start",children:(0,X.jsx)(_e.A,{})}):null},{key:"max_size",label:o("data.folders.MaxSize"),children:y.max_size?null===(l=(0,T.Gh)(y.max_size,"g",2))||void 0===l?void 0:l.displayValue:"\u221e"},{key:"usage",label:o("data.UsageMode"),children:y.usage_mode},{key:"created_at",label:o("data.folders.CreatedAt"),children:we()(y.created_at).format("lll")}]);return(0,X.jsx)(xe.A,(0,a.A)({bordered:!0,column:1,size:"small",items:k,styles:{content:{wordBreak:"break-word",overflowWrap:"break-word"}}},i))};var je=n(42829),Ne=n(43375),Pe=n(61029);const Ve=["targetVFolderId","currentPath","fileInfo","onRequestClose","uploadFiles"],Te=(e,l)=>{const n=e.languages.getLanguages();for(const o of n){var a;if(null!==(a=o.extensions)&&void 0!==a&&a.some((e=>l.endsWith(e)))){var r,i;const e=null!==(r=null===(i=o.mimetypes)||void 0===i?void 0:i[0])&&void 0!==r?r:"text/plain";return{detectedLanguage:o.id,detectedMimeType:e}}}return{detectedLanguage:"plaintext",detectedMimeType:"text/plain"}},Ie=e=>{var l;const n=(0,c.c)(76);let i,o,t,s,d,u;if(n[0]!==e){var m=e;({targetVFolderId:d,currentPath:i,fileInfo:o,onRequestClose:s,uploadFiles:u}=m),t=(0,r.A)(m,Ve),n[0]=e,n[1]=i,n[2]=o,n[3]=t,n[4]=s,n[5]=d,n[6]=u}else i=n[1],o=n[2],t=n[3],s=n[4],d=n[5],u=n[6];const{t:g}=(0,x.Bd)(),{isDarkMode:p}=(0,je.e)(),{message:y}=v.A.useApp(),f=(0,h.kqi)(),{getErrorMessage:F}=(0,h.B78)(),k=(0,Pe.jE)(),S=(0,_.useRef)(null),b=(0,_.useRef)("text/plain");let w;var K,A,j;n[7]!==i||n[8]!==(null===(l=o)||void 0===l?void 0:l.name)?(w="."===i?null===(K=o)||void 0===K?void 0:K.name:"".concat(i,"/").concat(null===(A=o)||void 0===A?void 0:A.name).replace(/^\.\//,""),n[7]=i,n[8]=null===(j=o)||void 0===j?void 0:j.name,n[9]=w):w=n[9];const N=w;let P,V;n[10]!==N||n[11]!==d?(P=["textFileContent",d,N],n[10]=N,n[11]=d,n[12]=P):P=n[12],n[13]!==f||n[14]!==N||n[15]!==d?(V=async()=>{const e=await f.vfolder.request_download_token(N,d,!1),l="".concat(e.url,"?token=").concat(e.token,"&archive=false"),n=await fetch(l);if(!n.ok)throw new Error("HTTP error! status: ".concat(n.status));return(await n.blob()).text()},n[13]=f,n[14]=N,n[15]=d,n[16]=V):V=n[16];const T=!!t.open&&!!o&&!!d;let I;n[17]!==P||n[18]!==V||n[19]!==T?(I={queryKey:P,queryFn:V,enabled:T,staleTime:0,gcTime:0},n[17]=P,n[18]=V,n[19]=T,n[20]=I):I=n[20];const{data:z,error:E,isFetching:B}=(0,ye.nN)(I);let O,D,Q,R;n[21]!==i||n[22]!==z||n[23]!==o||n[24]!==d||n[25]!==u?(O=async()=>{var e,l,n;if(!o)return;const a=null!==(e=null!==(l=null===(n=S.current)||void 0===n?void 0:n.getValue())&&void 0!==l?l:z)&&void 0!==e?e:"",r=new Blob([a],{type:b.current}),t=new File([r],o.name,{type:b.current});await u([t],d,i)},n[21]=i,n[22]=z,n[23]=o,n[24]=d,n[25]=u,n[26]=O):O=n[26],n[27]!==N||n[28]!==s||n[29]!==k||n[30]!==d?(D=()=>{k.invalidateQueries({queryKey:["textFileContent",d,N]}),s(!0)},n[27]=N,n[28]=s,n[29]=k,n[30]=d,n[31]=D):D=n[31],n[32]!==F||n[33]!==y?(Q=e=>{y.error(F(e))},n[32]=F,n[33]=y,n[34]=Q):Q=n[34],n[35]!==O||n[36]!==D||n[37]!==Q?(R={mutationFn:O,onSuccess:D,onError:Q},n[35]=O,n[36]=D,n[37]=Q,n[38]=R):R=n[38];const M=(0,ye.ET)(R);let H,q,L,C,U;var W;(n[39]!==g?(H=g("button.Save"),n[39]=g,n[40]=H):H=n[40],n[41]!==g?(q=g("button.Cancel"),n[41]=g,n[42]=q):q=n[42],n[43]!==g?(L=g("data.explorer.EditFile"),n[43]=g,n[44]=L):L=n[44],n[45]!==L?(C=(0,X.jsx)(h.mQ0,{children:L}),n[45]=L,n[46]=C):C=n[46],n[47]!==o)?(U=o&&(0,X.jsxs)(h.mQ0,{type:"secondary",style:{fontWeight:"normal"},children:["- ",o.name,o.size>0&&" (".concat(null===(W=(0,h.GhK)(o.size,"auto"))||void 0===W?void 0:W.displayValue,")")]}),n[47]=o,n[48]=U):U=n[48];let $,G,Z;n[49]!==C||n[50]!==U?($=(0,X.jsxs)(h.OOm,{align:"center",gap:"xs",children:[C,U]}),n[49]=C,n[50]=U,n[51]=$):$=n[51],n[52]!==s?(G=()=>s(),n[52]=s,n[53]=G):G=n[53],n[54]!==M?(Z=()=>M.mutate(),n[54]=M,n[55]=Z):Z=n[55];const J=!!E;let Y,ee,le,ne;return n[56]!==J?(Y={disabled:J},n[56]=J,n[57]=Y):Y=n[57],n[58]===Symbol.for("react.memo_cache_sentinel")?(ee={height:"calc(100vh - 250px)"},n[58]=ee):ee=n[58],n[59]!==z||n[60]!==o||n[61]!==p||n[62]!==B||n[63]!==E||n[64]!==g?(le=(0,X.jsx)(h.OOm,{direction:"column",gap:"md",style:ee,children:E?(0,X.jsx)(h.RfO,{type:"error",showIcon:!0,title:g("data.explorer.FailedToLoadFile"),description:g("data.explorer.FailedToLoadFileDescription")}):B?(0,X.jsx)(te.A,{active:!0}):(0,X.jsx)(Ne.KE,{defaultValue:null!==z&&void 0!==z?z:"",beforeMount:e=>{var l;if(null!==(l=o)&&void 0!==l&&l.name){const{detectedMimeType:l}=Te(e,o.name);b.current=l}},onMount:(e,l)=>{var n;if(S.current=e,null!==(n=o)&&void 0!==n&&n.name){const{detectedLanguage:n}=Te(l,o.name),a=e.getModel();a&&l.editor.setModelLanguage(a,n)}},theme:p?"vs-dark":"light",loading:(0,X.jsx)(te.A,{active:!0}),width:"100%",height:"100%",options:{fixedOverflowWidgets:!0}})}),n[59]=z,n[60]=o,n[61]=p,n[62]=B,n[63]=E,n[64]=g,n[65]=le):le=n[65],n[66]!==t||n[67]!==M.isPending||n[68]!==H||n[69]!==q||n[70]!==$||n[71]!==G||n[72]!==Z||n[73]!==Y||n[74]!==le?(ne=(0,X.jsx)(h.IbE,(0,a.A)((0,a.A)({width:"100%",destroyOnHidden:!0,okText:H,cancelText:q},t),{},{title:$,onCancel:G,onOk:Z,confirmLoading:M.isPending,okButtonProps:Y,children:le})),n[66]=t,n[67]=M.isPending,n[68]=H,n[69]=q,n[70]=$,n[71]=G,n[72]=Z,n[73]=Y,n[74]=le,n[75]=ne):ne=n[75],ne};var ze=n(52251),Ee=n(10268),Be=n(90464),Oe=n(6294),De=n(62601);const Qe=["vfolderID","onRequestClose"];var Re;const Me=(0,Oe.rU)((e=>{let{css:l}=e;return{baiModalHeader:l(Re||(Re=(0,i.A)(["\n    .ant-modal-title {\n      width: 100%;\n    }\n  "])))}})),He=e=>{var l,n;let{vfolderID:i,onRequestClose:o}=e,d=(0,r.A)(e,Qe);const{t:u}=(0,x.Bd)(),{token:c}=re.A.useToken(),{xl:m}=ie.Ay.useBreakpoint(),{styles:g}=Me(),[p,y]=(0,h.zui)(),v=(0,w.CX)(),f=(0,w.eZ)(),F=(0,K.hd)(),k=null===v||void 0===v||null===(l=v._config)||void 0===l?void 0:l.accessKey,A=(0,_.useRef)(null),{unitedAllowedPermissionByVolume:j}=$(f,F.id,k),N=(0,_.useRef)(null),P=(0,_.useDeferredValue)(d.open),{vfolder_node:V}=(0,b.useLazyLoadQuery)(t,{vfolderGlobalId:(0,h.wcZ)("VirtualFolderNode",i)},{fetchPolicy:P&&d.open?"store-and-network":"store-only"}),{upsertNotification:T,closeNotification:I}=(0,De.js)(),{generateFolderPath:z}=(0,de.useFolderExplorerOpener)(),[E,B]=(0,_.useState)([]),[O,D]=(0,_.useState)(null),{uploadStatus:Q,uploadFiles:R}=(0,s.useFileUploadManager)(null===V||void 0===V?void 0:V.id,(null===V||void 0===V?void 0:V.name)||void 0);(0,h.$$z)((()=>{var e;null===(e=A.current)||void 0===e||e.refetch()}),Q&&!S().isEmpty(null===Q||void 0===Q?void 0:Q.pendingFiles)?5e3:null),(0,_.useEffect)((()=>{Q&&S().isEmpty(null===Q||void 0===Q?void 0:Q.pendingFiles)&&y()}),[Q,y]);const M=S().includes(j[null!==(n=null===V||void 0===V?void 0:V.host)&&void 0!==n?n:""],"download-file"),H=S().includes(null===V||void 0===V?void 0:V.permissions,"delete_content"),q=S().includes(null===V||void 0===V?void 0:V.permissions,"write_content"),L=null!==V&&void 0!==V&&V.unmanaged_path?(0,X.jsx)(ze.A,{title:u("explorer.NoExplorerSupportForUnmanagedFolder"),showIcon:!0}):V?(0,X.jsx)(h.Gt_,{ref:A,targetVFolderId:i,deletingFilePaths:E,fetchKey:p,onUpload:(e,l)=>{R(e,i,l)},onDeleteFilesInBackground:(e,l,n)=>{B(n),T({key:"delete:".concat(e),open:!0,message:(0,X.jsxs)("span",{children:[u("explorer.VFolder"),":\xa0",(0,X.jsx)(h.rmy,{style:{fontWeight:"normal"},to:z(l),onClick:()=>{I("delete:".concat(e))},children:"".concat(V.name)})]}),backgroundTask:{status:"pending",taskId:e,promise:null,percent:0,onChange:{pending:u("explorer.DeletingSelectedItems"),resolved:()=>(B([]),u("explorer.SelectedItemsDeletedSuccessfully")),rejected:()=>(B([]),u("explorer.SelectedItemsDeletionFailed"))}}})},enableDownload:M,enableDelete:H,enableWrite:q,enableEdit:q,tableProps:{scroll:m?{x:"max-content"}:{x:"max-content",y:"calc(100vh - 400px)"}},style:{paddingBottom:m?c.paddingLG:0},fileDropContainerRef:N,onClickEditFile:(e,l)=>{D({file:e,currentPath:l})}}):null,C=V?(0,X.jsx)(Ae,{vfolderNodeFrgmt:V}):null;return(0,X.jsxs)(h.IbE,(0,a.A)((0,a.A)({className:g.baiModalHeader,width:"90%",keyboard:!0,destroyOnHidden:!0,footer:null,style:{maxWidth:"1600px"},styles:{body:{height:"100vh"}},title:V?(0,X.jsx)(se,{titleStyle:{zIndex:c.zIndexPopupBase+2},vfolderNodeFrgmt:V}):null,bodyProps:{ref:N},onCancel:()=>{o()}},d),{},{children:[(0,X.jsx)(_.Suspense,{fallback:(0,X.jsx)(te.A,{active:!0}),children:P!==d.open||void 0===V?(0,X.jsx)(te.A,{active:!0}):(0,X.jsxs)(h.OOm,{direction:"column",gap:"lg",align:"stretch",children:[null===V?(0,X.jsx)(ze.A,{title:u("explorer.FolderNotFoundOrNoAccess"),type:"error",showIcon:!0}):(null===F||void 0===F?void 0:F.id)!==(null===V||void 0===V?void 0:V.group)&&null!==V&&void 0!==V&&V.group?(0,X.jsx)(ze.A,{title:V.group_name?u("data.NotInProject",{projectName:V.group_name}):u("data.BelongsToDifferentProject"),type:"info",showIcon:!0}):null,m?(0,X.jsxs)(Ee.A,{style:{gap:c.size},orientation:"horizontal",children:[(0,X.jsx)(Ee.A.Panel,{resizable:!1,children:L}),(0,X.jsx)(Ee.A.Panel,{defaultSize:500,children:C})]}):(0,X.jsxs)(h.OOm,{direction:"column",align:"stretch",children:[L,(0,X.jsx)(Be.A,{style:{borderColor:c.colorBorderSecondary}}),C]})]})}),(0,X.jsx)(h.XcZ,{children:(0,X.jsx)(Ie,{open:!!O,targetVFolderId:i,currentPath:(null===O||void 0===O?void 0:O.currentPath)||".",fileInfo:(null===O||void 0===O?void 0:O.file)||null,uploadFiles:R,onRequestClose:e=>{var l;e&&(null===(l=A.current)||void 0===l||l.refetch());D(null)}})})]}))}},20864:(e,l,n)=>{n.r(l),n.d(l,{default:()=>w,useFileUploadManager:()=>K});var a=n(56276),r=n(15584),i=n(62601),o=n(40720),t=n(87272),s=n(69319),d=n(7265),u=n(93687),c=n(17471),m=n(19429),g=n(60669),p=n.n(g),y=n(95073),v=n(29262),f=n(99118),F=n(37138),h=n(7075),k=n(19964),S=n(26862);const _=(0,u.eU)([]),x=(0,u.eU)({}),b=(0,m.Iz)((e=>(0,u.eU)((l=>l(x)[e]),((l,n,r)=>{const i=l(x);n(x,(0,a.A)((0,a.A)({},i),{},{[e]:r}))})))),w=()=>{const{t:e}=(0,f.Bd)(),{token:l}=t.A.useToken(),n=(0,F.CX)(),{upsertNotification:r,closeNotification:u}=(0,i.js)(),{generateFolderPath:m}=(0,o.useFolderExplorerOpener)(),[g,k]=(0,c.fp)(_),[b,w]=(0,c.fp)(x),[K]=(0,h.q)("max_concurrent_uploads"),A=new y.A({concurrency:K||2}),j=(0,v.useRef)({}),N=p().throttle(((n,i)=>{const o=j.current[n]||0;j.current[n]=0,w((t=>{var u,c,m,g,p,y,v,f,F,h;const k=(null===(u=t[n])||void 0===u||null===(c=u.completedFiles)||void 0===c?void 0:c.length)||0,_=((null===(m=t[n])||void 0===m||null===(g=m.completedFiles)||void 0===g?void 0:g.length)||0)+((null===(p=t[n])||void 0===p||null===(y=p.failedFiles)||void 0===y?void 0:y.length)||0)+((null===(v=t[n])||void 0===v||null===(f=v.pendingFiles)||void 0===f?void 0:f.length)||0),x=(null===(F=t[n])||void 0===F?void 0:F.totalExpectedSize)||0,b=((null===(h=t[n])||void 0===h?void 0:h.completedBytes)||0)+o;return r({key:"upload:"+n,backgroundTask:{status:"pending",percent:x>0?b/x*100:0,onChange:{pending:{description:(0,S.jsxs)(d.OOm,{direction:"column",align:"start",children:[(0,S.jsxs)(s.A.Text,{children:[e("explorer.UploadingFiles")," ( ",k," /"," ",_," )"]}),(0,S.jsx)(s.A.Text,{ellipsis:!0,type:"secondary",style:{fontSize:l.fontSizeSM,maxWidth:"300px"},children:i})]})}}}}),(0,a.A)((0,a.A)({},t),{},{[n]:(0,a.A)((0,a.A)({},t[n]),{},{completedBytes:b})})}))}),200,{leading:!0,trailing:!0});return(0,v.useEffect)((()=>{0!==g.length&&n&&(g.forEach((l=>{const{vFolderId:n,vFolderName:i,uploadFileInfo:o}=l,t=p().sumBy(o,(e=>e.file.size));w((l=>{var s,c,g,p,y,v;const f=!l[n],F=((null===(s=l[n])||void 0===s?void 0:s.totalExpectedSize)||0)+t,h=f?0:((null===(c=l[n])||void 0===c?void 0:c.completedBytes)||0)/F*100;return r({key:"upload:"+n,open:!0,message:(0,S.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,S.jsx)(d.rmy,{style:{fontWeight:"normal"},to:m(n),onClick:()=>{u("upload:"+n)},children:"".concat(i)})]}),backgroundTask:{status:"pending",percent:h,onChange:{pending:e("explorer.ProcessingUpload")}},duration:0}),(0,a.A)((0,a.A)({},l),{},{[n]:{vFolderName:i,pendingFiles:[...(null===(g=l[n])||void 0===g?void 0:g.pendingFiles)||[],...o.map((e=>e.file.webkitRelativePath||e.file.name))],completedFiles:(null===(p=l[n])||void 0===p?void 0:p.completedFiles)||[],failedFiles:(null===(y=l[n])||void 0===y?void 0:y.failedFiles)||[],completedBytes:(null===(v=l[n])||void 0===v?void 0:v.completedBytes)||0,totalExpectedSize:F}})})),o.forEach((e=>{let{file:l,startFunction:r}=e;A.add((async()=>{const e=l.webkitRelativePath||l.name;let i=0;try{await r({onProgress:(e,l,a)=>{const r=e-i;i=e,j.current[n]=(j.current[n]||0)+r,N(n,a)}}),N.flush(),delete j.current[n],w((l=>{var r;return(0,a.A)((0,a.A)({},l),{},{[n]:(0,a.A)((0,a.A)({},l[n]),{},{pendingFiles:l[n].pendingFiles.filter((l=>l!==e)),completedFiles:[...(null===(r=l[n])||void 0===r?void 0:r.completedFiles)||[],e]})})}))}catch(o){N.flush(),delete j.current[n],w((l=>{var r;return(0,a.A)((0,a.A)({},l),{},{[n]:(0,a.A)((0,a.A)({},l[n]),{},{pendingFiles:l[n].pendingFiles.filter((l=>l!==e)),failedFiles:[...(null===(r=l[n])||void 0===r?void 0:r.failedFiles)||[],e]})})}))}}))}))})),k([]))}),[g]),(0,v.useEffect)((()=>{Object.entries(b).forEach((l=>{let[n,i]=l;p().isEmpty(null===i||void 0===i?void 0:i.pendingFiles)&&(p().isEmpty(null===i||void 0===i?void 0:i.failedFiles)?p().isEmpty(null===i||void 0===i?void 0:i.completedFiles)||(r({key:"upload:"+n,open:!0,message:(0,S.jsxs)("span",{children:[e("explorer.VFolder"),":\xa0",(0,S.jsx)(d.rmy,{style:{fontWeight:"normal"},to:m(n),onClick:()=>{u("upload:"+n)},children:"".concat(null===i||void 0===i?void 0:i.vFolderName)})]}),backgroundTask:{status:"resolved",percent:100,onChange:{resolved:e("explorer.SuccessfullyUploadedToFolder")}},duration:3}),w((e=>(0,a.A)((0,a.A)({},e),{},{[n]:(0,a.A)((0,a.A)({},e[n]),{},{completedFiles:[],completedBytes:0,totalExpectedSize:0})})))):r({key:"upload:"+n,open:!0,message:e("explorer.UploadFailed",{folderName:null===i||void 0===i?void 0:i.vFolderName}),backgroundTask:{status:"rejected",percent:0,onChange:{rejected:e("explorer.FileUploadFailed",{folderName:null===i||void 0===i?void 0:i.vFolderName})}},extraDescription:p().join(null===i||void 0===i?void 0:i.failedFiles,", ")}))}))}),[b]),null},K=(e,l)=>{const n=(0,r.c)(16),a=(0,d.kqi)(),{t:o}=(0,f.Bd)(),{upsertNotification:t}=(0,i.js)(),s=(0,c.Xr)(_);let u;n[0]!==e?(u=e?(0,d.omW)(e).replace(/-/g,""):"",n[0]=e,n[1]=u):u=n[1];const[m,g]=(y=u,(0,c.fp)(b(y)));var y;let v;n[2]!==a||n[3]!==l||n[4]!==o||n[5]!==t?(v=(e,n)=>{const r=a._config.maxFileUploadSize,i=p().map(e,j).reduce(N,0);return!(r>0&&i>r)||(t({open:!0,key:"upload:"+n,message:o("explorer.UploadFailed",{folderName:null!==l&&void 0!==l?l:""}),description:o("data.explorer.FileUploadSizeLimit"),duration:3,toText:o("data.folders.OpenAFolder"),to:{search:new URLSearchParams({folder:n}).toString()}}),!1)},n[2]=a,n[3]=l,n[4]=o,n[5]=t,n[6]=v):v=n[6];const F=v;let h;n[7]!==a||n[8]!==l||n[9]!==s||n[10]!==F?(h=async(e,n,r)=>{if(!F(e,n))return;const i=[],o=p().map(e,(e=>(i.push(e),async l=>{const i=e.webkitRelativePath||e.name;try{const o=[r,i].filter(Boolean).join("/"),t=await a.vfolder.create_upload_session(o,e,n);return await new Promise(((n,a)=>{try{new k._O(e,{endpoint:t,uploadUrl:t,retryDelays:[0,3e3,5e3,1e4,2e4],chunkSize:A(e.size),storeFingerprintForResuming:!1,metadata:{filename:e.name,filetype:e.type},onProgress:(e,n)=>{var a;null===l||void 0===l||null===(a=l.onProgress)||void 0===a||a.call(l,e,n,i)},onSuccess:()=>{n({name:i,bytes:e.size})},onError:e=>{a(new Error("Upload failed for ".concat(i)))}}).start()}catch(r){a(new Error("Failed to initialize upload for ".concat(i)))}}))}catch(x){throw new Error("Failed to prepare upload for ".concat(i))}}))),t={vFolderId:n,vFolderName:null!==l&&void 0!==l?l:"",uploadFileInfo:p().zipWith(i,o,P)};s((e=>[...e,t]))},n[7]=a,n[8]=l,n[9]=s,n[10]=F,n[11]=h):h=n[11];const S=h;let x;return n[12]!==g||n[13]!==S||n[14]!==m?(x={uploadStatus:m,setUploadStatus:g,uploadFiles:S},n[12]=g,n[13]=S,n[14]=m,n[15]=x):x=n[15],x},A=e=>{const l=1048576;return e>=5120*l?200*l:e>=1024*l?100*l:e>=100*l?50*l:15*l};function j(e){return e.size}function N(e,l){return Math.max(e,l)}function P(e,l){return{file:e,startFunction:l}}}}]);
//# sourceMappingURL=3988.bb175fa8.chunk.js.map