"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[3625],{33002:(e,s,n)=>{n.d(s,{A:()=>u});var t=n(2993),r=n(30597),o=n(50868),i=n(60822),l=n(55368),a=n(89608),c=n.n(a),d=(n(43373),n(73689));const u=e=>{let{status:s="default",extraButtonTitle:n,onClickExtraButton:a,extra:u,style:m,...h}=e;const{token:g}=o.A.useToken(),p=u||n&&(0,d.jsx)(i.Ay,{type:"link",icon:"error"===s?(0,d.jsx)(t.A,{twoToneColor:g.colorError}):"warning"===s?(0,d.jsx)(r.A,{twoToneColor:g.colorWarning}):void 0,onClick:a,children:n})||void 0;return(0,d.jsx)(l.A,{className:"error"===s?"bai-card-error":"",style:c().extend(m,{borderColor:"error"===s?g.colorError:"warning"===s?g.colorWarning:"success"===s?g.colorSuccess:null===m||void 0===m?void 0:m.borderColor}),extra:p,...h})}},68786:(e,s,n)=>{n.d(s,{A:()=>u});var t=n(52161),r=n(22987),o=n(12731),i=n.n(o),l=n(89608),a=n.n(l),c=n(43373),d=n(73689);const u=c.forwardRef(((e,s)=>{let{value:n,onChange:o,localFormat:l,...c}=e;const[,u]=(0,t.A)({value:n,onChange:o});return(0,d.jsx)(r.A,{ref:s,value:n?i()(n):void 0,onChange:e=>{var s,n,t;a().isArray(e)&&(e=e[0]);const r=l?null===(s=e)||void 0===s?void 0:s.format():null===(n=e)||void 0===n||null===(t=n.tz())||void 0===t?void 0:t.toISOString();u(r)},...c})}))},69715:(e,s,n)=>{n.d(s,{Ay:()=>v,Kk:()=>g,p3:()=>p,sT:()=>m,vB:()=>u});var t=n(51593),r=n(98401),o=n(89130),i=n(6597),l=n(15934),a=n(43373),c=n(73689);const d=e=>{let{image:s,...n}=e;s=s||"";const[,{getImageAliasName:o,getBaseVersion:i,tagAlias:l}]=(0,t.Gj)();return(0,c.jsx)(r.A,{values:[{label:l(o(s)),color:"blue"},{label:i(s),color:"green"}],...n})},u=e=>{let{image:s,...n}=e;s=s||"";const[,{getBaseVersion:r,tagAlias:o}]=(0,t.Gj)();return(0,c.jsx)(l.A,{color:"green",...n,children:o(r(s))})},m=e=>{let{image:s,...n}=e;s=s||"";const[,{getBaseImage:r,tagAlias:o}]=(0,t.Gj)();return(0,c.jsx)(l.A,{color:"green",...n,children:o(r(s))})},h=e=>{let{image:s,...n}=e;s=s||"";const[,{getArchitecture:r,tagAlias:o}]=(0,t.Gj)();return(0,c.jsx)(l.A,{color:"green",...n,children:o(r(s))})},g=e=>{let{image:s,...n}=e;s=s||"";const[,{getImageLang:r,tagAlias:o}]=(0,t.Gj)();return(0,c.jsx)(l.A,{color:"green",...n,children:o(r(s))})},p=e=>{let{tag:s,labels:n,highlightKeyword:a,...d}=e;n=n||[];const[,{getConstraints:u}]=(0,t.Gj)(),m=u(s,n);return(0,c.jsxs)(o.A,{direction:"row",align:"start",children:[m[0]?(0,c.jsx)(l.A,{color:"blue",...d,children:(0,c.jsx)(i.A,{keyword:a,children:m[0]})}):null,m[1]?(0,c.jsx)(r.A,{color:"cyan",values:[{label:(0,c.jsx)(i.A,{keyword:a,children:"Customized"}),color:"cyan"},{label:(0,c.jsx)(i.A,{keyword:a,children:m[1]}),color:"cyan"}],...d}):null]})},x=(e,s)=>{let{image:n,style:t={}}=e;return n=n||"",(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(d,{image:n}),(0,c.jsx)(m,{image:n}),(0,c.jsx)(h,{image:n})]})},v=a.memo(x)},93625:(e,s,n)=>{n.r(s),n.d(s,{default:()=>Fe});var t=n(33002),r=n(94016),o=n(68786),i=n(98401),l=n(32461),a=n(89130),c=n(98957),d=n(16272),u=n(69715),m=n(4060),h=n(51593),g=n(23702),p=n(69056),x=n(15934),v=n(89608),A=n.n(v),j=n(43373),y=n(56762),b=n(73689);const f=1024,F=65535,w=e=>{let{inValid:s,value:n,...t}=e;return(0,b.jsx)(x.A,{color:!s&&T(n)?void 0:"red",...t})},T=e=>{if(k(e)){const s=e.split(":"),[n,t]=s.map((e=>parseInt(e)));return n>=f&&t<=F}return e===parseInt(e).toString()&&parseInt(e)>=f&&parseInt(e)<=F},k=e=>{const s=e.split(":");if(2===s.length){const[e,n]=s.map((e=>parseInt(e)));return e<=n}return!1},S=e=>A().flatten(A().map(e,(e=>k(e)?(e=>{const[s,n]=e.split(":").map((e=>parseInt(e)));return A().range(s,n+1)})(e):parseInt(e)))),E=e=>{let{name:s="ports",...n}=e;const{t:t}=(0,y.Bd)(),r=(0,h.CX)(),o=g.A.useFormInstance();return(0,b.jsx)(g.A.Item,{label:t("session.launcher.PreOpenPortTitle"),name:s,tooltip:(0,b.jsx)(y.x6,{i18nKey:"session.launcher.DescSetPreOpenPort"}),extra:t("session.launcher.PreOpenPortRangeGuide"),rules:[()=>({validator:(e,s)=>S(s).length<=r._config.maxCountForPreopenPorts?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortMaxCountLimit",{count:r._config.maxCountForPreopenPorts})))}),()=>({validator:(e,s)=>A().every(s,(e=>parseInt(e).toString()===e||k(e)))?Promise.resolve():Promise.reject(new Error(t("session.launcher.InvalidPortFormat")))}),()=>({validator(e,s){const n=S(s);return A().every(n,(e=>e>=f&&e<=F))?Promise.resolve():Promise.reject(new Error(t("session.launcher.PreOpenPortRange")))}}),()=>({validator(e,s){const n=S(s);return A().uniq(n).length===n.length?Promise.resolve():Promise.reject(new Error(t("session.launcher.DuplicatedPort")))}})],...n,children:(0,b.jsx)(p.A,{mode:"tags",tagRender:e=>{const n=A().filter(S(o.getFieldValue(s)),(s=>s===parseInt(e.value))).length>1;return(0,b.jsx)(w,{inValid:n,closable:e.closable,onClose:e.onClose,onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},value:e.value,children:e.label})},style:{width:"100%"},suffixIcon:null,open:!1,tokenSeparators:[","," "]})})};var V=n(39428),P=n(76604),I=n(22960),C=n(58278);const N=e=>{let{open:s,onClose:n,...t}=e;const{t:r}=(0,y.Bd)(),[o,i]=(0,I.q)("has_opened_tour_neo_session_validation"),l=[{title:r("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:r("tourguide.NeoSessionLauncher.ValidationErrorText"),target:()=>{var e;return null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]}},{title:r("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:r("tourguide.NeoSessionLauncher.FixErrorFieldbyModifyButton"),target:()=>{var e;return(null===(e=document.getElementsByClassName("bai-card-error"))||void 0===e?void 0:e[0]).querySelector(".ant-card-extra")}},{title:r("tourguide.NeoSessionLauncher.ValidationErrorTitle"),description:r("tourguide.NeoSessionLauncher.FixErrorAndTryAgainText"),target:()=>document.querySelector('[data-test-id="neo-session-launcher-tour-step-navigation"]')}];return(0,b.jsx)(C.A,{steps:l,onClose:e=>{null===n||void 0===n||n(e),i(!0)},open:!o&&s,...t})};var _=n(67378);const M=e=>{let{...s}=e;const{t:n}=(0,y.Bd)();return(0,b.jsx)(g.A.Item,{label:n("session.launcher.SessionName"),name:"sessionName",rules:[{min:4,message:n("session.Validation.SessionNameTooShort")},{max:64,message:n("session.Validation.SessionNameTooLong64")},{validator:(e,s)=>A().isEmpty(s)?Promise.resolve():/^\w/.test(s)?/^[\w.-]*$/.test(s)?!/\w$/.test(s)&&s.length>=4?Promise.reject(n("session.Validation.SessionNameShouldEndWith")):Promise.resolve():Promise.reject(n("session.Validation.SessionNameInvalidCharacter")):Promise.reject(n("session.Validation.SessionNameShouldStartWith"))}],...s,children:(0,b.jsx)(_.A,{allowClear:!0,autoComplete:"off"})})};var D=n(30566),O=n(71786),z=n(58879),B=n(3643),L=n(15634),R=n(84553);var G=n(61810),W=n(65666),q=n(85681),U=n(33772),$=n(96530),H=n(44582),K=n(13460),J=n(44733),X=n(50868),Z=n(42042),Q=n(55368),Y=n(2293),ee=n(85690),se=n(9833),ne=n(15480),te=n(98038),re=n(52932),oe=n(86917),ie=n(45679),le=n(39464),ae=n(77731),ce=n(51548),de=n(60822),ue=n(33789),me=n(10939),he=n(12731),ge=n.n(he),pe=n(27658),xe=n(40766),ve=n(18150),Ae=n(80427),je=n(82020),ye=n(12121);const be=e=>{let{form:s,containerCount:n=1}=e;return(0,b.jsxs)(b.Fragment,{children:[A().map(A().omit(s.getFieldsValue().resource,"shmem","accelerator","acceleratorType"),((e,t)=>{var r,o;return(0,b.jsx)(P.A,{type:t,value:"mem"===t?((null===(r=(0,z.Js)(e,"b"))||void 0===r?void 0:r.number)||0)*n+"":A().toNumber(e)*n+"",opts:{shmem:s.getFieldValue("resource").shmem?((null===(o=(0,z.Js)(s.getFieldValue("resource").shmem,"b"))||void 0===o?void 0:o.number)||0)*n:void 0}},t)})),A().isNumber(s.getFieldValue(["resource","accelerator"]))&&s.getFieldValue(["resource","acceleratorType"])&&(0,b.jsx)(P.A,{type:s.getFieldValue(["resource","acceleratorType"]),value:A().toString(s.getFieldValue(["resource","accelerator"])*n)})]})},fe=()=>{let e="";const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<8;n++)e+=s.charAt(Math.floor(62*Math.random()));return e+"-session"},Fe=()=>{var e,s,n,v,f,F,T,k,P,I,C,he,Fe,we,Te,ke,Se;const Ee=J.A.useApp();let Ve="normal";const Pe=(0,pe.md)(m.i7),Ie=(0,h.CX)(),[Ce,Ne]=(0,j.useState)(!1),_e=(0,j.useMemo)((()=>{var e,s;return{sessionType:"interactive",allocationPreset:"auto-preset",hpcOptimization:{autoEnabled:!0,OMP_NUM_THREADS:"1",OPENBLAS_NUM_THREADS:"1"},batch:{enabled:!1,command:void 0,scheduleDate:void 0},envvars:[],...(null===(e=Ie._config)||void 0===e?void 0:e.default_session_environment)&&{environments:{environment:null===(s=Ie._config)||void 0===s?void 0:s.default_session_environment}},...V.jh}}),[null===(e=Ie._config)||void 0===e?void 0:e.default_session_environment]),Me=(0,ye.withDefault)(ye.NumberParam,0),De=(0,ye.withDefault)(ye.JsonParam,_e),Oe=(0,ye.withDefault)(ye.JsonParam,{}),[{step:ze,formValues:Be,redirectTo:Le,appOption:Re},Ge]=(0,ye.useQueryParams)({step:Me,formValues:De,redirectTo:ye.StringParam,appOption:Oe}),{isDarkMode:We}=(0,R.e)(),qe=(0,ve.Zp)(),Ue=(0,h.f0)(),$e=(0,L.hd)(),{upsertNotification:He}=(0,B.js)(),{run:Ke}=(0,K.A)((()=>{Ge({formValues:A().omit(Ye.getFieldsValue(),["environments.image"],["environments.customizedTag"],["autoMountedFolderNames"])},"replaceIn")}),{leading:!1,wait:500,trailing:!0}),Je=e=>{Ge({step:e},"pushIn")},{token:Xe}=X.A.useToken(),{t:Ze}=(0,y.Bd)(),Qe=Z.Ay.useBreakpoint(),[Ye]=g.A.useForm();(0,j.useEffect)((()=>{A().isEmpty(Be)||Ye.validateFields().catch((e=>{}))}),[]);const es=(0,j.useMemo)((()=>A().merge({},_e,Be)),[_e,Be]);(0,j.useEffect)((()=>{var e;null===(e=Pe.current)||void 0===e||e.scrollTo(0,0)}),[ze]);const ss=g.A.useWatch("sessionType",{form:Ye,preserve:!0})||Ye.getFieldValue("sessionType")||Be.sessionType,ns=A().filter([{title:Ze("session.launcher.SessionType"),key:"sessionType"},{title:`${Ze("session.launcher.Environments")} & ${Ze("session.launcher.ResourceAllocation")} `,key:"environment"},"inference"!==ss&&{title:Ze("webui.menu.Data&Storage"),key:"storage"},{title:Ze("session.launcher.Network"),key:"network"},{title:Ze("session.launcher.ConfirmAndLaunch"),icon:(0,b.jsx)(G.A,{}),key:"review"}],(e=>!!e)),ts=null===(s=ns[ze])||void 0===s?void 0:s.key,rs=A().some(Ye.getFieldsError(),(e=>e.errors.length>0)),[os,is]=(0,h.Tw)("first");(0,j.useEffect)((()=>{ze===ns.length-1&&Ye.validateFields().catch((e=>{})).finally((()=>is()))}),[ze,Ye,is,ns.length]),(0,j.useEffect)((()=>{"first"!==os&&as(!!rs)}),[os,rs]);const[ls,as]=(0,j.useState)(!1);return(0,b.jsxs)(a.A,{direction:"column",align:"stretch",style:{justifyContent:"revert"},gap:"md",children:[(0,b.jsx)("style",{children:".session-type-radio-group .ant-radio {\n  align-self: flex-start;\n  margin-top: 2px;\n}\n"}),(0,b.jsxs)(a.A,{direction:"row",gap:"md",align:"start",children:[(0,b.jsx)(a.A,{direction:"column",align:"stretch",style:{flex:1,maxWidth:700},children:(0,b.jsx)(g.A.Provider,{onFormChange:(e,s)=>{Ke()},children:(0,b.jsx)(g.A,{form:Ye,layout:"vertical",requiredMark:"optional",initialValues:es,children:(0,b.jsxs)(a.A,{direction:"column",align:"stretch",gap:"md",children:[(0,b.jsxs)(Q.A,{title:Ze("session.launcher.SessionType"),style:{display:"sessionType"===ts?"block":"none"},children:[(0,b.jsx)(g.A.Item,{name:"sessionType",children:(0,b.jsx)(Y.Ay.Group,{options:[{label:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ee.A.Text,{code:!0,children:Ze("session.launcher.InteractiveMode")})," ",(0,b.jsx)(ee.A.Text,{type:"secondary",children:Ze("session.launcher.InteractiveModeDesc")})]}),value:"interactive"},{label:(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ee.A.Text,{code:!0,children:Ze("session.launcher.BatchMode")})," ",(0,b.jsx)(ee.A.Text,{type:"secondary",children:Ze("session.launcher.BatchModeDesc")})]}),value:"batch"}]})}),(0,b.jsx)(M,{}),(0,b.jsx)(g.A.Item,{name:"bootstrap_script",label:"Bootstrap Script",hidden:!0,children:(0,b.jsx)(_.A,{})})]}),"batch"===ss&&(0,b.jsxs)(Q.A,{title:Ze("session.launcher.BatchModeConfig"),style:{display:"sessionType"===ts?"block":"none"},children:[(0,b.jsx)(g.A.Item,{label:Ze("session.launcher.StartUpCommand"),name:["batch","command"],rules:[{required:!0,type:"string"}],children:(0,b.jsx)(_.A.TextArea,{autoSize:!0})}),(0,b.jsx)(g.A.Item,{label:Ze("session.launcher.SessionStartTime"),extra:(0,b.jsx)(g.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>e.batch.scheduleDate!==s.batch.scheduleDate,children:()=>{const e=Ye.getFieldValue(["batch","scheduleDate"]);return(0,b.jsx)(r.A,{delay:1e3,callback:()=>{const e=Ye.getFieldValue(["batch","scheduleDate"]);return e?ge()(e).isBefore(ge()())?void(0===Ye.getFieldError(["batch","scheduleDate"]).length&&Ye.validateFields([["batch","scheduleDate"]])):ge()(e).fromNow():void 0},triggerKey:e||"none"})}}),children:(0,b.jsxs)(a.A,{direction:"row",gap:"xs",children:[(0,b.jsx)(g.A.Item,{noStyle:!0,name:["batch","enabled"],valuePropName:"checked",children:(0,b.jsx)(se.A,{onChange:e=>{e.target.checked&&A().isEmpty(Ye.getFieldValue(["batch","scheduleDate"]))?Ye.setFieldValue(["batch","scheduleDate"],ge()().add(2,"minutes").toISOString()):!1===e.target.checked&&Ye.setFieldValue(["batch","scheduleDate"],void 0),Ye.validateFields([["batch","scheduleDate"]])},children:Ze("session.launcher.Enable")})}),(0,b.jsx)(g.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.batch)||void 0===n?void 0:n.enabled)!==(null===(t=s.batch)||void 0===t?void 0:t.enabled)},children:()=>{var e;const s=!0!==(null===(e=Ye.getFieldValue("batch"))||void 0===e?void 0:e.enabled);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(g.A.Item,{name:["batch","scheduleDate"],noStyle:!0,rules:[{validator:async(e,s)=>s&&ge()(s).isBefore(ge()())?Promise.reject(Ze("session.launcher.StartTimeMustBeInTheFuture")):Promise.resolve()}],children:(0,b.jsx)(o.A,{disabled:s,showTime:!0,localFormat:!0,disabledDate:e=>e.isBefore(ge()().startOf("day"))})})})}})]})})]}),"inference"===ss&&(0,b.jsx)(Q.A,{title:"Inference Mode Configuration",children:(0,b.jsx)(g.A.Item,{name:["inference","vFolderName"],label:Ze("session.launcher.ModelStorageToMount"),rules:[{required:!0}],children:(0,b.jsx)(p.A,{})})}),(0,b.jsxs)(Q.A,{title:Ze("session.launcher.Environments"),style:{display:"environment"===ts?"block":"none"},children:[(0,b.jsx)(xe.tH,{fallbackRender:e=>(console.log(e),null),children:(0,b.jsx)(c.A,{})}),(0,b.jsx)(g.A.Item,{label:Ze("session.launcher.EnvironmentVariable"),children:(0,b.jsx)(l.A,{name:"envvars",formItemProps:{validateTrigger:["onChange","onBlur"]}})})]}),(0,b.jsx)(Q.A,{title:Ze("session.launcher.ResourceAllocation"),style:{display:"environment"===ts?"block":"none"},children:(0,b.jsx)(V.Ay,{enableNumOfSessions:!0,enableResourcePresets:!0,showRemainingWarning:!0})}),(0,b.jsxs)(Q.A,{title:Ze("session.launcher.HPCOptimization"),style:{display:"environment"===ts?"block":"none"},children:[(0,b.jsx)(g.A.Item,{noStyle:!0,children:(0,b.jsxs)(a.A,{direction:"row",gap:"sm",children:[(0,b.jsx)(ee.A.Text,{children:Ze("session.launcher.SwitchOpenMPoptimization")}),(0,b.jsx)(g.A.Item,{label:Ze("session.launcher.SwitchOpenMPoptimization"),name:["hpcOptimization","autoEnabled"],valuePropName:"checked",required:!0,noStyle:!0,children:(0,b.jsx)(ne.A,{checkedChildren:"ON",unCheckedChildren:"OFF",onChange:e=>{e&&Ye.setFieldsValue(A().pick(_e,["hpcOptimization"]))}})})]})}),(0,b.jsx)(g.A.Item,{noStyle:!0,shouldUpdate:(e,s)=>{var n,t;return(null===(n=e.hpcOptimization)||void 0===n?void 0:n.autoEnabled)!==(null===(t=s.hpcOptimization)||void 0===t?void 0:t.autoEnabled)},children:()=>{const e=Ye.getFieldValue(["hpcOptimization","autoEnabled"]);return(0,b.jsxs)(te.A,{gutter:Xe.marginMD,style:{display:e?"none":void 0,marginTop:Xe.marginMD},children:[(0,b.jsx)(re.A,{xs:24,sm:12,children:(0,b.jsx)(g.A.Item,{style:{flex:1},label:Ze("session.launcher.NumOpenMPthreads"),name:["hpcOptimization","OMP_NUM_THREADS"],tooltip:(0,b.jsxs)(b.Fragment,{children:[Ze("session.launcher.OpenMPOptimization"),(0,b.jsx)(y.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,b.jsx)(oe.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})}),(0,b.jsx)(re.A,{xs:24,sm:12,children:(0,b.jsx)(g.A.Item,{style:{flex:1},label:Ze("session.launcher.NumOpenBLASthreads"),name:["hpcOptimization","OPENBLAS_NUM_THREADS"],tooltip:(0,b.jsxs)(b.Fragment,{children:[Ze("session.launcher.OpenMPOptimization"),(0,b.jsx)(y.x6,{i18nKey:"session.launcher.DescOpenMPOptimization"})]}),required:!0,children:(0,b.jsx)(oe.A,{min:0,max:1e3,step:1,stringMode:!0,style:{width:"100%"}})})})]})}})]}),(0,b.jsx)(Q.A,{title:Ze("webui.menu.Data&Storage"),style:{display:"storage"===ts?"block":"none"},children:(0,b.jsx)(O.A,{filter:e=>{var s;return"ready"===e.status&&!(null!==(s=e.name)&&void 0!==s&&s.startsWith("."))}})}),(0,b.jsx)(Q.A,{title:Ze("session.launcher.Network"),style:{display:"network"===ts?"block":"none"},children:(0,b.jsx)(E,{})}),"review"===ts&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.A,{title:Ze("session.launcher.SessionType"),size:"small",status:Ye.getFieldError("sessionName").length>0||Ye.getFieldError(["batch","command"]).length>0||Ye.getFieldError(["batch","scheduleDate"]).length>0?"error":void 0,extraButtonTitle:Ze("button.Edit"),onClickExtraButton:()=>{Je(ns.findIndex((e=>"sessionType"===e.key)))},children:(0,b.jsxs)(ie.A,{size:"small",column:1,children:[(0,b.jsx)(ie.A.Item,{label:Ze("session.SessionType"),children:Ye.getFieldValue("sessionType")}),!A().isEmpty(Ye.getFieldValue("sessionName"))&&(0,b.jsx)(ie.A.Item,{label:Ze("session.launcher.SessionName"),children:Ye.getFieldValue("sessionName")}),"batch"===ss&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ie.A.Item,{label:Ze("session.launcher.StartUpCommand"),labelStyle:{whiteSpace:"nowrap"},contentStyle:{overflow:"auto"},children:Ye.getFieldValue(["batch","command"])?(0,b.jsx)(D.A,{language:"shell",children:Ye.getFieldValue(["batch","command"])}):(0,b.jsx)(ee.A.Text,{type:"secondary",children:Ze("general.None")})}),(0,b.jsx)(ie.A.Item,{label:Ze("session.launcher.ScheduleTimeSimple"),children:Ye.getFieldValue(["batch","scheduleDate"])?ge()(Ye.getFieldValue(["batch","scheduleDate"])).format("LLL (Z)"):(0,b.jsx)(ee.A.Text,{type:"secondary",children:Ze("general.None")})})]})]})}),(0,b.jsx)(t.A,{title:Ze("session.launcher.Environments"),size:"small",status:A().some(Ye.getFieldValue("envvars"),((e,s)=>Ye.getFieldError(["envvars",s,"variable"]).length>0||Ye.getFieldError(["envvars",s,"value"]).length>0))?"error":void 0,extraButtonTitle:Ze("button.Edit"),onClickExtraButton:()=>{Je(ns.findIndex((e=>"environment"===e.key)))},children:(0,b.jsxs)(ie.A,{size:"small",column:1,children:[(0,b.jsx)(ie.A.Item,{label:Ze("session.launcher.Project"),children:$e.name}),(0,b.jsx)(ie.A.Item,{label:Ze("general.Image"),children:(0,b.jsxs)(te.A,{style:{flexFlow:"nowrap",gap:Xe.sizeXS},children:[(0,b.jsx)(re.A,{children:(0,b.jsx)(d.A,{image:(null===(n=Ye.getFieldValue("environments"))||void 0===n?void 0:n.version)||(null===(v=Ye.getFieldValue("environments"))||void 0===v?void 0:v.manual)})}),(0,b.jsx)(re.A,{children:(0,b.jsx)(a.A,{direction:"row",children:null!==(f=Ye.getFieldValue("environments"))&&void 0!==f&&f.manual?(0,b.jsx)(ee.A.Text,{code:!0,style:{wordBreak:"break-all"},copyable:{text:null===(F=Ye.getFieldValue("environments"))||void 0===F?void 0:F.manual},children:null===(T=Ye.getFieldValue("environments"))||void 0===T?void 0:T.manual}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.Ay,{image:null===(k=Ye.getFieldValue("environments"))||void 0===k?void 0:k.version}),null!==(P=Ye.getFieldValue("environments"))&&void 0!==P&&P.customizedTag?(0,b.jsx)(i.A,{values:[{label:"Customized",color:"cyan"},{label:null===(I=Ye.getFieldValue("environments"))||void 0===I?void 0:I.customizedTag,color:"cyan"}]}):null,(0,b.jsx)(ee.A.Text,{copyable:{text:null===(C=Ye.getFieldValue("environments"))||void 0===C?void 0:C.version}})]})})})]})}),(null===(he=Ye.getFieldValue("envvars"))||void 0===he?void 0:he.length)>0&&(0,b.jsx)(ie.A.Item,{label:Ze("session.launcher.EnvironmentVariable"),children:null!==(Fe=Ye.getFieldValue("envvars"))&&void 0!==Fe&&Fe.length?(0,b.jsx)(Ae.A,{style:We?je.A:void 0,codeTagProps:{style:{}},customStyle:{margin:0,width:"100%"},children:A().map(Ye.getFieldValue("envvars"),(e=>`${(null===e||void 0===e?void 0:e.variable)||""}="${(null===e||void 0===e?void 0:e.value)||""}"`)).join("\n")}):(0,b.jsx)(ee.A.Text,{type:"secondary",children:"-"})})]})}),(0,b.jsx)(t.A,{title:Ze("session.launcher.ResourceAllocation"),status:A().some(Ye.getFieldValue("resource"),((e,s)=>Ye.getFieldError(["resource",s]).length>0))||Ye.getFieldError(["num_of_sessions"]).length>0||Ye.getFieldError("resourceGroup").length>0?"error":void 0,size:"small",extraButtonTitle:Ze("button.Edit"),onClickExtraButton:()=>{Je(ns.findIndex((e=>"environment"===e.key)))},children:(0,b.jsxs)(a.A,{direction:"column",align:"stretch",children:[A().some(null===(we=Ye.getFieldValue("resource"))||void 0===we?void 0:we.resource,((e,s)=>Ye.getFieldWarning(["resource",s]).length>0))&&(0,b.jsx)(le.A,{type:"warning",showIcon:!0,message:Ze("session.launcher.EnqueueComputeSessionWarning")}),(0,b.jsxs)(ie.A,{column:2,children:[(0,b.jsx)(ie.A.Item,{label:Ze("general.ResourceGroup"),span:2,children:Ye.getFieldValue("resourceGroup")||(0,b.jsx)(ee.A.Text,{type:"secondary",children:Ze("general.None")})}),(0,b.jsx)(ie.A.Item,{label:Ze("session.launcher.ResourceAllocationPerContainer"),span:2,children:(0,b.jsxs)(a.A,{direction:"row",align:"start",gap:"sm",wrap:"wrap",style:{flex:1},children:["custom"===Ye.getFieldValue("allocationPreset")?"":(0,b.jsx)(x.A,{children:Ye.getFieldValue("allocationPreset")}),(0,b.jsx)(be,{form:Ye})]})}),(0,b.jsx)(ie.A.Item,{label:Ze("session.launcher.NumberOfContainer"),children:1===Ye.getFieldValue("cluster_size")?Ye.getFieldValue("num_of_sessions"):Ye.getFieldValue("cluster_size")}),(0,b.jsx)(ie.A.Item,{label:Ze("session.launcher.ClusterMode"),children:"single-node"===Ye.getFieldValue("cluster_mode")?Ze("session.launcher.SingleNode"):Ze("session.launcher.MultiNode")})]}),(0,b.jsx)(Q.A,{size:"small",type:"inner",title:Ze("session.launcher.TotalAllocation"),children:(0,b.jsx)(a.A,{direction:"row",gap:"xxs",children:(0,b.jsx)(be,{form:Ye,containerCount:1===Ye.getFieldValue("cluster_size")?Ye.getFieldValue("num_of_sessions"):Ye.getFieldValue("cluster_size")})})})]})}),(0,b.jsx)(t.A,{title:Ze("webui.menu.Data&Storage"),size:"small",status:Ye.getFieldError("vfoldersAliasMap").length>0?"error":void 0,extraButtonTitle:Ze("button.Edit"),onClickExtraButton:()=>{Je(ns.findIndex((e=>"storage"===e.key)))},children:(0,b.jsxs)(a.A,{direction:"column",align:"stretch",gap:"xs",children:[(null===(Te=Ye.getFieldValue("mounts"))||void 0===Te?void 0:Te.length)>0?(0,b.jsx)(ae.A,{rowKey:"name",size:"small",pagination:!1,columns:[{dataIndex:"name",title:Ze("data.folders.Name")},{dataIndex:"alias",title:Ze("session.launcher.FolderAlias"),render:(e,s)=>A().isEmpty(e)?(0,b.jsx)(ee.A.Text,{type:"secondary",style:{opacity:.7},children:`/home/work/${s.name}`}):e}],dataSource:A().map(Ye.getFieldValue("mounts"),(e=>{var s;return{name:e,alias:null===(s=Ye.getFieldValue("vfoldersAliasMap"))||void 0===s?void 0:s[e]}}))}):(0,b.jsx)(le.A,{type:"warning",showIcon:!0,message:Ze("session.launcher.NoFolderMounted")}),(null===(ke=Ye.getFieldValue("autoMountedFolderNames"))||void 0===ke?void 0:ke.length)>0?(0,b.jsx)(ie.A,{size:"small",children:(0,b.jsx)(ie.A.Item,{label:Ze("data.AutomountFolders"),children:A().map(Ye.getFieldValue("autoMountedFolderNames"),(e=>(0,b.jsx)(x.A,{children:e})))})}):null]})}),(0,b.jsx)(t.A,{title:"Network",size:"small",status:Ye.getFieldError("ports").length>0?"error":void 0,extraButtonTitle:Ze("button.Edit"),onClickExtraButton:()=>{Je(ns.findIndex((e=>"network"===e.key)))},children:(0,b.jsx)(ie.A,{size:"small",children:(0,b.jsx)(ie.A.Item,{label:Ze("session.launcher.PreOpenPortTitle"),children:(0,b.jsxs)(a.A,{direction:"row",gap:"xs",style:{flex:1},wrap:"wrap",children:[A().sortBy(Ye.getFieldValue("ports"),(e=>parseInt(e))).map((e=>(0,b.jsx)(w,{value:e,style:{margin:0},children:e}))),A().isArray(Ye.getFieldValue("ports"))&&0!==(null===(Se=Ye.getFieldValue("ports"))||void 0===Se?void 0:Se.length)?null:(0,b.jsx)(ee.A.Text,{type:"secondary",children:Ze("general.None")})]})})})})]}),(0,b.jsxs)(a.A,{direction:"row",justify:"between",children:[(0,b.jsx)(a.A,{gap:"sm",children:(0,b.jsx)(ce.A,{title:Ze("button.Reset"),description:Ze("session.launcher.ResetFormConfirm"),onConfirm:()=>{Ye.resetFields(),qe("/session/start")},icon:(0,b.jsx)(W.A,{style:{color:Xe.colorError}}),okText:Ze("button.Reset"),okButtonProps:{danger:!0},children:(0,b.jsx)(de.Ay,{danger:!0,type:"link",style:{paddingRight:0,paddingLeft:0},children:Ze("button.Reset")})})}),(0,b.jsxs)(a.A,{"data-test-id":"neo-session-launcher-tour-step-navigation",direction:"row",gap:"sm",children:[ze>0&&(0,b.jsx)(de.Ay,{onClick:()=>{Je(ze-1)},icon:(0,b.jsx)(q.A,{}),disabled:Ce,children:Ze("button.Previous")}),ze===ns.length-1?(0,b.jsx)(ue.A,{title:rs?Ze("session.launcher.PleaseCompleteForm"):void 0,children:(0,b.jsx)(de.Ay,{type:"primary",icon:(0,b.jsx)(U.A,{}),disabled:rs,onClick:()=>{Ne(!0),Ye.validateFields().then((async e=>{if(A().isEmpty(e.mounts)||0===e.mounts.length){if(!await new Promise((e=>{Ee.modal.confirm({title:Ze("session.launcher.NoFolderMounted"),content:(0,b.jsxs)(b.Fragment,{children:[Ze("session.launcher.HomeDirectoryDeletionDialog"),(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),Ze("session.launcher.LaunchConfirmationDialog"),(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),Ze("dialog.ask.DoYouWantToProceed")]}),onOk:()=>{e(!0)},okText:Ze("session.launcher.Start"),onCancel:()=>{e(!1)},closable:!0})})))return}const s=e.environments.manual||e.environments.version;let[n,t]=s?s.split("@"):["",""];const r=A().isEmpty(e.sessionName)?fe():e.sessionName,o={kernelName:n,architecture:t,sessionName:r,config:{type:e.sessionType,...A().isEmpty(e.bootstrap_script)?{}:{bootstrap_script:e.bootstrap_script},..."batch"===e.sessionType?{startsAt:e.batch.enabled?e.batch.scheduleDate:void 0,startupCommand:e.batch.command}:{},group_name:$e.name,domain:Ie._config.domainName,scaling_group:e.resourceGroup,cluster_mode:e.cluster_mode,cluster_size:e.cluster_size,maxWaitSeconds:15,cpu:e.resource.cpu,mem:e.resource.mem,shmem:(0,z.Mh)(e.resource.mem,"4g")>0&&(0,z.Mh)(e.resource.shmem,"1g")<0?"1g":e.resource.shmem,...e.resource.accelerator>0?{[e.resource.acceleratorType]:e.resource.accelerator}:void 0,mounts:e.mounts,mount_map:e.vfoldersAliasMap,env:{...A().fromPairs(e.envvars.map((e=>[e.variable,e.value]))),...A().omit(e.hpcOptimization,"autoEnabled")},preopen_ports:S(e.ports)}},i=A().map(A().range(e.num_of_sessions||1),(s=>{const n=(e.num_of_sessions||1)>1?`${o.sessionName}-${(0,z.kX)()}-${s}`:o.sessionName;return Ie.createIfNotExists(o.kernelName,n,o.config,2e4,o.architecture).then((e=>{if(null===e||void 0===e||!e.created)throw new Error(Ze("session.launcher.SessionAlreadyExists"));if("CANCELLED"===(null===e||void 0===e?void 0:e.status))throw new Error(Ze("session.launcher.FailedToStartNewSession"));return e})).catch((e=>{var s;throw null!==e&&void 0!==e&&null!==(s=e.message)&&void 0!==s&&s.includes("The session already exists")?new Error(Ze("session.launcher.SessionAlreadyExists")):e}))})),l=window.location.pathname+window.location.search;Ue(Le||"/job"),He({key:"session-launcher:"+r,backgroundTask:{promise:Promise.all(i),status:"pending",statusDescriptions:{pending:Ze("session.PreparingSession"),resolved:Ze("eduapi.ComputeSessionPrepared")}},duration:0,message:Ze("general.Session")+": "+r,open:!0}),await Promise.all(i).then((s=>{let[n]=s;if(1===e.num_of_sessions&&"batch"!==e.sessionType){const e=n;let s=A().cloneDeep(Re);s="kernelId"in e?A().extend(s,{"session-name":e.kernelId,"access-key":"",mode:Ve}):A().extend(s,{"session-uuid":e.sessionId,"session-name":e.sessionName,"access-key":"",mode:Ve});const t=e.servicePorts;!0===Array.isArray(t)?s["app-services"]=t.map((e=>e.name)):s["app-services"]=[],t.length>0&&globalThis.appLauncher.showLauncher(s)}})).catch((()=>{He({key:"session-launcher:"+r,to:l,toText:"\uc218\uc815"})}))})).catch((e=>{console.log("validation errors",e)})).finally((()=>{Ne(!1)}))},loading:Ce,children:Ze("session.launcher.Launch")})}):(0,b.jsxs)(de.Ay,{type:"primary",ghost:!0,onClick:()=>{Je(ze+1)},children:[Ze("button.Next")," ",(0,b.jsx)($.A,{})]}),ze!==ns.length-1&&(0,b.jsxs)(de.Ay,{onClick:()=>{Je(ns.length-1)},children:[Ze("session.launcher.SkipToConfirmAndLaunch"),(0,b.jsx)(H.A,{})]})]})]})]})})})}),Qe.lg&&(0,b.jsx)(a.A,{"data-test-id":"neo-session-launcher-tour-step",style:{position:"sticky",top:80},children:(0,b.jsx)(me.A,{size:"small",direction:"vertical",current:ze,onChange:e=>{Je(e)},items:A().map(ns,((e,s)=>({...e,status:s===ze?"process":"wait"})))})})]}),ze===ns.length-1?(0,b.jsx)(N,{open:ls,onClose:()=>{as(!1)},scrollIntoViewOptions:!0}):void 0]})}}}]);
//# sourceMappingURL=3625.82149da7.chunk.js.map