"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[20],{75020:function(e,n,a){a.r(n);var l,i,t=a(74165),r=a(1413),s=a(15861),o=a(29439),u=a(44925),d=a(87760),m=a(50164),c=a(77758),p=a(61502),g=a(14749),f=a(88724),v=a(63703),k=a(65113),y=a(57054),S=a(88464),b=a(38818),_=a(19427),F=a(62708),h=a(28499),T=a(32048),Z=a.n(T),K=a(4519),x=a(81748),w=a(87112),U=a(16980),N=a(2556),j=["extraFetchKey"];n.default=function(e){var n,T,M=e.extraFetchKey,P=void 0===M?"":M,I=(0,u.Z)(e,j),L=(0,x.$G)().t,C=(0,p.useWebComponentInfo)(),O=C.value,A=C.dispatchEvent;try{T=JSON.parse(O||"")}catch(ye){T={open:!1,userEmail:""}}var E,V=T,$=V.open,D=V.userEmail,B=k.Z.useModal(),R=(0,o.Z)(B,2),Q=R[0],q=R[1],z=y.Z.useForm(),G=(0,o.Z)(z,1)[0],Y={superadmin:["superadmin","admin","user","monitor"],admin:["admin","user","monitor"]},W=(0,d.Kr)("initial-fetch"),J=(0,o.Z)(W,2),H=J[0],X=J[1],ee=(0,K.useDeferredValue)(H+P),ne=(0,d.Dj)(),ae=null===ne||void 0===ne?void 0:ne.supports("sudo-session-enabled"),le=(0,w.useQuery)("isManagerSupportingTOTP",(function(){return ne.isManagerSupportingTOTP()}),{suspense:!1}),ie=le.data,te=le.isLoading;E=(null===ne||void 0===ne?void 0:ne.supports("2FA"))&&ie;var re=(0,U.useLazyLoadQuery)(void 0!==l?l:l=a(76912),{email:D,isNotSupportSudoSessionEnabled:!ae,isNotSupportTotp:!E,loggedInUserEmail:null!==(n=null===ne||void 0===ne?void 0:ne.email)&&void 0!==n?n:""},{fetchKey:ee,fetchPolicy:"network-only"}),se=re.user,oe=re.loggedInUser,ue=(0,U.useMutation)(void 0!==i?i:i=a(21325)),de=(0,o.Z)(ue,2),me=de[0],ce=de[1],pe=(0,m.Y)({mutationFn:function(e){return ne.remove_totp(e)}}),ge=(0,v.Z)(!1),fe=(0,o.Z)(ge,2),ve=fe[0],ke=fe[1].toggle;return(0,N.jsxs)(c.Z,(0,r.Z)((0,r.Z)({open:$,onCancel:function(){A("cancel",null)},centered:!0,title:L("credential.ModifyUserDetail"),destroyOnClose:!0,onOk:function(){G.validateFields().then(function(){var e=(0,s.Z)((0,t.Z)().mark((function e(n){var a,l,i;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete(a=(0,r.Z)({},n)).email,a=Z().omit(a,["password_confirm"]),a=Z().omitBy(a,(function(e){return void 0===e||""===e})),ae||null===(l=a)||void 0===l||delete l.sudo_session_enabled,E||null===(i=a)||void 0===i||delete i.totp_activated,me({variables:{email:(null===n||void 0===n?void 0:n.email)||"",props:a,isNotSupportSudoSessionEnabled:!ae,isNotSupportTotp:!E},onCompleted:function(e){var n,a;null!==e&&void 0!==e&&null!==(n=e.modify_user)&&void 0!==n&&n.ok?S.ZP.success(L("environment.SuccessfullyModified")):S.ZP.error(null===e||void 0===e||null===(a=e.modify_user)||void 0===a?void 0:a.msg);A("ok",null)},onError:function(e){S.ZP.error(null===e||void 0===e?void 0:e.message)}});case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}())},confirmLoading:ce},I),{},{children:[(0,N.jsxs)(y.Z,{preserve:!1,form:G,labelCol:{span:10},wrapperCol:{span:20},validateTrigger:["onChange","onBlur"],style:{marginBottom:40,marginTop:20},initialValues:(0,r.Z)({},se),children:[(0,N.jsx)(y.Z.Item,{name:"email",label:L("credential.UserID"),children:(0,N.jsx)(b.Z,{disabled:!0})}),(0,N.jsx)(y.Z.Item,{name:"username",label:L("credential.UserName"),children:(0,N.jsx)(b.Z,{placeholder:L("maxLength.64chars")})}),(0,N.jsx)(y.Z.Item,{name:"full_name",label:L("credential.FullName"),children:(0,N.jsx)(b.Z,{placeholder:L("maxLength.64chars")})}),(0,N.jsx)(y.Z.Item,{name:"password",label:L("general.NewPassword"),rules:[{pattern:/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/,message:L("webui.menu.InvalidPasswordMessage")}],children:(0,N.jsx)(b.Z.Password,{})}),(0,N.jsx)(y.Z.Item,{name:"password_confirm",dependencies:["password"],label:L("webui.menu.NewPasswordAgain"),rules:[function(e){var n=e.getFieldValue;return{validator:function(e,a){return!a&&n("password")?Promise.reject(new Error(L("webui.menu.PleaseConfirmYourPassword"))):a&&n("password")!==a?Promise.reject(new Error(L("environment.PasswordsDoNotMatch"))):Promise.resolve()}}}],children:(0,N.jsx)(b.Z.Password,{})}),(0,N.jsx)(y.Z.Item,{name:"description",label:L("credential.Description"),children:(0,N.jsx)(b.Z.TextArea,{placeholder:L("maxLength.500chars")})}),(0,N.jsx)(y.Z.Item,{name:"status",label:L("credential.UserStatus"),children:(0,N.jsx)(_.Z,{options:Z().map({active:"Active",inactive:"Inactive","before-verification":"Before Verification",deleted:"Deleted"},(function(e,n){return{value:n,label:e}}))})}),!(null===se||void 0===se||!se.role)&&!(null===oe||void 0===oe||!oe.role)&&oe.role in Y&&(0,N.jsx)(y.Z.Item,{name:"role",label:L("credential.Role"),children:(0,N.jsx)(_.Z,{options:Z().map(Y[oe.role],(function(e){return{value:e,label:e}}))})}),(0,N.jsx)(y.Z.Item,{name:"need_password_change",label:L("credential.DescRequirePasswordChange"),valuePropName:"checked",children:(0,N.jsx)(F.Z,{})}),!!ae&&(0,N.jsx)(y.Z.Item,{name:"sudo_session_enabled",label:L("credential.EnableSudoSession"),valuePropName:"checked",children:(0,N.jsx)(F.Z,{})}),!!E&&(0,N.jsx)(y.Z.Item,{name:"totp_activated",label:L("webui.menu.TotpActivated"),valuePropName:"checked",extra:(null===se||void 0===se?void 0:se.email)!==(null===ne||void 0===ne?void 0:ne.email)&&(0,N.jsx)(h.Z.Text,{type:"secondary",style:{fontSize:12},children:L("credential.AdminCanOnlyRemoveTotp")}),children:(0,N.jsx)(F.Z,{loading:te||pe.isLoading,disabled:(null===se||void 0===se?void 0:se.email)!==(null===ne||void 0===ne?void 0:ne.email)&&!(null!==se&&void 0!==se&&se.totp_activated),onChange:function(e){e?ke():null!==se&&void 0!==se&&se.totp_activated&&(G.setFieldValue("totp_activated",!0),Q.confirm({title:L("totp.TurnOffTotp"),icon:(0,N.jsx)(f.Z,{}),content:L("totp.ConfirmTotpRemovalBody"),okText:L("button.Yes"),okType:"danger",cancelText:L("button.No"),onOk:function(){pe.mutate((null===se||void 0===se?void 0:se.email)||"",{onSuccess:function(){S.ZP.success(L("totp.RemoveTotpSetupCompleted")),X(),G.setFieldValue("totp_activated",!1)},onError:function(e){console.log(e)}})},onCancel:function(){G.setFieldValue("totp_activated",!0)}}))}})})]}),!!E&&(0,N.jsx)(g.Z,{userFrgmt:se,open:ve,onRequestClose:function(e){e?X():G.setFieldValue("totp_activated",!1),ke()}}),q]}))}},21325:function(e,n,a){a.r(n);var l=function(){var e={defaultValue:null,kind:"LocalArgument",name:"email"},n={defaultValue:null,kind:"LocalArgument",name:"isNotSupportSudoSessionEnabled"},a={defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},l={defaultValue:null,kind:"LocalArgument",name:"props"},i=[{kind:"Variable",name:"email",variableName:"email"},{kind:"Variable",name:"props",variableName:"props"}],t={alias:null,args:null,kind:"ScalarField",name:"ok",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"msg",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},v={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[s,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:[e,n,a,l],kind:"Fragment",metadata:null,name:"UserSettingModalMutation",selections:[{alias:null,args:i,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[t,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[s,o,u,d,m,c,p,g,f,v,k,y,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],storageKey:null}],type:"Mutations",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[e,l,n,a],kind:"Operation",name:"UserSettingModalMutation",selections:[{alias:null,args:i,concreteType:"ModifyUser",kind:"LinkedField",name:"modify_user",plural:!1,selections:[t,r,{alias:null,args:null,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[s,o,u,d,m,c,p,g,f,v,k,y],storageKey:null}],storageKey:null}]},params:{cacheID:"9b1a3e23ee391f117fee34e25b6fbf05",id:null,metadata:{},name:"UserSettingModalMutation",operationKind:"mutation",text:"mutation UserSettingModalMutation(\n  $email: String!\n  $props: ModifyUserInput!\n  $isNotSupportSudoSessionEnabled: Boolean!\n  $isNotSupportTotp: Boolean!\n) {\n  modify_user(email: $email, props: $props) {\n    ok\n    msg\n    user {\n      id\n      email\n      username\n      need_password_change\n      full_name\n      description\n      status\n      domain_name\n      role\n      groups {\n        id\n        name\n      }\n      sudo_session_enabled @skipOnClient(if: $isNotSupportSudoSessionEnabled)\n      totp_activated @skipOnClient(if: $isNotSupportTotp)\n      ...TOTPActivateModalFragment\n    }\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();l.hash="b7bb2083b30dea10ff3f89197e67e2cb",n.default=l},76912:function(e,n,a){a.r(n);var l=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportSudoSessionEnabled"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"},{defaultValue:null,kind:"LocalArgument",name:"loggedInUserEmail"}],n=[{kind:"Variable",name:"email",variableName:"email"}],a={alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null},l={alias:null,args:null,kind:"ScalarField",name:"username",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"need_password_change",storageKey:null},t={alias:null,args:null,kind:"ScalarField",name:"full_name",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"description",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"domain_name",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"role",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},m={alias:null,args:null,concreteType:"UserGroup",kind:"LinkedField",name:"groups",plural:!0,selections:[d,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"sudo_session_enabled",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null},g=[{kind:"Variable",name:"email",variableName:"loggedInUserEmail"}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[a,l,i,t,r,s,o,u,m,c,p,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null},{alias:"loggedInUser",args:g,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[u],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[a,l,i,t,r,s,o,u,m,c,p,d],storageKey:null},{alias:"loggedInUser",args:g,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[u,d],storageKey:null}]},params:{cacheID:"55fb94209e66cec0a1a802ff12b18c64",id:null,metadata:{},name:"UserSettingModalQuery",operationKind:"query",text:"query UserSettingModalQuery(\n  $email: String\n  $isNotSupportSudoSessionEnabled: Boolean!\n  $isNotSupportTotp: Boolean!\n  $loggedInUserEmail: String\n) {\n  user(email: $email) {\n    email\n    username\n    need_password_change\n    full_name\n    description\n    status\n    domain_name\n    role\n    groups {\n      id\n      name\n    }\n    sudo_session_enabled @skipOnClient(if: $isNotSupportSudoSessionEnabled)\n    totp_activated @skipOnClient(if: $isNotSupportTotp)\n    ...TOTPActivateModalFragment\n    id\n  }\n  loggedInUser: user(email: $loggedInUserEmail) {\n    role\n    id\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();l.hash="139401e06fdc036b1235475a82fd4397",n.default=l}}]);
//# sourceMappingURL=20.d29a24b3.chunk.js.map